(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function i(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function l(h){if(h.ep)return;h.ep=!0;const g=i(h);fetch(h.href,g)}})();function yM(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _A={exports:{}},T1={};var HP;function bG(){if(HP)return T1;HP=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(l,h,g){var v=null;if(g!==void 0&&(v=""+g),h.key!==void 0&&(v=""+h.key),"key"in h){g={};for(var r in h)r!=="key"&&(g[r]=h[r])}else g=h;return h=g.ref,{$$typeof:n,type:l,key:v,ref:h!==void 0?h:null,props:g}}return T1.Fragment=e,T1.jsx=i,T1.jsxs=i,T1}var jP;function wG(){return jP||(jP=1,_A.exports=bG()),_A.exports}var hi=wG(),yA={exports:{}},Rs={};var qP;function SG(){if(qP)return Rs;qP=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),g=Symbol.for("react.consumer"),v=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),I=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),k=Symbol.iterator;function j(Ge){return Ge===null||typeof Ge!="object"?null:(Ge=k&&Ge[k]||Ge["@@iterator"],typeof Ge=="function"?Ge:null)}var $={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},re=Object.assign,ie={};function Y(Ge,Et,Vt){this.props=Ge,this.context=Et,this.refs=ie,this.updater=Vt||$}Y.prototype.isReactComponent={},Y.prototype.setState=function(Ge,Et){if(typeof Ge!="object"&&typeof Ge!="function"&&Ge!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ge,Et,"setState")},Y.prototype.forceUpdate=function(Ge){this.updater.enqueueForceUpdate(this,Ge,"forceUpdate")};function ae(){}ae.prototype=Y.prototype;function ue(Ge,Et,Vt){this.props=Ge,this.context=Et,this.refs=ie,this.updater=Vt||$}var me=ue.prototype=new ae;me.constructor=ue,re(me,Y.prototype),me.isPureReactComponent=!0;var Ae=Array.isArray;function Se(){}var ze={H:null,A:null,T:null,S:null},je=Object.prototype.hasOwnProperty;function Ce(Ge,Et,Vt){var ii=Vt.ref;return{$$typeof:n,type:Ge,key:Et,ref:ii!==void 0?ii:null,props:Vt}}function Te(Ge,Et){return Ce(Ge.type,Et,Ge.props)}function Ze(Ge){return typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===n}function Mt(Ge){var Et={"=":"=0",":":"=2"};return"$"+Ge.replace(/[=:]/g,function(Vt){return Et[Vt]})}var mt=/\/+/g;function Gt(Ge,Et){return typeof Ge=="object"&&Ge!==null&&Ge.key!=null?Mt(""+Ge.key):Et.toString(36)}function kt(Ge){switch(Ge.status){case"fulfilled":return Ge.value;case"rejected":throw Ge.reason;default:switch(typeof Ge.status=="string"?Ge.then(Se,Se):(Ge.status="pending",Ge.then(function(Et){Ge.status==="pending"&&(Ge.status="fulfilled",Ge.value=Et)},function(Et){Ge.status==="pending"&&(Ge.status="rejected",Ge.reason=Et)})),Ge.status){case"fulfilled":return Ge.value;case"rejected":throw Ge.reason}}throw Ge}function Re(Ge,Et,Vt,ii,ki){var qt=typeof Ge;(qt==="undefined"||qt==="boolean")&&(Ge=null);var xi=!1;if(Ge===null)xi=!0;else switch(qt){case"bigint":case"string":case"number":xi=!0;break;case"object":switch(Ge.$$typeof){case n:case e:xi=!0;break;case z:return xi=Ge._init,Re(xi(Ge._payload),Et,Vt,ii,ki)}}if(xi)return ki=ki(Ge),xi=ii===""?"."+Gt(Ge,0):ii,Ae(ki)?(Vt="",xi!=null&&(Vt=xi.replace(mt,"$&/")+"/"),Re(ki,Et,Vt,"",function(rn){return rn})):ki!=null&&(Ze(ki)&&(ki=Te(ki,Vt+(ki.key==null||Ge&&Ge.key===ki.key?"":(""+ki.key).replace(mt,"$&/")+"/")+xi)),Et.push(ki)),1;xi=0;var Fi=ii===""?".":ii+":";if(Ae(Ge))for(var Ui=0;Ui<Ge.length;Ui++)ii=Ge[Ui],qt=Fi+Gt(ii,Ui),xi+=Re(ii,Et,Vt,qt,ki);else if(Ui=j(Ge),typeof Ui=="function")for(Ge=Ui.call(Ge),Ui=0;!(ii=Ge.next()).done;)ii=ii.value,qt=Fi+Gt(ii,Ui++),xi+=Re(ii,Et,Vt,qt,ki);else if(qt==="object"){if(typeof Ge.then=="function")return Re(kt(Ge),Et,Vt,ii,ki);throw Et=String(Ge),Error("Objects are not valid as a React child (found: "+(Et==="[object Object]"?"object with keys {"+Object.keys(Ge).join(", ")+"}":Et)+"). If you meant to render a collection of children, use an array instead.")}return xi}function Qe(Ge,Et,Vt){if(Ge==null)return Ge;var ii=[],ki=0;return Re(Ge,ii,"","",function(qt){return Et.call(Vt,qt,ki++)}),ii}function et(Ge){if(Ge._status===-1){var Et=Ge._result;Et=Et(),Et.then(function(Vt){(Ge._status===0||Ge._status===-1)&&(Ge._status=1,Ge._result=Vt)},function(Vt){(Ge._status===0||Ge._status===-1)&&(Ge._status=2,Ge._result=Vt)}),Ge._status===-1&&(Ge._status=0,Ge._result=Et)}if(Ge._status===1)return Ge._result.default;throw Ge._result}var Lt=typeof reportError=="function"?reportError:function(Ge){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Et=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ge=="object"&&Ge!==null&&typeof Ge.message=="string"?String(Ge.message):String(Ge),error:Ge});if(!window.dispatchEvent(Et))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ge);return}console.error(Ge)},jt={map:Qe,forEach:function(Ge,Et,Vt){Qe(Ge,function(){Et.apply(this,arguments)},Vt)},count:function(Ge){var Et=0;return Qe(Ge,function(){Et++}),Et},toArray:function(Ge){return Qe(Ge,function(Et){return Et})||[]},only:function(Ge){if(!Ze(Ge))throw Error("React.Children.only expected to receive a single React element child.");return Ge}};return Rs.Activity=N,Rs.Children=jt,Rs.Component=Y,Rs.Fragment=i,Rs.Profiler=h,Rs.PureComponent=ue,Rs.StrictMode=l,Rs.Suspense=C,Rs.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ze,Rs.__COMPILER_RUNTIME={__proto__:null,c:function(Ge){return ze.H.useMemoCache(Ge)}},Rs.cache=function(Ge){return function(){return Ge.apply(null,arguments)}},Rs.cacheSignal=function(){return null},Rs.cloneElement=function(Ge,Et,Vt){if(Ge==null)throw Error("The argument must be a React element, but you passed "+Ge+".");var ii=re({},Ge.props),ki=Ge.key;if(Et!=null)for(qt in Et.key!==void 0&&(ki=""+Et.key),Et)!je.call(Et,qt)||qt==="key"||qt==="__self"||qt==="__source"||qt==="ref"&&Et.ref===void 0||(ii[qt]=Et[qt]);var qt=arguments.length-2;if(qt===1)ii.children=Vt;else if(1<qt){for(var xi=Array(qt),Fi=0;Fi<qt;Fi++)xi[Fi]=arguments[Fi+2];ii.children=xi}return Ce(Ge.type,ki,ii)},Rs.createContext=function(Ge){return Ge={$$typeof:v,_currentValue:Ge,_currentValue2:Ge,_threadCount:0,Provider:null,Consumer:null},Ge.Provider=Ge,Ge.Consumer={$$typeof:g,_context:Ge},Ge},Rs.createElement=function(Ge,Et,Vt){var ii,ki={},qt=null;if(Et!=null)for(ii in Et.key!==void 0&&(qt=""+Et.key),Et)je.call(Et,ii)&&ii!=="key"&&ii!=="__self"&&ii!=="__source"&&(ki[ii]=Et[ii]);var xi=arguments.length-2;if(xi===1)ki.children=Vt;else if(1<xi){for(var Fi=Array(xi),Ui=0;Ui<xi;Ui++)Fi[Ui]=arguments[Ui+2];ki.children=Fi}if(Ge&&Ge.defaultProps)for(ii in xi=Ge.defaultProps,xi)ki[ii]===void 0&&(ki[ii]=xi[ii]);return Ce(Ge,qt,ki)},Rs.createRef=function(){return{current:null}},Rs.forwardRef=function(Ge){return{$$typeof:r,render:Ge}},Rs.isValidElement=Ze,Rs.lazy=function(Ge){return{$$typeof:z,_payload:{_status:-1,_result:Ge},_init:et}},Rs.memo=function(Ge,Et){return{$$typeof:I,type:Ge,compare:Et===void 0?null:Et}},Rs.startTransition=function(Ge){var Et=ze.T,Vt={};ze.T=Vt;try{var ii=Ge(),ki=ze.S;ki!==null&&ki(Vt,ii),typeof ii=="object"&&ii!==null&&typeof ii.then=="function"&&ii.then(Se,Lt)}catch(qt){Lt(qt)}finally{Et!==null&&Vt.types!==null&&(Et.types=Vt.types),ze.T=Et}},Rs.unstable_useCacheRefresh=function(){return ze.H.useCacheRefresh()},Rs.use=function(Ge){return ze.H.use(Ge)},Rs.useActionState=function(Ge,Et,Vt){return ze.H.useActionState(Ge,Et,Vt)},Rs.useCallback=function(Ge,Et){return ze.H.useCallback(Ge,Et)},Rs.useContext=function(Ge){return ze.H.useContext(Ge)},Rs.useDebugValue=function(){},Rs.useDeferredValue=function(Ge,Et){return ze.H.useDeferredValue(Ge,Et)},Rs.useEffect=function(Ge,Et){return ze.H.useEffect(Ge,Et)},Rs.useEffectEvent=function(Ge){return ze.H.useEffectEvent(Ge)},Rs.useId=function(){return ze.H.useId()},Rs.useImperativeHandle=function(Ge,Et,Vt){return ze.H.useImperativeHandle(Ge,Et,Vt)},Rs.useInsertionEffect=function(Ge,Et){return ze.H.useInsertionEffect(Ge,Et)},Rs.useLayoutEffect=function(Ge,Et){return ze.H.useLayoutEffect(Ge,Et)},Rs.useMemo=function(Ge,Et){return ze.H.useMemo(Ge,Et)},Rs.useOptimistic=function(Ge,Et){return ze.H.useOptimistic(Ge,Et)},Rs.useReducer=function(Ge,Et,Vt){return ze.H.useReducer(Ge,Et,Vt)},Rs.useRef=function(Ge){return ze.H.useRef(Ge)},Rs.useState=function(Ge){return ze.H.useState(Ge)},Rs.useSyncExternalStore=function(Ge,Et,Vt){return ze.H.useSyncExternalStore(Ge,Et,Vt)},Rs.useTransition=function(){return ze.H.useTransition()},Rs.version="19.2.0",Rs}var XP;function fv(){return XP||(XP=1,yA.exports=SG()),yA.exports}var Ii=fv();const mF=yM(Ii);var xA={exports:{}},M1={},vA={exports:{}},bA={};var WP;function TG(){return WP||(WP=1,(function(n){function e(Re,Qe){var et=Re.length;Re.push(Qe);e:for(;0<et;){var Lt=et-1>>>1,jt=Re[Lt];if(0<h(jt,Qe))Re[Lt]=Qe,Re[et]=jt,et=Lt;else break e}}function i(Re){return Re.length===0?null:Re[0]}function l(Re){if(Re.length===0)return null;var Qe=Re[0],et=Re.pop();if(et!==Qe){Re[0]=et;e:for(var Lt=0,jt=Re.length,Ge=jt>>>1;Lt<Ge;){var Et=2*(Lt+1)-1,Vt=Re[Et],ii=Et+1,ki=Re[ii];if(0>h(Vt,et))ii<jt&&0>h(ki,Vt)?(Re[Lt]=ki,Re[ii]=et,Lt=ii):(Re[Lt]=Vt,Re[Et]=et,Lt=Et);else if(ii<jt&&0>h(ki,et))Re[Lt]=ki,Re[ii]=et,Lt=ii;else break e}}return Qe}function h(Re,Qe){var et=Re.sortIndex-Qe.sortIndex;return et!==0?et:Re.id-Qe.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var g=performance;n.unstable_now=function(){return g.now()}}else{var v=Date,r=v.now();n.unstable_now=function(){return v.now()-r}}var C=[],I=[],z=1,N=null,k=3,j=!1,$=!1,re=!1,ie=!1,Y=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;function me(Re){for(var Qe=i(I);Qe!==null;){if(Qe.callback===null)l(I);else if(Qe.startTime<=Re)l(I),Qe.sortIndex=Qe.expirationTime,e(C,Qe);else break;Qe=i(I)}}function Ae(Re){if(re=!1,me(Re),!$)if(i(C)!==null)$=!0,Se||(Se=!0,Mt());else{var Qe=i(I);Qe!==null&&kt(Ae,Qe.startTime-Re)}}var Se=!1,ze=-1,je=5,Ce=-1;function Te(){return ie?!0:!(n.unstable_now()-Ce<je)}function Ze(){if(ie=!1,Se){var Re=n.unstable_now();Ce=Re;var Qe=!0;try{e:{$=!1,re&&(re=!1,ae(ze),ze=-1),j=!0;var et=k;try{t:{for(me(Re),N=i(C);N!==null&&!(N.expirationTime>Re&&Te());){var Lt=N.callback;if(typeof Lt=="function"){N.callback=null,k=N.priorityLevel;var jt=Lt(N.expirationTime<=Re);if(Re=n.unstable_now(),typeof jt=="function"){N.callback=jt,me(Re),Qe=!0;break t}N===i(C)&&l(C),me(Re)}else l(C);N=i(C)}if(N!==null)Qe=!0;else{var Ge=i(I);Ge!==null&&kt(Ae,Ge.startTime-Re),Qe=!1}}break e}finally{N=null,k=et,j=!1}Qe=void 0}}finally{Qe?Mt():Se=!1}}}var Mt;if(typeof ue=="function")Mt=function(){ue(Ze)};else if(typeof MessageChannel<"u"){var mt=new MessageChannel,Gt=mt.port2;mt.port1.onmessage=Ze,Mt=function(){Gt.postMessage(null)}}else Mt=function(){Y(Ze,0)};function kt(Re,Qe){ze=Y(function(){Re(n.unstable_now())},Qe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_next=function(Re){switch(k){case 1:case 2:case 3:var Qe=3;break;default:Qe=k}var et=k;k=Qe;try{return Re()}finally{k=et}},n.unstable_requestPaint=function(){ie=!0},n.unstable_runWithPriority=function(Re,Qe){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var et=k;k=Re;try{return Qe()}finally{k=et}},n.unstable_scheduleCallback=function(Re,Qe,et){var Lt=n.unstable_now();switch(typeof et=="object"&&et!==null?(et=et.delay,et=typeof et=="number"&&0<et?Lt+et:Lt):et=Lt,Re){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=et+jt,Re={id:z++,callback:Qe,priorityLevel:Re,startTime:et,expirationTime:jt,sortIndex:-1},et>Lt?(Re.sortIndex=et,e(I,Re),i(C)===null&&Re===i(I)&&(re?(ae(ze),ze=-1):re=!0,kt(Ae,et-Lt))):(Re.sortIndex=jt,e(C,Re),$||j||($=!0,Se||(Se=!0,Mt()))),Re},n.unstable_shouldYield=Te,n.unstable_wrapCallback=function(Re){var Qe=k;return function(){var et=k;k=Qe;try{return Re.apply(this,arguments)}finally{k=et}}}})(bA)),bA}var ZP;function MG(){return ZP||(ZP=1,vA.exports=TG()),vA.exports}var wA={exports:{}},fh={};var YP;function EG(){if(YP)return fh;YP=1;var n=fv();function e(C){var I="https://react.dev/errors/"+C;if(1<arguments.length){I+="?args[]="+encodeURIComponent(arguments[1]);for(var z=2;z<arguments.length;z++)I+="&args[]="+encodeURIComponent(arguments[z])}return"Minified React error #"+C+"; visit "+I+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var l={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},h=Symbol.for("react.portal");function g(C,I,z){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:h,key:N==null?null:""+N,children:C,containerInfo:I,implementation:z}}var v=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(C,I){if(C==="font")return"";if(typeof I=="string")return I==="use-credentials"?I:""}return fh.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,fh.createPortal=function(C,I){var z=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!I||I.nodeType!==1&&I.nodeType!==9&&I.nodeType!==11)throw Error(e(299));return g(C,I,null,z)},fh.flushSync=function(C){var I=v.T,z=l.p;try{if(v.T=null,l.p=2,C)return C()}finally{v.T=I,l.p=z,l.d.f()}},fh.preconnect=function(C,I){typeof C=="string"&&(I?(I=I.crossOrigin,I=typeof I=="string"?I==="use-credentials"?I:"":void 0):I=null,l.d.C(C,I))},fh.prefetchDNS=function(C){typeof C=="string"&&l.d.D(C)},fh.preinit=function(C,I){if(typeof C=="string"&&I&&typeof I.as=="string"){var z=I.as,N=r(z,I.crossOrigin),k=typeof I.integrity=="string"?I.integrity:void 0,j=typeof I.fetchPriority=="string"?I.fetchPriority:void 0;z==="style"?l.d.S(C,typeof I.precedence=="string"?I.precedence:void 0,{crossOrigin:N,integrity:k,fetchPriority:j}):z==="script"&&l.d.X(C,{crossOrigin:N,integrity:k,fetchPriority:j,nonce:typeof I.nonce=="string"?I.nonce:void 0})}},fh.preinitModule=function(C,I){if(typeof C=="string")if(typeof I=="object"&&I!==null){if(I.as==null||I.as==="script"){var z=r(I.as,I.crossOrigin);l.d.M(C,{crossOrigin:z,integrity:typeof I.integrity=="string"?I.integrity:void 0,nonce:typeof I.nonce=="string"?I.nonce:void 0})}}else I==null&&l.d.M(C)},fh.preload=function(C,I){if(typeof C=="string"&&typeof I=="object"&&I!==null&&typeof I.as=="string"){var z=I.as,N=r(z,I.crossOrigin);l.d.L(C,z,{crossOrigin:N,integrity:typeof I.integrity=="string"?I.integrity:void 0,nonce:typeof I.nonce=="string"?I.nonce:void 0,type:typeof I.type=="string"?I.type:void 0,fetchPriority:typeof I.fetchPriority=="string"?I.fetchPriority:void 0,referrerPolicy:typeof I.referrerPolicy=="string"?I.referrerPolicy:void 0,imageSrcSet:typeof I.imageSrcSet=="string"?I.imageSrcSet:void 0,imageSizes:typeof I.imageSizes=="string"?I.imageSizes:void 0,media:typeof I.media=="string"?I.media:void 0})}},fh.preloadModule=function(C,I){if(typeof C=="string")if(I){var z=r(I.as,I.crossOrigin);l.d.m(C,{as:typeof I.as=="string"&&I.as!=="script"?I.as:void 0,crossOrigin:z,integrity:typeof I.integrity=="string"?I.integrity:void 0})}else l.d.m(C)},fh.requestFormReset=function(C){l.d.r(C)},fh.unstable_batchedUpdates=function(C,I){return C(I)},fh.useFormState=function(C,I,z){return v.H.useFormState(C,I,z)},fh.useFormStatus=function(){return v.H.useHostTransitionStatus()},fh.version="19.2.0",fh}var KP;function AG(){if(KP)return wA.exports;KP=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),wA.exports=EG(),wA.exports}var $P;function CG(){if($P)return M1;$P=1;var n=MG(),e=fv(),i=AG();function l(f){var y="https://react.dev/errors/"+f;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var E=2;E<arguments.length;E++)y+="&args[]="+encodeURIComponent(arguments[E])}return"Minified React error #"+f+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function g(f){var y=f,E=f;if(f.alternate)for(;y.return;)y=y.return;else{f=y;do y=f,(y.flags&4098)!==0&&(E=y.return),f=y.return;while(f)}return y.tag===3?E:null}function v(f){if(f.tag===13){var y=f.memoizedState;if(y===null&&(f=f.alternate,f!==null&&(y=f.memoizedState)),y!==null)return y.dehydrated}return null}function r(f){if(f.tag===31){var y=f.memoizedState;if(y===null&&(f=f.alternate,f!==null&&(y=f.memoizedState)),y!==null)return y.dehydrated}return null}function C(f){if(g(f)!==f)throw Error(l(188))}function I(f){var y=f.alternate;if(!y){if(y=g(f),y===null)throw Error(l(188));return y!==f?null:f}for(var E=f,P=y;;){var W=E.return;if(W===null)break;var J=W.alternate;if(J===null){if(P=W.return,P!==null){E=P;continue}break}if(W.child===J.child){for(J=W.child;J;){if(J===E)return C(W),f;if(J===P)return C(W),y;J=J.sibling}throw Error(l(188))}if(E.return!==P.return)E=W,P=J;else{for(var ve=!1,Xe=W.child;Xe;){if(Xe===E){ve=!0,E=W,P=J;break}if(Xe===P){ve=!0,P=W,E=J;break}Xe=Xe.sibling}if(!ve){for(Xe=J.child;Xe;){if(Xe===E){ve=!0,E=J,P=W;break}if(Xe===P){ve=!0,P=J,E=W;break}Xe=Xe.sibling}if(!ve)throw Error(l(189))}}if(E.alternate!==P)throw Error(l(190))}if(E.tag!==3)throw Error(l(188));return E.stateNode.current===E?f:y}function z(f){var y=f.tag;if(y===5||y===26||y===27||y===6)return f;for(f=f.child;f!==null;){if(y=z(f),y!==null)return y;f=f.sibling}return null}var N=Object.assign,k=Symbol.for("react.element"),j=Symbol.for("react.transitional.element"),$=Symbol.for("react.portal"),re=Symbol.for("react.fragment"),ie=Symbol.for("react.strict_mode"),Y=Symbol.for("react.profiler"),ae=Symbol.for("react.consumer"),ue=Symbol.for("react.context"),me=Symbol.for("react.forward_ref"),Ae=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),ze=Symbol.for("react.memo"),je=Symbol.for("react.lazy"),Ce=Symbol.for("react.activity"),Te=Symbol.for("react.memo_cache_sentinel"),Ze=Symbol.iterator;function Mt(f){return f===null||typeof f!="object"?null:(f=Ze&&f[Ze]||f["@@iterator"],typeof f=="function"?f:null)}var mt=Symbol.for("react.client.reference");function Gt(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===mt?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case re:return"Fragment";case Y:return"Profiler";case ie:return"StrictMode";case Ae:return"Suspense";case Se:return"SuspenseList";case Ce:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case $:return"Portal";case ue:return f.displayName||"Context";case ae:return(f._context.displayName||"Context")+".Consumer";case me:var y=f.render;return f=f.displayName,f||(f=y.displayName||y.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case ze:return y=f.displayName||null,y!==null?y:Gt(f.type)||"Memo";case je:y=f._payload,f=f._init;try{return Gt(f(y))}catch{}}return null}var kt=Array.isArray,Re=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Qe=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,et={pending:!1,data:null,method:null,action:null},Lt=[],jt=-1;function Ge(f){return{current:f}}function Et(f){0>jt||(f.current=Lt[jt],Lt[jt]=null,jt--)}function Vt(f,y){jt++,Lt[jt]=f.current,f.current=y}var ii=Ge(null),ki=Ge(null),qt=Ge(null),xi=Ge(null);function Fi(f,y){switch(Vt(qt,y),Vt(ki,f),Vt(ii,null),y.nodeType){case 9:case 11:f=(f=y.documentElement)&&(f=f.namespaceURI)?zv(f):0;break;default:if(f=y.tagName,y=y.namespaceURI)y=zv(y),f=m_(y,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}Et(ii),Vt(ii,f)}function Ui(){Et(ii),Et(ki),Et(qt)}function rn(f){f.memoizedState!==null&&Vt(xi,f);var y=ii.current,E=m_(y,f.type);y!==E&&(Vt(ki,f),Vt(ii,E))}function Fn(f){ki.current===f&&(Et(ii),Et(ki)),xi.current===f&&(Et(xi),T0._currentValue=et)}var Er,xn;function Vi(f){if(Er===void 0)try{throw Error()}catch(E){var y=E.stack.trim().match(/\n( *(at )?)/);Er=y&&y[1]||"",xn=-1<E.stack.indexOf(`
    at`)?" (<anonymous>)":-1<E.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Er+f+xn}var st=!1;function Xi(f,y){if(!f||st)return"";st=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var P={DetermineComponentFrameRoot:function(){try{if(y){var nn=function(){throw Error()};if(Object.defineProperty(nn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(nn,[])}catch(Ci){var wi=Ci}Reflect.construct(f,[],nn)}else{try{nn.call()}catch(Ci){wi=Ci}f.call(nn.prototype)}}else{try{throw Error()}catch(Ci){wi=Ci}(nn=f())&&typeof nn.catch=="function"&&nn.catch(function(){})}}catch(Ci){if(Ci&&wi&&typeof Ci.stack=="string")return[Ci.stack,wi.stack]}return[null,null]}};P.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var W=Object.getOwnPropertyDescriptor(P.DetermineComponentFrameRoot,"name");W&&W.configurable&&Object.defineProperty(P.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var J=P.DetermineComponentFrameRoot(),ve=J[0],Xe=J[1];if(ve&&Xe){var Ct=ve.split(`
`),_i=Xe.split(`
`);for(W=P=0;P<Ct.length&&!Ct[P].includes("DetermineComponentFrameRoot");)P++;for(;W<_i.length&&!_i[W].includes("DetermineComponentFrameRoot");)W++;if(P===Ct.length||W===_i.length)for(P=Ct.length-1,W=_i.length-1;1<=P&&0<=W&&Ct[P]!==_i[W];)W--;for(;1<=P&&0<=W;P--,W--)if(Ct[P]!==_i[W]){if(P!==1||W!==1)do if(P--,W--,0>W||Ct[P]!==_i[W]){var Hi=`
`+Ct[P].replace(" at new "," at ");return f.displayName&&Hi.includes("<anonymous>")&&(Hi=Hi.replace("<anonymous>",f.displayName)),Hi}while(1<=P&&0<=W);break}}}finally{st=!1,Error.prepareStackTrace=E}return(E=f?f.displayName||f.name:"")?Vi(E):""}function Ji(f,y){switch(f.tag){case 26:case 27:case 5:return Vi(f.type);case 16:return Vi("Lazy");case 13:return f.child!==y&&y!==null?Vi("Suspense Fallback"):Vi("Suspense");case 19:return Vi("SuspenseList");case 0:case 15:return Xi(f.type,!1);case 11:return Xi(f.type.render,!1);case 1:return Xi(f.type,!0);case 31:return Vi("Activity");default:return""}}function Di(f){try{var y="",E=null;do y+=Ji(f,E),E=f,f=f.return;while(f);return y}catch(P){return`
Error generating stack: `+P.message+`
`+P.stack}}var tn=Object.prototype.hasOwnProperty,Sn=n.unstable_scheduleCallback,_n=n.unstable_cancelCallback,Gn=n.unstable_shouldYield,ot=n.unstable_requestPaint,De=n.unstable_now,Qt=n.unstable_getCurrentPriorityLevel,Li=n.unstable_ImmediatePriority,Wi=n.unstable_UserBlockingPriority,Ei=n.unstable_NormalPriority,Hn=n.unstable_LowPriority,An=n.unstable_IdlePriority,dr=n.log,Jn=n.unstable_setDisableYieldValue,Qi=null,qi=null;function Xn(f){if(typeof dr=="function"&&Jn(f),qi&&typeof qi.setStrictMode=="function")try{qi.setStrictMode(Qi,f)}catch{}}var Qn=Math.clz32?Math.clz32:Rt,Nn=Math.log,xr=Math.LN2;function Rt(f){return f>>>=0,f===0?32:31-(Nn(f)/xr|0)|0}var wn=256,vn=262144,bn=4194304;function Pi(f){var y=f&42;if(y!==0)return y;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return f&261888;case 262144:case 524288:case 1048576:case 2097152:return f&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function zi(f,y,E){var P=f.pendingLanes;if(P===0)return 0;var W=0,J=f.suspendedLanes,ve=f.pingedLanes;f=f.warmLanes;var Xe=P&134217727;return Xe!==0?(P=Xe&~J,P!==0?W=Pi(P):(ve&=Xe,ve!==0?W=Pi(ve):E||(E=Xe&~f,E!==0&&(W=Pi(E))))):(Xe=P&~J,Xe!==0?W=Pi(Xe):ve!==0?W=Pi(ve):E||(E=P&~f,E!==0&&(W=Pi(E)))),W===0?0:y!==0&&y!==W&&(y&J)===0&&(J=W&-W,E=y&-y,J>=E||J===32&&(E&4194048)!==0)?y:W}function Kn(f,y){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&y)===0}function Dr(f,y){switch(f){case 1:case 2:case 4:case 8:case 64:return y+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ls(){var f=bn;return bn<<=1,(bn&62914560)===0&&(bn=4194304),f}function Ts(f){for(var y=[],E=0;31>E;E++)y.push(f);return y}function Xt(f,y){f.pendingLanes|=y,y!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function ja(f,y,E,P,W,J){var ve=f.pendingLanes;f.pendingLanes=E,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=E,f.entangledLanes&=E,f.errorRecoveryDisabledLanes&=E,f.shellSuspendCounter=0;var Xe=f.entanglements,Ct=f.expirationTimes,_i=f.hiddenUpdates;for(E=ve&~E;0<E;){var Hi=31-Qn(E),nn=1<<Hi;Xe[Hi]=0,Ct[Hi]=-1;var wi=_i[Hi];if(wi!==null)for(_i[Hi]=null,Hi=0;Hi<wi.length;Hi++){var Ci=wi[Hi];Ci!==null&&(Ci.lane&=-536870913)}E&=~nn}P!==0&&$f(f,P,0),J!==0&&W===0&&f.tag!==0&&(f.suspendedLanes|=J&~(ve&~y))}function $f(f,y,E){f.pendingLanes|=y,f.suspendedLanes&=~y;var P=31-Qn(y);f.entangledLanes|=y,f.entanglements[P]=f.entanglements[P]|1073741824|E&261930}function ac(f,y){var E=f.entangledLanes|=y;for(f=f.entanglements;E;){var P=31-Qn(E),W=1<<P;W&y|f[P]&y&&(f[P]|=y),E&=~W}}function Ar(f,y){var E=y&-y;return E=(E&42)!==0?1:js(E),(E&(f.suspendedLanes|y))!==0?0:E}function js(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function Bu(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function Lo(){var f=Qe.p;return f!==0?f:(f=window.event,f===void 0?32:jw(f.type))}function jo(f,y){var E=Qe.p;try{return Qe.p=f,y()}finally{Qe.p=E}}var ft=Math.random().toString(36).slice(2),oe="__reactFiber$"+ft,ge="__reactProps$"+ft,Ie="__reactContainer$"+ft,$e="__reactEvents$"+ft,Ke="__reactListeners$"+ft,at="__reactHandles$"+ft,At="__reactResources$"+ft,lt="__reactMarker$"+ft;function Tt(f){delete f[oe],delete f[ge],delete f[$e],delete f[Ke],delete f[at]}function Wt(f){var y=f[oe];if(y)return y;for(var E=f.parentNode;E;){if(y=E[Ie]||E[oe]){if(E=y.alternate,y.child!==null||E!==null&&E.child!==null)for(f=Fv(f);f!==null;){if(E=f[oe])return E;f=Fv(f)}return y}f=E,E=f.parentNode}return null}function ye(f){if(f=f[oe]||f[Ie]){var y=f.tag;if(y===5||y===6||y===13||y===31||y===26||y===27||y===3)return f}return null}function it(f){var y=f.tag;if(y===5||y===26||y===27||y===6)return f.stateNode;throw Error(l(33))}function wt(f){var y=f[At];return y||(y=f[At]={hoistableStyles:new Map,hoistableScripts:new Map}),y}function ht(f){f[lt]=!0}var bt=new Set,mi={};function bi(f,y){ji(f,y),ji(f+"Capture",y)}function ji(f,y){for(mi[f]=y,f=0;f<y.length;f++)bt.add(y[f])}var pn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vn={},Un={};function kn(f){return tn.call(Un,f)?!0:tn.call(Vn,f)?!1:pn.test(f)?Un[f]=!0:(Vn[f]=!0,!1)}function Wn(f,y,E){if(kn(y))if(E===null)f.removeAttribute(y);else{switch(typeof E){case"undefined":case"function":case"symbol":f.removeAttribute(y);return;case"boolean":var P=y.toLowerCase().slice(0,5);if(P!=="data-"&&P!=="aria-"){f.removeAttribute(y);return}}f.setAttribute(y,""+E)}}function Cn(f,y,E){if(E===null)f.removeAttribute(y);else{switch(typeof E){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(y);return}f.setAttribute(y,""+E)}}function or(f,y,E,P){if(P===null)f.removeAttribute(E);else{switch(typeof P){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(E);return}f.setAttributeNS(y,E,""+P)}}function jn(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Tn(f){var y=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function In(f,y,E){var P=Object.getOwnPropertyDescriptor(f.constructor.prototype,y);if(!f.hasOwnProperty(y)&&typeof P<"u"&&typeof P.get=="function"&&typeof P.set=="function"){var W=P.get,J=P.set;return Object.defineProperty(f,y,{configurable:!0,get:function(){return W.call(this)},set:function(ve){E=""+ve,J.call(this,ve)}}),Object.defineProperty(f,y,{enumerable:P.enumerable}),{getValue:function(){return E},setValue:function(ve){E=""+ve},stopTracking:function(){f._valueTracker=null,delete f[y]}}}}function Qr(f){if(!f._valueTracker){var y=Tn(f)?"checked":"value";f._valueTracker=In(f,y,""+f[y])}}function kr(f){if(!f)return!1;var y=f._valueTracker;if(!y)return!0;var E=y.getValue(),P="";return f&&(P=Tn(f)?f.checked?"true":"false":f.value),f=P,f!==E?(y.setValue(f),!0):!1}function qs(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var bl=/[\n"\\]/g;function Kr(f){return f.replace(bl,function(y){return"\\"+y.charCodeAt(0).toString(16)+" "})}function qa(f,y,E,P,W,J,ve,Xe){f.name="",ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"?f.type=ve:f.removeAttribute("type"),y!=null?ve==="number"?(y===0&&f.value===""||f.value!=y)&&(f.value=""+jn(y)):f.value!==""+jn(y)&&(f.value=""+jn(y)):ve!=="submit"&&ve!=="reset"||f.removeAttribute("value"),y!=null?la(f,ve,jn(y)):E!=null?la(f,ve,jn(E)):P!=null&&f.removeAttribute("value"),W==null&&J!=null&&(f.defaultChecked=!!J),W!=null&&(f.checked=W&&typeof W!="function"&&typeof W!="symbol"),Xe!=null&&typeof Xe!="function"&&typeof Xe!="symbol"&&typeof Xe!="boolean"?f.name=""+jn(Xe):f.removeAttribute("name")}function as(f,y,E,P,W,J,ve,Xe){if(J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"&&(f.type=J),y!=null||E!=null){if(!(J!=="submit"&&J!=="reset"||y!=null)){Qr(f);return}E=E!=null?""+jn(E):"",y=y!=null?""+jn(y):E,Xe||y===f.value||(f.value=y),f.defaultValue=y}P=P??W,P=typeof P!="function"&&typeof P!="symbol"&&!!P,f.checked=Xe?f.checked:!!P,f.defaultChecked=!!P,ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"&&(f.name=ve),Qr(f)}function la(f,y,E){y==="number"&&qs(f.ownerDocument)===f||f.defaultValue===""+E||(f.defaultValue=""+E)}function xs(f,y,E,P){if(f=f.options,y){y={};for(var W=0;W<E.length;W++)y["$"+E[W]]=!0;for(E=0;E<f.length;E++)W=y.hasOwnProperty("$"+f[E].value),f[E].selected!==W&&(f[E].selected=W),W&&P&&(f[E].defaultSelected=!0)}else{for(E=""+jn(E),y=null,W=0;W<f.length;W++){if(f[W].value===E){f[W].selected=!0,P&&(f[W].defaultSelected=!0);return}y!==null||f[W].disabled||(y=f[W])}y!==null&&(y.selected=!0)}}function Ma(f,y,E){if(y!=null&&(y=""+jn(y),y!==f.value&&(f.value=y),E==null)){f.defaultValue!==y&&(f.defaultValue=y);return}f.defaultValue=E!=null?""+jn(E):""}function ma(f,y,E,P){if(y==null){if(P!=null){if(E!=null)throw Error(l(92));if(kt(P)){if(1<P.length)throw Error(l(93));P=P[0]}E=P}E==null&&(E=""),y=E}E=jn(y),f.defaultValue=E,P=f.textContent,P===E&&P!==""&&P!==null&&(f.value=P),Qr(f)}function Ul(f,y){if(y){var E=f.firstChild;if(E&&E===f.lastChild&&E.nodeType===3){E.nodeValue=y;return}}f.textContent=y}var wl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tf(f,y,E){var P=y.indexOf("--")===0;E==null||typeof E=="boolean"||E===""?P?f.setProperty(y,""):y==="float"?f.cssFloat="":f[y]="":P?f.setProperty(y,E):typeof E!="number"||E===0||wl.has(y)?y==="float"?f.cssFloat=E:f[y]=(""+E).trim():f[y]=E+"px"}function Jf(f,y,E){if(y!=null&&typeof y!="object")throw Error(l(62));if(f=f.style,E!=null){for(var P in E)!E.hasOwnProperty(P)||y!=null&&y.hasOwnProperty(P)||(P.indexOf("--")===0?f.setProperty(P,""):P==="float"?f.cssFloat="":f[P]="");for(var W in y)P=y[W],y.hasOwnProperty(W)&&E[W]!==P&&tf(f,W,P)}else for(var J in y)y.hasOwnProperty(J)&&tf(f,J,y[J])}function kl(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Cc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sl(f){return Cc.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}function Ka(){}var Vl=null;function iu(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var oc=null,nu=null;function wh(f){var y=ye(f);if(y&&(f=y.stateNode)){var E=f[ge]||null;e:switch(f=y.stateNode,y.type){case"input":if(qa(f,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name),y=E.name,E.type==="radio"&&y!=null){for(E=f;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll('input[name="'+Kr(""+y)+'"][type="radio"]'),y=0;y<E.length;y++){var P=E[y];if(P!==f&&P.form===f.form){var W=P[ge]||null;if(!W)throw Error(l(90));qa(P,W.value,W.defaultValue,W.defaultValue,W.checked,W.defaultChecked,W.type,W.name)}}for(y=0;y<E.length;y++)P=E[y],P.form===f.form&&kr(P)}break e;case"textarea":Ma(f,E.value,E.defaultValue);break e;case"select":y=E.value,y!=null&&xs(f,!!E.multiple,y,!1)}}}var Qf=!1;function Pm(f,y,E){if(Qf)return f(y,E);Qf=!0;try{var P=f(y);return P}finally{if(Qf=!1,(oc!==null||nu!==null)&&(We(),oc&&(y=oc,f=nu,nu=oc=null,wh(y),f)))for(y=0;y<f.length;y++)wh(f[y])}}function ru(f,y){var E=f.stateNode;if(E===null)return null;var P=E[ge]||null;if(P===null)return null;E=P[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(f=f.type,P=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!P;break e;default:f=!1}if(f)return null;if(E&&typeof E!="function")throw Error(l(231,y,typeof E));return E}var Na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ed=!1;if(Na)try{var su={};Object.defineProperty(su,"passive",{get:function(){ed=!0}}),window.addEventListener("test",su,su),window.removeEventListener("test",su,su)}catch{ed=!1}var il=null,zm=null,Sh=null;function nf(){if(Sh)return Sh;var f,y=zm,E=y.length,P,W="value"in il?il.value:il.textContent,J=W.length;for(f=0;f<E&&y[f]===W[f];f++);var ve=E-f;for(P=1;P<=ve&&y[E-P]===W[J-P];P++);return Sh=W.slice(f,1<P?1-P:void 0)}function wr(f){var y=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&y===13&&(f=13)):f=y,f===10&&(f=13),32<=f||f===13?f:0}function rf(){return!0}function Lp(){return!1}function qo(f){function y(E,P,W,J,ve){this._reactName=E,this._targetInst=W,this.type=P,this.nativeEvent=J,this.target=ve,this.currentTarget=null;for(var Xe in f)f.hasOwnProperty(Xe)&&(E=f[Xe],this[Xe]=E?E(J):J[Xe]);return this.isDefaultPrevented=(J.defaultPrevented!=null?J.defaultPrevented:J.returnValue===!1)?rf:Lp,this.isPropagationStopped=Lp,this}return N(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=rf)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=rf)},persist:function(){},isPersistent:rf}),y}var Th={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rc=qo(Th),Tl=N({},Th,{view:0,detail:0}),sf=qo(Tl),qd,af,Ml,Mh=N({},Tl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nu,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Ml&&(Ml&&f.type==="mousemove"?(qd=f.screenX-Ml.screenX,af=f.screenY-Ml.screenY):af=qd=0,Ml=f),qd)},movementY:function(f){return"movementY"in f?f.movementY:af}}),Om=qo(Mh),Da=N({},Mh,{dataTransfer:0}),of=qo(Da),Po=N({},Tl,{relatedTarget:0}),td=qo(Po),Xd=N({},Th,{animationName:0,elapsedTime:0,pseudoElement:0}),lc=qo(Xd),qr=N({},Th,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Bm=qo(qr),_g=N({},Th,{data:0}),Nm=qo(_g),Rn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},id={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cc(f){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(f):(f=id[f])?!!y[f]:!1}function Nu(){return cc}var uc=N({},Tl,{key:function(f){if(f.key){var y=Rn[f.key]||f.key;if(y!=="Unidentified")return y}return f.type==="keypress"?(f=wr(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Pp[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nu,charCode:function(f){return f.type==="keypress"?wr(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?wr(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),hn=qo(uc),Rr=N({},Mh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zr=qo(Rr),nl=N({},Tl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nu}),zo=qo(nl),Xr=N({},Th,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fm=qo(Xr),Wd=N({},Mh,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Ic=qo(Wd),ba=N({},Th,{newState:0,oldState:0}),ca=qo(ba),yg=[9,13,27,32],Gl=Na&&"CompositionEvent"in window,Fu=null;Na&&"documentMode"in document&&(Fu=document.documentMode);var au=Na&&"TextEvent"in window&&!Fu,uo=Na&&(!Gl||Fu&&8<Fu&&11>=Fu),nd=" ",Zd=!1;function xo(f,y){switch(f){case"keyup":return yg.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hl(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Fa=!1;function Uu(f,y){switch(f){case"compositionend":return Hl(y);case"keypress":return y.which!==32?null:(Zd=!0,nd);case"textInput":return f=y.data,f===nd&&Zd?null:f;default:return null}}function rd(f,y){if(Fa)return f==="compositionend"||!Gl&&xo(f,y)?(f=nf(),Sh=zm=il=null,Fa=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return uo&&y.locale!=="ko"?null:y.data;default:return null}}var Xs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jl(f){var y=f&&f.nodeName&&f.nodeName.toLowerCase();return y==="input"?!!Xs[f.type]:y==="textarea"}function Dc(f,y,E,P){oc?nu?nu.push(P):nu=[P]:oc=P,y=Oy(y,"onChange"),0<y.length&&(E=new Rc("onChange","change",null,E,P),f.push({event:E,listeners:y}))}var ua=null,lf=null;function hc(f){Iv(f,0)}function El(f){var y=it(f);if(kr(y))return f}function $n(f,y){if(f==="change")return y}var sn=!1;if(Na){var ku;if(Na){var fn="oninput"in document;if(!fn){var sd=document.createElement("div");sd.setAttribute("oninput","return;"),fn=typeof sd.oninput=="function"}ku=fn}else ku=!1;sn=ku&&(!document.documentMode||9<document.documentMode)}function zp(){ua&&(ua.detachEvent("onpropertychange",zn),lf=ua=null)}function zn(f){if(f.propertyName==="value"&&El(lf)){var y=[];Dc(y,lf,f,iu(f)),Pm(hc,y)}}function ql(f,y,E){f==="focusin"?(zp(),ua=y,lf=E,ua.attachEvent("onpropertychange",zn)):f==="focusout"&&zp()}function Vu(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return El(lf)}function Op(f,y){if(f==="click")return El(y)}function Xo(f,y){if(f==="input"||f==="change")return El(y)}function Gu(f,y){return f===y&&(f!==0||1/f===1/y)||f!==f&&y!==y}var ts=typeof Object.is=="function"?Object.is:Gu;function Eh(f,y){if(ts(f,y))return!0;if(typeof f!="object"||f===null||typeof y!="object"||y===null)return!1;var E=Object.keys(f),P=Object.keys(y);if(E.length!==P.length)return!1;for(P=0;P<E.length;P++){var W=E[P];if(!tn.call(y,W)||!ts(f[W],y[W]))return!1}return!0}function fc(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Bp(f,y){var E=fc(f);f=0;for(var P;E;){if(E.nodeType===3){if(P=f+E.textContent.length,f<=y&&P>=y)return{node:E,offset:y-f};f=P}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=fc(E)}}function ou(f,y){return f&&y?f===y?!0:f&&f.nodeType===3?!1:y&&y.nodeType===3?ou(f,y.parentNode):"contains"in f?f.contains(y):f.compareDocumentPosition?!!(f.compareDocumentPosition(y)&16):!1:!1}function Al(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var y=qs(f.document);y instanceof f.HTMLIFrameElement;){try{var E=typeof y.contentWindow.location.href=="string"}catch{E=!1}if(E)f=y.contentWindow;else break;y=qs(f.document)}return y}function Hu(f){var y=f&&f.nodeName&&f.nodeName.toLowerCase();return y&&(y==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||y==="textarea"||f.contentEditable==="true")}var r_=Na&&"documentMode"in document&&11>=document.documentMode,lu=null,cf=null,ju=null,$a=!1;function cu(f,y,E){var P=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;$a||lu==null||lu!==qs(P)||(P=lu,"selectionStart"in P&&Hu(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),ju&&Eh(ju,P)||(ju=P,P=Oy(cf,"onSelect"),0<P.length&&(y=new Rc("onSelect","select",null,y,E),f.push({event:y,listeners:P}),y.target=lu)))}function uf(f,y){var E={};return E[f.toLowerCase()]=y.toLowerCase(),E["Webkit"+f]="webkit"+y,E["Moz"+f]="moz"+y,E}var hf={animationend:uf("Animation","AnimationEnd"),animationiteration:uf("Animation","AnimationIteration"),animationstart:uf("Animation","AnimationStart"),transitionrun:uf("Transition","TransitionRun"),transitionstart:uf("Transition","TransitionStart"),transitioncancel:uf("Transition","TransitionCancel"),transitionend:uf("Transition","TransitionEnd")},Np={},rl={};Na&&(rl=document.createElement("div").style,"AnimationEvent"in window||(delete hf.animationend.animation,delete hf.animationiteration.animation,delete hf.animationstart.animation),"TransitionEvent"in window||delete hf.transitionend.transition);function Ah(f){if(Np[f])return Np[f];if(!hf[f])return f;var y=hf[f],E;for(E in y)if(y.hasOwnProperty(E)&&E in rl)return Np[f]=y[E];return f}var sl=Ah("animationend"),qu=Ah("animationiteration"),uu=Ah("animationstart"),ad=Ah("transitionrun"),hu=Ah("transitionstart"),Xu=Ah("transitioncancel"),ff=Ah("transitionend"),ho=new Map,Fp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Fp.push("scrollEnd");function Ja(f,y){ho.set(f,y),bi(y,[f])}var dc=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)},fo=[],Wu=0,al=0;function fu(){for(var f=Wu,y=al=Wu=0;y<f;){var E=fo[y];fo[y++]=null;var P=fo[y];fo[y++]=null;var W=fo[y];fo[y++]=null;var J=fo[y];if(fo[y++]=null,P!==null&&W!==null){var ve=P.pending;ve===null?W.next=W:(W.next=ve.next,ve.next=W),P.pending=W}J!==0&&od(E,W,J)}}function gi(f,y,E,P){fo[Wu++]=f,fo[Wu++]=y,fo[Wu++]=E,fo[Wu++]=P,al|=P,f.lanes|=P,f=f.alternate,f!==null&&(f.lanes|=P)}function df(f,y,E,P){return gi(f,y,E,P),pf(f)}function du(f,y){return gi(f,null,null,y),pf(f)}function od(f,y,E){f.lanes|=E;var P=f.alternate;P!==null&&(P.lanes|=E);for(var W=!1,J=f.return;J!==null;)J.childLanes|=E,P=J.alternate,P!==null&&(P.childLanes|=E),J.tag===22&&(f=J.stateNode,f===null||f._visibility&1||(W=!0)),f=J,J=J.return;return f.tag===3?(J=f.stateNode,W&&y!==null&&(W=31-Qn(E),f=J.hiddenUpdates,P=f[W],P===null?f[W]=[y]:P.push(y),y.lane=E|536870912),J):null}function pf(f){if(50<us)throw us=0,Nr=null,Error(l(185));for(var y=f.return;y!==null;)f=y,y=f.return;return f.tag===3?f.stateNode:null}var Lc={};function pu(f,y,E,P){this.tag=f,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wo(f,y,E,P){return new pu(f,y,E,P)}function Qa(f){return f=f.prototype,!(!f||!f.isReactComponent)}function ol(f,y){var E=f.alternate;return E===null?(E=Wo(f.tag,y,f.key,f.mode),E.elementType=f.elementType,E.type=f.type,E.stateNode=f.stateNode,E.alternate=f,f.alternate=E):(E.pendingProps=y,E.type=f.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=f.flags&65011712,E.childLanes=f.childLanes,E.lanes=f.lanes,E.child=f.child,E.memoizedProps=f.memoizedProps,E.memoizedState=f.memoizedState,E.updateQueue=f.updateQueue,y=f.dependencies,E.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},E.sibling=f.sibling,E.index=f.index,E.ref=f.ref,E.refCleanup=f.refCleanup,E}function Ua(f,y){f.flags&=65011714;var E=f.alternate;return E===null?(f.childLanes=0,f.lanes=y,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=E.childLanes,f.lanes=E.lanes,f.child=E.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=E.memoizedProps,f.memoizedState=E.memoizedState,f.updateQueue=E.updateQueue,f.type=E.type,y=E.dependencies,f.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext}),f}function mf(f,y,E,P,W,J){var ve=0;if(P=f,typeof f=="function")Qa(f)&&(ve=1);else if(typeof f=="string")ve=yE(f,E,ii.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case Ce:return f=Wo(31,E,y,W),f.elementType=Ce,f.lanes=J,f;case re:return Zu(E.children,W,J,y);case ie:ve=8,W|=24;break;case Y:return f=Wo(12,E,y,W|2),f.elementType=Y,f.lanes=J,f;case Ae:return f=Wo(13,E,y,W),f.elementType=Ae,f.lanes=J,f;case Se:return f=Wo(19,E,y,W),f.elementType=Se,f.lanes=J,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ue:ve=10;break e;case ae:ve=9;break e;case me:ve=11;break e;case ze:ve=14;break e;case je:ve=16,P=null;break e}ve=29,E=Error(l(130,f===null?"null":typeof f,"")),P=null}return y=Wo(ve,E,y,W),y.elementType=f,y.type=P,y.lanes=J,y}function Zu(f,y,E,P){return f=Wo(7,f,P,y),f.lanes=E,f}function ld(f,y,E){return f=Wo(6,f,null,y),f.lanes=E,f}function s_(f){var y=Wo(18,null,null,0);return y.stateNode=f,y}function Pc(f,y,E){return y=Wo(4,f.children!==null?f.children:[],f.key,y),y.lanes=E,y.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},y}var Up=new WeakMap;function eo(f,y){if(typeof f=="object"&&f!==null){var E=Up.get(f);return E!==void 0?E:(y={value:f,source:y,stack:Di(y)},Up.set(f,y),y)}return{value:f,source:y,stack:Di(y)}}var ur=[],cd=0,kp=null,Yd=0,Cl=[],Xl=0,ns=null,Yu=1,mu="";function gu(f,y){ur[cd++]=Yd,ur[cd++]=kp,kp=f,Yd=y}function Kd(f,y,E){Cl[Xl++]=Yu,Cl[Xl++]=mu,Cl[Xl++]=ns,ns=f;var P=Yu;f=mu;var W=32-Qn(P)-1;P&=~(1<<W),E+=1;var J=32-Qn(y)+W;if(30<J){var ve=W-W%5;J=(P&(1<<ve)-1).toString(32),P>>=ve,W-=ve,Yu=1<<32-Qn(y)+W|E<<W|P,mu=J+f}else Yu=1<<J|E<<W|P,mu=f}function $d(f){f.return!==null&&(gu(f,1),Kd(f,1,0))}function Wl(f){for(;f===kp;)kp=ur[--cd],ur[cd]=null,Yd=ur[--cd],ur[cd]=null;for(;f===ns;)ns=Cl[--Xl],Cl[Xl]=null,mu=Cl[--Xl],Cl[Xl]=null,Yu=Cl[--Xl],Cl[Xl]=null}function Ku(f,y){Cl[Xl++]=Yu,Cl[Xl++]=mu,Cl[Xl++]=ns,Yu=y.id,mu=y.overflow,ns=f}var Xa=null,ea=null,zs=!1,_u=null,vo=!1,Ch=Error(l(519));function ws(f){var y=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Jd(eo(y,f)),Ch}function ud(f){var y=f.stateNode,E=f.type,P=f.memoizedProps;switch(y[oe]=f,y[ge]=P,E){case"dialog":Zs("cancel",y),Zs("close",y);break;case"iframe":case"object":case"embed":Zs("load",y);break;case"video":case"audio":for(E=0;E<f_.length;E++)Zs(f_[E],y);break;case"source":Zs("error",y);break;case"img":case"image":case"link":Zs("error",y),Zs("load",y);break;case"details":Zs("toggle",y);break;case"input":Zs("invalid",y),as(y,P.value,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name,!0);break;case"select":Zs("invalid",y);break;case"textarea":Zs("invalid",y),ma(y,P.value,P.defaultValue,P.children)}E=P.children,typeof E!="string"&&typeof E!="number"&&typeof E!="bigint"||y.textContent===""+E||P.suppressHydrationWarning===!0||p_(y.textContent,E)?(P.popover!=null&&(Zs("beforetoggle",y),Zs("toggle",y)),P.onScroll!=null&&Zs("scroll",y),P.onScrollEnd!=null&&Zs("scrollend",y),P.onClick!=null&&(y.onclick=Ka),y=!0):y=!1,y||ws(f,!0)}function Um(f){for(Xa=f.return;Xa;)switch(Xa.tag){case 5:case 31:case 13:vo=!1;return;case 27:case 3:vo=!0;return;default:Xa=Xa.return}}function $u(f){if(f!==Xa)return!1;if(!zs)return Um(f),zs=!0,!1;var y=f.tag,E;if((E=y!==3&&y!==27)&&((E=y===5)&&(E=f.type,E=!(E!=="form"&&E!=="button")||Ov(f.type,f.memoizedProps)),E=!E),E&&ea&&ws(f),Um(f),y===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(l(317));ea=Nv(f)}else if(y===31){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(l(317));ea=Nv(f)}else y===27?(y=ea,sm(f.type)?(f=Sc,Sc=null,ea=f):ea=y):ea=Xa?Bf(f.stateNode.nextSibling):null;return!0}function yu(){ea=Xa=null,zs=!1}function km(){var f=_u;return f!==null&&(an===null?an=f:an.push.apply(an,f),_u=null),f}function Jd(f){_u===null?_u=[f]:_u.push(f)}var Vm=Ge(null),Zl=null,Zo=null;function Rh(f,y,E){Vt(Vm,y._currentValue),y._currentValue=E}function zc(f){f._currentValue=Vm.current,Et(Vm)}function Ih(f,y,E){for(;f!==null;){var P=f.alternate;if((f.childLanes&y)!==y?(f.childLanes|=y,P!==null&&(P.childLanes|=y)):P!==null&&(P.childLanes&y)!==y&&(P.childLanes|=y),f===E)break;f=f.return}}function Qd(f,y,E,P){var W=f.child;for(W!==null&&(W.return=f);W!==null;){var J=W.dependencies;if(J!==null){var ve=W.child;J=J.firstContext;e:for(;J!==null;){var Xe=J;J=W;for(var Ct=0;Ct<y.length;Ct++)if(Xe.context===y[Ct]){J.lanes|=E,Xe=J.alternate,Xe!==null&&(Xe.lanes|=E),Ih(J.return,E,f),P||(ve=null);break e}J=Xe.next}}else if(W.tag===18){if(ve=W.return,ve===null)throw Error(l(341));ve.lanes|=E,J=ve.alternate,J!==null&&(J.lanes|=E),Ih(ve,E,f),ve=null}else ve=W.child;if(ve!==null)ve.return=W;else for(ve=W;ve!==null;){if(ve===f){ve=null;break}if(W=ve.sibling,W!==null){W.return=ve.return,ve=W;break}ve=ve.return}W=ve}}function Ju(f,y,E,P){f=null;for(var W=y,J=!1;W!==null;){if(!J){if((W.flags&524288)!==0)J=!0;else if((W.flags&262144)!==0)break}if(W.tag===10){var ve=W.alternate;if(ve===null)throw Error(l(387));if(ve=ve.memoizedProps,ve!==null){var Xe=W.type;ts(W.pendingProps.value,ve.value)||(f!==null?f.push(Xe):f=[Xe])}}else if(W===xi.current){if(ve=W.alternate,ve===null)throw Error(l(387));ve.memoizedState.memoizedState!==W.memoizedState.memoizedState&&(f!==null?f.push(T0):f=[T0])}W=W.return}f!==null&&Qd(y,f,E,P),y.flags|=262144}function gf(f){for(f=f.firstContext;f!==null;){if(!ts(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function Dh(f){Zl=f,Zo=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function bo(f){return ep(Zl,f)}function _f(f,y){return Zl===null&&Dh(f),ep(f,y)}function ep(f,y){var E=y._currentValue;if(y={context:y,memoizedValue:E,next:null},Zo===null){if(f===null)throw Error(l(308));Zo=y,f.dependencies={lanes:0,firstContext:y},f.flags|=524288}else Zo=Zo.next=y;return E}var hd=typeof AbortController<"u"?AbortController:function(){var f=[],y=this.signal={aborted:!1,addEventListener:function(E,P){f.push(P)}};this.abort=function(){y.aborted=!0,f.forEach(function(E){return E()})}},tp=n.unstable_scheduleCallback,Gm=n.unstable_NormalPriority,nr={$$typeof:ue,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ip(){return{controller:new hd,data:new Map,refCount:0}}function to(f){f.refCount--,f.refCount===0&&tp(Gm,function(){f.controller.abort()})}var Rl=null,np=0,Oc=0,pc=null;function xu(f,y){if(Rl===null){var E=Rl=[];np=0,Oc=Py(),pc={status:"pending",value:void 0,then:function(P){E.push(P)}}}return np++,y.then(fd,fd),y}function fd(){if(--np===0&&Rl!==null){pc!==null&&(pc.status="fulfilled");var f=Rl;Rl=null,Oc=0,pc=null;for(var y=0;y<f.length;y++)(0,f[y])()}}function dd(f,y){var E=[],P={status:"pending",value:null,reason:null,then:function(W){E.push(W)}};return f.then(function(){P.status="fulfilled",P.value=y;for(var W=0;W<E.length;W++)(0,E[W])(y)},function(W){for(P.status="rejected",P.reason=W,W=0;W<E.length;W++)(0,E[W])(void 0)}),P}var Vp=Re.S;Re.S=function(f,y){Lr=De(),typeof y=="object"&&y!==null&&typeof y.then=="function"&&xu(f,y),Vp!==null&&Vp(f,y)};var Qu=Ge(null);function Bc(){var f=Qu.current;return f!==null?f:xt.pooledCache}function yf(f,y){y===null?Vt(Qu,Qu.current):Vt(Qu,y.pool)}function Lh(){var f=Bc();return f===null?null:{parent:nr._currentValue,pool:f}}var xf=Error(l(460)),Gp=Error(l(474)),Nc=Error(l(542)),rp={then:function(){}};function Hp(f){return f=f.status,f==="fulfilled"||f==="rejected"}function xg(f,y,E){switch(E=f[E],E===void 0?f.push(y):E!==y&&(y.then(Ka,Ka),y=E),y.status){case"fulfilled":return y.value;case"rejected":throw f=y.reason,vf(f),f;default:if(typeof y.status=="string")y.then(Ka,Ka);else{if(f=xt,f!==null&&100<f.shellSuspendCounter)throw Error(l(482));f=y,f.status="pending",f.then(function(P){if(y.status==="pending"){var W=y;W.status="fulfilled",W.value=P}},function(P){if(y.status==="pending"){var W=y;W.status="rejected",W.reason=P}})}switch(y.status){case"fulfilled":return y.value;case"rejected":throw f=y.reason,vf(f),f}throw Vr=y,xf}}function eh(f){try{var y=f._init;return y(f._payload)}catch(E){throw E!==null&&typeof E=="object"&&typeof E.then=="function"?(Vr=E,xf):E}}var Vr=null;function jp(){if(Vr===null)throw Error(l(459));var f=Vr;return Vr=null,f}function vf(f){if(f===xf||f===Nc)throw Error(l(483))}var th=null,ih=0;function qp(f){var y=ih;return ih+=1,th===null&&(th=[]),xg(th,f,y)}function pd(f,y){y=y.props.ref,f.ref=y!==void 0?y:null}function Fc(f,y){throw y.$$typeof===k?Error(l(525)):(f=Object.prototype.toString.call(y),Error(l(31,f==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":f)))}function Uc(f){function y(Jt,Nt){if(f){var di=Jt.deletions;di===null?(Jt.deletions=[Nt],Jt.flags|=16):di.push(Nt)}}function E(Jt,Nt){if(!f)return null;for(;Nt!==null;)y(Jt,Nt),Nt=Nt.sibling;return null}function P(Jt){for(var Nt=new Map;Jt!==null;)Jt.key!==null?Nt.set(Jt.key,Jt):Nt.set(Jt.index,Jt),Jt=Jt.sibling;return Nt}function W(Jt,Nt){return Jt=ol(Jt,Nt),Jt.index=0,Jt.sibling=null,Jt}function J(Jt,Nt,di){return Jt.index=di,f?(di=Jt.alternate,di!==null?(di=di.index,di<Nt?(Jt.flags|=67108866,Nt):di):(Jt.flags|=67108866,Nt)):(Jt.flags|=1048576,Nt)}function ve(Jt){return f&&Jt.alternate===null&&(Jt.flags|=67108866),Jt}function Xe(Jt,Nt,di,en){return Nt===null||Nt.tag!==6?(Nt=ld(di,Jt.mode,en),Nt.return=Jt,Nt):(Nt=W(Nt,di),Nt.return=Jt,Nt)}function Ct(Jt,Nt,di,en){var Fr=di.type;return Fr===re?Hi(Jt,Nt,di.props.children,en,di.key):Nt!==null&&(Nt.elementType===Fr||typeof Fr=="object"&&Fr!==null&&Fr.$$typeof===je&&eh(Fr)===Nt.type)?(Nt=W(Nt,di.props),pd(Nt,di),Nt.return=Jt,Nt):(Nt=mf(di.type,di.key,di.props,null,Jt.mode,en),pd(Nt,di),Nt.return=Jt,Nt)}function _i(Jt,Nt,di,en){return Nt===null||Nt.tag!==4||Nt.stateNode.containerInfo!==di.containerInfo||Nt.stateNode.implementation!==di.implementation?(Nt=Pc(di,Jt.mode,en),Nt.return=Jt,Nt):(Nt=W(Nt,di.children||[]),Nt.return=Jt,Nt)}function Hi(Jt,Nt,di,en,Fr){return Nt===null||Nt.tag!==7?(Nt=Zu(di,Jt.mode,en,Fr),Nt.return=Jt,Nt):(Nt=W(Nt,di),Nt.return=Jt,Nt)}function nn(Jt,Nt,di){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number"||typeof Nt=="bigint")return Nt=ld(""+Nt,Jt.mode,di),Nt.return=Jt,Nt;if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case j:return di=mf(Nt.type,Nt.key,Nt.props,null,Jt.mode,di),pd(di,Nt),di.return=Jt,di;case $:return Nt=Pc(Nt,Jt.mode,di),Nt.return=Jt,Nt;case je:return Nt=eh(Nt),nn(Jt,Nt,di)}if(kt(Nt)||Mt(Nt))return Nt=Zu(Nt,Jt.mode,di,null),Nt.return=Jt,Nt;if(typeof Nt.then=="function")return nn(Jt,qp(Nt),di);if(Nt.$$typeof===ue)return nn(Jt,_f(Jt,Nt),di);Fc(Jt,Nt)}return null}function wi(Jt,Nt,di,en){var Fr=Nt!==null?Nt.key:null;if(typeof di=="string"&&di!==""||typeof di=="number"||typeof di=="bigint")return Fr!==null?null:Xe(Jt,Nt,""+di,en);if(typeof di=="object"&&di!==null){switch(di.$$typeof){case j:return di.key===Fr?Ct(Jt,Nt,di,en):null;case $:return di.key===Fr?_i(Jt,Nt,di,en):null;case je:return di=eh(di),wi(Jt,Nt,di,en)}if(kt(di)||Mt(di))return Fr!==null?null:Hi(Jt,Nt,di,en,null);if(typeof di.then=="function")return wi(Jt,Nt,qp(di),en);if(di.$$typeof===ue)return wi(Jt,Nt,_f(Jt,di),en);Fc(Jt,di)}return null}function Ci(Jt,Nt,di,en,Fr){if(typeof en=="string"&&en!==""||typeof en=="number"||typeof en=="bigint")return Jt=Jt.get(di)||null,Xe(Nt,Jt,""+en,Fr);if(typeof en=="object"&&en!==null){switch(en.$$typeof){case j:return Jt=Jt.get(en.key===null?di:en.key)||null,Ct(Nt,Jt,en,Fr);case $:return Jt=Jt.get(en.key===null?di:en.key)||null,_i(Nt,Jt,en,Fr);case je:return en=eh(en),Ci(Jt,Nt,di,en,Fr)}if(kt(en)||Mt(en))return Jt=Jt.get(di)||null,Hi(Nt,Jt,en,Fr,null);if(typeof en.then=="function")return Ci(Jt,Nt,di,qp(en),Fr);if(en.$$typeof===ue)return Ci(Jt,Nt,di,_f(Nt,en),Fr);Fc(Nt,en)}return null}function mr(Jt,Nt,di,en){for(var Fr=null,aa=null,Tr=Nt,Ds=Nt=0,Vs=null;Tr!==null&&Ds<di.length;Ds++){Tr.index>Ds?(Vs=Tr,Tr=null):Vs=Tr.sibling;var da=wi(Jt,Tr,di[Ds],en);if(da===null){Tr===null&&(Tr=Vs);break}f&&Tr&&da.alternate===null&&y(Jt,Tr),Nt=J(da,Nt,Ds),aa===null?Fr=da:aa.sibling=da,aa=da,Tr=Vs}if(Ds===di.length)return E(Jt,Tr),zs&&gu(Jt,Ds),Fr;if(Tr===null){for(;Ds<di.length;Ds++)Tr=nn(Jt,di[Ds],en),Tr!==null&&(Nt=J(Tr,Nt,Ds),aa===null?Fr=Tr:aa.sibling=Tr,aa=Tr);return zs&&gu(Jt,Ds),Fr}for(Tr=P(Tr);Ds<di.length;Ds++)Vs=Ci(Tr,Jt,Ds,di[Ds],en),Vs!==null&&(f&&Vs.alternate!==null&&Tr.delete(Vs.key===null?Ds:Vs.key),Nt=J(Vs,Nt,Ds),aa===null?Fr=Vs:aa.sibling=Vs,aa=Vs);return f&&Tr.forEach(function(Ff){return y(Jt,Ff)}),zs&&gu(Jt,Ds),Fr}function Cr(Jt,Nt,di,en){if(di==null)throw Error(l(151));for(var Fr=null,aa=null,Tr=Nt,Ds=Nt=0,Vs=null,da=di.next();Tr!==null&&!da.done;Ds++,da=di.next()){Tr.index>Ds?(Vs=Tr,Tr=null):Vs=Tr.sibling;var Ff=wi(Jt,Tr,da.value,en);if(Ff===null){Tr===null&&(Tr=Vs);break}f&&Tr&&Ff.alternate===null&&y(Jt,Tr),Nt=J(Ff,Nt,Ds),aa===null?Fr=Ff:aa.sibling=Ff,aa=Ff,Tr=Vs}if(da.done)return E(Jt,Tr),zs&&gu(Jt,Ds),Fr;if(Tr===null){for(;!da.done;Ds++,da=di.next())da=nn(Jt,da.value,en),da!==null&&(Nt=J(da,Nt,Ds),aa===null?Fr=da:aa.sibling=da,aa=da);return zs&&gu(Jt,Ds),Fr}for(Tr=P(Tr);!da.done;Ds++,da=di.next())da=Ci(Tr,Jt,Ds,da.value,en),da!==null&&(f&&da.alternate!==null&&Tr.delete(da.key===null?Ds:da.key),Nt=J(da,Nt,Ds),aa===null?Fr=da:aa.sibling=da,aa=da);return f&&Tr.forEach(function(Kw){return y(Jt,Kw)}),zs&&gu(Jt,Ds),Fr}function sa(Jt,Nt,di,en){if(typeof di=="object"&&di!==null&&di.type===re&&di.key===null&&(di=di.props.children),typeof di=="object"&&di!==null){switch(di.$$typeof){case j:e:{for(var Fr=di.key;Nt!==null;){if(Nt.key===Fr){if(Fr=di.type,Fr===re){if(Nt.tag===7){E(Jt,Nt.sibling),en=W(Nt,di.props.children),en.return=Jt,Jt=en;break e}}else if(Nt.elementType===Fr||typeof Fr=="object"&&Fr!==null&&Fr.$$typeof===je&&eh(Fr)===Nt.type){E(Jt,Nt.sibling),en=W(Nt,di.props),pd(en,di),en.return=Jt,Jt=en;break e}E(Jt,Nt);break}else y(Jt,Nt);Nt=Nt.sibling}di.type===re?(en=Zu(di.props.children,Jt.mode,en,di.key),en.return=Jt,Jt=en):(en=mf(di.type,di.key,di.props,null,Jt.mode,en),pd(en,di),en.return=Jt,Jt=en)}return ve(Jt);case $:e:{for(Fr=di.key;Nt!==null;){if(Nt.key===Fr)if(Nt.tag===4&&Nt.stateNode.containerInfo===di.containerInfo&&Nt.stateNode.implementation===di.implementation){E(Jt,Nt.sibling),en=W(Nt,di.children||[]),en.return=Jt,Jt=en;break e}else{E(Jt,Nt);break}else y(Jt,Nt);Nt=Nt.sibling}en=Pc(di,Jt.mode,en),en.return=Jt,Jt=en}return ve(Jt);case je:return di=eh(di),sa(Jt,Nt,di,en)}if(kt(di))return mr(Jt,Nt,di,en);if(Mt(di)){if(Fr=Mt(di),typeof Fr!="function")throw Error(l(150));return di=Fr.call(di),Cr(Jt,Nt,di,en)}if(typeof di.then=="function")return sa(Jt,Nt,qp(di),en);if(di.$$typeof===ue)return sa(Jt,Nt,_f(Jt,di),en);Fc(Jt,di)}return typeof di=="string"&&di!==""||typeof di=="number"||typeof di=="bigint"?(di=""+di,Nt!==null&&Nt.tag===6?(E(Jt,Nt.sibling),en=W(Nt,di),en.return=Jt,Jt=en):(E(Jt,Nt),en=ld(di,Jt.mode,en),en.return=Jt,Jt=en),ve(Jt)):E(Jt,Nt)}return function(Jt,Nt,di,en){try{ih=0;var Fr=sa(Jt,Nt,di,en);return th=null,Fr}catch(Tr){if(Tr===xf||Tr===Nc)throw Tr;var aa=Wo(29,Tr,null,Jt.mode);return aa.lanes=en,aa.return=Jt,aa}finally{}}}var nh=Uc(!0),vg=Uc(!1),Il=!1;function Xp(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function md(f,y){f=f.updateQueue,y.updateQueue===f&&(y.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function vu(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function rh(f,y,E){var P=f.updateQueue;if(P===null)return null;if(P=P.shared,(_t&2)!==0){var W=P.pending;return W===null?y.next=y:(y.next=W.next,W.next=y),P.pending=y,y=pf(f),od(f,null,E),y}return gi(f,P,y,E),pf(f)}function bu(f,y,E){if(y=y.updateQueue,y!==null&&(y=y.shared,(E&4194048)!==0)){var P=y.lanes;P&=f.pendingLanes,E|=P,y.lanes=E,ac(f,E)}}function gd(f,y){var E=f.updateQueue,P=f.alternate;if(P!==null&&(P=P.updateQueue,E===P)){var W=null,J=null;if(E=E.firstBaseUpdate,E!==null){do{var ve={lane:E.lane,tag:E.tag,payload:E.payload,callback:null,next:null};J===null?W=J=ve:J=J.next=ve,E=E.next}while(E!==null);J===null?W=J=y:J=J.next=y}else W=J=y;E={baseState:P.baseState,firstBaseUpdate:W,lastBaseUpdate:J,shared:P.shared,callbacks:P.callbacks},f.updateQueue=E;return}f=E.lastBaseUpdate,f===null?E.firstBaseUpdate=y:f.next=y,E.lastBaseUpdate=y}var Hm=!1;function sp(){if(Hm){var f=pc;if(f!==null)throw f}}function ll(f,y,E,P){Hm=!1;var W=f.updateQueue;Il=!1;var J=W.firstBaseUpdate,ve=W.lastBaseUpdate,Xe=W.shared.pending;if(Xe!==null){W.shared.pending=null;var Ct=Xe,_i=Ct.next;Ct.next=null,ve===null?J=_i:ve.next=_i,ve=Ct;var Hi=f.alternate;Hi!==null&&(Hi=Hi.updateQueue,Xe=Hi.lastBaseUpdate,Xe!==ve&&(Xe===null?Hi.firstBaseUpdate=_i:Xe.next=_i,Hi.lastBaseUpdate=Ct))}if(J!==null){var nn=W.baseState;ve=0,Hi=_i=Ct=null,Xe=J;do{var wi=Xe.lane&-536870913,Ci=wi!==Xe.lane;if(Ci?(Ft&wi)===wi:(P&wi)===wi){wi!==0&&wi===Oc&&(Hm=!0),Hi!==null&&(Hi=Hi.next={lane:0,tag:Xe.tag,payload:Xe.payload,callback:null,next:null});e:{var mr=f,Cr=Xe;wi=y;var sa=E;switch(Cr.tag){case 1:if(mr=Cr.payload,typeof mr=="function"){nn=mr.call(sa,nn,wi);break e}nn=mr;break e;case 3:mr.flags=mr.flags&-65537|128;case 0:if(mr=Cr.payload,wi=typeof mr=="function"?mr.call(sa,nn,wi):mr,wi==null)break e;nn=N({},nn,wi);break e;case 2:Il=!0}}wi=Xe.callback,wi!==null&&(f.flags|=64,Ci&&(f.flags|=8192),Ci=W.callbacks,Ci===null?W.callbacks=[wi]:Ci.push(wi))}else Ci={lane:wi,tag:Xe.tag,payload:Xe.payload,callback:Xe.callback,next:null},Hi===null?(_i=Hi=Ci,Ct=nn):Hi=Hi.next=Ci,ve|=wi;if(Xe=Xe.next,Xe===null){if(Xe=W.shared.pending,Xe===null)break;Ci=Xe,Xe=Ci.next,Ci.next=null,W.lastBaseUpdate=Ci,W.shared.pending=null}}while(!0);Hi===null&&(Ct=nn),W.baseState=Ct,W.firstBaseUpdate=_i,W.lastBaseUpdate=Hi,J===null&&(W.shared.lanes=0),ni|=ve,f.lanes=ve,f.memoizedState=nn}}function sh(f,y){if(typeof f!="function")throw Error(l(191,f));f.call(y)}function Yo(f,y){var E=f.callbacks;if(E!==null)for(f.callbacks=null,f=0;f<E.length;f++)sh(E[f],y)}var Yl=Ge(null),cl=Ge(0);function ap(f,y){f=ei,Vt(cl,f),Vt(Yl,y),ei=f|y.baseLanes}function _d(){Vt(cl,ei),Vt(Yl,Yl.current)}function ka(){ei=cl.current,Et(Yl),Et(cl)}var La=Ge(null),Oo=null;function ah(f){var y=f.alternate;Vt(Va,Va.current&1),Vt(La,f),Oo===null&&(y===null||Yl.current!==null||y.memoizedState!==null)&&(Oo=f)}function op(f){Vt(Va,Va.current),Vt(La,f),Oo===null&&(Oo=f)}function kc(f){f.tag===22?(Vt(Va,Va.current),Vt(La,f),Oo===null&&(Oo=f)):wu()}function wu(){Vt(Va,Va.current),Vt(La,La.current)}function Kl(f){Et(La),Oo===f&&(Oo=null),Et(Va)}var Va=Ge(0);function Ph(f){for(var y=f;y!==null;){if(y.tag===13){var E=y.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||x0(E)||ky(E)))return y}else if(y.tag===19&&(y.memoizedProps.revealOrder==="forwards"||y.memoizedProps.revealOrder==="backwards"||y.memoizedProps.revealOrder==="unstable_legacy-backwards"||y.memoizedProps.revealOrder==="together")){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var po=0,oi=null,Js=null,ha=null,Su=!1,gn=!1,Tu=!1,lp=0,cp=0,mc=null,jm=0;function Ea(){throw Error(l(321))}function Wp(f,y){if(y===null)return!1;for(var E=0;E<y.length&&E<f.length;E++)if(!ts(f[E],y[E]))return!1;return!0}function Mu(f,y,E,P,W,J){return po=J,oi=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,Re.H=f===null||f.memoizedState===null?Jl:Uh,Tu=!1,J=E(P,W),Tu=!1,gn&&(J=Dl(y,E,P,W)),a_(f),J}function a_(f){Re.H=Af;var y=Js!==null&&Js.next!==null;if(po=0,ha=Js=oi=null,Su=!1,cp=0,mc=null,y)throw Error(l(300));f===null||ga||(f=f.dependencies,f!==null&&gf(f)&&(ga=!0))}function Dl(f,y,E,P){oi=f;var W=0;do{if(gn&&(mc=null),cp=0,gn=!1,25<=W)throw Error(l(301));if(W+=1,ha=Js=null,f.updateQueue!=null){var J=f.updateQueue;J.lastEffect=null,J.events=null,J.stores=null,J.memoCache!=null&&(J.memoCache.index=0)}Re.H=Cf,J=y(E,P)}while(gn);return J}function bg(){var f=Re.H,y=f.useState()[0];return y=typeof y.then=="function"?up(y):y,f=f.useState()[0],(Js!==null?Js.memoizedState:null)!==f&&(oi.flags|=1024),y}function Bo(){var f=lp!==0;return lp=0,f}function Eu(f,y,E){y.updateQueue=f.updateQueue,y.flags&=-2053,f.lanes&=~E}function yd(f){if(Su){for(f=f.memoizedState;f!==null;){var y=f.queue;y!==null&&(y.pending=null),f=f.next}Su=!1}po=0,ha=Js=oi=null,gn=!1,cp=lp=0,mc=null}function No(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ha===null?oi.memoizedState=ha=f:ha=ha.next=f,ha}function Pa(){if(Js===null){var f=oi.alternate;f=f!==null?f.memoizedState:null}else f=Js.next;var y=ha===null?oi.memoizedState:ha.next;if(y!==null)ha=y,Js=f;else{if(f===null)throw oi.alternate===null?Error(l(467)):Error(l(310));Js=f,f={memoizedState:Js.memoizedState,baseState:Js.baseState,baseQueue:Js.baseQueue,queue:Js.queue,next:null},ha===null?oi.memoizedState=ha=f:ha=ha.next=f}return ha}function zh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function up(f){var y=cp;return cp+=1,mc===null&&(mc=[]),f=xg(mc,f,y),y=oi,(ha===null?y.memoizedState:ha.next)===null&&(y=y.alternate,Re.H=y===null||y.memoizedState===null?Jl:Uh),f}function Vc(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return up(f);if(f.$$typeof===ue)return bo(f)}throw Error(l(438,String(f)))}function ms(f){var y=null,E=oi.updateQueue;if(E!==null&&(y=E.memoCache),y==null){var P=oi.alternate;P!==null&&(P=P.updateQueue,P!==null&&(P=P.memoCache,P!=null&&(y={data:P.data.map(function(W){return W.slice()}),index:0})))}if(y==null&&(y={data:[],index:0}),E===null&&(E=zh(),oi.updateQueue=E),E.memoCache=y,E=y.data[y.index],E===void 0)for(E=y.data[y.index]=Array(f),P=0;P<f;P++)E[P]=Te;return y.index++,E}function Gc(f,y){return typeof y=="function"?y(f):y}function hp(f){var y=Pa();return qm(y,Js,f)}function qm(f,y,E){var P=f.queue;if(P===null)throw Error(l(311));P.lastRenderedReducer=E;var W=f.baseQueue,J=P.pending;if(J!==null){if(W!==null){var ve=W.next;W.next=J.next,J.next=ve}y.baseQueue=W=J,P.pending=null}if(J=f.baseState,W===null)f.memoizedState=J;else{y=W.next;var Xe=ve=null,Ct=null,_i=y,Hi=!1;do{var nn=_i.lane&-536870913;if(nn!==_i.lane?(Ft&nn)===nn:(po&nn)===nn){var wi=_i.revertLane;if(wi===0)Ct!==null&&(Ct=Ct.next={lane:0,revertLane:0,gesture:null,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null}),nn===Oc&&(Hi=!0);else if((po&wi)===wi){_i=_i.next,wi===Oc&&(Hi=!0);continue}else nn={lane:0,revertLane:_i.revertLane,gesture:null,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null},Ct===null?(Xe=Ct=nn,ve=J):Ct=Ct.next=nn,oi.lanes|=wi,ni|=wi;nn=_i.action,Tu&&E(J,nn),J=_i.hasEagerState?_i.eagerState:E(J,nn)}else wi={lane:nn,revertLane:_i.revertLane,gesture:_i.gesture,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null},Ct===null?(Xe=Ct=wi,ve=J):Ct=Ct.next=wi,oi.lanes|=nn,ni|=nn;_i=_i.next}while(_i!==null&&_i!==y);if(Ct===null?ve=J:Ct.next=Xe,!ts(J,f.memoizedState)&&(ga=!0,Hi&&(E=pc,E!==null)))throw E;f.memoizedState=J,f.baseState=ve,f.baseQueue=Ct,P.lastRenderedState=J}return W===null&&(P.lanes=0),[f.memoizedState,P.dispatch]}function Zp(f){var y=Pa(),E=y.queue;if(E===null)throw Error(l(311));E.lastRenderedReducer=f;var P=E.dispatch,W=E.pending,J=y.memoizedState;if(W!==null){E.pending=null;var ve=W=W.next;do J=f(J,ve.action),ve=ve.next;while(ve!==W);ts(J,y.memoizedState)||(ga=!0),y.memoizedState=J,y.baseQueue===null&&(y.baseState=J),E.lastRenderedState=J}return[J,P]}function Xm(f,y,E){var P=oi,W=Pa(),J=zs;if(J){if(E===void 0)throw Error(l(407));E=E()}else E=y();var ve=!ts((Js||W).memoizedState,E);if(ve&&(W.memoizedState=E,ga=!0),W=W.queue,gc(Bh.bind(null,P,W,f),[f]),W.getSnapshot!==y||ve||ha!==null&&ha.memoizedState.tag&1){if(P.flags|=2048,Nh(9,{destroy:void 0},Oh.bind(null,P,W,E,y),null),xt===null)throw Error(l(349));J||(po&127)!==0||wg(P,y,E)}return E}function wg(f,y,E){f.flags|=16384,f={getSnapshot:y,value:E},y=oi.updateQueue,y===null?(y=zh(),oi.updateQueue=y,y.stores=[f]):(E=y.stores,E===null?y.stores=[f]:E.push(f))}function Oh(f,y,E,P){y.value=E,y.getSnapshot=P,fi(y)&&Mi(f)}function Bh(f,y,E){return E(function(){fi(y)&&Mi(f)})}function fi(f){var y=f.getSnapshot;f=f.value;try{var E=y();return!ts(f,E)}catch{return!0}}function Mi(f){var y=du(f,2);y!==null&&T(y,f,2)}function Au(f){var y=No();if(typeof f=="function"){var E=f;if(f=E(),Tu){Xn(!0);try{E()}finally{Xn(!1)}}}return y.memoizedState=y.baseState=f,y.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:f},y}function Ys(f,y,E,P){return f.baseState=E,qm(f,Js,typeof P=="function"?P:Gc)}function dt(f,y,E,P,W){if(Ru(f))throw Error(l(485));if(f=y.action,f!==null){var J={payload:W,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ve){J.listeners.push(ve)}};Re.T!==null?E(!0):J.isTransition=!1,P(J),E=y.pending,E===null?(J.next=y.pending=J,Sg(y,J)):(J.next=E.next,y.pending=E.next=J)}}function Sg(f,y){var E=y.action,P=y.payload,W=f.state;if(y.isTransition){var J=Re.T,ve={};Re.T=ve;try{var Xe=E(W,P),Ct=Re.S;Ct!==null&&Ct(ve,Xe),Yp(f,y,Xe)}catch(_i){xd(f,y,_i)}finally{J!==null&&ve.types!==null&&(J.types=ve.types),Re.T=J}}else try{J=E(W,P),Yp(f,y,J)}catch(_i){xd(f,y,_i)}}function Yp(f,y,E){E!==null&&typeof E=="object"&&typeof E.then=="function"?E.then(function(P){Hc(f,y,P)},function(P){return xd(f,y,P)}):Hc(f,y,E)}function Hc(f,y,E){y.status="fulfilled",y.value=E,bf(y),f.state=E,y=f.pending,y!==null&&(E=y.next,E===y?f.pending=null:(E=E.next,y.next=E,Sg(f,E)))}function xd(f,y,E){var P=f.pending;if(f.pending=null,P!==null){P=P.next;do y.status="rejected",y.reason=E,bf(y),y=y.next;while(y!==P)}f.action=null}function bf(f){f=f.listeners;for(var y=0;y<f.length;y++)(0,f[y])()}function Tg(f,y){return y}function vd(f,y){if(zs){var E=xt.formState;if(E!==null){e:{var P=oi;if(zs){if(ea){t:{for(var W=ea,J=vo;W.nodeType!==8;){if(!J){W=null;break t}if(W=Bf(W.nextSibling),W===null){W=null;break t}}J=W.data,W=J==="F!"||J==="F"?W:null}if(W){ea=Bf(W.nextSibling),P=W.data==="F!";break e}}ws(P)}P=!1}P&&(y=E[0])}}return E=No(),E.memoizedState=E.baseState=y,P={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tg,lastRenderedState:y},E.queue=P,E=ul.bind(null,oi,P),P.dispatch=E,P=Au(!1),J=Ef.bind(null,oi,!1,P.queue),P=No(),W={state:y,dispatch:null,action:f,pending:null},P.queue=W,E=dt.bind(null,oi,W,J,E),W.dispatch=E,P.memoizedState=f,[y,E,!1]}function o_(f){var y=Pa();return l_(y,Js,f)}function l_(f,y,E){if(y=qm(f,y,Tg)[0],f=hp(Gc)[0],typeof y=="object"&&y!==null&&typeof y.then=="function")try{var P=up(y)}catch(ve){throw ve===xf?Nc:ve}else P=y;y=Pa();var W=y.queue,J=W.dispatch;return E!==y.memoizedState&&(oi.flags|=2048,Nh(9,{destroy:void 0},c_.bind(null,W,E),null)),[P,J,f]}function c_(f,y){f.action=y}function Kp(f){var y=Pa(),E=Js;if(E!==null)return l_(y,E,f);Pa(),y=y.memoizedState,E=Pa();var P=E.queue.dispatch;return E.memoizedState=f,[y,P,!1]}function Nh(f,y,E,P){return f={tag:f,create:E,deps:P,inst:y,next:null},y=oi.updateQueue,y===null&&(y=zh(),oi.updateQueue=y),E=y.lastEffect,E===null?y.lastEffect=f.next=f:(P=E.next,E.next=f,f.next=P,y.lastEffect=f),f}function $p(){return Pa().memoizedState}function bd(f,y,E,P){var W=No();oi.flags|=f,W.memoizedState=Nh(1|y,{destroy:void 0},E,P===void 0?null:P)}function wf(f,y,E,P){var W=Pa();P=P===void 0?null:P;var J=W.memoizedState.inst;Js!==null&&P!==null&&Wp(P,Js.memoizedState.deps)?W.memoizedState=Nh(y,J,E,P):(oi.flags|=f,W.memoizedState=Nh(1|y,J,E,P))}function Sf(f,y){bd(8390656,8,f,y)}function gc(f,y){wf(2048,8,f,y)}function Mg(f){oi.flags|=4;var y=oi.updateQueue;if(y===null)y=zh(),oi.updateQueue=y,y.events=[f];else{var E=y.events;E===null?y.events=[f]:E.push(f)}}function Eg(f){var y=Pa().memoizedState;return Mg({ref:y,nextImpl:f}),function(){if((_t&2)!==0)throw Error(l(440));return y.impl.apply(void 0,arguments)}}function Ag(f,y){return wf(4,2,f,y)}function $l(f,y){return wf(4,4,f,y)}function jc(f,y){if(typeof y=="function"){f=f();var E=y(f);return function(){typeof E=="function"?E():y(null)}}if(y!=null)return f=f(),y.current=f,function(){y.current=null}}function wo(f,y,E){E=E!=null?E.concat([f]):null,wf(4,4,jc.bind(null,y,f),E)}function Jp(){}function wd(f,y){var E=Pa();y=y===void 0?null:y;var P=E.memoizedState;return y!==null&&Wp(y,P[1])?P[0]:(E.memoizedState=[f,y],f)}function Cg(f,y){var E=Pa();y=y===void 0?null:y;var P=E.memoizedState;if(y!==null&&Wp(y,P[1]))return P[0];if(P=f(),Tu){Xn(!0);try{f()}finally{Xn(!1)}}return E.memoizedState=[P,y],P}function Ms(f,y,E){return E===void 0||(po&1073741824)!==0&&(Ft&261930)===0?f.memoizedState=y:(f.memoizedState=E,f=w(),oi.lanes|=f,ni|=f,E)}function vr(f,y,E,P){return ts(E,y)?E:Yl.current!==null?(f=Ms(f,E,P),ts(f,y)||(ga=!0),f):(po&42)===0||(po&1073741824)!==0&&(Ft&261930)===0?(ga=!0,f.memoizedState=E):(f=w(),oi.lanes|=f,ni|=f,y)}function Wm(f,y,E,P,W){var J=Qe.p;Qe.p=J!==0&&8>J?J:8;var ve=Re.T,Xe={};Re.T=Xe,Ef(f,!1,y,E);try{var Ct=W(),_i=Re.S;if(_i!==null&&_i(Xe,Ct),Ct!==null&&typeof Ct=="object"&&typeof Ct.then=="function"){var Hi=dd(Ct,P);qc(f,y,Hi,rr(f))}else qc(f,y,P,rr(f))}catch(nn){qc(f,y,{then:function(){},status:"rejected",reason:nn},rr())}finally{Qe.p=J,ve!==null&&Xe.types!==null&&(ve.types=Xe.types),Re.T=ve}}function Tf(){}function Mf(f,y,E,P){if(f.tag!==5)throw Error(l(476));var W=Sd(f).queue;Wm(f,W,y,et,E===null?Tf:function(){return Cu(f),E(P)})}function Sd(f){var y=f.memoizedState;if(y!==null)return y;y={memoizedState:et,baseState:et,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:et},next:null};var E={};return y.next={memoizedState:E,baseState:E,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:E},next:null},f.memoizedState=y,f=f.alternate,f!==null&&(f.memoizedState=y),y}function Cu(f){var y=Sd(f);y.next===null&&(y=f.alternate.memoizedState),qc(f,y.next.queue,{},rr())}function Qp(){return bo(T0)}function So(){return Pa().memoizedState}function em(){return Pa().memoizedState}function Zm(f){for(var y=f.return;y!==null;){switch(y.tag){case 24:case 3:var E=rr();f=vu(E);var P=rh(y,f,E);P!==null&&(T(P,y,E),bu(P,y,E)),y={cache:ip()},f.payload=y;return}y=y.return}}function _c(f,y,E){var P=rr();E={lane:P,revertLane:0,gesture:null,action:E,hasEagerState:!1,eagerState:null,next:null},Ru(f)?Fh(y,E):(E=df(f,y,E,P),E!==null&&(T(E,f,P),io(E,y,P)))}function ul(f,y,E){var P=rr();qc(f,y,E,P)}function qc(f,y,E,P){var W={lane:P,revertLane:0,gesture:null,action:E,hasEagerState:!1,eagerState:null,next:null};if(Ru(f))Fh(y,W);else{var J=f.alternate;if(f.lanes===0&&(J===null||J.lanes===0)&&(J=y.lastRenderedReducer,J!==null))try{var ve=y.lastRenderedState,Xe=J(ve,E);if(W.hasEagerState=!0,W.eagerState=Xe,ts(Xe,ve))return gi(f,y,W,0),xt===null&&fu(),!1}catch{}finally{}if(E=df(f,y,W,P),E!==null)return T(E,f,P),io(E,y,P),!0}return!1}function Ef(f,y,E,P){if(P={lane:2,revertLane:Py(),gesture:null,action:P,hasEagerState:!1,eagerState:null,next:null},Ru(f)){if(y)throw Error(l(479))}else y=df(f,E,P,2),y!==null&&T(y,f,2)}function Ru(f){var y=f.alternate;return f===oi||y!==null&&y===oi}function Fh(f,y){gn=Su=!0;var E=f.pending;E===null?y.next=y:(y.next=E.next,E.next=y),f.pending=y}function io(f,y,E){if((E&4194048)!==0){var P=y.lanes;P&=f.pendingLanes,E|=P,y.lanes=E,ac(f,E)}}var Af={readContext:bo,use:Vc,useCallback:Ea,useContext:Ea,useEffect:Ea,useImperativeHandle:Ea,useLayoutEffect:Ea,useInsertionEffect:Ea,useMemo:Ea,useReducer:Ea,useRef:Ea,useState:Ea,useDebugValue:Ea,useDeferredValue:Ea,useTransition:Ea,useSyncExternalStore:Ea,useId:Ea,useHostTransitionStatus:Ea,useFormState:Ea,useActionState:Ea,useOptimistic:Ea,useMemoCache:Ea,useCacheRefresh:Ea};Af.useEffectEvent=Ea;var Jl={readContext:bo,use:Vc,useCallback:function(f,y){return No().memoizedState=[f,y===void 0?null:y],f},useContext:bo,useEffect:Sf,useImperativeHandle:function(f,y,E){E=E!=null?E.concat([f]):null,bd(4194308,4,jc.bind(null,y,f),E)},useLayoutEffect:function(f,y){return bd(4194308,4,f,y)},useInsertionEffect:function(f,y){bd(4,2,f,y)},useMemo:function(f,y){var E=No();y=y===void 0?null:y;var P=f();if(Tu){Xn(!0);try{f()}finally{Xn(!1)}}return E.memoizedState=[P,y],P},useReducer:function(f,y,E){var P=No();if(E!==void 0){var W=E(y);if(Tu){Xn(!0);try{E(y)}finally{Xn(!1)}}}else W=y;return P.memoizedState=P.baseState=W,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:W},P.queue=f,f=f.dispatch=_c.bind(null,oi,f),[P.memoizedState,f]},useRef:function(f){var y=No();return f={current:f},y.memoizedState=f},useState:function(f){f=Au(f);var y=f.queue,E=ul.bind(null,oi,y);return y.dispatch=E,[f.memoizedState,E]},useDebugValue:Jp,useDeferredValue:function(f,y){var E=No();return Ms(E,f,y)},useTransition:function(){var f=Au(!1);return f=Wm.bind(null,oi,f.queue,!0,!1),No().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,y,E){var P=oi,W=No();if(zs){if(E===void 0)throw Error(l(407));E=E()}else{if(E=y(),xt===null)throw Error(l(349));(Ft&127)!==0||wg(P,y,E)}W.memoizedState=E;var J={value:E,getSnapshot:y};return W.queue=J,Sf(Bh.bind(null,P,J,f),[f]),P.flags|=2048,Nh(9,{destroy:void 0},Oh.bind(null,P,J,E,y),null),E},useId:function(){var f=No(),y=xt.identifierPrefix;if(zs){var E=mu,P=Yu;E=(P&~(1<<32-Qn(P)-1)).toString(32)+E,y="_"+y+"R_"+E,E=lp++,0<E&&(y+="H"+E.toString(32)),y+="_"}else E=jm++,y="_"+y+"r_"+E.toString(32)+"_";return f.memoizedState=y},useHostTransitionStatus:Qp,useFormState:vd,useActionState:vd,useOptimistic:function(f){var y=No();y.memoizedState=y.baseState=f;var E={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return y.queue=E,y=Ef.bind(null,oi,!0,E),E.dispatch=y,[f,y]},useMemoCache:ms,useCacheRefresh:function(){return No().memoizedState=Zm.bind(null,oi)},useEffectEvent:function(f){var y=No(),E={impl:f};return y.memoizedState=E,function(){if((_t&2)!==0)throw Error(l(440));return E.impl.apply(void 0,arguments)}}},Uh={readContext:bo,use:Vc,useCallback:wd,useContext:bo,useEffect:gc,useImperativeHandle:wo,useInsertionEffect:Ag,useLayoutEffect:$l,useMemo:Cg,useReducer:hp,useRef:$p,useState:function(){return hp(Gc)},useDebugValue:Jp,useDeferredValue:function(f,y){var E=Pa();return vr(E,Js.memoizedState,f,y)},useTransition:function(){var f=hp(Gc)[0],y=Pa().memoizedState;return[typeof f=="boolean"?f:up(f),y]},useSyncExternalStore:Xm,useId:So,useHostTransitionStatus:Qp,useFormState:o_,useActionState:o_,useOptimistic:function(f,y){var E=Pa();return Ys(E,Js,f,y)},useMemoCache:ms,useCacheRefresh:em};Uh.useEffectEvent=Eg;var Cf={readContext:bo,use:Vc,useCallback:wd,useContext:bo,useEffect:gc,useImperativeHandle:wo,useInsertionEffect:Ag,useLayoutEffect:$l,useMemo:Cg,useReducer:Zp,useRef:$p,useState:function(){return Zp(Gc)},useDebugValue:Jp,useDeferredValue:function(f,y){var E=Pa();return Js===null?Ms(E,f,y):vr(E,Js.memoizedState,f,y)},useTransition:function(){var f=Zp(Gc)[0],y=Pa().memoizedState;return[typeof f=="boolean"?f:up(f),y]},useSyncExternalStore:Xm,useId:So,useHostTransitionStatus:Qp,useFormState:Kp,useActionState:Kp,useOptimistic:function(f,y){var E=Pa();return Js!==null?Ys(E,Js,f,y):(E.baseState=f,[f,E.queue.dispatch])},useMemoCache:ms,useCacheRefresh:em};Cf.useEffectEvent=Eg;function kh(f,y,E,P){y=f.memoizedState,E=E(P,y),E=E==null?y:N({},y,E),f.memoizedState=E,f.lanes===0&&(f.updateQueue.baseState=E)}var Td={enqueueSetState:function(f,y,E){f=f._reactInternals;var P=rr(),W=vu(P);W.payload=y,E!=null&&(W.callback=E),y=rh(f,W,P),y!==null&&(T(y,f,P),bu(y,f,P))},enqueueReplaceState:function(f,y,E){f=f._reactInternals;var P=rr(),W=vu(P);W.tag=1,W.payload=y,E!=null&&(W.callback=E),y=rh(f,W,P),y!==null&&(T(y,f,P),bu(y,f,P))},enqueueForceUpdate:function(f,y){f=f._reactInternals;var E=rr(),P=vu(E);P.tag=2,y!=null&&(P.callback=y),y=rh(f,P,E),y!==null&&(T(y,f,E),bu(y,f,E))}};function Aa(f,y,E,P,W,J,ve){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(P,J,ve):y.prototype&&y.prototype.isPureReactComponent?!Eh(E,P)||!Eh(W,J):!0}function Md(f,y,E,P){f=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(E,P),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(E,P),y.state!==f&&Td.enqueueReplaceState(y,y.state,null)}function To(f,y){var E=y;if("ref"in y){E={};for(var P in y)P!=="ref"&&(E[P]=y[P])}if(f=f.defaultProps){E===y&&(E=N({},E));for(var W in f)E[W]===void 0&&(E[W]=f[W])}return E}function tm(f){dc(f)}function Rf(f){console.error(f)}function fp(f){dc(f)}function dp(f,y){try{var E=f.onUncaughtError;E(y.value,{componentStack:y.stack})}catch(P){setTimeout(function(){throw P})}}function Ed(f,y,E){try{var P=f.onCaughtError;P(E.value,{componentStack:E.stack,errorBoundary:y.tag===1?y.stateNode:null})}catch(W){setTimeout(function(){throw W})}}function Xc(f,y,E){return E=vu(E),E.tag=3,E.payload={element:null},E.callback=function(){dp(f,y)},E}function mo(f){return f=vu(f),f.tag=3,f}function no(f,y,E,P){var W=E.type.getDerivedStateFromError;if(typeof W=="function"){var J=P.value;f.payload=function(){return W(J)},f.callback=function(){Ed(y,E,P)}}var ve=E.stateNode;ve!==null&&typeof ve.componentDidCatch=="function"&&(f.callback=function(){Ed(y,E,P),typeof W!="function"&&(Dn===null?Dn=new Set([this]):Dn.add(this));var Xe=P.stack;this.componentDidCatch(P.value,{componentStack:Xe!==null?Xe:""})})}function Ll(f,y,E,P,W){if(E.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){if(y=E.alternate,y!==null&&Ju(y,E,W,!0),E=La.current,E!==null){switch(E.tag){case 31:case 13:return Oo===null?br():E.alternate===null&&vi===0&&(vi=3),E.flags&=-257,E.flags|=65536,E.lanes=W,P===rp?E.flags|=16384:(y=E.updateQueue,y===null?E.updateQueue=new Set([P]):y.add(P),Iy(f,P,W)),!1;case 22:return E.flags|=65536,P===rp?E.flags|=16384:(y=E.updateQueue,y===null?(y={transitions:null,markerInstances:null,retryQueue:new Set([P])},E.updateQueue=y):(E=y.retryQueue,E===null?y.retryQueue=new Set([P]):E.add(P)),Iy(f,P,W)),!1}throw Error(l(435,E.tag))}return Iy(f,P,W),br(),!1}if(zs)return y=La.current,y!==null?((y.flags&65536)===0&&(y.flags|=256),y.flags|=65536,y.lanes=W,P!==Ch&&(f=Error(l(422),{cause:P}),Jd(eo(f,E)))):(P!==Ch&&(y=Error(l(423),{cause:P}),Jd(eo(y,E))),f=f.current.alternate,f.flags|=65536,W&=-W,f.lanes|=W,P=eo(P,E),W=Xc(f.stateNode,P,W),gd(f,W),vi!==4&&(vi=2)),!1;var J=Error(l(520),{cause:P});if(J=eo(J,E),Oi===null?Oi=[J]:Oi.push(J),vi!==4&&(vi=2),y===null)return!0;P=eo(P,E),E=y;do{switch(E.tag){case 3:return E.flags|=65536,f=W&-W,E.lanes|=f,f=Xc(E.stateNode,P,f),gd(E,f),!1;case 1:if(y=E.type,J=E.stateNode,(E.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(Dn===null||!Dn.has(J))))return E.flags|=65536,W&=-W,E.lanes|=W,W=mo(W),no(W,f,E,P),gd(E,W),!1}E=E.return}while(E!==null);return!1}var Ad=Error(l(461)),ga=!1;function Ca(f,y,E,P){y.child=f===null?vg(y,null,E,P):nh(y,f.child,E,P)}function If(f,y,E,P,W){E=E.render;var J=y.ref;if("ref"in P){var ve={};for(var Xe in P)Xe!=="ref"&&(ve[Xe]=P[Xe])}else ve=P;return Dh(y),P=Mu(f,y,E,ve,J,W),Xe=Bo(),f!==null&&!ga?(Eu(f,y,W),ec(f,y,W)):(zs&&Xe&&$d(y),y.flags|=1,Ca(f,y,P,W),y.child)}function pp(f,y,E,P,W){if(f===null){var J=E.type;return typeof J=="function"&&!Qa(J)&&J.defaultProps===void 0&&E.compare===null?(y.tag=15,y.type=J,hl(f,y,J,P,W)):(f=mf(E.type,null,P,y,y.mode,W),f.ref=y.ref,f.return=y,y.child=f)}if(J=f.child,!dl(f,W)){var ve=J.memoizedProps;if(E=E.compare,E=E!==null?E:Eh,E(ve,P)&&f.ref===y.ref)return ec(f,y,W)}return y.flags|=1,f=ol(J,P),f.ref=y.ref,f.return=y,y.child=f}function hl(f,y,E,P,W){if(f!==null){var J=f.memoizedProps;if(Eh(J,P)&&f.ref===y.ref)if(ga=!1,y.pendingProps=P=J,dl(f,W))(f.flags&131072)!==0&&(ga=!0);else return y.lanes=f.lanes,ec(f,y,W)}return Rd(f,y,E,P,W)}function Ql(f,y,E,P){var W=P.children,J=f!==null?f.memoizedState:null;if(f===null&&y.stateNode===null&&(y.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),P.mode==="hidden"){if((y.flags&128)!==0){if(J=J!==null?J.baseLanes|E:E,f!==null){for(P=y.child=f.child,W=0;P!==null;)W=W|P.lanes|P.childLanes,P=P.sibling;P=W&~J}else P=0,y.child=null;return Zc(f,y,J,E,P)}if((E&536870912)!==0)y.memoizedState={baseLanes:0,cachePool:null},f!==null&&yf(y,J!==null?J.cachePool:null),J!==null?ap(y,J):_d(),kc(y);else return P=y.lanes=536870912,Zc(f,y,J!==null?J.baseLanes|E:E,E,P)}else J!==null?(yf(y,J.cachePool),ap(y,J),wu(),y.memoizedState=null):(f!==null&&yf(y,null),_d(),wu());return Ca(f,y,W,E),y.child}function Wc(f,y){return f!==null&&f.tag===22||y.stateNode!==null||(y.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),y.sibling}function Zc(f,y,E,P,W){var J=Bc();return J=J===null?null:{parent:nr._currentValue,pool:J},y.memoizedState={baseLanes:E,cachePool:J},f!==null&&yf(y,null),_d(),kc(y),f!==null&&Ju(f,y,P,!0),y.childLanes=W,null}function Pl(f,y){return y=mp({mode:y.mode,children:y.children},f.mode),y.ref=f.ref,f.child=y,y.return=f,y}function Mo(f,y,E){return nh(y,f.child,null,E),f=Pl(y,y.pendingProps),f.flags|=2,Kl(y),y.memoizedState=null,f}function Cd(f,y,E){var P=y.pendingProps,W=(y.flags&128)!==0;if(y.flags&=-129,f===null){if(zs){if(P.mode==="hidden")return f=Pl(y,P),y.lanes=536870912,Wc(null,f);if(op(y),(f=ea)?(f=Uy(f,vo),f=f!==null&&f.data==="&"?f:null,f!==null&&(y.memoizedState={dehydrated:f,treeContext:ns!==null?{id:Yu,overflow:mu}:null,retryLane:536870912,hydrationErrors:null},E=s_(f),E.return=y,y.child=E,Xa=y,ea=null)):f=null,f===null)throw ws(y);return y.lanes=536870912,null}return Pl(y,P)}var J=f.memoizedState;if(J!==null){var ve=J.dehydrated;if(op(y),W)if(y.flags&256)y.flags&=-257,y=Mo(f,y,E);else if(y.memoizedState!==null)y.child=f.child,y.flags|=128,y=null;else throw Error(l(558));else if(ga||Ju(f,y,E,!1),W=(E&f.childLanes)!==0,ga||W){if(P=xt,P!==null&&(ve=Ar(P,E),ve!==0&&ve!==J.retryLane))throw J.retryLane=ve,du(f,ve),T(P,f,ve),Ad;br(),y=Mo(f,y,E)}else f=J.treeContext,ea=Bf(ve.nextSibling),Xa=y,zs=!0,_u=null,vo=!1,f!==null&&Ku(y,f),y=Pl(y,P),y.flags|=4096;return y}return f=ol(f.child,{mode:P.mode,children:P.children}),f.ref=y.ref,y.child=f,f.return=y,f}function yc(f,y){var E=y.ref;if(E===null)f!==null&&f.ref!==null&&(y.flags|=4194816);else{if(typeof E!="function"&&typeof E!="object")throw Error(l(284));(f===null||f.ref!==E)&&(y.flags|=4194816)}}function Rd(f,y,E,P,W){return Dh(y),E=Mu(f,y,E,P,void 0,W),P=Bo(),f!==null&&!ga?(Eu(f,y,W),ec(f,y,W)):(zs&&P&&$d(y),y.flags|=1,Ca(f,y,E,W),y.child)}function Eo(f,y,E,P,W,J){return Dh(y),y.updateQueue=null,E=Dl(y,P,E,W),a_(f),P=Bo(),f!==null&&!ga?(Eu(f,y,J),ec(f,y,J)):(zs&&P&&$d(y),y.flags|=1,Ca(f,y,E,J),y.child)}function ro(f,y,E,P,W){if(Dh(y),y.stateNode===null){var J=Lc,ve=E.contextType;typeof ve=="object"&&ve!==null&&(J=bo(ve)),J=new E(P,J),y.memoizedState=J.state!==null&&J.state!==void 0?J.state:null,J.updater=Td,y.stateNode=J,J._reactInternals=y,J=y.stateNode,J.props=P,J.state=y.memoizedState,J.refs={},Xp(y),ve=E.contextType,J.context=typeof ve=="object"&&ve!==null?bo(ve):Lc,J.state=y.memoizedState,ve=E.getDerivedStateFromProps,typeof ve=="function"&&(kh(y,E,ve,P),J.state=y.memoizedState),typeof E.getDerivedStateFromProps=="function"||typeof J.getSnapshotBeforeUpdate=="function"||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(ve=J.state,typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount(),ve!==J.state&&Td.enqueueReplaceState(J,J.state,null),ll(y,P,J,W),sp(),J.state=y.memoizedState),typeof J.componentDidMount=="function"&&(y.flags|=4194308),P=!0}else if(f===null){J=y.stateNode;var Xe=y.memoizedProps,Ct=To(E,Xe);J.props=Ct;var _i=J.context,Hi=E.contextType;ve=Lc,typeof Hi=="object"&&Hi!==null&&(ve=bo(Hi));var nn=E.getDerivedStateFromProps;Hi=typeof nn=="function"||typeof J.getSnapshotBeforeUpdate=="function",Xe=y.pendingProps!==Xe,Hi||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(Xe||_i!==ve)&&Md(y,J,P,ve),Il=!1;var wi=y.memoizedState;J.state=wi,ll(y,P,J,W),sp(),_i=y.memoizedState,Xe||wi!==_i||Il?(typeof nn=="function"&&(kh(y,E,nn,P),_i=y.memoizedState),(Ct=Il||Aa(y,E,Ct,P,wi,_i,ve))?(Hi||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount()),typeof J.componentDidMount=="function"&&(y.flags|=4194308)):(typeof J.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=P,y.memoizedState=_i),J.props=P,J.state=_i,J.context=ve,P=Ct):(typeof J.componentDidMount=="function"&&(y.flags|=4194308),P=!1)}else{J=y.stateNode,md(f,y),ve=y.memoizedProps,Hi=To(E,ve),J.props=Hi,nn=y.pendingProps,wi=J.context,_i=E.contextType,Ct=Lc,typeof _i=="object"&&_i!==null&&(Ct=bo(_i)),Xe=E.getDerivedStateFromProps,(_i=typeof Xe=="function"||typeof J.getSnapshotBeforeUpdate=="function")||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(ve!==nn||wi!==Ct)&&Md(y,J,P,Ct),Il=!1,wi=y.memoizedState,J.state=wi,ll(y,P,J,W),sp();var Ci=y.memoizedState;ve!==nn||wi!==Ci||Il||f!==null&&f.dependencies!==null&&gf(f.dependencies)?(typeof Xe=="function"&&(kh(y,E,Xe,P),Ci=y.memoizedState),(Hi=Il||Aa(y,E,Hi,P,wi,Ci,Ct)||f!==null&&f.dependencies!==null&&gf(f.dependencies))?(_i||typeof J.UNSAFE_componentWillUpdate!="function"&&typeof J.componentWillUpdate!="function"||(typeof J.componentWillUpdate=="function"&&J.componentWillUpdate(P,Ci,Ct),typeof J.UNSAFE_componentWillUpdate=="function"&&J.UNSAFE_componentWillUpdate(P,Ci,Ct)),typeof J.componentDidUpdate=="function"&&(y.flags|=4),typeof J.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof J.componentDidUpdate!="function"||ve===f.memoizedProps&&wi===f.memoizedState||(y.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||ve===f.memoizedProps&&wi===f.memoizedState||(y.flags|=1024),y.memoizedProps=P,y.memoizedState=Ci),J.props=P,J.state=Ci,J.context=Ct,P=Hi):(typeof J.componentDidUpdate!="function"||ve===f.memoizedProps&&wi===f.memoizedState||(y.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||ve===f.memoizedProps&&wi===f.memoizedState||(y.flags|=1024),P=!1)}return J=P,yc(f,y),P=(y.flags&128)!==0,J||P?(J=y.stateNode,E=P&&typeof E.getDerivedStateFromError!="function"?null:J.render(),y.flags|=1,f!==null&&P?(y.child=nh(y,f.child,null,W),y.child=nh(y,null,E,W)):Ca(f,y,E,W),y.memoizedState=J.state,f=y.child):f=ec(f,y,W),f}function Ws(f,y,E,P){return yu(),y.flags|=256,Ca(f,y,E,P),y.child}var xc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vc(f){return{baseLanes:f,cachePool:Lh()}}function Es(f,y,E){return f=f!==null?f.childLanes&~E:0,y&&(f|=Si),f}function fl(f,y,E){var P=y.pendingProps,W=!1,J=(y.flags&128)!==0,ve;if((ve=J)||(ve=f!==null&&f.memoizedState===null?!1:(Va.current&2)!==0),ve&&(W=!0,y.flags&=-129),ve=(y.flags&32)!==0,y.flags&=-33,f===null){if(zs){if(W?ah(y):wu(),(f=ea)?(f=Uy(f,vo),f=f!==null&&f.data!=="&"?f:null,f!==null&&(y.memoizedState={dehydrated:f,treeContext:ns!==null?{id:Yu,overflow:mu}:null,retryLane:536870912,hydrationErrors:null},E=s_(f),E.return=y,y.child=E,Xa=y,ea=null)):f=null,f===null)throw ws(y);return ky(f)?y.lanes=32:y.lanes=536870912,null}var Xe=P.children;return P=P.fallback,W?(wu(),W=y.mode,Xe=mp({mode:"hidden",children:Xe},W),P=Zu(P,W,E,null),Xe.return=y,P.return=y,Xe.sibling=P,y.child=Xe,P=y.child,P.memoizedState=vc(E),P.childLanes=Es(f,ve,E),y.memoizedState=xc,Wc(null,P)):(ah(y),Df(y,Xe))}var Ct=f.memoizedState;if(Ct!==null&&(Xe=Ct.dehydrated,Xe!==null)){if(J)y.flags&256?(ah(y),y.flags&=-257,y=gp(f,y,E)):y.memoizedState!==null?(wu(),y.child=f.child,y.flags|=128,y=null):(wu(),Xe=P.fallback,W=y.mode,P=mp({mode:"visible",children:P.children},W),Xe=Zu(Xe,W,E,null),Xe.flags|=2,P.return=y,Xe.return=y,P.sibling=Xe,y.child=P,nh(y,f.child,null,E),P=y.child,P.memoizedState=vc(E),P.childLanes=Es(f,ve,E),y.memoizedState=xc,y=Wc(null,P));else if(ah(y),ky(Xe)){if(ve=Xe.nextSibling&&Xe.nextSibling.dataset,ve)var _i=ve.dgst;ve=_i,P=Error(l(419)),P.stack="",P.digest=ve,Jd({value:P,source:null,stack:null}),y=gp(f,y,E)}else if(ga||Ju(f,y,E,!1),ve=(E&f.childLanes)!==0,ga||ve){if(ve=xt,ve!==null&&(P=Ar(ve,E),P!==0&&P!==Ct.retryLane))throw Ct.retryLane=P,du(f,P),T(ve,f,P),Ad;x0(Xe)||br(),y=gp(f,y,E)}else x0(Xe)?(y.flags|=192,y.child=f.child,y=null):(f=Ct.treeContext,ea=Bf(Xe.nextSibling),Xa=y,zs=!0,_u=null,vo=!1,f!==null&&Ku(y,f),y=Df(y,P.children),y.flags|=4096);return y}return W?(wu(),Xe=P.fallback,W=y.mode,Ct=f.child,_i=Ct.sibling,P=ol(Ct,{mode:"hidden",children:P.children}),P.subtreeFlags=Ct.subtreeFlags&65011712,_i!==null?Xe=ol(_i,Xe):(Xe=Zu(Xe,W,E,null),Xe.flags|=2),Xe.return=y,P.return=y,P.sibling=Xe,y.child=P,Wc(null,P),P=y.child,Xe=f.child.memoizedState,Xe===null?Xe=vc(E):(W=Xe.cachePool,W!==null?(Ct=nr._currentValue,W=W.parent!==Ct?{parent:Ct,pool:Ct}:W):W=Lh(),Xe={baseLanes:Xe.baseLanes|E,cachePool:W}),P.memoizedState=Xe,P.childLanes=Es(f,ve,E),y.memoizedState=xc,Wc(f.child,P)):(ah(y),E=f.child,f=E.sibling,E=ol(E,{mode:"visible",children:P.children}),E.return=y,E.sibling=null,f!==null&&(ve=y.deletions,ve===null?(y.deletions=[f],y.flags|=16):ve.push(f)),y.child=E,y.memoizedState=null,E)}function Df(f,y){return y=mp({mode:"visible",children:y},f.mode),y.return=f,f.child=y}function mp(f,y){return f=Wo(22,f,null,y),f.lanes=0,f}function gp(f,y,E){return nh(y,f.child,null,E),f=Df(y,y.pendingProps.children),f.flags|=2,y.memoizedState=null,f}function Iu(f,y,E){f.lanes|=y;var P=f.alternate;P!==null&&(P.lanes|=y),Ih(f.return,y,E)}function Id(f,y,E,P,W,J){var ve=f.memoizedState;ve===null?f.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:P,tail:E,tailMode:W,treeForkCount:J}:(ve.isBackwards=y,ve.rendering=null,ve.renderingStartTime=0,ve.last=P,ve.tail=E,ve.tailMode=W,ve.treeForkCount=J)}function Dd(f,y,E){var P=y.pendingProps,W=P.revealOrder,J=P.tail;P=P.children;var ve=Va.current,Xe=(ve&2)!==0;if(Xe?(ve=ve&1|2,y.flags|=128):ve&=1,Vt(Va,ve),Ca(f,y,P,E),P=zs?Yd:0,!Xe&&f!==null&&(f.flags&128)!==0)e:for(f=y.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Iu(f,E,y);else if(f.tag===19)Iu(f,E,y);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===y)break e;for(;f.sibling===null;){if(f.return===null||f.return===y)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}switch(W){case"forwards":for(E=y.child,W=null;E!==null;)f=E.alternate,f!==null&&Ph(f)===null&&(W=E),E=E.sibling;E=W,E===null?(W=y.child,y.child=null):(W=E.sibling,E.sibling=null),Id(y,!1,W,E,J,P);break;case"backwards":case"unstable_legacy-backwards":for(E=null,W=y.child,y.child=null;W!==null;){if(f=W.alternate,f!==null&&Ph(f)===null){y.child=W;break}f=W.sibling,W.sibling=E,E=W,W=f}Id(y,!0,E,null,J,P);break;case"together":Id(y,!1,null,null,void 0,P);break;default:y.memoizedState=null}return y.child}function ec(f,y,E){if(f!==null&&(y.dependencies=f.dependencies),ni|=y.lanes,(E&y.childLanes)===0)if(f!==null){if(Ju(f,y,E,!1),(E&y.childLanes)===0)return null}else return null;if(f!==null&&y.child!==f.child)throw Error(l(153));if(y.child!==null){for(f=y.child,E=ol(f,f.pendingProps),y.child=E,E.return=y;f.sibling!==null;)f=f.sibling,E=E.sibling=ol(f,f.pendingProps),E.return=y;E.sibling=null}return y.child}function dl(f,y){return(f.lanes&y)!==0?!0:(f=f.dependencies,!!(f!==null&&gf(f)))}function Lf(f,y,E){switch(y.tag){case 3:Fi(y,y.stateNode.containerInfo),Rh(y,nr,f.memoizedState.cache),yu();break;case 27:case 5:rn(y);break;case 4:Fi(y,y.stateNode.containerInfo);break;case 10:Rh(y,y.type,y.memoizedProps.value);break;case 31:if(y.memoizedState!==null)return y.flags|=128,op(y),null;break;case 13:var P=y.memoizedState;if(P!==null)return P.dehydrated!==null?(ah(y),y.flags|=128,null):(E&y.child.childLanes)!==0?fl(f,y,E):(ah(y),f=ec(f,y,E),f!==null?f.sibling:null);ah(y);break;case 19:var W=(f.flags&128)!==0;if(P=(E&y.childLanes)!==0,P||(Ju(f,y,E,!1),P=(E&y.childLanes)!==0),W){if(P)return Dd(f,y,E);y.flags|=128}if(W=y.memoizedState,W!==null&&(W.rendering=null,W.tail=null,W.lastEffect=null),Vt(Va,Va.current),P)break;return null;case 22:return y.lanes=0,Ql(f,y,E,y.pendingProps);case 24:Rh(y,nr,f.memoizedState.cache)}return ec(f,y,E)}function _a(f,y,E){if(f!==null)if(f.memoizedProps!==y.pendingProps)ga=!0;else{if(!dl(f,E)&&(y.flags&128)===0)return ga=!1,Lf(f,y,E);ga=(f.flags&131072)!==0}else ga=!1,zs&&(y.flags&1048576)!==0&&Kd(y,Yd,y.index);switch(y.lanes=0,y.tag){case 16:e:{var P=y.pendingProps;if(f=eh(y.elementType),y.type=f,typeof f=="function")Qa(f)?(P=To(f,P),y.tag=1,y=ro(null,y,f,P,E)):(y.tag=0,y=Rd(null,y,f,P,E));else{if(f!=null){var W=f.$$typeof;if(W===me){y.tag=11,y=If(null,y,f,P,E);break e}else if(W===ze){y.tag=14,y=pp(null,y,f,P,E);break e}}throw y=Gt(f)||f,Error(l(306,y,""))}}return y;case 0:return Rd(f,y,y.type,y.pendingProps,E);case 1:return P=y.type,W=To(P,y.pendingProps),ro(f,y,P,W,E);case 3:e:{if(Fi(y,y.stateNode.containerInfo),f===null)throw Error(l(387));P=y.pendingProps;var J=y.memoizedState;W=J.element,md(f,y),ll(y,P,null,E);var ve=y.memoizedState;if(P=ve.cache,Rh(y,nr,P),P!==J.cache&&Qd(y,[nr],E,!0),sp(),P=ve.element,J.isDehydrated)if(J={element:P,isDehydrated:!1,cache:ve.cache},y.updateQueue.baseState=J,y.memoizedState=J,y.flags&256){y=Ws(f,y,P,E);break e}else if(P!==W){W=eo(Error(l(424)),y),Jd(W),y=Ws(f,y,P,E);break e}else{switch(f=y.stateNode.containerInfo,f.nodeType){case 9:f=f.body;break;default:f=f.nodeName==="HTML"?f.ownerDocument.body:f}for(ea=Bf(f.firstChild),Xa=y,zs=!0,_u=null,vo=!0,E=vg(y,null,P,E),y.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling}else{if(yu(),P===W){y=ec(f,y,E);break e}Ca(f,y,P,E)}y=y.child}return y;case 26:return yc(f,y),f===null?(E=Fw(y.type,null,y.pendingProps,null))?y.memoizedState=E:zs||(E=y.type,f=y.pendingProps,P=By(qt.current).createElement(E),P[oe]=y,P[ge]=f,wc(P,E,f),ht(P),y.stateNode=P):y.memoizedState=Fw(y.type,f.memoizedProps,y.pendingProps,f.memoizedState),null;case 27:return rn(y),f===null&&zs&&(P=y.stateNode=Uv(y.type,y.pendingProps,qt.current),Xa=y,vo=!0,W=ea,sm(y.type)?(Sc=W,ea=Bf(P.firstChild)):ea=W),Ca(f,y,y.pendingProps.children,E),yc(f,y),f===null&&(y.flags|=4194304),y.child;case 5:return f===null&&zs&&((W=P=ea)&&(P=pE(P,y.type,y.pendingProps,vo),P!==null?(y.stateNode=P,Xa=y,ea=Bf(P.firstChild),vo=!1,W=!0):W=!1),W||ws(y)),rn(y),W=y.type,J=y.pendingProps,ve=f!==null?f.memoizedProps:null,P=J.children,Ov(W,J)?P=null:ve!==null&&Ov(W,ve)&&(y.flags|=32),y.memoizedState!==null&&(W=Mu(f,y,bg,null,null,E),T0._currentValue=W),yc(f,y),Ca(f,y,P,E),y.child;case 6:return f===null&&zs&&((f=E=ea)&&(E=Pw(E,y.pendingProps,vo),E!==null?(y.stateNode=E,Xa=y,ea=null,f=!0):f=!1),f||ws(y)),null;case 13:return fl(f,y,E);case 4:return Fi(y,y.stateNode.containerInfo),P=y.pendingProps,f===null?y.child=nh(y,null,P,E):Ca(f,y,P,E),y.child;case 11:return If(f,y,y.type,y.pendingProps,E);case 7:return Ca(f,y,y.pendingProps,E),y.child;case 8:return Ca(f,y,y.pendingProps.children,E),y.child;case 12:return Ca(f,y,y.pendingProps.children,E),y.child;case 10:return P=y.pendingProps,Rh(y,y.type,P.value),Ca(f,y,P.children,E),y.child;case 9:return W=y.type._context,P=y.pendingProps.children,Dh(y),W=bo(W),P=P(W),y.flags|=1,Ca(f,y,P,E),y.child;case 14:return pp(f,y,y.type,y.pendingProps,E);case 15:return hl(f,y,y.type,y.pendingProps,E);case 19:return Dd(f,y,E);case 31:return Cd(f,y,E);case 22:return Ql(f,y,E,y.pendingProps);case 24:return Dh(y),P=bo(nr),f===null?(W=Bc(),W===null&&(W=xt,J=ip(),W.pooledCache=J,J.refCount++,J!==null&&(W.pooledCacheLanes|=E),W=J),y.memoizedState={parent:P,cache:W},Xp(y),Rh(y,nr,W)):((f.lanes&E)!==0&&(md(f,y),ll(y,null,null,E),sp()),W=f.memoizedState,J=y.memoizedState,W.parent!==P?(W={parent:P,cache:P},y.memoizedState=W,y.lanes===0&&(y.memoizedState=y.updateQueue.baseState=W),Rh(y,nr,P)):(P=J.cache,Rh(y,nr,P),P!==W.cache&&Qd(y,[nr],E,!0))),Ca(f,y,y.pendingProps.children,E),y.child;case 29:throw y.pendingProps}throw Error(l(156,y.tag))}function Ga(f){f.flags|=4}function Yc(f,y,E,P,W){if((y=(f.mode&32)!==0)&&(y=!1),y){if(f.flags|=16777216,(W&335544128)===W)if(f.stateNode.complete)f.flags|=8192;else if(on())f.flags|=8192;else throw Vr=rp,Gp}else f.flags&=-16777217}function Kc(f,y){if(y.type!=="stylesheet"||(y.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!Hy(y))if(on())f.flags|=8192;else throw Vr=rp,Gp}function oh(f,y){y!==null&&(f.flags|=4),f.flags&16384&&(y=f.tag!==22?ls():536870912,f.lanes|=y,Ai|=y)}function im(f,y){if(!zs)switch(f.tailMode){case"hidden":y=f.tail;for(var E=null;y!==null;)y.alternate!==null&&(E=y),y=y.sibling;E===null?f.tail=null:E.sibling=null;break;case"collapsed":E=f.tail;for(var P=null;E!==null;)E.alternate!==null&&(P=E),E=E.sibling;P===null?y||f.tail===null?f.tail=null:f.tail.sibling=null:P.sibling=null}}function Ks(f){var y=f.alternate!==null&&f.alternate.child===f.child,E=0,P=0;if(y)for(var W=f.child;W!==null;)E|=W.lanes|W.childLanes,P|=W.subtreeFlags&65011712,P|=W.flags&65011712,W.return=f,W=W.sibling;else for(W=f.child;W!==null;)E|=W.lanes|W.childLanes,P|=W.subtreeFlags,P|=W.flags,W.return=f,W=W.sibling;return f.subtreeFlags|=P,f.childLanes=E,y}function _p(f,y,E){var P=y.pendingProps;switch(Wl(y),y.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(y),null;case 1:return Ks(y),null;case 3:return E=y.stateNode,P=null,f!==null&&(P=f.memoizedState.cache),y.memoizedState.cache!==P&&(y.flags|=2048),zc(nr),Ui(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(f===null||f.child===null)&&($u(y)?Ga(y):f===null||f.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,km())),Ks(y),null;case 26:var W=y.type,J=y.memoizedState;return f===null?(Ga(y),J!==null?(Ks(y),Kc(y,J)):(Ks(y),Yc(y,W,null,P,E))):J?J!==f.memoizedState?(Ga(y),Ks(y),Kc(y,J)):(Ks(y),y.flags&=-16777217):(f=f.memoizedProps,f!==P&&Ga(y),Ks(y),Yc(y,W,f,P,E)),null;case 27:if(Fn(y),E=qt.current,W=y.type,f!==null&&y.stateNode!=null)f.memoizedProps!==P&&Ga(y);else{if(!P){if(y.stateNode===null)throw Error(l(166));return Ks(y),null}f=ii.current,$u(y)?ud(y):(f=Uv(W,P,E),y.stateNode=f,Ga(y))}return Ks(y),null;case 5:if(Fn(y),W=y.type,f!==null&&y.stateNode!=null)f.memoizedProps!==P&&Ga(y);else{if(!P){if(y.stateNode===null)throw Error(l(166));return Ks(y),null}if(J=ii.current,$u(y))ud(y);else{var ve=By(qt.current);switch(J){case 1:J=ve.createElementNS("http://www.w3.org/2000/svg",W);break;case 2:J=ve.createElementNS("http://www.w3.org/1998/Math/MathML",W);break;default:switch(W){case"svg":J=ve.createElementNS("http://www.w3.org/2000/svg",W);break;case"math":J=ve.createElementNS("http://www.w3.org/1998/Math/MathML",W);break;case"script":J=ve.createElement("div"),J.innerHTML="<script><\/script>",J=J.removeChild(J.firstChild);break;case"select":J=typeof P.is=="string"?ve.createElement("select",{is:P.is}):ve.createElement("select"),P.multiple?J.multiple=!0:P.size&&(J.size=P.size);break;default:J=typeof P.is=="string"?ve.createElement(W,{is:P.is}):ve.createElement(W)}}J[oe]=y,J[ge]=P;e:for(ve=y.child;ve!==null;){if(ve.tag===5||ve.tag===6)J.appendChild(ve.stateNode);else if(ve.tag!==4&&ve.tag!==27&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===y)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===y)break e;ve=ve.return}ve.sibling.return=ve.return,ve=ve.sibling}y.stateNode=J;e:switch(wc(J,W,P),W){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}P&&Ga(y)}}return Ks(y),Yc(y,y.type,f===null?null:f.memoizedProps,y.pendingProps,E),null;case 6:if(f&&y.stateNode!=null)f.memoizedProps!==P&&Ga(y);else{if(typeof P!="string"&&y.stateNode===null)throw Error(l(166));if(f=qt.current,$u(y)){if(f=y.stateNode,E=y.memoizedProps,P=null,W=Xa,W!==null)switch(W.tag){case 27:case 5:P=W.memoizedProps}f[oe]=y,f=!!(f.nodeValue===E||P!==null&&P.suppressHydrationWarning===!0||p_(f.nodeValue,E)),f||ws(y,!0)}else f=By(f).createTextNode(P),f[oe]=y,y.stateNode=f}return Ks(y),null;case 31:if(E=y.memoizedState,f===null||f.memoizedState!==null){if(P=$u(y),E!==null){if(f===null){if(!P)throw Error(l(318));if(f=y.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(l(557));f[oe]=y}else yu(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;Ks(y),f=!1}else E=km(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=E),f=!0;if(!f)return y.flags&256?(Kl(y),y):(Kl(y),null);if((y.flags&128)!==0)throw Error(l(558))}return Ks(y),null;case 13:if(P=y.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(W=$u(y),P!==null&&P.dehydrated!==null){if(f===null){if(!W)throw Error(l(318));if(W=y.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(l(317));W[oe]=y}else yu(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;Ks(y),W=!1}else W=km(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=W),W=!0;if(!W)return y.flags&256?(Kl(y),y):(Kl(y),null)}return Kl(y),(y.flags&128)!==0?(y.lanes=E,y):(E=P!==null,f=f!==null&&f.memoizedState!==null,E&&(P=y.child,W=null,P.alternate!==null&&P.alternate.memoizedState!==null&&P.alternate.memoizedState.cachePool!==null&&(W=P.alternate.memoizedState.cachePool.pool),J=null,P.memoizedState!==null&&P.memoizedState.cachePool!==null&&(J=P.memoizedState.cachePool.pool),J!==W&&(P.flags|=2048)),E!==f&&E&&(y.child.flags|=8192),oh(y,y.updateQueue),Ks(y),null);case 4:return Ui(),f===null&&Uo(y.stateNode.containerInfo),Ks(y),null;case 10:return zc(y.type),Ks(y),null;case 19:if(Et(Va),P=y.memoizedState,P===null)return Ks(y),null;if(W=(y.flags&128)!==0,J=P.rendering,J===null)if(W)im(P,!1);else{if(vi!==0||f!==null&&(f.flags&128)!==0)for(f=y.child;f!==null;){if(J=Ph(f),J!==null){for(y.flags|=128,im(P,!1),f=J.updateQueue,y.updateQueue=f,oh(y,f),y.subtreeFlags=0,f=E,E=y.child;E!==null;)Ua(E,f),E=E.sibling;return Vt(Va,Va.current&1|2),zs&&gu(y,P.treeForkCount),y.child}f=f.sibling}P.tail!==null&&De()>Yi&&(y.flags|=128,W=!0,im(P,!1),y.lanes=4194304)}else{if(!W)if(f=Ph(J),f!==null){if(y.flags|=128,W=!0,f=f.updateQueue,y.updateQueue=f,oh(y,f),im(P,!0),P.tail===null&&P.tailMode==="hidden"&&!J.alternate&&!zs)return Ks(y),null}else 2*De()-P.renderingStartTime>Yi&&E!==536870912&&(y.flags|=128,W=!0,im(P,!1),y.lanes=4194304);P.isBackwards?(J.sibling=y.child,y.child=J):(f=P.last,f!==null?f.sibling=J:y.child=J,P.last=J)}return P.tail!==null?(f=P.tail,P.rendering=f,P.tail=f.sibling,P.renderingStartTime=De(),f.sibling=null,E=Va.current,Vt(Va,W?E&1|2:E&1),zs&&gu(y,P.treeForkCount),f):(Ks(y),null);case 22:case 23:return Kl(y),ka(),P=y.memoizedState!==null,f!==null?f.memoizedState!==null!==P&&(y.flags|=8192):P&&(y.flags|=8192),P?(E&536870912)!==0&&(y.flags&128)===0&&(Ks(y),y.subtreeFlags&6&&(y.flags|=8192)):Ks(y),E=y.updateQueue,E!==null&&oh(y,E.retryQueue),E=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(E=f.memoizedState.cachePool.pool),P=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(P=y.memoizedState.cachePool.pool),P!==E&&(y.flags|=2048),f!==null&&Et(Qu),null;case 24:return E=null,f!==null&&(E=f.memoizedState.cache),y.memoizedState.cache!==E&&(y.flags|=2048),zc(nr),Ks(y),null;case 25:return null;case 30:return null}throw Error(l(156,y.tag))}function Ym(f,y){switch(Wl(y),y.tag){case 1:return f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 3:return zc(nr),Ui(),f=y.flags,(f&65536)!==0&&(f&128)===0?(y.flags=f&-65537|128,y):null;case 26:case 27:case 5:return Fn(y),null;case 31:if(y.memoizedState!==null){if(Kl(y),y.alternate===null)throw Error(l(340));yu()}return f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 13:if(Kl(y),f=y.memoizedState,f!==null&&f.dehydrated!==null){if(y.alternate===null)throw Error(l(340));yu()}return f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 19:return Et(Va),null;case 4:return Ui(),null;case 10:return zc(y.type),null;case 22:case 23:return Kl(y),ka(),f!==null&&Et(Qu),f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 24:return zc(nr),null;case 25:return null;default:return null}}function lh(f,y){switch(Wl(y),y.tag){case 3:zc(nr),Ui();break;case 26:case 27:case 5:Fn(y);break;case 4:Ui();break;case 31:y.memoizedState!==null&&Kl(y);break;case 13:Kl(y);break;case 19:Et(Va);break;case 10:zc(y.type);break;case 22:case 23:Kl(y),ka(),f!==null&&Et(Qu);break;case 24:zc(nr)}}function $c(f,y){try{var E=y.updateQueue,P=E!==null?E.lastEffect:null;if(P!==null){var W=P.next;E=W;do{if((E.tag&f)===f){P=void 0;var J=E.create,ve=E.inst;P=J(),ve.destroy=P}E=E.next}while(E!==W)}}catch(Xe){ks(y,y.return,Xe)}}function pl(f,y,E){try{var P=y.updateQueue,W=P!==null?P.lastEffect:null;if(W!==null){var J=W.next;P=J;do{if((P.tag&f)===f){var ve=P.inst,Xe=ve.destroy;if(Xe!==void 0){ve.destroy=void 0,W=y;var Ct=E,_i=Xe;try{_i()}catch(Hi){ks(W,Ct,Hi)}}}P=P.next}while(P!==J)}}catch(Hi){ks(y,y.return,Hi)}}function Jc(f){var y=f.updateQueue;if(y!==null){var E=f.stateNode;try{Yo(y,E)}catch(P){ks(f,f.return,P)}}}function Pf(f,y,E){E.props=To(f.type,f.memoizedProps),E.state=f.memoizedState;try{E.componentWillUnmount()}catch(P){ks(f,y,P)}}function Fo(f,y){try{var E=f.ref;if(E!==null){switch(f.tag){case 26:case 27:case 5:var P=f.stateNode;break;case 30:P=f.stateNode;break;default:P=f.stateNode}typeof E=="function"?f.refCleanup=E(P):E.current=P}}catch(W){ks(f,y,W)}}function so(f,y){var E=f.ref,P=f.refCleanup;if(E!==null)if(typeof P=="function")try{P()}catch(W){ks(f,y,W)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof E=="function")try{E(null)}catch(W){ks(f,y,W)}else E.current=null}function ao(f){var y=f.type,E=f.memoizedProps,P=f.stateNode;try{e:switch(y){case"button":case"input":case"select":case"textarea":E.autoFocus&&P.focus();break e;case"img":E.src?P.src=E.src:E.srcSet&&(P.srcset=E.srcSet)}}catch(W){ks(f,f.return,W)}}function Ao(f,y,E){try{var P=f.stateNode;fE(P,f.type,E,y),P[ge]=y}catch(W){ks(f,f.return,W)}}function na(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&sm(f.type)||f.tag===4}function ch(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||na(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&sm(f.type)||f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function gs(f,y,E){var P=f.tag;if(P===5||P===6)f=f.stateNode,y?(E.nodeType===9?E.body:E.nodeName==="HTML"?E.ownerDocument.body:E).insertBefore(f,y):(y=E.nodeType===9?E.body:E.nodeName==="HTML"?E.ownerDocument.body:E,y.appendChild(f),E=E._reactRootContainer,E!=null||y.onclick!==null||(y.onclick=Ka));else if(P!==4&&(P===27&&sm(f.type)&&(E=f.stateNode,y=null),f=f.child,f!==null))for(gs(f,y,E),f=f.sibling;f!==null;)gs(f,y,E),f=f.sibling}function ta(f,y,E){var P=f.tag;if(P===5||P===6)f=f.stateNode,y?E.insertBefore(f,y):E.appendChild(f);else if(P!==4&&(P===27&&sm(f.type)&&(E=f.stateNode),f=f.child,f!==null))for(ta(f,y,E),f=f.sibling;f!==null;)ta(f,y,E),f=f.sibling}function oo(f){var y=f.stateNode,E=f.memoizedProps;try{for(var P=f.type,W=y.attributes;W.length;)y.removeAttributeNode(W[0]);wc(y,P,E),y[oe]=f,y[ge]=E}catch(J){ks(f,f.return,J)}}var tc=!1,cs=!1,go=!1,zf=typeof WeakSet=="function"?WeakSet:Set,Wa=null;function Du(f,y){if(f=f.containerInfo,Pv=Lg,f=Al(f),Hu(f)){if("selectionStart"in f)var E={start:f.selectionStart,end:f.selectionEnd};else e:{E=(E=f.ownerDocument)&&E.defaultView||window;var P=E.getSelection&&E.getSelection();if(P&&P.rangeCount!==0){E=P.anchorNode;var W=P.anchorOffset,J=P.focusNode;P=P.focusOffset;try{E.nodeType,J.nodeType}catch{E=null;break e}var ve=0,Xe=-1,Ct=-1,_i=0,Hi=0,nn=f,wi=null;t:for(;;){for(var Ci;nn!==E||W!==0&&nn.nodeType!==3||(Xe=ve+W),nn!==J||P!==0&&nn.nodeType!==3||(Ct=ve+P),nn.nodeType===3&&(ve+=nn.nodeValue.length),(Ci=nn.firstChild)!==null;)wi=nn,nn=Ci;for(;;){if(nn===f)break t;if(wi===E&&++_i===W&&(Xe=ve),wi===J&&++Hi===P&&(Ct=ve),(Ci=nn.nextSibling)!==null)break;nn=wi,wi=nn.parentNode}nn=Ci}E=Xe===-1||Ct===-1?null:{start:Xe,end:Ct}}else E=null}E=E||{start:0,end:0}}else E=null;for(g0={focusedElem:f,selectionRange:E},Lg=!1,Wa=y;Wa!==null;)if(y=Wa,f=y.child,(y.subtreeFlags&1028)!==0&&f!==null)f.return=y,Wa=f;else for(;Wa!==null;){switch(y=Wa,J=y.alternate,f=y.flags,y.tag){case 0:if((f&4)!==0&&(f=y.updateQueue,f=f!==null?f.events:null,f!==null))for(E=0;E<f.length;E++)W=f[E],W.ref.impl=W.nextImpl;break;case 11:case 15:break;case 1:if((f&1024)!==0&&J!==null){f=void 0,E=y,W=J.memoizedProps,J=J.memoizedState,P=E.stateNode;try{var mr=To(E.type,W);f=P.getSnapshotBeforeUpdate(mr,J),P.__reactInternalSnapshotBeforeUpdate=f}catch(Cr){ks(E,E.return,Cr)}}break;case 3:if((f&1024)!==0){if(f=y.stateNode.containerInfo,E=f.nodeType,E===9)Ig(f);else if(E===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":Ig(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(l(163))}if(f=y.sibling,f!==null){f.return=y.return,Wa=f;break}Wa=y.return}}function Km(f,y,E){var P=E.flags;switch(E.tag){case 0:case 11:case 15:H(f,E),P&4&&$c(5,E);break;case 1:if(H(f,E),P&4)if(f=E.stateNode,y===null)try{f.componentDidMount()}catch(ve){ks(E,E.return,ve)}else{var W=To(E.type,y.memoizedProps);y=y.memoizedState;try{f.componentDidUpdate(W,y,f.__reactInternalSnapshotBeforeUpdate)}catch(ve){ks(E,E.return,ve)}}P&64&&Jc(E),P&512&&Fo(E,E.return);break;case 3:if(H(f,E),P&64&&(f=E.updateQueue,f!==null)){if(y=null,E.child!==null)switch(E.child.tag){case 27:case 5:y=E.child.stateNode;break;case 1:y=E.child.stateNode}try{Yo(f,y)}catch(ve){ks(E,E.return,ve)}}break;case 27:y===null&&P&4&&oo(E);case 26:case 5:H(f,E),y===null&&P&4&&ao(E),P&512&&Fo(E,E.return);break;case 12:H(f,E);break;case 31:H(f,E),P&4&&s(f,E);break;case 13:H(f,E),P&4&&c(f,E),P&64&&(f=E.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(E=Mv.bind(null,E),am(f,E))));break;case 22:if(P=E.memoizedState!==null||tc,!P){y=y!==null&&y.memoizedState!==null||cs,W=tc;var J=cs;tc=P,(cs=y)&&!J?K(f,E,(E.subtreeFlags&8772)!==0):H(f,E),tc=W,cs=J}break;case 30:break;default:H(f,E)}}function zl(f){var y=f.alternate;y!==null&&(f.alternate=null,zl(y)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(y=f.stateNode,y!==null&&Tt(y)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var rs=null,wa=!1;function lo(f,y,E){for(E=E.child;E!==null;)p(f,y,E),E=E.sibling}function p(f,y,E){if(qi&&typeof qi.onCommitFiberUnmount=="function")try{qi.onCommitFiberUnmount(Qi,E)}catch{}switch(E.tag){case 26:cs||so(E,y),lo(f,y,E),E.memoizedState?E.memoizedState.count--:E.stateNode&&(E=E.stateNode,E.parentNode.removeChild(E));break;case 27:cs||so(E,y);var P=rs,W=wa;sm(E.type)&&(rs=E.stateNode,wa=!1),lo(f,y,E),Jm(E.stateNode),rs=P,wa=W;break;case 5:cs||so(E,y);case 6:if(P=rs,W=wa,rs=null,lo(f,y,E),rs=P,wa=W,rs!==null)if(wa)try{(rs.nodeType===9?rs.body:rs.nodeName==="HTML"?rs.ownerDocument.body:rs).removeChild(E.stateNode)}catch(J){ks(E,y,J)}else try{rs.removeChild(E.stateNode)}catch(J){ks(E,y,J)}break;case 18:rs!==null&&(wa?(f=rs,__(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,E.stateNode),um(f)):__(rs,E.stateNode));break;case 4:P=rs,W=wa,rs=E.stateNode.containerInfo,wa=!0,lo(f,y,E),rs=P,wa=W;break;case 0:case 11:case 14:case 15:pl(2,E,y),cs||pl(4,E,y),lo(f,y,E);break;case 1:cs||(so(E,y),P=E.stateNode,typeof P.componentWillUnmount=="function"&&Pf(E,y,P)),lo(f,y,E);break;case 21:lo(f,y,E);break;case 22:cs=(P=cs)||E.memoizedState!==null,lo(f,y,E),cs=P;break;default:lo(f,y,E)}}function s(f,y){if(y.memoizedState===null&&(f=y.alternate,f!==null&&(f=f.memoizedState,f!==null))){f=f.dehydrated;try{um(f)}catch(E){ks(y,y.return,E)}}}function c(f,y){if(y.memoizedState===null&&(f=y.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{um(f)}catch(E){ks(y,y.return,E)}}function m(f){switch(f.tag){case 31:case 13:case 19:var y=f.stateNode;return y===null&&(y=f.stateNode=new zf),y;case 22:return f=f.stateNode,y=f._retryCache,y===null&&(y=f._retryCache=new zf),y;default:throw Error(l(435,f.tag))}}function b(f,y){var E=m(f);y.forEach(function(P){if(!E.has(P)){E.add(P);var W=h0.bind(null,f,P);P.then(W,W)}})}function M(f,y){var E=y.deletions;if(E!==null)for(var P=0;P<E.length;P++){var W=E[P],J=f,ve=y,Xe=ve;e:for(;Xe!==null;){switch(Xe.tag){case 27:if(sm(Xe.type)){rs=Xe.stateNode,wa=!1;break e}break;case 5:rs=Xe.stateNode,wa=!1;break e;case 3:case 4:rs=Xe.stateNode.containerInfo,wa=!0;break e}Xe=Xe.return}if(rs===null)throw Error(l(160));p(J,ve,W),rs=null,wa=!1,J=W.alternate,J!==null&&(J.return=null),W.return=null}if(y.subtreeFlags&13886)for(y=y.child;y!==null;)D(y,f),y=y.sibling}var A=null;function D(f,y){var E=f.alternate,P=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:M(y,f),O(f),P&4&&(pl(3,f,f.return),$c(3,f),pl(5,f,f.return));break;case 1:M(y,f),O(f),P&512&&(cs||E===null||so(E,E.return)),P&64&&tc&&(f=f.updateQueue,f!==null&&(P=f.callbacks,P!==null&&(E=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=E===null?P:E.concat(P))));break;case 26:var W=A;if(M(y,f),O(f),P&512&&(cs||E===null||so(E,E.return)),P&4){var J=E!==null?E.memoizedState:null;if(P=f.memoizedState,E===null)if(P===null)if(f.stateNode===null){e:{P=f.type,E=f.memoizedProps,W=W.ownerDocument||W;t:switch(P){case"title":J=W.getElementsByTagName("title")[0],(!J||J[lt]||J[oe]||J.namespaceURI==="http://www.w3.org/2000/svg"||J.hasAttribute("itemprop"))&&(J=W.createElement(P),W.head.insertBefore(J,W.querySelector("head > title"))),wc(J,P,E),J[oe]=f,ht(J),P=J;break e;case"link":var ve=w0("link","href",W).get(P+(E.href||""));if(ve){for(var Xe=0;Xe<ve.length;Xe++)if(J=ve[Xe],J.getAttribute("href")===(E.href==null||E.href===""?null:E.href)&&J.getAttribute("rel")===(E.rel==null?null:E.rel)&&J.getAttribute("title")===(E.title==null?null:E.title)&&J.getAttribute("crossorigin")===(E.crossOrigin==null?null:E.crossOrigin)){ve.splice(Xe,1);break t}}J=W.createElement(P),wc(J,P,E),W.head.appendChild(J);break;case"meta":if(ve=w0("meta","content",W).get(P+(E.content||""))){for(Xe=0;Xe<ve.length;Xe++)if(J=ve[Xe],J.getAttribute("content")===(E.content==null?null:""+E.content)&&J.getAttribute("name")===(E.name==null?null:E.name)&&J.getAttribute("property")===(E.property==null?null:E.property)&&J.getAttribute("http-equiv")===(E.httpEquiv==null?null:E.httpEquiv)&&J.getAttribute("charset")===(E.charSet==null?null:E.charSet)){ve.splice(Xe,1);break t}}J=W.createElement(P),wc(J,P,E),W.head.appendChild(J);break;default:throw Error(l(468,P))}J[oe]=f,ht(J),P=J}f.stateNode=P}else jv(W,f.type,f.stateNode);else f.stateNode=Hv(W,P,f.memoizedProps);else J!==P?(J===null?E.stateNode!==null&&(E=E.stateNode,E.parentNode.removeChild(E)):J.count--,P===null?jv(W,f.type,f.stateNode):Hv(W,P,f.memoizedProps)):P===null&&f.stateNode!==null&&Ao(f,f.memoizedProps,E.memoizedProps)}break;case 27:M(y,f),O(f),P&512&&(cs||E===null||so(E,E.return)),E!==null&&P&4&&Ao(f,f.memoizedProps,E.memoizedProps);break;case 5:if(M(y,f),O(f),P&512&&(cs||E===null||so(E,E.return)),f.flags&32){W=f.stateNode;try{Ul(W,"")}catch(mr){ks(f,f.return,mr)}}P&4&&f.stateNode!=null&&(W=f.memoizedProps,Ao(f,W,E!==null?E.memoizedProps:W)),P&1024&&(go=!0);break;case 6:if(M(y,f),O(f),P&4){if(f.stateNode===null)throw Error(l(162));P=f.memoizedProps,E=f.stateNode;try{E.nodeValue=P}catch(mr){ks(f,f.return,mr)}}break;case 3:if(w_=null,W=A,A=y_(y.containerInfo),M(y,f),A=W,O(f),P&4&&E!==null&&E.memoizedState.isDehydrated)try{um(y.containerInfo)}catch(mr){ks(f,f.return,mr)}go&&(go=!1,V(f));break;case 4:P=A,A=y_(f.stateNode.containerInfo),M(y,f),O(f),A=P;break;case 12:M(y,f),O(f);break;case 31:M(y,f),O(f),P&4&&(P=f.updateQueue,P!==null&&(f.updateQueue=null,b(f,P)));break;case 13:M(y,f),O(f),f.child.flags&8192&&f.memoizedState!==null!=(E!==null&&E.memoizedState!==null)&&(lr=De()),P&4&&(P=f.updateQueue,P!==null&&(f.updateQueue=null,b(f,P)));break;case 22:W=f.memoizedState!==null;var Ct=E!==null&&E.memoizedState!==null,_i=tc,Hi=cs;if(tc=_i||W,cs=Hi||Ct,M(y,f),cs=Hi,tc=_i,O(f),P&8192)e:for(y=f.stateNode,y._visibility=W?y._visibility&-2:y._visibility|1,W&&(E===null||Ct||tc||cs||Q(f)),E=null,y=f;;){if(y.tag===5||y.tag===26){if(E===null){Ct=E=y;try{if(J=Ct.stateNode,W)ve=J.style,typeof ve.setProperty=="function"?ve.setProperty("display","none","important"):ve.display="none";else{Xe=Ct.stateNode;var nn=Ct.memoizedProps.style,wi=nn!=null&&nn.hasOwnProperty("display")?nn.display:null;Xe.style.display=wi==null||typeof wi=="boolean"?"":(""+wi).trim()}}catch(mr){ks(Ct,Ct.return,mr)}}}else if(y.tag===6){if(E===null){Ct=y;try{Ct.stateNode.nodeValue=W?"":Ct.memoizedProps}catch(mr){ks(Ct,Ct.return,mr)}}}else if(y.tag===18){if(E===null){Ct=y;try{var Ci=Ct.stateNode;W?Fy(Ci,!0):Fy(Ct.stateNode,!1)}catch(mr){ks(Ct,Ct.return,mr)}}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===f)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===f)break e;for(;y.sibling===null;){if(y.return===null||y.return===f)break e;E===y&&(E=null),y=y.return}E===y&&(E=null),y.sibling.return=y.return,y=y.sibling}P&4&&(P=f.updateQueue,P!==null&&(E=P.retryQueue,E!==null&&(P.retryQueue=null,b(f,E))));break;case 19:M(y,f),O(f),P&4&&(P=f.updateQueue,P!==null&&(f.updateQueue=null,b(f,P)));break;case 30:break;case 21:break;default:M(y,f),O(f)}}function O(f){var y=f.flags;if(y&2){try{for(var E,P=f.return;P!==null;){if(na(P)){E=P;break}P=P.return}if(E==null)throw Error(l(160));switch(E.tag){case 27:var W=E.stateNode,J=ch(f);ta(f,J,W);break;case 5:var ve=E.stateNode;E.flags&32&&(Ul(ve,""),E.flags&=-33);var Xe=ch(f);ta(f,Xe,ve);break;case 3:case 4:var Ct=E.stateNode.containerInfo,_i=ch(f);gs(f,_i,Ct);break;default:throw Error(l(161))}}catch(Hi){ks(f,f.return,Hi)}f.flags&=-3}y&4096&&(f.flags&=-4097)}function V(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var y=f;V(y),y.tag===5&&y.flags&1024&&y.stateNode.reset(),f=f.sibling}}function H(f,y){if(y.subtreeFlags&8772)for(y=y.child;y!==null;)Km(f,y.alternate,y),y=y.sibling}function Q(f){for(f=f.child;f!==null;){var y=f;switch(y.tag){case 0:case 11:case 14:case 15:pl(4,y,y.return),Q(y);break;case 1:so(y,y.return);var E=y.stateNode;typeof E.componentWillUnmount=="function"&&Pf(y,y.return,E),Q(y);break;case 27:Jm(y.stateNode);case 26:case 5:so(y,y.return),Q(y);break;case 22:y.memoizedState===null&&Q(y);break;case 30:Q(y);break;default:Q(y)}f=f.sibling}}function K(f,y,E){for(E=E&&(y.subtreeFlags&8772)!==0,y=y.child;y!==null;){var P=y.alternate,W=f,J=y,ve=J.flags;switch(J.tag){case 0:case 11:case 15:K(W,J,E),$c(4,J);break;case 1:if(K(W,J,E),P=J,W=P.stateNode,typeof W.componentDidMount=="function")try{W.componentDidMount()}catch(_i){ks(P,P.return,_i)}if(P=J,W=P.updateQueue,W!==null){var Xe=P.stateNode;try{var Ct=W.shared.hiddenCallbacks;if(Ct!==null)for(W.shared.hiddenCallbacks=null,W=0;W<Ct.length;W++)sh(Ct[W],Xe)}catch(_i){ks(P,P.return,_i)}}E&&ve&64&&Jc(J),Fo(J,J.return);break;case 27:oo(J);case 26:case 5:K(W,J,E),E&&P===null&&ve&4&&ao(J),Fo(J,J.return);break;case 12:K(W,J,E);break;case 31:K(W,J,E),E&&ve&4&&s(W,J);break;case 13:K(W,J,E),E&&ve&4&&c(W,J);break;case 22:J.memoizedState===null&&K(W,J,E),Fo(J,J.return);break;case 30:break;default:K(W,J,E)}y=y.sibling}}function ee(f,y){var E=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(E=f.memoizedState.cachePool.pool),f=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(f=y.memoizedState.cachePool.pool),f!==E&&(f!=null&&f.refCount++,E!=null&&to(E))}function le(f,y){f=null,y.alternate!==null&&(f=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==f&&(y.refCount++,f!=null&&to(f))}function se(f,y,E,P){if(y.subtreeFlags&10256)for(y=y.child;y!==null;)pe(f,y,E,P),y=y.sibling}function pe(f,y,E,P){var W=y.flags;switch(y.tag){case 0:case 11:case 15:se(f,y,E,P),W&2048&&$c(9,y);break;case 1:se(f,y,E,P);break;case 3:se(f,y,E,P),W&2048&&(f=null,y.alternate!==null&&(f=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==f&&(y.refCount++,f!=null&&to(f)));break;case 12:if(W&2048){se(f,y,E,P),f=y.stateNode;try{var J=y.memoizedProps,ve=J.id,Xe=J.onPostCommit;typeof Xe=="function"&&Xe(ve,y.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(Ct){ks(y,y.return,Ct)}}else se(f,y,E,P);break;case 31:se(f,y,E,P);break;case 13:se(f,y,E,P);break;case 23:break;case 22:J=y.stateNode,ve=y.alternate,y.memoizedState!==null?J._visibility&2?se(f,y,E,P):be(f,y):J._visibility&2?se(f,y,E,P):(J._visibility|=2,de(f,y,E,P,(y.subtreeFlags&10256)!==0||!1)),W&2048&&ee(ve,y);break;case 24:se(f,y,E,P),W&2048&&le(y.alternate,y);break;default:se(f,y,E,P)}}function de(f,y,E,P,W){for(W=W&&((y.subtreeFlags&10256)!==0||!1),y=y.child;y!==null;){var J=f,ve=y,Xe=E,Ct=P,_i=ve.flags;switch(ve.tag){case 0:case 11:case 15:de(J,ve,Xe,Ct,W),$c(8,ve);break;case 23:break;case 22:var Hi=ve.stateNode;ve.memoizedState!==null?Hi._visibility&2?de(J,ve,Xe,Ct,W):be(J,ve):(Hi._visibility|=2,de(J,ve,Xe,Ct,W)),W&&_i&2048&&ee(ve.alternate,ve);break;case 24:de(J,ve,Xe,Ct,W),W&&_i&2048&&le(ve.alternate,ve);break;default:de(J,ve,Xe,Ct,W)}y=y.sibling}}function be(f,y){if(y.subtreeFlags&10256)for(y=y.child;y!==null;){var E=f,P=y,W=P.flags;switch(P.tag){case 22:be(E,P),W&2048&&ee(P.alternate,P);break;case 24:be(E,P),W&2048&&le(P.alternate,P);break;default:be(E,P)}y=y.sibling}}var Me=8192;function we(f,y,E){if(f.subtreeFlags&Me)for(f=f.child;f!==null;)Ue(f,y,E),f=f.sibling}function Ue(f,y,E){switch(f.tag){case 26:we(f,y,E),f.flags&Me&&f.memoizedState!==null&&kw(E,A,f.memoizedState,f.memoizedProps);break;case 5:we(f,y,E);break;case 3:case 4:var P=A;A=y_(f.stateNode.containerInfo),we(f,y,E),A=P;break;case 22:f.memoizedState===null&&(P=f.alternate,P!==null&&P.memoizedState!==null?(P=Me,Me=16777216,we(f,y,E),Me=P):we(f,y,E));break;default:we(f,y,E)}}function Pe(f){var y=f.alternate;if(y!==null&&(f=y.child,f!==null)){y.child=null;do y=f.sibling,f.sibling=null,f=y;while(f!==null)}}function Ne(f){var y=f.deletions;if((f.flags&16)!==0){if(y!==null)for(var E=0;E<y.length;E++){var P=y[E];Wa=P,Ye(P,f)}Pe(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)Oe(f),f=f.sibling}function Oe(f){switch(f.tag){case 0:case 11:case 15:Ne(f),f.flags&2048&&pl(9,f,f.return);break;case 3:Ne(f);break;case 12:Ne(f);break;case 22:var y=f.stateNode;f.memoizedState!==null&&y._visibility&2&&(f.return===null||f.return.tag!==13)?(y._visibility&=-3,Le(f)):Ne(f);break;default:Ne(f)}}function Le(f){var y=f.deletions;if((f.flags&16)!==0){if(y!==null)for(var E=0;E<y.length;E++){var P=y[E];Wa=P,Ye(P,f)}Pe(f)}for(f=f.child;f!==null;){switch(y=f,y.tag){case 0:case 11:case 15:pl(8,y,y.return),Le(y);break;case 22:E=y.stateNode,E._visibility&2&&(E._visibility&=-3,Le(y));break;default:Le(y)}f=f.sibling}}function Ye(f,y){for(;Wa!==null;){var E=Wa;switch(E.tag){case 0:case 11:case 15:pl(8,E,y);break;case 23:case 22:if(E.memoizedState!==null&&E.memoizedState.cachePool!==null){var P=E.memoizedState.cachePool.pool;P!=null&&P.refCount++}break;case 24:to(E.memoizedState.cache)}if(P=E.child,P!==null)P.return=E,Wa=P;else e:for(E=f;Wa!==null;){P=Wa;var W=P.sibling,J=P.return;if(zl(P),P===E){Wa=null;break e}if(W!==null){W.return=J,Wa=W;break e}Wa=J}}}var ct={getCacheForType:function(f){var y=bo(nr),E=y.data.get(f);return E===void 0&&(E=f(),y.data.set(f,E)),E},cacheSignal:function(){return bo(nr).controller.signal}},rt=typeof WeakMap=="function"?WeakMap:Map,_t=0,xt=null,St=null,Ft=0,nt=0,qe=null,yt=!1,pt=!1,Ut=!1,ei=0,vi=0,ni=0,ti=0,Zi=0,Si=0,Ai=0,Oi=null,an=null,Mn=!1,lr=0,Lr=0,Yi=1/0,Ir=null,Dn=null,er=0,Pr=null,Sr=null,pr=0,qn=0,zr=null,Os=null,us=0,Nr=null;function rr(){return(_t&2)!==0&&Ft!==0?Ft&-Ft:Re.T!==null?Py():Lo()}function w(){if(Si===0)if((Ft&536870912)===0||zs){var f=vn;vn<<=1,(vn&3932160)===0&&(vn=262144),Si=f}else Si=536870912;return f=La.current,f!==null&&(f.flags|=32),Si}function T(f,y,E){(f===xt&&(nt===2||nt===9)||f.cancelPendingCommit!==null)&&(Ht(f,0),fe(f,Ft,Si,!1)),Xt(f,E),((_t&2)===0||f!==xt)&&(f===xt&&((_t&2)===0&&(ti|=E),vi===4&&fe(f,Ft,Si,!1)),bc(f))}function B(f,y,E){if((_t&6)!==0)throw Error(l(327));var P=!E&&(y&127)===0&&(y&f.expiredLanes)===0||Kn(f,y),W=P?Yr(f,y):is(f,y,!0),J=P;do{if(W===0){pt&&!P&&fe(f,y,0,!1);break}else{if(E=f.current.alternate,J&&!te(E)){W=is(f,y,!1),J=!1;continue}if(W===2){if(J=y,f.errorRecoveryDisabledLanes&J)var ve=0;else ve=f.pendingLanes&-536870913,ve=ve!==0?ve:ve&536870912?536870912:0;if(ve!==0){y=ve;e:{var Xe=f;W=Oi;var Ct=Xe.current.memoizedState.isDehydrated;if(Ct&&(Ht(Xe,ve).flags|=256),ve=is(Xe,ve,!1),ve!==2){if(Ut&&!Ct){Xe.errorRecoveryDisabledLanes|=J,ti|=J,W=4;break e}J=an,an=W,J!==null&&(an===null?an=J:an.push.apply(an,J))}W=ve}if(J=!1,W!==2)continue}}if(W===1){Ht(f,0),fe(f,y,0,!0);break}e:{switch(P=f,J=W,J){case 0:case 1:throw Error(l(345));case 4:if((y&4194048)!==y)break;case 6:fe(P,y,Si,!yt);break e;case 2:an=null;break;case 3:case 5:break;default:throw Error(l(329))}if((y&62914560)===y&&(W=lr+300-De(),10<W)){if(fe(P,y,Si,!yt),zi(P,0,!0)!==0)break e;pr=y,P.timeoutHandle=Bv(q.bind(null,P,E,an,Ir,Mn,y,Si,ti,Ai,yt,J,"Throttled",-0,0),W);break e}q(P,E,an,Ir,Mn,y,Si,ti,Ai,yt,J,null,-0,0)}}break}while(!0);bc(f)}function q(f,y,E,P,W,J,ve,Xe,Ct,_i,Hi,nn,wi,Ci){if(f.timeoutHandle=-1,nn=y.subtreeFlags,nn&8192||(nn&16785408)===16785408){nn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ka},Ue(y,J,nn);var mr=(J&62914560)===J?lr-De():(J&4194048)===J?Lr-De():0;if(mr=Vw(nn,mr),mr!==null){pr=J,f.cancelPendingCommit=mr(Hr.bind(null,f,y,J,E,P,W,ve,Xe,Ct,Hi,nn,null,wi,Ci)),fe(f,J,ve,!_i);return}}Hr(f,y,J,E,P,W,ve,Xe,Ct)}function te(f){for(var y=f;;){var E=y.tag;if((E===0||E===11||E===15)&&y.flags&16384&&(E=y.updateQueue,E!==null&&(E=E.stores,E!==null)))for(var P=0;P<E.length;P++){var W=E[P],J=W.getSnapshot;W=W.value;try{if(!ts(J(),W))return!1}catch{return!1}}if(E=y.child,y.subtreeFlags&16384&&E!==null)E.return=y,y=E;else{if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function fe(f,y,E,P){y&=~Zi,y&=~ti,f.suspendedLanes|=y,f.pingedLanes&=~y,P&&(f.warmLanes|=y),P=f.expirationTimes;for(var W=y;0<W;){var J=31-Qn(W),ve=1<<J;P[J]=-1,W&=~ve}E!==0&&$f(f,E,y)}function We(){return(_t&6)===0?(h_(0),!1):!0}function vt(){if(St!==null){if(nt===0)var f=St.return;else f=St,Zo=Zl=null,yd(f),th=null,ih=0,f=St;for(;f!==null;)lh(f.alternate,f),f=f.return;St=null}}function Ht(f,y){var E=f.timeoutHandle;E!==-1&&(f.timeoutHandle=-1,Ny(E)),E=f.cancelPendingCommit,E!==null&&(f.cancelPendingCommit=null,E()),pr=0,vt(),xt=f,St=E=ol(f.current,null),Ft=y,nt=0,qe=null,yt=!1,pt=Kn(f,y),Ut=!1,Ai=Si=Zi=ti=ni=vi=0,an=Oi=null,Mn=!1,(y&8)!==0&&(y|=y&32);var P=f.entangledLanes;if(P!==0)for(f=f.entanglements,P&=y;0<P;){var W=31-Qn(P),J=1<<W;y|=f[W],P&=~J}return ei=y,fu(),E}function Ri(f,y){oi=null,Re.H=Af,y===xf||y===Nc?(y=jp(),nt=3):y===Gp?(y=jp(),nt=4):nt=y===Ad?8:y!==null&&typeof y=="object"&&typeof y.then=="function"?6:1,qe=y,St===null&&(vi=1,dp(f,eo(y,f.current)))}function on(){var f=La.current;return f===null?!0:(Ft&4194048)===Ft?Oo===null:(Ft&62914560)===Ft||(Ft&536870912)!==0?f===Oo:!1}function En(){var f=Re.H;return Re.H=Af,f===null?Af:f}function On(){var f=Re.A;return Re.A=ct,f}function br(){vi=4,yt||(Ft&4194048)!==Ft&&La.current!==null||(pt=!0),(ni&134217727)===0&&(ti&134217727)===0||xt===null||fe(xt,Ft,Si,!1)}function is(f,y,E){var P=_t;_t|=2;var W=En(),J=On();(xt!==f||Ft!==y)&&(Ir=null,Ht(f,y)),y=!1;var ve=vi;e:do try{if(nt!==0&&St!==null){var Xe=St,Ct=qe;switch(nt){case 8:vt(),ve=6;break e;case 3:case 2:case 9:case 6:La.current===null&&(y=!0);var _i=nt;if(nt=0,qe=null,ln(f,Xe,Ct,_i),E&&pt){ve=0;break e}break;default:_i=nt,nt=0,qe=null,ln(f,Xe,Ct,_i)}}$s(),ve=vi;break}catch(Hi){Ri(f,Hi)}while(!0);return y&&f.shellSuspendCounter++,Zo=Zl=null,_t=P,Re.H=W,Re.A=J,St===null&&(xt=null,Ft=0,fu()),ve}function $s(){for(;St!==null;)Pt(St)}function Yr(f,y){var E=_t;_t|=2;var P=En(),W=On();xt!==f||Ft!==y?(Ir=null,Yi=De()+500,Ht(f,y)):pt=Kn(f,y);e:do try{if(nt!==0&&St!==null){y=St;var J=qe;t:switch(nt){case 1:nt=0,qe=null,ln(f,y,J,1);break;case 2:case 9:if(Hp(J)){nt=0,qe=null,$t(y);break}y=function(){nt!==2&&nt!==9||xt!==f||(nt=7),bc(f)},J.then(y,y);break e;case 3:nt=7;break e;case 4:nt=5;break e;case 7:Hp(J)?(nt=0,qe=null,$t(y)):(nt=0,qe=null,ln(f,y,J,7));break;case 5:var ve=null;switch(St.tag){case 26:ve=St.memoizedState;case 5:case 27:var Xe=St;if(ve?Hy(ve):Xe.stateNode.complete){nt=0,qe=null;var Ct=Xe.sibling;if(Ct!==null)St=Ct;else{var _i=Xe.return;_i!==null?(St=_i,_r(_i)):St=null}break t}}nt=0,qe=null,ln(f,y,J,5);break;case 6:nt=0,qe=null,ln(f,y,J,6);break;case 8:vt(),vi=6;break e;default:throw Error(l(462))}}Kt();break}catch(Hi){Ri(f,Hi)}while(!0);return Zo=Zl=null,Re.H=P,Re.A=W,_t=E,St!==null?0:(xt=null,Ft=0,fu(),vi)}function Kt(){for(;St!==null&&!Gn();)Pt(St)}function Pt(f){var y=_a(f.alternate,f,ei);f.memoizedProps=f.pendingProps,y===null?_r(f):St=y}function $t(f){var y=f,E=y.alternate;switch(y.tag){case 15:case 0:y=Eo(E,y,y.pendingProps,y.type,void 0,Ft);break;case 11:y=Eo(E,y,y.pendingProps,y.type.render,y.ref,Ft);break;case 5:yd(y);default:lh(E,y),y=St=Ua(y,ei),y=_a(E,y,ei)}f.memoizedProps=f.pendingProps,y===null?_r(f):St=y}function ln(f,y,E,P){Zo=Zl=null,yd(y),th=null,ih=0;var W=y.return;try{if(Ll(f,W,y,E,Ft)){vi=1,dp(f,eo(E,f.current)),St=null;return}}catch(J){if(W!==null)throw St=W,J;vi=1,dp(f,eo(E,f.current)),St=null;return}y.flags&32768?(zs||P===1?f=!0:pt||(Ft&536870912)!==0?f=!1:(yt=f=!0,(P===2||P===9||P===3||P===6)&&(P=La.current,P!==null&&P.tag===13&&(P.flags|=16384))),Bs(y,f)):_r(y)}function _r(f){var y=f;do{if((y.flags&32768)!==0){Bs(y,yt);return}f=y.return;var E=_p(y.alternate,y,ei);if(E!==null){St=E;return}if(y=y.sibling,y!==null){St=y;return}St=y=f}while(y!==null);vi===0&&(vi=5)}function Bs(f,y){do{var E=Ym(f.alternate,f);if(E!==null){E.flags&=32767,St=E;return}if(E=f.return,E!==null&&(E.flags|=32768,E.subtreeFlags=0,E.deletions=null),!y&&(f=f.sibling,f!==null)){St=f;return}St=f=E}while(f!==null);vi=6,St=null}function Hr(f,y,E,P,W,J,ve,Xe,Ct){f.cancelPendingCommit=null;do Lu();while(er!==0);if((_t&6)!==0)throw Error(l(327));if(y!==null){if(y===f.current)throw Error(l(177));if(J=y.lanes|y.childLanes,J|=al,ja(f,E,J,ve,Xe,Ct),f===xt&&(St=xt=null,Ft=0),Sr=y,Pr=f,pr=E,qn=J,zr=W,Os=P,(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,Dy(Ei,function(){return Of(),null})):(f.callbackNode=null,f.callbackPriority=0),P=(y.flags&13878)!==0,(y.subtreeFlags&13878)!==0||P){P=Re.T,Re.T=null,W=Qe.p,Qe.p=2,ve=_t,_t|=4;try{Du(f,y,E)}finally{_t=ve,Qe.p=W,Re.T=P}}er=1,As(),fa(),_s()}}function As(){if(er===1){er=0;var f=Pr,y=Sr,E=(y.flags&13878)!==0;if((y.subtreeFlags&13878)!==0||E){E=Re.T,Re.T=null;var P=Qe.p;Qe.p=2;var W=_t;_t|=4;try{D(y,f);var J=g0,ve=Al(f.containerInfo),Xe=J.focusedElem,Ct=J.selectionRange;if(ve!==Xe&&Xe&&Xe.ownerDocument&&ou(Xe.ownerDocument.documentElement,Xe)){if(Ct!==null&&Hu(Xe)){var _i=Ct.start,Hi=Ct.end;if(Hi===void 0&&(Hi=_i),"selectionStart"in Xe)Xe.selectionStart=_i,Xe.selectionEnd=Math.min(Hi,Xe.value.length);else{var nn=Xe.ownerDocument||document,wi=nn&&nn.defaultView||window;if(wi.getSelection){var Ci=wi.getSelection(),mr=Xe.textContent.length,Cr=Math.min(Ct.start,mr),sa=Ct.end===void 0?Cr:Math.min(Ct.end,mr);!Ci.extend&&Cr>sa&&(ve=sa,sa=Cr,Cr=ve);var Jt=Bp(Xe,Cr),Nt=Bp(Xe,sa);if(Jt&&Nt&&(Ci.rangeCount!==1||Ci.anchorNode!==Jt.node||Ci.anchorOffset!==Jt.offset||Ci.focusNode!==Nt.node||Ci.focusOffset!==Nt.offset)){var di=nn.createRange();di.setStart(Jt.node,Jt.offset),Ci.removeAllRanges(),Cr>sa?(Ci.addRange(di),Ci.extend(Nt.node,Nt.offset)):(di.setEnd(Nt.node,Nt.offset),Ci.addRange(di))}}}}for(nn=[],Ci=Xe;Ci=Ci.parentNode;)Ci.nodeType===1&&nn.push({element:Ci,left:Ci.scrollLeft,top:Ci.scrollTop});for(typeof Xe.focus=="function"&&Xe.focus(),Xe=0;Xe<nn.length;Xe++){var en=nn[Xe];en.element.scrollLeft=en.left,en.element.scrollTop=en.top}}Lg=!!Pv,g0=Pv=null}finally{_t=W,Qe.p=P,Re.T=E}}f.current=y,er=2}}function fa(){if(er===2){er=0;var f=Pr,y=Sr,E=(y.flags&8772)!==0;if((y.subtreeFlags&8772)!==0||E){E=Re.T,Re.T=null;var P=Qe.p;Qe.p=2;var W=_t;_t|=4;try{Km(f,y.alternate,y)}finally{_t=W,Qe.p=P,Re.T=E}}er=3}}function _s(){if(er===4||er===3){er=0,ot();var f=Pr,y=Sr,E=pr,P=Os;(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?er=5:(er=0,Sr=Pr=null,ic(f,f.pendingLanes));var W=f.pendingLanes;if(W===0&&(Dn=null),Bu(E),y=y.stateNode,qi&&typeof qi.onCommitFiberRoot=="function")try{qi.onCommitFiberRoot(Qi,y,void 0,(y.current.flags&128)===128)}catch{}if(P!==null){y=Re.T,W=Qe.p,Qe.p=2,Re.T=null;try{for(var J=f.onRecoverableError,ve=0;ve<P.length;ve++){var Xe=P[ve];J(Xe.value,{componentStack:Xe.stack})}}finally{Re.T=y,Qe.p=W}}(pr&3)!==0&&Lu(),bc(f),W=f.pendingLanes,(E&261930)!==0&&(W&42)!==0?f===Nr?us++:(us=0,Nr=f):us=0,h_(0)}}function ic(f,y){(f.pooledCacheLanes&=y)===0&&(y=f.pooledCache,y!=null&&(f.pooledCache=null,to(y)))}function Lu(){return As(),fa(),_s(),Of()}function Of(){if(er!==5)return!1;var f=Pr,y=qn;qn=0;var E=Bu(pr),P=Re.T,W=Qe.p;try{Qe.p=32>E?32:E,Re.T=null,E=zr,zr=null;var J=Pr,ve=pr;if(er=0,Sr=Pr=null,pr=0,(_t&6)!==0)throw Error(l(331));var Xe=_t;if(_t|=4,Oe(J.current),pe(J,J.current,ve,E),_t=Xe,h_(0,!1),qi&&typeof qi.onPostCommitFiberRoot=="function")try{qi.onPostCommitFiberRoot(Qi,J)}catch{}return!0}finally{Qe.p=W,Re.T=P,ic(f,y)}}function uh(f,y,E){y=eo(E,y),y=Xc(f.stateNode,y,2),f=rh(f,y,2),f!==null&&(Xt(f,2),bc(f))}function ks(f,y,E){if(f.tag===3)uh(f,f,E);else for(;y!==null;){if(y.tag===3){uh(y,f,E);break}else if(y.tag===1){var P=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(Dn===null||!Dn.has(P))){f=eo(E,f),E=mo(2),P=rh(y,E,2),P!==null&&(no(E,P,y,f),Xt(P,2),bc(P));break}}y=y.return}}function Iy(f,y,E){var P=f.pingCache;if(P===null){P=f.pingCache=new rt;var W=new Set;P.set(y,W)}else W=P.get(y),W===void 0&&(W=new Set,P.set(y,W));W.has(E)||(Ut=!0,W.add(E),f=vw.bind(null,f,y,E),y.then(f,f))}function vw(f,y,E){var P=f.pingCache;P!==null&&P.delete(y),f.pingedLanes|=f.suspendedLanes&E,f.warmLanes&=~E,xt===f&&(Ft&E)===E&&(vi===4||vi===3&&(Ft&62914560)===Ft&&300>De()-lr?(_t&2)===0&&Ht(f,0):Zi|=E,Ai===Ft&&(Ai=0)),bc(f)}function u0(f,y){y===0&&(y=ls()),f=du(f,y),f!==null&&(Xt(f,y),bc(f))}function Mv(f){var y=f.memoizedState,E=0;y!==null&&(E=y.retryLane),u0(f,E)}function h0(f,y){var E=0;switch(f.tag){case 31:case 13:var P=f.stateNode,W=f.memoizedState;W!==null&&(E=W.retryLane);break;case 19:P=f.stateNode;break;case 22:P=f.stateNode._retryCache;break;default:throw Error(l(314))}P!==null&&P.delete(y),u0(f,E)}function Dy(f,y){return Sn(f,y)}var f0=null,nm=null,d0=!1,u_=!1,Ly=!1,rm=0;function bc(f){f!==nm&&f.next===null&&(nm===null?f0=nm=f:nm=nm.next=f),u_=!0,d0||(d0=!0,Tw())}function h_(f,y){if(!Ly&&u_){Ly=!0;do for(var E=!1,P=f0;P!==null;){if(f!==0){var W=P.pendingLanes;if(W===0)var J=0;else{var ve=P.suspendedLanes,Xe=P.pingedLanes;J=(1<<31-Qn(42|f)+1)-1,J&=W&~(ve&~Xe),J=J&201326741?J&201326741|1:J?J|2:0}J!==0&&(E=!0,Sw(P,J))}else J=Ft,J=zi(P,P===xt?J:0,P.cancelPendingCommit!==null||P.timeoutHandle!==-1),(J&3)===0||Kn(P,J)||(E=!0,Sw(P,J));P=P.next}while(E);Ly=!1}}function Ev(){Av()}function Av(){u_=d0=!1;var f=0;rm!==0&&g_()&&(f=rm);for(var y=De(),E=null,P=f0;P!==null;){var W=P.next,J=bw(P,y);J===0?(P.next=null,E===null?f0=W:E.next=W,W===null&&(nm=E)):(E=P,(f!==0||(J&3)!==0)&&(u_=!0)),P=W}er!==0&&er!==5||h_(f),rm!==0&&(rm=0)}function bw(f,y){for(var E=f.suspendedLanes,P=f.pingedLanes,W=f.expirationTimes,J=f.pendingLanes&-62914561;0<J;){var ve=31-Qn(J),Xe=1<<ve,Ct=W[ve];Ct===-1?((Xe&E)===0||(Xe&P)!==0)&&(W[ve]=Dr(Xe,y)):Ct<=y&&(f.expiredLanes|=Xe),J&=~Xe}if(y=xt,E=Ft,E=zi(f,f===y?E:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),P=f.callbackNode,E===0||f===y&&(nt===2||nt===9)||f.cancelPendingCommit!==null)return P!==null&&P!==null&&_n(P),f.callbackNode=null,f.callbackPriority=0;if((E&3)===0||Kn(f,E)){if(y=E&-E,y===f.callbackPriority)return y;switch(P!==null&&_n(P),Bu(E)){case 2:case 8:E=Wi;break;case 32:E=Ei;break;case 268435456:E=An;break;default:E=Ei}return P=ww.bind(null,f),E=Sn(E,P),f.callbackPriority=y,f.callbackNode=E,y}return P!==null&&P!==null&&_n(P),f.callbackPriority=2,f.callbackNode=null,2}function ww(f,y){if(er!==0&&er!==5)return f.callbackNode=null,f.callbackPriority=0,null;var E=f.callbackNode;if(Lu()&&f.callbackNode!==E)return null;var P=Ft;return P=zi(f,f===xt?P:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),P===0?null:(B(f,P,y),bw(f,De()),f.callbackNode!=null&&f.callbackNode===E?ww.bind(null,f):null)}function Sw(f,y){if(Lu())return null;B(f,y,!0)}function Tw(){y0(function(){(_t&6)!==0?Sn(Li,Ev):Av()})}function Py(){if(rm===0){var f=Oc;f===0&&(f=wn,wn<<=1,(wn&261888)===0&&(wn=256)),rm=f}return rm}function Mw(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:Sl(""+f)}function Cv(f,y){var E=y.ownerDocument.createElement("input");return E.name=y.name,E.value=y.value,f.id&&E.setAttribute("form",f.id),y.parentNode.insertBefore(E,y),f=new FormData(f),E.parentNode.removeChild(E),f}function uE(f,y,E,P,W){if(y==="submit"&&E&&E.stateNode===W){var J=Mw((W[ge]||null).action),ve=P.submitter;ve&&(y=(y=ve[ge]||null)?Mw(y.formAction):ve.getAttribute("formAction"),y!==null&&(J=y,ve=null));var Xe=new Rc("action","action",null,P,W);f.push({event:Xe,listeners:[{instance:null,listener:function(){if(P.defaultPrevented){if(rm!==0){var Ct=ve?Cv(W,ve):new FormData(W);Mf(E,{pending:!0,data:Ct,method:W.method,action:J},null,Ct)}}else typeof J=="function"&&(Xe.preventDefault(),Ct=ve?Cv(W,ve):new FormData(W),Mf(E,{pending:!0,data:Ct,method:W.method,action:J},J,Ct))},currentTarget:W}]})}}for(var Rv=0;Rv<Fp.length;Rv++){var zy=Fp[Rv],Ew=zy.toLowerCase(),Aw=zy[0].toUpperCase()+zy.slice(1);Ja(Ew,"on"+Aw)}Ja(sl,"onAnimationEnd"),Ja(qu,"onAnimationIteration"),Ja(uu,"onAnimationStart"),Ja("dblclick","onDoubleClick"),Ja("focusin","onFocus"),Ja("focusout","onBlur"),Ja(ad,"onTransitionRun"),Ja(hu,"onTransitionStart"),Ja(Xu,"onTransitionCancel"),Ja(ff,"onTransitionEnd"),ji("onMouseEnter",["mouseout","mouseover"]),ji("onMouseLeave",["mouseout","mouseover"]),ji("onPointerEnter",["pointerout","pointerover"]),ji("onPointerLeave",["pointerout","pointerover"]),bi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),bi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),bi("onBeforeInput",["compositionend","keypress","textInput","paste"]),bi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),bi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),bi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var f_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(f_));function Iv(f,y){y=(y&4)!==0;for(var E=0;E<f.length;E++){var P=f[E],W=P.event;P=P.listeners;e:{var J=void 0;if(y)for(var ve=P.length-1;0<=ve;ve--){var Xe=P[ve],Ct=Xe.instance,_i=Xe.currentTarget;if(Xe=Xe.listener,Ct!==J&&W.isPropagationStopped())break e;J=Xe,W.currentTarget=_i;try{J(W)}catch(Hi){dc(Hi)}W.currentTarget=null,J=Ct}else for(ve=0;ve<P.length;ve++){if(Xe=P[ve],Ct=Xe.instance,_i=Xe.currentTarget,Xe=Xe.listener,Ct!==J&&W.isPropagationStopped())break e;J=Xe,W.currentTarget=_i;try{J(W)}catch(Hi){dc(Hi)}W.currentTarget=null,J=Ct}}}}function Zs(f,y){var E=y[$e];E===void 0&&(E=y[$e]=new Set);var P=f+"__bubble";E.has(P)||(Dv(y,f,2,!1),E.add(P))}function p0(f,y,E){var P=0;y&&(P|=4),Dv(E,f,P,y)}var Ld="_reactListening"+Math.random().toString(36).slice(2);function Uo(f){if(!f[Ld]){f[Ld]=!0,bt.forEach(function(E){E!=="selectionchange"&&(Cw.has(E)||p0(E,!1,f),p0(E,!0,f))});var y=f.nodeType===9?f:f.ownerDocument;y===null||y[Ld]||(y[Ld]=!0,p0("selectionchange",!1,y))}}function Dv(f,y,E,P){switch(jw(y)){case 2:var W=M0;break;case 8:W=Hw;break;default:W=Xy}E=W.bind(null,y,E,f),W=void 0,!ed||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(W=!0),P?W!==void 0?f.addEventListener(y,E,{capture:!0,passive:W}):f.addEventListener(y,E,!0):W!==void 0?f.addEventListener(y,E,{passive:W}):f.addEventListener(y,E,!1)}function Rg(f,y,E,P,W){var J=P;if((y&1)===0&&(y&2)===0&&P!==null)e:for(;;){if(P===null)return;var ve=P.tag;if(ve===3||ve===4){var Xe=P.stateNode.containerInfo;if(Xe===W)break;if(ve===4)for(ve=P.return;ve!==null;){var Ct=ve.tag;if((Ct===3||Ct===4)&&ve.stateNode.containerInfo===W)return;ve=ve.return}for(;Xe!==null;){if(ve=Wt(Xe),ve===null)return;if(Ct=ve.tag,Ct===5||Ct===6||Ct===26||Ct===27){P=J=ve;continue e}Xe=Xe.parentNode}}P=P.return}Pm(function(){var _i=J,Hi=iu(E),nn=[];e:{var wi=ho.get(f);if(wi!==void 0){var Ci=Rc,mr=f;switch(f){case"keypress":if(wr(E)===0)break e;case"keydown":case"keyup":Ci=hn;break;case"focusin":mr="focus",Ci=td;break;case"focusout":mr="blur",Ci=td;break;case"beforeblur":case"afterblur":Ci=td;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ci=Om;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ci=of;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ci=zo;break;case sl:case qu:case uu:Ci=lc;break;case ff:Ci=Fm;break;case"scroll":case"scrollend":Ci=sf;break;case"wheel":Ci=Ic;break;case"copy":case"cut":case"paste":Ci=Bm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ci=Zr;break;case"toggle":case"beforetoggle":Ci=ca}var Cr=(y&4)!==0,sa=!Cr&&(f==="scroll"||f==="scrollend"),Jt=Cr?wi!==null?wi+"Capture":null:wi;Cr=[];for(var Nt=_i,di;Nt!==null;){var en=Nt;if(di=en.stateNode,en=en.tag,en!==5&&en!==26&&en!==27||di===null||Jt===null||(en=ru(Nt,Jt),en!=null&&Cr.push(m0(Nt,en,di))),sa)break;Nt=Nt.return}0<Cr.length&&(wi=new Ci(wi,mr,null,E,Hi),nn.push({event:wi,listeners:Cr}))}}if((y&7)===0){e:{if(wi=f==="mouseover"||f==="pointerover",Ci=f==="mouseout"||f==="pointerout",wi&&E!==Vl&&(mr=E.relatedTarget||E.fromElement)&&(Wt(mr)||mr[Ie]))break e;if((Ci||wi)&&(wi=Hi.window===Hi?Hi:(wi=Hi.ownerDocument)?wi.defaultView||wi.parentWindow:window,Ci?(mr=E.relatedTarget||E.toElement,Ci=_i,mr=mr?Wt(mr):null,mr!==null&&(sa=g(mr),Cr=mr.tag,mr!==sa||Cr!==5&&Cr!==27&&Cr!==6)&&(mr=null)):(Ci=null,mr=_i),Ci!==mr)){if(Cr=Om,en="onMouseLeave",Jt="onMouseEnter",Nt="mouse",(f==="pointerout"||f==="pointerover")&&(Cr=Zr,en="onPointerLeave",Jt="onPointerEnter",Nt="pointer"),sa=Ci==null?wi:it(Ci),di=mr==null?wi:it(mr),wi=new Cr(en,Nt+"leave",Ci,E,Hi),wi.target=sa,wi.relatedTarget=di,en=null,Wt(Hi)===_i&&(Cr=new Cr(Jt,Nt+"enter",mr,E,Hi),Cr.target=di,Cr.relatedTarget=sa,en=Cr),sa=en,Ci&&mr)t:{for(Cr=hE,Jt=Ci,Nt=mr,di=0,en=Jt;en;en=Cr(en))di++;en=0;for(var Fr=Nt;Fr;Fr=Cr(Fr))en++;for(;0<di-en;)Jt=Cr(Jt),di--;for(;0<en-di;)Nt=Cr(Nt),en--;for(;di--;){if(Jt===Nt||Nt!==null&&Jt===Nt.alternate){Cr=Jt;break t}Jt=Cr(Jt),Nt=Cr(Nt)}Cr=null}else Cr=null;Ci!==null&&Rw(nn,wi,Ci,Cr,!1),mr!==null&&sa!==null&&Rw(nn,sa,mr,Cr,!0)}}e:{if(wi=_i?it(_i):window,Ci=wi.nodeName&&wi.nodeName.toLowerCase(),Ci==="select"||Ci==="input"&&wi.type==="file")var aa=$n;else if(jl(wi))if(sn)aa=Xo;else{aa=Vu;var Tr=ql}else Ci=wi.nodeName,!Ci||Ci.toLowerCase()!=="input"||wi.type!=="checkbox"&&wi.type!=="radio"?_i&&kl(_i.elementType)&&(aa=$n):aa=Op;if(aa&&(aa=aa(f,_i))){Dc(nn,aa,E,Hi);break e}Tr&&Tr(f,wi,_i),f==="focusout"&&_i&&wi.type==="number"&&_i.memoizedProps.value!=null&&la(wi,"number",wi.value)}switch(Tr=_i?it(_i):window,f){case"focusin":(jl(Tr)||Tr.contentEditable==="true")&&(lu=Tr,cf=_i,ju=null);break;case"focusout":ju=cf=lu=null;break;case"mousedown":$a=!0;break;case"contextmenu":case"mouseup":case"dragend":$a=!1,cu(nn,E,Hi);break;case"selectionchange":if(r_)break;case"keydown":case"keyup":cu(nn,E,Hi)}var Ds;if(Gl)e:{switch(f){case"compositionstart":var Vs="onCompositionStart";break e;case"compositionend":Vs="onCompositionEnd";break e;case"compositionupdate":Vs="onCompositionUpdate";break e}Vs=void 0}else Fa?xo(f,E)&&(Vs="onCompositionEnd"):f==="keydown"&&E.keyCode===229&&(Vs="onCompositionStart");Vs&&(uo&&E.locale!=="ko"&&(Fa||Vs!=="onCompositionStart"?Vs==="onCompositionEnd"&&Fa&&(Ds=nf()):(il=Hi,zm="value"in il?il.value:il.textContent,Fa=!0)),Tr=Oy(_i,Vs),0<Tr.length&&(Vs=new Nm(Vs,f,null,E,Hi),nn.push({event:Vs,listeners:Tr}),Ds?Vs.data=Ds:(Ds=Hl(E),Ds!==null&&(Vs.data=Ds)))),(Ds=au?Uu(f,E):rd(f,E))&&(Vs=Oy(_i,"onBeforeInput"),0<Vs.length&&(Tr=new Nm("onBeforeInput","beforeinput",null,E,Hi),nn.push({event:Tr,listeners:Vs}),Tr.data=Ds)),uE(nn,f,_i,E,Hi)}Iv(nn,y)})}function m0(f,y,E){return{instance:f,listener:y,currentTarget:E}}function Oy(f,y){for(var E=y+"Capture",P=[];f!==null;){var W=f,J=W.stateNode;if(W=W.tag,W!==5&&W!==26&&W!==27||J===null||(W=ru(f,E),W!=null&&P.unshift(m0(f,W,J)),W=ru(f,y),W!=null&&P.push(m0(f,W,J))),f.tag===3)return P;f=f.return}return[]}function hE(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function Rw(f,y,E,P,W){for(var J=y._reactName,ve=[];E!==null&&E!==P;){var Xe=E,Ct=Xe.alternate,_i=Xe.stateNode;if(Xe=Xe.tag,Ct!==null&&Ct===P)break;Xe!==5&&Xe!==26&&Xe!==27||_i===null||(Ct=_i,W?(_i=ru(E,J),_i!=null&&ve.unshift(m0(E,_i,Ct))):W||(_i=ru(E,J),_i!=null&&ve.push(m0(E,_i,Ct)))),E=E.return}ve.length!==0&&f.push({event:y,listeners:ve})}var d_=/\r\n?/g,Iw=/\u0000|\uFFFD/g;function $m(f){return(typeof f=="string"?f:""+f).replace(d_,`
`).replace(Iw,"")}function p_(f,y){return y=$m(y),$m(f)===y}function za(f,y,E,P,W,J){switch(E){case"children":typeof P=="string"?y==="body"||y==="textarea"&&P===""||Ul(f,P):(typeof P=="number"||typeof P=="bigint")&&y!=="body"&&Ul(f,""+P);break;case"className":Cn(f,"class",P);break;case"tabIndex":Cn(f,"tabindex",P);break;case"dir":case"role":case"viewBox":case"width":case"height":Cn(f,E,P);break;case"style":Jf(f,P,J);break;case"data":if(y!=="object"){Cn(f,"data",P);break}case"src":case"href":if(P===""&&(y!=="a"||E!=="href")){f.removeAttribute(E);break}if(P==null||typeof P=="function"||typeof P=="symbol"||typeof P=="boolean"){f.removeAttribute(E);break}P=Sl(""+P),f.setAttribute(E,P);break;case"action":case"formAction":if(typeof P=="function"){f.setAttribute(E,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof J=="function"&&(E==="formAction"?(y!=="input"&&za(f,y,"name",W.name,W,null),za(f,y,"formEncType",W.formEncType,W,null),za(f,y,"formMethod",W.formMethod,W,null),za(f,y,"formTarget",W.formTarget,W,null)):(za(f,y,"encType",W.encType,W,null),za(f,y,"method",W.method,W,null),za(f,y,"target",W.target,W,null)));if(P==null||typeof P=="symbol"||typeof P=="boolean"){f.removeAttribute(E);break}P=Sl(""+P),f.setAttribute(E,P);break;case"onClick":P!=null&&(f.onclick=Ka);break;case"onScroll":P!=null&&Zs("scroll",f);break;case"onScrollEnd":P!=null&&Zs("scrollend",f);break;case"dangerouslySetInnerHTML":if(P!=null){if(typeof P!="object"||!("__html"in P))throw Error(l(61));if(E=P.__html,E!=null){if(W.children!=null)throw Error(l(60));f.innerHTML=E}}break;case"multiple":f.multiple=P&&typeof P!="function"&&typeof P!="symbol";break;case"muted":f.muted=P&&typeof P!="function"&&typeof P!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(P==null||typeof P=="function"||typeof P=="boolean"||typeof P=="symbol"){f.removeAttribute("xlink:href");break}E=Sl(""+P),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",E);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":P!=null&&typeof P!="function"&&typeof P!="symbol"?f.setAttribute(E,""+P):f.removeAttribute(E);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":P&&typeof P!="function"&&typeof P!="symbol"?f.setAttribute(E,""):f.removeAttribute(E);break;case"capture":case"download":P===!0?f.setAttribute(E,""):P!==!1&&P!=null&&typeof P!="function"&&typeof P!="symbol"?f.setAttribute(E,P):f.removeAttribute(E);break;case"cols":case"rows":case"size":case"span":P!=null&&typeof P!="function"&&typeof P!="symbol"&&!isNaN(P)&&1<=P?f.setAttribute(E,P):f.removeAttribute(E);break;case"rowSpan":case"start":P==null||typeof P=="function"||typeof P=="symbol"||isNaN(P)?f.removeAttribute(E):f.setAttribute(E,P);break;case"popover":Zs("beforetoggle",f),Zs("toggle",f),Wn(f,"popover",P);break;case"xlinkActuate":or(f,"http://www.w3.org/1999/xlink","xlink:actuate",P);break;case"xlinkArcrole":or(f,"http://www.w3.org/1999/xlink","xlink:arcrole",P);break;case"xlinkRole":or(f,"http://www.w3.org/1999/xlink","xlink:role",P);break;case"xlinkShow":or(f,"http://www.w3.org/1999/xlink","xlink:show",P);break;case"xlinkTitle":or(f,"http://www.w3.org/1999/xlink","xlink:title",P);break;case"xlinkType":or(f,"http://www.w3.org/1999/xlink","xlink:type",P);break;case"xmlBase":or(f,"http://www.w3.org/XML/1998/namespace","xml:base",P);break;case"xmlLang":or(f,"http://www.w3.org/XML/1998/namespace","xml:lang",P);break;case"xmlSpace":or(f,"http://www.w3.org/XML/1998/namespace","xml:space",P);break;case"is":Wn(f,"is",P);break;case"innerText":case"textContent":break;default:(!(2<E.length)||E[0]!=="o"&&E[0]!=="O"||E[1]!=="n"&&E[1]!=="N")&&(E=tl.get(E)||E,Wn(f,E,P))}}function Lv(f,y,E,P,W,J){switch(E){case"style":Jf(f,P,J);break;case"dangerouslySetInnerHTML":if(P!=null){if(typeof P!="object"||!("__html"in P))throw Error(l(61));if(E=P.__html,E!=null){if(W.children!=null)throw Error(l(60));f.innerHTML=E}}break;case"children":typeof P=="string"?Ul(f,P):(typeof P=="number"||typeof P=="bigint")&&Ul(f,""+P);break;case"onScroll":P!=null&&Zs("scroll",f);break;case"onScrollEnd":P!=null&&Zs("scrollend",f);break;case"onClick":P!=null&&(f.onclick=Ka);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mi.hasOwnProperty(E))e:{if(E[0]==="o"&&E[1]==="n"&&(W=E.endsWith("Capture"),y=E.slice(2,W?E.length-7:void 0),J=f[ge]||null,J=J!=null?J[E]:null,typeof J=="function"&&f.removeEventListener(y,J,W),typeof P=="function")){typeof J!="function"&&J!==null&&(E in f?f[E]=null:f.hasAttribute(E)&&f.removeAttribute(E)),f.addEventListener(y,P,W);break e}E in f?f[E]=P:P===!0?f.setAttribute(E,""):Wn(f,E,P)}}}function wc(f,y,E){switch(y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zs("error",f),Zs("load",f);var P=!1,W=!1,J;for(J in E)if(E.hasOwnProperty(J)){var ve=E[J];if(ve!=null)switch(J){case"src":P=!0;break;case"srcSet":W=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,y));default:za(f,y,J,ve,E,null)}}W&&za(f,y,"srcSet",E.srcSet,E,null),P&&za(f,y,"src",E.src,E,null);return;case"input":Zs("invalid",f);var Xe=J=ve=W=null,Ct=null,_i=null;for(P in E)if(E.hasOwnProperty(P)){var Hi=E[P];if(Hi!=null)switch(P){case"name":W=Hi;break;case"type":ve=Hi;break;case"checked":Ct=Hi;break;case"defaultChecked":_i=Hi;break;case"value":J=Hi;break;case"defaultValue":Xe=Hi;break;case"children":case"dangerouslySetInnerHTML":if(Hi!=null)throw Error(l(137,y));break;default:za(f,y,P,Hi,E,null)}}as(f,J,Xe,Ct,_i,ve,W,!1);return;case"select":Zs("invalid",f),P=ve=J=null;for(W in E)if(E.hasOwnProperty(W)&&(Xe=E[W],Xe!=null))switch(W){case"value":J=Xe;break;case"defaultValue":ve=Xe;break;case"multiple":P=Xe;default:za(f,y,W,Xe,E,null)}y=J,E=ve,f.multiple=!!P,y!=null?xs(f,!!P,y,!1):E!=null&&xs(f,!!P,E,!0);return;case"textarea":Zs("invalid",f),J=W=P=null;for(ve in E)if(E.hasOwnProperty(ve)&&(Xe=E[ve],Xe!=null))switch(ve){case"value":P=Xe;break;case"defaultValue":W=Xe;break;case"children":J=Xe;break;case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(l(91));break;default:za(f,y,ve,Xe,E,null)}ma(f,P,W,J);return;case"option":for(Ct in E)if(E.hasOwnProperty(Ct)&&(P=E[Ct],P!=null))switch(Ct){case"selected":f.selected=P&&typeof P!="function"&&typeof P!="symbol";break;default:za(f,y,Ct,P,E,null)}return;case"dialog":Zs("beforetoggle",f),Zs("toggle",f),Zs("cancel",f),Zs("close",f);break;case"iframe":case"object":Zs("load",f);break;case"video":case"audio":for(P=0;P<f_.length;P++)Zs(f_[P],f);break;case"image":Zs("error",f),Zs("load",f);break;case"details":Zs("toggle",f);break;case"embed":case"source":case"link":Zs("error",f),Zs("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_i in E)if(E.hasOwnProperty(_i)&&(P=E[_i],P!=null))switch(_i){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,y));default:za(f,y,_i,P,E,null)}return;default:if(kl(y)){for(Hi in E)E.hasOwnProperty(Hi)&&(P=E[Hi],P!==void 0&&Lv(f,y,Hi,P,E,void 0));return}}for(Xe in E)E.hasOwnProperty(Xe)&&(P=E[Xe],P!=null&&za(f,y,Xe,P,E,null))}function fE(f,y,E,P){switch(y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var W=null,J=null,ve=null,Xe=null,Ct=null,_i=null,Hi=null;for(Ci in E){var nn=E[Ci];if(E.hasOwnProperty(Ci)&&nn!=null)switch(Ci){case"checked":break;case"value":break;case"defaultValue":Ct=nn;default:P.hasOwnProperty(Ci)||za(f,y,Ci,null,P,nn)}}for(var wi in P){var Ci=P[wi];if(nn=E[wi],P.hasOwnProperty(wi)&&(Ci!=null||nn!=null))switch(wi){case"type":J=Ci;break;case"name":W=Ci;break;case"checked":_i=Ci;break;case"defaultChecked":Hi=Ci;break;case"value":ve=Ci;break;case"defaultValue":Xe=Ci;break;case"children":case"dangerouslySetInnerHTML":if(Ci!=null)throw Error(l(137,y));break;default:Ci!==nn&&za(f,y,wi,Ci,P,nn)}}qa(f,ve,Xe,Ct,_i,Hi,J,W);return;case"select":Ci=ve=Xe=wi=null;for(J in E)if(Ct=E[J],E.hasOwnProperty(J)&&Ct!=null)switch(J){case"value":break;case"multiple":Ci=Ct;default:P.hasOwnProperty(J)||za(f,y,J,null,P,Ct)}for(W in P)if(J=P[W],Ct=E[W],P.hasOwnProperty(W)&&(J!=null||Ct!=null))switch(W){case"value":wi=J;break;case"defaultValue":Xe=J;break;case"multiple":ve=J;default:J!==Ct&&za(f,y,W,J,P,Ct)}y=Xe,E=ve,P=Ci,wi!=null?xs(f,!!E,wi,!1):!!P!=!!E&&(y!=null?xs(f,!!E,y,!0):xs(f,!!E,E?[]:"",!1));return;case"textarea":Ci=wi=null;for(Xe in E)if(W=E[Xe],E.hasOwnProperty(Xe)&&W!=null&&!P.hasOwnProperty(Xe))switch(Xe){case"value":break;case"children":break;default:za(f,y,Xe,null,P,W)}for(ve in P)if(W=P[ve],J=E[ve],P.hasOwnProperty(ve)&&(W!=null||J!=null))switch(ve){case"value":wi=W;break;case"defaultValue":Ci=W;break;case"children":break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(l(91));break;default:W!==J&&za(f,y,ve,W,P,J)}Ma(f,wi,Ci);return;case"option":for(var mr in E)if(wi=E[mr],E.hasOwnProperty(mr)&&wi!=null&&!P.hasOwnProperty(mr))switch(mr){case"selected":f.selected=!1;break;default:za(f,y,mr,null,P,wi)}for(Ct in P)if(wi=P[Ct],Ci=E[Ct],P.hasOwnProperty(Ct)&&wi!==Ci&&(wi!=null||Ci!=null))switch(Ct){case"selected":f.selected=wi&&typeof wi!="function"&&typeof wi!="symbol";break;default:za(f,y,Ct,wi,P,Ci)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Cr in E)wi=E[Cr],E.hasOwnProperty(Cr)&&wi!=null&&!P.hasOwnProperty(Cr)&&za(f,y,Cr,null,P,wi);for(_i in P)if(wi=P[_i],Ci=E[_i],P.hasOwnProperty(_i)&&wi!==Ci&&(wi!=null||Ci!=null))switch(_i){case"children":case"dangerouslySetInnerHTML":if(wi!=null)throw Error(l(137,y));break;default:za(f,y,_i,wi,P,Ci)}return;default:if(kl(y)){for(var sa in E)wi=E[sa],E.hasOwnProperty(sa)&&wi!==void 0&&!P.hasOwnProperty(sa)&&Lv(f,y,sa,void 0,P,wi);for(Hi in P)wi=P[Hi],Ci=E[Hi],!P.hasOwnProperty(Hi)||wi===Ci||wi===void 0&&Ci===void 0||Lv(f,y,Hi,wi,P,Ci);return}}for(var Jt in E)wi=E[Jt],E.hasOwnProperty(Jt)&&wi!=null&&!P.hasOwnProperty(Jt)&&za(f,y,Jt,null,P,wi);for(nn in P)wi=P[nn],Ci=E[nn],!P.hasOwnProperty(nn)||wi===Ci||wi==null&&Ci==null||za(f,y,nn,wi,P,Ci)}function Dw(f){switch(f){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function dE(){if(typeof performance.getEntriesByType=="function"){for(var f=0,y=0,E=performance.getEntriesByType("resource"),P=0;P<E.length;P++){var W=E[P],J=W.transferSize,ve=W.initiatorType,Xe=W.duration;if(J&&Xe&&Dw(ve)){for(ve=0,Xe=W.responseEnd,P+=1;P<E.length;P++){var Ct=E[P],_i=Ct.startTime;if(_i>Xe)break;var Hi=Ct.transferSize,nn=Ct.initiatorType;Hi&&Dw(nn)&&(Ct=Ct.responseEnd,ve+=Hi*(Ct<Xe?1:(Xe-_i)/(Ct-_i)))}if(--P,y+=8*(J+ve)/(W.duration/1e3),f++,10<f)break}}if(0<f)return y/f/1e6}return navigator.connection&&(f=navigator.connection.downlink,typeof f=="number")?f:5}var Pv=null,g0=null;function By(f){return f.nodeType===9?f:f.ownerDocument}function zv(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function m_(f,y){if(f===0)switch(y){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&y==="foreignObject"?0:f}function Ov(f,y){return f==="textarea"||f==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.children=="bigint"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var co=null;function g_(){var f=window.event;return f&&f.type==="popstate"?f===co?!1:(co=f,!0):(co=null,!1)}var Bv=typeof setTimeout=="function"?setTimeout:void 0,Ny=typeof clearTimeout=="function"?clearTimeout:void 0,_0=typeof Promise=="function"?Promise:void 0,y0=typeof queueMicrotask=="function"?queueMicrotask:typeof _0<"u"?function(f){return _0.resolve(null).then(f).catch(Lw)}:Bv;function Lw(f){setTimeout(function(){throw f})}function sm(f){return f==="head"}function __(f,y){var E=y,P=0;do{var W=E.nextSibling;if(f.removeChild(E),W&&W.nodeType===8)if(E=W.data,E==="/$"||E==="/&"){if(P===0){f.removeChild(W),um(y);return}P--}else if(E==="$"||E==="$?"||E==="$~"||E==="$!"||E==="&")P++;else if(E==="html")Jm(f.ownerDocument.documentElement);else if(E==="head"){E=f.ownerDocument.head,Jm(E);for(var J=E.firstChild;J;){var ve=J.nextSibling,Xe=J.nodeName;J[lt]||Xe==="SCRIPT"||Xe==="STYLE"||Xe==="LINK"&&J.rel.toLowerCase()==="stylesheet"||E.removeChild(J),J=ve}}else E==="body"&&Jm(f.ownerDocument.body);E=W}while(E);um(y)}function Fy(f,y){var E=f;f=0;do{var P=E.nextSibling;if(E.nodeType===1?y?(E._stashedDisplay=E.style.display,E.style.display="none"):(E.style.display=E._stashedDisplay||"",E.getAttribute("style")===""&&E.removeAttribute("style")):E.nodeType===3&&(y?(E._stashedText=E.nodeValue,E.nodeValue=""):E.nodeValue=E._stashedText||""),P&&P.nodeType===8)if(E=P.data,E==="/$"){if(f===0)break;f--}else E!=="$"&&E!=="$?"&&E!=="$~"&&E!=="$!"||f++;E=P}while(E)}function Ig(f){var y=f.firstChild;for(y&&y.nodeType===10&&(y=y.nextSibling);y;){var E=y;switch(y=y.nextSibling,E.nodeName){case"HTML":case"HEAD":case"BODY":Ig(E),Tt(E);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(E.rel.toLowerCase()==="stylesheet")continue}f.removeChild(E)}}function pE(f,y,E,P){for(;f.nodeType===1;){var W=E;if(f.nodeName.toLowerCase()!==y.toLowerCase()){if(!P&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(P){if(!f[lt])switch(y){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(J=f.getAttribute("rel"),J==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(J!==W.rel||f.getAttribute("href")!==(W.href==null||W.href===""?null:W.href)||f.getAttribute("crossorigin")!==(W.crossOrigin==null?null:W.crossOrigin)||f.getAttribute("title")!==(W.title==null?null:W.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(J=f.getAttribute("src"),(J!==(W.src==null?null:W.src)||f.getAttribute("type")!==(W.type==null?null:W.type)||f.getAttribute("crossorigin")!==(W.crossOrigin==null?null:W.crossOrigin))&&J&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(y==="input"&&f.type==="hidden"){var J=W.name==null?null:""+W.name;if(W.type==="hidden"&&f.getAttribute("name")===J)return f}else return f;if(f=Bf(f.nextSibling),f===null)break}return null}function Pw(f,y,E){if(y==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!E||(f=Bf(f.nextSibling),f===null))return null;return f}function Uy(f,y){for(;f.nodeType!==8;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!y||(f=Bf(f.nextSibling),f===null))return null;return f}function x0(f){return f.data==="$?"||f.data==="$~"}function ky(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState!=="loading"}function am(f,y){var E=f.ownerDocument;if(f.data==="$~")f._reactRetry=y;else if(f.data!=="$?"||E.readyState!=="loading")y();else{var P=function(){y(),E.removeEventListener("DOMContentLoaded",P)};E.addEventListener("DOMContentLoaded",P),f._reactRetry=P}}function Bf(f){for(;f!=null;f=f.nextSibling){var y=f.nodeType;if(y===1||y===3)break;if(y===8){if(y=f.data,y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"||y==="F!"||y==="F")break;if(y==="/$"||y==="/&")return null}}return f}var Sc=null;function Nv(f){f=f.nextSibling;for(var y=0;f;){if(f.nodeType===8){var E=f.data;if(E==="/$"||E==="/&"){if(y===0)return Bf(f.nextSibling);y--}else E!=="$"&&E!=="$!"&&E!=="$?"&&E!=="$~"&&E!=="&"||y++}f=f.nextSibling}return null}function Fv(f){f=f.previousSibling;for(var y=0;f;){if(f.nodeType===8){var E=f.data;if(E==="$"||E==="$!"||E==="$?"||E==="$~"||E==="&"){if(y===0)return f;y--}else E!=="/$"&&E!=="/&"||y++}f=f.previousSibling}return null}function Uv(f,y,E){switch(y=By(E),f){case"html":if(f=y.documentElement,!f)throw Error(l(452));return f;case"head":if(f=y.head,!f)throw Error(l(453));return f;case"body":if(f=y.body,!f)throw Error(l(454));return f;default:throw Error(l(451))}}function Jm(f){for(var y=f.attributes;y.length;)f.removeAttributeNode(y[0]);Tt(f)}var Nf=new Map,zw=new Set;function y_(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var yp=Qe.d;Qe.d={f:kv,r:Vv,D:Ow,C:Bw,L:Vy,m:xp,X:mE,S:Nw,M:gE};function kv(){var f=yp.f(),y=We();return f||y}function Vv(f){var y=ye(f);y!==null&&y.tag===5&&y.type==="form"?Cu(y):yp.r(f)}var Dg=typeof document>"u"?null:document;function Gv(f,y,E){var P=Dg;if(P&&typeof y=="string"&&y){var W=Kr(y);W='link[rel="'+f+'"][href="'+W+'"]',typeof E=="string"&&(W+='[crossorigin="'+E+'"]'),zw.has(W)||(zw.add(W),f={rel:f,crossOrigin:E,href:y},P.querySelector(W)===null&&(y=P.createElement("link"),wc(y,"link",f),ht(y),P.head.appendChild(y)))}}function Ow(f){yp.D(f),Gv("dns-prefetch",f,null)}function Bw(f,y){yp.C(f,y),Gv("preconnect",f,y)}function Vy(f,y,E){yp.L(f,y,E);var P=Dg;if(P&&f&&y){var W='link[rel="preload"][as="'+Kr(y)+'"]';y==="image"&&E&&E.imageSrcSet?(W+='[imagesrcset="'+Kr(E.imageSrcSet)+'"]',typeof E.imageSizes=="string"&&(W+='[imagesizes="'+Kr(E.imageSizes)+'"]')):W+='[href="'+Kr(f)+'"]';var J=W;switch(y){case"style":J=x_(f);break;case"script":J=v_(f)}Nf.has(J)||(f=N({rel:"preload",href:y==="image"&&E&&E.imageSrcSet?void 0:f,as:y},E),Nf.set(J,f),P.querySelector(W)!==null||y==="style"&&P.querySelector(v0(J))||y==="script"&&P.querySelector(om(J))||(y=P.createElement("link"),wc(y,"link",f),ht(y),P.head.appendChild(y)))}}function xp(f,y){yp.m(f,y);var E=Dg;if(E&&f){var P=y&&typeof y.as=="string"?y.as:"script",W='link[rel="modulepreload"][as="'+Kr(P)+'"][href="'+Kr(f)+'"]',J=W;switch(P){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":J=v_(f)}if(!Nf.has(J)&&(f=N({rel:"modulepreload",href:f},y),Nf.set(J,f),E.querySelector(W)===null)){switch(P){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(E.querySelector(om(J)))return}P=E.createElement("link"),wc(P,"link",f),ht(P),E.head.appendChild(P)}}}function Nw(f,y,E){yp.S(f,y,E);var P=Dg;if(P&&f){var W=wt(P).hoistableStyles,J=x_(f);y=y||"default";var ve=W.get(J);if(!ve){var Xe={loading:0,preload:null};if(ve=P.querySelector(v0(J)))Xe.loading=5;else{f=N({rel:"stylesheet",href:f,"data-precedence":y},E),(E=Nf.get(J))&&b_(f,E);var Ct=ve=P.createElement("link");ht(Ct),wc(Ct,"link",f),Ct._p=new Promise(function(_i,Hi){Ct.onload=_i,Ct.onerror=Hi}),Ct.addEventListener("load",function(){Xe.loading|=1}),Ct.addEventListener("error",function(){Xe.loading|=2}),Xe.loading|=4,b0(ve,y,P)}ve={type:"stylesheet",instance:ve,count:1,state:Xe},W.set(J,ve)}}}function mE(f,y){yp.X(f,y);var E=Dg;if(E&&f){var P=wt(E).hoistableScripts,W=v_(f),J=P.get(W);J||(J=E.querySelector(om(W)),J||(f=N({src:f,async:!0},y),(y=Nf.get(W))&&Gy(f,y),J=E.createElement("script"),ht(J),wc(J,"link",f),E.head.appendChild(J)),J={type:"script",instance:J,count:1,state:null},P.set(W,J))}}function gE(f,y){yp.M(f,y);var E=Dg;if(E&&f){var P=wt(E).hoistableScripts,W=v_(f),J=P.get(W);J||(J=E.querySelector(om(W)),J||(f=N({src:f,async:!0,type:"module"},y),(y=Nf.get(W))&&Gy(f,y),J=E.createElement("script"),ht(J),wc(J,"link",f),E.head.appendChild(J)),J={type:"script",instance:J,count:1,state:null},P.set(W,J))}}function Fw(f,y,E,P){var W=(W=qt.current)?y_(W):null;if(!W)throw Error(l(446));switch(f){case"meta":case"title":return null;case"style":return typeof E.precedence=="string"&&typeof E.href=="string"?(y=x_(E.href),E=wt(W).hoistableStyles,P=E.get(y),P||(P={type:"style",instance:null,count:0,state:null},E.set(y,P)),P):{type:"void",instance:null,count:0,state:null};case"link":if(E.rel==="stylesheet"&&typeof E.href=="string"&&typeof E.precedence=="string"){f=x_(E.href);var J=wt(W).hoistableStyles,ve=J.get(f);if(ve||(W=W.ownerDocument||W,ve={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},J.set(f,ve),(J=W.querySelector(v0(f)))&&!J._p&&(ve.instance=J,ve.state.loading=5),Nf.has(f)||(E={rel:"preload",as:"style",href:E.href,crossOrigin:E.crossOrigin,integrity:E.integrity,media:E.media,hrefLang:E.hrefLang,referrerPolicy:E.referrerPolicy},Nf.set(f,E),J||_E(W,f,E,ve.state))),y&&P===null)throw Error(l(528,""));return ve}if(y&&P!==null)throw Error(l(529,""));return null;case"script":return y=E.async,E=E.src,typeof E=="string"&&y&&typeof y!="function"&&typeof y!="symbol"?(y=v_(E),E=wt(W).hoistableScripts,P=E.get(y),P||(P={type:"script",instance:null,count:0,state:null},E.set(y,P)),P):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,f))}}function x_(f){return'href="'+Kr(f)+'"'}function v0(f){return'link[rel="stylesheet"]['+f+"]"}function Uw(f){return N({},f,{"data-precedence":f.precedence,precedence:null})}function _E(f,y,E,P){f.querySelector('link[rel="preload"][as="style"]['+y+"]")?P.loading=1:(y=f.createElement("link"),P.preload=y,y.addEventListener("load",function(){return P.loading|=1}),y.addEventListener("error",function(){return P.loading|=2}),wc(y,"link",E),ht(y),f.head.appendChild(y))}function v_(f){return'[src="'+Kr(f)+'"]'}function om(f){return"script[async]"+f}function Hv(f,y,E){if(y.count++,y.instance===null)switch(y.type){case"style":var P=f.querySelector('style[data-href~="'+Kr(E.href)+'"]');if(P)return y.instance=P,ht(P),P;var W=N({},E,{"data-href":E.href,"data-precedence":E.precedence,href:null,precedence:null});return P=(f.ownerDocument||f).createElement("style"),ht(P),wc(P,"style",W),b0(P,E.precedence,f),y.instance=P;case"stylesheet":W=x_(E.href);var J=f.querySelector(v0(W));if(J)return y.state.loading|=4,y.instance=J,ht(J),J;P=Uw(E),(W=Nf.get(W))&&b_(P,W),J=(f.ownerDocument||f).createElement("link"),ht(J);var ve=J;return ve._p=new Promise(function(Xe,Ct){ve.onload=Xe,ve.onerror=Ct}),wc(J,"link",P),y.state.loading|=4,b0(J,E.precedence,f),y.instance=J;case"script":return J=v_(E.src),(W=f.querySelector(om(J)))?(y.instance=W,ht(W),W):(P=E,(W=Nf.get(J))&&(P=N({},E),Gy(P,W)),f=f.ownerDocument||f,W=f.createElement("script"),ht(W),wc(W,"link",P),f.head.appendChild(W),y.instance=W);case"void":return null;default:throw Error(l(443,y.type))}else y.type==="stylesheet"&&(y.state.loading&4)===0&&(P=y.instance,y.state.loading|=4,b0(P,E.precedence,f));return y.instance}function b0(f,y,E){for(var P=E.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),W=P.length?P[P.length-1]:null,J=W,ve=0;ve<P.length;ve++){var Xe=P[ve];if(Xe.dataset.precedence===y)J=Xe;else if(J!==W)break}J?J.parentNode.insertBefore(f,J.nextSibling):(y=E.nodeType===9?E.head:E,y.insertBefore(f,y.firstChild))}function b_(f,y){f.crossOrigin==null&&(f.crossOrigin=y.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=y.referrerPolicy),f.title==null&&(f.title=y.title)}function Gy(f,y){f.crossOrigin==null&&(f.crossOrigin=y.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=y.referrerPolicy),f.integrity==null&&(f.integrity=y.integrity)}var w_=null;function w0(f,y,E){if(w_===null){var P=new Map,W=w_=new Map;W.set(E,P)}else W=w_,P=W.get(E),P||(P=new Map,W.set(E,P));if(P.has(f))return P;for(P.set(f,null),E=E.getElementsByTagName(f),W=0;W<E.length;W++){var J=E[W];if(!(J[lt]||J[oe]||f==="link"&&J.getAttribute("rel")==="stylesheet")&&J.namespaceURI!=="http://www.w3.org/2000/svg"){var ve=J.getAttribute(y)||"";ve=f+ve;var Xe=P.get(ve);Xe?Xe.push(J):P.set(ve,[J])}}return P}function jv(f,y,E){f=f.ownerDocument||f,f.head.insertBefore(E,y==="title"?f.querySelector("head > title"):null)}function yE(f,y,E){if(E===1||y.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof y.precedence!="string"||typeof y.href!="string"||y.href==="")break;return!0;case"link":if(typeof y.rel!="string"||typeof y.href!="string"||y.href===""||y.onLoad||y.onError)break;switch(y.rel){case"stylesheet":return f=y.disabled,typeof y.precedence=="string"&&f==null;default:return!0}case"script":if(y.async&&typeof y.async!="function"&&typeof y.async!="symbol"&&!y.onLoad&&!y.onError&&y.src&&typeof y.src=="string")return!0}return!1}function Hy(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}function kw(f,y,E,P){if(E.type==="stylesheet"&&(typeof P.media!="string"||matchMedia(P.media).matches!==!1)&&(E.state.loading&4)===0){if(E.instance===null){var W=x_(P.href),J=y.querySelector(v0(W));if(J){y=J._p,y!==null&&typeof y=="object"&&typeof y.then=="function"&&(f.count++,f=S_.bind(f),y.then(f,f)),E.state.loading|=4,E.instance=J,ht(J);return}J=y.ownerDocument||y,P=Uw(P),(W=Nf.get(W))&&b_(P,W),J=J.createElement("link"),ht(J);var ve=J;ve._p=new Promise(function(Xe,Ct){ve.onload=Xe,ve.onerror=Ct}),wc(J,"link",P),E.instance=J}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(E,y),(y=E.state.preload)&&(E.state.loading&3)===0&&(f.count++,E=S_.bind(f),y.addEventListener("load",E),y.addEventListener("error",E))}}var jy=0;function Vw(f,y){return f.stylesheets&&f.count===0&&T_(f,f.stylesheets),0<f.count||0<f.imgCount?function(E){var P=setTimeout(function(){if(f.stylesheets&&T_(f,f.stylesheets),f.unsuspend){var J=f.unsuspend;f.unsuspend=null,J()}},6e4+y);0<f.imgBytes&&jy===0&&(jy=62500*dE());var W=setTimeout(function(){if(f.waitingForImages=!1,f.count===0&&(f.stylesheets&&T_(f,f.stylesheets),f.unsuspend)){var J=f.unsuspend;f.unsuspend=null,J()}},(f.imgBytes>jy?50:800)+y);return f.unsuspend=E,function(){f.unsuspend=null,clearTimeout(P),clearTimeout(W)}}:null}function S_(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)T_(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var S0=null;function T_(f,y){f.stylesheets=null,f.unsuspend!==null&&(f.count++,S0=new Map,y.forEach(xE,f),S0=null,S_.call(f))}function xE(f,y){if(!(y.state.loading&4)){var E=S0.get(f);if(E)var P=E.get(null);else{E=new Map,S0.set(f,E);for(var W=f.querySelectorAll("link[data-precedence],style[data-precedence]"),J=0;J<W.length;J++){var ve=W[J];(ve.nodeName==="LINK"||ve.getAttribute("media")!=="not all")&&(E.set(ve.dataset.precedence,ve),P=ve)}P&&E.set(null,P)}W=y.instance,ve=W.getAttribute("data-precedence"),J=E.get(ve)||P,J===P&&E.set(null,W),E.set(ve,W),this.count++,P=S_.bind(this),W.addEventListener("load",P),W.addEventListener("error",P),J?J.parentNode.insertBefore(W,J.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(W,f.firstChild)),y.state.loading|=4}}var T0={$$typeof:ue,Provider:null,Consumer:null,_currentValue:et,_currentValue2:et,_threadCount:0};function vE(f,y,E,P,W,J,ve,Xe,Ct){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ts(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ts(0),this.hiddenUpdates=Ts(null),this.identifierPrefix=P,this.onUncaughtError=W,this.onCaughtError=J,this.onRecoverableError=ve,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ct,this.incompleteTransitions=new Map}function Gw(f,y,E,P,W,J,ve,Xe,Ct,_i,Hi,nn){return f=new vE(f,y,E,ve,Ct,_i,Hi,nn,Xe),y=1,J===!0&&(y|=24),J=Wo(3,null,null,y),f.current=J,J.stateNode=f,y=ip(),y.refCount++,f.pooledCache=y,y.refCount++,J.memoizedState={element:P,isDehydrated:E,cache:y},Xp(J),f}function qv(f){return f?(f=Lc,f):Lc}function vp(f,y,E,P,W,J){W=qv(W),P.context===null?P.context=W:P.pendingContext=W,P=vu(y),P.payload={element:E},J=J===void 0?null:J,J!==null&&(P.callback=J),E=rh(f,P,y),E!==null&&(T(E,f,y),bu(E,f,y))}function Xv(f,y){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var E=f.retryLane;f.retryLane=E!==0&&E<y?E:y}}function qy(f,y){Xv(f,y),(f=f.alternate)&&Xv(f,y)}function M_(f){if(f.tag===13||f.tag===31){var y=du(f,67108864);y!==null&&T(y,f,67108864),qy(f,67108864)}}function E_(f){if(f.tag===13||f.tag===31){var y=rr();y=js(y);var E=du(f,y);E!==null&&T(E,f,y),qy(f,y)}}var Lg=!0;function M0(f,y,E,P){var W=Re.T;Re.T=null;var J=Qe.p;try{Qe.p=2,Xy(f,y,E,P)}finally{Qe.p=J,Re.T=W}}function Hw(f,y,E,P){var W=Re.T;Re.T=null;var J=Qe.p;try{Qe.p=8,Xy(f,y,E,P)}finally{Qe.p=J,Re.T=W}}function Xy(f,y,E,P){if(Lg){var W=Wy(P);if(W===null)Rg(f,y,P,E0,E),Zv(f,P);else if(Xw(W,f,y,E,P))P.stopPropagation();else if(Zv(f,P),y&4&&-1<qw.indexOf(f)){for(;W!==null;){var J=ye(W);if(J!==null)switch(J.tag){case 3:if(J=J.stateNode,J.current.memoizedState.isDehydrated){var ve=Pi(J.pendingLanes);if(ve!==0){var Xe=J;for(Xe.pendingLanes|=2,Xe.entangledLanes|=2;ve;){var Ct=1<<31-Qn(ve);Xe.entanglements[1]|=Ct,ve&=~Ct}bc(J),(_t&6)===0&&(Yi=De()+500,h_(0))}}break;case 31:case 13:Xe=du(J,2),Xe!==null&&T(Xe,J,2),We(),qy(J,2)}if(J=Wy(P),J===null&&Rg(f,y,P,E0,E),J===W)break;W=J}W!==null&&P.stopPropagation()}else Rg(f,y,P,null,E)}}function Wy(f){return f=iu(f),Wv(f)}var E0=null;function Wv(f){if(E0=null,f=Wt(f),f!==null){var y=g(f);if(y===null)f=null;else{var E=y.tag;if(E===13){if(f=v(y),f!==null)return f;f=null}else if(E===31){if(f=r(y),f!==null)return f;f=null}else if(E===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;f=null}else y!==f&&(f=null)}}return E0=f,null}function jw(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Qt()){case Li:return 2;case Wi:return 8;case Ei:case Hn:return 32;case An:return 268435456;default:return 32}default:return 32}}var A0=!1,Pd=null,lm=null,Qm=null,A_=new Map,Pg=new Map,cm=[],qw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zv(f,y){switch(f){case"focusin":case"focusout":Pd=null;break;case"dragenter":case"dragleave":lm=null;break;case"mouseover":case"mouseout":Qm=null;break;case"pointerover":case"pointerout":A_.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pg.delete(y.pointerId)}}function C_(f,y,E,P,W,J){return f===null||f.nativeEvent!==J?(f={blockedOn:y,domEventName:E,eventSystemFlags:P,nativeEvent:J,targetContainers:[W]},y!==null&&(y=ye(y),y!==null&&M_(y)),f):(f.eventSystemFlags|=P,y=f.targetContainers,W!==null&&y.indexOf(W)===-1&&y.push(W),f)}function Xw(f,y,E,P,W){switch(y){case"focusin":return Pd=C_(Pd,f,y,E,P,W),!0;case"dragenter":return lm=C_(lm,f,y,E,P,W),!0;case"mouseover":return Qm=C_(Qm,f,y,E,P,W),!0;case"pointerover":var J=W.pointerId;return A_.set(J,C_(A_.get(J)||null,f,y,E,P,W)),!0;case"gotpointercapture":return J=W.pointerId,Pg.set(J,C_(Pg.get(J)||null,f,y,E,P,W)),!0}return!1}function Ww(f){var y=Wt(f.target);if(y!==null){var E=g(y);if(E!==null){if(y=E.tag,y===13){if(y=v(E),y!==null){f.blockedOn=y,jo(f.priority,function(){E_(E)});return}}else if(y===31){if(y=r(E),y!==null){f.blockedOn=y,jo(f.priority,function(){E_(E)});return}}else if(y===3&&E.stateNode.current.memoizedState.isDehydrated){f.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}f.blockedOn=null}function C0(f){if(f.blockedOn!==null)return!1;for(var y=f.targetContainers;0<y.length;){var E=Wy(f.nativeEvent);if(E===null){E=f.nativeEvent;var P=new E.constructor(E.type,E);Vl=P,E.target.dispatchEvent(P),Vl=null}else return y=ye(E),y!==null&&M_(y),f.blockedOn=E,!1;y.shift()}return!0}function Yv(f,y,E){C0(f)&&E.delete(y)}function zg(){A0=!1,Pd!==null&&C0(Pd)&&(Pd=null),lm!==null&&C0(lm)&&(lm=null),Qm!==null&&C0(Qm)&&(Qm=null),A_.forEach(Yv),Pg.forEach(Yv)}function R0(f,y){f.blockedOn===y&&(f.blockedOn=null,A0||(A0=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,zg)))}var I0=null;function Kv(f){I0!==f&&(I0=f,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){I0===f&&(I0=null);for(var y=0;y<f.length;y+=3){var E=f[y],P=f[y+1],W=f[y+2];if(typeof P!="function"){if(Wv(P||E)===null)continue;break}var J=ye(E);J!==null&&(f.splice(y,3),y-=3,Mf(J,{pending:!0,data:W,method:E.method,action:P},P,W))}}))}function um(f){function y(Ct){return R0(Ct,f)}Pd!==null&&R0(Pd,f),lm!==null&&R0(lm,f),Qm!==null&&R0(Qm,f),A_.forEach(y),Pg.forEach(y);for(var E=0;E<cm.length;E++){var P=cm[E];P.blockedOn===f&&(P.blockedOn=null)}for(;0<cm.length&&(E=cm[0],E.blockedOn===null);)Ww(E),E.blockedOn===null&&cm.shift();if(E=(f.ownerDocument||f).$$reactFormReplay,E!=null)for(P=0;P<E.length;P+=3){var W=E[P],J=E[P+1],ve=W[ge]||null;if(typeof J=="function")ve||Kv(E);else if(ve){var Xe=null;if(J&&J.hasAttribute("formAction")){if(W=J,ve=J[ge]||null)Xe=ve.formAction;else if(Wv(W)!==null)continue}else Xe=ve.action;typeof Xe=="function"?E[P+1]=Xe:(E.splice(P,3),P-=3),Kv(E)}}}function Zw(){function f(J){J.canIntercept&&J.info==="react-transition"&&J.intercept({handler:function(){return new Promise(function(ve){return W=ve})},focusReset:"manual",scroll:"manual"})}function y(){W!==null&&(W(),W=null),P||setTimeout(E,20)}function E(){if(!P&&!navigation.transition){var J=navigation.currentEntry;J&&J.url!=null&&navigation.navigate(J.url,{state:J.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var P=!1,W=null;return navigation.addEventListener("navigate",f),navigation.addEventListener("navigatesuccess",y),navigation.addEventListener("navigateerror",y),setTimeout(E,100),function(){P=!0,navigation.removeEventListener("navigate",f),navigation.removeEventListener("navigatesuccess",y),navigation.removeEventListener("navigateerror",y),W!==null&&(W(),W=null)}}}function Zy(f){this._internalRoot=f}eg.prototype.render=Zy.prototype.render=function(f){var y=this._internalRoot;if(y===null)throw Error(l(409));var E=y.current,P=rr();vp(E,P,f,y,null,null)},eg.prototype.unmount=Zy.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var y=f.containerInfo;vp(f.current,2,null,f,null,null),We(),y[Ie]=null}};function eg(f){this._internalRoot=f}eg.prototype.unstable_scheduleHydration=function(f){if(f){var y=Lo();f={blockedOn:null,target:f,priority:y};for(var E=0;E<cm.length&&y!==0&&y<cm[E].priority;E++);cm.splice(E,0,f),E===0&&Ww(f)}};var $v=e.version;if($v!=="19.2.0")throw Error(l(527,$v,"19.2.0"));Qe.findDOMNode=function(f){var y=f._reactInternals;if(y===void 0)throw typeof f.render=="function"?Error(l(188)):(f=Object.keys(f).join(","),Error(l(268,f)));return f=I(y),f=f!==null?z(f):null,f=f===null?null:f.stateNode,f};var Yw={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Re,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var D0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!D0.isDisabled&&D0.supportsFiber)try{Qi=D0.inject(Yw),qi=D0}catch{}}return M1.createRoot=function(f,y){if(!h(f))throw Error(l(299));var E=!1,P="",W=tm,J=Rf,ve=fp;return y!=null&&(y.unstable_strictMode===!0&&(E=!0),y.identifierPrefix!==void 0&&(P=y.identifierPrefix),y.onUncaughtError!==void 0&&(W=y.onUncaughtError),y.onCaughtError!==void 0&&(J=y.onCaughtError),y.onRecoverableError!==void 0&&(ve=y.onRecoverableError)),y=Gw(f,1,!1,null,null,E,P,null,W,J,ve,Zw),f[Ie]=y.current,Uo(f),new Zy(y)},M1.hydrateRoot=function(f,y,E){if(!h(f))throw Error(l(299));var P=!1,W="",J=tm,ve=Rf,Xe=fp,Ct=null;return E!=null&&(E.unstable_strictMode===!0&&(P=!0),E.identifierPrefix!==void 0&&(W=E.identifierPrefix),E.onUncaughtError!==void 0&&(J=E.onUncaughtError),E.onCaughtError!==void 0&&(ve=E.onCaughtError),E.onRecoverableError!==void 0&&(Xe=E.onRecoverableError),E.formState!==void 0&&(Ct=E.formState)),y=Gw(f,1,!0,y,E??null,P,W,Ct,J,ve,Xe,Zw),y.context=qv(null),E=y.current,P=rr(),P=js(P),W=vu(P),W.callback=null,rh(E,W,P),E=P,y.current.lanes=E,Xt(y,E),bc(y),f[Ie]=y.current,Uo(f),new eg(y)},M1.version="19.2.0",M1}var JP;function RG(){if(JP)return xA.exports;JP=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),xA.exports=CG(),xA.exports}var IG=RG();function RT(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function DG(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function gF(n){let e,i,l;n.length!==2?(e=RT,i=(r,C)=>RT(n(r),C),l=(r,C)=>n(r)-C):(e=n===RT||n===DG?n:LG,i=n,l=n);function h(r,C,I=0,z=r.length){if(I<z){if(e(C,C)!==0)return z;do{const N=I+z>>>1;i(r[N],C)<0?I=N+1:z=N}while(I<z)}return I}function g(r,C,I=0,z=r.length){if(I<z){if(e(C,C)!==0)return z;do{const N=I+z>>>1;i(r[N],C)<=0?I=N+1:z=N}while(I<z)}return I}function v(r,C,I=0,z=r.length){const N=h(r,C,I,z-1);return N>I&&l(r[N-1],C)>-l(r[N],C)?N-1:N}return{left:h,center:v,right:g}}function LG(){return 0}function PG(n){return n===null?NaN:+n}const zG=gF(RT),OG=zG.right;gF(PG).center;function DR(n,e){let i,l;if(e===void 0)for(const h of n)h!=null&&(i===void 0?h>=h&&(i=l=h):(i>h&&(i=h),l<h&&(l=h)));else{let h=-1;for(let g of n)(g=e(g,++h,n))!=null&&(i===void 0?g>=g&&(i=l=g):(i>g&&(i=g),l<g&&(l=g)))}return[i,l]}class Jh{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const i=this._partials;let l=0;for(let h=0;h<this._n&&h<32;h++){const g=i[h],v=e+g,r=Math.abs(e)<Math.abs(g)?e-(v-g):g-(v-e);r&&(i[l++]=r),e=v}return i[l]=e,this._n=l+1,this}valueOf(){const e=this._partials;let i=this._n,l,h,g,v=0;if(i>0){for(v=e[--i];i>0&&(l=v,h=e[--i],v=l+h,g=h-(v-l),!g););i>0&&(g<0&&e[i-1]<0||g>0&&e[i-1]>0)&&(h=g*2,l=v+h,h==l-v&&(v=l))}return v}}const BG=Math.sqrt(50),NG=Math.sqrt(10),FG=Math.sqrt(2);function qT(n,e,i){const l=(e-n)/Math.max(0,i),h=Math.floor(Math.log10(l)),g=l/Math.pow(10,h),v=g>=BG?10:g>=NG?5:g>=FG?2:1;let r,C,I;return h<0?(I=Math.pow(10,-h)/v,r=Math.round(n*I),C=Math.round(e*I),r/I<n&&++r,C/I>e&&--C,I=-I):(I=Math.pow(10,h)*v,r=Math.round(n/I),C=Math.round(e/I),r*I<n&&++r,C*I>e&&--C),C<r&&.5<=i&&i<2?qT(n,e,i*2):[r,C,I]}function UG(n,e,i){if(e=+e,n=+n,i=+i,!(i>0))return[];if(n===e)return[n];const l=e<n,[h,g,v]=l?qT(e,n,i):qT(n,e,i);if(!(g>=h))return[];const r=g-h+1,C=new Array(r);if(l)if(v<0)for(let I=0;I<r;++I)C[I]=(g-I)/-v;else for(let I=0;I<r;++I)C[I]=(g-I)*v;else if(v<0)for(let I=0;I<r;++I)C[I]=(h+I)/-v;else for(let I=0;I<r;++I)C[I]=(h+I)*v;return C}function sC(n,e,i){return e=+e,n=+n,i=+i,qT(n,e,i)[2]}function kG(n,e,i){e=+e,n=+n,i=+i;const l=e<n,h=l?sC(e,n,i):sC(n,e,i);return(l?-1:1)*(h<0?1/-h:h)}function _F(n,e){let i;if(e===void 0)for(const l of n)l!=null&&(i<l||i===void 0&&l>=l)&&(i=l);else{let l=-1;for(let h of n)(h=e(h,++l,n))!=null&&(i<h||i===void 0&&h>=h)&&(i=h)}return i}function VG(n,e){let i;if(e===void 0)for(const l of n)l!=null&&(i>l||i===void 0&&l>=l)&&(i=l);else{let l=-1;for(let h of n)(h=e(h,++l,n))!=null&&(i>h||i===void 0&&h>=h)&&(i=h)}return i}function GG(n,e,i){n=+n,e=+e,i=(h=arguments.length)<2?(e=n,n=0,1):h<3?1:+i;for(var l=-1,h=Math.max(0,Math.ceil((e-n)/i))|0,g=new Array(h);++l<h;)g[l]=n+l*i;return g}function HG(n){return n}var SA=1,TA=2,aC=3,j1=4,QP=1e-6;function jG(n){return"translate("+n+",0)"}function qG(n){return"translate(0,"+n+")"}function XG(n){return e=>+n(e)}function WG(n,e){return e=Math.max(0,n.bandwidth()-e*2)/2,n.round()&&(e=Math.round(e)),i=>+n(i)+e}function ZG(){return!this.__axis}function yF(n,e){var i=[],l=null,h=null,g=6,v=6,r=3,C=typeof window<"u"&&window.devicePixelRatio>1?0:.5,I=n===SA||n===j1?-1:1,z=n===j1||n===TA?"x":"y",N=n===SA||n===aC?jG:qG;function k(j){var $=l??(e.ticks?e.ticks.apply(e,i):e.domain()),re=h??(e.tickFormat?e.tickFormat.apply(e,i):HG),ie=Math.max(g,0)+r,Y=e.range(),ae=+Y[0]+C,ue=+Y[Y.length-1]+C,me=(e.bandwidth?WG:XG)(e.copy(),C),Ae=j.selection?j.selection():j,Se=Ae.selectAll(".domain").data([null]),ze=Ae.selectAll(".tick").data($,e).order(),je=ze.exit(),Ce=ze.enter().append("g").attr("class","tick"),Te=ze.select("line"),Ze=ze.select("text");Se=Se.merge(Se.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),ze=ze.merge(Ce),Te=Te.merge(Ce.append("line").attr("stroke","currentColor").attr(z+"2",I*g)),Ze=Ze.merge(Ce.append("text").attr("fill","currentColor").attr(z,I*ie).attr("dy",n===SA?"0em":n===aC?"0.71em":"0.32em")),j!==Ae&&(Se=Se.transition(j),ze=ze.transition(j),Te=Te.transition(j),Ze=Ze.transition(j),je=je.transition(j).attr("opacity",QP).attr("transform",function(Mt){return isFinite(Mt=me(Mt))?N(Mt+C):this.getAttribute("transform")}),Ce.attr("opacity",QP).attr("transform",function(Mt){var mt=this.parentNode.__axis;return N((mt&&isFinite(mt=mt(Mt))?mt:me(Mt))+C)})),je.remove(),Se.attr("d",n===j1||n===TA?v?"M"+I*v+","+ae+"H"+C+"V"+ue+"H"+I*v:"M"+C+","+ae+"V"+ue:v?"M"+ae+","+I*v+"V"+C+"H"+ue+"V"+I*v:"M"+ae+","+C+"H"+ue),ze.attr("opacity",1).attr("transform",function(Mt){return N(me(Mt)+C)}),Te.attr(z+"2",I*g),Ze.attr(z,I*ie).text(re),Ae.filter(ZG).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",n===TA?"start":n===j1?"end":"middle"),Ae.each(function(){this.__axis=me})}return k.scale=function(j){return arguments.length?(e=j,k):e},k.ticks=function(){return i=Array.from(arguments),k},k.tickArguments=function(j){return arguments.length?(i=j==null?[]:Array.from(j),k):i.slice()},k.tickValues=function(j){return arguments.length?(l=j==null?null:Array.from(j),k):l&&l.slice()},k.tickFormat=function(j){return arguments.length?(h=j,k):h},k.tickSize=function(j){return arguments.length?(g=v=+j,k):g},k.tickSizeInner=function(j){return arguments.length?(g=+j,k):g},k.tickSizeOuter=function(j){return arguments.length?(v=+j,k):v},k.tickPadding=function(j){return arguments.length?(r=+j,k):r},k.offset=function(j){return arguments.length?(C=+j,k):C},k}function xF(n){return yF(aC,n)}function vF(n){return yF(j1,n)}var YG={value:()=>{}};function bF(){for(var n=0,e=arguments.length,i={},l;n<e;++n){if(!(l=arguments[n]+"")||l in i||/[\s.]/.test(l))throw new Error("illegal type: "+l);i[l]=[]}return new IT(i)}function IT(n){this._=n}function KG(n,e){return n.trim().split(/^|\s+/).map(function(i){var l="",h=i.indexOf(".");if(h>=0&&(l=i.slice(h+1),i=i.slice(0,h)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:l}})}IT.prototype=bF.prototype={constructor:IT,on:function(n,e){var i=this._,l=KG(n+"",i),h,g=-1,v=l.length;if(arguments.length<2){for(;++g<v;)if((h=(n=l[g]).type)&&(h=$G(i[h],n.name)))return h;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++g<v;)if(h=(n=l[g]).type)i[h]=ez(i[h],n.name,e);else if(e==null)for(h in i)i[h]=ez(i[h],n.name,null);return this},copy:function(){var n={},e=this._;for(var i in e)n[i]=e[i].slice();return new IT(n)},call:function(n,e){if((h=arguments.length-2)>0)for(var i=new Array(h),l=0,h,g;l<h;++l)i[l]=arguments[l+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(g=this._[n],l=0,h=g.length;l<h;++l)g[l].value.apply(e,i)},apply:function(n,e,i){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var l=this._[n],h=0,g=l.length;h<g;++h)l[h].value.apply(e,i)}};function $G(n,e){for(var i=0,l=n.length,h;i<l;++i)if((h=n[i]).name===e)return h.value}function ez(n,e,i){for(var l=0,h=n.length;l<h;++l)if(n[l].name===e){n[l]=YG,n=n.slice(0,l).concat(n.slice(l+1));break}return i!=null&&n.push({name:e,value:i}),n}var oC="http://www.w3.org/1999/xhtml";const tz={svg:"http://www.w3.org/2000/svg",xhtml:oC,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function xM(n){var e=n+="",i=e.indexOf(":");return i>=0&&(e=n.slice(0,i))!=="xmlns"&&(n=n.slice(i+1)),tz.hasOwnProperty(e)?{space:tz[e],local:n}:n}function JG(n){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===oC&&e.documentElement.namespaceURI===oC?e.createElement(n):e.createElementNS(i,n)}}function QG(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function wF(n){var e=xM(n);return(e.local?QG:JG)(e)}function eH(){}function LR(n){return n==null?eH:function(){return this.querySelector(n)}}function tH(n){typeof n!="function"&&(n=LR(n));for(var e=this._groups,i=e.length,l=new Array(i),h=0;h<i;++h)for(var g=e[h],v=g.length,r=l[h]=new Array(v),C,I,z=0;z<v;++z)(C=g[z])&&(I=n.call(C,C.__data__,z,g))&&("__data__"in C&&(I.__data__=C.__data__),r[z]=I);return new Gd(l,this._parents)}function iH(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function nH(){return[]}function SF(n){return n==null?nH:function(){return this.querySelectorAll(n)}}function rH(n){return function(){return iH(n.apply(this,arguments))}}function sH(n){typeof n=="function"?n=rH(n):n=SF(n);for(var e=this._groups,i=e.length,l=[],h=[],g=0;g<i;++g)for(var v=e[g],r=v.length,C,I=0;I<r;++I)(C=v[I])&&(l.push(n.call(C,C.__data__,I,v)),h.push(C));return new Gd(l,h)}function TF(n){return function(){return this.matches(n)}}function MF(n){return function(e){return e.matches(n)}}var aH=Array.prototype.find;function oH(n){return function(){return aH.call(this.children,n)}}function lH(){return this.firstElementChild}function cH(n){return this.select(n==null?lH:oH(typeof n=="function"?n:MF(n)))}var uH=Array.prototype.filter;function hH(){return Array.from(this.children)}function fH(n){return function(){return uH.call(this.children,n)}}function dH(n){return this.selectAll(n==null?hH:fH(typeof n=="function"?n:MF(n)))}function pH(n){typeof n!="function"&&(n=TF(n));for(var e=this._groups,i=e.length,l=new Array(i),h=0;h<i;++h)for(var g=e[h],v=g.length,r=l[h]=[],C,I=0;I<v;++I)(C=g[I])&&n.call(C,C.__data__,I,g)&&r.push(C);return new Gd(l,this._parents)}function EF(n){return new Array(n.length)}function mH(){return new Gd(this._enter||this._groups.map(EF),this._parents)}function XT(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}XT.prototype={constructor:XT,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function gH(n){return function(){return n}}function _H(n,e,i,l,h,g){for(var v=0,r,C=e.length,I=g.length;v<I;++v)(r=e[v])?(r.__data__=g[v],l[v]=r):i[v]=new XT(n,g[v]);for(;v<C;++v)(r=e[v])&&(h[v]=r)}function yH(n,e,i,l,h,g,v){var r,C,I=new Map,z=e.length,N=g.length,k=new Array(z),j;for(r=0;r<z;++r)(C=e[r])&&(k[r]=j=v.call(C,C.__data__,r,e)+"",I.has(j)?h[r]=C:I.set(j,C));for(r=0;r<N;++r)j=v.call(n,g[r],r,g)+"",(C=I.get(j))?(l[r]=C,C.__data__=g[r],I.delete(j)):i[r]=new XT(n,g[r]);for(r=0;r<z;++r)(C=e[r])&&I.get(k[r])===C&&(h[r]=C)}function xH(n){return n.__data__}function vH(n,e){if(!arguments.length)return Array.from(this,xH);var i=e?yH:_H,l=this._parents,h=this._groups;typeof n!="function"&&(n=gH(n));for(var g=h.length,v=new Array(g),r=new Array(g),C=new Array(g),I=0;I<g;++I){var z=l[I],N=h[I],k=N.length,j=bH(n.call(z,z&&z.__data__,I,l)),$=j.length,re=r[I]=new Array($),ie=v[I]=new Array($),Y=C[I]=new Array(k);i(z,N,re,ie,Y,j,e);for(var ae=0,ue=0,me,Ae;ae<$;++ae)if(me=re[ae]){for(ae>=ue&&(ue=ae+1);!(Ae=ie[ue])&&++ue<$;);me._next=Ae||null}}return v=new Gd(v,l),v._enter=r,v._exit=C,v}function bH(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function wH(){return new Gd(this._exit||this._groups.map(EF),this._parents)}function SH(n,e,i){var l=this.enter(),h=this,g=this.exit();return typeof n=="function"?(l=n(l),l&&(l=l.selection())):l=l.append(n+""),e!=null&&(h=e(h),h&&(h=h.selection())),i==null?g.remove():i(g),l&&h?l.merge(h).order():h}function TH(n){for(var e=n.selection?n.selection():n,i=this._groups,l=e._groups,h=i.length,g=l.length,v=Math.min(h,g),r=new Array(h),C=0;C<v;++C)for(var I=i[C],z=l[C],N=I.length,k=r[C]=new Array(N),j,$=0;$<N;++$)(j=I[$]||z[$])&&(k[$]=j);for(;C<h;++C)r[C]=i[C];return new Gd(r,this._parents)}function MH(){for(var n=this._groups,e=-1,i=n.length;++e<i;)for(var l=n[e],h=l.length-1,g=l[h],v;--h>=0;)(v=l[h])&&(g&&v.compareDocumentPosition(g)^4&&g.parentNode.insertBefore(v,g),g=v);return this}function EH(n){n||(n=AH);function e(N,k){return N&&k?n(N.__data__,k.__data__):!N-!k}for(var i=this._groups,l=i.length,h=new Array(l),g=0;g<l;++g){for(var v=i[g],r=v.length,C=h[g]=new Array(r),I,z=0;z<r;++z)(I=v[z])&&(C[z]=I);C.sort(e)}return new Gd(h,this._parents).order()}function AH(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function CH(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function RH(){return Array.from(this)}function IH(){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var l=n[e],h=0,g=l.length;h<g;++h){var v=l[h];if(v)return v}return null}function DH(){let n=0;for(const e of this)++n;return n}function LH(){return!this.node()}function PH(n){for(var e=this._groups,i=0,l=e.length;i<l;++i)for(var h=e[i],g=0,v=h.length,r;g<v;++g)(r=h[g])&&n.call(r,r.__data__,g,h);return this}function zH(n){return function(){this.removeAttribute(n)}}function OH(n){return function(){this.removeAttributeNS(n.space,n.local)}}function BH(n,e){return function(){this.setAttribute(n,e)}}function NH(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function FH(n,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(n):this.setAttribute(n,i)}}function UH(n,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,i)}}function kH(n,e){var i=xM(n);if(arguments.length<2){var l=this.node();return i.local?l.getAttributeNS(i.space,i.local):l.getAttribute(i)}return this.each((e==null?i.local?OH:zH:typeof e=="function"?i.local?UH:FH:i.local?NH:BH)(i,e))}function AF(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function VH(n){return function(){this.style.removeProperty(n)}}function GH(n,e,i){return function(){this.style.setProperty(n,e,i)}}function HH(n,e,i){return function(){var l=e.apply(this,arguments);l==null?this.style.removeProperty(n):this.style.setProperty(n,l,i)}}function jH(n,e,i){return arguments.length>1?this.each((e==null?VH:typeof e=="function"?HH:GH)(n,e,i??"")):Yx(this.node(),n)}function Yx(n,e){return n.style.getPropertyValue(e)||AF(n).getComputedStyle(n,null).getPropertyValue(e)}function qH(n){return function(){delete this[n]}}function XH(n,e){return function(){this[n]=e}}function WH(n,e){return function(){var i=e.apply(this,arguments);i==null?delete this[n]:this[n]=i}}function ZH(n,e){return arguments.length>1?this.each((e==null?qH:typeof e=="function"?WH:XH)(n,e)):this.node()[n]}function CF(n){return n.trim().split(/^|\s+/)}function PR(n){return n.classList||new RF(n)}function RF(n){this._node=n,this._names=CF(n.getAttribute("class")||"")}RF.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function IF(n,e){for(var i=PR(n),l=-1,h=e.length;++l<h;)i.add(e[l])}function DF(n,e){for(var i=PR(n),l=-1,h=e.length;++l<h;)i.remove(e[l])}function YH(n){return function(){IF(this,n)}}function KH(n){return function(){DF(this,n)}}function $H(n,e){return function(){(e.apply(this,arguments)?IF:DF)(this,n)}}function JH(n,e){var i=CF(n+"");if(arguments.length<2){for(var l=PR(this.node()),h=-1,g=i.length;++h<g;)if(!l.contains(i[h]))return!1;return!0}return this.each((typeof e=="function"?$H:e?YH:KH)(i,e))}function QH(){this.textContent=""}function ej(n){return function(){this.textContent=n}}function tj(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function ij(n){return arguments.length?this.each(n==null?QH:(typeof n=="function"?tj:ej)(n)):this.node().textContent}function nj(){this.innerHTML=""}function rj(n){return function(){this.innerHTML=n}}function sj(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function aj(n){return arguments.length?this.each(n==null?nj:(typeof n=="function"?sj:rj)(n)):this.node().innerHTML}function oj(){this.nextSibling&&this.parentNode.appendChild(this)}function lj(){return this.each(oj)}function cj(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uj(){return this.each(cj)}function hj(n){var e=typeof n=="function"?n:wF(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function fj(){return null}function dj(n,e){var i=typeof n=="function"?n:wF(n),l=e==null?fj:typeof e=="function"?e:LR(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),l.apply(this,arguments)||null)})}function pj(){var n=this.parentNode;n&&n.removeChild(this)}function mj(){return this.each(pj)}function gj(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function _j(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function yj(n){return this.select(n?_j:gj)}function xj(n){return arguments.length?this.property("__data__",n):this.node().__data__}function vj(n){return function(e){n.call(this,e,this.__data__)}}function bj(n){return n.trim().split(/^|\s+/).map(function(e){var i="",l=e.indexOf(".");return l>=0&&(i=e.slice(l+1),e=e.slice(0,l)),{type:e,name:i}})}function wj(n){return function(){var e=this.__on;if(e){for(var i=0,l=-1,h=e.length,g;i<h;++i)g=e[i],(!n.type||g.type===n.type)&&g.name===n.name?this.removeEventListener(g.type,g.listener,g.options):e[++l]=g;++l?e.length=l:delete this.__on}}}function Sj(n,e,i){return function(){var l=this.__on,h,g=vj(e);if(l){for(var v=0,r=l.length;v<r;++v)if((h=l[v]).type===n.type&&h.name===n.name){this.removeEventListener(h.type,h.listener,h.options),this.addEventListener(h.type,h.listener=g,h.options=i),h.value=e;return}}this.addEventListener(n.type,g,i),h={type:n.type,name:n.name,value:e,listener:g,options:i},l?l.push(h):this.__on=[h]}}function Tj(n,e,i){var l=bj(n+""),h,g=l.length,v;if(arguments.length<2){var r=this.node().__on;if(r){for(var C=0,I=r.length,z;C<I;++C)for(h=0,z=r[C];h<g;++h)if((v=l[h]).type===z.type&&v.name===z.name)return z.value}return}for(r=e?Sj:wj,h=0;h<g;++h)this.each(r(l[h],e,i));return this}function LF(n,e,i){var l=AF(n),h=l.CustomEvent;typeof h=="function"?h=new h(e,i):(h=l.document.createEvent("Event"),i?(h.initEvent(e,i.bubbles,i.cancelable),h.detail=i.detail):h.initEvent(e,!1,!1)),n.dispatchEvent(h)}function Mj(n,e){return function(){return LF(this,n,e)}}function Ej(n,e){return function(){return LF(this,n,e.apply(this,arguments))}}function Aj(n,e){return this.each((typeof e=="function"?Ej:Mj)(n,e))}function*Cj(){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var l=n[e],h=0,g=l.length,v;h<g;++h)(v=l[h])&&(yield v)}var PF=[null];function Gd(n,e){this._groups=n,this._parents=e}function tw(){return new Gd([[document.documentElement]],PF)}function Rj(){return this}Gd.prototype=tw.prototype={constructor:Gd,select:tH,selectAll:sH,selectChild:cH,selectChildren:dH,filter:pH,data:vH,enter:mH,exit:wH,join:SH,merge:TH,selection:Rj,order:MH,sort:EH,call:CH,nodes:RH,node:IH,size:DH,empty:LH,each:PH,attr:kH,style:jH,property:ZH,classed:JH,text:ij,html:aj,raise:lj,lower:uj,append:hj,insert:dj,remove:mj,clone:yj,datum:xj,on:Tj,dispatch:Aj,[Symbol.iterator]:Cj};function WT(n){return typeof n=="string"?new Gd([[document.querySelector(n)]],[document.documentElement]):new Gd([[n]],PF)}function zR(n,e,i){n.prototype=e.prototype=i,i.constructor=n}function zF(n,e){var i=Object.create(n.prototype);for(var l in e)i[l]=e[l];return i}function iw(){}var wb=.7,ZT=1/wb,jx="\\s*([+-]?\\d+)\\s*",Sb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",cg="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ij=/^#([0-9a-f]{3,8})$/,Dj=new RegExp(`^rgb\\(${jx},${jx},${jx}\\)$`),Lj=new RegExp(`^rgb\\(${cg},${cg},${cg}\\)$`),Pj=new RegExp(`^rgba\\(${jx},${jx},${jx},${Sb}\\)$`),zj=new RegExp(`^rgba\\(${cg},${cg},${cg},${Sb}\\)$`),Oj=new RegExp(`^hsl\\(${Sb},${cg},${cg}\\)$`),Bj=new RegExp(`^hsla\\(${Sb},${cg},${cg},${Sb}\\)$`),iz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};zR(iw,_y,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:nz,formatHex:nz,formatHex8:Nj,formatHsl:Fj,formatRgb:rz,toString:rz});function nz(){return this.rgb().formatHex()}function Nj(){return this.rgb().formatHex8()}function Fj(){return OF(this).formatHsl()}function rz(){return this.rgb().formatRgb()}function _y(n){var e,i;return n=(n+"").trim().toLowerCase(),(e=Ij.exec(n))?(i=e[1].length,e=parseInt(e[1],16),i===6?sz(e):i===3?new Xf(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?RS(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?RS(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Dj.exec(n))?new Xf(e[1],e[2],e[3],1):(e=Lj.exec(n))?new Xf(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Pj.exec(n))?RS(e[1],e[2],e[3],e[4]):(e=zj.exec(n))?RS(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Oj.exec(n))?lz(e[1],e[2]/100,e[3]/100,1):(e=Bj.exec(n))?lz(e[1],e[2]/100,e[3]/100,e[4]):iz.hasOwnProperty(n)?sz(iz[n]):n==="transparent"?new Xf(NaN,NaN,NaN,0):null}function sz(n){return new Xf(n>>16&255,n>>8&255,n&255,1)}function RS(n,e,i,l){return l<=0&&(n=e=i=NaN),new Xf(n,e,i,l)}function Uj(n){return n instanceof iw||(n=_y(n)),n?(n=n.rgb(),new Xf(n.r,n.g,n.b,n.opacity)):new Xf}function YT(n,e,i,l){return arguments.length===1?Uj(n):new Xf(n,e,i,l??1)}function Xf(n,e,i,l){this.r=+n,this.g=+e,this.b=+i,this.opacity=+l}zR(Xf,YT,zF(iw,{brighter(n){return n=n==null?ZT:Math.pow(ZT,n),new Xf(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?wb:Math.pow(wb,n),new Xf(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Xf(uy(this.r),uy(this.g),uy(this.b),KT(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:az,formatHex:az,formatHex8:kj,formatRgb:oz,toString:oz}));function az(){return`#${ry(this.r)}${ry(this.g)}${ry(this.b)}`}function kj(){return`#${ry(this.r)}${ry(this.g)}${ry(this.b)}${ry((isNaN(this.opacity)?1:this.opacity)*255)}`}function oz(){const n=KT(this.opacity);return`${n===1?"rgb(":"rgba("}${uy(this.r)}, ${uy(this.g)}, ${uy(this.b)}${n===1?")":`, ${n})`}`}function KT(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function uy(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function ry(n){return n=uy(n),(n<16?"0":"")+n.toString(16)}function lz(n,e,i,l){return l<=0?n=e=i=NaN:i<=0||i>=1?n=e=NaN:e<=0&&(n=NaN),new Tm(n,e,i,l)}function OF(n){if(n instanceof Tm)return new Tm(n.h,n.s,n.l,n.opacity);if(n instanceof iw||(n=_y(n)),!n)return new Tm;if(n instanceof Tm)return n;n=n.rgb();var e=n.r/255,i=n.g/255,l=n.b/255,h=Math.min(e,i,l),g=Math.max(e,i,l),v=NaN,r=g-h,C=(g+h)/2;return r?(e===g?v=(i-l)/r+(i<l)*6:i===g?v=(l-e)/r+2:v=(e-i)/r+4,r/=C<.5?g+h:2-g-h,v*=60):r=C>0&&C<1?0:v,new Tm(v,r,C,n.opacity)}function Vj(n,e,i,l){return arguments.length===1?OF(n):new Tm(n,e,i,l??1)}function Tm(n,e,i,l){this.h=+n,this.s=+e,this.l=+i,this.opacity=+l}zR(Tm,Vj,zF(iw,{brighter(n){return n=n==null?ZT:Math.pow(ZT,n),new Tm(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?wb:Math.pow(wb,n),new Tm(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,i=this.l,l=i+(i<.5?i:1-i)*e,h=2*i-l;return new Xf(MA(n>=240?n-240:n+120,h,l),MA(n,h,l),MA(n<120?n+240:n-120,h,l),this.opacity)},clamp(){return new Tm(cz(this.h),IS(this.s),IS(this.l),KT(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=KT(this.opacity);return`${n===1?"hsl(":"hsla("}${cz(this.h)}, ${IS(this.s)*100}%, ${IS(this.l)*100}%${n===1?")":`, ${n})`}`}}));function cz(n){return n=(n||0)%360,n<0?n+360:n}function IS(n){return Math.max(0,Math.min(1,n||0))}function MA(n,e,i){return(n<60?e+(i-e)*n/60:n<180?i:n<240?e+(i-e)*(240-n)/60:e)*255}function Gj(n,e,i,l,h){var g=n*n,v=g*n;return((1-3*n+3*g-v)*e+(4-6*g+3*v)*i+(1+3*n+3*g-3*v)*l+v*h)/6}function Hj(n){var e=n.length-1;return function(i){var l=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),h=n[l],g=n[l+1],v=l>0?n[l-1]:2*h-g,r=l<e-1?n[l+2]:2*g-h;return Gj((i-l/e)*e,v,h,g,r)}}const OR=n=>()=>n;function jj(n,e){return function(i){return n+i*e}}function qj(n,e,i){return n=Math.pow(n,i),e=Math.pow(e,i)-n,i=1/i,function(l){return Math.pow(n+l*e,i)}}function Xj(n){return(n=+n)==1?BF:function(e,i){return i-e?qj(e,i,n):OR(isNaN(e)?i:e)}}function BF(n,e){var i=e-n;return i?jj(n,i):OR(isNaN(n)?e:n)}const $T=(function n(e){var i=Xj(e);function l(h,g){var v=i((h=YT(h)).r,(g=YT(g)).r),r=i(h.g,g.g),C=i(h.b,g.b),I=BF(h.opacity,g.opacity);return function(z){return h.r=v(z),h.g=r(z),h.b=C(z),h.opacity=I(z),h+""}}return l.gamma=n,l})(1);function Wj(n){return function(e){var i=e.length,l=new Array(i),h=new Array(i),g=new Array(i),v,r;for(v=0;v<i;++v)r=YT(e[v]),l[v]=r.r||0,h[v]=r.g||0,g[v]=r.b||0;return l=n(l),h=n(h),g=n(g),r.opacity=1,function(C){return r.r=l(C),r.g=h(C),r.b=g(C),r+""}}}var Zj=Wj(Hj);function Yj(n,e){e||(e=[]);var i=n?Math.min(e.length,n.length):0,l=e.slice(),h;return function(g){for(h=0;h<i;++h)l[h]=n[h]*(1-g)+e[h]*g;return l}}function Kj(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function $j(n,e){var i=e?e.length:0,l=n?Math.min(i,n.length):0,h=new Array(l),g=new Array(i),v;for(v=0;v<l;++v)h[v]=vM(n[v],e[v]);for(;v<i;++v)g[v]=e[v];return function(r){for(v=0;v<l;++v)g[v]=h[v](r);return g}}function Jj(n,e){var i=new Date;return n=+n,e=+e,function(l){return i.setTime(n*(1-l)+e*l),i}}function wm(n,e){return n=+n,e=+e,function(i){return n*(1-i)+e*i}}function Qj(n,e){var i={},l={},h;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(h in e)h in n?i[h]=vM(n[h],e[h]):l[h]=e[h];return function(g){for(h in i)l[h]=i[h](g);return l}}var lC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,EA=new RegExp(lC.source,"g");function e9(n){return function(){return n}}function t9(n){return function(e){return n(e)+""}}function NF(n,e){var i=lC.lastIndex=EA.lastIndex=0,l,h,g,v=-1,r=[],C=[];for(n=n+"",e=e+"";(l=lC.exec(n))&&(h=EA.exec(e));)(g=h.index)>i&&(g=e.slice(i,g),r[v]?r[v]+=g:r[++v]=g),(l=l[0])===(h=h[0])?r[v]?r[v]+=h:r[++v]=h:(r[++v]=null,C.push({i:v,x:wm(l,h)})),i=EA.lastIndex;return i<e.length&&(g=e.slice(i),r[v]?r[v]+=g:r[++v]=g),r.length<2?C[0]?t9(C[0].x):e9(e):(e=C.length,function(I){for(var z=0,N;z<e;++z)r[(N=C[z]).i]=N.x(I);return r.join("")})}function vM(n,e){var i=typeof e,l;return e==null||i==="boolean"?OR(e):(i==="number"?wm:i==="string"?(l=_y(e))?(e=l,$T):NF:e instanceof _y?$T:e instanceof Date?Jj:Kj(e)?Yj:Array.isArray(e)?$j:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Qj:wm)(n,e)}function FF(n,e){return n=+n,e=+e,function(i){return Math.round(n*(1-i)+e*i)}}var uz=180/Math.PI,cC={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function UF(n,e,i,l,h,g){var v,r,C;return(v=Math.sqrt(n*n+e*e))&&(n/=v,e/=v),(C=n*i+e*l)&&(i-=n*C,l-=e*C),(r=Math.sqrt(i*i+l*l))&&(i/=r,l/=r,C/=r),n*l<e*i&&(n=-n,e=-e,C=-C,v=-v),{translateX:h,translateY:g,rotate:Math.atan2(e,n)*uz,skewX:Math.atan(C)*uz,scaleX:v,scaleY:r}}var DS;function i9(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?cC:UF(e.a,e.b,e.c,e.d,e.e,e.f)}function n9(n){return n==null||(DS||(DS=document.createElementNS("http://www.w3.org/2000/svg","g")),DS.setAttribute("transform",n),!(n=DS.transform.baseVal.consolidate()))?cC:(n=n.matrix,UF(n.a,n.b,n.c,n.d,n.e,n.f))}function kF(n,e,i,l){function h(I){return I.length?I.pop()+" ":""}function g(I,z,N,k,j,$){if(I!==N||z!==k){var re=j.push("translate(",null,e,null,i);$.push({i:re-4,x:wm(I,N)},{i:re-2,x:wm(z,k)})}else(N||k)&&j.push("translate("+N+e+k+i)}function v(I,z,N,k){I!==z?(I-z>180?z+=360:z-I>180&&(I+=360),k.push({i:N.push(h(N)+"rotate(",null,l)-2,x:wm(I,z)})):z&&N.push(h(N)+"rotate("+z+l)}function r(I,z,N,k){I!==z?k.push({i:N.push(h(N)+"skewX(",null,l)-2,x:wm(I,z)}):z&&N.push(h(N)+"skewX("+z+l)}function C(I,z,N,k,j,$){if(I!==N||z!==k){var re=j.push(h(j)+"scale(",null,",",null,")");$.push({i:re-4,x:wm(I,N)},{i:re-2,x:wm(z,k)})}else(N!==1||k!==1)&&j.push(h(j)+"scale("+N+","+k+")")}return function(I,z){var N=[],k=[];return I=n(I),z=n(z),g(I.translateX,I.translateY,z.translateX,z.translateY,N,k),v(I.rotate,z.rotate,N,k),r(I.skewX,z.skewX,N,k),C(I.scaleX,I.scaleY,z.scaleX,z.scaleY,N,k),I=z=null,function(j){for(var $=-1,re=k.length,ie;++$<re;)N[(ie=k[$]).i]=ie.x(j);return N.join("")}}}var r9=kF(i9,"px, ","px)","deg)"),s9=kF(n9,", ",")",")"),Kx=0,q1=0,E1=0,VF=1e3,JT,X1,QT=0,yy=0,bM=0,Tb=typeof performance=="object"&&performance.now?performance:Date,GF=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function BR(){return yy||(GF(a9),yy=Tb.now()+bM)}function a9(){yy=0}function e2(){this._call=this._time=this._next=null}e2.prototype=HF.prototype={constructor:e2,restart:function(n,e,i){if(typeof n!="function")throw new TypeError("callback is not a function");i=(i==null?BR():+i)+(e==null?0:+e),!this._next&&X1!==this&&(X1?X1._next=this:JT=this,X1=this),this._call=n,this._time=i,uC()},stop:function(){this._call&&(this._call=null,this._time=1/0,uC())}};function HF(n,e,i){var l=new e2;return l.restart(n,e,i),l}function o9(){BR(),++Kx;for(var n=JT,e;n;)(e=yy-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Kx}function hz(){yy=(QT=Tb.now())+bM,Kx=q1=0;try{o9()}finally{Kx=0,c9(),yy=0}}function l9(){var n=Tb.now(),e=n-QT;e>VF&&(bM-=e,QT=n)}function c9(){for(var n,e=JT,i,l=1/0;e;)e._call?(l>e._time&&(l=e._time),n=e,e=e._next):(i=e._next,e._next=null,e=n?n._next=i:JT=i);X1=n,uC(l)}function uC(n){if(!Kx){q1&&(q1=clearTimeout(q1));var e=n-yy;e>24?(n<1/0&&(q1=setTimeout(hz,n-Tb.now()-bM)),E1&&(E1=clearInterval(E1))):(E1||(QT=Tb.now(),E1=setInterval(l9,VF)),Kx=1,GF(hz))}}function fz(n,e,i){var l=new e2;return e=e==null?0:+e,l.restart(h=>{l.stop(),n(h+e)},e,i),l}var u9=bF("start","end","cancel","interrupt"),h9=[],jF=0,dz=1,hC=2,DT=3,pz=4,fC=5,LT=6;function wM(n,e,i,l,h,g){var v=n.__transition;if(!v)n.__transition={};else if(i in v)return;f9(n,i,{name:e,index:l,group:h,on:u9,tween:h9,time:g.time,delay:g.delay,duration:g.duration,ease:g.ease,timer:null,state:jF})}function NR(n,e){var i=Im(n,e);if(i.state>jF)throw new Error("too late; already scheduled");return i}function mg(n,e){var i=Im(n,e);if(i.state>DT)throw new Error("too late; already running");return i}function Im(n,e){var i=n.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function f9(n,e,i){var l=n.__transition,h;l[e]=i,i.timer=HF(g,0,i.time);function g(I){i.state=dz,i.timer.restart(v,i.delay,i.time),i.delay<=I&&v(I-i.delay)}function v(I){var z,N,k,j;if(i.state!==dz)return C();for(z in l)if(j=l[z],j.name===i.name){if(j.state===DT)return fz(v);j.state===pz?(j.state=LT,j.timer.stop(),j.on.call("interrupt",n,n.__data__,j.index,j.group),delete l[z]):+z<e&&(j.state=LT,j.timer.stop(),j.on.call("cancel",n,n.__data__,j.index,j.group),delete l[z])}if(fz(function(){i.state===DT&&(i.state=pz,i.timer.restart(r,i.delay,i.time),r(I))}),i.state=hC,i.on.call("start",n,n.__data__,i.index,i.group),i.state===hC){for(i.state=DT,h=new Array(k=i.tween.length),z=0,N=-1;z<k;++z)(j=i.tween[z].value.call(n,n.__data__,i.index,i.group))&&(h[++N]=j);h.length=N+1}}function r(I){for(var z=I<i.duration?i.ease.call(null,I/i.duration):(i.timer.restart(C),i.state=fC,1),N=-1,k=h.length;++N<k;)h[N].call(n,z);i.state===fC&&(i.on.call("end",n,n.__data__,i.index,i.group),C())}function C(){i.state=LT,i.timer.stop(),delete l[e];for(var I in l)return;delete n.__transition}}function d9(n,e){var i=n.__transition,l,h,g=!0,v;if(i){e=e==null?null:e+"";for(v in i){if((l=i[v]).name!==e){g=!1;continue}h=l.state>hC&&l.state<fC,l.state=LT,l.timer.stop(),l.on.call(h?"interrupt":"cancel",n,n.__data__,l.index,l.group),delete i[v]}g&&delete n.__transition}}function p9(n){return this.each(function(){d9(this,n)})}function m9(n,e){var i,l;return function(){var h=mg(this,n),g=h.tween;if(g!==i){l=i=g;for(var v=0,r=l.length;v<r;++v)if(l[v].name===e){l=l.slice(),l.splice(v,1);break}}h.tween=l}}function g9(n,e,i){var l,h;if(typeof i!="function")throw new Error;return function(){var g=mg(this,n),v=g.tween;if(v!==l){h=(l=v).slice();for(var r={name:e,value:i},C=0,I=h.length;C<I;++C)if(h[C].name===e){h[C]=r;break}C===I&&h.push(r)}g.tween=h}}function _9(n,e){var i=this._id;if(n+="",arguments.length<2){for(var l=Im(this.node(),i).tween,h=0,g=l.length,v;h<g;++h)if((v=l[h]).name===n)return v.value;return null}return this.each((e==null?m9:g9)(i,n,e))}function FR(n,e,i){var l=n._id;return n.each(function(){var h=mg(this,l);(h.value||(h.value={}))[e]=i.apply(this,arguments)}),function(h){return Im(h,l).value[e]}}function qF(n,e){var i;return(typeof e=="number"?wm:e instanceof _y?$T:(i=_y(e))?(e=i,$T):NF)(n,e)}function y9(n){return function(){this.removeAttribute(n)}}function x9(n){return function(){this.removeAttributeNS(n.space,n.local)}}function v9(n,e,i){var l,h=i+"",g;return function(){var v=this.getAttribute(n);return v===h?null:v===l?g:g=e(l=v,i)}}function b9(n,e,i){var l,h=i+"",g;return function(){var v=this.getAttributeNS(n.space,n.local);return v===h?null:v===l?g:g=e(l=v,i)}}function w9(n,e,i){var l,h,g;return function(){var v,r=i(this),C;return r==null?void this.removeAttribute(n):(v=this.getAttribute(n),C=r+"",v===C?null:v===l&&C===h?g:(h=C,g=e(l=v,r)))}}function S9(n,e,i){var l,h,g;return function(){var v,r=i(this),C;return r==null?void this.removeAttributeNS(n.space,n.local):(v=this.getAttributeNS(n.space,n.local),C=r+"",v===C?null:v===l&&C===h?g:(h=C,g=e(l=v,r)))}}function T9(n,e){var i=xM(n),l=i==="transform"?s9:qF;return this.attrTween(n,typeof e=="function"?(i.local?S9:w9)(i,l,FR(this,"attr."+n,e)):e==null?(i.local?x9:y9)(i):(i.local?b9:v9)(i,l,e))}function M9(n,e){return function(i){this.setAttribute(n,e.call(this,i))}}function E9(n,e){return function(i){this.setAttributeNS(n.space,n.local,e.call(this,i))}}function A9(n,e){var i,l;function h(){var g=e.apply(this,arguments);return g!==l&&(i=(l=g)&&E9(n,g)),i}return h._value=e,h}function C9(n,e){var i,l;function h(){var g=e.apply(this,arguments);return g!==l&&(i=(l=g)&&M9(n,g)),i}return h._value=e,h}function R9(n,e){var i="attr."+n;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var l=xM(n);return this.tween(i,(l.local?A9:C9)(l,e))}function I9(n,e){return function(){NR(this,n).delay=+e.apply(this,arguments)}}function D9(n,e){return e=+e,function(){NR(this,n).delay=e}}function L9(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?I9:D9)(e,n)):Im(this.node(),e).delay}function P9(n,e){return function(){mg(this,n).duration=+e.apply(this,arguments)}}function z9(n,e){return e=+e,function(){mg(this,n).duration=e}}function O9(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?P9:z9)(e,n)):Im(this.node(),e).duration}function B9(n,e){if(typeof e!="function")throw new Error;return function(){mg(this,n).ease=e}}function N9(n){var e=this._id;return arguments.length?this.each(B9(e,n)):Im(this.node(),e).ease}function F9(n,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;mg(this,n).ease=i}}function U9(n){if(typeof n!="function")throw new Error;return this.each(F9(this._id,n))}function k9(n){typeof n!="function"&&(n=TF(n));for(var e=this._groups,i=e.length,l=new Array(i),h=0;h<i;++h)for(var g=e[h],v=g.length,r=l[h]=[],C,I=0;I<v;++I)(C=g[I])&&n.call(C,C.__data__,I,g)&&r.push(C);return new $g(l,this._parents,this._name,this._id)}function V9(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,i=n._groups,l=e.length,h=i.length,g=Math.min(l,h),v=new Array(l),r=0;r<g;++r)for(var C=e[r],I=i[r],z=C.length,N=v[r]=new Array(z),k,j=0;j<z;++j)(k=C[j]||I[j])&&(N[j]=k);for(;r<l;++r)v[r]=e[r];return new $g(v,this._parents,this._name,this._id)}function G9(n){return(n+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function H9(n,e,i){var l,h,g=G9(e)?NR:mg;return function(){var v=g(this,n),r=v.on;r!==l&&(h=(l=r).copy()).on(e,i),v.on=h}}function j9(n,e){var i=this._id;return arguments.length<2?Im(this.node(),i).on.on(n):this.each(H9(i,n,e))}function q9(n){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==n)return;e&&e.removeChild(this)}}function X9(){return this.on("end.remove",q9(this._id))}function W9(n){var e=this._name,i=this._id;typeof n!="function"&&(n=LR(n));for(var l=this._groups,h=l.length,g=new Array(h),v=0;v<h;++v)for(var r=l[v],C=r.length,I=g[v]=new Array(C),z,N,k=0;k<C;++k)(z=r[k])&&(N=n.call(z,z.__data__,k,r))&&("__data__"in z&&(N.__data__=z.__data__),I[k]=N,wM(I[k],e,i,k,I,Im(z,i)));return new $g(g,this._parents,e,i)}function Z9(n){var e=this._name,i=this._id;typeof n!="function"&&(n=SF(n));for(var l=this._groups,h=l.length,g=[],v=[],r=0;r<h;++r)for(var C=l[r],I=C.length,z,N=0;N<I;++N)if(z=C[N]){for(var k=n.call(z,z.__data__,N,C),j,$=Im(z,i),re=0,ie=k.length;re<ie;++re)(j=k[re])&&wM(j,e,i,re,k,$);g.push(k),v.push(z)}return new $g(g,v,e,i)}var Y9=tw.prototype.constructor;function K9(){return new Y9(this._groups,this._parents)}function $9(n,e){var i,l,h;return function(){var g=Yx(this,n),v=(this.style.removeProperty(n),Yx(this,n));return g===v?null:g===i&&v===l?h:h=e(i=g,l=v)}}function XF(n){return function(){this.style.removeProperty(n)}}function J9(n,e,i){var l,h=i+"",g;return function(){var v=Yx(this,n);return v===h?null:v===l?g:g=e(l=v,i)}}function Q9(n,e,i){var l,h,g;return function(){var v=Yx(this,n),r=i(this),C=r+"";return r==null&&(C=r=(this.style.removeProperty(n),Yx(this,n))),v===C?null:v===l&&C===h?g:(h=C,g=e(l=v,r))}}function e7(n,e){var i,l,h,g="style."+e,v="end."+g,r;return function(){var C=mg(this,n),I=C.on,z=C.value[g]==null?r||(r=XF(e)):void 0;(I!==i||h!==z)&&(l=(i=I).copy()).on(v,h=z),C.on=l}}function t7(n,e,i){var l=(n+="")=="transform"?r9:qF;return e==null?this.styleTween(n,$9(n,l)).on("end.style."+n,XF(n)):typeof e=="function"?this.styleTween(n,Q9(n,l,FR(this,"style."+n,e))).each(e7(this._id,n)):this.styleTween(n,J9(n,l,e),i).on("end.style."+n,null)}function i7(n,e,i){return function(l){this.style.setProperty(n,e.call(this,l),i)}}function n7(n,e,i){var l,h;function g(){var v=e.apply(this,arguments);return v!==h&&(l=(h=v)&&i7(n,v,i)),l}return g._value=e,g}function r7(n,e,i){var l="style."+(n+="");if(arguments.length<2)return(l=this.tween(l))&&l._value;if(e==null)return this.tween(l,null);if(typeof e!="function")throw new Error;return this.tween(l,n7(n,e,i??""))}function s7(n){return function(){this.textContent=n}}function a7(n){return function(){var e=n(this);this.textContent=e??""}}function o7(n){return this.tween("text",typeof n=="function"?a7(FR(this,"text",n)):s7(n==null?"":n+""))}function l7(n){return function(e){this.textContent=n.call(this,e)}}function c7(n){var e,i;function l(){var h=n.apply(this,arguments);return h!==i&&(e=(i=h)&&l7(h)),e}return l._value=n,l}function u7(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,c7(n))}function h7(){for(var n=this._name,e=this._id,i=WF(),l=this._groups,h=l.length,g=0;g<h;++g)for(var v=l[g],r=v.length,C,I=0;I<r;++I)if(C=v[I]){var z=Im(C,e);wM(C,n,i,I,v,{time:z.time+z.delay+z.duration,delay:0,duration:z.duration,ease:z.ease})}return new $g(l,this._parents,n,i)}function f7(){var n,e,i=this,l=i._id,h=i.size();return new Promise(function(g,v){var r={value:v},C={value:function(){--h===0&&g()}};i.each(function(){var I=mg(this,l),z=I.on;z!==n&&(e=(n=z).copy(),e._.cancel.push(r),e._.interrupt.push(r),e._.end.push(C)),I.on=e}),h===0&&g()})}var d7=0;function $g(n,e,i,l){this._groups=n,this._parents=e,this._name=i,this._id=l}function WF(){return++d7}var Ng=tw.prototype;$g.prototype={constructor:$g,select:W9,selectAll:Z9,selectChild:Ng.selectChild,selectChildren:Ng.selectChildren,filter:k9,merge:V9,selection:K9,transition:h7,call:Ng.call,nodes:Ng.nodes,node:Ng.node,size:Ng.size,empty:Ng.empty,each:Ng.each,on:j9,attr:T9,attrTween:R9,style:t7,styleTween:r7,text:o7,textTween:u7,remove:X9,tween:_9,delay:L9,duration:O9,ease:N9,easeVarying:U9,end:f7,[Symbol.iterator]:Ng[Symbol.iterator]};function p7(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var m7={time:null,delay:0,duration:250,ease:p7};function g7(n,e){for(var i;!(i=n.__transition)||!(i=i[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return i}function _7(n){var e,i;n instanceof $g?(e=n._id,n=n._name):(e=WF(),(i=m7).time=BR(),n=n==null?null:n+"");for(var l=this._groups,h=l.length,g=0;g<h;++g)for(var v=l[g],r=v.length,C,I=0;I<r;++I)(C=v[I])&&wM(C,n,e,I,v,i||g7(C,e));return new $g(l,this._parents,n,e)}tw.prototype.interrupt=p9;tw.prototype.transition=_7;const dC=Math.PI,pC=2*dC,Q0=1e-6,y7=pC-Q0;function ZF(n){this._+=n[0];for(let e=1,i=n.length;e<i;++e)this._+=arguments[e]+n[e]}function x7(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return ZF;const i=10**e;return function(l){this._+=l[0];for(let h=1,g=l.length;h<g;++h)this._+=Math.round(arguments[h]*i)/i+l[h]}}let v7=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?ZF:x7(e)}moveTo(e,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+i}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,i){this._append`L${this._x1=+e},${this._y1=+i}`}quadraticCurveTo(e,i,l,h){this._append`Q${+e},${+i},${this._x1=+l},${this._y1=+h}`}bezierCurveTo(e,i,l,h,g,v){this._append`C${+e},${+i},${+l},${+h},${this._x1=+g},${this._y1=+v}`}arcTo(e,i,l,h,g){if(e=+e,i=+i,l=+l,h=+h,g=+g,g<0)throw new Error(`negative radius: ${g}`);let v=this._x1,r=this._y1,C=l-e,I=h-i,z=v-e,N=r-i,k=z*z+N*N;if(this._x1===null)this._append`M${this._x1=e},${this._y1=i}`;else if(k>Q0)if(!(Math.abs(N*C-I*z)>Q0)||!g)this._append`L${this._x1=e},${this._y1=i}`;else{let j=l-v,$=h-r,re=C*C+I*I,ie=j*j+$*$,Y=Math.sqrt(re),ae=Math.sqrt(k),ue=g*Math.tan((dC-Math.acos((re+k-ie)/(2*Y*ae)))/2),me=ue/ae,Ae=ue/Y;Math.abs(me-1)>Q0&&this._append`L${e+me*z},${i+me*N}`,this._append`A${g},${g},0,0,${+(N*j>z*$)},${this._x1=e+Ae*C},${this._y1=i+Ae*I}`}}arc(e,i,l,h,g,v){if(e=+e,i=+i,l=+l,v=!!v,l<0)throw new Error(`negative radius: ${l}`);let r=l*Math.cos(h),C=l*Math.sin(h),I=e+r,z=i+C,N=1^v,k=v?h-g:g-h;this._x1===null?this._append`M${I},${z}`:(Math.abs(this._x1-I)>Q0||Math.abs(this._y1-z)>Q0)&&this._append`L${I},${z}`,l&&(k<0&&(k=k%pC+pC),k>y7?this._append`A${l},${l},0,1,${N},${e-r},${i-C}A${l},${l},0,1,${N},${this._x1=I},${this._y1=z}`:k>Q0&&this._append`A${l},${l},0,${+(k>=dC)},${N},${this._x1=e+l*Math.cos(g)},${this._y1=i+l*Math.sin(g)}`)}rect(e,i,l,h){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+i}h${l=+l}v${+h}h${-l}Z`}toString(){return this._}};var mz={},AA={},CA=34,A1=10,RA=13;function YF(n){return new Function("d","return {"+n.map(function(e,i){return JSON.stringify(e)+": d["+i+'] || ""'}).join(",")+"}")}function b7(n,e){var i=YF(n);return function(l,h){return e(i(l),h,n)}}function gz(n){var e=Object.create(null),i=[];return n.forEach(function(l){for(var h in l)h in e||i.push(e[h]=h)}),i}function Vf(n,e){var i=n+"",l=i.length;return l<e?new Array(e-l+1).join(0)+i:i}function w7(n){return n<0?"-"+Vf(-n,6):n>9999?"+"+Vf(n,6):Vf(n,4)}function S7(n){var e=n.getUTCHours(),i=n.getUTCMinutes(),l=n.getUTCSeconds(),h=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":w7(n.getUTCFullYear())+"-"+Vf(n.getUTCMonth()+1,2)+"-"+Vf(n.getUTCDate(),2)+(h?"T"+Vf(e,2)+":"+Vf(i,2)+":"+Vf(l,2)+"."+Vf(h,3)+"Z":l?"T"+Vf(e,2)+":"+Vf(i,2)+":"+Vf(l,2)+"Z":i||e?"T"+Vf(e,2)+":"+Vf(i,2)+"Z":"")}function T7(n){var e=new RegExp('["'+n+`
\r]`),i=n.charCodeAt(0);function l(N,k){var j,$,re=h(N,function(ie,Y){if(j)return j(ie,Y-1);$=ie,j=k?b7(ie,k):YF(ie)});return re.columns=$||[],re}function h(N,k){var j=[],$=N.length,re=0,ie=0,Y,ae=$<=0,ue=!1;N.charCodeAt($-1)===A1&&--$,N.charCodeAt($-1)===RA&&--$;function me(){if(ae)return AA;if(ue)return ue=!1,mz;var Se,ze=re,je;if(N.charCodeAt(ze)===CA){for(;re++<$&&N.charCodeAt(re)!==CA||N.charCodeAt(++re)===CA;);return(Se=re)>=$?ae=!0:(je=N.charCodeAt(re++))===A1?ue=!0:je===RA&&(ue=!0,N.charCodeAt(re)===A1&&++re),N.slice(ze+1,Se-1).replace(/""/g,'"')}for(;re<$;){if((je=N.charCodeAt(Se=re++))===A1)ue=!0;else if(je===RA)ue=!0,N.charCodeAt(re)===A1&&++re;else if(je!==i)continue;return N.slice(ze,Se)}return ae=!0,N.slice(ze,$)}for(;(Y=me())!==AA;){for(var Ae=[];Y!==mz&&Y!==AA;)Ae.push(Y),Y=me();k&&(Ae=k(Ae,ie++))==null||j.push(Ae)}return j}function g(N,k){return N.map(function(j){return k.map(function($){return z(j[$])}).join(n)})}function v(N,k){return k==null&&(k=gz(N)),[k.map(z).join(n)].concat(g(N,k)).join(`
`)}function r(N,k){return k==null&&(k=gz(N)),g(N,k).join(`
`)}function C(N){return N.map(I).join(`
`)}function I(N){return N.map(z).join(n)}function z(N){return N==null?"":N instanceof Date?S7(N):e.test(N+="")?'"'+N.replace(/"/g,'""')+'"':N}return{parse:l,parseRows:h,format:v,formatBody:r,formatRows:C,formatRow:I,formatValue:z}}var M7=T7(","),UR=M7.parse;function E7(n){if(!n.ok)throw new Error(n.status+" "+n.statusText);return n.text()}function A7(n,e){return fetch(n,e).then(E7)}function C7(n){return function(e,i,l){return arguments.length===2&&typeof i=="function"&&(l=i,i=void 0),A7(e,i).then(function(h){return n(h,l)})}}var R7=C7(UR);function I7(n){const e=+this._x.call(null,n),i=+this._y.call(null,n);return KF(this.cover(e,i),e,i,n)}function KF(n,e,i,l){if(isNaN(e)||isNaN(i))return n;var h,g=n._root,v={data:l},r=n._x0,C=n._y0,I=n._x1,z=n._y1,N,k,j,$,re,ie,Y,ae;if(!g)return n._root=v,n;for(;g.length;)if((re=e>=(N=(r+I)/2))?r=N:I=N,(ie=i>=(k=(C+z)/2))?C=k:z=k,h=g,!(g=g[Y=ie<<1|re]))return h[Y]=v,n;if(j=+n._x.call(null,g.data),$=+n._y.call(null,g.data),e===j&&i===$)return v.next=g,h?h[Y]=v:n._root=v,n;do h=h?h[Y]=new Array(4):n._root=new Array(4),(re=e>=(N=(r+I)/2))?r=N:I=N,(ie=i>=(k=(C+z)/2))?C=k:z=k;while((Y=ie<<1|re)===(ae=($>=k)<<1|j>=N));return h[ae]=g,h[Y]=v,n}function D7(n){var e,i,l=n.length,h,g,v=new Array(l),r=new Array(l),C=1/0,I=1/0,z=-1/0,N=-1/0;for(i=0;i<l;++i)isNaN(h=+this._x.call(null,e=n[i]))||isNaN(g=+this._y.call(null,e))||(v[i]=h,r[i]=g,h<C&&(C=h),h>z&&(z=h),g<I&&(I=g),g>N&&(N=g));if(C>z||I>N)return this;for(this.cover(C,I).cover(z,N),i=0;i<l;++i)KF(this,v[i],r[i],n[i]);return this}function L7(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var i=this._x0,l=this._y0,h=this._x1,g=this._y1;if(isNaN(i))h=(i=Math.floor(n))+1,g=(l=Math.floor(e))+1;else{for(var v=h-i||1,r=this._root,C,I;i>n||n>=h||l>e||e>=g;)switch(I=(e<l)<<1|n<i,C=new Array(4),C[I]=r,r=C,v*=2,I){case 0:h=i+v,g=l+v;break;case 1:i=h-v,g=l+v;break;case 2:h=i+v,l=g-v;break;case 3:i=h-v,l=g-v;break}this._root&&this._root.length&&(this._root=r)}return this._x0=i,this._y0=l,this._x1=h,this._y1=g,this}function P7(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function z7(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Zh(n,e,i,l,h){this.node=n,this.x0=e,this.y0=i,this.x1=l,this.y1=h}function O7(n,e,i){var l,h=this._x0,g=this._y0,v,r,C,I,z=this._x1,N=this._y1,k=[],j=this._root,$,re;for(j&&k.push(new Zh(j,h,g,z,N)),i==null?i=1/0:(h=n-i,g=e-i,z=n+i,N=e+i,i*=i);$=k.pop();)if(!(!(j=$.node)||(v=$.x0)>z||(r=$.y0)>N||(C=$.x1)<h||(I=$.y1)<g))if(j.length){var ie=(v+C)/2,Y=(r+I)/2;k.push(new Zh(j[3],ie,Y,C,I),new Zh(j[2],v,Y,ie,I),new Zh(j[1],ie,r,C,Y),new Zh(j[0],v,r,ie,Y)),(re=(e>=Y)<<1|n>=ie)&&($=k[k.length-1],k[k.length-1]=k[k.length-1-re],k[k.length-1-re]=$)}else{var ae=n-+this._x.call(null,j.data),ue=e-+this._y.call(null,j.data),me=ae*ae+ue*ue;if(me<i){var Ae=Math.sqrt(i=me);h=n-Ae,g=e-Ae,z=n+Ae,N=e+Ae,l=j.data}}return l}function B7(n){if(isNaN(z=+this._x.call(null,n))||isNaN(N=+this._y.call(null,n)))return this;var e,i=this._root,l,h,g,v=this._x0,r=this._y0,C=this._x1,I=this._y1,z,N,k,j,$,re,ie,Y;if(!i)return this;if(i.length)for(;;){if(($=z>=(k=(v+C)/2))?v=k:C=k,(re=N>=(j=(r+I)/2))?r=j:I=j,e=i,!(i=i[ie=re<<1|$]))return this;if(!i.length)break;(e[ie+1&3]||e[ie+2&3]||e[ie+3&3])&&(l=e,Y=ie)}for(;i.data!==n;)if(h=i,!(i=i.next))return this;return(g=i.next)&&delete i.next,h?(g?h.next=g:delete h.next,this):e?(g?e[ie]=g:delete e[ie],(i=e[0]||e[1]||e[2]||e[3])&&i===(e[3]||e[2]||e[1]||e[0])&&!i.length&&(l?l[Y]=i:this._root=i),this):(this._root=g,this)}function N7(n){for(var e=0,i=n.length;e<i;++e)this.remove(n[e]);return this}function F7(){return this._root}function U7(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function k7(n){var e=[],i,l=this._root,h,g,v,r,C;for(l&&e.push(new Zh(l,this._x0,this._y0,this._x1,this._y1));i=e.pop();)if(!n(l=i.node,g=i.x0,v=i.y0,r=i.x1,C=i.y1)&&l.length){var I=(g+r)/2,z=(v+C)/2;(h=l[3])&&e.push(new Zh(h,I,z,r,C)),(h=l[2])&&e.push(new Zh(h,g,z,I,C)),(h=l[1])&&e.push(new Zh(h,I,v,r,z)),(h=l[0])&&e.push(new Zh(h,g,v,I,z))}return this}function V7(n){var e=[],i=[],l;for(this._root&&e.push(new Zh(this._root,this._x0,this._y0,this._x1,this._y1));l=e.pop();){var h=l.node;if(h.length){var g,v=l.x0,r=l.y0,C=l.x1,I=l.y1,z=(v+C)/2,N=(r+I)/2;(g=h[0])&&e.push(new Zh(g,v,r,z,N)),(g=h[1])&&e.push(new Zh(g,z,r,C,N)),(g=h[2])&&e.push(new Zh(g,v,N,z,I)),(g=h[3])&&e.push(new Zh(g,z,N,C,I))}i.push(l)}for(;l=i.pop();)n(l.node,l.x0,l.y0,l.x1,l.y1);return this}function G7(n){return n[0]}function H7(n){return arguments.length?(this._x=n,this):this._x}function j7(n){return n[1]}function q7(n){return arguments.length?(this._y=n,this):this._y}function $F(n,e,i){var l=new kR(e??G7,i??j7,NaN,NaN,NaN,NaN);return n==null?l:l.addAll(n)}function kR(n,e,i,l,h,g){this._x=n,this._y=e,this._x0=i,this._y0=l,this._x1=h,this._y1=g,this._root=void 0}function _z(n){for(var e={data:n.data},i=e;n=n.next;)i=i.next={data:n.data};return e}var Qh=$F.prototype=kR.prototype;Qh.copy=function(){var n=new kR(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,i,l;if(!e)return n;if(!e.length)return n._root=_z(e),n;for(i=[{source:e,target:n._root=new Array(4)}];e=i.pop();)for(var h=0;h<4;++h)(l=e.source[h])&&(l.length?i.push({source:l,target:e.target[h]=new Array(4)}):e.target[h]=_z(l));return n};Qh.add=I7;Qh.addAll=D7;Qh.cover=L7;Qh.data=P7;Qh.extent=z7;Qh.find=O7;Qh.remove=B7;Qh.removeAll=N7;Qh.root=F7;Qh.size=U7;Qh.visit=k7;Qh.visitAfter=V7;Qh.x=H7;Qh.y=q7;function X7(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function t2(n,e){if((i=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var i,l=n.slice(0,i);return[l.length>1?l[0]+l.slice(2):l,+n.slice(i+1)]}function $x(n){return n=t2(Math.abs(n)),n?n[1]:NaN}function W7(n,e){return function(i,l){for(var h=i.length,g=[],v=0,r=n[0],C=0;h>0&&r>0&&(C+r+1>l&&(r=Math.max(1,l-C)),g.push(i.substring(h-=r,h+r)),!((C+=r+1)>l));)r=n[v=(v+1)%n.length];return g.reverse().join(e)}}function Z7(n){return function(e){return e.replace(/[0-9]/g,function(i){return n[+i]})}}var Y7=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function i2(n){if(!(e=Y7.exec(n)))throw new Error("invalid format: "+n);var e;return new VR({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}i2.prototype=VR.prototype;function VR(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}VR.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function K7(n){e:for(var e=n.length,i=1,l=-1,h;i<e;++i)switch(n[i]){case".":l=h=i;break;case"0":l===0&&(l=i),h=i;break;default:if(!+n[i])break e;l>0&&(l=0);break}return l>0?n.slice(0,l)+n.slice(h+1):n}var JF;function $7(n,e){var i=t2(n,e);if(!i)return n+"";var l=i[0],h=i[1],g=h-(JF=Math.max(-8,Math.min(8,Math.floor(h/3)))*3)+1,v=l.length;return g===v?l:g>v?l+new Array(g-v+1).join("0"):g>0?l.slice(0,g)+"."+l.slice(g):"0."+new Array(1-g).join("0")+t2(n,Math.max(0,e+g-1))[0]}function yz(n,e){var i=t2(n,e);if(!i)return n+"";var l=i[0],h=i[1];return h<0?"0."+new Array(-h).join("0")+l:l.length>h+1?l.slice(0,h+1)+"."+l.slice(h+1):l+new Array(h-l.length+2).join("0")}const xz={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:X7,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>yz(n*100,e),r:yz,s:$7,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function vz(n){return n}var bz=Array.prototype.map,wz=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function J7(n){var e=n.grouping===void 0||n.thousands===void 0?vz:W7(bz.call(n.grouping,Number),n.thousands+""),i=n.currency===void 0?"":n.currency[0]+"",l=n.currency===void 0?"":n.currency[1]+"",h=n.decimal===void 0?".":n.decimal+"",g=n.numerals===void 0?vz:Z7(bz.call(n.numerals,String)),v=n.percent===void 0?"%":n.percent+"",r=n.minus===void 0?"":n.minus+"",C=n.nan===void 0?"NaN":n.nan+"";function I(N){N=i2(N);var k=N.fill,j=N.align,$=N.sign,re=N.symbol,ie=N.zero,Y=N.width,ae=N.comma,ue=N.precision,me=N.trim,Ae=N.type;Ae==="n"?(ae=!0,Ae="g"):xz[Ae]||(ue===void 0&&(ue=12),me=!0,Ae="g"),(ie||k==="0"&&j==="=")&&(ie=!0,k="0",j="=");var Se=re==="$"?i:re==="#"&&/[boxX]/.test(Ae)?"0"+Ae.toLowerCase():"",ze=re==="$"?l:/[%p]/.test(Ae)?v:"",je=xz[Ae],Ce=/[defgprs%]/.test(Ae);ue=ue===void 0?6:/[gprs]/.test(Ae)?Math.max(1,Math.min(21,ue)):Math.max(0,Math.min(20,ue));function Te(Ze){var Mt=Se,mt=ze,Gt,kt,Re;if(Ae==="c")mt=je(Ze)+mt,Ze="";else{Ze=+Ze;var Qe=Ze<0||1/Ze<0;if(Ze=isNaN(Ze)?C:je(Math.abs(Ze),ue),me&&(Ze=K7(Ze)),Qe&&+Ze==0&&$!=="+"&&(Qe=!1),Mt=(Qe?$==="("?$:r:$==="-"||$==="("?"":$)+Mt,mt=(Ae==="s"?wz[8+JF/3]:"")+mt+(Qe&&$==="("?")":""),Ce){for(Gt=-1,kt=Ze.length;++Gt<kt;)if(Re=Ze.charCodeAt(Gt),48>Re||Re>57){mt=(Re===46?h+Ze.slice(Gt+1):Ze.slice(Gt))+mt,Ze=Ze.slice(0,Gt);break}}}ae&&!ie&&(Ze=e(Ze,1/0));var et=Mt.length+Ze.length+mt.length,Lt=et<Y?new Array(Y-et+1).join(k):"";switch(ae&&ie&&(Ze=e(Lt+Ze,Lt.length?Y-mt.length:1/0),Lt=""),j){case"<":Ze=Mt+Ze+mt+Lt;break;case"=":Ze=Mt+Lt+Ze+mt;break;case"^":Ze=Lt.slice(0,et=Lt.length>>1)+Mt+Ze+mt+Lt.slice(et);break;default:Ze=Lt+Mt+Ze+mt;break}return g(Ze)}return Te.toString=function(){return N+""},Te}function z(N,k){var j=I((N=i2(N),N.type="f",N)),$=Math.max(-8,Math.min(8,Math.floor($x(k)/3)))*3,re=Math.pow(10,-$),ie=wz[8+$/3];return function(Y){return j(re*Y)+ie}}return{format:I,formatPrefix:z}}var LS,nw,QF;Q7({thousands:",",grouping:[3],currency:["$",""]});function Q7(n){return LS=J7(n),nw=LS.format,QF=LS.formatPrefix,LS}function eq(n){return Math.max(0,-$x(Math.abs(n)))}function tq(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor($x(e)/3)))*3-$x(Math.abs(n)))}function iq(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,$x(e)-$x(n))+1}var Z_=1e-6,n2=1e-12,Yg=Math.PI,r2=Yg/2,s2=Yg/4,Mb=Yg*2,nb=180/Yg,vl=Yg/180,xy=Math.abs,dv=Math.atan2,xl=Math.cos,mC=Math.hypot,Jo=Math.sin,nq=Math.sign||function(n){return n>0?1:n<0?-1:0},pv=Math.sqrt;function SM(n){return n>1?r2:n<-1?-r2:Math.asin(n)}function yl(){}function a2(n,e){n&&Tz.hasOwnProperty(n.type)&&Tz[n.type](n,e)}var Sz={Feature:function(n,e){a2(n.geometry,e)},FeatureCollection:function(n,e){for(var i=n.features,l=-1,h=i.length;++l<h;)a2(i[l].geometry,e)}},Tz={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var i=n.coordinates,l=-1,h=i.length;++l<h;)n=i[l],e.point(n[0],n[1],n[2])},LineString:function(n,e){gC(n.coordinates,e,0)},MultiLineString:function(n,e){for(var i=n.coordinates,l=-1,h=i.length;++l<h;)gC(i[l],e,0)},Polygon:function(n,e){Mz(n.coordinates,e)},MultiPolygon:function(n,e){for(var i=n.coordinates,l=-1,h=i.length;++l<h;)Mz(i[l],e)},GeometryCollection:function(n,e){for(var i=n.geometries,l=-1,h=i.length;++l<h;)a2(i[l],e)}};function gC(n,e,i){var l=-1,h=n.length-i,g;for(e.lineStart();++l<h;)g=n[l],e.point(g[0],g[1],g[2]);e.lineEnd()}function Mz(n,e){var i=-1,l=n.length;for(e.polygonStart();++i<l;)gC(n[i],e,1);e.polygonEnd()}function q_(n,e){n&&Sz.hasOwnProperty(n.type)?Sz[n.type](n,e):a2(n,e)}var o2=new Jh,Ez=new Jh,e4,t4,_C,yC,xC,Jg={point:yl,lineStart:yl,lineEnd:yl,polygonStart:function(){o2=new Jh,Jg.lineStart=rq,Jg.lineEnd=sq},polygonEnd:function(){var n=+o2;Ez.add(n<0?Mb+n:n),this.lineStart=this.lineEnd=this.point=yl},sphere:function(){Ez.add(Mb)}};function rq(){Jg.point=aq}function sq(){i4(e4,t4)}function aq(n,e){Jg.point=i4,e4=n,t4=e,n*=vl,e*=vl,_C=n,yC=xl(e=e/2+s2),xC=Jo(e)}function i4(n,e){n*=vl,e*=vl,e=e/2+s2;var i=n-_C,l=i>=0?1:-1,h=l*i,g=xl(e),v=Jo(e),r=xC*v,C=yC*g+r*xl(h),I=r*l*Jo(h);o2.add(dv(I,C)),_C=n,yC=g,xC=v}function oq(n){return[dv(n[1],n[0]),SM(n[2])]}function vC(n){var e=n[0],i=n[1],l=xl(i);return[l*xl(e),l*Jo(e),Jo(i)]}function l2(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function bC(n){var e=pv(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var Ko,Hf,gl,Fd,ey,n4,r4,qx,rb,H_,Qg,Xg={point:wC,lineStart:Az,lineEnd:Cz,polygonStart:function(){Xg.point=a4,Xg.lineStart=lq,Xg.lineEnd=cq,rb=new Jh,Jg.polygonStart()},polygonEnd:function(){Jg.polygonEnd(),Xg.point=wC,Xg.lineStart=Az,Xg.lineEnd=Cz,o2<0?(Ko=-(gl=180),Hf=-(Fd=90)):rb>Z_?Fd=90:rb<-Z_&&(Hf=-90),Qg[0]=Ko,Qg[1]=gl},sphere:function(){Ko=-(gl=180),Hf=-(Fd=90)}};function wC(n,e){H_.push(Qg=[Ko=n,gl=n]),e<Hf&&(Hf=e),e>Fd&&(Fd=e)}function s4(n,e){var i=vC([n*vl,e*vl]);if(qx){var l=l2(qx,i),h=[l[1],-l[0],0],g=l2(h,l);bC(g),g=oq(g);var v=n-ey,r=v>0?1:-1,C=g[0]*nb*r,I,z=xy(v)>180;z^(r*ey<C&&C<r*n)?(I=g[1]*nb,I>Fd&&(Fd=I)):(C=(C+360)%360-180,z^(r*ey<C&&C<r*n)?(I=-g[1]*nb,I<Hf&&(Hf=I)):(e<Hf&&(Hf=e),e>Fd&&(Fd=e))),z?n<ey?Nd(Ko,n)>Nd(Ko,gl)&&(gl=n):Nd(n,gl)>Nd(Ko,gl)&&(Ko=n):gl>=Ko?(n<Ko&&(Ko=n),n>gl&&(gl=n)):n>ey?Nd(Ko,n)>Nd(Ko,gl)&&(gl=n):Nd(n,gl)>Nd(Ko,gl)&&(Ko=n)}else H_.push(Qg=[Ko=n,gl=n]);e<Hf&&(Hf=e),e>Fd&&(Fd=e),qx=i,ey=n}function Az(){Xg.point=s4}function Cz(){Qg[0]=Ko,Qg[1]=gl,Xg.point=wC,qx=null}function a4(n,e){if(qx){var i=n-ey;rb.add(xy(i)>180?i+(i>0?360:-360):i)}else n4=n,r4=e;Jg.point(n,e),s4(n,e)}function lq(){Jg.lineStart()}function cq(){a4(n4,r4),Jg.lineEnd(),xy(rb)>Z_&&(Ko=-(gl=180)),Qg[0]=Ko,Qg[1]=gl,qx=null}function Nd(n,e){return(e-=n)<0?e+360:e}function uq(n,e){return n[0]-e[0]}function Rz(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function hq(n){var e,i,l,h,g,v,r;if(Fd=gl=-(Ko=Hf=1/0),H_=[],q_(n,Xg),i=H_.length){for(H_.sort(uq),e=1,l=H_[0],g=[l];e<i;++e)h=H_[e],Rz(l,h[0])||Rz(l,h[1])?(Nd(l[0],h[1])>Nd(l[0],l[1])&&(l[1]=h[1]),Nd(h[0],l[1])>Nd(l[0],l[1])&&(l[0]=h[0])):g.push(l=h);for(v=-1/0,i=g.length-1,e=0,l=g[i];e<=i;l=h,++e)h=g[e],(r=Nd(l[1],h[0]))>v&&(v=r,Ko=h[0],gl=l[1])}return H_=Qg=null,Ko===1/0||Hf===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ko,Hf],[gl,Fd]]}var W1,c2,u2,h2,f2,d2,p2,m2,SC,TC,MC,o4,l4,qh,Xh,Wh,Em={sphere:yl,point:GR,lineStart:Iz,lineEnd:Dz,polygonStart:function(){Em.lineStart=pq,Em.lineEnd=mq},polygonEnd:function(){Em.lineStart=Iz,Em.lineEnd=Dz}};function GR(n,e){n*=vl,e*=vl;var i=xl(e);rw(i*xl(n),i*Jo(n),Jo(e))}function rw(n,e,i){++W1,u2+=(n-u2)/W1,h2+=(e-h2)/W1,f2+=(i-f2)/W1}function Iz(){Em.point=fq}function fq(n,e){n*=vl,e*=vl;var i=xl(e);qh=i*xl(n),Xh=i*Jo(n),Wh=Jo(e),Em.point=dq,rw(qh,Xh,Wh)}function dq(n,e){n*=vl,e*=vl;var i=xl(e),l=i*xl(n),h=i*Jo(n),g=Jo(e),v=dv(pv((v=Xh*g-Wh*h)*v+(v=Wh*l-qh*g)*v+(v=qh*h-Xh*l)*v),qh*l+Xh*h+Wh*g);c2+=v,d2+=v*(qh+(qh=l)),p2+=v*(Xh+(Xh=h)),m2+=v*(Wh+(Wh=g)),rw(qh,Xh,Wh)}function Dz(){Em.point=GR}function pq(){Em.point=gq}function mq(){c4(o4,l4),Em.point=GR}function gq(n,e){o4=n,l4=e,n*=vl,e*=vl,Em.point=c4;var i=xl(e);qh=i*xl(n),Xh=i*Jo(n),Wh=Jo(e),rw(qh,Xh,Wh)}function c4(n,e){n*=vl,e*=vl;var i=xl(e),l=i*xl(n),h=i*Jo(n),g=Jo(e),v=Xh*g-Wh*h,r=Wh*l-qh*g,C=qh*h-Xh*l,I=mC(v,r,C),z=SM(I),N=I&&-z/I;SC.add(N*v),TC.add(N*r),MC.add(N*C),c2+=z,d2+=z*(qh+(qh=l)),p2+=z*(Xh+(Xh=h)),m2+=z*(Wh+(Wh=g)),rw(qh,Xh,Wh)}function _q(n){W1=c2=u2=h2=f2=d2=p2=m2=0,SC=new Jh,TC=new Jh,MC=new Jh,q_(n,Em);var e=+SC,i=+TC,l=+MC,h=mC(e,i,l);return h<n2&&(e=d2,i=p2,l=m2,c2<Z_&&(e=u2,i=h2,l=f2),h=mC(e,i,l),h<n2)?[NaN,NaN]:[dv(i,e)*nb,SM(l/h)*nb]}function IA(n){return xy(n[0])<=Yg?n[0]:nq(n[0])*((xy(n[0])+Yg)%Mb-Yg)}function yq(n,e){var i=IA(e),l=e[1],h=Jo(l),g=[Jo(i),-xl(i),0],v=0,r=0,C=new Jh;h===1?l=r2+Z_:h===-1&&(l=-r2-Z_);for(var I=0,z=n.length;I<z;++I)if(k=(N=n[I]).length)for(var N,k,j=N[k-1],$=IA(j),re=j[1]/2+s2,ie=Jo(re),Y=xl(re),ae=0;ae<k;++ae,$=me,ie=Se,Y=ze,j=ue){var ue=N[ae],me=IA(ue),Ae=ue[1]/2+s2,Se=Jo(Ae),ze=xl(Ae),je=me-$,Ce=je>=0?1:-1,Te=Ce*je,Ze=Te>Yg,Mt=ie*Se;if(C.add(dv(Mt*Ce*Jo(Te),Y*ze+Mt*xl(Te))),v+=Ze?je+Ce*Mb:je,Ze^$>=i^me>=i){var mt=l2(vC(j),vC(ue));bC(mt);var Gt=l2(g,mt);bC(Gt);var kt=(Ze^je>=0?-1:1)*SM(Gt[2]);(l>kt||l===kt&&(mt[0]||mt[1]))&&(r+=Ze^je>=0?1:-1)}}return(v<-Z_||v<Z_&&C<-n2)^r&1}var EC,AC,PT,zT,Jx={sphere:yl,point:yl,lineStart:xq,lineEnd:yl,polygonStart:yl,polygonEnd:yl};function xq(){Jx.point=bq,Jx.lineEnd=vq}function vq(){Jx.point=Jx.lineEnd=yl}function bq(n,e){n*=vl,e*=vl,AC=n,PT=Jo(e),zT=xl(e),Jx.point=wq}function wq(n,e){n*=vl,e*=vl;var i=Jo(e),l=xl(e),h=xy(n-AC),g=xl(h),v=Jo(h),r=l*v,C=zT*i-PT*l*g,I=PT*i+zT*l*g;EC.add(dv(pv(r*r+C*C),I)),AC=n,PT=i,zT=l}function Sq(n){return EC=new Jh,q_(n,Jx),+EC}var CC=[null,null],Tq={type:"LineString",coordinates:CC};function RC(n,e){return CC[0]=n,CC[1]=e,Sq(Tq)}var Lz={Feature:function(n,e){return g2(n.geometry,e)},FeatureCollection:function(n,e){for(var i=n.features,l=-1,h=i.length;++l<h;)if(g2(i[l].geometry,e))return!0;return!1}},Pz={Sphere:function(){return!0},Point:function(n,e){return zz(n.coordinates,e)},MultiPoint:function(n,e){for(var i=n.coordinates,l=-1,h=i.length;++l<h;)if(zz(i[l],e))return!0;return!1},LineString:function(n,e){return Oz(n.coordinates,e)},MultiLineString:function(n,e){for(var i=n.coordinates,l=-1,h=i.length;++l<h;)if(Oz(i[l],e))return!0;return!1},Polygon:function(n,e){return Bz(n.coordinates,e)},MultiPolygon:function(n,e){for(var i=n.coordinates,l=-1,h=i.length;++l<h;)if(Bz(i[l],e))return!0;return!1},GeometryCollection:function(n,e){for(var i=n.geometries,l=-1,h=i.length;++l<h;)if(g2(i[l],e))return!0;return!1}};function g2(n,e){return n&&Pz.hasOwnProperty(n.type)?Pz[n.type](n,e):!1}function zz(n,e){return RC(n,e)===0}function Oz(n,e){for(var i,l,h,g=0,v=n.length;g<v;g++){if(l=RC(n[g],e),l===0||g>0&&(h=RC(n[g],n[g-1]),h>0&&i<=h&&l<=h&&(i+l-h)*(1-Math.pow((i-l)/h,2))<n2*h))return!0;i=l}return!1}function Bz(n,e){return!!yq(n.map(Mq),u4(e))}function Mq(n){return n=n.map(u4),n.pop(),n}function u4(n){return[n[0]*vl,n[1]*vl]}function Nz(n,e){return(n&&Lz.hasOwnProperty(n.type)?Lz[n.type]:g2)(n,e)}const Eq=n=>n;var DA=new Jh,IC=new Jh,h4,f4,DC,LC,Wg={point:yl,lineStart:yl,lineEnd:yl,polygonStart:function(){Wg.lineStart=Aq,Wg.lineEnd=Rq},polygonEnd:function(){Wg.lineStart=Wg.lineEnd=Wg.point=yl,DA.add(xy(IC)),IC=new Jh},result:function(){var n=DA/2;return DA=new Jh,n}};function Aq(){Wg.point=Cq}function Cq(n,e){Wg.point=d4,h4=DC=n,f4=LC=e}function d4(n,e){IC.add(LC*n-DC*e),DC=n,LC=e}function Rq(){d4(h4,f4)}var Qx=1/0,_2=Qx,Eb=-Qx,y2=Eb,Fz={point:Iq,lineStart:yl,lineEnd:yl,polygonStart:yl,polygonEnd:yl,result:function(){var n=[[Qx,_2],[Eb,y2]];return Eb=y2=-(_2=Qx=1/0),n}};function Iq(n,e){n<Qx&&(Qx=n),n>Eb&&(Eb=n),e<_2&&(_2=e),e>y2&&(y2=e)}var PC=0,zC=0,Z1=0,x2=0,v2=0,Ox=0,OC=0,BC=0,Y1=0,p4,m4,sg,ag,Cp={point:vy,lineStart:Uz,lineEnd:kz,polygonStart:function(){Cp.lineStart=Pq,Cp.lineEnd=zq},polygonEnd:function(){Cp.point=vy,Cp.lineStart=Uz,Cp.lineEnd=kz},result:function(){var n=Y1?[OC/Y1,BC/Y1]:Ox?[x2/Ox,v2/Ox]:Z1?[PC/Z1,zC/Z1]:[NaN,NaN];return PC=zC=Z1=x2=v2=Ox=OC=BC=Y1=0,n}};function vy(n,e){PC+=n,zC+=e,++Z1}function Uz(){Cp.point=Dq}function Dq(n,e){Cp.point=Lq,vy(sg=n,ag=e)}function Lq(n,e){var i=n-sg,l=e-ag,h=pv(i*i+l*l);x2+=h*(sg+n)/2,v2+=h*(ag+e)/2,Ox+=h,vy(sg=n,ag=e)}function kz(){Cp.point=vy}function Pq(){Cp.point=Oq}function zq(){g4(p4,m4)}function Oq(n,e){Cp.point=g4,vy(p4=sg=n,m4=ag=e)}function g4(n,e){var i=n-sg,l=e-ag,h=pv(i*i+l*l);x2+=h*(sg+n)/2,v2+=h*(ag+e)/2,Ox+=h,h=ag*n-sg*e,OC+=h*(sg+n),BC+=h*(ag+e),Y1+=h*3,vy(sg=n,ag=e)}function _4(n){this._context=n}_4.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,e){switch(this._point){case 0:{this._context.moveTo(n,e),this._point=1;break}case 1:{this._context.lineTo(n,e);break}default:{this._context.moveTo(n+this._radius,e),this._context.arc(n,e,this._radius,0,Mb);break}}},result:yl};var NC=new Jh,LA,y4,x4,K1,$1,Ab={point:yl,lineStart:function(){Ab.point=Bq},lineEnd:function(){LA&&v4(y4,x4),Ab.point=yl},polygonStart:function(){LA=!0},polygonEnd:function(){LA=null},result:function(){var n=+NC;return NC=new Jh,n}};function Bq(n,e){Ab.point=v4,y4=K1=n,x4=$1=e}function v4(n,e){K1-=n,$1-=e,NC.add(pv(K1*K1+$1*$1)),K1=n,$1=e}let Vz,b2,Gz,Hz;class jz{constructor(e){this._append=e==null?b4:Nq(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,i){switch(this._point){case 0:{this._append`M${e},${i}`,this._point=1;break}case 1:{this._append`L${e},${i}`;break}default:{if(this._append`M${e},${i}`,this._radius!==Gz||this._append!==b2){const l=this._radius,h=this._;this._="",this._append`m0,${l}a${l},${l} 0 1,1 0,${-2*l}a${l},${l} 0 1,1 0,${2*l}z`,Gz=l,b2=this._append,Hz=this._,this._=h}this._+=Hz;break}}}result(){const e=this._;return this._="",e.length?e:null}}function b4(n){let e=1;this._+=n[0];for(const i=n.length;e<i;++e)this._+=arguments[e]+n[e]}function Nq(n){const e=Math.floor(n);if(!(e>=0))throw new RangeError(`invalid digits: ${n}`);if(e>15)return b4;if(e!==Vz){const i=10**e;Vz=e,b2=function(h){let g=1;this._+=h[0];for(const v=h.length;g<v;++g)this._+=Math.round(arguments[g]*i)/i+h[g]}}return b2}function Fq(n,e){let i=3,l=4.5,h,g;function v(r){return r&&(typeof l=="function"&&g.pointRadius(+l.apply(this,arguments)),q_(r,h(g))),g.result()}return v.area=function(r){return q_(r,h(Wg)),Wg.result()},v.measure=function(r){return q_(r,h(Ab)),Ab.result()},v.bounds=function(r){return q_(r,h(Fz)),Fz.result()},v.centroid=function(r){return q_(r,h(Cp)),Cp.result()},v.projection=function(r){return arguments.length?(h=r==null?(n=null,Eq):(n=r).stream,v):n},v.context=function(r){return arguments.length?(g=r==null?(e=null,new jz(i)):new _4(e=r),typeof l!="function"&&g.pointRadius(l),v):e},v.pointRadius=function(r){return arguments.length?(l=typeof r=="function"?r:(g.pointRadius(+r),+r),v):l},v.digits=function(r){if(!arguments.length)return i;if(r==null)i=null;else{const C=Math.floor(r);if(!(C>=0))throw new RangeError(`invalid digits: ${r}`);i=C}return e===null&&(g=new jz(i)),v},v.projection(n).digits(i).context(e)}function Uq(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function kq(n,e){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function Vq(n){return function(){return n}}function Gq(n){return+n}var qz=[0,1];function Y_(n){return n}function FC(n,e){return(e-=n=+n)?function(i){return(i-n)/e}:Vq(isNaN(e)?NaN:.5)}function Hq(n,e){var i;return n>e&&(i=n,n=e,e=i),function(l){return Math.max(n,Math.min(e,l))}}function jq(n,e,i){var l=n[0],h=n[1],g=e[0],v=e[1];return h<l?(l=FC(h,l),g=i(v,g)):(l=FC(l,h),g=i(g,v)),function(r){return g(l(r))}}function qq(n,e,i){var l=Math.min(n.length,e.length)-1,h=new Array(l),g=new Array(l),v=-1;for(n[l]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++v<l;)h[v]=FC(n[v],n[v+1]),g[v]=i(e[v],e[v+1]);return function(r){var C=OG(n,r,1,l)-1;return g[C](h[C](r))}}function Xq(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Wq(){var n=qz,e=qz,i=vM,l,h,g,v=Y_,r,C,I;function z(){var k=Math.min(n.length,e.length);return v!==Y_&&(v=Hq(n[0],n[k-1])),r=k>2?qq:jq,C=I=null,N}function N(k){return k==null||isNaN(k=+k)?g:(C||(C=r(n.map(l),e,i)))(l(v(k)))}return N.invert=function(k){return v(h((I||(I=r(e,n.map(l),wm)))(k)))},N.domain=function(k){return arguments.length?(n=Array.from(k,Gq),z()):n.slice()},N.range=function(k){return arguments.length?(e=Array.from(k),z()):e.slice()},N.rangeRound=function(k){return e=Array.from(k),i=FF,z()},N.clamp=function(k){return arguments.length?(v=k?!0:Y_,z()):v!==Y_},N.interpolate=function(k){return arguments.length?(i=k,z()):i},N.unknown=function(k){return arguments.length?(g=k,N):g},function(k,j){return l=k,h=j,z()}}function Zq(){return Wq()(Y_,Y_)}function Yq(n,e,i,l){var h=kG(n,e,i),g;switch(l=i2(l??",f"),l.type){case"s":{var v=Math.max(Math.abs(n),Math.abs(e));return l.precision==null&&!isNaN(g=tq(h,v))&&(l.precision=g),QF(l,v)}case"":case"e":case"g":case"p":case"r":{l.precision==null&&!isNaN(g=iq(h,Math.max(Math.abs(n),Math.abs(e))))&&(l.precision=g-(l.type==="e"));break}case"f":case"%":{l.precision==null&&!isNaN(g=eq(h))&&(l.precision=g-(l.type==="%")*2);break}}return nw(l)}function w4(n){var e=n.domain;return n.ticks=function(i){var l=e();return UG(l[0],l[l.length-1],i??10)},n.tickFormat=function(i,l){var h=e();return Yq(h[0],h[h.length-1],i??10,l)},n.nice=function(i){i==null&&(i=10);var l=e(),h=0,g=l.length-1,v=l[h],r=l[g],C,I,z=10;for(r<v&&(I=v,v=r,r=I,I=h,h=g,g=I);z-- >0;){if(I=sC(v,r,i),I===C)return l[h]=v,l[g]=r,e(l);if(I>0)v=Math.floor(v/I)*I,r=Math.ceil(r/I)*I;else if(I<0)v=Math.ceil(v*I)/I,r=Math.floor(r*I)/I;else break;C=I}return n},n}function Cb(){var n=Zq();return n.copy=function(){return Xq(n,Cb())},Uq.apply(n,arguments),w4(n)}function Kq(){var n=0,e=1,i,l,h,g,v=Y_,r=!1,C;function I(N){return N==null||isNaN(N=+N)?C:v(h===0?.5:(N=(g(N)-i)*h,r?Math.max(0,Math.min(1,N)):N))}I.domain=function(N){return arguments.length?([n,e]=N,i=g(n=+n),l=g(e=+e),h=i===l?0:1/(l-i),I):[n,e]},I.clamp=function(N){return arguments.length?(r=!!N,I):r},I.interpolator=function(N){return arguments.length?(v=N,I):v};function z(N){return function(k){var j,$;return arguments.length?([j,$]=k,v=N(j,$),I):[v(0),v(1)]}}return I.range=z(vM),I.rangeRound=z(FF),I.unknown=function(N){return arguments.length?(C=N,I):C},function(N){return g=N,i=N(n),l=N(e),h=i===l?0:1/(l-i),I}}function $q(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function S4(){var n=w4(Kq()(Y_));return n.copy=function(){return $q(n,S4())},kq.apply(n,arguments)}function Jq(n){for(var e=n.length/6|0,i=new Array(e),l=0;l<e;)i[l]="#"+n.slice(l*6,++l*6);return i}const Qq=n=>Zj(n[n.length-1]);var eX=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Jq);const Xz=Qq(eX);function ux(n){return function(){return n}}function tX(n){let e=3;return n.digits=function(i){if(!arguments.length)return e;if(i==null)e=null;else{const l=Math.floor(i);if(!(l>=0))throw new RangeError(`invalid digits: ${i}`);e=l}return n},()=>new v7(e)}function iX(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function T4(n){this._context=n}T4.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,e){switch(n=+n,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,e):this._context.moveTo(n,e);break;case 1:this._point=2;default:this._context.lineTo(n,e);break}}};function nX(n){return new T4(n)}function rX(n){return n[0]}function sX(n){return n[1]}function M4(n,e){var i=ux(!0),l=null,h=nX,g=null,v=tX(r);n=typeof n=="function"?n:n===void 0?rX:ux(n),e=typeof e=="function"?e:e===void 0?sX:ux(e);function r(C){var I,z=(C=iX(C)).length,N,k=!1,j;for(l==null&&(g=h(j=v())),I=0;I<=z;++I)!(I<z&&i(N=C[I],I,C))===k&&((k=!k)?g.lineStart():g.lineEnd()),k&&g.point(+n(N,I,C),+e(N,I,C));if(j)return g=null,j+""||null}return r.x=function(C){return arguments.length?(n=typeof C=="function"?C:ux(+C),r):n},r.y=function(C){return arguments.length?(e=typeof C=="function"?C:ux(+C),r):e},r.defined=function(C){return arguments.length?(i=typeof C=="function"?C:ux(!!C),r):i},r.curve=function(C){return arguments.length?(h=C,l!=null&&(g=h(l)),r):h},r.context=function(C){return arguments.length?(C==null?l=g=null:g=h(l=C),r):l},r}function J1(n,e,i){this.k=n,this.x=e,this.y=i}J1.prototype={constructor:J1,scale:function(n){return n===1?this:new J1(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new J1(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};J1.prototype;const E4=Ii.createContext({});function aX(n){const e=Ii.useRef(null);return e.current===null&&(e.current=n()),e.current}const HR=typeof window<"u",oX=HR?Ii.useLayoutEffect:Ii.useEffect,jR=Ii.createContext(null);function qR(n,e){n.indexOf(e)===-1&&n.push(e)}function XR(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}const e_=(n,e,i)=>i>e?e:i<n?n:i;let WR=()=>{};const t_={},A4=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function C4(n){return typeof n=="object"&&n!==null}const R4=n=>/^0[^.\s]+$/u.test(n);function ZR(n){let e;return()=>(e===void 0&&(e=n()),e)}const Ip=n=>n,lX=(n,e)=>i=>e(n(i)),sw=(...n)=>n.reduce(lX),Rb=(n,e,i)=>{const l=e-n;return l===0?1:(i-n)/l};class YR{constructor(){this.subscriptions=[]}add(e){return qR(this.subscriptions,e),()=>XR(this.subscriptions,e)}notify(e,i,l){const h=this.subscriptions.length;if(h)if(h===1)this.subscriptions[0](e,i,l);else for(let g=0;g<h;g++){const v=this.subscriptions[g];v&&v(e,i,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ug=n=>n*1e3,Rp=n=>n/1e3;function I4(n,e){return e?n*(1e3/e):0}const D4=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,cX=1e-7,uX=12;function hX(n,e,i,l,h){let g,v,r=0;do v=e+(i-e)/2,g=D4(v,l,h)-n,g>0?i=v:e=v;while(Math.abs(g)>cX&&++r<uX);return v}function aw(n,e,i,l){if(n===e&&i===l)return Ip;const h=g=>hX(g,0,1,n,i);return g=>g===0||g===1?g:D4(h(g),e,l)}const L4=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,P4=n=>e=>1-n(1-e),z4=aw(.33,1.53,.69,.99),KR=P4(z4),O4=L4(KR),B4=n=>(n*=2)<1?.5*KR(n):.5*(2-Math.pow(2,-10*(n-1))),$R=n=>1-Math.sin(Math.acos(n)),N4=P4($R),F4=L4($R),fX=aw(.42,0,1,1),dX=aw(0,0,.58,1),U4=aw(.42,0,.58,1),pX=n=>Array.isArray(n)&&typeof n[0]!="number",k4=n=>Array.isArray(n)&&typeof n[0]=="number",mX={linear:Ip,easeIn:fX,easeInOut:U4,easeOut:dX,circIn:$R,circInOut:F4,circOut:N4,backIn:KR,backInOut:O4,backOut:z4,anticipate:B4},gX=n=>typeof n=="string",Wz=n=>{if(k4(n)){WR(n.length===4);const[e,i,l,h]=n;return aw(e,i,l,h)}else if(gX(n))return mX[n];return n},PS=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function _X(n,e){let i=new Set,l=new Set,h=!1,g=!1;const v=new WeakSet;let r={delta:0,timestamp:0,isProcessing:!1};function C(z){v.has(z)&&(I.schedule(z),n()),z(r)}const I={schedule:(z,N=!1,k=!1)=>{const $=k&&h?i:l;return N&&v.add(z),$.has(z)||$.add(z),z},cancel:z=>{l.delete(z),v.delete(z)},process:z=>{if(r=z,h){g=!0;return}h=!0,[i,l]=[l,i],i.forEach(C),i.clear(),h=!1,g&&(g=!1,I.process(z))}};return I}const yX=40;function V4(n,e){let i=!1,l=!0;const h={delta:0,timestamp:0,isProcessing:!1},g=()=>i=!0,v=PS.reduce((ue,me)=>(ue[me]=_X(g),ue),{}),{setup:r,read:C,resolveKeyframes:I,preUpdate:z,update:N,preRender:k,render:j,postRender:$}=v,re=()=>{const ue=t_.useManualTiming?h.timestamp:performance.now();i=!1,t_.useManualTiming||(h.delta=l?1e3/60:Math.max(Math.min(ue-h.timestamp,yX),1)),h.timestamp=ue,h.isProcessing=!0,r.process(h),C.process(h),I.process(h),z.process(h),N.process(h),k.process(h),j.process(h),$.process(h),h.isProcessing=!1,i&&e&&(l=!1,n(re))},ie=()=>{i=!0,l=!0,h.isProcessing||n(re)};return{schedule:PS.reduce((ue,me)=>{const Ae=v[me];return ue[me]=(Se,ze=!1,je=!1)=>(i||ie(),Ae.schedule(Se,ze,je)),ue},{}),cancel:ue=>{for(let me=0;me<PS.length;me++)v[PS[me]].cancel(ue)},state:h,steps:v}}const{schedule:Go,cancel:J_,state:zu,steps:PA}=V4(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ip,!0);let OT;function xX(){OT=void 0}const Wf={now:()=>(OT===void 0&&Wf.set(zu.isProcessing||t_.useManualTiming?zu.timestamp:performance.now()),OT),set:n=>{OT=n,queueMicrotask(xX)}},G4=n=>e=>typeof e=="string"&&e.startsWith(n),JR=G4("--"),vX=G4("var(--"),QR=n=>vX(n)?bX.test(n.split("/*")[0].trim()):!1,bX=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,mv={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Ib={...mv,transform:n=>e_(0,1,n)},zS={...mv,default:1},sb=n=>Math.round(n*1e5)/1e5,eI=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function wX(n){return n==null}const SX=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,tI=(n,e)=>i=>!!(typeof i=="string"&&SX.test(i)&&i.startsWith(n)||e&&!wX(i)&&Object.prototype.hasOwnProperty.call(i,e)),H4=(n,e,i)=>l=>{if(typeof l!="string")return l;const[h,g,v,r]=l.match(eI);return{[n]:parseFloat(h),[e]:parseFloat(g),[i]:parseFloat(v),alpha:r!==void 0?parseFloat(r):1}},TX=n=>e_(0,255,n),zA={...mv,transform:n=>Math.round(TX(n))},sy={test:tI("rgb","red"),parse:H4("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:l=1})=>"rgba("+zA.transform(n)+", "+zA.transform(e)+", "+zA.transform(i)+", "+sb(Ib.transform(l))+")"};function MX(n){let e="",i="",l="",h="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),l=n.substring(5,7),h=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),l=n.substring(3,4),h=n.substring(4,5),e+=e,i+=i,l+=l,h+=h),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(l,16),alpha:h?parseInt(h,16)/255:1}}const UC={test:tI("#"),parse:MX,transform:sy.transform},ow=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),G_=ow("deg"),hg=ow("%"),ds=ow("px"),EX=ow("vh"),AX=ow("vw"),Zz={...hg,parse:n=>hg.parse(n)/100,transform:n=>hg.transform(n*100)},Bx={test:tI("hsl","hue"),parse:H4("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:l=1})=>"hsla("+Math.round(n)+", "+hg.transform(sb(e))+", "+hg.transform(sb(i))+", "+sb(Ib.transform(l))+")"},rc={test:n=>sy.test(n)||UC.test(n)||Bx.test(n),parse:n=>sy.test(n)?sy.parse(n):Bx.test(n)?Bx.parse(n):UC.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?sy.transform(n):Bx.transform(n),getAnimatableNone:n=>{const e=rc.parse(n);return e.alpha=0,rc.transform(e)}},CX=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function RX(n){return isNaN(n)&&typeof n=="string"&&(n.match(eI)?.length||0)+(n.match(CX)?.length||0)>0}const j4="number",q4="color",IX="var",DX="var(",Yz="${}",LX=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Db(n){const e=n.toString(),i=[],l={color:[],number:[],var:[]},h=[];let g=0;const r=e.replace(LX,C=>(rc.test(C)?(l.color.push(g),h.push(q4),i.push(rc.parse(C))):C.startsWith(DX)?(l.var.push(g),h.push(IX),i.push(C)):(l.number.push(g),h.push(j4),i.push(parseFloat(C))),++g,Yz)).split(Yz);return{values:i,split:r,indexes:l,types:h}}function X4(n){return Db(n).values}function W4(n){const{split:e,types:i}=Db(n),l=e.length;return h=>{let g="";for(let v=0;v<l;v++)if(g+=e[v],h[v]!==void 0){const r=i[v];r===j4?g+=sb(h[v]):r===q4?g+=rc.transform(h[v]):g+=h[v]}return g}}const PX=n=>typeof n=="number"?0:rc.test(n)?rc.getAnimatableNone(n):n;function zX(n){const e=X4(n);return W4(n)(e.map(PX))}const Q_={test:RX,parse:X4,createTransformer:W4,getAnimatableNone:zX};function OA(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function OX({hue:n,saturation:e,lightness:i,alpha:l}){n/=360,e/=100,i/=100;let h=0,g=0,v=0;if(!e)h=g=v=i;else{const r=i<.5?i*(1+e):i+e-i*e,C=2*i-r;h=OA(C,r,n+1/3),g=OA(C,r,n),v=OA(C,r,n-1/3)}return{red:Math.round(h*255),green:Math.round(g*255),blue:Math.round(v*255),alpha:l}}function w2(n,e){return i=>i>0?e:n}const Qo=(n,e,i)=>n+(e-n)*i,BA=(n,e,i)=>{const l=n*n,h=i*(e*e-l)+l;return h<0?0:Math.sqrt(h)},BX=[UC,sy,Bx],NX=n=>BX.find(e=>e.test(n));function Kz(n){const e=NX(n);if(!e)return!1;let i=e.parse(n);return e===Bx&&(i=OX(i)),i}const $z=(n,e)=>{const i=Kz(n),l=Kz(e);if(!i||!l)return w2(n,e);const h={...i};return g=>(h.red=BA(i.red,l.red,g),h.green=BA(i.green,l.green,g),h.blue=BA(i.blue,l.blue,g),h.alpha=Qo(i.alpha,l.alpha,g),sy.transform(h))},kC=new Set(["none","hidden"]);function FX(n,e){return kC.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function UX(n,e){return i=>Qo(n,e,i)}function iI(n){return typeof n=="number"?UX:typeof n=="string"?QR(n)?w2:rc.test(n)?$z:GX:Array.isArray(n)?Z4:typeof n=="object"?rc.test(n)?$z:kX:w2}function Z4(n,e){const i=[...n],l=i.length,h=n.map((g,v)=>iI(g)(g,e[v]));return g=>{for(let v=0;v<l;v++)i[v]=h[v](g);return i}}function kX(n,e){const i={...n,...e},l={};for(const h in i)n[h]!==void 0&&e[h]!==void 0&&(l[h]=iI(n[h])(n[h],e[h]));return h=>{for(const g in l)i[g]=l[g](h);return i}}function VX(n,e){const i=[],l={color:0,var:0,number:0};for(let h=0;h<e.values.length;h++){const g=e.types[h],v=n.indexes[g][l[g]],r=n.values[v]??0;i[h]=r,l[g]++}return i}const GX=(n,e)=>{const i=Q_.createTransformer(e),l=Db(n),h=Db(e);return l.indexes.var.length===h.indexes.var.length&&l.indexes.color.length===h.indexes.color.length&&l.indexes.number.length>=h.indexes.number.length?kC.has(n)&&!h.values.length||kC.has(e)&&!l.values.length?FX(n,e):sw(Z4(VX(l,h),h.values),i):w2(n,e)};function Y4(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?Qo(n,e,i):iI(n)(n,e)}const HX=n=>{const e=({timestamp:i})=>n(i);return{start:(i=!0)=>Go.update(e,i),stop:()=>J_(e),now:()=>zu.isProcessing?zu.timestamp:Wf.now()}},K4=(n,e,i=10)=>{let l="";const h=Math.max(Math.round(e/i),2);for(let g=0;g<h;g++)l+=Math.round(n(g/(h-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},S2=2e4;function nI(n){let e=0;const i=50;let l=n.next(e);for(;!l.done&&e<S2;)e+=i,l=n.next(e);return e>=S2?1/0:e}function jX(n,e=100,i){const l=i({...n,keyframes:[0,e]}),h=Math.min(nI(l),S2);return{type:"keyframes",ease:g=>l.next(h*g).value/e,duration:Rp(h)}}const qX=5;function $4(n,e,i){const l=Math.max(e-qX,0);return I4(i-n(l),e-l)}const _l={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},NA=.001;function XX({duration:n=_l.duration,bounce:e=_l.bounce,velocity:i=_l.velocity,mass:l=_l.mass}){let h,g,v=1-e;v=e_(_l.minDamping,_l.maxDamping,v),n=e_(_l.minDuration,_l.maxDuration,Rp(n)),v<1?(h=I=>{const z=I*v,N=z*n,k=z-i,j=VC(I,v),$=Math.exp(-N);return NA-k/j*$},g=I=>{const N=I*v*n,k=N*i+i,j=Math.pow(v,2)*Math.pow(I,2)*n,$=Math.exp(-N),re=VC(Math.pow(I,2),v);return(-h(I)+NA>0?-1:1)*((k-j)*$)/re}):(h=I=>{const z=Math.exp(-I*n),N=(I-i)*n+1;return-NA+z*N},g=I=>{const z=Math.exp(-I*n),N=(i-I)*(n*n);return z*N});const r=5/n,C=ZX(h,g,r);if(n=ug(n),isNaN(C))return{stiffness:_l.stiffness,damping:_l.damping,duration:n};{const I=Math.pow(C,2)*l;return{stiffness:I,damping:v*2*Math.sqrt(l*I),duration:n}}}const WX=12;function ZX(n,e,i){let l=i;for(let h=1;h<WX;h++)l=l-n(l)/e(l);return l}function VC(n,e){return n*Math.sqrt(1-e*e)}const YX=["duration","bounce"],KX=["stiffness","damping","mass"];function Jz(n,e){return e.some(i=>n[i]!==void 0)}function $X(n){let e={velocity:_l.velocity,stiffness:_l.stiffness,damping:_l.damping,mass:_l.mass,isResolvedFromDuration:!1,...n};if(!Jz(n,KX)&&Jz(n,YX))if(n.visualDuration){const i=n.visualDuration,l=2*Math.PI/(i*1.2),h=l*l,g=2*e_(.05,1,1-(n.bounce||0))*Math.sqrt(h);e={...e,mass:_l.mass,stiffness:h,damping:g}}else{const i=XX(n);e={...e,...i,mass:_l.mass},e.isResolvedFromDuration=!0}return e}function T2(n=_l.visualDuration,e=_l.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:l,restDelta:h}=i;const g=i.keyframes[0],v=i.keyframes[i.keyframes.length-1],r={done:!1,value:g},{stiffness:C,damping:I,mass:z,duration:N,velocity:k,isResolvedFromDuration:j}=$X({...i,velocity:-Rp(i.velocity||0)}),$=k||0,re=I/(2*Math.sqrt(C*z)),ie=v-g,Y=Rp(Math.sqrt(C/z)),ae=Math.abs(ie)<5;l||(l=ae?_l.restSpeed.granular:_l.restSpeed.default),h||(h=ae?_l.restDelta.granular:_l.restDelta.default);let ue;if(re<1){const Ae=VC(Y,re);ue=Se=>{const ze=Math.exp(-re*Y*Se);return v-ze*(($+re*Y*ie)/Ae*Math.sin(Ae*Se)+ie*Math.cos(Ae*Se))}}else if(re===1)ue=Ae=>v-Math.exp(-Y*Ae)*(ie+($+Y*ie)*Ae);else{const Ae=Y*Math.sqrt(re*re-1);ue=Se=>{const ze=Math.exp(-re*Y*Se),je=Math.min(Ae*Se,300);return v-ze*(($+re*Y*ie)*Math.sinh(je)+Ae*ie*Math.cosh(je))/Ae}}const me={calculatedDuration:j&&N||null,next:Ae=>{const Se=ue(Ae);if(j)r.done=Ae>=N;else{let ze=Ae===0?$:0;re<1&&(ze=Ae===0?ug($):$4(ue,Ae,Se));const je=Math.abs(ze)<=l,Ce=Math.abs(v-Se)<=h;r.done=je&&Ce}return r.value=r.done?v:Se,r},toString:()=>{const Ae=Math.min(nI(me),S2),Se=K4(ze=>me.next(Ae*ze).value,Ae,30);return Ae+"ms "+Se},toTransition:()=>{}};return me}T2.applyToOptions=n=>{const e=jX(n,100,T2);return n.ease=e.ease,n.duration=ug(e.duration),n.type="keyframes",n};function GC({keyframes:n,velocity:e=0,power:i=.8,timeConstant:l=325,bounceDamping:h=10,bounceStiffness:g=500,modifyTarget:v,min:r,max:C,restDelta:I=.5,restSpeed:z}){const N=n[0],k={done:!1,value:N},j=je=>r!==void 0&&je<r||C!==void 0&&je>C,$=je=>r===void 0?C:C===void 0||Math.abs(r-je)<Math.abs(C-je)?r:C;let re=i*e;const ie=N+re,Y=v===void 0?ie:v(ie);Y!==ie&&(re=Y-N);const ae=je=>-re*Math.exp(-je/l),ue=je=>Y+ae(je),me=je=>{const Ce=ae(je),Te=ue(je);k.done=Math.abs(Ce)<=I,k.value=k.done?Y:Te};let Ae,Se;const ze=je=>{j(k.value)&&(Ae=je,Se=T2({keyframes:[k.value,$(k.value)],velocity:$4(ue,je,k.value),damping:h,stiffness:g,restDelta:I,restSpeed:z}))};return ze(0),{calculatedDuration:null,next:je=>{let Ce=!1;return!Se&&Ae===void 0&&(Ce=!0,me(je),ze(je)),Ae!==void 0&&je>=Ae?Se.next(je-Ae):(!Ce&&me(je),k)}}}function JX(n,e,i){const l=[],h=i||t_.mix||Y4,g=n.length-1;for(let v=0;v<g;v++){let r=h(n[v],n[v+1]);if(e){const C=Array.isArray(e)?e[v]||Ip:e;r=sw(C,r)}l.push(r)}return l}function QX(n,e,{clamp:i=!0,ease:l,mixer:h}={}){const g=n.length;if(WR(g===e.length),g===1)return()=>e[0];if(g===2&&e[0]===e[1])return()=>e[1];const v=n[0]===n[1];n[0]>n[g-1]&&(n=[...n].reverse(),e=[...e].reverse());const r=JX(e,l,h),C=r.length,I=z=>{if(v&&z<n[0])return e[0];let N=0;if(C>1)for(;N<n.length-2&&!(z<n[N+1]);N++);const k=Rb(n[N],n[N+1],z);return r[N](k)};return i?z=>I(e_(n[0],n[g-1],z)):I}function eW(n,e){const i=n[n.length-1];for(let l=1;l<=e;l++){const h=Rb(0,e,l);n.push(Qo(i,1,h))}}function tW(n){const e=[0];return eW(e,n.length-1),e}function iW(n,e){return n.map(i=>i*e)}function nW(n,e){return n.map(()=>e||U4).splice(0,n.length-1)}function ab({duration:n=300,keyframes:e,times:i,ease:l="easeInOut"}){const h=pX(l)?l.map(Wz):Wz(l),g={done:!1,value:e[0]},v=iW(i&&i.length===e.length?i:tW(e),n),r=QX(v,e,{ease:Array.isArray(h)?h:nW(e,h)});return{calculatedDuration:n,next:C=>(g.value=r(C),g.done=C>=n,g)}}const rW=n=>n!==null;function rI(n,{repeat:e,repeatType:i="loop"},l,h=1){const g=n.filter(rW),r=h<0||e&&i!=="loop"&&e%2===1?0:g.length-1;return!r||l===void 0?g[r]:l}const sW={decay:GC,inertia:GC,tween:ab,keyframes:ab,spring:T2};function J4(n){typeof n.type=="string"&&(n.type=sW[n.type])}class sI{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,i){return this.finished.then(e,i)}}const aW=n=>n/100;class aI extends sI{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:i}=this.options;i&&i.updatedAt!==Wf.now()&&this.tick(Wf.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;J4(e);const{type:i=ab,repeat:l=0,repeatDelay:h=0,repeatType:g,velocity:v=0}=e;let{keyframes:r}=e;const C=i||ab;C!==ab&&typeof r[0]!="number"&&(this.mixKeyframes=sw(aW,Y4(r[0],r[1])),r=[0,100]);const I=C({...e,keyframes:r});g==="mirror"&&(this.mirroredGenerator=C({...e,keyframes:[...r].reverse(),velocity:-v})),I.calculatedDuration===null&&(I.calculatedDuration=nI(I));const{calculatedDuration:z}=I;this.calculatedDuration=z,this.resolvedDuration=z+h,this.totalDuration=this.resolvedDuration*(l+1)-h,this.generator=I}updateTime(e){const i=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=i}tick(e,i=!1){const{generator:l,totalDuration:h,mixKeyframes:g,mirroredGenerator:v,resolvedDuration:r,calculatedDuration:C}=this;if(this.startTime===null)return l.next(0);const{delay:I=0,keyframes:z,repeat:N,repeatType:k,repeatDelay:j,type:$,onUpdate:re,finalKeyframe:ie}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-h/this.speed,this.startTime)),i?this.currentTime=e:this.updateTime(e);const Y=this.currentTime-I*(this.playbackSpeed>=0?1:-1),ae=this.playbackSpeed>=0?Y<0:Y>h;this.currentTime=Math.max(Y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let ue=this.currentTime,me=l;if(N){const je=Math.min(this.currentTime,h)/r;let Ce=Math.floor(je),Te=je%1;!Te&&je>=1&&(Te=1),Te===1&&Ce--,Ce=Math.min(Ce,N+1),!!(Ce%2)&&(k==="reverse"?(Te=1-Te,j&&(Te-=j/r)):k==="mirror"&&(me=v)),ue=e_(0,1,Te)*r}const Ae=ae?{done:!1,value:z[0]}:me.next(ue);g&&(Ae.value=g(Ae.value));let{done:Se}=Ae;!ae&&C!==null&&(Se=this.playbackSpeed>=0?this.currentTime>=h:this.currentTime<=0);const ze=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Se);return ze&&$!==GC&&(Ae.value=rI(z,this.options,ie,this.speed)),re&&re(Ae.value),ze&&this.finish(),Ae}then(e,i){return this.finished.then(e,i)}get duration(){return Rp(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Rp(e)}get time(){return Rp(this.currentTime)}set time(e){e=ug(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Wf.now());const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Rp(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=HX,startTime:i}=this.options;this.driver||(this.driver=e(h=>this.tick(h))),this.options.onPlay?.();const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=i??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Wf.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function oW(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const ay=n=>n*180/Math.PI,HC=n=>{const e=ay(Math.atan2(n[1],n[0]));return jC(e)},lW={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:HC,rotateZ:HC,skewX:n=>ay(Math.atan(n[1])),skewY:n=>ay(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},jC=n=>(n=n%360,n<0&&(n+=360),n),Qz=HC,eO=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),tO=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),cW={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:eO,scaleY:tO,scale:n=>(eO(n)+tO(n))/2,rotateX:n=>jC(ay(Math.atan2(n[6],n[5]))),rotateY:n=>jC(ay(Math.atan2(-n[2],n[0]))),rotateZ:Qz,rotate:Qz,skewX:n=>ay(Math.atan(n[4])),skewY:n=>ay(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function qC(n){return n.includes("scale")?1:0}function XC(n,e){if(!n||n==="none")return qC(e);const i=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,h;if(i)l=cW,h=i;else{const r=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=lW,h=r}if(!h)return qC(e);const g=l[e],v=h[1].split(",").map(hW);return typeof g=="function"?g(v):v[g]}const uW=(n,e)=>{const{transform:i="none"}=getComputedStyle(n);return XC(i,e)};function hW(n){return parseFloat(n.trim())}const gv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],_v=new Set(gv),iO=n=>n===mv||n===ds,fW=new Set(["x","y","z"]),dW=gv.filter(n=>!fW.has(n));function pW(n){const e=[];return dW.forEach(i=>{const l=n.getValue(i);l!==void 0&&(e.push([i,l.get()]),l.set(i.startsWith("scale")?1:0))}),e}const hy={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>XC(e,"x"),y:(n,{transform:e})=>XC(e,"y")};hy.translateX=hy.x;hy.translateY=hy.y;const fy=new Set;let WC=!1,ZC=!1,YC=!1;function Q4(){if(ZC){const n=Array.from(fy).filter(l=>l.needsMeasurement),e=new Set(n.map(l=>l.element)),i=new Map;e.forEach(l=>{const h=pW(l);h.length&&(i.set(l,h),l.render())}),n.forEach(l=>l.measureInitialState()),e.forEach(l=>{l.render();const h=i.get(l);h&&h.forEach(([g,v])=>{l.getValue(g)?.set(v)})}),n.forEach(l=>l.measureEndState()),n.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}ZC=!1,WC=!1,fy.forEach(n=>n.complete(YC)),fy.clear()}function eU(){fy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(ZC=!0)})}function mW(){YC=!0,eU(),Q4(),YC=!1}class oI{constructor(e,i,l,h,g,v=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=l,this.motionValue=h,this.element=g,this.isAsync=v}scheduleResolve(){this.state="scheduled",this.isAsync?(fy.add(this),WC||(WC=!0,Go.read(eU),Go.resolveKeyframes(Q4))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:l,motionValue:h}=this;if(e[0]===null){const g=h?.get(),v=e[e.length-1];if(g!==void 0)e[0]=g;else if(l&&i){const r=l.readValue(i,v);r!=null&&(e[0]=r)}e[0]===void 0&&(e[0]=v),h&&g===void 0&&h.set(e[0])}oW(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),fy.delete(this)}cancel(){this.state==="scheduled"&&(fy.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const gW=n=>n.startsWith("--");function _W(n,e,i){gW(e)?n.style.setProperty(e,i):n.style[e]=i}const yW=ZR(()=>window.ScrollTimeline!==void 0),xW={};function vW(n,e){const i=ZR(n);return()=>xW[e]??i()}const tU=vW(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Q1=([n,e,i,l])=>`cubic-bezier(${n}, ${e}, ${i}, ${l})`,nO={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Q1([0,.65,.55,1]),circOut:Q1([.55,0,1,.45]),backIn:Q1([.31,.01,.66,-.59]),backOut:Q1([.33,1.53,.69,.99])};function iU(n,e){if(n)return typeof n=="function"?tU()?K4(n,e):"ease-out":k4(n)?Q1(n):Array.isArray(n)?n.map(i=>iU(i,e)||nO.easeOut):nO[n]}function bW(n,e,i,{delay:l=0,duration:h=300,repeat:g=0,repeatType:v="loop",ease:r="easeOut",times:C}={},I=void 0){const z={[e]:i};C&&(z.offset=C);const N=iU(r,h);Array.isArray(N)&&(z.easing=N);const k={delay:l,duration:h,easing:Array.isArray(N)?"linear":N,fill:"both",iterations:g+1,direction:v==="reverse"?"alternate":"normal"};return I&&(k.pseudoElement=I),n.animate(z,k)}function nU(n){return typeof n=="function"&&"applyToOptions"in n}function wW({type:n,...e}){return nU(n)&&tU()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class SW extends sI{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:i,name:l,keyframes:h,pseudoElement:g,allowFlatten:v=!1,finalKeyframe:r,onComplete:C}=e;this.isPseudoElement=!!g,this.allowFlatten=v,this.options=e,WR(typeof e.type!="string");const I=wW(e);this.animation=bW(i,l,h,I,g),I.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!g){const z=rI(h,this.options,r,this.speed);this.updateMotionValue?this.updateMotionValue(z):_W(i,l,z),this.animation.cancel()}C?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Rp(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Rp(e)}get time(){return Rp(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=ug(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:i}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&yW()?(this.animation.timeline=e,Ip):i(this)}}const rU={anticipate:B4,backInOut:O4,circInOut:F4};function TW(n){return n in rU}function MW(n){typeof n.ease=="string"&&TW(n.ease)&&(n.ease=rU[n.ease])}const rO=10;class EW extends SW{constructor(e){MW(e),J4(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:i,onUpdate:l,onComplete:h,element:g,...v}=this.options;if(!i)return;if(e!==void 0){i.set(e);return}const r=new aI({...v,autoplay:!1}),C=ug(this.finishedTime??this.time);i.setWithVelocity(r.sample(C-rO).value,r.sample(C).value,rO),r.stop()}}const sO=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Q_.test(n)||n==="0")&&!n.startsWith("url("));function AW(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function CW(n,e,i,l){const h=n[0];if(h===null)return!1;if(e==="display"||e==="visibility")return!0;const g=n[n.length-1],v=sO(h,e),r=sO(g,e);return!v||!r?!1:AW(n)||(i==="spring"||nU(i))&&l}function KC(n){n.duration=0,n.type="keyframes"}const RW=new Set(["opacity","clipPath","filter","transform"]),IW=ZR(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function DW(n){const{motionValue:e,name:i,repeatDelay:l,repeatType:h,damping:g,type:v}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:C,transformTemplate:I}=e.owner.getProps();return IW()&&i&&RW.has(i)&&(i!=="transform"||!I)&&!C&&!l&&h!=="mirror"&&g!==0&&v!=="inertia"}const LW=40;class PW extends sI{constructor({autoplay:e=!0,delay:i=0,type:l="keyframes",repeat:h=0,repeatDelay:g=0,repeatType:v="loop",keyframes:r,name:C,motionValue:I,element:z,...N}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Wf.now();const k={autoplay:e,delay:i,type:l,repeat:h,repeatDelay:g,repeatType:v,name:C,motionValue:I,element:z,...N},j=z?.KeyframeResolver||oI;this.keyframeResolver=new j(r,($,re,ie)=>this.onKeyframesResolved($,re,k,!ie),C,I,z),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,i,l,h){this.keyframeResolver=void 0;const{name:g,type:v,velocity:r,delay:C,isHandoff:I,onUpdate:z}=l;this.resolvedAt=Wf.now(),CW(e,g,v,r)||((t_.instantAnimations||!C)&&z?.(rI(e,l,i)),e[0]=e[e.length-1],KC(l),l.repeat=0);const k={startTime:h?this.resolvedAt?this.resolvedAt-this.createdAt>LW?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:i,...l,keyframes:e},j=!I&&DW(k)?new EW({...k,element:k.motionValue.owner.current}):new aI(k);j.finished.then(()=>this.notifyFinished()).catch(Ip),this.pendingTimeline&&(this.stopTimeline=j.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=j}get finished(){return this._animation?this.animation.finished:this._finished}then(e,i){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),mW()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const zW=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function OW(n){const e=zW.exec(n);if(!e)return[,];const[,i,l,h]=e;return[`--${i??l}`,h]}function sU(n,e,i=1){const[l,h]=OW(n);if(!l)return;const g=window.getComputedStyle(e).getPropertyValue(l);if(g){const v=g.trim();return A4(v)?parseFloat(v):v}return QR(h)?sU(h,e,i+1):h}function lI(n,e){return n?.[e]??n?.default??n}const aU=new Set(["width","height","top","left","right","bottom",...gv]),BW={test:n=>n==="auto",parse:n=>n},oU=n=>e=>e.test(n),lU=[mv,ds,hg,G_,AX,EX,BW],aO=n=>lU.find(oU(n));function NW(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||R4(n):!0}const FW=new Set(["brightness","contrast","saturate","opacity"]);function UW(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[l]=i.match(eI)||[];if(!l)return n;const h=i.replace(l,"");let g=FW.has(e)?1:0;return l!==i&&(g*=100),e+"("+g+h+")"}const kW=/\b([a-z-]*)\(.*?\)/gu,$C={...Q_,getAnimatableNone:n=>{const e=n.match(kW);return e?e.map(UW).join(" "):n}},oO={...mv,transform:Math.round},VW={rotate:G_,rotateX:G_,rotateY:G_,rotateZ:G_,scale:zS,scaleX:zS,scaleY:zS,scaleZ:zS,skew:G_,skewX:G_,skewY:G_,distance:ds,translateX:ds,translateY:ds,translateZ:ds,x:ds,y:ds,z:ds,perspective:ds,transformPerspective:ds,opacity:Ib,originX:Zz,originY:Zz,originZ:ds},cI={borderWidth:ds,borderTopWidth:ds,borderRightWidth:ds,borderBottomWidth:ds,borderLeftWidth:ds,borderRadius:ds,radius:ds,borderTopLeftRadius:ds,borderTopRightRadius:ds,borderBottomRightRadius:ds,borderBottomLeftRadius:ds,width:ds,maxWidth:ds,height:ds,maxHeight:ds,top:ds,right:ds,bottom:ds,left:ds,padding:ds,paddingTop:ds,paddingRight:ds,paddingBottom:ds,paddingLeft:ds,margin:ds,marginTop:ds,marginRight:ds,marginBottom:ds,marginLeft:ds,backgroundPositionX:ds,backgroundPositionY:ds,...VW,zIndex:oO,fillOpacity:Ib,strokeOpacity:Ib,numOctaves:oO},GW={...cI,color:rc,backgroundColor:rc,outlineColor:rc,fill:rc,stroke:rc,borderColor:rc,borderTopColor:rc,borderRightColor:rc,borderBottomColor:rc,borderLeftColor:rc,filter:$C,WebkitFilter:$C},cU=n=>GW[n];function uU(n,e){let i=cU(n);return i!==$C&&(i=Q_),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const HW=new Set(["auto","none","0"]);function jW(n,e,i){let l=0,h;for(;l<n.length&&!h;){const g=n[l];typeof g=="string"&&!HW.has(g)&&Db(g).values.length&&(h=n[l]),l++}if(h&&i)for(const g of e)n[g]=uU(i,h)}class qW extends oI{constructor(e,i,l,h,g){super(e,i,l,h,g,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:l}=this;if(!i||!i.current)return;super.readKeyframes();for(let C=0;C<e.length;C++){let I=e[C];if(typeof I=="string"&&(I=I.trim(),QR(I))){const z=sU(I,i.current);z!==void 0&&(e[C]=z),C===e.length-1&&(this.finalKeyframe=I)}}if(this.resolveNoneKeyframes(),!aU.has(l)||e.length!==2)return;const[h,g]=e,v=aO(h),r=aO(g);if(v!==r)if(iO(v)&&iO(r))for(let C=0;C<e.length;C++){const I=e[C];typeof I=="string"&&(e[C]=parseFloat(I))}else hy[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,l=[];for(let h=0;h<e.length;h++)(e[h]===null||NW(e[h]))&&l.push(h);l.length&&jW(e,l,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:l}=this;if(!e||!e.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=hy[l](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const h=i[i.length-1];h!==void 0&&e.getValue(l,h).jump(h,!1)}measureEndState(){const{element:e,name:i,unresolvedKeyframes:l}=this;if(!e||!e.current)return;const h=e.getValue(i);h&&h.jump(this.measuredOrigin,!1);const g=l.length-1,v=l[g];l[g]=hy[i](e.measureViewportBox(),window.getComputedStyle(e.current)),v!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=v),this.removedTransforms?.length&&this.removedTransforms.forEach(([r,C])=>{e.getValue(r).set(C)}),this.resolveNoneKeyframes()}}function XW(n,e,i){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let l=document;const h=i?.[n]??l.querySelectorAll(n);return h?Array.from(h):[]}return Array.from(n)}const hU=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function WW(n){return C4(n)&&"offsetHeight"in n}const lO=30,ZW=n=>!isNaN(parseFloat(n));class YW{constructor(e,i={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{const h=Wf.now();if(this.updatedAt!==h&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const g of this.dependents)g.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Wf.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=ZW(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new YR);const l=this.events[e].add(i);return e==="change"?()=>{l(),Go.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,i,l){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-l}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Wf.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>lO)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,lO);return I4(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ev(n,e){return new YW(n,e)}const{schedule:uI}=V4(queueMicrotask,!1),vm={x:!1,y:!1};function fU(){return vm.x||vm.y}function KW(n){return n==="x"||n==="y"?vm[n]?null:(vm[n]=!0,()=>{vm[n]=!1}):vm.x||vm.y?null:(vm.x=vm.y=!0,()=>{vm.x=vm.y=!1})}function dU(n,e){const i=XW(n),l=new AbortController,h={passive:!0,...e,signal:l.signal};return[i,h,()=>l.abort()]}function cO(n){return!(n.pointerType==="touch"||fU())}function $W(n,e,i={}){const[l,h,g]=dU(n,i),v=r=>{if(!cO(r))return;const{target:C}=r,I=e(C,r);if(typeof I!="function"||!C)return;const z=N=>{cO(N)&&(I(N),C.removeEventListener("pointerleave",z))};C.addEventListener("pointerleave",z,h)};return l.forEach(r=>{r.addEventListener("pointerenter",v,h)}),g}const pU=(n,e)=>e?n===e?!0:pU(n,e.parentElement):!1,hI=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,JW=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function QW(n){return JW.has(n.tagName)||n.tabIndex!==-1}const BT=new WeakSet;function uO(n){return e=>{e.key==="Enter"&&n(e)}}function FA(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const eZ=(n,e)=>{const i=n.currentTarget;if(!i)return;const l=uO(()=>{if(BT.has(i))return;FA(i,"down");const h=uO(()=>{FA(i,"up")}),g=()=>FA(i,"cancel");i.addEventListener("keyup",h,e),i.addEventListener("blur",g,e)});i.addEventListener("keydown",l,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",l),e)};function hO(n){return hI(n)&&!fU()}function tZ(n,e,i={}){const[l,h,g]=dU(n,i),v=r=>{const C=r.currentTarget;if(!hO(r))return;BT.add(C);const I=e(C,r),z=(j,$)=>{window.removeEventListener("pointerup",N),window.removeEventListener("pointercancel",k),BT.has(C)&&BT.delete(C),hO(j)&&typeof I=="function"&&I(j,{success:$})},N=j=>{z(j,C===window||C===document||i.useGlobalTarget||pU(C,j.target))},k=j=>{z(j,!1)};window.addEventListener("pointerup",N,h),window.addEventListener("pointercancel",k,h)};return l.forEach(r=>{(i.useGlobalTarget?window:r).addEventListener("pointerdown",v,h),WW(r)&&(r.addEventListener("focus",I=>eZ(I,h)),!QW(r)&&!r.hasAttribute("tabindex")&&(r.tabIndex=0))}),g}function mU(n){return C4(n)&&"ownerSVGElement"in n}function iZ(n){return mU(n)&&n.tagName==="svg"}const gh=n=>!!(n&&n.getVelocity),nZ=[...lU,rc,Q_],rZ=n=>nZ.find(oU(n)),gU=Ii.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function sZ(n=!0){const e=Ii.useContext(jR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:l,register:h}=e,g=Ii.useId();Ii.useEffect(()=>{if(n)return h(g)},[n]);const v=Ii.useCallback(()=>n&&l&&l(g),[g,l,n]);return!i&&l?[!1,v]:[!0]}const _U=Ii.createContext({strict:!1}),fO={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},tv={};for(const n in fO)tv[n]={isEnabled:e=>fO[n].some(i=>!!e[i])};function aZ(n){for(const e in n)tv[e]={...tv[e],...n[e]}}const oZ=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function M2(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||oZ.has(n)}let yU=n=>!M2(n);function lZ(n){typeof n=="function"&&(yU=e=>e.startsWith("on")?!M2(e):n(e))}try{lZ(require("@emotion/is-prop-valid").default)}catch{}function cZ(n,e,i){const l={};for(const h in n)h==="values"&&typeof n.values=="object"||(yU(h)||i===!0&&M2(h)||!e&&!M2(h)||n.draggable&&h.startsWith("onDrag"))&&(l[h]=n[h]);return l}const TM=Ii.createContext({});function MM(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Lb(n){return typeof n=="string"||Array.isArray(n)}const fI=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],dI=["initial",...fI];function EM(n){return MM(n.animate)||dI.some(e=>Lb(n[e]))}function xU(n){return!!(EM(n)||n.variants)}function uZ(n,e){if(EM(n)){const{initial:i,animate:l}=n;return{initial:i===!1||Lb(i)?i:void 0,animate:Lb(l)?l:void 0}}return n.inherit!==!1?e:{}}function hZ(n){const{initial:e,animate:i}=uZ(n,Ii.useContext(TM));return Ii.useMemo(()=>({initial:e,animate:i}),[dO(e),dO(i)])}function dO(n){return Array.isArray(n)?n.join(" "):n}const Pb={};function fZ(n){for(const e in n)Pb[e]=n[e],JR(e)&&(Pb[e].isCSSVariable=!0)}function vU(n,{layout:e,layoutId:i}){return _v.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!Pb[n]||n==="opacity")}const dZ={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},pZ=gv.length;function mZ(n,e,i){let l="",h=!0;for(let g=0;g<pZ;g++){const v=gv[g],r=n[v];if(r===void 0)continue;let C=!0;if(typeof r=="number"?C=r===(v.startsWith("scale")?1:0):C=parseFloat(r)===0,!C||i){const I=hU(r,cI[v]);if(!C){h=!1;const z=dZ[v]||v;l+=`${z}(${I}) `}i&&(e[v]=I)}}return l=l.trim(),i?l=i(e,h?"":l):h&&(l="none"),l}function pI(n,e,i){const{style:l,vars:h,transformOrigin:g}=n;let v=!1,r=!1;for(const C in e){const I=e[C];if(_v.has(C)){v=!0;continue}else if(JR(C)){h[C]=I;continue}else{const z=hU(I,cI[C]);C.startsWith("origin")?(r=!0,g[C]=z):l[C]=z}}if(e.transform||(v||i?l.transform=mZ(e,n.transform,i):l.transform&&(l.transform="none")),r){const{originX:C="50%",originY:I="50%",originZ:z=0}=g;l.transformOrigin=`${C} ${I} ${z}`}}const mI=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function bU(n,e,i){for(const l in e)!gh(e[l])&&!vU(l,i)&&(n[l]=e[l])}function gZ({transformTemplate:n},e){return Ii.useMemo(()=>{const i=mI();return pI(i,e,n),Object.assign({},i.vars,i.style)},[e])}function _Z(n,e){const i=n.style||{},l={};return bU(l,i,n),Object.assign(l,gZ(n,e)),l}function yZ(n,e){const i={},l=_Z(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=l,i}const xZ={offset:"stroke-dashoffset",array:"stroke-dasharray"},vZ={offset:"strokeDashoffset",array:"strokeDasharray"};function bZ(n,e,i=1,l=0,h=!0){n.pathLength=1;const g=h?xZ:vZ;n[g.offset]=ds.transform(-l);const v=ds.transform(e),r=ds.transform(i);n[g.array]=`${v} ${r}`}function wU(n,{attrX:e,attrY:i,attrScale:l,pathLength:h,pathSpacing:g=1,pathOffset:v=0,...r},C,I,z){if(pI(n,r,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:k}=n;N.transform&&(k.transform=N.transform,delete N.transform),(k.transform||N.transformOrigin)&&(k.transformOrigin=N.transformOrigin??"50% 50%",delete N.transformOrigin),k.transform&&(k.transformBox=z?.transformBox??"fill-box",delete N.transformBox),e!==void 0&&(N.x=e),i!==void 0&&(N.y=i),l!==void 0&&(N.scale=l),h!==void 0&&bZ(N,h,g,v,!1)}const SU=()=>({...mI(),attrs:{}}),TU=n=>typeof n=="string"&&n.toLowerCase()==="svg";function wZ(n,e,i,l){const h=Ii.useMemo(()=>{const g=SU();return wU(g,e,TU(l),n.transformTemplate,n.style),{...g.attrs,style:{...g.style}}},[e]);if(n.style){const g={};bU(g,n.style,n),h.style={...g,...h.style}}return h}const SZ=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function gI(n){return typeof n!="string"||n.includes("-")?!1:!!(SZ.indexOf(n)>-1||/[A-Z]/u.test(n))}function TZ(n,e,i,{latestValues:l},h,g=!1){const r=(gI(n)?wZ:yZ)(e,l,h,n),C=cZ(e,typeof n=="string",g),I=n!==Ii.Fragment?{...C,...r,ref:i}:{},{children:z}=e,N=Ii.useMemo(()=>gh(z)?z.get():z,[z]);return Ii.createElement(n,{...I,children:N})}function pO(n){const e=[{},{}];return n?.values.forEach((i,l)=>{e[0][l]=i.get(),e[1][l]=i.getVelocity()}),e}function _I(n,e,i,l){if(typeof e=="function"){const[h,g]=pO(l);e=e(i!==void 0?i:n.custom,h,g)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[h,g]=pO(l);e=e(i!==void 0?i:n.custom,h,g)}return e}function NT(n){return gh(n)?n.get():n}function MZ({scrapeMotionValuesFromProps:n,createRenderState:e},i,l,h){return{latestValues:EZ(i,l,h,n),renderState:e()}}function EZ(n,e,i,l){const h={},g=l(n,{});for(const k in g)h[k]=NT(g[k]);let{initial:v,animate:r}=n;const C=EM(n),I=xU(n);e&&I&&!C&&n.inherit!==!1&&(v===void 0&&(v=e.initial),r===void 0&&(r=e.animate));let z=i?i.initial===!1:!1;z=z||v===!1;const N=z?r:v;if(N&&typeof N!="boolean"&&!MM(N)){const k=Array.isArray(N)?N:[N];for(let j=0;j<k.length;j++){const $=_I(n,k[j]);if($){const{transitionEnd:re,transition:ie,...Y}=$;for(const ae in Y){let ue=Y[ae];if(Array.isArray(ue)){const me=z?ue.length-1:0;ue=ue[me]}ue!==null&&(h[ae]=ue)}for(const ae in re)h[ae]=re[ae]}}}return h}const MU=n=>(e,i)=>{const l=Ii.useContext(TM),h=Ii.useContext(jR),g=()=>MZ(n,e,l,h);return i?g():aX(g)};function yI(n,e,i){const{style:l}=n,h={};for(const g in l)(gh(l[g])||e.style&&gh(e.style[g])||vU(g,n)||i?.getValue(g)?.liveStyle!==void 0)&&(h[g]=l[g]);return h}const AZ=MU({scrapeMotionValuesFromProps:yI,createRenderState:mI});function EU(n,e,i){const l=yI(n,e,i);for(const h in n)if(gh(n[h])||gh(e[h])){const g=gv.indexOf(h)!==-1?"attr"+h.charAt(0).toUpperCase()+h.substring(1):h;l[g]=n[h]}return l}const CZ=MU({scrapeMotionValuesFromProps:EU,createRenderState:SU}),RZ=Symbol.for("motionComponentSymbol");function Nx(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function IZ(n,e,i){return Ii.useCallback(l=>{l&&n.onMount&&n.onMount(l),e&&(l?e.mount(l):e.unmount()),i&&(typeof i=="function"?i(l):Nx(i)&&(i.current=l))},[e])}const xI=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),DZ="framerAppearId",AU="data-"+xI(DZ),CU=Ii.createContext({});function LZ(n,e,i,l,h){const{visualElement:g}=Ii.useContext(TM),v=Ii.useContext(_U),r=Ii.useContext(jR),C=Ii.useContext(gU).reducedMotion,I=Ii.useRef(null);l=l||v.renderer,!I.current&&l&&(I.current=l(n,{visualState:e,parent:g,props:i,presenceContext:r,blockInitialAnimation:r?r.initial===!1:!1,reducedMotionConfig:C}));const z=I.current,N=Ii.useContext(CU);z&&!z.projection&&h&&(z.type==="html"||z.type==="svg")&&PZ(I.current,i,h,N);const k=Ii.useRef(!1);Ii.useInsertionEffect(()=>{z&&k.current&&z.update(i,r)});const j=i[AU],$=Ii.useRef(!!j&&!window.MotionHandoffIsComplete?.(j)&&window.MotionHasOptimisedAnimation?.(j));return oX(()=>{z&&(k.current=!0,window.MotionIsMounted=!0,z.updateFeatures(),z.scheduleRenderMicrotask(),$.current&&z.animationState&&z.animationState.animateChanges())}),Ii.useEffect(()=>{z&&(!$.current&&z.animationState&&z.animationState.animateChanges(),$.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(j)}),$.current=!1),z.enteringChildren=void 0)}),z}function PZ(n,e,i,l){const{layoutId:h,layout:g,drag:v,dragConstraints:r,layoutScroll:C,layoutRoot:I,layoutCrossfade:z}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:RU(n.parent)),n.projection.setOptions({layoutId:h,layout:g,alwaysMeasureLayout:!!v||r&&Nx(r),visualElement:n,animationType:typeof g=="string"?g:"both",initialPromotionConfig:l,crossfade:z,layoutScroll:C,layoutRoot:I})}function RU(n){if(n)return n.options.allowProjection!==!1?n.projection:RU(n.parent)}function UA(n,{forwardMotionProps:e=!1}={},i,l){i&&aZ(i);const h=gI(n)?CZ:AZ;function g(r,C){let I;const z={...Ii.useContext(gU),...r,layoutId:zZ(r)},{isStatic:N}=z,k=hZ(r),j=h(r,N);if(!N&&HR){OZ();const $=BZ(z);I=$.MeasureLayout,k.visualElement=LZ(n,j,z,l,$.ProjectionNode)}return hi.jsxs(TM.Provider,{value:k,children:[I&&k.visualElement?hi.jsx(I,{visualElement:k.visualElement,...z}):null,TZ(n,r,IZ(j,k.visualElement,C),j,N,e)]})}g.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const v=Ii.forwardRef(g);return v[RZ]=n,v}function zZ({layoutId:n}){const e=Ii.useContext(E4).id;return e&&n!==void 0?e+"-"+n:n}function OZ(n,e){Ii.useContext(_U).strict}function BZ(n){const{drag:e,layout:i}=tv;if(!e&&!i)return{};const l={...e,...i};return{MeasureLayout:e?.isEnabled(n)||i?.isEnabled(n)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function NZ(n,e){if(typeof Proxy>"u")return UA;const i=new Map,l=(g,v)=>UA(g,v,n,e),h=(g,v)=>l(g,v);return new Proxy(h,{get:(g,v)=>v==="create"?l:(i.has(v)||i.set(v,UA(v,void 0,n,e)),i.get(v))})}function IU({top:n,left:e,right:i,bottom:l}){return{x:{min:e,max:i},y:{min:n,max:l}}}function FZ({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function UZ(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),l=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:l.y,right:l.x}}function kA(n){return n===void 0||n===1}function JC({scale:n,scaleX:e,scaleY:i}){return!kA(n)||!kA(e)||!kA(i)}function ty(n){return JC(n)||DU(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function DU(n){return mO(n.x)||mO(n.y)}function mO(n){return n&&n!=="0%"}function E2(n,e,i){const l=n-i,h=e*l;return i+h}function gO(n,e,i,l,h){return h!==void 0&&(n=E2(n,h,l)),E2(n,i,l)+e}function QC(n,e=0,i=1,l,h){n.min=gO(n.min,e,i,l,h),n.max=gO(n.max,e,i,l,h)}function LU(n,{x:e,y:i}){QC(n.x,e.translate,e.scale,e.originPoint),QC(n.y,i.translate,i.scale,i.originPoint)}const _O=.999999999999,yO=1.0000000000001;function kZ(n,e,i,l=!1){const h=i.length;if(!h)return;e.x=e.y=1;let g,v;for(let r=0;r<h;r++){g=i[r],v=g.projectionDelta;const{visualElement:C}=g.options;C&&C.props.style&&C.props.style.display==="contents"||(l&&g.options.layoutScroll&&g.scroll&&g!==g.root&&Ux(n,{x:-g.scroll.offset.x,y:-g.scroll.offset.y}),v&&(e.x*=v.x.scale,e.y*=v.y.scale,LU(n,v)),l&&ty(g.latestValues)&&Ux(n,g.latestValues))}e.x<yO&&e.x>_O&&(e.x=1),e.y<yO&&e.y>_O&&(e.y=1)}function Fx(n,e){n.min=n.min+e,n.max=n.max+e}function xO(n,e,i,l,h=.5){const g=Qo(n.min,n.max,h);QC(n,e,i,g,l)}function Ux(n,e){xO(n.x,e.x,e.scaleX,e.scale,e.originX),xO(n.y,e.y,e.scaleY,e.scale,e.originY)}function PU(n,e){return IU(UZ(n.getBoundingClientRect(),e))}function VZ(n,e,i){const l=PU(n,i),{scroll:h}=e;return h&&(Fx(l.x,h.offset.x),Fx(l.y,h.offset.y)),l}const vO=()=>({translate:0,scale:1,origin:0,originPoint:0}),kx=()=>({x:vO(),y:vO()}),bO=()=>({min:0,max:0}),Nl=()=>({x:bO(),y:bO()}),eR={current:null},zU={current:!1};function GZ(){if(zU.current=!0,!!HR)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>eR.current=n.matches;n.addEventListener("change",e),e()}else eR.current=!1}const HZ=new WeakMap;function jZ(n,e,i){for(const l in e){const h=e[l],g=i[l];if(gh(h))n.addValue(l,h);else if(gh(g))n.addValue(l,ev(h,{owner:n}));else if(g!==h)if(n.hasValue(l)){const v=n.getValue(l);v.liveStyle===!0?v.jump(h):v.hasAnimated||v.set(h)}else{const v=n.getStaticValue(l);n.addValue(l,ev(v!==void 0?v:h,{owner:n}))}}for(const l in i)e[l]===void 0&&n.removeValue(l);return e}const wO=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qZ{scrapeMotionValuesFromProps(e,i,l){return{}}constructor({parent:e,props:i,presenceContext:l,reducedMotionConfig:h,blockInitialAnimation:g,visualState:v},r={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=oI,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const k=Wf.now();this.renderScheduledAt<k&&(this.renderScheduledAt=k,Go.render(this.render,!1,!0))};const{latestValues:C,renderState:I}=v;this.latestValues=C,this.baseTarget={...C},this.initialValues=i.initial?{...C}:{},this.renderState=I,this.parent=e,this.props=i,this.presenceContext=l,this.depth=e?e.depth+1:0,this.reducedMotionConfig=h,this.options=r,this.blockInitialAnimation=!!g,this.isControllingVariants=EM(i),this.isVariantNode=xU(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:z,...N}=this.scrapeMotionValuesFromProps(i,{},this);for(const k in N){const j=N[k];C[k]!==void 0&&gh(j)&&j.set(C[k])}}mount(e){this.current=e,HZ.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,l)=>this.bindToMotionValue(l,i)),zU.current||GZ(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:eR.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),J_(this.notifyUpdate),J_(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const l=_v.has(e);l&&this.onBindTransform&&this.onBindTransform();const h=i.on("change",v=>{this.latestValues[e]=v,this.props.onUpdate&&Go.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let g;window.MotionCheckAppearSync&&(g=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{h(),g&&g(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in tv){const i=tv[e];if(!i)continue;const{isEnabled:l,Feature:h}=i;if(!this.features[e]&&h&&l(this.props)&&(this.features[e]=new h(this)),this.features[e]){const g=this.features[e];g.isMounted?g.update():(g.mount(),g.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Nl()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let l=0;l<wO.length;l++){const h=wO[l];this.propEventSubscriptions[h]&&(this.propEventSubscriptions[h](),delete this.propEventSubscriptions[h]);const g="on"+h,v=e[g];v&&(this.propEventSubscriptions[h]=this.on(h,v))}this.prevMotionValues=jZ(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const l=this.values.get(e);i!==l&&(l&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let l=this.values.get(e);return l===void 0&&i!==void 0&&(l=ev(i===null?void 0:i,{owner:this}),this.addValue(e,l)),l}readValue(e,i){let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(A4(l)||R4(l))?l=parseFloat(l):!rZ(l)&&Q_.test(i)&&(l=uU(e,i)),this.setBaseTarget(e,gh(l)?l.get():l)),gh(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){const{initial:i}=this.props;let l;if(typeof i=="string"||typeof i=="object"){const g=_I(this.props,i,this.presenceContext?.custom);g&&(l=g[e])}if(i&&l!==void 0)return l;const h=this.getBaseTargetFromProps(this.props,e);return h!==void 0&&!gh(h)?h:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new YR),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}scheduleRenderMicrotask(){uI.render(this.render)}}class OU extends qZ{constructor(){super(...arguments),this.KeyframeResolver=qW}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:l}){delete i[e],delete l[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;gh(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function BU(n,{style:e,vars:i},l,h){const g=n.style;let v;for(v in e)g[v]=e[v];h?.applyProjectionStyles(g,l);for(v in i)g.setProperty(v,i[v])}function XZ(n){return window.getComputedStyle(n)}class WZ extends OU{constructor(){super(...arguments),this.type="html",this.renderInstance=BU}readValueFromInstance(e,i){if(_v.has(i))return this.projection?.isProjecting?qC(i):uW(e,i);{const l=XZ(e),h=(JR(i)?l.getPropertyValue(i):l[i])||0;return typeof h=="string"?h.trim():h}}measureInstanceViewportBox(e,{transformPagePoint:i}){return PU(e,i)}build(e,i,l){pI(e,i,l.transformTemplate)}scrapeMotionValuesFromProps(e,i,l){return yI(e,i,l)}}const NU=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function ZZ(n,e,i,l){BU(n,e,void 0,l);for(const h in e.attrs)n.setAttribute(NU.has(h)?h:xI(h),e.attrs[h])}class YZ extends OU{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Nl}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(_v.has(i)){const l=cU(i);return l&&l.default||0}return i=NU.has(i)?i:xI(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,l){return EU(e,i,l)}build(e,i,l){wU(e,i,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(e,i,l,h){ZZ(e,i,l,h)}mount(e){this.isSVGTag=TU(e.tagName),super.mount(e)}}const KZ=(n,e)=>gI(n)?new YZ(e):new WZ(e,{allowProjection:n!==Ii.Fragment});function Xx(n,e,i){const l=n.getProps();return _I(l,e,i!==void 0?i:l.custom,n)}const tR=n=>Array.isArray(n);function $Z(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,ev(i))}function JZ(n){return tR(n)?n[n.length-1]||0:n}function QZ(n,e){const i=Xx(n,e);let{transitionEnd:l={},transition:h={},...g}=i||{};g={...g,...l};for(const v in g){const r=JZ(g[v]);$Z(n,v,r)}}function eY(n){return!!(gh(n)&&n.add)}function iR(n,e){const i=n.getValue("willChange");if(eY(i))return i.add(e);if(!i&&t_.WillChange){const l=new t_.WillChange("auto");n.addValue("willChange",l),l.add(e)}}function FU(n){return n.props[AU]}const tY=n=>n!==null;function iY(n,{repeat:e,repeatType:i="loop"},l){const h=n.filter(tY),g=e&&i!=="loop"&&e%2===1?0:h.length-1;return h[g]}const nY={type:"spring",stiffness:500,damping:25,restSpeed:10},rY=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),sY={type:"keyframes",duration:.8},aY={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},oY=(n,{keyframes:e})=>e.length>2?sY:_v.has(n)?n.startsWith("scale")?rY(e[1]):nY:aY;function lY({when:n,delay:e,delayChildren:i,staggerChildren:l,staggerDirection:h,repeat:g,repeatType:v,repeatDelay:r,from:C,elapsed:I,...z}){return!!Object.keys(z).length}const vI=(n,e,i,l={},h,g)=>v=>{const r=lI(l,n)||{},C=r.delay||l.delay||0;let{elapsed:I=0}=l;I=I-ug(C);const z={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...r,delay:-I,onUpdate:k=>{e.set(k),r.onUpdate&&r.onUpdate(k)},onComplete:()=>{v(),r.onComplete&&r.onComplete()},name:n,motionValue:e,element:g?void 0:h};lY(r)||Object.assign(z,oY(n,z)),z.duration&&(z.duration=ug(z.duration)),z.repeatDelay&&(z.repeatDelay=ug(z.repeatDelay)),z.from!==void 0&&(z.keyframes[0]=z.from);let N=!1;if((z.type===!1||z.duration===0&&!z.repeatDelay)&&(KC(z),z.delay===0&&(N=!0)),(t_.instantAnimations||t_.skipAnimations)&&(N=!0,KC(z),z.delay=0),z.allowFlatten=!r.type&&!r.ease,N&&!g&&e.get()!==void 0){const k=iY(z.keyframes,r);if(k!==void 0){Go.update(()=>{z.onUpdate(k),z.onComplete()});return}}return r.isSync?new aI(z):new PW(z)};function cY({protectedKeys:n,needsAnimating:e},i){const l=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,l}function UU(n,e,{delay:i=0,transitionOverride:l,type:h}={}){let{transition:g=n.getDefaultTransition(),transitionEnd:v,...r}=e;l&&(g=l);const C=[],I=h&&n.animationState&&n.animationState.getState()[h];for(const z in r){const N=n.getValue(z,n.latestValues[z]??null),k=r[z];if(k===void 0||I&&cY(I,z))continue;const j={delay:i,...lI(g||{},z)},$=N.get();if($!==void 0&&!N.isAnimating&&!Array.isArray(k)&&k===$&&!j.velocity)continue;let re=!1;if(window.MotionHandoffAnimation){const Y=FU(n);if(Y){const ae=window.MotionHandoffAnimation(Y,z,Go);ae!==null&&(j.startTime=ae,re=!0)}}iR(n,z),N.start(vI(z,N,k,n.shouldReduceMotion&&aU.has(z)?{type:!1}:j,n,re));const ie=N.animation;ie&&C.push(ie)}return v&&Promise.all(C).then(()=>{Go.update(()=>{v&&QZ(n,v)})}),C}function kU(n,e,i,l=0,h=1){const g=Array.from(n).sort((I,z)=>I.sortNodePosition(z)).indexOf(e),v=n.size,r=(v-1)*l;return typeof i=="function"?i(g,v):h===1?g*l:r-g*l}function nR(n,e,i={}){const l=Xx(n,e,i.type==="exit"?n.presenceContext?.custom:void 0);let{transition:h=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(h=i.transitionOverride);const g=l?()=>Promise.all(UU(n,l,i)):()=>Promise.resolve(),v=n.variantChildren&&n.variantChildren.size?(C=0)=>{const{delayChildren:I=0,staggerChildren:z,staggerDirection:N}=h;return uY(n,e,C,I,z,N,i)}:()=>Promise.resolve(),{when:r}=h;if(r){const[C,I]=r==="beforeChildren"?[g,v]:[v,g];return C().then(()=>I())}else return Promise.all([g(),v(i.delay)])}function uY(n,e,i=0,l=0,h=0,g=1,v){const r=[];for(const C of n.variantChildren)C.notify("AnimationStart",e),r.push(nR(C,e,{...v,delay:i+(typeof l=="function"?0:l)+kU(n.variantChildren,C,l,h,g)}).then(()=>C.notify("AnimationComplete",e)));return Promise.all(r)}function hY(n,e,i={}){n.notify("AnimationStart",e);let l;if(Array.isArray(e)){const h=e.map(g=>nR(n,g,i));l=Promise.all(h)}else if(typeof e=="string")l=nR(n,e,i);else{const h=typeof e=="function"?Xx(n,e,i.custom):e;l=Promise.all(UU(n,h,i))}return l.then(()=>{n.notify("AnimationComplete",e)})}function VU(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let l=0;l<i;l++)if(e[l]!==n[l])return!1;return!0}const fY=dI.length;function GU(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?GU(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<fY;i++){const l=dI[i],h=n.props[l];(Lb(h)||h===!1)&&(e[l]=h)}return e}const dY=[...fI].reverse(),pY=fI.length;function mY(n){return e=>Promise.all(e.map(({animation:i,options:l})=>hY(n,i,l)))}function gY(n){let e=mY(n),i=SO(),l=!0;const h=C=>(I,z)=>{const N=Xx(n,z,C==="exit"?n.presenceContext?.custom:void 0);if(N){const{transition:k,transitionEnd:j,...$}=N;I={...I,...$,...j}}return I};function g(C){e=C(n)}function v(C){const{props:I}=n,z=GU(n.parent)||{},N=[],k=new Set;let j={},$=1/0;for(let ie=0;ie<pY;ie++){const Y=dY[ie],ae=i[Y],ue=I[Y]!==void 0?I[Y]:z[Y],me=Lb(ue),Ae=Y===C?ae.isActive:null;Ae===!1&&($=ie);let Se=ue===z[Y]&&ue!==I[Y]&&me;if(Se&&l&&n.manuallyAnimateOnMount&&(Se=!1),ae.protectedKeys={...j},!ae.isActive&&Ae===null||!ue&&!ae.prevProp||MM(ue)||typeof ue=="boolean")continue;const ze=_Y(ae.prevProp,ue);let je=ze||Y===C&&ae.isActive&&!Se&&me||ie>$&&me,Ce=!1;const Te=Array.isArray(ue)?ue:[ue];let Ze=Te.reduce(h(Y),{});Ae===!1&&(Ze={});const{prevResolvedValues:Mt={}}=ae,mt={...Mt,...Ze},Gt=Qe=>{je=!0,k.has(Qe)&&(Ce=!0,k.delete(Qe)),ae.needsAnimating[Qe]=!0;const et=n.getValue(Qe);et&&(et.liveStyle=!1)};for(const Qe in mt){const et=Ze[Qe],Lt=Mt[Qe];if(j.hasOwnProperty(Qe))continue;let jt=!1;tR(et)&&tR(Lt)?jt=!VU(et,Lt):jt=et!==Lt,jt?et!=null?Gt(Qe):k.add(Qe):et!==void 0&&k.has(Qe)?Gt(Qe):ae.protectedKeys[Qe]=!0}ae.prevProp=ue,ae.prevResolvedValues=Ze,ae.isActive&&(j={...j,...Ze}),l&&n.blockInitialAnimation&&(je=!1);const kt=Se&&ze;je&&(!kt||Ce)&&N.push(...Te.map(Qe=>{const et={type:Y};if(typeof Qe=="string"&&l&&!kt&&n.manuallyAnimateOnMount&&n.parent){const{parent:Lt}=n,jt=Xx(Lt,Qe);if(Lt.enteringChildren&&jt){const{delayChildren:Ge}=jt.transition||{};et.delay=kU(Lt.enteringChildren,n,Ge)}}return{animation:Qe,options:et}}))}if(k.size){const ie={};if(typeof I.initial!="boolean"){const Y=Xx(n,Array.isArray(I.initial)?I.initial[0]:I.initial);Y&&Y.transition&&(ie.transition=Y.transition)}k.forEach(Y=>{const ae=n.getBaseTarget(Y),ue=n.getValue(Y);ue&&(ue.liveStyle=!0),ie[Y]=ae??null}),N.push({animation:ie})}let re=!!N.length;return l&&(I.initial===!1||I.initial===I.animate)&&!n.manuallyAnimateOnMount&&(re=!1),l=!1,re?e(N):Promise.resolve()}function r(C,I){if(i[C].isActive===I)return Promise.resolve();n.variantChildren?.forEach(N=>N.animationState?.setActive(C,I)),i[C].isActive=I;const z=v(C);for(const N in i)i[N].protectedKeys={};return z}return{animateChanges:v,setActive:r,setAnimateFunction:g,getState:()=>i,reset:()=>{i=SO()}}}function _Y(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!VU(e,n):!1}function F0(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function SO(){return{animate:F0(!0),whileInView:F0(),whileHover:F0(),whileTap:F0(),whileDrag:F0(),whileFocus:F0(),exit:F0()}}class n0{constructor(e){this.isMounted=!1,this.node=e}update(){}}class yY extends n0{constructor(e){super(e),e.animationState||(e.animationState=gY(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();MM(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let xY=0;class vY extends n0{constructor(){super(...arguments),this.id=xY++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===l)return;const h=this.node.animationState.setActive("exit",!e);i&&!e&&h.then(()=>{i(this.id)})}mount(){const{register:e,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const bY={animation:{Feature:yY},exit:{Feature:vY}};function zb(n,e,i,l={passive:!0}){return n.addEventListener(e,i,l),()=>n.removeEventListener(e,i)}function lw(n){return{point:{x:n.pageX,y:n.pageY}}}const wY=n=>e=>hI(e)&&n(e,lw(e));function ob(n,e,i,l){return zb(n,e,wY(i),l)}const HU=1e-4,SY=1-HU,TY=1+HU,jU=.01,MY=0-jU,EY=0+jU;function Kh(n){return n.max-n.min}function AY(n,e,i){return Math.abs(n-e)<=i}function TO(n,e,i,l=.5){n.origin=l,n.originPoint=Qo(e.min,e.max,n.origin),n.scale=Kh(i)/Kh(e),n.translate=Qo(i.min,i.max,n.origin)-n.originPoint,(n.scale>=SY&&n.scale<=TY||isNaN(n.scale))&&(n.scale=1),(n.translate>=MY&&n.translate<=EY||isNaN(n.translate))&&(n.translate=0)}function lb(n,e,i,l){TO(n.x,e.x,i.x,l?l.originX:void 0),TO(n.y,e.y,i.y,l?l.originY:void 0)}function MO(n,e,i){n.min=i.min+e.min,n.max=n.min+Kh(e)}function CY(n,e,i){MO(n.x,e.x,i.x),MO(n.y,e.y,i.y)}function EO(n,e,i){n.min=e.min-i.min,n.max=n.min+Kh(e)}function cb(n,e,i){EO(n.x,e.x,i.x),EO(n.y,e.y,i.y)}function Ap(n){return[n("x"),n("y")]}const qU=({current:n})=>n?n.ownerDocument.defaultView:null,AO=(n,e)=>Math.abs(n-e);function RY(n,e){const i=AO(n.x,e.x),l=AO(n.y,e.y);return Math.sqrt(i**2+l**2)}class XU{constructor(e,i,{transformPagePoint:l,contextWindow:h=window,dragSnapToOrigin:g=!1,distanceThreshold:v=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const k=GA(this.lastMoveEventInfo,this.history),j=this.startEvent!==null,$=RY(k.offset,{x:0,y:0})>=this.distanceThreshold;if(!j&&!$)return;const{point:re}=k,{timestamp:ie}=zu;this.history.push({...re,timestamp:ie});const{onStart:Y,onMove:ae}=this.handlers;j||(Y&&Y(this.lastMoveEvent,k),this.startEvent=this.lastMoveEvent),ae&&ae(this.lastMoveEvent,k)},this.handlePointerMove=(k,j)=>{this.lastMoveEvent=k,this.lastMoveEventInfo=VA(j,this.transformPagePoint),Go.update(this.updatePoint,!0)},this.handlePointerUp=(k,j)=>{this.end();const{onEnd:$,onSessionEnd:re,resumeAnimation:ie}=this.handlers;if(this.dragSnapToOrigin&&ie&&ie(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Y=GA(k.type==="pointercancel"?this.lastMoveEventInfo:VA(j,this.transformPagePoint),this.history);this.startEvent&&$&&$(k,Y),re&&re(k,Y)},!hI(e))return;this.dragSnapToOrigin=g,this.handlers=i,this.transformPagePoint=l,this.distanceThreshold=v,this.contextWindow=h||window;const r=lw(e),C=VA(r,this.transformPagePoint),{point:I}=C,{timestamp:z}=zu;this.history=[{...I,timestamp:z}];const{onSessionStart:N}=i;N&&N(e,GA(C,this.history)),this.removeListeners=sw(ob(this.contextWindow,"pointermove",this.handlePointerMove),ob(this.contextWindow,"pointerup",this.handlePointerUp),ob(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),J_(this.updatePoint)}}function VA(n,e){return e?{point:e(n.point)}:n}function CO(n,e){return{x:n.x-e.x,y:n.y-e.y}}function GA({point:n},e){return{point:n,delta:CO(n,WU(e)),offset:CO(n,IY(e)),velocity:DY(e,.1)}}function IY(n){return n[0]}function WU(n){return n[n.length-1]}function DY(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,l=null;const h=WU(n);for(;i>=0&&(l=n[i],!(h.timestamp-l.timestamp>ug(e)));)i--;if(!l)return{x:0,y:0};const g=Rp(h.timestamp-l.timestamp);if(g===0)return{x:0,y:0};const v={x:(h.x-l.x)/g,y:(h.y-l.y)/g};return v.x===1/0&&(v.x=0),v.y===1/0&&(v.y=0),v}function LY(n,{min:e,max:i},l){return e!==void 0&&n<e?n=l?Qo(e,n,l.min):Math.max(n,e):i!==void 0&&n>i&&(n=l?Qo(i,n,l.max):Math.min(n,i)),n}function RO(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function PY(n,{top:e,left:i,bottom:l,right:h}){return{x:RO(n.x,i,h),y:RO(n.y,e,l)}}function IO(n,e){let i=e.min-n.min,l=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,l]=[l,i]),{min:i,max:l}}function zY(n,e){return{x:IO(n.x,e.x),y:IO(n.y,e.y)}}function OY(n,e){let i=.5;const l=Kh(n),h=Kh(e);return h>l?i=Rb(e.min,e.max-l,n.min):l>h&&(i=Rb(n.min,n.max-h,e.min)),e_(0,1,i)}function BY(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const rR=.35;function NY(n=rR){return n===!1?n=0:n===!0&&(n=rR),{x:DO(n,"left","right"),y:DO(n,"top","bottom")}}function DO(n,e,i){return{min:LO(n,e),max:LO(n,i)}}function LO(n,e){return typeof n=="number"?n:n[e]||0}const FY=new WeakMap;class UY{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Nl(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:i=!1,distanceThreshold:l}={}){const{presenceContext:h}=this.visualElement;if(h&&h.isPresent===!1)return;const g=N=>{const{dragSnapToOrigin:k}=this.getProps();k?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(lw(N).point)},v=(N,k)=>{const{drag:j,dragPropagation:$,onDragStart:re}=this.getProps();if(j&&!$&&(this.openDragLock&&this.openDragLock(),this.openDragLock=KW(j),!this.openDragLock))return;this.latestPointerEvent=N,this.latestPanInfo=k,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ap(Y=>{let ae=this.getAxisMotionValue(Y).get()||0;if(hg.test(ae)){const{projection:ue}=this.visualElement;if(ue&&ue.layout){const me=ue.layout.layoutBox[Y];me&&(ae=Kh(me)*(parseFloat(ae)/100))}}this.originPoint[Y]=ae}),re&&Go.postRender(()=>re(N,k)),iR(this.visualElement,"transform");const{animationState:ie}=this.visualElement;ie&&ie.setActive("whileDrag",!0)},r=(N,k)=>{this.latestPointerEvent=N,this.latestPanInfo=k;const{dragPropagation:j,dragDirectionLock:$,onDirectionLock:re,onDrag:ie}=this.getProps();if(!j&&!this.openDragLock)return;const{offset:Y}=k;if($&&this.currentDirection===null){this.currentDirection=kY(Y),this.currentDirection!==null&&re&&re(this.currentDirection);return}this.updateAxis("x",k.point,Y),this.updateAxis("y",k.point,Y),this.visualElement.render(),ie&&ie(N,k)},C=(N,k)=>{this.latestPointerEvent=N,this.latestPanInfo=k,this.stop(N,k),this.latestPointerEvent=null,this.latestPanInfo=null},I=()=>Ap(N=>this.getAnimationState(N)==="paused"&&this.getAxisMotionValue(N).animation?.play()),{dragSnapToOrigin:z}=this.getProps();this.panSession=new XU(e,{onSessionStart:g,onStart:v,onMove:r,onSessionEnd:C,resumeAnimation:I},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:z,distanceThreshold:l,contextWindow:qU(this.visualElement)})}stop(e,i){const l=e||this.latestPointerEvent,h=i||this.latestPanInfo,g=this.isDragging;if(this.cancel(),!g||!h||!l)return;const{velocity:v}=h;this.startAnimation(v);const{onDragEnd:r}=this.getProps();r&&Go.postRender(()=>r(l,h))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,l){const{drag:h}=this.getProps();if(!l||!OS(e,h,this.currentDirection))return;const g=this.getAxisMotionValue(e);let v=this.originPoint[e]+l[e];this.constraints&&this.constraints[e]&&(v=LY(v,this.constraints[e],this.elastic[e])),g.set(v)}resolveConstraints(){const{dragConstraints:e,dragElastic:i}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,h=this.constraints;e&&Nx(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&l?this.constraints=PY(l.layoutBox,e):this.constraints=!1,this.elastic=NY(i),h!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Ap(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=BY(l.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!Nx(e))return!1;const l=e.current,{projection:h}=this.visualElement;if(!h||!h.layout)return!1;const g=VZ(l,h.root,this.visualElement.getTransformPagePoint());let v=zY(h.layout.layoutBox,g);if(i){const r=i(FZ(v));this.hasMutatedConstraints=!!r,r&&(v=IU(r))}return v}startAnimation(e){const{drag:i,dragMomentum:l,dragElastic:h,dragTransition:g,dragSnapToOrigin:v,onDragTransitionEnd:r}=this.getProps(),C=this.constraints||{},I=Ap(z=>{if(!OS(z,i,this.currentDirection))return;let N=C&&C[z]||{};v&&(N={min:0,max:0});const k=h?200:1e6,j=h?40:1e7,$={type:"inertia",velocity:l?e[z]:0,bounceStiffness:k,bounceDamping:j,timeConstant:750,restDelta:1,restSpeed:10,...g,...N};return this.startAxisValueAnimation(z,$)});return Promise.all(I).then(r)}startAxisValueAnimation(e,i){const l=this.getAxisMotionValue(e);return iR(this.visualElement,e),l.start(vI(e,l,0,i,this.visualElement,!1))}stopAnimation(){Ap(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Ap(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,l=this.visualElement.getProps(),h=l[i];return h||this.visualElement.getValue(e,(l.initial?l.initial[e]:void 0)||0)}snapToCursor(e){Ap(i=>{const{drag:l}=this.getProps();if(!OS(i,l,this.currentDirection))return;const{projection:h}=this.visualElement,g=this.getAxisMotionValue(i);if(h&&h.layout){const{min:v,max:r}=h.layout.layoutBox[i];g.set(e[i]-Qo(v,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:l}=this.visualElement;if(!Nx(i)||!l||!this.constraints)return;this.stopAnimation();const h={x:0,y:0};Ap(v=>{const r=this.getAxisMotionValue(v);if(r&&this.constraints!==!1){const C=r.get();h[v]=OY({min:C,max:C},this.constraints[v])}});const{transformTemplate:g}=this.visualElement.getProps();this.visualElement.current.style.transform=g?g({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),Ap(v=>{if(!OS(v,e,null))return;const r=this.getAxisMotionValue(v),{min:C,max:I}=this.constraints[v];r.set(Qo(C,I,h[v]))})}addListeners(){if(!this.visualElement.current)return;FY.set(this.visualElement,this);const e=this.visualElement.current,i=ob(e,"pointerdown",C=>{const{drag:I,dragListener:z=!0}=this.getProps();I&&z&&this.start(C)}),l=()=>{const{dragConstraints:C}=this.getProps();Nx(C)&&C.current&&(this.constraints=this.resolveRefConstraints())},{projection:h}=this.visualElement,g=h.addEventListener("measure",l);h&&!h.layout&&(h.root&&h.root.updateScroll(),h.updateLayout()),Go.read(l);const v=zb(window,"resize",()=>this.scalePositionWithinConstraints()),r=h.addEventListener("didUpdate",(({delta:C,hasLayoutChanged:I})=>{this.isDragging&&I&&(Ap(z=>{const N=this.getAxisMotionValue(z);N&&(this.originPoint[z]+=C[z].translate,N.set(N.get()+C[z].translate))}),this.visualElement.render())}));return()=>{v(),i(),g(),r&&r()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:l=!1,dragPropagation:h=!1,dragConstraints:g=!1,dragElastic:v=rR,dragMomentum:r=!0}=e;return{...e,drag:i,dragDirectionLock:l,dragPropagation:h,dragConstraints:g,dragElastic:v,dragMomentum:r}}}function OS(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function kY(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class VY extends n0{constructor(e){super(e),this.removeGroupControls=Ip,this.removeListeners=Ip,this.controls=new UY(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ip}unmount(){this.removeGroupControls(),this.removeListeners()}}const PO=n=>(e,i)=>{n&&Go.postRender(()=>n(e,i))};class GY extends n0{constructor(){super(...arguments),this.removePointerDownListener=Ip}onPointerDown(e){this.session=new XU(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:qU(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:l,onPanEnd:h}=this.node.getProps();return{onSessionStart:PO(e),onStart:PO(i),onMove:l,onEnd:(g,v)=>{delete this.session,h&&Go.postRender(()=>h(g,v))}}}mount(){this.removePointerDownListener=ob(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const FT={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function zO(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const C1={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(ds.test(n))n=parseFloat(n);else return n;const i=zO(n,e.target.x),l=zO(n,e.target.y);return`${i}% ${l}%`}},HY={correct:(n,{treeScale:e,projectionDelta:i})=>{const l=n,h=Q_.parse(n);if(h.length>5)return l;const g=Q_.createTransformer(n),v=typeof h[0]!="number"?1:0,r=i.x.scale*e.x,C=i.y.scale*e.y;h[0+v]/=r,h[1+v]/=C;const I=Qo(r,C,.5);return typeof h[2+v]=="number"&&(h[2+v]/=I),typeof h[3+v]=="number"&&(h[3+v]/=I),g(h)}};let HA=!1;class jY extends Ii.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:l,layoutId:h}=this.props,{projection:g}=e;fZ(qY),g&&(i.group&&i.group.add(g),l&&l.register&&h&&l.register(g),HA&&g.root.didUpdate(),g.addEventListener("animationComplete",()=>{this.safeToRemove()}),g.setOptions({...g.options,onExitComplete:()=>this.safeToRemove()})),FT.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:l,drag:h,isPresent:g}=this.props,{projection:v}=l;return v&&(v.isPresent=g,HA=!0,h||e.layoutDependency!==i||i===void 0||e.isPresent!==g?v.willUpdate():this.safeToRemove(),e.isPresent!==g&&(g?v.promote():v.relegate()||Go.postRender(()=>{const r=v.getStack();(!r||!r.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),uI.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:l}=this.props,{projection:h}=e;HA=!0,h&&(h.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(h),l&&l.deregister&&l.deregister(h))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ZU(n){const[e,i]=sZ(),l=Ii.useContext(E4);return hi.jsx(jY,{...n,layoutGroup:l,switchLayoutGroup:Ii.useContext(CU),isPresent:e,safeToRemove:i})}const qY={borderRadius:{...C1,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:C1,borderTopRightRadius:C1,borderBottomLeftRadius:C1,borderBottomRightRadius:C1,boxShadow:HY};function XY(n,e,i){const l=gh(n)?n:ev(n);return l.start(vI("",l,e,i)),l.animation}const WY=(n,e)=>n.depth-e.depth;class ZY{constructor(){this.children=[],this.isDirty=!1}add(e){qR(this.children,e),this.isDirty=!0}remove(e){XR(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(WY),this.isDirty=!1,this.children.forEach(e)}}function YY(n,e){const i=Wf.now(),l=({timestamp:h})=>{const g=h-i;g>=e&&(J_(l),n(g-e))};return Go.setup(l,!0),()=>J_(l)}const YU=["TopLeft","TopRight","BottomLeft","BottomRight"],KY=YU.length,OO=n=>typeof n=="string"?parseFloat(n):n,BO=n=>typeof n=="number"||ds.test(n);function $Y(n,e,i,l,h,g){h?(n.opacity=Qo(0,i.opacity??1,JY(l)),n.opacityExit=Qo(e.opacity??1,0,QY(l))):g&&(n.opacity=Qo(e.opacity??1,i.opacity??1,l));for(let v=0;v<KY;v++){const r=`border${YU[v]}Radius`;let C=NO(e,r),I=NO(i,r);if(C===void 0&&I===void 0)continue;C||(C=0),I||(I=0),C===0||I===0||BO(C)===BO(I)?(n[r]=Math.max(Qo(OO(C),OO(I),l),0),(hg.test(I)||hg.test(C))&&(n[r]+="%")):n[r]=I}(e.rotate||i.rotate)&&(n.rotate=Qo(e.rotate||0,i.rotate||0,l))}function NO(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const JY=KU(0,.5,N4),QY=KU(.5,.95,Ip);function KU(n,e,i){return l=>l<n?0:l>e?1:i(Rb(n,e,l))}function FO(n,e){n.min=e.min,n.max=e.max}function Sp(n,e){FO(n.x,e.x),FO(n.y,e.y)}function UO(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function kO(n,e,i,l,h){return n-=e,n=E2(n,1/i,l),h!==void 0&&(n=E2(n,1/h,l)),n}function eK(n,e=0,i=1,l=.5,h,g=n,v=n){if(hg.test(e)&&(e=parseFloat(e),e=Qo(v.min,v.max,e/100)-v.min),typeof e!="number")return;let r=Qo(g.min,g.max,l);n===g&&(r-=e),n.min=kO(n.min,e,i,r,h),n.max=kO(n.max,e,i,r,h)}function VO(n,e,[i,l,h],g,v){eK(n,e[i],e[l],e[h],e.scale,g,v)}const tK=["x","scaleX","originX"],iK=["y","scaleY","originY"];function GO(n,e,i,l){VO(n.x,e,tK,i?i.x:void 0,l?l.x:void 0),VO(n.y,e,iK,i?i.y:void 0,l?l.y:void 0)}function HO(n){return n.translate===0&&n.scale===1}function $U(n){return HO(n.x)&&HO(n.y)}function jO(n,e){return n.min===e.min&&n.max===e.max}function nK(n,e){return jO(n.x,e.x)&&jO(n.y,e.y)}function qO(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function JU(n,e){return qO(n.x,e.x)&&qO(n.y,e.y)}function XO(n){return Kh(n.x)/Kh(n.y)}function WO(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class rK{constructor(){this.members=[]}add(e){qR(this.members,e),e.scheduleRender()}remove(e){if(XR(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(h=>e===h);if(i===0)return!1;let l;for(let h=i;h>=0;h--){const g=this.members[h];if(g.isPresent!==!1){l=g;break}}return l?(this.promote(l),!0):!1}promote(e,i){const l=this.lead;if(e!==l&&(this.prevLead=l,this.lead=e,e.show(),l)){l.instance&&l.scheduleRender(),e.scheduleRender(),e.resumeFrom=l,i&&(e.resumeFrom.preserveOpacity=!0),l.snapshot&&(e.snapshot=l.snapshot,e.snapshot.latestValues=l.animationValues||l.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:h}=e.options;h===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:l}=e;i.onExitComplete&&i.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function sK(n,e,i){let l="";const h=n.x.translate/e.x,g=n.y.translate/e.y,v=i?.z||0;if((h||g||v)&&(l=`translate3d(${h}px, ${g}px, ${v}px) `),(e.x!==1||e.y!==1)&&(l+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:I,rotate:z,rotateX:N,rotateY:k,skewX:j,skewY:$}=i;I&&(l=`perspective(${I}px) ${l}`),z&&(l+=`rotate(${z}deg) `),N&&(l+=`rotateX(${N}deg) `),k&&(l+=`rotateY(${k}deg) `),j&&(l+=`skewX(${j}deg) `),$&&(l+=`skewY(${$}deg) `)}const r=n.x.scale*e.x,C=n.y.scale*e.y;return(r!==1||C!==1)&&(l+=`scale(${r}, ${C})`),l||"none"}const jA=["","X","Y","Z"],aK=1e3;let oK=0;function qA(n,e,i,l){const{latestValues:h}=e;h[n]&&(i[n]=h[n],e.setStaticValue(n,0),l&&(l[n]=0))}function QU(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=FU(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:h,layoutId:g}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",Go,!(h||g))}const{parent:l}=n;l&&!l.hasCheckedOptimisedAppear&&QU(l)}function e5({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:l,resetTransform:h}){return class{constructor(v={},r=e?.()){this.id=oK++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(uK),this.nodes.forEach(pK),this.nodes.forEach(mK),this.nodes.forEach(hK)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=v,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let C=0;C<this.path.length;C++)this.path[C].shouldResetTransform=!0;this.root===this&&(this.nodes=new ZY)}addEventListener(v,r){return this.eventHandlers.has(v)||this.eventHandlers.set(v,new YR),this.eventHandlers.get(v).add(r)}notifyListeners(v,...r){const C=this.eventHandlers.get(v);C&&C.notify(...r)}hasListeners(v){return this.eventHandlers.has(v)}mount(v){if(this.instance)return;this.isSVG=mU(v)&&!iZ(v),this.instance=v;const{layoutId:r,layout:C,visualElement:I}=this.options;if(I&&!I.current&&I.mount(v),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(C||r)&&(this.isLayoutDirty=!0),n){let z,N=0;const k=()=>this.root.updateBlockedByResize=!1;Go.read(()=>{N=window.innerWidth}),n(v,()=>{const j=window.innerWidth;j!==N&&(N=j,this.root.updateBlockedByResize=!0,z&&z(),z=YY(k,250),FT.hasAnimatedSinceResize&&(FT.hasAnimatedSinceResize=!1,this.nodes.forEach(KO)))})}r&&this.root.registerSharedNode(r,this),this.options.animate!==!1&&I&&(r||C)&&this.addEventListener("didUpdate",({delta:z,hasLayoutChanged:N,hasRelativeLayoutChanged:k,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const $=this.options.transition||I.getDefaultTransition()||vK,{onLayoutAnimationStart:re,onLayoutAnimationComplete:ie}=I.getProps(),Y=!this.targetLayout||!JU(this.targetLayout,j),ae=!N&&k;if(this.options.layoutRoot||this.resumeFrom||ae||N&&(Y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ue={...lI($,"layout"),onPlay:re,onComplete:ie};(I.shouldReduceMotion||this.options.layoutRoot)&&(ue.delay=0,ue.type=!1),this.startAnimation(ue),this.setAnimationOrigin(z,ae)}else N||KO(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const v=this.getStack();v&&v.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),J_(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(gK),this.animationId++)}getTransformTemplate(){const{visualElement:v}=this.options;return v&&v.getProps().transformTemplate}willUpdate(v=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&QU(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let z=0;z<this.path.length;z++){const N=this.path[z];N.shouldResetTransform=!0,N.updateScroll("snapshot"),N.options.layoutRoot&&N.willUpdate(!1)}const{layoutId:r,layout:C}=this.options;if(r===void 0&&!C)return;const I=this.getTransformTemplate();this.prevTransformTemplateValue=I?I(this.latestValues,""):void 0,this.updateSnapshot(),v&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(ZO);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(YO);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(dK),this.nodes.forEach(lK),this.nodes.forEach(cK)):this.nodes.forEach(YO),this.clearAllSnapshots();const r=Wf.now();zu.delta=e_(0,1e3/60,r-zu.timestamp),zu.timestamp=r,zu.isProcessing=!0,PA.update.process(zu),PA.preRender.process(zu),PA.render.process(zu),zu.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,uI.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(fK),this.sharedNodes.forEach(_K)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Go.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Go.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Kh(this.snapshot.measuredBox.x)&&!Kh(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let C=0;C<this.path.length;C++)this.path[C].updateScroll();const v=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Nl(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:r}=this.options;r&&r.notify("LayoutMeasure",this.layout.layoutBox,v?v.layoutBox:void 0)}updateScroll(v="measure"){let r=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===v&&(r=!1),r&&this.instance){const C=l(this.instance);this.scroll={animationId:this.root.animationId,phase:v,isRoot:C,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:C}}}resetTransform(){if(!h)return;const v=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,r=this.projectionDelta&&!$U(this.projectionDelta),C=this.getTransformTemplate(),I=C?C(this.latestValues,""):void 0,z=I!==this.prevTransformTemplateValue;v&&this.instance&&(r||ty(this.latestValues)||z)&&(h(this.instance,I),this.shouldResetTransform=!1,this.scheduleRender())}measure(v=!0){const r=this.measurePageBox();let C=this.removeElementScroll(r);return v&&(C=this.removeTransform(C)),bK(C),{animationId:this.root.animationId,measuredBox:r,layoutBox:C,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:v}=this.options;if(!v)return Nl();const r=v.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(wK))){const{scroll:I}=this.root;I&&(Fx(r.x,I.offset.x),Fx(r.y,I.offset.y))}return r}removeElementScroll(v){const r=Nl();if(Sp(r,v),this.scroll?.wasRoot)return r;for(let C=0;C<this.path.length;C++){const I=this.path[C],{scroll:z,options:N}=I;I!==this.root&&z&&N.layoutScroll&&(z.wasRoot&&Sp(r,v),Fx(r.x,z.offset.x),Fx(r.y,z.offset.y))}return r}applyTransform(v,r=!1){const C=Nl();Sp(C,v);for(let I=0;I<this.path.length;I++){const z=this.path[I];!r&&z.options.layoutScroll&&z.scroll&&z!==z.root&&Ux(C,{x:-z.scroll.offset.x,y:-z.scroll.offset.y}),ty(z.latestValues)&&Ux(C,z.latestValues)}return ty(this.latestValues)&&Ux(C,this.latestValues),C}removeTransform(v){const r=Nl();Sp(r,v);for(let C=0;C<this.path.length;C++){const I=this.path[C];if(!I.instance||!ty(I.latestValues))continue;JC(I.latestValues)&&I.updateSnapshot();const z=Nl(),N=I.measurePageBox();Sp(z,N),GO(r,I.latestValues,I.snapshot?I.snapshot.layoutBox:void 0,z)}return ty(this.latestValues)&&GO(r,this.latestValues),r}setTargetDelta(v){this.targetDelta=v,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(v){this.options={...this.options,...v,crossfade:v.crossfade!==void 0?v.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==zu.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(v=!1){const r=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=r.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=r.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=r.isSharedProjectionDirty);const C=!!this.resumingFrom||this!==r;if(!(v||C&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:z,layoutId:N}=this.options;if(!(!this.layout||!(z||N))){if(this.resolvedRelativeTargetAt=zu.timestamp,!this.targetDelta&&!this.relativeTarget){const k=this.getClosestProjectingParent();k&&k.layout&&this.animationProgress!==1?(this.relativeParent=k,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Nl(),this.relativeTargetOrigin=Nl(),cb(this.relativeTargetOrigin,this.layout.layoutBox,k.layout.layoutBox),Sp(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Nl(),this.targetWithTransforms=Nl()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),CY(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Sp(this.target,this.layout.layoutBox),LU(this.target,this.targetDelta)):Sp(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const k=this.getClosestProjectingParent();k&&!!k.resumingFrom==!!this.resumingFrom&&!k.options.layoutScroll&&k.target&&this.animationProgress!==1?(this.relativeParent=k,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Nl(),this.relativeTargetOrigin=Nl(),cb(this.relativeTargetOrigin,this.target,k.target),Sp(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||JC(this.parent.latestValues)||DU(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const v=this.getLead(),r=!!this.resumingFrom||this!==v;let C=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(C=!1),r&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(C=!1),this.resolvedRelativeTargetAt===zu.timestamp&&(C=!1),C)return;const{layout:I,layoutId:z}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(I||z))return;Sp(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,k=this.treeScale.y;kZ(this.layoutCorrected,this.treeScale,this.path,r),v.layout&&!v.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(v.target=v.layout.layoutBox,v.targetWithTransforms=Nl());const{target:j}=v;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(UO(this.prevProjectionDelta.x,this.projectionDelta.x),UO(this.prevProjectionDelta.y,this.projectionDelta.y)),lb(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==k||!WO(this.projectionDelta.x,this.prevProjectionDelta.x)||!WO(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(v=!0){if(this.options.visualElement?.scheduleRender(),v){const r=this.getStack();r&&r.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=kx(),this.projectionDelta=kx(),this.projectionDeltaWithTransform=kx()}setAnimationOrigin(v,r=!1){const C=this.snapshot,I=C?C.latestValues:{},z={...this.latestValues},N=kx();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!r;const k=Nl(),j=C?C.source:void 0,$=this.layout?this.layout.source:void 0,re=j!==$,ie=this.getStack(),Y=!ie||ie.members.length<=1,ae=!!(re&&!Y&&this.options.crossfade===!0&&!this.path.some(xK));this.animationProgress=0;let ue;this.mixTargetDelta=me=>{const Ae=me/1e3;$O(N.x,v.x,Ae),$O(N.y,v.y,Ae),this.setTargetDelta(N),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(cb(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),yK(this.relativeTarget,this.relativeTargetOrigin,k,Ae),ue&&nK(this.relativeTarget,ue)&&(this.isProjectionDirty=!1),ue||(ue=Nl()),Sp(ue,this.relativeTarget)),re&&(this.animationValues=z,$Y(z,I,this.latestValues,Ae,ae,Y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ae},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(v){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(J_(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Go.update(()=>{FT.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ev(0)),this.currentAnimation=XY(this.motionValue,[0,1e3],{...v,velocity:0,isSync:!0,onUpdate:r=>{this.mixTargetDelta(r),v.onUpdate&&v.onUpdate(r)},onStop:()=>{},onComplete:()=>{v.onComplete&&v.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const v=this.getStack();v&&v.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(aK),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const v=this.getLead();let{targetWithTransforms:r,target:C,layout:I,latestValues:z}=v;if(!(!r||!C||!I)){if(this!==v&&this.layout&&I&&t5(this.options.animationType,this.layout.layoutBox,I.layoutBox)){C=this.target||Nl();const N=Kh(this.layout.layoutBox.x);C.x.min=v.target.x.min,C.x.max=C.x.min+N;const k=Kh(this.layout.layoutBox.y);C.y.min=v.target.y.min,C.y.max=C.y.min+k}Sp(r,C),Ux(r,z),lb(this.projectionDeltaWithTransform,this.layoutCorrected,r,z)}}registerSharedNode(v,r){this.sharedNodes.has(v)||this.sharedNodes.set(v,new rK),this.sharedNodes.get(v).add(r);const I=r.options.initialPromotionConfig;r.promote({transition:I?I.transition:void 0,preserveFollowOpacity:I&&I.shouldPreserveFollowOpacity?I.shouldPreserveFollowOpacity(r):void 0})}isLead(){const v=this.getStack();return v?v.lead===this:!0}getLead(){const{layoutId:v}=this.options;return v?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:v}=this.options;return v?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:v}=this.options;if(v)return this.root.sharedNodes.get(v)}promote({needsReset:v,transition:r,preserveFollowOpacity:C}={}){const I=this.getStack();I&&I.promote(this,C),v&&(this.projectionDelta=void 0,this.needsReset=!0),r&&this.setOptions({transition:r})}relegate(){const v=this.getStack();return v?v.relegate(this):!1}resetSkewAndRotation(){const{visualElement:v}=this.options;if(!v)return;let r=!1;const{latestValues:C}=v;if((C.z||C.rotate||C.rotateX||C.rotateY||C.rotateZ||C.skewX||C.skewY)&&(r=!0),!r)return;const I={};C.z&&qA("z",v,I,this.animationValues);for(let z=0;z<jA.length;z++)qA(`rotate${jA[z]}`,v,I,this.animationValues),qA(`skew${jA[z]}`,v,I,this.animationValues);v.render();for(const z in I)v.setStaticValue(z,I[z]),this.animationValues&&(this.animationValues[z]=I[z]);v.scheduleRender()}applyProjectionStyles(v,r){if(!this.instance||this.isSVG)return;if(!this.isVisible){v.visibility="hidden";return}const C=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,v.visibility="",v.opacity="",v.pointerEvents=NT(r?.pointerEvents)||"",v.transform=C?C(this.latestValues,""):"none";return}const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=NT(r?.pointerEvents)||""),this.hasProjected&&!ty(this.latestValues)&&(v.transform=C?C({},""):"none",this.hasProjected=!1);return}v.visibility="";const z=I.animationValues||I.latestValues;this.applyTransformsToTarget();let N=sK(this.projectionDeltaWithTransform,this.treeScale,z);C&&(N=C(z,N)),v.transform=N;const{x:k,y:j}=this.projectionDelta;v.transformOrigin=`${k.origin*100}% ${j.origin*100}% 0`,I.animationValues?v.opacity=I===this?z.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:z.opacityExit:v.opacity=I===this?z.opacity!==void 0?z.opacity:"":z.opacityExit!==void 0?z.opacityExit:0;for(const $ in Pb){if(z[$]===void 0)continue;const{correct:re,applyTo:ie,isCSSVariable:Y}=Pb[$],ae=N==="none"?z[$]:re(z[$],I);if(ie){const ue=ie.length;for(let me=0;me<ue;me++)v[ie[me]]=ae}else Y?this.options.visualElement.renderState.vars[$]=ae:v[$]=ae}this.options.layoutId&&(v.pointerEvents=I===this?NT(r?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(v=>v.currentAnimation?.stop()),this.root.nodes.forEach(ZO),this.root.sharedNodes.clear()}}}function lK(n){n.updateLayout()}function cK(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:l}=n.layout,{animationType:h}=n.options,g=e.source!==n.layout.source;h==="size"?Ap(z=>{const N=g?e.measuredBox[z]:e.layoutBox[z],k=Kh(N);N.min=i[z].min,N.max=N.min+k}):t5(h,e.layoutBox,i)&&Ap(z=>{const N=g?e.measuredBox[z]:e.layoutBox[z],k=Kh(i[z]);N.max=N.min+k,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[z].max=n.relativeTarget[z].min+k)});const v=kx();lb(v,i,e.layoutBox);const r=kx();g?lb(r,n.applyTransform(l,!0),e.measuredBox):lb(r,i,e.layoutBox);const C=!$U(v);let I=!1;if(!n.resumeFrom){const z=n.getClosestProjectingParent();if(z&&!z.resumeFrom){const{snapshot:N,layout:k}=z;if(N&&k){const j=Nl();cb(j,e.layoutBox,N.layoutBox);const $=Nl();cb($,i,k.layoutBox),JU(j,$)||(I=!0),z.options.layoutRoot&&(n.relativeTarget=$,n.relativeTargetOrigin=j,n.relativeParent=z)}}}n.notifyListeners("didUpdate",{layout:i,snapshot:e,delta:r,layoutDelta:v,hasLayoutChanged:C,hasRelativeLayoutChanged:I})}else if(n.isLead()){const{onExitComplete:i}=n.options;i&&i()}n.options.transition=void 0}function uK(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function hK(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function fK(n){n.clearSnapshot()}function ZO(n){n.clearMeasurements()}function YO(n){n.isLayoutDirty=!1}function dK(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function KO(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function pK(n){n.resolveTargetDelta()}function mK(n){n.calcProjection()}function gK(n){n.resetSkewAndRotation()}function _K(n){n.removeLeadSnapshot()}function $O(n,e,i){n.translate=Qo(e.translate,0,i),n.scale=Qo(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function JO(n,e,i,l){n.min=Qo(e.min,i.min,l),n.max=Qo(e.max,i.max,l)}function yK(n,e,i,l){JO(n.x,e.x,i.x,l),JO(n.y,e.y,i.y,l)}function xK(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const vK={duration:.45,ease:[.4,0,.1,1]},QO=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),eB=QO("applewebkit/")&&!QO("chrome/")?Math.round:Ip;function tB(n){n.min=eB(n.min),n.max=eB(n.max)}function bK(n){tB(n.x),tB(n.y)}function t5(n,e,i){return n==="position"||n==="preserve-aspect"&&!AY(XO(e),XO(i),.2)}function wK(n){return n!==n.root&&n.scroll?.wasRoot}const SK=e5({attachResizeListener:(n,e)=>zb(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),XA={current:void 0},i5=e5({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!XA.current){const n=new SK({});n.mount(window),n.setOptions({layoutScroll:!0}),XA.current=n}return XA.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),TK={pan:{Feature:GY},drag:{Feature:VY,ProjectionNode:i5,MeasureLayout:ZU}};function iB(n,e,i){const{props:l}=n;n.animationState&&l.whileHover&&n.animationState.setActive("whileHover",i==="Start");const h="onHover"+i,g=l[h];g&&Go.postRender(()=>g(e,lw(e)))}class MK extends n0{mount(){const{current:e}=this.node;e&&(this.unmount=$W(e,(i,l)=>(iB(this.node,l,"Start"),h=>iB(this.node,h,"End"))))}unmount(){}}class EK extends n0{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=sw(zb(this.node.current,"focus",()=>this.onFocus()),zb(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function nB(n,e,i){const{props:l}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&l.whileTap&&n.animationState.setActive("whileTap",i==="Start");const h="onTap"+(i==="End"?"":i),g=l[h];g&&Go.postRender(()=>g(e,lw(e)))}class AK extends n0{mount(){const{current:e}=this.node;e&&(this.unmount=tZ(e,(i,l)=>(nB(this.node,l,"Start"),(h,{success:g})=>nB(this.node,h,g?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const sR=new WeakMap,WA=new WeakMap,CK=n=>{const e=sR.get(n.target);e&&e(n)},RK=n=>{n.forEach(CK)};function IK({root:n,...e}){const i=n||document;WA.has(i)||WA.set(i,{});const l=WA.get(i),h=JSON.stringify(e);return l[h]||(l[h]=new IntersectionObserver(RK,{root:n,...e})),l[h]}function DK(n,e,i){const l=IK(e);return sR.set(n,i),l.observe(n),()=>{sR.delete(n),l.unobserve(n)}}const LK={some:0,all:1};class PK extends n0{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:l,amount:h="some",once:g}=e,v={root:i?i.current:void 0,rootMargin:l,threshold:typeof h=="number"?h:LK[h]},r=C=>{const{isIntersecting:I}=C;if(this.isInView===I||(this.isInView=I,g&&!I&&this.hasEnteredView))return;I&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",I);const{onViewportEnter:z,onViewportLeave:N}=this.node.getProps(),k=I?z:N;k&&k(C)};return DK(this.node.current,v,r)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(zK(e,i))&&this.startObserver()}unmount(){}}function zK({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const OK={inView:{Feature:PK},tap:{Feature:AK},focus:{Feature:EK},hover:{Feature:MK}},BK={layout:{ProjectionNode:i5,MeasureLayout:ZU}},NK={...bY,...OK,...TK,...BK},ub=NZ(NK,KZ);var ZA={exports:{}},Fg={};var rB;function FK(){return rB||(rB=1,Fg.ConcurrentRoot=1,Fg.ContinuousEventPriority=8,Fg.DefaultEventPriority=32,Fg.DiscreteEventPriority=2,Fg.IdleEventPriority=268435456,Fg.LegacyRoot=0,Fg.NoEventPriority=0),Fg}var sB;function UK(){return sB||(sB=1,ZA.exports=FK()),ZA.exports}var UT=UK();const cw="181",kK={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},VK={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},n5=0,aR=1,r5=2,GK=3,s5=0,AM=1,hb=2,bm=3,fg=0,Mc=1,jf=2,kd=0,dy=1,oR=2,lR=3,cR=4,a5=5,X_=100,o5=101,l5=102,c5=103,u5=104,h5=200,f5=201,d5=202,p5=203,A2=204,C2=205,m5=206,g5=207,_5=208,y5=209,x5=210,v5=211,b5=212,w5=213,S5=214,R2=0,Ob=1,I2=2,by=3,D2=4,L2=5,P2=6,z2=7,uw=0,T5=1,M5=2,Cm=0,E5=1,A5=2,C5=3,bI=4,R5=5,I5=6,D5=7,uR="attached",L5="detached",CM=300,i_=301,e0=302,Bb=303,Nb=304,yv=306,Fb=1e3,Zf=1001,Ub=1002,Fl=1003,wI=1004,HK=1004,Vx=1005,jK=1005,Do=1006,fb=1007,qK=1007,og=1008,XK=1008,xh=1009,SI=1010,TI=1011,iv=1012,RM=1013,dg=1014,$h=1015,r0=1016,IM=1017,DM=1018,wy=1020,MI=35902,EI=35899,AI=1021,CI=1022,_h=1023,nv=1026,Sy=1027,LM=1028,hw=1029,PM=1030,zM=1031,WK=1032,OM=1033,db=33776,pb=33777,mb=33778,gb=33779,O2=35840,B2=35841,N2=35842,F2=35843,U2=36196,k2=37492,V2=37496,G2=37808,H2=37809,j2=37810,q2=37811,X2=37812,W2=37813,Z2=37814,Y2=37815,K2=37816,$2=37817,J2=37818,Q2=37819,eM=37820,tM=37821,iM=36492,nM=36494,rM=36495,sM=36283,aM=36284,oM=36285,lM=36286,P5=2200,z5=2201,O5=2202,kb=2300,cM=2301,kT=2302,oy=2400,ly=2401,Vb=2402,BM=2500,RI=2501,ZK=0,YK=1,KK=2,s0=3200,B5=3201,$K=3202,JK=3203,a0=0,N5=1,Mm="",Io="srgb",pg="srgb-linear",Gb="linear",Ha="srgb",QK=0,iy=7680,e$=7681,t$=7682,i$=7683,n$=34055,r$=34056,s$=5386,a$=512,o$=513,l$=514,c$=515,u$=516,h$=517,f$=518,hR=519,F5=512,U5=513,k5=514,II=515,V5=516,G5=517,H5=518,j5=519,Hb=35044,d$=35048,p$=35040,m$=35045,g$=35049,_$=35041,y$=35046,x$=35050,v$=35042,b$="100",fR="300 es",Ud=2e3,rv=2001,w$={COMPUTE:"compute",RENDER:"render"},S$={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},T$={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function q5(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const M$={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Gx(n,e){return new M$[n](e)}function jb(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function X5(){const n=jb("canvas");return n.style.display="block",n}const aB={};let t0=null;function E$(n){t0=n}function A$(){return t0}function qb(...n){const e="THREE."+n.shift();t0?t0("log",e,...n):console.log(e,...n)}function ir(...n){const e="THREE."+n.shift();t0?t0("warn",e,...n):console.warn(e,...n)}function ys(...n){const e="THREE."+n.shift();t0?t0("error",e,...n):console.error(e,...n)}function sv(...n){const e=n.join(" ");e in aB||(aB[e]=!0,ir(...n))}function C$(n,e,i){return new Promise(function(l,h){function g(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:h();break;case n.TIMEOUT_EXPIRED:setTimeout(g,i);break;default:l()}}setTimeout(g,i)})}class jd{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const l=this._listeners;l[e]===void 0&&(l[e]=[]),l[e].indexOf(i)===-1&&l[e].push(i)}hasEventListener(e,i){const l=this._listeners;return l===void 0?!1:l[e]!==void 0&&l[e].indexOf(i)!==-1}removeEventListener(e,i){const l=this._listeners;if(l===void 0)return;const h=l[e];if(h!==void 0){const g=h.indexOf(i);g!==-1&&h.splice(g,1)}}dispatchEvent(e){const i=this._listeners;if(i===void 0)return;const l=i[e.type];if(l!==void 0){e.target=this;const h=l.slice(0);for(let g=0,v=h.length;g<v;g++)h[g].call(this,e);e.target=null}}}const dh=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let oB=1234567;const py=Math.PI/180,av=180/Math.PI;function Vd(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,l=Math.random()*4294967295|0;return(dh[n&255]+dh[n>>8&255]+dh[n>>16&255]+dh[n>>24&255]+"-"+dh[e&255]+dh[e>>8&255]+"-"+dh[e>>16&15|64]+dh[e>>24&255]+"-"+dh[i&63|128]+dh[i>>8&255]+"-"+dh[i>>16&255]+dh[i>>24&255]+dh[l&255]+dh[l>>8&255]+dh[l>>16&255]+dh[l>>24&255]).toLowerCase()}function os(n,e,i){return Math.max(e,Math.min(i,n))}function DI(n,e){return(n%e+e)%e}function R$(n,e,i,l,h){return l+(n-e)*(h-l)/(i-e)}function I$(n,e,i){return n!==e?(i-n)/(e-n):0}function _b(n,e,i){return(1-i)*n+i*e}function D$(n,e,i,l){return _b(n,e,1-Math.exp(-i*l))}function L$(n,e=1){return e-Math.abs(DI(n,e*2)-e)}function P$(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function z$(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function O$(n,e){return n+Math.floor(Math.random()*(e-n+1))}function B$(n,e){return n+Math.random()*(e-n)}function N$(n){return n*(.5-Math.random())}function F$(n){n!==void 0&&(oB=n);let e=oB+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function U$(n){return n*py}function k$(n){return n*av}function V$(n){return(n&n-1)===0&&n!==0}function G$(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function H$(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function j$(n,e,i,l,h){const g=Math.cos,v=Math.sin,r=g(i/2),C=v(i/2),I=g((e+l)/2),z=v((e+l)/2),N=g((e-l)/2),k=v((e-l)/2),j=g((l-e)/2),$=v((l-e)/2);switch(h){case"XYX":n.set(r*z,C*N,C*k,r*I);break;case"YZY":n.set(C*k,r*z,C*N,r*I);break;case"ZXZ":n.set(C*N,C*k,r*z,r*I);break;case"XZX":n.set(r*z,C*$,C*j,r*I);break;case"YXY":n.set(C*j,r*z,C*$,r*I);break;case"ZYZ":n.set(C*$,C*j,r*z,r*I);break;default:ir("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+h)}}function Yh(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Us(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const q$={DEG2RAD:py,RAD2DEG:av,generateUUID:Vd,clamp:os,euclideanModulo:DI,mapLinear:R$,inverseLerp:I$,lerp:_b,damp:D$,pingpong:L$,smoothstep:P$,smootherstep:z$,randInt:O$,randFloat:B$,randFloatSpread:N$,seededRandom:F$,degToRad:U$,radToDeg:k$,isPowerOfTwo:V$,ceilPowerOfTwo:G$,floorPowerOfTwo:H$,setQuaternionFromProperEuler:j$,normalize:Us,denormalize:Yh};class $i{constructor(e=0,i=0){$i.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,l=this.y,h=e.elements;return this.x=h[0]*i+h[3]*l+h[6],this.y=h[1]*i+h[4]*l+h[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=os(this.x,e.x,i.x),this.y=os(this.y,e.y,i.y),this}clampScalar(e,i){return this.x=os(this.x,e,i),this.y=os(this.y,e,i),this}clampLength(e,i){const l=this.length();return this.divideScalar(l||1).multiplyScalar(os(l,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const l=this.dot(e)/i;return Math.acos(os(l,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,l=this.y-e.y;return i*i+l*l}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,l){return this.x=e.x+(i.x-e.x)*l,this.y=e.y+(i.y-e.y)*l,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const l=Math.cos(i),h=Math.sin(i),g=this.x-e.x,v=this.y-e.y;return this.x=g*l-v*h+e.x,this.y=g*h+v*l+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Yf{constructor(e=0,i=0,l=0,h=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=l,this._w=h}static slerpFlat(e,i,l,h,g,v,r){let C=l[h+0],I=l[h+1],z=l[h+2],N=l[h+3],k=g[v+0],j=g[v+1],$=g[v+2],re=g[v+3];if(r<=0){e[i+0]=C,e[i+1]=I,e[i+2]=z,e[i+3]=N;return}if(r>=1){e[i+0]=k,e[i+1]=j,e[i+2]=$,e[i+3]=re;return}if(N!==re||C!==k||I!==j||z!==$){let ie=C*k+I*j+z*$+N*re;ie<0&&(k=-k,j=-j,$=-$,re=-re,ie=-ie);let Y=1-r;if(ie<.9995){const ae=Math.acos(ie),ue=Math.sin(ae);Y=Math.sin(Y*ae)/ue,r=Math.sin(r*ae)/ue,C=C*Y+k*r,I=I*Y+j*r,z=z*Y+$*r,N=N*Y+re*r}else{C=C*Y+k*r,I=I*Y+j*r,z=z*Y+$*r,N=N*Y+re*r;const ae=1/Math.sqrt(C*C+I*I+z*z+N*N);C*=ae,I*=ae,z*=ae,N*=ae}}e[i]=C,e[i+1]=I,e[i+2]=z,e[i+3]=N}static multiplyQuaternionsFlat(e,i,l,h,g,v){const r=l[h],C=l[h+1],I=l[h+2],z=l[h+3],N=g[v],k=g[v+1],j=g[v+2],$=g[v+3];return e[i]=r*$+z*N+C*j-I*k,e[i+1]=C*$+z*k+I*N-r*j,e[i+2]=I*$+z*j+r*k-C*N,e[i+3]=z*$-r*N-C*k-I*j,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,l,h){return this._x=e,this._y=i,this._z=l,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const l=e._x,h=e._y,g=e._z,v=e._order,r=Math.cos,C=Math.sin,I=r(l/2),z=r(h/2),N=r(g/2),k=C(l/2),j=C(h/2),$=C(g/2);switch(v){case"XYZ":this._x=k*z*N+I*j*$,this._y=I*j*N-k*z*$,this._z=I*z*$+k*j*N,this._w=I*z*N-k*j*$;break;case"YXZ":this._x=k*z*N+I*j*$,this._y=I*j*N-k*z*$,this._z=I*z*$-k*j*N,this._w=I*z*N+k*j*$;break;case"ZXY":this._x=k*z*N-I*j*$,this._y=I*j*N+k*z*$,this._z=I*z*$+k*j*N,this._w=I*z*N-k*j*$;break;case"ZYX":this._x=k*z*N-I*j*$,this._y=I*j*N+k*z*$,this._z=I*z*$-k*j*N,this._w=I*z*N+k*j*$;break;case"YZX":this._x=k*z*N+I*j*$,this._y=I*j*N+k*z*$,this._z=I*z*$-k*j*N,this._w=I*z*N-k*j*$;break;case"XZY":this._x=k*z*N-I*j*$,this._y=I*j*N-k*z*$,this._z=I*z*$+k*j*N,this._w=I*z*N+k*j*$;break;default:ir("Quaternion: .setFromEuler() encountered an unknown order: "+v)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const l=i/2,h=Math.sin(l);return this._x=e.x*h,this._y=e.y*h,this._z=e.z*h,this._w=Math.cos(l),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,l=i[0],h=i[4],g=i[8],v=i[1],r=i[5],C=i[9],I=i[2],z=i[6],N=i[10],k=l+r+N;if(k>0){const j=.5/Math.sqrt(k+1);this._w=.25/j,this._x=(z-C)*j,this._y=(g-I)*j,this._z=(v-h)*j}else if(l>r&&l>N){const j=2*Math.sqrt(1+l-r-N);this._w=(z-C)/j,this._x=.25*j,this._y=(h+v)/j,this._z=(g+I)/j}else if(r>N){const j=2*Math.sqrt(1+r-l-N);this._w=(g-I)/j,this._x=(h+v)/j,this._y=.25*j,this._z=(C+z)/j}else{const j=2*Math.sqrt(1+N-l-r);this._w=(v-h)/j,this._x=(g+I)/j,this._y=(C+z)/j,this._z=.25*j}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let l=e.dot(i)+1;return l<1e-8?(l=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=l):(this._x=0,this._y=-e.z,this._z=e.y,this._w=l)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=l),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(os(this.dot(e),-1,1)))}rotateTowards(e,i){const l=this.angleTo(e);if(l===0)return this;const h=Math.min(1,i/l);return this.slerp(e,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const l=e._x,h=e._y,g=e._z,v=e._w,r=i._x,C=i._y,I=i._z,z=i._w;return this._x=l*z+v*r+h*I-g*C,this._y=h*z+v*C+g*r-l*I,this._z=g*z+v*I+l*C-h*r,this._w=v*z-l*r-h*C-g*I,this._onChangeCallback(),this}slerp(e,i){if(i<=0)return this;if(i>=1)return this.copy(e);let l=e._x,h=e._y,g=e._z,v=e._w,r=this.dot(e);r<0&&(l=-l,h=-h,g=-g,v=-v,r=-r);let C=1-i;if(r<.9995){const I=Math.acos(r),z=Math.sin(I);C=Math.sin(C*I)/z,i=Math.sin(i*I)/z,this._x=this._x*C+l*i,this._y=this._y*C+h*i,this._z=this._z*C+g*i,this._w=this._w*C+v*i,this._onChangeCallback()}else this._x=this._x*C+l*i,this._y=this._y*C+h*i,this._z=this._z*C+g*i,this._w=this._w*C+v*i,this.normalize();return this}slerpQuaternions(e,i,l){return this.copy(e).slerp(i,l)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),l=Math.random(),h=Math.sqrt(1-l),g=Math.sqrt(l);return this.set(h*Math.sin(e),h*Math.cos(e),g*Math.sin(i),g*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class gt{constructor(e=0,i=0,l=0){gt.prototype.isVector3=!0,this.x=e,this.y=i,this.z=l}set(e,i,l){return l===void 0&&(l=this.z),this.x=e,this.y=i,this.z=l,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(lB.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(lB.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,l=this.y,h=this.z,g=e.elements;return this.x=g[0]*i+g[3]*l+g[6]*h,this.y=g[1]*i+g[4]*l+g[7]*h,this.z=g[2]*i+g[5]*l+g[8]*h,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,l=this.y,h=this.z,g=e.elements,v=1/(g[3]*i+g[7]*l+g[11]*h+g[15]);return this.x=(g[0]*i+g[4]*l+g[8]*h+g[12])*v,this.y=(g[1]*i+g[5]*l+g[9]*h+g[13])*v,this.z=(g[2]*i+g[6]*l+g[10]*h+g[14])*v,this}applyQuaternion(e){const i=this.x,l=this.y,h=this.z,g=e.x,v=e.y,r=e.z,C=e.w,I=2*(v*h-r*l),z=2*(r*i-g*h),N=2*(g*l-v*i);return this.x=i+C*I+v*N-r*z,this.y=l+C*z+r*I-g*N,this.z=h+C*N+g*z-v*I,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,l=this.y,h=this.z,g=e.elements;return this.x=g[0]*i+g[4]*l+g[8]*h,this.y=g[1]*i+g[5]*l+g[9]*h,this.z=g[2]*i+g[6]*l+g[10]*h,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=os(this.x,e.x,i.x),this.y=os(this.y,e.y,i.y),this.z=os(this.z,e.z,i.z),this}clampScalar(e,i){return this.x=os(this.x,e,i),this.y=os(this.y,e,i),this.z=os(this.z,e,i),this}clampLength(e,i){const l=this.length();return this.divideScalar(l||1).multiplyScalar(os(l,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,l){return this.x=e.x+(i.x-e.x)*l,this.y=e.y+(i.y-e.y)*l,this.z=e.z+(i.z-e.z)*l,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const l=e.x,h=e.y,g=e.z,v=i.x,r=i.y,C=i.z;return this.x=h*C-g*r,this.y=g*v-l*C,this.z=l*r-h*v,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const l=e.dot(this)/i;return this.copy(e).multiplyScalar(l)}projectOnPlane(e){return YA.copy(this).projectOnVector(e),this.sub(YA)}reflect(e){return this.sub(YA.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const l=this.dot(e)/i;return Math.acos(os(l,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,l=this.y-e.y,h=this.z-e.z;return i*i+l*l+h*h}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,l){const h=Math.sin(i)*e;return this.x=h*Math.sin(l),this.y=Math.cos(i)*e,this.z=h*Math.cos(l),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,l){return this.x=e*Math.sin(i),this.y=l,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),l=this.setFromMatrixColumn(e,1).length(),h=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=l,this.z=h,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,l=Math.sqrt(1-i*i);return this.x=l*Math.cos(e),this.y=i,this.z=l*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const YA=new gt,lB=new Yf;class Ps{constructor(e,i,l,h,g,v,r,C,I){Ps.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,l,h,g,v,r,C,I)}set(e,i,l,h,g,v,r,C,I){const z=this.elements;return z[0]=e,z[1]=h,z[2]=r,z[3]=i,z[4]=g,z[5]=C,z[6]=l,z[7]=v,z[8]=I,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,l=e.elements;return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],this}extractBasis(e,i,l){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),l.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const l=e.elements,h=i.elements,g=this.elements,v=l[0],r=l[3],C=l[6],I=l[1],z=l[4],N=l[7],k=l[2],j=l[5],$=l[8],re=h[0],ie=h[3],Y=h[6],ae=h[1],ue=h[4],me=h[7],Ae=h[2],Se=h[5],ze=h[8];return g[0]=v*re+r*ae+C*Ae,g[3]=v*ie+r*ue+C*Se,g[6]=v*Y+r*me+C*ze,g[1]=I*re+z*ae+N*Ae,g[4]=I*ie+z*ue+N*Se,g[7]=I*Y+z*me+N*ze,g[2]=k*re+j*ae+$*Ae,g[5]=k*ie+j*ue+$*Se,g[8]=k*Y+j*me+$*ze,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],l=e[1],h=e[2],g=e[3],v=e[4],r=e[5],C=e[6],I=e[7],z=e[8];return i*v*z-i*r*I-l*g*z+l*r*C+h*g*I-h*v*C}invert(){const e=this.elements,i=e[0],l=e[1],h=e[2],g=e[3],v=e[4],r=e[5],C=e[6],I=e[7],z=e[8],N=z*v-r*I,k=r*C-z*g,j=I*g-v*C,$=i*N+l*k+h*j;if($===0)return this.set(0,0,0,0,0,0,0,0,0);const re=1/$;return e[0]=N*re,e[1]=(h*I-z*l)*re,e[2]=(r*l-h*v)*re,e[3]=k*re,e[4]=(z*i-h*C)*re,e[5]=(h*g-r*i)*re,e[6]=j*re,e[7]=(l*C-I*i)*re,e[8]=(v*i-l*g)*re,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,l,h,g,v,r){const C=Math.cos(g),I=Math.sin(g);return this.set(l*C,l*I,-l*(C*v+I*r)+v+e,-h*I,h*C,-h*(-I*v+C*r)+r+i,0,0,1),this}scale(e,i){return this.premultiply(KA.makeScale(e,i)),this}rotate(e){return this.premultiply(KA.makeRotation(-e)),this}translate(e,i){return this.premultiply(KA.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),l=Math.sin(e);return this.set(i,-l,0,l,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,l=e.elements;for(let h=0;h<9;h++)if(i[h]!==l[h])return!1;return!0}fromArray(e,i=0){for(let l=0;l<9;l++)this.elements[l]=e[l+i];return this}toArray(e=[],i=0){const l=this.elements;return e[i]=l[0],e[i+1]=l[1],e[i+2]=l[2],e[i+3]=l[3],e[i+4]=l[4],e[i+5]=l[5],e[i+6]=l[6],e[i+7]=l[7],e[i+8]=l[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const KA=new Ps,cB=new Ps().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),uB=new Ps().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function X$(){const n={enabled:!0,workingColorSpace:pg,spaces:{},convert:function(h,g,v){return this.enabled===!1||g===v||!g||!v||(this.spaces[g].transfer===Ha&&(h.r=Kg(h.r),h.g=Kg(h.g),h.b=Kg(h.b)),this.spaces[g].primaries!==this.spaces[v].primaries&&(h.applyMatrix3(this.spaces[g].toXYZ),h.applyMatrix3(this.spaces[v].fromXYZ)),this.spaces[v].transfer===Ha&&(h.r=Wx(h.r),h.g=Wx(h.g),h.b=Wx(h.b))),h},workingToColorSpace:function(h,g){return this.convert(h,this.workingColorSpace,g)},colorSpaceToWorking:function(h,g){return this.convert(h,g,this.workingColorSpace)},getPrimaries:function(h){return this.spaces[h].primaries},getTransfer:function(h){return h===Mm?Gb:this.spaces[h].transfer},getToneMappingMode:function(h){return this.spaces[h].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(h,g=this.workingColorSpace){return h.fromArray(this.spaces[g].luminanceCoefficients)},define:function(h){Object.assign(this.spaces,h)},_getMatrix:function(h,g,v){return h.copy(this.spaces[g].toXYZ).multiply(this.spaces[v].fromXYZ)},_getDrawingBufferColorSpace:function(h){return this.spaces[h].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(h=this.workingColorSpace){return this.spaces[h].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(h,g){return sv("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(h,g)},toWorkingColorSpace:function(h,g){return sv("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(h,g)}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],l=[.3127,.329];return n.define({[pg]:{primaries:e,whitePoint:l,transfer:Gb,toXYZ:cB,fromXYZ:uB,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:Io},outputColorSpaceConfig:{drawingBufferColorSpace:Io}},[Io]:{primaries:e,whitePoint:l,transfer:Ha,toXYZ:cB,fromXYZ:uB,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:Io}}}),n}const oa=X$();function Kg(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Wx(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let hx;class W5{static getDataURL(e,i="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let l;if(e instanceof HTMLCanvasElement)l=e;else{hx===void 0&&(hx=jb("canvas")),hx.width=e.width,hx.height=e.height;const h=hx.getContext("2d");e instanceof ImageData?h.putImageData(e,0,0):h.drawImage(e,0,0,e.width,e.height),l=hx}return l.toDataURL(i)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=jb("canvas");i.width=e.width,i.height=e.height;const l=i.getContext("2d");l.drawImage(e,0,0,e.width,e.height);const h=l.getImageData(0,0,e.width,e.height),g=h.data;for(let v=0;v<g.length;v++)g[v]=Kg(g[v]/255)*255;return l.putImageData(h,0,0),i}else if(e.data){const i=e.data.slice(0);for(let l=0;l<i.length;l++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[l]=Math.floor(Kg(i[l]/255)*255):i[l]=Kg(i[l]);return{data:i,width:e.width,height:e.height}}else return ir("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let W$=0;class K_{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:W$++}),this.uuid=Vd(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const i=this.data;return typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?e.set(i.videoWidth,i.videoHeight,0):i instanceof VideoFrame?e.set(i.displayHeight,i.displayWidth,0):i!==null?e.set(i.width,i.height,i.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const l={uuid:this.uuid,url:""},h=this.data;if(h!==null){let g;if(Array.isArray(h)){g=[];for(let v=0,r=h.length;v<r;v++)h[v].isDataTexture?g.push($A(h[v].image)):g.push($A(h[v]))}else g=$A(h);l.url=g}return i||(e.images[this.uuid]=l),l}}function $A(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?W5.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(ir("Texture: Unable to serialize Texture."),{})}let Z$=0;const JA=new gt;class Ho extends jd{constructor(e=Ho.DEFAULT_IMAGE,i=Ho.DEFAULT_MAPPING,l=Zf,h=Zf,g=Do,v=og,r=_h,C=xh,I=Ho.DEFAULT_ANISOTROPY,z=Mm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Z$++}),this.uuid=Vd(),this.name="",this.source=new K_(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=l,this.wrapT=h,this.magFilter=g,this.minFilter=v,this.anisotropy=I,this.format=r,this.internalFormat=null,this.type=C,this.offset=new $i(0,0),this.repeat=new $i(1,1),this.center=new $i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ps,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=z,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(JA).x}get height(){return this.source.getSize(JA).y}get depth(){return this.source.getSize(JA).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const i in e){const l=e[i];if(l===void 0){ir(`Texture.setValues(): parameter '${i}' has value of undefined.`);continue}const h=this[i];if(h===void 0){ir(`Texture.setValues(): property '${i}' does not exist.`);continue}h&&l&&h.isVector2&&l.isVector2||h&&l&&h.isVector3&&l.isVector3||h&&l&&h.isMatrix3&&l.isMatrix3?h.copy(l):this[i]=l}}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const l={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(l.userData=this.userData),i||(e.textures[this.uuid]=l),l}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==CM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Fb:e.x=e.x-Math.floor(e.x);break;case Zf:e.x=e.x<0?0:1;break;case Ub:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Fb:e.y=e.y-Math.floor(e.y);break;case Zf:e.y=e.y<0?0:1;break;case Ub:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ho.DEFAULT_IMAGE=null;Ho.DEFAULT_MAPPING=CM;Ho.DEFAULT_ANISOTROPY=1;class xa{constructor(e=0,i=0,l=0,h=1){xa.prototype.isVector4=!0,this.x=e,this.y=i,this.z=l,this.w=h}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,l,h){return this.x=e,this.y=i,this.z=l,this.w=h,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,l=this.y,h=this.z,g=this.w,v=e.elements;return this.x=v[0]*i+v[4]*l+v[8]*h+v[12]*g,this.y=v[1]*i+v[5]*l+v[9]*h+v[13]*g,this.z=v[2]*i+v[6]*l+v[10]*h+v[14]*g,this.w=v[3]*i+v[7]*l+v[11]*h+v[15]*g,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,l,h,g;const C=e.elements,I=C[0],z=C[4],N=C[8],k=C[1],j=C[5],$=C[9],re=C[2],ie=C[6],Y=C[10];if(Math.abs(z-k)<.01&&Math.abs(N-re)<.01&&Math.abs($-ie)<.01){if(Math.abs(z+k)<.1&&Math.abs(N+re)<.1&&Math.abs($+ie)<.1&&Math.abs(I+j+Y-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const ue=(I+1)/2,me=(j+1)/2,Ae=(Y+1)/2,Se=(z+k)/4,ze=(N+re)/4,je=($+ie)/4;return ue>me&&ue>Ae?ue<.01?(l=0,h=.707106781,g=.707106781):(l=Math.sqrt(ue),h=Se/l,g=ze/l):me>Ae?me<.01?(l=.707106781,h=0,g=.707106781):(h=Math.sqrt(me),l=Se/h,g=je/h):Ae<.01?(l=.707106781,h=.707106781,g=0):(g=Math.sqrt(Ae),l=ze/g,h=je/g),this.set(l,h,g,i),this}let ae=Math.sqrt((ie-$)*(ie-$)+(N-re)*(N-re)+(k-z)*(k-z));return Math.abs(ae)<.001&&(ae=1),this.x=(ie-$)/ae,this.y=(N-re)/ae,this.z=(k-z)/ae,this.w=Math.acos((I+j+Y-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=os(this.x,e.x,i.x),this.y=os(this.y,e.y,i.y),this.z=os(this.z,e.z,i.z),this.w=os(this.w,e.w,i.w),this}clampScalar(e,i){return this.x=os(this.x,e,i),this.y=os(this.y,e,i),this.z=os(this.z,e,i),this.w=os(this.w,e,i),this}clampLength(e,i){const l=this.length();return this.divideScalar(l||1).multiplyScalar(os(l,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,l){return this.x=e.x+(i.x-e.x)*l,this.y=e.y+(i.y-e.y)*l,this.z=e.z+(i.z-e.z)*l,this.w=e.w+(i.w-e.w)*l,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class LI extends jd{constructor(e=1,i=1,l={}){super(),l=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Do,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},l),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=l.depth,this.scissor=new xa(0,0,e,i),this.scissorTest=!1,this.viewport=new xa(0,0,e,i);const h={width:e,height:i,depth:l.depth},g=new Ho(h);this.textures=[];const v=l.count;for(let r=0;r<v;r++)this.textures[r]=g.clone(),this.textures[r].isRenderTargetTexture=!0,this.textures[r].renderTarget=this;this._setTextureOptions(l),this.depthBuffer=l.depthBuffer,this.stencilBuffer=l.stencilBuffer,this.resolveDepthBuffer=l.resolveDepthBuffer,this.resolveStencilBuffer=l.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=l.depthTexture,this.samples=l.samples,this.multiview=l.multiview}_setTextureOptions(e={}){const i={minFilter:Do,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(i.mapping=e.mapping),e.wrapS!==void 0&&(i.wrapS=e.wrapS),e.wrapT!==void 0&&(i.wrapT=e.wrapT),e.wrapR!==void 0&&(i.wrapR=e.wrapR),e.magFilter!==void 0&&(i.magFilter=e.magFilter),e.minFilter!==void 0&&(i.minFilter=e.minFilter),e.format!==void 0&&(i.format=e.format),e.type!==void 0&&(i.type=e.type),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(i.colorSpace=e.colorSpace),e.flipY!==void 0&&(i.flipY=e.flipY),e.generateMipmaps!==void 0&&(i.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(i.internalFormat=e.internalFormat);for(let l=0;l<this.textures.length;l++)this.textures[l].setValues(i)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,i,l=1){if(this.width!==e||this.height!==i||this.depth!==l){this.width=e,this.height=i,this.depth=l;for(let h=0,g=this.textures.length;h<g;h++)this.textures[h].image.width=e,this.textures[h].image.height=i,this.textures[h].image.depth=l,this.textures[h].isData3DTexture!==!0&&(this.textures[h].isArrayTexture=this.textures[h].image.depth>1);this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,l=e.textures.length;i<l;i++){this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const h=Object.assign({},e.textures[i].image);this.textures[i].source=new K_(h)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class vh extends LI{constructor(e=1,i=1,l={}){super(e,i,l),this.isWebGLRenderTarget=!0}}class NM extends Ho{constructor(e=null,i=1,l=1,h=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:l,depth:h},this.magFilter=Fl,this.minFilter=Fl,this.wrapR=Zf,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Y$ extends vh{constructor(e=1,i=1,l=1,h={}){super(e,i,h),this.isWebGLArrayRenderTarget=!0,this.depth=l,this.texture=new NM(null,e,i,l),this._setTextureOptions(h),this.texture.isRenderTargetTexture=!0}}class FM extends Ho{constructor(e=null,i=1,l=1,h=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:l,depth:h},this.magFilter=Fl,this.minFilter=Fl,this.wrapR=Zf,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class K$ extends vh{constructor(e=1,i=1,l=1,h={}){super(e,i,h),this.isWebGL3DRenderTarget=!0,this.depth=l,this.texture=new FM(null,e,i,l),this._setTextureOptions(h),this.texture.isRenderTargetTexture=!0}}class yh{constructor(e=new gt(1/0,1/0,1/0),i=new gt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,l=e.length;i<l;i+=3)this.expandByPoint(_m.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,l=e.count;i<l;i++)this.expandByPoint(_m.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,l=e.length;i<l;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const l=_m.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(l),this.max.copy(e).add(l),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const l=e.geometry;if(l!==void 0){const g=l.getAttribute("position");if(i===!0&&g!==void 0&&e.isInstancedMesh!==!0)for(let v=0,r=g.count;v<r;v++)e.isMesh===!0?e.getVertexPosition(v,_m):_m.fromBufferAttribute(g,v),_m.applyMatrix4(e.matrixWorld),this.expandByPoint(_m);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),BS.copy(e.boundingBox)):(l.boundingBox===null&&l.computeBoundingBox(),BS.copy(l.boundingBox)),BS.applyMatrix4(e.matrixWorld),this.union(BS)}const h=e.children;for(let g=0,v=h.length;g<v;g++)this.expandByObject(h[g],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,_m),_m.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,l;return e.normal.x>0?(i=e.normal.x*this.min.x,l=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,l=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,l+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,l+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,l+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,l+=e.normal.z*this.min.z),i<=-e.constant&&l>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(R1),NS.subVectors(this.max,R1),fx.subVectors(e.a,R1),dx.subVectors(e.b,R1),px.subVectors(e.c,R1),z_.subVectors(dx,fx),O_.subVectors(px,dx),U0.subVectors(fx,px);let i=[0,-z_.z,z_.y,0,-O_.z,O_.y,0,-U0.z,U0.y,z_.z,0,-z_.x,O_.z,0,-O_.x,U0.z,0,-U0.x,-z_.y,z_.x,0,-O_.y,O_.x,0,-U0.y,U0.x,0];return!QA(i,fx,dx,px,NS)||(i=[1,0,0,0,1,0,0,0,1],!QA(i,fx,dx,px,NS))?!1:(FS.crossVectors(z_,O_),i=[FS.x,FS.y,FS.z],QA(i,fx,dx,px,NS))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_m).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_m).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ug[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ug[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ug[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ug[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ug[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ug[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ug[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ug[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ug),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Ug=[new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt],_m=new gt,BS=new yh,fx=new gt,dx=new gt,px=new gt,z_=new gt,O_=new gt,U0=new gt,R1=new gt,NS=new gt,FS=new gt,k0=new gt;function QA(n,e,i,l,h){for(let g=0,v=n.length-3;g<=v;g+=3){k0.fromArray(n,g);const r=h.x*Math.abs(k0.x)+h.y*Math.abs(k0.y)+h.z*Math.abs(k0.z),C=e.dot(k0),I=i.dot(k0),z=l.dot(k0);if(Math.max(-Math.max(C,I,z),Math.min(C,I,z))>r)return!1}return!0}const $$=new yh,I1=new gt,e3=new gt;class Ou{constructor(e=new gt,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const l=this.center;i!==void 0?l.copy(i):$$.setFromPoints(e).getCenter(l);let h=0;for(let g=0,v=e.length;g<v;g++)h=Math.max(h,l.distanceToSquared(e[g]));return this.radius=Math.sqrt(h),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const l=this.center.distanceToSquared(e);return i.copy(e),l>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;I1.subVectors(e,this.center);const i=I1.lengthSq();if(i>this.radius*this.radius){const l=Math.sqrt(i),h=(l-this.radius)*.5;this.center.addScaledVector(I1,h/l),this.radius+=h}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(e3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(I1.copy(e.center).add(e3)),this.expandByPoint(I1.copy(e.center).sub(e3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const kg=new gt,t3=new gt,US=new gt,B_=new gt,i3=new gt,kS=new gt,n3=new gt;class xv{constructor(e=new gt,i=new gt(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,kg)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const l=i.dot(this.direction);return l<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,l)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=kg.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(kg.copy(this.origin).addScaledVector(this.direction,i),kg.distanceToSquared(e))}distanceSqToSegment(e,i,l,h){t3.copy(e).add(i).multiplyScalar(.5),US.copy(i).sub(e).normalize(),B_.copy(this.origin).sub(t3);const g=e.distanceTo(i)*.5,v=-this.direction.dot(US),r=B_.dot(this.direction),C=-B_.dot(US),I=B_.lengthSq(),z=Math.abs(1-v*v);let N,k,j,$;if(z>0)if(N=v*C-r,k=v*r-C,$=g*z,N>=0)if(k>=-$)if(k<=$){const re=1/z;N*=re,k*=re,j=N*(N+v*k+2*r)+k*(v*N+k+2*C)+I}else k=g,N=Math.max(0,-(v*k+r)),j=-N*N+k*(k+2*C)+I;else k=-g,N=Math.max(0,-(v*k+r)),j=-N*N+k*(k+2*C)+I;else k<=-$?(N=Math.max(0,-(-v*g+r)),k=N>0?-g:Math.min(Math.max(-g,-C),g),j=-N*N+k*(k+2*C)+I):k<=$?(N=0,k=Math.min(Math.max(-g,-C),g),j=k*(k+2*C)+I):(N=Math.max(0,-(v*g+r)),k=N>0?g:Math.min(Math.max(-g,-C),g),j=-N*N+k*(k+2*C)+I);else k=v>0?-g:g,N=Math.max(0,-(v*k+r)),j=-N*N+k*(k+2*C)+I;return l&&l.copy(this.origin).addScaledVector(this.direction,N),h&&h.copy(t3).addScaledVector(US,k),j}intersectSphere(e,i){kg.subVectors(e.center,this.origin);const l=kg.dot(this.direction),h=kg.dot(kg)-l*l,g=e.radius*e.radius;if(h>g)return null;const v=Math.sqrt(g-h),r=l-v,C=l+v;return C<0?null:r<0?this.at(C,i):this.at(r,i)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const l=-(this.origin.dot(e.normal)+e.constant)/i;return l>=0?l:null}intersectPlane(e,i){const l=this.distanceToPlane(e);return l===null?null:this.at(l,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let l,h,g,v,r,C;const I=1/this.direction.x,z=1/this.direction.y,N=1/this.direction.z,k=this.origin;return I>=0?(l=(e.min.x-k.x)*I,h=(e.max.x-k.x)*I):(l=(e.max.x-k.x)*I,h=(e.min.x-k.x)*I),z>=0?(g=(e.min.y-k.y)*z,v=(e.max.y-k.y)*z):(g=(e.max.y-k.y)*z,v=(e.min.y-k.y)*z),l>v||g>h||((g>l||isNaN(l))&&(l=g),(v<h||isNaN(h))&&(h=v),N>=0?(r=(e.min.z-k.z)*N,C=(e.max.z-k.z)*N):(r=(e.max.z-k.z)*N,C=(e.min.z-k.z)*N),l>C||r>h)||((r>l||l!==l)&&(l=r),(C<h||h!==h)&&(h=C),h<0)?null:this.at(l>=0?l:h,i)}intersectsBox(e){return this.intersectBox(e,kg)!==null}intersectTriangle(e,i,l,h,g){i3.subVectors(i,e),kS.subVectors(l,e),n3.crossVectors(i3,kS);let v=this.direction.dot(n3),r;if(v>0){if(h)return null;r=1}else if(v<0)r=-1,v=-v;else return null;B_.subVectors(this.origin,e);const C=r*this.direction.dot(kS.crossVectors(B_,kS));if(C<0)return null;const I=r*this.direction.dot(i3.cross(B_));if(I<0||C+I>v)return null;const z=-r*B_.dot(n3);return z<0?null:this.at(z/v,g)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ps{constructor(e,i,l,h,g,v,r,C,I,z,N,k,j,$,re,ie){ps.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,l,h,g,v,r,C,I,z,N,k,j,$,re,ie)}set(e,i,l,h,g,v,r,C,I,z,N,k,j,$,re,ie){const Y=this.elements;return Y[0]=e,Y[4]=i,Y[8]=l,Y[12]=h,Y[1]=g,Y[5]=v,Y[9]=r,Y[13]=C,Y[2]=I,Y[6]=z,Y[10]=N,Y[14]=k,Y[3]=j,Y[7]=$,Y[11]=re,Y[15]=ie,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ps().fromArray(this.elements)}copy(e){const i=this.elements,l=e.elements;return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],this}copyPosition(e){const i=this.elements,l=e.elements;return i[12]=l[12],i[13]=l[13],i[14]=l[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,l){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),l.setFromMatrixColumn(this,2),this}makeBasis(e,i,l){return this.set(e.x,i.x,l.x,0,e.y,i.y,l.y,0,e.z,i.z,l.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,l=e.elements,h=1/mx.setFromMatrixColumn(e,0).length(),g=1/mx.setFromMatrixColumn(e,1).length(),v=1/mx.setFromMatrixColumn(e,2).length();return i[0]=l[0]*h,i[1]=l[1]*h,i[2]=l[2]*h,i[3]=0,i[4]=l[4]*g,i[5]=l[5]*g,i[6]=l[6]*g,i[7]=0,i[8]=l[8]*v,i[9]=l[9]*v,i[10]=l[10]*v,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,l=e.x,h=e.y,g=e.z,v=Math.cos(l),r=Math.sin(l),C=Math.cos(h),I=Math.sin(h),z=Math.cos(g),N=Math.sin(g);if(e.order==="XYZ"){const k=v*z,j=v*N,$=r*z,re=r*N;i[0]=C*z,i[4]=-C*N,i[8]=I,i[1]=j+$*I,i[5]=k-re*I,i[9]=-r*C,i[2]=re-k*I,i[6]=$+j*I,i[10]=v*C}else if(e.order==="YXZ"){const k=C*z,j=C*N,$=I*z,re=I*N;i[0]=k+re*r,i[4]=$*r-j,i[8]=v*I,i[1]=v*N,i[5]=v*z,i[9]=-r,i[2]=j*r-$,i[6]=re+k*r,i[10]=v*C}else if(e.order==="ZXY"){const k=C*z,j=C*N,$=I*z,re=I*N;i[0]=k-re*r,i[4]=-v*N,i[8]=$+j*r,i[1]=j+$*r,i[5]=v*z,i[9]=re-k*r,i[2]=-v*I,i[6]=r,i[10]=v*C}else if(e.order==="ZYX"){const k=v*z,j=v*N,$=r*z,re=r*N;i[0]=C*z,i[4]=$*I-j,i[8]=k*I+re,i[1]=C*N,i[5]=re*I+k,i[9]=j*I-$,i[2]=-I,i[6]=r*C,i[10]=v*C}else if(e.order==="YZX"){const k=v*C,j=v*I,$=r*C,re=r*I;i[0]=C*z,i[4]=re-k*N,i[8]=$*N+j,i[1]=N,i[5]=v*z,i[9]=-r*z,i[2]=-I*z,i[6]=j*N+$,i[10]=k-re*N}else if(e.order==="XZY"){const k=v*C,j=v*I,$=r*C,re=r*I;i[0]=C*z,i[4]=-N,i[8]=I*z,i[1]=k*N+re,i[5]=v*z,i[9]=j*N-$,i[2]=$*N-j,i[6]=r*z,i[10]=re*N+k}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(J$,e,Q$)}lookAt(e,i,l){const h=this.elements;return Od.subVectors(e,i),Od.lengthSq()===0&&(Od.z=1),Od.normalize(),N_.crossVectors(l,Od),N_.lengthSq()===0&&(Math.abs(l.z)===1?Od.x+=1e-4:Od.z+=1e-4,Od.normalize(),N_.crossVectors(l,Od)),N_.normalize(),VS.crossVectors(Od,N_),h[0]=N_.x,h[4]=VS.x,h[8]=Od.x,h[1]=N_.y,h[5]=VS.y,h[9]=Od.y,h[2]=N_.z,h[6]=VS.z,h[10]=Od.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const l=e.elements,h=i.elements,g=this.elements,v=l[0],r=l[4],C=l[8],I=l[12],z=l[1],N=l[5],k=l[9],j=l[13],$=l[2],re=l[6],ie=l[10],Y=l[14],ae=l[3],ue=l[7],me=l[11],Ae=l[15],Se=h[0],ze=h[4],je=h[8],Ce=h[12],Te=h[1],Ze=h[5],Mt=h[9],mt=h[13],Gt=h[2],kt=h[6],Re=h[10],Qe=h[14],et=h[3],Lt=h[7],jt=h[11],Ge=h[15];return g[0]=v*Se+r*Te+C*Gt+I*et,g[4]=v*ze+r*Ze+C*kt+I*Lt,g[8]=v*je+r*Mt+C*Re+I*jt,g[12]=v*Ce+r*mt+C*Qe+I*Ge,g[1]=z*Se+N*Te+k*Gt+j*et,g[5]=z*ze+N*Ze+k*kt+j*Lt,g[9]=z*je+N*Mt+k*Re+j*jt,g[13]=z*Ce+N*mt+k*Qe+j*Ge,g[2]=$*Se+re*Te+ie*Gt+Y*et,g[6]=$*ze+re*Ze+ie*kt+Y*Lt,g[10]=$*je+re*Mt+ie*Re+Y*jt,g[14]=$*Ce+re*mt+ie*Qe+Y*Ge,g[3]=ae*Se+ue*Te+me*Gt+Ae*et,g[7]=ae*ze+ue*Ze+me*kt+Ae*Lt,g[11]=ae*je+ue*Mt+me*Re+Ae*jt,g[15]=ae*Ce+ue*mt+me*Qe+Ae*Ge,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],l=e[4],h=e[8],g=e[12],v=e[1],r=e[5],C=e[9],I=e[13],z=e[2],N=e[6],k=e[10],j=e[14],$=e[3],re=e[7],ie=e[11],Y=e[15];return $*(+g*C*N-h*I*N-g*r*k+l*I*k+h*r*j-l*C*j)+re*(+i*C*j-i*I*k+g*v*k-h*v*j+h*I*z-g*C*z)+ie*(+i*I*N-i*r*j-g*v*N+l*v*j+g*r*z-l*I*z)+Y*(-h*r*z-i*C*N+i*r*k+h*v*N-l*v*k+l*C*z)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,l){const h=this.elements;return e.isVector3?(h[12]=e.x,h[13]=e.y,h[14]=e.z):(h[12]=e,h[13]=i,h[14]=l),this}invert(){const e=this.elements,i=e[0],l=e[1],h=e[2],g=e[3],v=e[4],r=e[5],C=e[6],I=e[7],z=e[8],N=e[9],k=e[10],j=e[11],$=e[12],re=e[13],ie=e[14],Y=e[15],ae=N*ie*I-re*k*I+re*C*j-r*ie*j-N*C*Y+r*k*Y,ue=$*k*I-z*ie*I-$*C*j+v*ie*j+z*C*Y-v*k*Y,me=z*re*I-$*N*I+$*r*j-v*re*j-z*r*Y+v*N*Y,Ae=$*N*C-z*re*C-$*r*k+v*re*k+z*r*ie-v*N*ie,Se=i*ae+l*ue+h*me+g*Ae;if(Se===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ze=1/Se;return e[0]=ae*ze,e[1]=(re*k*g-N*ie*g-re*h*j+l*ie*j+N*h*Y-l*k*Y)*ze,e[2]=(r*ie*g-re*C*g+re*h*I-l*ie*I-r*h*Y+l*C*Y)*ze,e[3]=(N*C*g-r*k*g-N*h*I+l*k*I+r*h*j-l*C*j)*ze,e[4]=ue*ze,e[5]=(z*ie*g-$*k*g+$*h*j-i*ie*j-z*h*Y+i*k*Y)*ze,e[6]=($*C*g-v*ie*g-$*h*I+i*ie*I+v*h*Y-i*C*Y)*ze,e[7]=(v*k*g-z*C*g+z*h*I-i*k*I-v*h*j+i*C*j)*ze,e[8]=me*ze,e[9]=($*N*g-z*re*g-$*l*j+i*re*j+z*l*Y-i*N*Y)*ze,e[10]=(v*re*g-$*r*g+$*l*I-i*re*I-v*l*Y+i*r*Y)*ze,e[11]=(z*r*g-v*N*g-z*l*I+i*N*I+v*l*j-i*r*j)*ze,e[12]=Ae*ze,e[13]=(z*re*h-$*N*h+$*l*k-i*re*k-z*l*ie+i*N*ie)*ze,e[14]=($*r*h-v*re*h-$*l*C+i*re*C+v*l*ie-i*r*ie)*ze,e[15]=(v*N*h-z*r*h+z*l*C-i*N*C-v*l*k+i*r*k)*ze,this}scale(e){const i=this.elements,l=e.x,h=e.y,g=e.z;return i[0]*=l,i[4]*=h,i[8]*=g,i[1]*=l,i[5]*=h,i[9]*=g,i[2]*=l,i[6]*=h,i[10]*=g,i[3]*=l,i[7]*=h,i[11]*=g,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],l=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],h=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,l,h))}makeTranslation(e,i,l){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,l,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),l=Math.sin(e);return this.set(1,0,0,0,0,i,-l,0,0,l,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),l=Math.sin(e);return this.set(i,0,l,0,0,1,0,0,-l,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),l=Math.sin(e);return this.set(i,-l,0,0,l,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const l=Math.cos(i),h=Math.sin(i),g=1-l,v=e.x,r=e.y,C=e.z,I=g*v,z=g*r;return this.set(I*v+l,I*r-h*C,I*C+h*r,0,I*r+h*C,z*r+l,z*C-h*v,0,I*C-h*r,z*C+h*v,g*C*C+l,0,0,0,0,1),this}makeScale(e,i,l){return this.set(e,0,0,0,0,i,0,0,0,0,l,0,0,0,0,1),this}makeShear(e,i,l,h,g,v){return this.set(1,l,g,0,e,1,v,0,i,h,1,0,0,0,0,1),this}compose(e,i,l){const h=this.elements,g=i._x,v=i._y,r=i._z,C=i._w,I=g+g,z=v+v,N=r+r,k=g*I,j=g*z,$=g*N,re=v*z,ie=v*N,Y=r*N,ae=C*I,ue=C*z,me=C*N,Ae=l.x,Se=l.y,ze=l.z;return h[0]=(1-(re+Y))*Ae,h[1]=(j+me)*Ae,h[2]=($-ue)*Ae,h[3]=0,h[4]=(j-me)*Se,h[5]=(1-(k+Y))*Se,h[6]=(ie+ae)*Se,h[7]=0,h[8]=($+ue)*ze,h[9]=(ie-ae)*ze,h[10]=(1-(k+re))*ze,h[11]=0,h[12]=e.x,h[13]=e.y,h[14]=e.z,h[15]=1,this}decompose(e,i,l){const h=this.elements;let g=mx.set(h[0],h[1],h[2]).length();const v=mx.set(h[4],h[5],h[6]).length(),r=mx.set(h[8],h[9],h[10]).length();this.determinant()<0&&(g=-g),e.x=h[12],e.y=h[13],e.z=h[14],ym.copy(this);const I=1/g,z=1/v,N=1/r;return ym.elements[0]*=I,ym.elements[1]*=I,ym.elements[2]*=I,ym.elements[4]*=z,ym.elements[5]*=z,ym.elements[6]*=z,ym.elements[8]*=N,ym.elements[9]*=N,ym.elements[10]*=N,i.setFromRotationMatrix(ym),l.x=g,l.y=v,l.z=r,this}makePerspective(e,i,l,h,g,v,r=Ud,C=!1){const I=this.elements,z=2*g/(i-e),N=2*g/(l-h),k=(i+e)/(i-e),j=(l+h)/(l-h);let $,re;if(C)$=g/(v-g),re=v*g/(v-g);else if(r===Ud)$=-(v+g)/(v-g),re=-2*v*g/(v-g);else if(r===rv)$=-v/(v-g),re=-v*g/(v-g);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+r);return I[0]=z,I[4]=0,I[8]=k,I[12]=0,I[1]=0,I[5]=N,I[9]=j,I[13]=0,I[2]=0,I[6]=0,I[10]=$,I[14]=re,I[3]=0,I[7]=0,I[11]=-1,I[15]=0,this}makeOrthographic(e,i,l,h,g,v,r=Ud,C=!1){const I=this.elements,z=2/(i-e),N=2/(l-h),k=-(i+e)/(i-e),j=-(l+h)/(l-h);let $,re;if(C)$=1/(v-g),re=v/(v-g);else if(r===Ud)$=-2/(v-g),re=-(v+g)/(v-g);else if(r===rv)$=-1/(v-g),re=-g/(v-g);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+r);return I[0]=z,I[4]=0,I[8]=0,I[12]=k,I[1]=0,I[5]=N,I[9]=0,I[13]=j,I[2]=0,I[6]=0,I[10]=$,I[14]=re,I[3]=0,I[7]=0,I[11]=0,I[15]=1,this}equals(e){const i=this.elements,l=e.elements;for(let h=0;h<16;h++)if(i[h]!==l[h])return!1;return!0}fromArray(e,i=0){for(let l=0;l<16;l++)this.elements[l]=e[l+i];return this}toArray(e=[],i=0){const l=this.elements;return e[i]=l[0],e[i+1]=l[1],e[i+2]=l[2],e[i+3]=l[3],e[i+4]=l[4],e[i+5]=l[5],e[i+6]=l[6],e[i+7]=l[7],e[i+8]=l[8],e[i+9]=l[9],e[i+10]=l[10],e[i+11]=l[11],e[i+12]=l[12],e[i+13]=l[13],e[i+14]=l[14],e[i+15]=l[15],e}}const mx=new gt,ym=new ps,J$=new gt(0,0,0),Q$=new gt(1,1,1),N_=new gt,VS=new gt,Od=new gt,hB=new ps,fB=new Yf;class Hd{constructor(e=0,i=0,l=0,h=Hd.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=l,this._order=h}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,l,h=this._order){return this._x=e,this._y=i,this._z=l,this._order=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,l=!0){const h=e.elements,g=h[0],v=h[4],r=h[8],C=h[1],I=h[5],z=h[9],N=h[2],k=h[6],j=h[10];switch(i){case"XYZ":this._y=Math.asin(os(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-z,j),this._z=Math.atan2(-v,g)):(this._x=Math.atan2(k,I),this._z=0);break;case"YXZ":this._x=Math.asin(-os(z,-1,1)),Math.abs(z)<.9999999?(this._y=Math.atan2(r,j),this._z=Math.atan2(C,I)):(this._y=Math.atan2(-N,g),this._z=0);break;case"ZXY":this._x=Math.asin(os(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(-N,j),this._z=Math.atan2(-v,I)):(this._y=0,this._z=Math.atan2(C,g));break;case"ZYX":this._y=Math.asin(-os(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(k,j),this._z=Math.atan2(C,g)):(this._x=0,this._z=Math.atan2(-v,I));break;case"YZX":this._z=Math.asin(os(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-z,I),this._y=Math.atan2(-N,g)):(this._x=0,this._y=Math.atan2(r,j));break;case"XZY":this._z=Math.asin(-os(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(k,I),this._y=Math.atan2(r,g)):(this._x=Math.atan2(-z,j),this._y=0);break;default:ir("Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,l===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,l){return hB.makeRotationFromQuaternion(e),this.setFromRotationMatrix(hB,i,l)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return fB.setFromEuler(this),this.setFromQuaternion(fB,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Hd.DEFAULT_ORDER="XYZ";class ov{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let eJ=0;const dB=new gt,gx=new Yf,Vg=new ps,GS=new gt,D1=new gt,tJ=new gt,iJ=new Yf,pB=new gt(1,0,0),mB=new gt(0,1,0),gB=new gt(0,0,1),_B={type:"added"},nJ={type:"removed"},_x={type:"childadded",child:null},r3={type:"childremoved",child:null};class va extends jd{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:eJ++}),this.uuid=Vd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=va.DEFAULT_UP.clone();const e=new gt,i=new Hd,l=new Yf,h=new gt(1,1,1);function g(){l.setFromEuler(i,!1)}function v(){i.setFromQuaternion(l,void 0,!1)}i._onChange(g),l._onChange(v),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:l},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new ps},normalMatrix:{value:new Ps}}),this.matrix=new ps,this.matrixWorld=new ps,this.matrixAutoUpdate=va.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=va.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ov,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return gx.setFromAxisAngle(e,i),this.quaternion.multiply(gx),this}rotateOnWorldAxis(e,i){return gx.setFromAxisAngle(e,i),this.quaternion.premultiply(gx),this}rotateX(e){return this.rotateOnAxis(pB,e)}rotateY(e){return this.rotateOnAxis(mB,e)}rotateZ(e){return this.rotateOnAxis(gB,e)}translateOnAxis(e,i){return dB.copy(e).applyQuaternion(this.quaternion),this.position.add(dB.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(pB,e)}translateY(e){return this.translateOnAxis(mB,e)}translateZ(e){return this.translateOnAxis(gB,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Vg.copy(this.matrixWorld).invert())}lookAt(e,i,l){e.isVector3?GS.copy(e):GS.set(e,i,l);const h=this.parent;this.updateWorldMatrix(!0,!1),D1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vg.lookAt(D1,GS,this.up):Vg.lookAt(GS,D1,this.up),this.quaternion.setFromRotationMatrix(Vg),h&&(Vg.extractRotation(h.matrixWorld),gx.setFromRotationMatrix(Vg),this.quaternion.premultiply(gx.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(ys("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_B),_x.child=e,this.dispatchEvent(_x),_x.child=null):ys("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.remove(arguments[l]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(nJ),r3.child=e,this.dispatchEvent(r3),r3.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Vg.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Vg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Vg),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_B),_x.child=e,this.dispatchEvent(_x),_x.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let l=0,h=this.children.length;l<h;l++){const v=this.children[l].getObjectByProperty(e,i);if(v!==void 0)return v}}getObjectsByProperty(e,i,l=[]){this[e]===i&&l.push(this);const h=this.children;for(let g=0,v=h.length;g<v;g++)h[g].getObjectsByProperty(e,i,l);return l}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(D1,e,tJ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(D1,iJ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let l=0,h=i.length;l<h;l++)i[l].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let l=0,h=i.length;l<h;l++)i[l].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let l=0,h=i.length;l<h;l++)i[l].updateMatrixWorld(e)}updateWorldMatrix(e,i){const l=this.parent;if(e===!0&&l!==null&&l.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const h=this.children;for(let g=0,v=h.length;g<v;g++)h[g].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",l={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},l.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const h={};h.uuid=this.uuid,h.type=this.type,this.name!==""&&(h.name=this.name),this.castShadow===!0&&(h.castShadow=!0),this.receiveShadow===!0&&(h.receiveShadow=!0),this.visible===!1&&(h.visible=!1),this.frustumCulled===!1&&(h.frustumCulled=!1),this.renderOrder!==0&&(h.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(h.userData=this.userData),h.layers=this.layers.mask,h.matrix=this.matrix.toArray(),h.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(h.matrixAutoUpdate=!1),this.isInstancedMesh&&(h.type="InstancedMesh",h.count=this.count,h.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(h.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(h.type="BatchedMesh",h.perObjectFrustumCulled=this.perObjectFrustumCulled,h.sortObjects=this.sortObjects,h.drawRanges=this._drawRanges,h.reservedRanges=this._reservedRanges,h.geometryInfo=this._geometryInfo.map(r=>({...r,boundingBox:r.boundingBox?r.boundingBox.toJSON():void 0,boundingSphere:r.boundingSphere?r.boundingSphere.toJSON():void 0})),h.instanceInfo=this._instanceInfo.map(r=>({...r})),h.availableInstanceIds=this._availableInstanceIds.slice(),h.availableGeometryIds=this._availableGeometryIds.slice(),h.nextIndexStart=this._nextIndexStart,h.nextVertexStart=this._nextVertexStart,h.geometryCount=this._geometryCount,h.maxInstanceCount=this._maxInstanceCount,h.maxVertexCount=this._maxVertexCount,h.maxIndexCount=this._maxIndexCount,h.geometryInitialized=this._geometryInitialized,h.matricesTexture=this._matricesTexture.toJSON(e),h.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(h.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(h.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(h.boundingBox=this.boundingBox.toJSON()));function g(r,C){return r[C.uuid]===void 0&&(r[C.uuid]=C.toJSON(e)),C.uuid}if(this.isScene)this.background&&(this.background.isColor?h.background=this.background.toJSON():this.background.isTexture&&(h.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(h.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){h.geometry=g(e.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const C=r.shapes;if(Array.isArray(C))for(let I=0,z=C.length;I<z;I++){const N=C[I];g(e.shapes,N)}else g(e.shapes,C)}}if(this.isSkinnedMesh&&(h.bindMode=this.bindMode,h.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(g(e.skeletons,this.skeleton),h.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let C=0,I=this.material.length;C<I;C++)r.push(g(e.materials,this.material[C]));h.material=r}else h.material=g(e.materials,this.material);if(this.children.length>0){h.children=[];for(let r=0;r<this.children.length;r++)h.children.push(this.children[r].toJSON(e).object)}if(this.animations.length>0){h.animations=[];for(let r=0;r<this.animations.length;r++){const C=this.animations[r];h.animations.push(g(e.animations,C))}}if(i){const r=v(e.geometries),C=v(e.materials),I=v(e.textures),z=v(e.images),N=v(e.shapes),k=v(e.skeletons),j=v(e.animations),$=v(e.nodes);r.length>0&&(l.geometries=r),C.length>0&&(l.materials=C),I.length>0&&(l.textures=I),z.length>0&&(l.images=z),N.length>0&&(l.shapes=N),k.length>0&&(l.skeletons=k),j.length>0&&(l.animations=j),$.length>0&&(l.nodes=$)}return l.object=h,l;function v(r){const C=[];for(const I in r){const z=r[I];delete z.metadata,C.push(z)}return C}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let l=0;l<e.children.length;l++){const h=e.children[l];this.add(h.clone())}return this}}va.DEFAULT_UP=new gt(0,1,0);va.DEFAULT_MATRIX_AUTO_UPDATE=!0;va.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const xm=new gt,Gg=new gt,s3=new gt,Hg=new gt,yx=new gt,xx=new gt,yB=new gt,a3=new gt,o3=new gt,l3=new gt,c3=new xa,u3=new xa,h3=new xa;class qf{constructor(e=new gt,i=new gt,l=new gt){this.a=e,this.b=i,this.c=l}static getNormal(e,i,l,h){h.subVectors(l,i),xm.subVectors(e,i),h.cross(xm);const g=h.lengthSq();return g>0?h.multiplyScalar(1/Math.sqrt(g)):h.set(0,0,0)}static getBarycoord(e,i,l,h,g){xm.subVectors(h,i),Gg.subVectors(l,i),s3.subVectors(e,i);const v=xm.dot(xm),r=xm.dot(Gg),C=xm.dot(s3),I=Gg.dot(Gg),z=Gg.dot(s3),N=v*I-r*r;if(N===0)return g.set(0,0,0),null;const k=1/N,j=(I*C-r*z)*k,$=(v*z-r*C)*k;return g.set(1-j-$,$,j)}static containsPoint(e,i,l,h){return this.getBarycoord(e,i,l,h,Hg)===null?!1:Hg.x>=0&&Hg.y>=0&&Hg.x+Hg.y<=1}static getInterpolation(e,i,l,h,g,v,r,C){return this.getBarycoord(e,i,l,h,Hg)===null?(C.x=0,C.y=0,"z"in C&&(C.z=0),"w"in C&&(C.w=0),null):(C.setScalar(0),C.addScaledVector(g,Hg.x),C.addScaledVector(v,Hg.y),C.addScaledVector(r,Hg.z),C)}static getInterpolatedAttribute(e,i,l,h,g,v){return c3.setScalar(0),u3.setScalar(0),h3.setScalar(0),c3.fromBufferAttribute(e,i),u3.fromBufferAttribute(e,l),h3.fromBufferAttribute(e,h),v.setScalar(0),v.addScaledVector(c3,g.x),v.addScaledVector(u3,g.y),v.addScaledVector(h3,g.z),v}static isFrontFacing(e,i,l,h){return xm.subVectors(l,i),Gg.subVectors(e,i),xm.cross(Gg).dot(h)<0}set(e,i,l){return this.a.copy(e),this.b.copy(i),this.c.copy(l),this}setFromPointsAndIndices(e,i,l,h){return this.a.copy(e[i]),this.b.copy(e[l]),this.c.copy(e[h]),this}setFromAttributeAndIndices(e,i,l,h){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,l),this.c.fromBufferAttribute(e,h),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return xm.subVectors(this.c,this.b),Gg.subVectors(this.a,this.b),xm.cross(Gg).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qf.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return qf.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,l,h,g){return qf.getInterpolation(e,this.a,this.b,this.c,i,l,h,g)}containsPoint(e){return qf.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return qf.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const l=this.a,h=this.b,g=this.c;let v,r;yx.subVectors(h,l),xx.subVectors(g,l),a3.subVectors(e,l);const C=yx.dot(a3),I=xx.dot(a3);if(C<=0&&I<=0)return i.copy(l);o3.subVectors(e,h);const z=yx.dot(o3),N=xx.dot(o3);if(z>=0&&N<=z)return i.copy(h);const k=C*N-z*I;if(k<=0&&C>=0&&z<=0)return v=C/(C-z),i.copy(l).addScaledVector(yx,v);l3.subVectors(e,g);const j=yx.dot(l3),$=xx.dot(l3);if($>=0&&j<=$)return i.copy(g);const re=j*I-C*$;if(re<=0&&I>=0&&$<=0)return r=I/(I-$),i.copy(l).addScaledVector(xx,r);const ie=z*$-j*N;if(ie<=0&&N-z>=0&&j-$>=0)return yB.subVectors(g,h),r=(N-z)/(N-z+(j-$)),i.copy(h).addScaledVector(yB,r);const Y=1/(ie+re+k);return v=re*Y,r=k*Y,i.copy(l).addScaledVector(yx,v).addScaledVector(xx,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Z5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},F_={h:0,s:0,l:0},HS={h:0,s:0,l:0};function f3(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}class ar{constructor(e,i,l){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,l)}set(e,i,l){if(i===void 0&&l===void 0){const h=e;h&&h.isColor?this.copy(h):typeof h=="number"?this.setHex(h):typeof h=="string"&&this.setStyle(h)}else this.setRGB(e,i,l);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Io){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,oa.colorSpaceToWorking(this,i),this}setRGB(e,i,l,h=oa.workingColorSpace){return this.r=e,this.g=i,this.b=l,oa.colorSpaceToWorking(this,h),this}setHSL(e,i,l,h=oa.workingColorSpace){if(e=DI(e,1),i=os(i,0,1),l=os(l,0,1),i===0)this.r=this.g=this.b=l;else{const g=l<=.5?l*(1+i):l+i-l*i,v=2*l-g;this.r=f3(v,g,e+1/3),this.g=f3(v,g,e),this.b=f3(v,g,e-1/3)}return oa.colorSpaceToWorking(this,h),this}setStyle(e,i=Io){function l(g){g!==void 0&&parseFloat(g)<1&&ir("Color: Alpha component of "+e+" will be ignored.")}let h;if(h=/^(\w+)\(([^\)]*)\)/.exec(e)){let g;const v=h[1],r=h[2];switch(v){case"rgb":case"rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return l(g[4]),this.setRGB(Math.min(255,parseInt(g[1],10))/255,Math.min(255,parseInt(g[2],10))/255,Math.min(255,parseInt(g[3],10))/255,i);if(g=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return l(g[4]),this.setRGB(Math.min(100,parseInt(g[1],10))/100,Math.min(100,parseInt(g[2],10))/100,Math.min(100,parseInt(g[3],10))/100,i);break;case"hsl":case"hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return l(g[4]),this.setHSL(parseFloat(g[1])/360,parseFloat(g[2])/100,parseFloat(g[3])/100,i);break;default:ir("Color: Unknown color model "+e)}}else if(h=/^\#([A-Fa-f\d]+)$/.exec(e)){const g=h[1],v=g.length;if(v===3)return this.setRGB(parseInt(g.charAt(0),16)/15,parseInt(g.charAt(1),16)/15,parseInt(g.charAt(2),16)/15,i);if(v===6)return this.setHex(parseInt(g,16),i);ir("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Io){const l=Z5[e.toLowerCase()];return l!==void 0?this.setHex(l,i):ir("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Kg(e.r),this.g=Kg(e.g),this.b=Kg(e.b),this}copyLinearToSRGB(e){return this.r=Wx(e.r),this.g=Wx(e.g),this.b=Wx(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Io){return oa.workingToColorSpace(ph.copy(this),e),Math.round(os(ph.r*255,0,255))*65536+Math.round(os(ph.g*255,0,255))*256+Math.round(os(ph.b*255,0,255))}getHexString(e=Io){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=oa.workingColorSpace){oa.workingToColorSpace(ph.copy(this),i);const l=ph.r,h=ph.g,g=ph.b,v=Math.max(l,h,g),r=Math.min(l,h,g);let C,I;const z=(r+v)/2;if(r===v)C=0,I=0;else{const N=v-r;switch(I=z<=.5?N/(v+r):N/(2-v-r),v){case l:C=(h-g)/N+(h<g?6:0);break;case h:C=(g-l)/N+2;break;case g:C=(l-h)/N+4;break}C/=6}return e.h=C,e.s=I,e.l=z,e}getRGB(e,i=oa.workingColorSpace){return oa.workingToColorSpace(ph.copy(this),i),e.r=ph.r,e.g=ph.g,e.b=ph.b,e}getStyle(e=Io){oa.workingToColorSpace(ph.copy(this),e);const i=ph.r,l=ph.g,h=ph.b;return e!==Io?`color(${e} ${i.toFixed(3)} ${l.toFixed(3)} ${h.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(l*255)},${Math.round(h*255)})`}offsetHSL(e,i,l){return this.getHSL(F_),this.setHSL(F_.h+e,F_.s+i,F_.l+l)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,l){return this.r=e.r+(i.r-e.r)*l,this.g=e.g+(i.g-e.g)*l,this.b=e.b+(i.b-e.b)*l,this}lerpHSL(e,i){this.getHSL(F_),e.getHSL(HS);const l=_b(F_.h,HS.h,i),h=_b(F_.s,HS.s,i),g=_b(F_.l,HS.l,i);return this.setHSL(l,h,g),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,l=this.g,h=this.b,g=e.elements;return this.r=g[0]*i+g[3]*l+g[6]*h,this.g=g[1]*i+g[4]*l+g[7]*h,this.b=g[2]*i+g[5]*l+g[8]*h,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ph=new ar;ar.NAMES=Z5;let rJ=0;class tu extends jd{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:rJ++}),this.uuid=Vd(),this.name="",this.type="Material",this.blending=dy,this.side=fg,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=A2,this.blendDst=C2,this.blendEquation=X_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ar(0,0,0),this.blendAlpha=0,this.depthFunc=by,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hR,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=iy,this.stencilZFail=iy,this.stencilZPass=iy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const l=e[i];if(l===void 0){ir(`Material: parameter '${i}' has value of undefined.`);continue}const h=this[i];if(h===void 0){ir(`Material: '${i}' is not a property of THREE.${this.type}.`);continue}h&&h.isColor?h.set(l):h&&h.isVector3&&l&&l.isVector3?h.copy(l):this[i]=l}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const l={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.color&&this.color.isColor&&(l.color=this.color.getHex()),this.roughness!==void 0&&(l.roughness=this.roughness),this.metalness!==void 0&&(l.metalness=this.metalness),this.sheen!==void 0&&(l.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(l.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(l.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(l.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(l.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(l.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(l.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(l.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(l.shininess=this.shininess),this.clearcoat!==void 0&&(l.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(l.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(l.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(l.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(l.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,l.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(l.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(l.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(l.dispersion=this.dispersion),this.iridescence!==void 0&&(l.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(l.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(l.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(l.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(l.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(l.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(l.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(l.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(l.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(l.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(l.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(l.lightMap=this.lightMap.toJSON(e).uuid,l.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(l.aoMap=this.aoMap.toJSON(e).uuid,l.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(l.bumpMap=this.bumpMap.toJSON(e).uuid,l.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(l.normalMap=this.normalMap.toJSON(e).uuid,l.normalMapType=this.normalMapType,l.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(l.displacementMap=this.displacementMap.toJSON(e).uuid,l.displacementScale=this.displacementScale,l.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(l.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(l.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(l.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(l.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(l.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(l.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(l.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(l.combine=this.combine)),this.envMapRotation!==void 0&&(l.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(l.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(l.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(l.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(l.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(l.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(l.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(l.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(l.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(l.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(l.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(l.size=this.size),this.shadowSide!==null&&(l.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(l.sizeAttenuation=this.sizeAttenuation),this.blending!==dy&&(l.blending=this.blending),this.side!==fg&&(l.side=this.side),this.vertexColors===!0&&(l.vertexColors=!0),this.opacity<1&&(l.opacity=this.opacity),this.transparent===!0&&(l.transparent=!0),this.blendSrc!==A2&&(l.blendSrc=this.blendSrc),this.blendDst!==C2&&(l.blendDst=this.blendDst),this.blendEquation!==X_&&(l.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(l.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(l.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(l.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(l.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(l.blendAlpha=this.blendAlpha),this.depthFunc!==by&&(l.depthFunc=this.depthFunc),this.depthTest===!1&&(l.depthTest=this.depthTest),this.depthWrite===!1&&(l.depthWrite=this.depthWrite),this.colorWrite===!1&&(l.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(l.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==hR&&(l.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(l.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(l.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==iy&&(l.stencilFail=this.stencilFail),this.stencilZFail!==iy&&(l.stencilZFail=this.stencilZFail),this.stencilZPass!==iy&&(l.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(l.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(l.rotation=this.rotation),this.polygonOffset===!0&&(l.polygonOffset=!0),this.polygonOffsetFactor!==0&&(l.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(l.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(l.linewidth=this.linewidth),this.dashSize!==void 0&&(l.dashSize=this.dashSize),this.gapSize!==void 0&&(l.gapSize=this.gapSize),this.scale!==void 0&&(l.scale=this.scale),this.dithering===!0&&(l.dithering=!0),this.alphaTest>0&&(l.alphaTest=this.alphaTest),this.alphaHash===!0&&(l.alphaHash=!0),this.alphaToCoverage===!0&&(l.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(l.premultipliedAlpha=!0),this.forceSinglePass===!0&&(l.forceSinglePass=!0),this.wireframe===!0&&(l.wireframe=!0),this.wireframeLinewidth>1&&(l.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(l.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(l.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(l.flatShading=!0),this.visible===!1&&(l.visible=!1),this.toneMapped===!1&&(l.toneMapped=!1),this.fog===!1&&(l.fog=!1),Object.keys(this.userData).length>0&&(l.userData=this.userData);function h(g){const v=[];for(const r in g){const C=g[r];delete C.metadata,v.push(C)}return v}if(i){const g=h(e.textures),v=h(e.images);g.length>0&&(l.textures=g),v.length>0&&(l.images=v)}return l}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let l=null;if(i!==null){const h=i.length;l=new Array(h);for(let g=0;g!==h;++g)l[g]=i[g].clone()}return this.clippingPlanes=l,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class o0 extends tu{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ar(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hd,this.combine=uw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Zg=sJ();function sJ(){const n=new ArrayBuffer(4),e=new Float32Array(n),i=new Uint32Array(n),l=new Uint32Array(512),h=new Uint32Array(512);for(let C=0;C<256;++C){const I=C-127;I<-27?(l[C]=0,l[C|256]=32768,h[C]=24,h[C|256]=24):I<-14?(l[C]=1024>>-I-14,l[C|256]=1024>>-I-14|32768,h[C]=-I-1,h[C|256]=-I-1):I<=15?(l[C]=I+15<<10,l[C|256]=I+15<<10|32768,h[C]=13,h[C|256]=13):I<128?(l[C]=31744,l[C|256]=64512,h[C]=24,h[C|256]=24):(l[C]=31744,l[C|256]=64512,h[C]=13,h[C|256]=13)}const g=new Uint32Array(2048),v=new Uint32Array(64),r=new Uint32Array(64);for(let C=1;C<1024;++C){let I=C<<13,z=0;for(;(I&8388608)===0;)I<<=1,z-=8388608;I&=-8388609,z+=947912704,g[C]=I|z}for(let C=1024;C<2048;++C)g[C]=939524096+(C-1024<<13);for(let C=1;C<31;++C)v[C]=C<<23;v[31]=1199570944,v[32]=2147483648;for(let C=33;C<63;++C)v[C]=2147483648+(C-32<<23);v[63]=3347054592;for(let C=1;C<64;++C)C!==32&&(r[C]=1024);return{floatView:e,uint32View:i,baseTable:l,shiftTable:h,mantissaTable:g,exponentTable:v,offsetTable:r}}function kf(n){Math.abs(n)>65504&&ir("DataUtils.toHalfFloat(): Value out of range."),n=os(n,-65504,65504),Zg.floatView[0]=n;const e=Zg.uint32View[0],i=e>>23&511;return Zg.baseTable[i]+((e&8388607)>>Zg.shiftTable[i])}function eb(n){const e=n>>10;return Zg.uint32View[0]=Zg.mantissaTable[Zg.offsetTable[e]+(n&1023)]+Zg.exponentTable[e],Zg.floatView[0]}class aJ{static toHalfFloat(e){return kf(e)}static fromHalfFloat(e){return eb(e)}}const nc=new gt,jS=new $i;let oJ=0;class Ba{constructor(e,i,l=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:oJ++}),this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=l,this.usage=Hb,this.updateRanges=[],this.gpuType=$h,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,l){e*=this.itemSize,l*=i.itemSize;for(let h=0,g=this.itemSize;h<g;h++)this.array[e+h]=i.array[l+h];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,l=this.count;i<l;i++)jS.fromBufferAttribute(this,i),jS.applyMatrix3(e),this.setXY(i,jS.x,jS.y);else if(this.itemSize===3)for(let i=0,l=this.count;i<l;i++)nc.fromBufferAttribute(this,i),nc.applyMatrix3(e),this.setXYZ(i,nc.x,nc.y,nc.z);return this}applyMatrix4(e){for(let i=0,l=this.count;i<l;i++)nc.fromBufferAttribute(this,i),nc.applyMatrix4(e),this.setXYZ(i,nc.x,nc.y,nc.z);return this}applyNormalMatrix(e){for(let i=0,l=this.count;i<l;i++)nc.fromBufferAttribute(this,i),nc.applyNormalMatrix(e),this.setXYZ(i,nc.x,nc.y,nc.z);return this}transformDirection(e){for(let i=0,l=this.count;i<l;i++)nc.fromBufferAttribute(this,i),nc.transformDirection(e),this.setXYZ(i,nc.x,nc.y,nc.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let l=this.array[e*this.itemSize+i];return this.normalized&&(l=Yh(l,this.array)),l}setComponent(e,i,l){return this.normalized&&(l=Us(l,this.array)),this.array[e*this.itemSize+i]=l,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=Yh(i,this.array)),i}setX(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=Yh(i,this.array)),i}setY(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=Yh(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=Yh(i,this.array)),i}setW(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,l){return e*=this.itemSize,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array)),this.array[e+0]=i,this.array[e+1]=l,this}setXYZ(e,i,l,h){return e*=this.itemSize,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array),h=Us(h,this.array)),this.array[e+0]=i,this.array[e+1]=l,this.array[e+2]=h,this}setXYZW(e,i,l,h,g){return e*=this.itemSize,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array),h=Us(h,this.array),g=Us(g,this.array)),this.array[e+0]=i,this.array[e+1]=l,this.array[e+2]=h,this.array[e+3]=g,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Hb&&(e.usage=this.usage),e}}class lJ extends Ba{constructor(e,i,l){super(new Int8Array(e),i,l)}}class cJ extends Ba{constructor(e,i,l){super(new Uint8Array(e),i,l)}}class uJ extends Ba{constructor(e,i,l){super(new Uint8ClampedArray(e),i,l)}}class hJ extends Ba{constructor(e,i,l){super(new Int16Array(e),i,l)}}class PI extends Ba{constructor(e,i,l){super(new Uint16Array(e),i,l)}}class fJ extends Ba{constructor(e,i,l){super(new Int32Array(e),i,l)}}class zI extends Ba{constructor(e,i,l){super(new Uint32Array(e),i,l)}}class dJ extends Ba{constructor(e,i,l){super(new Uint16Array(e),i,l),this.isFloat16BufferAttribute=!0}getX(e){let i=eb(this.array[e*this.itemSize]);return this.normalized&&(i=Yh(i,this.array)),i}setX(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize]=kf(i),this}getY(e){let i=eb(this.array[e*this.itemSize+1]);return this.normalized&&(i=Yh(i,this.array)),i}setY(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+1]=kf(i),this}getZ(e){let i=eb(this.array[e*this.itemSize+2]);return this.normalized&&(i=Yh(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+2]=kf(i),this}getW(e){let i=eb(this.array[e*this.itemSize+3]);return this.normalized&&(i=Yh(i,this.array)),i}setW(e,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+3]=kf(i),this}setXY(e,i,l){return e*=this.itemSize,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array)),this.array[e+0]=kf(i),this.array[e+1]=kf(l),this}setXYZ(e,i,l,h){return e*=this.itemSize,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array),h=Us(h,this.array)),this.array[e+0]=kf(i),this.array[e+1]=kf(l),this.array[e+2]=kf(h),this}setXYZW(e,i,l,h,g){return e*=this.itemSize,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array),h=Us(h,this.array),g=Us(g,this.array)),this.array[e+0]=kf(i),this.array[e+1]=kf(l),this.array[e+2]=kf(h),this.array[e+3]=kf(g),this}}class Mr extends Ba{constructor(e,i,l){super(new Float32Array(e),i,l)}}let pJ=0;const Tp=new ps,d3=new va,vx=new gt,Bd=new yh,L1=new yh,eu=new gt;class Is extends jd{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:pJ++}),this.uuid=Vd(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(q5(e)?zI:PI)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,l=0){this.groups.push({start:e,count:i,materialIndex:l})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const l=this.attributes.normal;if(l!==void 0){const g=new Ps().getNormalMatrix(e);l.applyNormalMatrix(g),l.needsUpdate=!0}const h=this.attributes.tangent;return h!==void 0&&(h.transformDirection(e),h.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Tp.makeRotationFromQuaternion(e),this.applyMatrix4(Tp),this}rotateX(e){return Tp.makeRotationX(e),this.applyMatrix4(Tp),this}rotateY(e){return Tp.makeRotationY(e),this.applyMatrix4(Tp),this}rotateZ(e){return Tp.makeRotationZ(e),this.applyMatrix4(Tp),this}translate(e,i,l){return Tp.makeTranslation(e,i,l),this.applyMatrix4(Tp),this}scale(e,i,l){return Tp.makeScale(e,i,l),this.applyMatrix4(Tp),this}lookAt(e){return d3.lookAt(e),d3.updateMatrix(),this.applyMatrix4(d3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vx).negate(),this.translate(vx.x,vx.y,vx.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const l=[];for(let h=0,g=e.length;h<g;h++){const v=e[h];l.push(v.x,v.y,v.z||0)}this.setAttribute("position",new Mr(l,3))}else{const l=Math.min(e.length,i.count);for(let h=0;h<l;h++){const g=e[h];i.setXYZ(h,g.x,g.y,g.z||0)}e.length>i.count&&ir("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yh);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){ys("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new gt(-1/0,-1/0,-1/0),new gt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let l=0,h=i.length;l<h;l++){const g=i[l];Bd.setFromBufferAttribute(g),this.morphTargetsRelative?(eu.addVectors(this.boundingBox.min,Bd.min),this.boundingBox.expandByPoint(eu),eu.addVectors(this.boundingBox.max,Bd.max),this.boundingBox.expandByPoint(eu)):(this.boundingBox.expandByPoint(Bd.min),this.boundingBox.expandByPoint(Bd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&ys('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ou);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){ys("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new gt,1/0);return}if(e){const l=this.boundingSphere.center;if(Bd.setFromBufferAttribute(e),i)for(let g=0,v=i.length;g<v;g++){const r=i[g];L1.setFromBufferAttribute(r),this.morphTargetsRelative?(eu.addVectors(Bd.min,L1.min),Bd.expandByPoint(eu),eu.addVectors(Bd.max,L1.max),Bd.expandByPoint(eu)):(Bd.expandByPoint(L1.min),Bd.expandByPoint(L1.max))}Bd.getCenter(l);let h=0;for(let g=0,v=e.count;g<v;g++)eu.fromBufferAttribute(e,g),h=Math.max(h,l.distanceToSquared(eu));if(i)for(let g=0,v=i.length;g<v;g++){const r=i[g],C=this.morphTargetsRelative;for(let I=0,z=r.count;I<z;I++)eu.fromBufferAttribute(r,I),C&&(vx.fromBufferAttribute(e,I),eu.add(vx)),h=Math.max(h,l.distanceToSquared(eu))}this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&ys('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){ys("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const l=i.position,h=i.normal,g=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ba(new Float32Array(4*l.count),4));const v=this.getAttribute("tangent"),r=[],C=[];for(let je=0;je<l.count;je++)r[je]=new gt,C[je]=new gt;const I=new gt,z=new gt,N=new gt,k=new $i,j=new $i,$=new $i,re=new gt,ie=new gt;function Y(je,Ce,Te){I.fromBufferAttribute(l,je),z.fromBufferAttribute(l,Ce),N.fromBufferAttribute(l,Te),k.fromBufferAttribute(g,je),j.fromBufferAttribute(g,Ce),$.fromBufferAttribute(g,Te),z.sub(I),N.sub(I),j.sub(k),$.sub(k);const Ze=1/(j.x*$.y-$.x*j.y);isFinite(Ze)&&(re.copy(z).multiplyScalar($.y).addScaledVector(N,-j.y).multiplyScalar(Ze),ie.copy(N).multiplyScalar(j.x).addScaledVector(z,-$.x).multiplyScalar(Ze),r[je].add(re),r[Ce].add(re),r[Te].add(re),C[je].add(ie),C[Ce].add(ie),C[Te].add(ie))}let ae=this.groups;ae.length===0&&(ae=[{start:0,count:e.count}]);for(let je=0,Ce=ae.length;je<Ce;++je){const Te=ae[je],Ze=Te.start,Mt=Te.count;for(let mt=Ze,Gt=Ze+Mt;mt<Gt;mt+=3)Y(e.getX(mt+0),e.getX(mt+1),e.getX(mt+2))}const ue=new gt,me=new gt,Ae=new gt,Se=new gt;function ze(je){Ae.fromBufferAttribute(h,je),Se.copy(Ae);const Ce=r[je];ue.copy(Ce),ue.sub(Ae.multiplyScalar(Ae.dot(Ce))).normalize(),me.crossVectors(Se,Ce);const Ze=me.dot(C[je])<0?-1:1;v.setXYZW(je,ue.x,ue.y,ue.z,Ze)}for(let je=0,Ce=ae.length;je<Ce;++je){const Te=ae[je],Ze=Te.start,Mt=Te.count;for(let mt=Ze,Gt=Ze+Mt;mt<Gt;mt+=3)ze(e.getX(mt+0)),ze(e.getX(mt+1)),ze(e.getX(mt+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let l=this.getAttribute("normal");if(l===void 0)l=new Ba(new Float32Array(i.count*3),3),this.setAttribute("normal",l);else for(let k=0,j=l.count;k<j;k++)l.setXYZ(k,0,0,0);const h=new gt,g=new gt,v=new gt,r=new gt,C=new gt,I=new gt,z=new gt,N=new gt;if(e)for(let k=0,j=e.count;k<j;k+=3){const $=e.getX(k+0),re=e.getX(k+1),ie=e.getX(k+2);h.fromBufferAttribute(i,$),g.fromBufferAttribute(i,re),v.fromBufferAttribute(i,ie),z.subVectors(v,g),N.subVectors(h,g),z.cross(N),r.fromBufferAttribute(l,$),C.fromBufferAttribute(l,re),I.fromBufferAttribute(l,ie),r.add(z),C.add(z),I.add(z),l.setXYZ($,r.x,r.y,r.z),l.setXYZ(re,C.x,C.y,C.z),l.setXYZ(ie,I.x,I.y,I.z)}else for(let k=0,j=i.count;k<j;k+=3)h.fromBufferAttribute(i,k+0),g.fromBufferAttribute(i,k+1),v.fromBufferAttribute(i,k+2),z.subVectors(v,g),N.subVectors(h,g),z.cross(N),l.setXYZ(k+0,z.x,z.y,z.z),l.setXYZ(k+1,z.x,z.y,z.z),l.setXYZ(k+2,z.x,z.y,z.z);this.normalizeNormals(),l.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,l=e.count;i<l;i++)eu.fromBufferAttribute(e,i),eu.normalize(),e.setXYZ(i,eu.x,eu.y,eu.z)}toNonIndexed(){function e(r,C){const I=r.array,z=r.itemSize,N=r.normalized,k=new I.constructor(C.length*z);let j=0,$=0;for(let re=0,ie=C.length;re<ie;re++){r.isInterleavedBufferAttribute?j=C[re]*r.data.stride+r.offset:j=C[re]*z;for(let Y=0;Y<z;Y++)k[$++]=I[j++]}return new Ba(k,z,N)}if(this.index===null)return ir("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Is,l=this.index.array,h=this.attributes;for(const r in h){const C=h[r],I=e(C,l);i.setAttribute(r,I)}const g=this.morphAttributes;for(const r in g){const C=[],I=g[r];for(let z=0,N=I.length;z<N;z++){const k=I[z],j=e(k,l);C.push(j)}i.morphAttributes[r]=C}i.morphTargetsRelative=this.morphTargetsRelative;const v=this.groups;for(let r=0,C=v.length;r<C;r++){const I=v[r];i.addGroup(I.start,I.count,I.materialIndex)}return i}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const C=this.parameters;for(const I in C)C[I]!==void 0&&(e[I]=C[I]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const l=this.attributes;for(const C in l){const I=l[C];e.data.attributes[C]=I.toJSON(e.data)}const h={};let g=!1;for(const C in this.morphAttributes){const I=this.morphAttributes[C],z=[];for(let N=0,k=I.length;N<k;N++){const j=I[N];z.push(j.toJSON(e.data))}z.length>0&&(h[C]=z,g=!0)}g&&(e.data.morphAttributes=h,e.data.morphTargetsRelative=this.morphTargetsRelative);const v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));const r=this.boundingSphere;return r!==null&&(e.data.boundingSphere=r.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const l=e.index;l!==null&&this.setIndex(l.clone());const h=e.attributes;for(const I in h){const z=h[I];this.setAttribute(I,z.clone(i))}const g=e.morphAttributes;for(const I in g){const z=[],N=g[I];for(let k=0,j=N.length;k<j;k++)z.push(N[k].clone(i));this.morphAttributes[I]=z}this.morphTargetsRelative=e.morphTargetsRelative;const v=e.groups;for(let I=0,z=v.length;I<z;I++){const N=v[I];this.addGroup(N.start,N.count,N.materialIndex)}const r=e.boundingBox;r!==null&&(this.boundingBox=r.clone());const C=e.boundingSphere;return C!==null&&(this.boundingSphere=C.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const xB=new ps,V0=new xv,qS=new Ou,vB=new gt,XS=new gt,WS=new gt,ZS=new gt,p3=new gt,YS=new gt,bB=new gt,KS=new gt;class sc extends va{constructor(e=new Is,i=new o0){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const h=i[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let g=0,v=h.length;g<v;g++){const r=h[g].name||String(g);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=g}}}}getVertexPosition(e,i){const l=this.geometry,h=l.attributes.position,g=l.morphAttributes.position,v=l.morphTargetsRelative;i.fromBufferAttribute(h,e);const r=this.morphTargetInfluences;if(g&&r){YS.set(0,0,0);for(let C=0,I=g.length;C<I;C++){const z=r[C],N=g[C];z!==0&&(p3.fromBufferAttribute(N,e),v?YS.addScaledVector(p3,z):YS.addScaledVector(p3.sub(i),z))}i.add(YS)}return i}raycast(e,i){const l=this.geometry,h=this.material,g=this.matrixWorld;h!==void 0&&(l.boundingSphere===null&&l.computeBoundingSphere(),qS.copy(l.boundingSphere),qS.applyMatrix4(g),V0.copy(e.ray).recast(e.near),!(qS.containsPoint(V0.origin)===!1&&(V0.intersectSphere(qS,vB)===null||V0.origin.distanceToSquared(vB)>(e.far-e.near)**2))&&(xB.copy(g).invert(),V0.copy(e.ray).applyMatrix4(xB),!(l.boundingBox!==null&&V0.intersectsBox(l.boundingBox)===!1)&&this._computeIntersections(e,i,V0)))}_computeIntersections(e,i,l){let h;const g=this.geometry,v=this.material,r=g.index,C=g.attributes.position,I=g.attributes.uv,z=g.attributes.uv1,N=g.attributes.normal,k=g.groups,j=g.drawRange;if(r!==null)if(Array.isArray(v))for(let $=0,re=k.length;$<re;$++){const ie=k[$],Y=v[ie.materialIndex],ae=Math.max(ie.start,j.start),ue=Math.min(r.count,Math.min(ie.start+ie.count,j.start+j.count));for(let me=ae,Ae=ue;me<Ae;me+=3){const Se=r.getX(me),ze=r.getX(me+1),je=r.getX(me+2);h=$S(this,Y,e,l,I,z,N,Se,ze,je),h&&(h.faceIndex=Math.floor(me/3),h.face.materialIndex=ie.materialIndex,i.push(h))}}else{const $=Math.max(0,j.start),re=Math.min(r.count,j.start+j.count);for(let ie=$,Y=re;ie<Y;ie+=3){const ae=r.getX(ie),ue=r.getX(ie+1),me=r.getX(ie+2);h=$S(this,v,e,l,I,z,N,ae,ue,me),h&&(h.faceIndex=Math.floor(ie/3),i.push(h))}}else if(C!==void 0)if(Array.isArray(v))for(let $=0,re=k.length;$<re;$++){const ie=k[$],Y=v[ie.materialIndex],ae=Math.max(ie.start,j.start),ue=Math.min(C.count,Math.min(ie.start+ie.count,j.start+j.count));for(let me=ae,Ae=ue;me<Ae;me+=3){const Se=me,ze=me+1,je=me+2;h=$S(this,Y,e,l,I,z,N,Se,ze,je),h&&(h.faceIndex=Math.floor(me/3),h.face.materialIndex=ie.materialIndex,i.push(h))}}else{const $=Math.max(0,j.start),re=Math.min(C.count,j.start+j.count);for(let ie=$,Y=re;ie<Y;ie+=3){const ae=ie,ue=ie+1,me=ie+2;h=$S(this,v,e,l,I,z,N,ae,ue,me),h&&(h.faceIndex=Math.floor(ie/3),i.push(h))}}}}function mJ(n,e,i,l,h,g,v,r){let C;if(e.side===Mc?C=l.intersectTriangle(v,g,h,!0,r):C=l.intersectTriangle(h,g,v,e.side===fg,r),C===null)return null;KS.copy(r),KS.applyMatrix4(n.matrixWorld);const I=i.ray.origin.distanceTo(KS);return I<i.near||I>i.far?null:{distance:I,point:KS.clone(),object:n}}function $S(n,e,i,l,h,g,v,r,C,I){n.getVertexPosition(r,XS),n.getVertexPosition(C,WS),n.getVertexPosition(I,ZS);const z=mJ(n,e,i,l,XS,WS,ZS,bB);if(z){const N=new gt;qf.getBarycoord(bB,XS,WS,ZS,N),h&&(z.uv=qf.getInterpolatedAttribute(h,r,C,I,N,new $i)),g&&(z.uv1=qf.getInterpolatedAttribute(g,r,C,I,N,new $i)),v&&(z.normal=qf.getInterpolatedAttribute(v,r,C,I,N,new gt),z.normal.dot(l.direction)>0&&z.normal.multiplyScalar(-1));const k={a:r,b:C,c:I,normal:new gt,materialIndex:0};qf.getNormal(XS,WS,ZS,k.normal),z.face=k,z.barycoord=N}return z}class Ay extends Is{constructor(e=1,i=1,l=1,h=1,g=1,v=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:l,widthSegments:h,heightSegments:g,depthSegments:v};const r=this;h=Math.floor(h),g=Math.floor(g),v=Math.floor(v);const C=[],I=[],z=[],N=[];let k=0,j=0;$("z","y","x",-1,-1,l,i,e,v,g,0),$("z","y","x",1,-1,l,i,-e,v,g,1),$("x","z","y",1,1,e,l,i,h,v,2),$("x","z","y",1,-1,e,l,-i,h,v,3),$("x","y","z",1,-1,e,i,l,h,g,4),$("x","y","z",-1,-1,e,i,-l,h,g,5),this.setIndex(C),this.setAttribute("position",new Mr(I,3)),this.setAttribute("normal",new Mr(z,3)),this.setAttribute("uv",new Mr(N,2));function $(re,ie,Y,ae,ue,me,Ae,Se,ze,je,Ce){const Te=me/ze,Ze=Ae/je,Mt=me/2,mt=Ae/2,Gt=Se/2,kt=ze+1,Re=je+1;let Qe=0,et=0;const Lt=new gt;for(let jt=0;jt<Re;jt++){const Ge=jt*Ze-mt;for(let Et=0;Et<kt;Et++){const Vt=Et*Te-Mt;Lt[re]=Vt*ae,Lt[ie]=Ge*ue,Lt[Y]=Gt,I.push(Lt.x,Lt.y,Lt.z),Lt[re]=0,Lt[ie]=0,Lt[Y]=Se>0?1:-1,z.push(Lt.x,Lt.y,Lt.z),N.push(Et/ze),N.push(1-jt/je),Qe+=1}}for(let jt=0;jt<je;jt++)for(let Ge=0;Ge<ze;Ge++){const Et=k+Ge+kt*jt,Vt=k+Ge+kt*(jt+1),ii=k+(Ge+1)+kt*(jt+1),ki=k+(Ge+1)+kt*jt;C.push(Et,Vt,ki),C.push(Vt,ii,ki),et+=6}r.addGroup(j,et,Ce),j+=et,k+=Qe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ay(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function lv(n){const e={};for(const i in n){e[i]={};for(const l in n[i]){const h=n[i][l];h&&(h.isColor||h.isMatrix3||h.isMatrix4||h.isVector2||h.isVector3||h.isVector4||h.isTexture||h.isQuaternion)?h.isRenderTargetTexture?(ir("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][l]=null):e[i][l]=h.clone():Array.isArray(h)?e[i][l]=h.slice():e[i][l]=h}}return e}function jh(n){const e={};for(let i=0;i<n.length;i++){const l=lv(n[i]);for(const h in l)e[h]=l[h]}return e}function gJ(n){const e=[];for(let i=0;i<n.length;i++)e.push(n[i].clone());return e}function Y5(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:oa.workingColorSpace}const K5={clone:lv,merge:jh};var _J=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,yJ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bh extends tu{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=_J,this.fragmentShader=yJ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=lv(e.uniforms),this.uniformsGroups=gJ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const h in this.uniforms){const v=this.uniforms[h].value;v&&v.isTexture?i.uniforms[h]={type:"t",value:v.toJSON(e).uuid}:v&&v.isColor?i.uniforms[h]={type:"c",value:v.getHex()}:v&&v.isVector2?i.uniforms[h]={type:"v2",value:v.toArray()}:v&&v.isVector3?i.uniforms[h]={type:"v3",value:v.toArray()}:v&&v.isVector4?i.uniforms[h]={type:"v4",value:v.toArray()}:v&&v.isMatrix3?i.uniforms[h]={type:"m3",value:v.toArray()}:v&&v.isMatrix4?i.uniforms[h]={type:"m4",value:v.toArray()}:i.uniforms[h]={value:v}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const l={};for(const h in this.extensions)this.extensions[h]===!0&&(l[h]=!0);return Object.keys(l).length>0&&(i.extensions=l),i}}class UM extends va{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ps,this.projectionMatrix=new ps,this.projectionMatrixInverse=new ps,this.coordinateSystem=Ud,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const U_=new gt,wB=new $i,SB=new $i;class Tc extends UM{constructor(e=50,i=1,l=.1,h=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=l,this.far=h,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=av*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(py*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return av*2*Math.atan(Math.tan(py*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,l){U_.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(U_.x,U_.y).multiplyScalar(-e/U_.z),U_.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),l.set(U_.x,U_.y).multiplyScalar(-e/U_.z)}getViewSize(e,i){return this.getViewBounds(e,wB,SB),i.subVectors(SB,wB)}setViewOffset(e,i,l,h,g,v){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=l,this.view.offsetY=h,this.view.width=g,this.view.height=v,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(py*.5*this.fov)/this.zoom,l=2*i,h=this.aspect*l,g=-.5*h;const v=this.view;if(this.view!==null&&this.view.enabled){const C=v.fullWidth,I=v.fullHeight;g+=v.offsetX*h/C,i-=v.offsetY*l/I,h*=v.width/C,l*=v.height/I}const r=this.filmOffset;r!==0&&(g+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(g,g+h,i,i-l,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const bx=-90,wx=1;class $5 extends va{constructor(e,i,l){super(),this.type="CubeCamera",this.renderTarget=l,this.coordinateSystem=null,this.activeMipmapLevel=0;const h=new Tc(bx,wx,e,i);h.layers=this.layers,this.add(h);const g=new Tc(bx,wx,e,i);g.layers=this.layers,this.add(g);const v=new Tc(bx,wx,e,i);v.layers=this.layers,this.add(v);const r=new Tc(bx,wx,e,i);r.layers=this.layers,this.add(r);const C=new Tc(bx,wx,e,i);C.layers=this.layers,this.add(C);const I=new Tc(bx,wx,e,i);I.layers=this.layers,this.add(I)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[l,h,g,v,r,C]=i;for(const I of i)this.remove(I);if(e===Ud)l.up.set(0,1,0),l.lookAt(1,0,0),h.up.set(0,1,0),h.lookAt(-1,0,0),g.up.set(0,0,-1),g.lookAt(0,1,0),v.up.set(0,0,1),v.lookAt(0,-1,0),r.up.set(0,1,0),r.lookAt(0,0,1),C.up.set(0,1,0),C.lookAt(0,0,-1);else if(e===rv)l.up.set(0,-1,0),l.lookAt(-1,0,0),h.up.set(0,-1,0),h.lookAt(1,0,0),g.up.set(0,0,1),g.lookAt(0,1,0),v.up.set(0,0,-1),v.lookAt(0,-1,0),r.up.set(0,-1,0),r.lookAt(0,0,1),C.up.set(0,-1,0),C.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const I of i)this.add(I),I.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:l,activeMipmapLevel:h}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[g,v,r,C,I,z]=this.children,N=e.getRenderTarget(),k=e.getActiveCubeFace(),j=e.getActiveMipmapLevel(),$=e.xr.enabled;e.xr.enabled=!1;const re=l.texture.generateMipmaps;l.texture.generateMipmaps=!1,e.setRenderTarget(l,0,h),e.render(i,g),e.setRenderTarget(l,1,h),e.render(i,v),e.setRenderTarget(l,2,h),e.render(i,r),e.setRenderTarget(l,3,h),e.render(i,C),e.setRenderTarget(l,4,h),e.render(i,I),l.texture.generateMipmaps=re,e.setRenderTarget(l,5,h),e.render(i,z),e.setRenderTarget(N,k,j),e.xr.enabled=$,l.texture.needsPMREMUpdate=!0}}class fw extends Ho{constructor(e=[],i=i_,l,h,g,v,r,C,I,z){super(e,i,l,h,g,v,r,C,I,z),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class J5 extends vh{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const l={width:e,height:e,depth:1},h=[l,l,l,l,l,l];this.texture=new fw(h),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const l={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},h=new Ay(5,5,5),g=new bh({name:"CubemapFromEquirect",uniforms:lv(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,side:Mc,blending:kd});g.uniforms.tEquirect.value=i;const v=new sc(h,g),r=i.minFilter;return i.minFilter===og&&(i.minFilter=Do),new $5(1,10,this).update(e,v),i.minFilter=r,v.geometry.dispose(),v.material.dispose(),this}clear(e,i=!0,l=!0,h=!0){const g=e.getRenderTarget();for(let v=0;v<6;v++)e.setRenderTarget(this,v),e.clear(i,l,h);e.setRenderTarget(g)}}class Hx extends va{constructor(){super(),this.isGroup=!0,this.type="Group"}}const xJ={type:"move"};class VT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Hx,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Hx,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new gt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new gt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Hx,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new gt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new gt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const l of e.hand.values())this._getHandJoint(i,l)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,l){let h=null,g=null,v=null;const r=this._targetRay,C=this._grip,I=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(I&&e.hand){v=!0;for(const re of e.hand.values()){const ie=i.getJointPose(re,l),Y=this._getHandJoint(I,re);ie!==null&&(Y.matrix.fromArray(ie.transform.matrix),Y.matrix.decompose(Y.position,Y.rotation,Y.scale),Y.matrixWorldNeedsUpdate=!0,Y.jointRadius=ie.radius),Y.visible=ie!==null}const z=I.joints["index-finger-tip"],N=I.joints["thumb-tip"],k=z.position.distanceTo(N.position),j=.02,$=.005;I.inputState.pinching&&k>j+$?(I.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!I.inputState.pinching&&k<=j-$&&(I.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else C!==null&&e.gripSpace&&(g=i.getPose(e.gripSpace,l),g!==null&&(C.matrix.fromArray(g.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,g.linearVelocity?(C.hasLinearVelocity=!0,C.linearVelocity.copy(g.linearVelocity)):C.hasLinearVelocity=!1,g.angularVelocity?(C.hasAngularVelocity=!0,C.angularVelocity.copy(g.angularVelocity)):C.hasAngularVelocity=!1));r!==null&&(h=i.getPose(e.targetRaySpace,l),h===null&&g!==null&&(h=g),h!==null&&(r.matrix.fromArray(h.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,h.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(h.linearVelocity)):r.hasLinearVelocity=!1,h.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(h.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(xJ)))}return r!==null&&(r.visible=h!==null),C!==null&&(C.visible=g!==null),I!==null&&(I.visible=v!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const l=new Hx;l.matrixAutoUpdate=!1,l.visible=!1,e.joints[i.jointName]=l,e.add(l)}return e.joints[i.jointName]}}class kM{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new ar(e),this.density=i}clone(){return new kM(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class VM{constructor(e,i=1,l=1e3){this.isFog=!0,this.name="",this.color=new ar(e),this.near=i,this.far=l}clone(){return new VM(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Xb extends va{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Hd,this.environmentIntensity=1,this.environmentRotation=new Hd,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class GM{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=Hb,this.updateRanges=[],this.version=0,this.uuid=Vd()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,l){e*=this.stride,l*=i.stride;for(let h=0,g=this.stride;h<g;h++)this.array[e+h]=i.array[l+h];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Vd()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),l=new this.constructor(i,this.stride);return l.setUsage(this.usage),l}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Vd()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Hh=new gt;class Ty{constructor(e,i,l,h=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=l,this.normalized=h}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,l=this.data.count;i<l;i++)Hh.fromBufferAttribute(this,i),Hh.applyMatrix4(e),this.setXYZ(i,Hh.x,Hh.y,Hh.z);return this}applyNormalMatrix(e){for(let i=0,l=this.count;i<l;i++)Hh.fromBufferAttribute(this,i),Hh.applyNormalMatrix(e),this.setXYZ(i,Hh.x,Hh.y,Hh.z);return this}transformDirection(e){for(let i=0,l=this.count;i<l;i++)Hh.fromBufferAttribute(this,i),Hh.transformDirection(e),this.setXYZ(i,Hh.x,Hh.y,Hh.z);return this}getComponent(e,i){let l=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(l=Yh(l,this.array)),l}setComponent(e,i,l){return this.normalized&&(l=Us(l,this.array)),this.data.array[e*this.data.stride+this.offset+i]=l,this}setX(e,i){return this.normalized&&(i=Us(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Us(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Us(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Us(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Yh(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Yh(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Yh(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Yh(i,this.array)),i}setXY(e,i,l){return e=e*this.data.stride+this.offset,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=l,this}setXYZ(e,i,l,h){return e=e*this.data.stride+this.offset,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array),h=Us(h,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=l,this.data.array[e+2]=h,this}setXYZW(e,i,l,h,g){return e=e*this.data.stride+this.offset,this.normalized&&(i=Us(i,this.array),l=Us(l,this.array),h=Us(h,this.array),g=Us(g,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=l,this.data.array[e+2]=h,this.data.array[e+3]=g,this}clone(e){if(e===void 0){qb("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let l=0;l<this.count;l++){const h=l*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)i.push(this.data.array[h+g])}return new Ba(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ty(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){qb("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let l=0;l<this.count;l++){const h=l*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)i.push(this.data.array[h+g])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class OI extends tu{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ar(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Sx;const P1=new gt,Tx=new gt,Mx=new gt,Ex=new $i,z1=new $i,Q5=new ps,JS=new gt,O1=new gt,QS=new gt,TB=new $i,m3=new $i,MB=new $i;class ek extends va{constructor(e=new OI){if(super(),this.isSprite=!0,this.type="Sprite",Sx===void 0){Sx=new Is;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),l=new GM(i,5);Sx.setIndex([0,1,2,0,2,3]),Sx.setAttribute("position",new Ty(l,3,0,!1)),Sx.setAttribute("uv",new Ty(l,2,3,!1))}this.geometry=Sx,this.material=e,this.center=new $i(.5,.5),this.count=1}raycast(e,i){e.camera===null&&ys('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Tx.setFromMatrixScale(this.matrixWorld),Q5.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Mx.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Tx.multiplyScalar(-Mx.z);const l=this.material.rotation;let h,g;l!==0&&(g=Math.cos(l),h=Math.sin(l));const v=this.center;eT(JS.set(-.5,-.5,0),Mx,v,Tx,h,g),eT(O1.set(.5,-.5,0),Mx,v,Tx,h,g),eT(QS.set(.5,.5,0),Mx,v,Tx,h,g),TB.set(0,0),m3.set(1,0),MB.set(1,1);let r=e.ray.intersectTriangle(JS,O1,QS,!1,P1);if(r===null&&(eT(O1.set(-.5,.5,0),Mx,v,Tx,h,g),m3.set(0,1),r=e.ray.intersectTriangle(JS,QS,O1,!1,P1),r===null))return;const C=e.ray.origin.distanceTo(P1);C<e.near||C>e.far||i.push({distance:C,point:P1.clone(),uv:qf.getInterpolation(P1,JS,O1,QS,TB,m3,MB,new $i),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function eT(n,e,i,l,h,g){Ex.subVectors(n,i).addScalar(.5).multiply(l),h!==void 0?(z1.x=g*Ex.x-h*Ex.y,z1.y=h*Ex.x+g*Ex.y):z1.copy(Ex),n.copy(e),n.x+=z1.x,n.y+=z1.y,n.applyMatrix4(Q5)}const tT=new gt,EB=new gt;class tk extends va{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const i=e.levels;for(let l=0,h=i.length;l<h;l++){const g=i[l];this.addLevel(g.object.clone(),g.distance,g.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,l=0){i=Math.abs(i);const h=this.levels;let g;for(g=0;g<h.length&&!(i<h[g].distance);g++);return h.splice(g,0,{distance:i,hysteresis:l,object:e}),this.add(e),this}removeLevel(e){const i=this.levels;for(let l=0;l<i.length;l++)if(i[l].distance===e){const h=i.splice(l,1);return this.remove(h[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const i=this.levels;if(i.length>0){let l,h;for(l=1,h=i.length;l<h;l++){let g=i[l].distance;if(i[l].object.visible&&(g-=g*i[l].hysteresis),e<g)break}return i[l-1].object}return null}raycast(e,i){if(this.levels.length>0){tT.setFromMatrixPosition(this.matrixWorld);const h=e.ray.origin.distanceTo(tT);this.getObjectForDistance(h).raycast(e,i)}}update(e){const i=this.levels;if(i.length>1){tT.setFromMatrixPosition(e.matrixWorld),EB.setFromMatrixPosition(this.matrixWorld);const l=tT.distanceTo(EB)/e.zoom;i[0].object.visible=!0;let h,g;for(h=1,g=i.length;h<g;h++){let v=i[h].distance;if(i[h].object.visible&&(v-=v*i[h].hysteresis),l>=v)i[h-1].object.visible=!1,i[h].object.visible=!0;else break}for(this._currentLevel=h-1;h<g;h++)i[h].object.visible=!1}}toJSON(e){const i=super.toJSON(e);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const l=this.levels;for(let h=0,g=l.length;h<g;h++){const v=l[h];i.object.levels.push({object:v.object.uuid,distance:v.distance,hysteresis:v.hysteresis})}return i}}const AB=new gt,CB=new xa,RB=new xa,vJ=new gt,IB=new ps,iT=new gt,g3=new Ou,DB=new ps,_3=new xv;class ik extends sc{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=uR,this.bindMatrix=new ps,this.bindMatrixInverse=new ps,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new yh),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let l=0;l<i.count;l++)this.getVertexPosition(l,iT),this.boundingBox.expandByPoint(iT)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ou),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let l=0;l<i.count;l++)this.getVertexPosition(l,iT),this.boundingSphere.expandByPoint(iT)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const l=this.material,h=this.matrixWorld;l!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),g3.copy(this.boundingSphere),g3.applyMatrix4(h),e.ray.intersectsSphere(g3)!==!1&&(DB.copy(h).invert(),_3.copy(e.ray).applyMatrix4(DB),!(this.boundingBox!==null&&_3.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,_3)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new xa,i=this.geometry.attributes.skinWeight;for(let l=0,h=i.count;l<h;l++){e.fromBufferAttribute(i,l);const g=1/e.manhattanLength();g!==1/0?e.multiplyScalar(g):e.set(1,0,0,0),i.setXYZW(l,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===uR?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===L5?this.bindMatrixInverse.copy(this.bindMatrix).invert():ir("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const l=this.skeleton,h=this.geometry;CB.fromBufferAttribute(h.attributes.skinIndex,e),RB.fromBufferAttribute(h.attributes.skinWeight,e),AB.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let g=0;g<4;g++){const v=RB.getComponent(g);if(v!==0){const r=CB.getComponent(g);IB.multiplyMatrices(l.bones[r].matrixWorld,l.boneInverses[r]),i.addScaledVector(vJ.copy(AB).applyMatrix4(IB),v)}}return i.applyMatrix4(this.bindMatrixInverse)}}class BI extends va{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Rm extends Ho{constructor(e=null,i=1,l=1,h,g,v,r,C,I=Fl,z=Fl,N,k){super(null,v,r,C,I,z,h,g,N,k),this.isDataTexture=!0,this.image={data:e,width:i,height:l},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const LB=new ps,bJ=new ps;class HM{constructor(e=[],i=[]){this.uuid=Vd(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){ir("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let l=0,h=this.bones.length;l<h;l++)this.boneInverses.push(new ps)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const l=new ps;this.bones[e]&&l.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(l)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const l=this.bones[e];l&&l.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const l=this.bones[e];l&&(l.parent&&l.parent.isBone?(l.matrix.copy(l.parent.matrixWorld).invert(),l.matrix.multiply(l.matrixWorld)):l.matrix.copy(l.matrixWorld),l.matrix.decompose(l.position,l.quaternion,l.scale))}}update(){const e=this.bones,i=this.boneInverses,l=this.boneMatrices,h=this.boneTexture;for(let g=0,v=e.length;g<v;g++){const r=e[g]?e[g].matrixWorld:bJ;LB.multiplyMatrices(r,i[g]),LB.toArray(l,g*16)}h!==null&&(h.needsUpdate=!0)}clone(){return new HM(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const l=new Rm(i,e,e,_h,$h);return l.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=l,this}getBoneByName(e){for(let i=0,l=this.bones.length;i<l;i++){const h=this.bones[i];if(h.name===e)return h}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let l=0,h=e.bones.length;l<h;l++){const g=e.bones[l];let v=i[g];v===void 0&&(ir("Skeleton: No bone found with UUID:",g),v=new BI),this.bones.push(v),this.boneInverses.push(new ps().fromArray(e.boneInverses[l]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,l=this.boneInverses;for(let h=0,g=i.length;h<g;h++){const v=i[h];e.bones.push(v.uuid);const r=l[h];e.boneInverses.push(r.toArray())}return e}}class cv extends Ba{constructor(e,i,l,h=1){super(e,i,l),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=h}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ax=new ps,PB=new ps,nT=[],zB=new yh,wJ=new ps,B1=new sc,N1=new Ou;class nk extends sc{constructor(e,i,l){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new cv(new Float32Array(l*16),16),this.instanceColor=null,this.morphTexture=null,this.count=l,this.boundingBox=null,this.boundingSphere=null;for(let h=0;h<l;h++)this.setMatrixAt(h,wJ)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new yh),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let l=0;l<i;l++)this.getMatrixAt(l,Ax),zB.copy(e.boundingBox).applyMatrix4(Ax),this.boundingBox.union(zB)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ou),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let l=0;l<i;l++)this.getMatrixAt(l,Ax),N1.copy(e.boundingSphere).applyMatrix4(Ax),this.boundingSphere.union(N1)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const l=i.morphTargetInfluences,h=this.morphTexture.source.data.data,g=l.length+1,v=e*g+1;for(let r=0;r<l.length;r++)l[r]=h[v+r]}raycast(e,i){const l=this.matrixWorld,h=this.count;if(B1.geometry=this.geometry,B1.material=this.material,B1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),N1.copy(this.boundingSphere),N1.applyMatrix4(l),e.ray.intersectsSphere(N1)!==!1))for(let g=0;g<h;g++){this.getMatrixAt(g,Ax),PB.multiplyMatrices(l,Ax),B1.matrixWorld=PB,B1.raycast(e,nT);for(let v=0,r=nT.length;v<r;v++){const C=nT[v];C.instanceId=g,C.object=this,i.push(C)}nT.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new cv(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const l=i.morphTargetInfluences,h=l.length+1;this.morphTexture===null&&(this.morphTexture=new Rm(new Float32Array(h*this.count),h,this.count,LM,$h));const g=this.morphTexture.source.data.data;let v=0;for(let I=0;I<l.length;I++)v+=l[I];const r=this.geometry.morphTargetsRelative?1:1-v,C=h*e;g[C]=r,g.set(l,C+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const y3=new gt,SJ=new gt,TJ=new Ps;class j_{constructor(e=new gt(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,l,h){return this.normal.set(e,i,l),this.constant=h,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,l){const h=y3.subVectors(l,i).cross(SJ.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(h,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const l=e.delta(y3),h=this.normal.dot(l);if(h===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const g=-(e.start.dot(this.normal)+this.constant)/h;return g<0||g>1?null:i.copy(e.start).addScaledVector(l,g)}intersectsLine(e){const i=this.distanceToPoint(e.start),l=this.distanceToPoint(e.end);return i<0&&l>0||l<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const l=i||TJ.getNormalMatrix(e),h=this.coplanarPoint(y3).applyMatrix4(e),g=this.normal.applyMatrix3(l).normalize();return this.constant=-h.dot(g),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const G0=new Ou,MJ=new $i(.5,.5),rT=new gt;class vv{constructor(e=new j_,i=new j_,l=new j_,h=new j_,g=new j_,v=new j_){this.planes=[e,i,l,h,g,v]}set(e,i,l,h,g,v){const r=this.planes;return r[0].copy(e),r[1].copy(i),r[2].copy(l),r[3].copy(h),r[4].copy(g),r[5].copy(v),this}copy(e){const i=this.planes;for(let l=0;l<6;l++)i[l].copy(e.planes[l]);return this}setFromProjectionMatrix(e,i=Ud,l=!1){const h=this.planes,g=e.elements,v=g[0],r=g[1],C=g[2],I=g[3],z=g[4],N=g[5],k=g[6],j=g[7],$=g[8],re=g[9],ie=g[10],Y=g[11],ae=g[12],ue=g[13],me=g[14],Ae=g[15];if(h[0].setComponents(I-v,j-z,Y-$,Ae-ae).normalize(),h[1].setComponents(I+v,j+z,Y+$,Ae+ae).normalize(),h[2].setComponents(I+r,j+N,Y+re,Ae+ue).normalize(),h[3].setComponents(I-r,j-N,Y-re,Ae-ue).normalize(),l)h[4].setComponents(C,k,ie,me).normalize(),h[5].setComponents(I-C,j-k,Y-ie,Ae-me).normalize();else if(h[4].setComponents(I-C,j-k,Y-ie,Ae-me).normalize(),i===Ud)h[5].setComponents(I+C,j+k,Y+ie,Ae+me).normalize();else if(i===rv)h[5].setComponents(C,k,ie,me).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),G0.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),G0.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(G0)}intersectsSprite(e){G0.center.set(0,0,0);const i=MJ.distanceTo(e.center);return G0.radius=.7071067811865476+i,G0.applyMatrix4(e.matrixWorld),this.intersectsSphere(G0)}intersectsSphere(e){const i=this.planes,l=e.center,h=-e.radius;for(let g=0;g<6;g++)if(i[g].distanceToPoint(l)<h)return!1;return!0}intersectsBox(e){const i=this.planes;for(let l=0;l<6;l++){const h=i[l];if(rT.x=h.normal.x>0?e.max.x:e.min.x,rT.y=h.normal.y>0?e.max.y:e.min.y,rT.z=h.normal.z>0?e.max.z:e.min.z,h.distanceToPoint(rT)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let l=0;l<6;l++)if(i[l].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const ng=new ps,rg=new vv;class jM{constructor(){this.coordinateSystem=Ud}intersectsObject(e,i){if(!i.isArrayCamera||i.cameras.length===0)return!1;for(let l=0;l<i.cameras.length;l++){const h=i.cameras[l];if(ng.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),rg.setFromProjectionMatrix(ng,h.coordinateSystem,h.reversedDepth),rg.intersectsObject(e))return!0}return!1}intersectsSprite(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let l=0;l<i.cameras.length;l++){const h=i.cameras[l];if(ng.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),rg.setFromProjectionMatrix(ng,h.coordinateSystem,h.reversedDepth),rg.intersectsSprite(e))return!0}return!1}intersectsSphere(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let l=0;l<i.cameras.length;l++){const h=i.cameras[l];if(ng.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),rg.setFromProjectionMatrix(ng,h.coordinateSystem,h.reversedDepth),rg.intersectsSphere(e))return!0}return!1}intersectsBox(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let l=0;l<i.cameras.length;l++){const h=i.cameras[l];if(ng.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),rg.setFromProjectionMatrix(ng,h.coordinateSystem,h.reversedDepth),rg.intersectsBox(e))return!0}return!1}containsPoint(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let l=0;l<i.cameras.length;l++){const h=i.cameras[l];if(ng.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),rg.setFromProjectionMatrix(ng,h.coordinateSystem,h.reversedDepth),rg.containsPoint(e))return!0}return!1}clone(){return new jM}}function x3(n,e){return n-e}function EJ(n,e){return n.z-e.z}function AJ(n,e){return e.z-n.z}class CJ{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i,l,h){const g=this.pool,v=this.list;this.index>=g.length&&g.push({start:-1,count:-1,z:-1,index:-1});const r=g[this.index];v.push(r),this.index++,r.start=e,r.count=i,r.z=l,r.index=h}reset(){this.list.length=0,this.index=0}}const Uf=new ps,RJ=new ar(1,1,1),OB=new vv,IJ=new jM,sT=new yh,H0=new Ou,F1=new gt,BB=new gt,DJ=new gt,v3=new CJ,mh=new sc,aT=[];function LJ(n,e,i=0){const l=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const h=n.count;for(let g=0;g<h;g++)for(let v=0;v<l;v++)e.setComponent(g+i,v,n.getComponent(g,v))}else e.array.set(n.array,i*l);e.needsUpdate=!0}function j0(n,e){if(n.constructor!==e.constructor){const i=Math.min(n.length,e.length);for(let l=0;l<i;l++)e[l]=n[l]}else{const i=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,i))}}class rk extends sc{constructor(e,i,l=i*2,h){super(new Is,h),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=i,this._maxIndexCount=l,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),l=new Rm(i,e,e,_h,$h);this._matricesTexture=l}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Uint32Array(e*e),l=new Rm(i,e,e,hw,dg);this._indirectTexture=l}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Float32Array(e*e*4).fill(1),l=new Rm(i,e,e,_h,$h);l.colorSpace=oa.workingColorSpace,this._colorsTexture=l}_initializeGeometry(e){const i=this.geometry,l=this._maxVertexCount,h=this._maxIndexCount;if(this._geometryInitialized===!1){for(const g in e.attributes){const v=e.getAttribute(g),{array:r,itemSize:C,normalized:I}=v,z=new r.constructor(l*C),N=new Ba(z,C,I);i.setAttribute(g,N)}if(e.getIndex()!==null){const g=l>65535?new Uint32Array(h):new Uint16Array(h);i.setIndex(new Ba(g,1))}this._geometryInitialized=!0}}_validateGeometry(e){const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const l in i.attributes){if(!e.hasAttribute(l))throw new Error(`THREE.BatchedMesh: Added geometry missing "${l}". All geometries must have consistent attributes.`);const h=e.getAttribute(l),g=i.getAttribute(l);if(h.itemSize!==g.itemSize||h.normalized!==g.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const i=this._instanceInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const i=this._geometryInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yh);const e=this.boundingBox,i=this._instanceInfo;e.makeEmpty();for(let l=0,h=i.length;l<h;l++){if(i[l].active===!1)continue;const g=i[l].geometryIndex;this.getMatrixAt(l,Uf),this.getBoundingBoxAt(g,sT).applyMatrix4(Uf),e.union(sT)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ou);const e=this.boundingSphere,i=this._instanceInfo;e.makeEmpty();for(let l=0,h=i.length;l<h;l++){if(i[l].active===!1)continue;const g=i[l].geometryIndex;this.getMatrixAt(l,Uf),this.getBoundingSphereAt(g,H0).applyMatrix4(Uf),e.union(H0)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const l={visible:!0,active:!0,geometryIndex:e};let h=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(x3),h=this._availableInstanceIds.shift(),this._instanceInfo[h]=l):(h=this._instanceInfo.length,this._instanceInfo.push(l));const g=this._matricesTexture;Uf.identity().toArray(g.image.data,h*16),g.needsUpdate=!0;const v=this._colorsTexture;return v&&(RJ.toArray(v.image.data,h*4),v.needsUpdate=!0),this._visibilityChanged=!0,h}addGeometry(e,i=-1,l=-1){this._initializeGeometry(e),this._validateGeometry(e);const h={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},g=this._geometryInfo;h.vertexStart=this._nextVertexStart,h.reservedVertexCount=i===-1?e.getAttribute("position").count:i;const v=e.getIndex();if(v!==null&&(h.indexStart=this._nextIndexStart,h.reservedIndexCount=l===-1?v.count:l),h.indexStart!==-1&&h.indexStart+h.reservedIndexCount>this._maxIndexCount||h.vertexStart+h.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let C;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(x3),C=this._availableGeometryIds.shift(),g[C]=h):(C=this._geometryCount,this._geometryCount++,g.push(h)),this.setGeometryAt(C,e),this._nextIndexStart=h.indexStart+h.reservedIndexCount,this._nextVertexStart=h.vertexStart+h.reservedVertexCount,C}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const l=this.geometry,h=l.getIndex()!==null,g=l.getIndex(),v=i.getIndex(),r=this._geometryInfo[e];if(h&&v.count>r.reservedIndexCount||i.attributes.position.count>r.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const C=r.vertexStart,I=r.reservedVertexCount;r.vertexCount=i.getAttribute("position").count;for(const z in l.attributes){const N=i.getAttribute(z),k=l.getAttribute(z);LJ(N,k,C);const j=N.itemSize;for(let $=N.count,re=I;$<re;$++){const ie=C+$;for(let Y=0;Y<j;Y++)k.setComponent(ie,Y,0)}k.needsUpdate=!0,k.addUpdateRange(C*j,I*j)}if(h){const z=r.indexStart,N=r.reservedIndexCount;r.indexCount=i.getIndex().count;for(let k=0;k<v.count;k++)g.setX(z+k,C+v.getX(k));for(let k=v.count,j=N;k<j;k++)g.setX(z+k,C);g.needsUpdate=!0,g.addUpdateRange(z,r.reservedIndexCount)}return r.start=h?r.indexStart:r.vertexStart,r.count=h?r.indexCount:r.vertexCount,r.boundingBox=null,i.boundingBox!==null&&(r.boundingBox=i.boundingBox.clone()),r.boundingSphere=null,i.boundingSphere!==null&&(r.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._geometryInfo;if(e>=i.length||i[e].active===!1)return this;const l=this._instanceInfo;for(let h=0,g=l.length;h<g;h++)l[h].active&&l[h].geometryIndex===e&&this.deleteInstance(h);return i[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,i=0;const l=this._geometryInfo,h=l.map((v,r)=>r).sort((v,r)=>l[v].vertexStart-l[r].vertexStart),g=this.geometry;for(let v=0,r=l.length;v<r;v++){const C=h[v],I=l[C];if(I.active!==!1){if(g.index!==null){if(I.indexStart!==i){const{indexStart:z,vertexStart:N,reservedIndexCount:k}=I,j=g.index,$=j.array,re=e-N;for(let ie=z;ie<z+k;ie++)$[ie]=$[ie]+re;j.array.copyWithin(i,z,z+k),j.addUpdateRange(i,k),I.indexStart=i}i+=I.reservedIndexCount}if(I.vertexStart!==e){const{vertexStart:z,reservedVertexCount:N}=I,k=g.attributes;for(const j in k){const $=k[j],{array:re,itemSize:ie}=$;re.copyWithin(e*ie,z*ie,(z+N)*ie),$.addUpdateRange(e*ie,N*ie)}I.vertexStart=e}e+=I.reservedVertexCount,I.start=g.index?I.indexStart:I.vertexStart,this._nextIndexStart=g.index?I.indexStart+I.reservedIndexCount:0,this._nextVertexStart=I.vertexStart+I.reservedVertexCount}}return this}getBoundingBoxAt(e,i){if(e>=this._geometryCount)return null;const l=this.geometry,h=this._geometryInfo[e];if(h.boundingBox===null){const g=new yh,v=l.index,r=l.attributes.position;for(let C=h.start,I=h.start+h.count;C<I;C++){let z=C;v&&(z=v.getX(z)),g.expandByPoint(F1.fromBufferAttribute(r,z))}h.boundingBox=g}return i.copy(h.boundingBox),i}getBoundingSphereAt(e,i){if(e>=this._geometryCount)return null;const l=this.geometry,h=this._geometryInfo[e];if(h.boundingSphere===null){const g=new Ou;this.getBoundingBoxAt(e,sT),sT.getCenter(g.center);const v=l.index,r=l.attributes.position;let C=0;for(let I=h.start,z=h.start+h.count;I<z;I++){let N=I;v&&(N=v.getX(N)),F1.fromBufferAttribute(r,N),C=Math.max(C,g.center.distanceToSquared(F1))}g.radius=Math.sqrt(C),h.boundingSphere=g}return i.copy(h.boundingSphere),i}setMatrixAt(e,i){this.validateInstanceId(e);const l=this._matricesTexture,h=this._matricesTexture.image.data;return i.toArray(h,e*16),l.needsUpdate=!0,this}getMatrixAt(e,i){return this.validateInstanceId(e),i.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,i){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,i){return this.validateInstanceId(e),i.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,i){return this.validateInstanceId(e),this._instanceInfo[e].visible===i?this:(this._instanceInfo[e].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,i){return this.validateInstanceId(e),this.validateGeometryId(i),this._instanceInfo[e].geometryIndex=i,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,i={}){this.validateGeometryId(e);const l=this._geometryInfo[e];return i.vertexStart=l.vertexStart,i.vertexCount=l.vertexCount,i.reservedVertexCount=l.reservedVertexCount,i.indexStart=l.indexStart,i.indexCount=l.indexCount,i.reservedIndexCount=l.reservedIndexCount,i.start=l.start,i.count=l.count,i}setInstanceCount(e){const i=this._availableInstanceIds,l=this._instanceInfo;for(i.sort(x3);i[i.length-1]===l.length-1;)l.pop(),i.pop();if(e<l.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const h=new Int32Array(e),g=new Int32Array(e);j0(this._multiDrawCounts,h),j0(this._multiDrawStarts,g),this._multiDrawCounts=h,this._multiDrawStarts=g,this._maxInstanceCount=e;const v=this._indirectTexture,r=this._matricesTexture,C=this._colorsTexture;v.dispose(),this._initIndirectTexture(),j0(v.image.data,this._indirectTexture.image.data),r.dispose(),this._initMatricesTexture(),j0(r.image.data,this._matricesTexture.image.data),C&&(C.dispose(),this._initColorsTexture(),j0(C.image.data,this._colorsTexture.image.data))}setGeometrySize(e,i){const l=[...this._geometryInfo].filter(r=>r.active);if(Math.max(...l.map(r=>r.vertexStart+r.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...l.map(C=>C.indexStart+C.reservedIndexCount))>i)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);const g=this.geometry;g.dispose(),this._maxVertexCount=e,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Is,this._initializeGeometry(g));const v=this.geometry;g.index&&j0(g.index.array,v.index.array);for(const r in g.attributes)j0(g.attributes[r].array,v.attributes[r].array)}raycast(e,i){const l=this._instanceInfo,h=this._geometryInfo,g=this.matrixWorld,v=this.geometry;mh.material=this.material,mh.geometry.index=v.index,mh.geometry.attributes=v.attributes,mh.geometry.boundingBox===null&&(mh.geometry.boundingBox=new yh),mh.geometry.boundingSphere===null&&(mh.geometry.boundingSphere=new Ou);for(let r=0,C=l.length;r<C;r++){if(!l[r].visible||!l[r].active)continue;const I=l[r].geometryIndex,z=h[I];mh.geometry.setDrawRange(z.start,z.count),this.getMatrixAt(r,mh.matrixWorld).premultiply(g),this.getBoundingBoxAt(I,mh.geometry.boundingBox),this.getBoundingSphereAt(I,mh.geometry.boundingSphere),mh.raycast(e,aT);for(let N=0,k=aT.length;N<k;N++){const j=aT[N];j.object=this,j.batchId=r,i.push(j)}aT.length=0}mh.material=null,mh.geometry.index=null,mh.geometry.attributes={},mh.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(i=>({...i,boundingBox:i.boundingBox!==null?i.boundingBox.clone():null,boundingSphere:i.boundingSphere!==null?i.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(i=>({...i})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,i,l,h,g){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const v=h.getIndex(),r=v===null?1:v.array.BYTES_PER_ELEMENT,C=this._instanceInfo,I=this._multiDrawStarts,z=this._multiDrawCounts,N=this._geometryInfo,k=this.perObjectFrustumCulled,j=this._indirectTexture,$=j.image.data,re=l.isArrayCamera?IJ:OB;k&&!l.isArrayCamera&&(Uf.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse).multiply(this.matrixWorld),OB.setFromProjectionMatrix(Uf,l.coordinateSystem,l.reversedDepth));let ie=0;if(this.sortObjects){Uf.copy(this.matrixWorld).invert(),F1.setFromMatrixPosition(l.matrixWorld).applyMatrix4(Uf),BB.set(0,0,-1).transformDirection(l.matrixWorld).transformDirection(Uf);for(let ue=0,me=C.length;ue<me;ue++)if(C[ue].visible&&C[ue].active){const Ae=C[ue].geometryIndex;this.getMatrixAt(ue,Uf),this.getBoundingSphereAt(Ae,H0).applyMatrix4(Uf);let Se=!1;if(k&&(Se=!re.intersectsSphere(H0,l)),!Se){const ze=N[Ae],je=DJ.subVectors(H0.center,F1).dot(BB);v3.push(ze.start,ze.count,je,ue)}}const Y=v3.list,ae=this.customSort;ae===null?Y.sort(g.transparent?AJ:EJ):ae.call(this,Y,l);for(let ue=0,me=Y.length;ue<me;ue++){const Ae=Y[ue];I[ie]=Ae.start*r,z[ie]=Ae.count,$[ie]=Ae.index,ie++}v3.reset()}else for(let Y=0,ae=C.length;Y<ae;Y++)if(C[Y].visible&&C[Y].active){const ue=C[Y].geometryIndex;let me=!1;if(k&&(this.getMatrixAt(Y,Uf),this.getBoundingSphereAt(ue,H0).applyMatrix4(Uf),me=!re.intersectsSphere(H0,l)),!me){const Ae=N[ue];I[ie]=Ae.start*r,z[ie]=Ae.count,$[ie]=Y,ie++}}j.needsUpdate=!0,this._multiDrawCount=ie,this._visibilityChanged=!1}onBeforeShadow(e,i,l,h,g,v){this.onBeforeRender(e,null,h,g,v)}}class ef extends tu{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ar(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const uM=new gt,hM=new gt,NB=new ps,U1=new xv,oT=new Ou,b3=new gt,FB=new gt;class i0 extends va{constructor(e=new Is,i=new ef){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,l=[0];for(let h=1,g=i.count;h<g;h++)uM.fromBufferAttribute(i,h-1),hM.fromBufferAttribute(i,h),l[h]=l[h-1],l[h]+=uM.distanceTo(hM);e.setAttribute("lineDistance",new Mr(l,1))}else ir("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const l=this.geometry,h=this.matrixWorld,g=e.params.Line.threshold,v=l.drawRange;if(l.boundingSphere===null&&l.computeBoundingSphere(),oT.copy(l.boundingSphere),oT.applyMatrix4(h),oT.radius+=g,e.ray.intersectsSphere(oT)===!1)return;NB.copy(h).invert(),U1.copy(e.ray).applyMatrix4(NB);const r=g/((this.scale.x+this.scale.y+this.scale.z)/3),C=r*r,I=this.isLineSegments?2:1,z=l.index,k=l.attributes.position;if(z!==null){const j=Math.max(0,v.start),$=Math.min(z.count,v.start+v.count);for(let re=j,ie=$-1;re<ie;re+=I){const Y=z.getX(re),ae=z.getX(re+1),ue=lT(this,e,U1,C,Y,ae,re);ue&&i.push(ue)}if(this.isLineLoop){const re=z.getX($-1),ie=z.getX(j),Y=lT(this,e,U1,C,re,ie,$-1);Y&&i.push(Y)}}else{const j=Math.max(0,v.start),$=Math.min(k.count,v.start+v.count);for(let re=j,ie=$-1;re<ie;re+=I){const Y=lT(this,e,U1,C,re,re+1,re);Y&&i.push(Y)}if(this.isLineLoop){const re=lT(this,e,U1,C,$-1,j,$-1);re&&i.push(re)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const h=i[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let g=0,v=h.length;g<v;g++){const r=h[g].name||String(g);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=g}}}}}function lT(n,e,i,l,h,g,v){const r=n.geometry.attributes.position;if(uM.fromBufferAttribute(r,h),hM.fromBufferAttribute(r,g),i.distanceSqToSegment(uM,hM,b3,FB)>l)return;b3.applyMatrix4(n.matrixWorld);const I=e.ray.origin.distanceTo(b3);if(!(I<e.near||I>e.far))return{distance:I,point:FB.clone().applyMatrix4(n.matrixWorld),index:v,face:null,faceIndex:null,barycoord:null,object:n}}const UB=new gt,kB=new gt;class gg extends i0{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,l=[];for(let h=0,g=i.count;h<g;h+=2)UB.fromBufferAttribute(i,h),kB.fromBufferAttribute(i,h+1),l[h]=h===0?0:l[h-1],l[h+1]=l[h]+UB.distanceTo(kB);e.setAttribute("lineDistance",new Mr(l,1))}else ir("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class sk extends i0{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class NI extends tu{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ar(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const VB=new ps,dR=new xv,cT=new Ou,uT=new gt;class ak extends va{constructor(e=new Is,i=new NI){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const l=this.geometry,h=this.matrixWorld,g=e.params.Points.threshold,v=l.drawRange;if(l.boundingSphere===null&&l.computeBoundingSphere(),cT.copy(l.boundingSphere),cT.applyMatrix4(h),cT.radius+=g,e.ray.intersectsSphere(cT)===!1)return;VB.copy(h).invert(),dR.copy(e.ray).applyMatrix4(VB);const r=g/((this.scale.x+this.scale.y+this.scale.z)/3),C=r*r,I=l.index,N=l.attributes.position;if(I!==null){const k=Math.max(0,v.start),j=Math.min(I.count,v.start+v.count);for(let $=k,re=j;$<re;$++){const ie=I.getX($);uT.fromBufferAttribute(N,ie),GB(uT,ie,C,h,e,i,this)}}else{const k=Math.max(0,v.start),j=Math.min(N.count,v.start+v.count);for(let $=k,re=j;$<re;$++)uT.fromBufferAttribute(N,$),GB(uT,$,C,h,e,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const h=i[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let g=0,v=h.length;g<v;g++){const r=h[g].name||String(g);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=g}}}}}function GB(n,e,i,l,h,g,v){const r=dR.distanceSqToPoint(n);if(r<i){const C=new gt;dR.closestPointToPoint(n,C),C.applyMatrix4(l);const I=h.ray.origin.distanceTo(C);if(I<h.near||I>h.far)return;g.push({distance:I,distanceToRay:Math.sqrt(r),point:C,index:e,face:null,faceIndex:null,barycoord:null,object:v})}}class ok extends Ho{constructor(e,i,l,h,g=Do,v=Do,r,C,I){super(e,i,l,h,g,v,r,C,I),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const z=this;function N(){z.needsUpdate=!0,z._requestVideoFrameCallbackId=e.requestVideoFrameCallback(N)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(N))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class PJ extends ok{constructor(e,i,l,h,g,v,r,C){super({},e,i,l,h,g,v,r,C),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class zJ extends Ho{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=Fl,this.minFilter=Fl,this.generateMipmaps=!1,this.needsUpdate=!0}}class qM extends Ho{constructor(e,i,l,h,g,v,r,C,I,z,N,k){super(null,v,r,C,I,z,h,g,N,k),this.isCompressedTexture=!0,this.image={width:i,height:l},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class OJ extends qM{constructor(e,i,l,h,g,v){super(e,i,l,g,v),this.isCompressedArrayTexture=!0,this.image.depth=h,this.wrapR=Zf,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class BJ extends qM{constructor(e,i,l){super(void 0,e[0].width,e[0].height,i,l,i_),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class NJ extends Ho{constructor(e,i,l,h,g,v,r,C,I){super(e,i,l,h,g,v,r,C,I),this.isCanvasTexture=!0,this.needsUpdate=!0}}class XM extends Ho{constructor(e,i,l=dg,h,g,v,r=Fl,C=Fl,I,z=nv,N=1){if(z!==nv&&z!==Sy)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const k={width:e,height:i,depth:N};super(k,h,g,v,r,C,z,l,I),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new K_(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class FI extends Ho{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class WM extends Is{constructor(e=1,i=1,l=4,h=8,g=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:i,capSegments:l,radialSegments:h,heightSegments:g},i=Math.max(0,i),l=Math.max(1,Math.floor(l)),h=Math.max(3,Math.floor(h)),g=Math.max(1,Math.floor(g));const v=[],r=[],C=[],I=[],z=i/2,N=Math.PI/2*e,k=i,j=2*N+k,$=l*2+g,re=h+1,ie=new gt,Y=new gt;for(let ae=0;ae<=$;ae++){let ue=0,me=0,Ae=0,Se=0;if(ae<=l){const Ce=ae/l,Te=Ce*Math.PI/2;me=-z-e*Math.cos(Te),Ae=e*Math.sin(Te),Se=-e*Math.cos(Te),ue=Ce*N}else if(ae<=l+g){const Ce=(ae-l)/g;me=-z+Ce*i,Ae=e,Se=0,ue=N+Ce*k}else{const Ce=(ae-l-g)/l,Te=Ce*Math.PI/2;me=z+e*Math.sin(Te),Ae=e*Math.cos(Te),Se=e*Math.sin(Te),ue=N+k+Ce*N}const ze=Math.max(0,Math.min(1,ue/j));let je=0;ae===0?je=.5/h:ae===$&&(je=-.5/h);for(let Ce=0;Ce<=h;Ce++){const Te=Ce/h,Ze=Te*Math.PI*2,Mt=Math.sin(Ze),mt=Math.cos(Ze);Y.x=-Ae*mt,Y.y=me,Y.z=Ae*Mt,r.push(Y.x,Y.y,Y.z),ie.set(-Ae*mt,Se,Ae*Mt),ie.normalize(),C.push(ie.x,ie.y,ie.z),I.push(Te+je,ze)}if(ae>0){const Ce=(ae-1)*re;for(let Te=0;Te<h;Te++){const Ze=Ce+Te,Mt=Ce+Te+1,mt=ae*re+Te,Gt=ae*re+Te+1;v.push(Ze,Mt,mt),v.push(Mt,Gt,mt)}}}this.setIndex(v),this.setAttribute("position",new Mr(r,3)),this.setAttribute("normal",new Mr(C,3)),this.setAttribute("uv",new Mr(I,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new WM(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class ZM extends Is{constructor(e=1,i=32,l=0,h=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:l,thetaLength:h},i=Math.max(3,i);const g=[],v=[],r=[],C=[],I=new gt,z=new $i;v.push(0,0,0),r.push(0,0,1),C.push(.5,.5);for(let N=0,k=3;N<=i;N++,k+=3){const j=l+N/i*h;I.x=e*Math.cos(j),I.y=e*Math.sin(j),v.push(I.x,I.y,I.z),r.push(0,0,1),z.x=(v[k]/e+1)/2,z.y=(v[k+1]/e+1)/2,C.push(z.x,z.y)}for(let N=1;N<=i;N++)g.push(N,N+1,0);this.setIndex(g),this.setAttribute("position",new Mr(v,3)),this.setAttribute("normal",new Mr(r,3)),this.setAttribute("uv",new Mr(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ZM(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class dw extends Is{constructor(e=1,i=1,l=1,h=32,g=1,v=!1,r=0,C=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:l,radialSegments:h,heightSegments:g,openEnded:v,thetaStart:r,thetaLength:C};const I=this;h=Math.floor(h),g=Math.floor(g);const z=[],N=[],k=[],j=[];let $=0;const re=[],ie=l/2;let Y=0;ae(),v===!1&&(e>0&&ue(!0),i>0&&ue(!1)),this.setIndex(z),this.setAttribute("position",new Mr(N,3)),this.setAttribute("normal",new Mr(k,3)),this.setAttribute("uv",new Mr(j,2));function ae(){const me=new gt,Ae=new gt;let Se=0;const ze=(i-e)/l;for(let je=0;je<=g;je++){const Ce=[],Te=je/g,Ze=Te*(i-e)+e;for(let Mt=0;Mt<=h;Mt++){const mt=Mt/h,Gt=mt*C+r,kt=Math.sin(Gt),Re=Math.cos(Gt);Ae.x=Ze*kt,Ae.y=-Te*l+ie,Ae.z=Ze*Re,N.push(Ae.x,Ae.y,Ae.z),me.set(kt,ze,Re).normalize(),k.push(me.x,me.y,me.z),j.push(mt,1-Te),Ce.push($++)}re.push(Ce)}for(let je=0;je<h;je++)for(let Ce=0;Ce<g;Ce++){const Te=re[Ce][je],Ze=re[Ce+1][je],Mt=re[Ce+1][je+1],mt=re[Ce][je+1];(e>0||Ce!==0)&&(z.push(Te,Ze,mt),Se+=3),(i>0||Ce!==g-1)&&(z.push(Ze,Mt,mt),Se+=3)}I.addGroup(Y,Se,0),Y+=Se}function ue(me){const Ae=$,Se=new $i,ze=new gt;let je=0;const Ce=me===!0?e:i,Te=me===!0?1:-1;for(let Mt=1;Mt<=h;Mt++)N.push(0,ie*Te,0),k.push(0,Te,0),j.push(.5,.5),$++;const Ze=$;for(let Mt=0;Mt<=h;Mt++){const Gt=Mt/h*C+r,kt=Math.cos(Gt),Re=Math.sin(Gt);ze.x=Ce*Re,ze.y=ie*Te,ze.z=Ce*kt,N.push(ze.x,ze.y,ze.z),k.push(0,Te,0),Se.x=kt*.5+.5,Se.y=Re*.5*Te+.5,j.push(Se.x,Se.y),$++}for(let Mt=0;Mt<h;Mt++){const mt=Ae+Mt,Gt=Ze+Mt;me===!0?z.push(Gt,Gt+1,mt):z.push(Gt+1,Gt,mt),je+=3}I.addGroup(Y,je,me===!0?1:2),Y+=je}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dw(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class pw extends dw{constructor(e=1,i=1,l=32,h=1,g=!1,v=0,r=Math.PI*2){super(0,e,i,l,h,g,v,r),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:l,heightSegments:h,openEnded:g,thetaStart:v,thetaLength:r}}static fromJSON(e){return new pw(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class l0 extends Is{constructor(e=[],i=[],l=1,h=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:l,detail:h};const g=[],v=[];r(h),I(l),z(),this.setAttribute("position",new Mr(g,3)),this.setAttribute("normal",new Mr(g.slice(),3)),this.setAttribute("uv",new Mr(v,2)),h===0?this.computeVertexNormals():this.normalizeNormals();function r(ae){const ue=new gt,me=new gt,Ae=new gt;for(let Se=0;Se<i.length;Se+=3)j(i[Se+0],ue),j(i[Se+1],me),j(i[Se+2],Ae),C(ue,me,Ae,ae)}function C(ae,ue,me,Ae){const Se=Ae+1,ze=[];for(let je=0;je<=Se;je++){ze[je]=[];const Ce=ae.clone().lerp(me,je/Se),Te=ue.clone().lerp(me,je/Se),Ze=Se-je;for(let Mt=0;Mt<=Ze;Mt++)Mt===0&&je===Se?ze[je][Mt]=Ce:ze[je][Mt]=Ce.clone().lerp(Te,Mt/Ze)}for(let je=0;je<Se;je++)for(let Ce=0;Ce<2*(Se-je)-1;Ce++){const Te=Math.floor(Ce/2);Ce%2===0?(k(ze[je][Te+1]),k(ze[je+1][Te]),k(ze[je][Te])):(k(ze[je][Te+1]),k(ze[je+1][Te+1]),k(ze[je+1][Te]))}}function I(ae){const ue=new gt;for(let me=0;me<g.length;me+=3)ue.x=g[me+0],ue.y=g[me+1],ue.z=g[me+2],ue.normalize().multiplyScalar(ae),g[me+0]=ue.x,g[me+1]=ue.y,g[me+2]=ue.z}function z(){const ae=new gt;for(let ue=0;ue<g.length;ue+=3){ae.x=g[ue+0],ae.y=g[ue+1],ae.z=g[ue+2];const me=ie(ae)/2/Math.PI+.5,Ae=Y(ae)/Math.PI+.5;v.push(me,1-Ae)}$(),N()}function N(){for(let ae=0;ae<v.length;ae+=6){const ue=v[ae+0],me=v[ae+2],Ae=v[ae+4],Se=Math.max(ue,me,Ae),ze=Math.min(ue,me,Ae);Se>.9&&ze<.1&&(ue<.2&&(v[ae+0]+=1),me<.2&&(v[ae+2]+=1),Ae<.2&&(v[ae+4]+=1))}}function k(ae){g.push(ae.x,ae.y,ae.z)}function j(ae,ue){const me=ae*3;ue.x=e[me+0],ue.y=e[me+1],ue.z=e[me+2]}function $(){const ae=new gt,ue=new gt,me=new gt,Ae=new gt,Se=new $i,ze=new $i,je=new $i;for(let Ce=0,Te=0;Ce<g.length;Ce+=9,Te+=6){ae.set(g[Ce+0],g[Ce+1],g[Ce+2]),ue.set(g[Ce+3],g[Ce+4],g[Ce+5]),me.set(g[Ce+6],g[Ce+7],g[Ce+8]),Se.set(v[Te+0],v[Te+1]),ze.set(v[Te+2],v[Te+3]),je.set(v[Te+4],v[Te+5]),Ae.copy(ae).add(ue).add(me).divideScalar(3);const Ze=ie(Ae);re(Se,Te+0,ae,Ze),re(ze,Te+2,ue,Ze),re(je,Te+4,me,Ze)}}function re(ae,ue,me,Ae){Ae<0&&ae.x===1&&(v[ue]=ae.x-1),me.x===0&&me.z===0&&(v[ue]=Ae/2/Math.PI+.5)}function ie(ae){return Math.atan2(ae.z,-ae.x)}function Y(ae){return Math.atan2(-ae.y,Math.sqrt(ae.x*ae.x+ae.z*ae.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new l0(e.vertices,e.indices,e.radius,e.details)}}class YM extends l0{constructor(e=1,i=0){const l=(1+Math.sqrt(5))/2,h=1/l,g=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-h,-l,0,-h,l,0,h,-l,0,h,l,-h,-l,0,-h,l,0,h,-l,0,h,l,0,-l,0,-h,l,0,-h,-l,0,h,l,0,h],v=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(g,v,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new YM(e.radius,e.detail)}}const hT=new gt,fT=new gt,w3=new gt,dT=new qf;class lk extends Is{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const h=Math.pow(10,4),g=Math.cos(py*i),v=e.getIndex(),r=e.getAttribute("position"),C=v?v.count:r.count,I=[0,0,0],z=["a","b","c"],N=new Array(3),k={},j=[];for(let $=0;$<C;$+=3){v?(I[0]=v.getX($),I[1]=v.getX($+1),I[2]=v.getX($+2)):(I[0]=$,I[1]=$+1,I[2]=$+2);const{a:re,b:ie,c:Y}=dT;if(re.fromBufferAttribute(r,I[0]),ie.fromBufferAttribute(r,I[1]),Y.fromBufferAttribute(r,I[2]),dT.getNormal(w3),N[0]=`${Math.round(re.x*h)},${Math.round(re.y*h)},${Math.round(re.z*h)}`,N[1]=`${Math.round(ie.x*h)},${Math.round(ie.y*h)},${Math.round(ie.z*h)}`,N[2]=`${Math.round(Y.x*h)},${Math.round(Y.y*h)},${Math.round(Y.z*h)}`,!(N[0]===N[1]||N[1]===N[2]||N[2]===N[0]))for(let ae=0;ae<3;ae++){const ue=(ae+1)%3,me=N[ae],Ae=N[ue],Se=dT[z[ae]],ze=dT[z[ue]],je=`${me}_${Ae}`,Ce=`${Ae}_${me}`;Ce in k&&k[Ce]?(w3.dot(k[Ce].normal)<=g&&(j.push(Se.x,Se.y,Se.z),j.push(ze.x,ze.y,ze.z)),k[Ce]=null):je in k||(k[je]={index0:I[ae],index1:I[ue],normal:w3.clone()})}}for(const $ in k)if(k[$]){const{index0:re,index1:ie}=k[$];hT.fromBufferAttribute(r,re),fT.fromBufferAttribute(r,ie),j.push(hT.x,hT.y,hT.z),j.push(fT.x,fT.y,fT.z)}this.setAttribute("position",new Mr(j,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Dm{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){ir("Curve: .getPoint() not implemented.")}getPointAt(e,i){const l=this.getUtoTmapping(e);return this.getPoint(l,i)}getPoints(e=5){const i=[];for(let l=0;l<=e;l++)i.push(this.getPoint(l/e));return i}getSpacedPoints(e=5){const i=[];for(let l=0;l<=e;l++)i.push(this.getPointAt(l/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let l,h=this.getPoint(0),g=0;i.push(0);for(let v=1;v<=e;v++)l=this.getPoint(v/e),g+=l.distanceTo(h),i.push(g),h=l;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i=null){const l=this.getLengths();let h=0;const g=l.length;let v;i?v=i:v=e*l[g-1];let r=0,C=g-1,I;for(;r<=C;)if(h=Math.floor(r+(C-r)/2),I=l[h]-v,I<0)r=h+1;else if(I>0)C=h-1;else{C=h;break}if(h=C,l[h]===v)return h/(g-1);const z=l[h],k=l[h+1]-z,j=(v-z)/k;return(h+j)/(g-1)}getTangent(e,i){let h=e-1e-4,g=e+1e-4;h<0&&(h=0),g>1&&(g=1);const v=this.getPoint(h),r=this.getPoint(g),C=i||(v.isVector2?new $i:new gt);return C.copy(r).sub(v).normalize(),C}getTangentAt(e,i){const l=this.getUtoTmapping(e);return this.getTangent(l,i)}computeFrenetFrames(e,i=!1){const l=new gt,h=[],g=[],v=[],r=new gt,C=new ps;for(let j=0;j<=e;j++){const $=j/e;h[j]=this.getTangentAt($,new gt)}g[0]=new gt,v[0]=new gt;let I=Number.MAX_VALUE;const z=Math.abs(h[0].x),N=Math.abs(h[0].y),k=Math.abs(h[0].z);z<=I&&(I=z,l.set(1,0,0)),N<=I&&(I=N,l.set(0,1,0)),k<=I&&l.set(0,0,1),r.crossVectors(h[0],l).normalize(),g[0].crossVectors(h[0],r),v[0].crossVectors(h[0],g[0]);for(let j=1;j<=e;j++){if(g[j]=g[j-1].clone(),v[j]=v[j-1].clone(),r.crossVectors(h[j-1],h[j]),r.length()>Number.EPSILON){r.normalize();const $=Math.acos(os(h[j-1].dot(h[j]),-1,1));g[j].applyMatrix4(C.makeRotationAxis(r,$))}v[j].crossVectors(h[j],g[j])}if(i===!0){let j=Math.acos(os(g[0].dot(g[e]),-1,1));j/=e,h[0].dot(r.crossVectors(g[0],g[e]))>0&&(j=-j);for(let $=1;$<=e;$++)g[$].applyMatrix4(C.makeRotationAxis(h[$],j*$)),v[$].crossVectors(h[$],g[$])}return{tangents:h,normals:g,binormals:v}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class KM extends Dm{constructor(e=0,i=0,l=1,h=1,g=0,v=Math.PI*2,r=!1,C=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=l,this.yRadius=h,this.aStartAngle=g,this.aEndAngle=v,this.aClockwise=r,this.aRotation=C}getPoint(e,i=new $i){const l=i,h=Math.PI*2;let g=this.aEndAngle-this.aStartAngle;const v=Math.abs(g)<Number.EPSILON;for(;g<0;)g+=h;for(;g>h;)g-=h;g<Number.EPSILON&&(v?g=0:g=h),this.aClockwise===!0&&!v&&(g===h?g=-h:g=g-h);const r=this.aStartAngle+e*g;let C=this.aX+this.xRadius*Math.cos(r),I=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){const z=Math.cos(this.aRotation),N=Math.sin(this.aRotation),k=C-this.aX,j=I-this.aY;C=k*z-j*N+this.aX,I=k*N+j*z+this.aY}return l.set(C,I)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ck extends KM{constructor(e,i,l,h,g,v){super(e,i,l,l,h,g,v),this.isArcCurve=!0,this.type="ArcCurve"}}function UI(){let n=0,e=0,i=0,l=0;function h(g,v,r,C){n=g,e=r,i=-3*g+3*v-2*r-C,l=2*g-2*v+r+C}return{initCatmullRom:function(g,v,r,C,I){h(v,r,I*(r-g),I*(C-v))},initNonuniformCatmullRom:function(g,v,r,C,I,z,N){let k=(v-g)/I-(r-g)/(I+z)+(r-v)/z,j=(r-v)/z-(C-v)/(z+N)+(C-r)/N;k*=z,j*=z,h(v,r,k,j)},calc:function(g){const v=g*g,r=v*g;return n+e*g+i*v+l*r}}}const pT=new gt,S3=new UI,T3=new UI,M3=new UI;class uk extends Dm{constructor(e=[],i=!1,l="centripetal",h=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=l,this.tension=h}getPoint(e,i=new gt){const l=i,h=this.points,g=h.length,v=(g-(this.closed?0:1))*e;let r=Math.floor(v),C=v-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/g)+1)*g:C===0&&r===g-1&&(r=g-2,C=1);let I,z;this.closed||r>0?I=h[(r-1)%g]:(pT.subVectors(h[0],h[1]).add(h[0]),I=pT);const N=h[r%g],k=h[(r+1)%g];if(this.closed||r+2<g?z=h[(r+2)%g]:(pT.subVectors(h[g-1],h[g-2]).add(h[g-1]),z=pT),this.curveType==="centripetal"||this.curveType==="chordal"){const j=this.curveType==="chordal"?.5:.25;let $=Math.pow(I.distanceToSquared(N),j),re=Math.pow(N.distanceToSquared(k),j),ie=Math.pow(k.distanceToSquared(z),j);re<1e-4&&(re=1),$<1e-4&&($=re),ie<1e-4&&(ie=re),S3.initNonuniformCatmullRom(I.x,N.x,k.x,z.x,$,re,ie),T3.initNonuniformCatmullRom(I.y,N.y,k.y,z.y,$,re,ie),M3.initNonuniformCatmullRom(I.z,N.z,k.z,z.z,$,re,ie)}else this.curveType==="catmullrom"&&(S3.initCatmullRom(I.x,N.x,k.x,z.x,this.tension),T3.initCatmullRom(I.y,N.y,k.y,z.y,this.tension),M3.initCatmullRom(I.z,N.z,k.z,z.z,this.tension));return l.set(S3.calc(C),T3.calc(C),M3.calc(C)),l}copy(e){super.copy(e),this.points=[];for(let i=0,l=e.points.length;i<l;i++){const h=e.points[i];this.points.push(h.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,l=this.points.length;i<l;i++){const h=this.points[i];e.points.push(h.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,l=e.points.length;i<l;i++){const h=e.points[i];this.points.push(new gt().fromArray(h))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function HB(n,e,i,l,h){const g=(l-e)*.5,v=(h-i)*.5,r=n*n,C=n*r;return(2*i-2*l+g+v)*C+(-3*i+3*l-2*g-v)*r+g*n+i}function FJ(n,e){const i=1-n;return i*i*e}function UJ(n,e){return 2*(1-n)*n*e}function kJ(n,e){return n*n*e}function yb(n,e,i,l){return FJ(n,e)+UJ(n,i)+kJ(n,l)}function VJ(n,e){const i=1-n;return i*i*i*e}function GJ(n,e){const i=1-n;return 3*i*i*n*e}function HJ(n,e){return 3*(1-n)*n*n*e}function jJ(n,e){return n*n*n*e}function xb(n,e,i,l,h){return VJ(n,e)+GJ(n,i)+HJ(n,l)+jJ(n,h)}class kI extends Dm{constructor(e=new $i,i=new $i,l=new $i,h=new $i){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=l,this.v3=h}getPoint(e,i=new $i){const l=i,h=this.v0,g=this.v1,v=this.v2,r=this.v3;return l.set(xb(e,h.x,g.x,v.x,r.x),xb(e,h.y,g.y,v.y,r.y)),l}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class hk extends Dm{constructor(e=new gt,i=new gt,l=new gt,h=new gt){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=l,this.v3=h}getPoint(e,i=new gt){const l=i,h=this.v0,g=this.v1,v=this.v2,r=this.v3;return l.set(xb(e,h.x,g.x,v.x,r.x),xb(e,h.y,g.y,v.y,r.y),xb(e,h.z,g.z,v.z,r.z)),l}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class VI extends Dm{constructor(e=new $i,i=new $i){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new $i){const l=i;return e===1?l.copy(this.v2):(l.copy(this.v2).sub(this.v1),l.multiplyScalar(e).add(this.v1)),l}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new $i){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class fk extends Dm{constructor(e=new gt,i=new gt){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new gt){const l=i;return e===1?l.copy(this.v2):(l.copy(this.v2).sub(this.v1),l.multiplyScalar(e).add(this.v1)),l}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new gt){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class GI extends Dm{constructor(e=new $i,i=new $i,l=new $i){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=l}getPoint(e,i=new $i){const l=i,h=this.v0,g=this.v1,v=this.v2;return l.set(yb(e,h.x,g.x,v.x),yb(e,h.y,g.y,v.y)),l}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class HI extends Dm{constructor(e=new gt,i=new gt,l=new gt){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=l}getPoint(e,i=new gt){const l=i,h=this.v0,g=this.v1,v=this.v2;return l.set(yb(e,h.x,g.x,v.x),yb(e,h.y,g.y,v.y),yb(e,h.z,g.z,v.z)),l}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class jI extends Dm{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new $i){const l=i,h=this.points,g=(h.length-1)*e,v=Math.floor(g),r=g-v,C=h[v===0?v:v-1],I=h[v],z=h[v>h.length-2?h.length-1:v+1],N=h[v>h.length-3?h.length-1:v+2];return l.set(HB(r,C.x,I.x,z.x,N.x),HB(r,C.y,I.y,z.y,N.y)),l}copy(e){super.copy(e),this.points=[];for(let i=0,l=e.points.length;i<l;i++){const h=e.points[i];this.points.push(h.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,l=this.points.length;i<l;i++){const h=this.points[i];e.points.push(h.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,l=e.points.length;i<l;i++){const h=e.points[i];this.points.push(new $i().fromArray(h))}return this}}var fM=Object.freeze({__proto__:null,ArcCurve:ck,CatmullRomCurve3:uk,CubicBezierCurve:kI,CubicBezierCurve3:hk,EllipseCurve:KM,LineCurve:VI,LineCurve3:fk,QuadraticBezierCurve:GI,QuadraticBezierCurve3:HI,SplineCurve:jI});class dk extends Dm{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const l=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new fM[l](i,e))}return this}getPoint(e,i){const l=e*this.getLength(),h=this.getCurveLengths();let g=0;for(;g<h.length;){if(h[g]>=l){const v=h[g]-l,r=this.curves[g],C=r.getLength(),I=C===0?0:1-v/C;return r.getPointAt(I,i)}g++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let l=0,h=this.curves.length;l<h;l++)i+=this.curves[l].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let l=0;l<=e;l++)i.push(this.getPoint(l/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let l;for(let h=0,g=this.curves;h<g.length;h++){const v=g[h],r=v.isEllipseCurve?e*2:v.isLineCurve||v.isLineCurve3?1:v.isSplineCurve?e*v.points.length:e,C=v.getPoints(r);for(let I=0;I<C.length;I++){const z=C[I];l&&l.equals(z)||(i.push(z),l=z)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,l=e.curves.length;i<l;i++){const h=e.curves[i];this.curves.push(h.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,l=this.curves.length;i<l;i++){const h=this.curves[i];e.curves.push(h.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,l=e.curves.length;i<l;i++){const h=e.curves[i];this.curves.push(new fM[h.type]().fromJSON(h))}return this}}class dM extends dk{constructor(e){super(),this.type="Path",this.currentPoint=new $i,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,l=e.length;i<l;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const l=new VI(this.currentPoint.clone(),new $i(e,i));return this.curves.push(l),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,l,h){const g=new GI(this.currentPoint.clone(),new $i(e,i),new $i(l,h));return this.curves.push(g),this.currentPoint.set(l,h),this}bezierCurveTo(e,i,l,h,g,v){const r=new kI(this.currentPoint.clone(),new $i(e,i),new $i(l,h),new $i(g,v));return this.curves.push(r),this.currentPoint.set(g,v),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),l=new jI(i);return this.curves.push(l),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,l,h,g,v){const r=this.currentPoint.x,C=this.currentPoint.y;return this.absarc(e+r,i+C,l,h,g,v),this}absarc(e,i,l,h,g,v){return this.absellipse(e,i,l,l,h,g,v),this}ellipse(e,i,l,h,g,v,r,C){const I=this.currentPoint.x,z=this.currentPoint.y;return this.absellipse(e+I,i+z,l,h,g,v,r,C),this}absellipse(e,i,l,h,g,v,r,C){const I=new KM(e,i,l,h,g,v,r,C);if(this.curves.length>0){const N=I.getPoint(0);N.equals(this.currentPoint)||this.lineTo(N.x,N.y)}this.curves.push(I);const z=I.getPoint(1);return this.currentPoint.copy(z),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class my extends dM{constructor(e){super(e),this.uuid=Vd(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let l=0,h=this.holes.length;l<h;l++)i[l]=this.holes[l].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,l=e.holes.length;i<l;i++){const h=e.holes[i];this.holes.push(h.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,l=this.holes.length;i<l;i++){const h=this.holes[i];e.holes.push(h.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,l=e.holes.length;i<l;i++){const h=e.holes[i];this.holes.push(new dM().fromJSON(h))}return this}}function qJ(n,e,i=2){const l=e&&e.length,h=l?e[0]*i:n.length;let g=pk(n,0,h,i,!0);const v=[];if(!g||g.next===g.prev)return v;let r,C,I;if(l&&(g=KJ(n,e,g,i)),n.length>80*i){r=n[0],C=n[1];let z=r,N=C;for(let k=i;k<h;k+=i){const j=n[k],$=n[k+1];j<r&&(r=j),$<C&&(C=$),j>z&&(z=j),$>N&&(N=$)}I=Math.max(z-r,N-C),I=I!==0?32767/I:0}return Wb(g,v,i,r,C,I,0),v}function pk(n,e,i,l,h){let g;if(h===oQ(n,e,i,l)>0)for(let v=e;v<i;v+=l)g=jB(v/l|0,n[v],n[v+1],g);else for(let v=i-l;v>=e;v-=l)g=jB(v/l|0,n[v],n[v+1],g);return g&&uv(g,g.next)&&(Yb(g),g=g.next),g}function My(n,e){if(!n)return n;e||(e=n);let i=n,l;do if(l=!1,!i.steiner&&(uv(i,i.next)||el(i.prev,i,i.next)===0)){if(Yb(i),i=e=i.prev,i===i.next)break;l=!0}else i=i.next;while(l||i!==e);return e}function Wb(n,e,i,l,h,g,v){if(!n)return;!v&&g&&tQ(n,l,h,g);let r=n;for(;n.prev!==n.next;){const C=n.prev,I=n.next;if(g?WJ(n,l,h,g):XJ(n)){e.push(C.i,n.i,I.i),Yb(n),n=I.next,r=I.next;continue}if(n=I,n===r){v?v===1?(n=ZJ(My(n),e),Wb(n,e,i,l,h,g,2)):v===2&&YJ(n,e,i,l,h,g):Wb(My(n),e,i,l,h,g,1);break}}}function XJ(n){const e=n.prev,i=n,l=n.next;if(el(e,i,l)>=0)return!1;const h=e.x,g=i.x,v=l.x,r=e.y,C=i.y,I=l.y,z=Math.min(h,g,v),N=Math.min(r,C,I),k=Math.max(h,g,v),j=Math.max(r,C,I);let $=l.next;for(;$!==e;){if($.x>=z&&$.x<=k&&$.y>=N&&$.y<=j&&tb(h,r,g,C,v,I,$.x,$.y)&&el($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function WJ(n,e,i,l){const h=n.prev,g=n,v=n.next;if(el(h,g,v)>=0)return!1;const r=h.x,C=g.x,I=v.x,z=h.y,N=g.y,k=v.y,j=Math.min(r,C,I),$=Math.min(z,N,k),re=Math.max(r,C,I),ie=Math.max(z,N,k),Y=pR(j,$,e,i,l),ae=pR(re,ie,e,i,l);let ue=n.prevZ,me=n.nextZ;for(;ue&&ue.z>=Y&&me&&me.z<=ae;){if(ue.x>=j&&ue.x<=re&&ue.y>=$&&ue.y<=ie&&ue!==h&&ue!==v&&tb(r,z,C,N,I,k,ue.x,ue.y)&&el(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,me.x>=j&&me.x<=re&&me.y>=$&&me.y<=ie&&me!==h&&me!==v&&tb(r,z,C,N,I,k,me.x,me.y)&&el(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ue&&ue.z>=Y;){if(ue.x>=j&&ue.x<=re&&ue.y>=$&&ue.y<=ie&&ue!==h&&ue!==v&&tb(r,z,C,N,I,k,ue.x,ue.y)&&el(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;me&&me.z<=ae;){if(me.x>=j&&me.x<=re&&me.y>=$&&me.y<=ie&&me!==h&&me!==v&&tb(r,z,C,N,I,k,me.x,me.y)&&el(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function ZJ(n,e){let i=n;do{const l=i.prev,h=i.next.next;!uv(l,h)&&gk(l,i,i.next,h)&&Zb(l,h)&&Zb(h,l)&&(e.push(l.i,i.i,h.i),Yb(i),Yb(i.next),i=n=h),i=i.next}while(i!==n);return My(i)}function YJ(n,e,i,l,h,g){let v=n;do{let r=v.next.next;for(;r!==v.prev;){if(v.i!==r.i&&rQ(v,r)){let C=_k(v,r);v=My(v,v.next),C=My(C,C.next),Wb(v,e,i,l,h,g,0),Wb(C,e,i,l,h,g,0);return}r=r.next}v=v.next}while(v!==n)}function KJ(n,e,i,l){const h=[];for(let g=0,v=e.length;g<v;g++){const r=e[g]*l,C=g<v-1?e[g+1]*l:n.length,I=pk(n,r,C,l,!1);I===I.next&&(I.steiner=!0),h.push(nQ(I))}h.sort($J);for(let g=0;g<h.length;g++)i=JJ(h[g],i);return i}function $J(n,e){let i=n.x-e.x;if(i===0&&(i=n.y-e.y,i===0)){const l=(n.next.y-n.y)/(n.next.x-n.x),h=(e.next.y-e.y)/(e.next.x-e.x);i=l-h}return i}function JJ(n,e){const i=QJ(n,e);if(!i)return e;const l=_k(i,n);return My(l,l.next),My(i,i.next)}function QJ(n,e){let i=e;const l=n.x,h=n.y;let g=-1/0,v;if(uv(n,i))return i;do{if(uv(n,i.next))return i.next;if(h<=i.y&&h>=i.next.y&&i.next.y!==i.y){const N=i.x+(h-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(N<=l&&N>g&&(g=N,v=i.x<i.next.x?i:i.next,N===l))return v}i=i.next}while(i!==e);if(!v)return null;const r=v,C=v.x,I=v.y;let z=1/0;i=v;do{if(l>=i.x&&i.x>=C&&l!==i.x&&mk(h<I?l:g,h,C,I,h<I?g:l,h,i.x,i.y)){const N=Math.abs(h-i.y)/(l-i.x);Zb(i,n)&&(N<z||N===z&&(i.x>v.x||i.x===v.x&&eQ(v,i)))&&(v=i,z=N)}i=i.next}while(i!==r);return v}function eQ(n,e){return el(n.prev,n,e.prev)<0&&el(e.next,n,n.next)<0}function tQ(n,e,i,l){let h=n;do h.z===0&&(h.z=pR(h.x,h.y,e,i,l)),h.prevZ=h.prev,h.nextZ=h.next,h=h.next;while(h!==n);h.prevZ.nextZ=null,h.prevZ=null,iQ(h)}function iQ(n){let e,i=1;do{let l=n,h;n=null;let g=null;for(e=0;l;){e++;let v=l,r=0;for(let I=0;I<i&&(r++,v=v.nextZ,!!v);I++);let C=i;for(;r>0||C>0&&v;)r!==0&&(C===0||!v||l.z<=v.z)?(h=l,l=l.nextZ,r--):(h=v,v=v.nextZ,C--),g?g.nextZ=h:n=h,h.prevZ=g,g=h;l=v}g.nextZ=null,i*=2}while(e>1);return n}function pR(n,e,i,l,h){return n=(n-i)*h|0,e=(e-l)*h|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function nQ(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function mk(n,e,i,l,h,g,v,r){return(h-v)*(e-r)>=(n-v)*(g-r)&&(n-v)*(l-r)>=(i-v)*(e-r)&&(i-v)*(g-r)>=(h-v)*(l-r)}function tb(n,e,i,l,h,g,v,r){return!(n===v&&e===r)&&mk(n,e,i,l,h,g,v,r)}function rQ(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!sQ(n,e)&&(Zb(n,e)&&Zb(e,n)&&aQ(n,e)&&(el(n.prev,n,e.prev)||el(n,e.prev,e))||uv(n,e)&&el(n.prev,n,n.next)>0&&el(e.prev,e,e.next)>0)}function el(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function uv(n,e){return n.x===e.x&&n.y===e.y}function gk(n,e,i,l){const h=gT(el(n,e,i)),g=gT(el(n,e,l)),v=gT(el(i,l,n)),r=gT(el(i,l,e));return!!(h!==g&&v!==r||h===0&&mT(n,i,e)||g===0&&mT(n,l,e)||v===0&&mT(i,n,l)||r===0&&mT(i,e,l))}function mT(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function gT(n){return n>0?1:n<0?-1:0}function sQ(n,e){let i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==e.i&&i.next.i!==e.i&&gk(i,i.next,n,e))return!0;i=i.next}while(i!==n);return!1}function Zb(n,e){return el(n.prev,n,n.next)<0?el(n,e,n.next)>=0&&el(n,n.prev,e)>=0:el(n,e,n.prev)<0||el(n,n.next,e)<0}function aQ(n,e){let i=n,l=!1;const h=(n.x+e.x)/2,g=(n.y+e.y)/2;do i.y>g!=i.next.y>g&&i.next.y!==i.y&&h<(i.next.x-i.x)*(g-i.y)/(i.next.y-i.y)+i.x&&(l=!l),i=i.next;while(i!==n);return l}function _k(n,e){const i=mR(n.i,n.x,n.y),l=mR(e.i,e.x,e.y),h=n.next,g=e.prev;return n.next=e,e.prev=n,i.next=h,h.prev=i,l.next=i,i.prev=l,g.next=l,l.prev=g,l}function jB(n,e,i,l){const h=mR(n,e,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Yb(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function mR(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function oQ(n,e,i,l){let h=0;for(let g=e,v=i-l;g<i;g+=l)h+=(n[v]-n[g])*(n[g+1]+n[v+1]),v=g;return h}class lQ{static triangulate(e,i,l=2){return qJ(e,i,l)}}class Am{static area(e){const i=e.length;let l=0;for(let h=i-1,g=0;g<i;h=g++)l+=e[h].x*e[g].y-e[g].x*e[h].y;return l*.5}static isClockWise(e){return Am.area(e)<0}static triangulateShape(e,i){const l=[],h=[],g=[];qB(e),XB(l,e);let v=e.length;i.forEach(qB);for(let C=0;C<i.length;C++)h.push(v),v+=i[C].length,XB(l,i[C]);const r=lQ.triangulate(l,h);for(let C=0;C<r.length;C+=3)g.push(r.slice(C,C+3));return g}}function qB(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function XB(n,e){for(let i=0;i<e.length;i++)n.push(e[i].x),n.push(e[i].y)}class $M extends Is{constructor(e=new my([new $i(.5,.5),new $i(-.5,.5),new $i(-.5,-.5),new $i(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const l=this,h=[],g=[];for(let r=0,C=e.length;r<C;r++){const I=e[r];v(I)}this.setAttribute("position",new Mr(h,3)),this.setAttribute("uv",new Mr(g,2)),this.computeVertexNormals();function v(r){const C=[],I=i.curveSegments!==void 0?i.curveSegments:12,z=i.steps!==void 0?i.steps:1,N=i.depth!==void 0?i.depth:1;let k=i.bevelEnabled!==void 0?i.bevelEnabled:!0,j=i.bevelThickness!==void 0?i.bevelThickness:.2,$=i.bevelSize!==void 0?i.bevelSize:j-.1,re=i.bevelOffset!==void 0?i.bevelOffset:0,ie=i.bevelSegments!==void 0?i.bevelSegments:3;const Y=i.extrudePath,ae=i.UVGenerator!==void 0?i.UVGenerator:cQ;let ue,me=!1,Ae,Se,ze,je;Y&&(ue=Y.getSpacedPoints(z),me=!0,k=!1,Ae=Y.computeFrenetFrames(z,!1),Se=new gt,ze=new gt,je=new gt),k||(ie=0,j=0,$=0,re=0);const Ce=r.extractPoints(I);let Te=Ce.shape;const Ze=Ce.holes;if(!Am.isClockWise(Te)){Te=Te.reverse();for(let Vi=0,st=Ze.length;Vi<st;Vi++){const Xi=Ze[Vi];Am.isClockWise(Xi)&&(Ze[Vi]=Xi.reverse())}}function mt(Vi){const Xi=10000000000000001e-36;let Ji=Vi[0];for(let Di=1;Di<=Vi.length;Di++){const tn=Di%Vi.length,Sn=Vi[tn],_n=Sn.x-Ji.x,Gn=Sn.y-Ji.y,ot=_n*_n+Gn*Gn,De=Math.max(Math.abs(Sn.x),Math.abs(Sn.y),Math.abs(Ji.x),Math.abs(Ji.y)),Qt=Xi*De*De;if(ot<=Qt){Vi.splice(tn,1),Di--;continue}Ji=Sn}}mt(Te),Ze.forEach(mt);const Gt=Ze.length,kt=Te;for(let Vi=0;Vi<Gt;Vi++){const st=Ze[Vi];Te=Te.concat(st)}function Re(Vi,st,Xi){return st||ys("ExtrudeGeometry: vec does not exist"),Vi.clone().addScaledVector(st,Xi)}const Qe=Te.length;function et(Vi,st,Xi){let Ji,Di,tn;const Sn=Vi.x-st.x,_n=Vi.y-st.y,Gn=Xi.x-Vi.x,ot=Xi.y-Vi.y,De=Sn*Sn+_n*_n,Qt=Sn*ot-_n*Gn;if(Math.abs(Qt)>Number.EPSILON){const Li=Math.sqrt(De),Wi=Math.sqrt(Gn*Gn+ot*ot),Ei=st.x-_n/Li,Hn=st.y+Sn/Li,An=Xi.x-ot/Wi,dr=Xi.y+Gn/Wi,Jn=((An-Ei)*ot-(dr-Hn)*Gn)/(Sn*ot-_n*Gn);Ji=Ei+Sn*Jn-Vi.x,Di=Hn+_n*Jn-Vi.y;const Qi=Ji*Ji+Di*Di;if(Qi<=2)return new $i(Ji,Di);tn=Math.sqrt(Qi/2)}else{let Li=!1;Sn>Number.EPSILON?Gn>Number.EPSILON&&(Li=!0):Sn<-Number.EPSILON?Gn<-Number.EPSILON&&(Li=!0):Math.sign(_n)===Math.sign(ot)&&(Li=!0),Li?(Ji=-_n,Di=Sn,tn=Math.sqrt(De)):(Ji=Sn,Di=_n,tn=Math.sqrt(De/2))}return new $i(Ji/tn,Di/tn)}const Lt=[];for(let Vi=0,st=kt.length,Xi=st-1,Ji=Vi+1;Vi<st;Vi++,Xi++,Ji++)Xi===st&&(Xi=0),Ji===st&&(Ji=0),Lt[Vi]=et(kt[Vi],kt[Xi],kt[Ji]);const jt=[];let Ge,Et=Lt.concat();for(let Vi=0,st=Gt;Vi<st;Vi++){const Xi=Ze[Vi];Ge=[];for(let Ji=0,Di=Xi.length,tn=Di-1,Sn=Ji+1;Ji<Di;Ji++,tn++,Sn++)tn===Di&&(tn=0),Sn===Di&&(Sn=0),Ge[Ji]=et(Xi[Ji],Xi[tn],Xi[Sn]);jt.push(Ge),Et=Et.concat(Ge)}let Vt;if(ie===0)Vt=Am.triangulateShape(kt,Ze);else{const Vi=[],st=[];for(let Xi=0;Xi<ie;Xi++){const Ji=Xi/ie,Di=j*Math.cos(Ji*Math.PI/2),tn=$*Math.sin(Ji*Math.PI/2)+re;for(let Sn=0,_n=kt.length;Sn<_n;Sn++){const Gn=Re(kt[Sn],Lt[Sn],tn);Ui(Gn.x,Gn.y,-Di),Ji===0&&Vi.push(Gn)}for(let Sn=0,_n=Gt;Sn<_n;Sn++){const Gn=Ze[Sn];Ge=jt[Sn];const ot=[];for(let De=0,Qt=Gn.length;De<Qt;De++){const Li=Re(Gn[De],Ge[De],tn);Ui(Li.x,Li.y,-Di),Ji===0&&ot.push(Li)}Ji===0&&st.push(ot)}}Vt=Am.triangulateShape(Vi,st)}const ii=Vt.length,ki=$+re;for(let Vi=0;Vi<Qe;Vi++){const st=k?Re(Te[Vi],Et[Vi],ki):Te[Vi];me?(ze.copy(Ae.normals[0]).multiplyScalar(st.x),Se.copy(Ae.binormals[0]).multiplyScalar(st.y),je.copy(ue[0]).add(ze).add(Se),Ui(je.x,je.y,je.z)):Ui(st.x,st.y,0)}for(let Vi=1;Vi<=z;Vi++)for(let st=0;st<Qe;st++){const Xi=k?Re(Te[st],Et[st],ki):Te[st];me?(ze.copy(Ae.normals[Vi]).multiplyScalar(Xi.x),Se.copy(Ae.binormals[Vi]).multiplyScalar(Xi.y),je.copy(ue[Vi]).add(ze).add(Se),Ui(je.x,je.y,je.z)):Ui(Xi.x,Xi.y,N/z*Vi)}for(let Vi=ie-1;Vi>=0;Vi--){const st=Vi/ie,Xi=j*Math.cos(st*Math.PI/2),Ji=$*Math.sin(st*Math.PI/2)+re;for(let Di=0,tn=kt.length;Di<tn;Di++){const Sn=Re(kt[Di],Lt[Di],Ji);Ui(Sn.x,Sn.y,N+Xi)}for(let Di=0,tn=Ze.length;Di<tn;Di++){const Sn=Ze[Di];Ge=jt[Di];for(let _n=0,Gn=Sn.length;_n<Gn;_n++){const ot=Re(Sn[_n],Ge[_n],Ji);me?Ui(ot.x,ot.y+ue[z-1].y,ue[z-1].x+Xi):Ui(ot.x,ot.y,N+Xi)}}}qt(),xi();function qt(){const Vi=h.length/3;if(k){let st=0,Xi=Qe*st;for(let Ji=0;Ji<ii;Ji++){const Di=Vt[Ji];rn(Di[2]+Xi,Di[1]+Xi,Di[0]+Xi)}st=z+ie*2,Xi=Qe*st;for(let Ji=0;Ji<ii;Ji++){const Di=Vt[Ji];rn(Di[0]+Xi,Di[1]+Xi,Di[2]+Xi)}}else{for(let st=0;st<ii;st++){const Xi=Vt[st];rn(Xi[2],Xi[1],Xi[0])}for(let st=0;st<ii;st++){const Xi=Vt[st];rn(Xi[0]+Qe*z,Xi[1]+Qe*z,Xi[2]+Qe*z)}}l.addGroup(Vi,h.length/3-Vi,0)}function xi(){const Vi=h.length/3;let st=0;Fi(kt,st),st+=kt.length;for(let Xi=0,Ji=Ze.length;Xi<Ji;Xi++){const Di=Ze[Xi];Fi(Di,st),st+=Di.length}l.addGroup(Vi,h.length/3-Vi,1)}function Fi(Vi,st){let Xi=Vi.length;for(;--Xi>=0;){const Ji=Xi;let Di=Xi-1;Di<0&&(Di=Vi.length-1);for(let tn=0,Sn=z+ie*2;tn<Sn;tn++){const _n=Qe*tn,Gn=Qe*(tn+1),ot=st+Ji+_n,De=st+Di+_n,Qt=st+Di+Gn,Li=st+Ji+Gn;Fn(ot,De,Qt,Li)}}}function Ui(Vi,st,Xi){C.push(Vi),C.push(st),C.push(Xi)}function rn(Vi,st,Xi){Er(Vi),Er(st),Er(Xi);const Ji=h.length/3,Di=ae.generateTopUV(l,h,Ji-3,Ji-2,Ji-1);xn(Di[0]),xn(Di[1]),xn(Di[2])}function Fn(Vi,st,Xi,Ji){Er(Vi),Er(st),Er(Ji),Er(st),Er(Xi),Er(Ji);const Di=h.length/3,tn=ae.generateSideWallUV(l,h,Di-6,Di-3,Di-2,Di-1);xn(tn[0]),xn(tn[1]),xn(tn[3]),xn(tn[1]),xn(tn[2]),xn(tn[3])}function Er(Vi){h.push(C[Vi*3+0]),h.push(C[Vi*3+1]),h.push(C[Vi*3+2])}function xn(Vi){g.push(Vi.x),g.push(Vi.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,l=this.parameters.options;return uQ(i,l,e)}static fromJSON(e,i){const l=[];for(let g=0,v=e.shapes.length;g<v;g++){const r=i[e.shapes[g]];l.push(r)}const h=e.options.extrudePath;return h!==void 0&&(e.options.extrudePath=new fM[h.type]().fromJSON(h)),new $M(l,e.options)}}const cQ={generateTopUV:function(n,e,i,l,h){const g=e[i*3],v=e[i*3+1],r=e[l*3],C=e[l*3+1],I=e[h*3],z=e[h*3+1];return[new $i(g,v),new $i(r,C),new $i(I,z)]},generateSideWallUV:function(n,e,i,l,h,g){const v=e[i*3],r=e[i*3+1],C=e[i*3+2],I=e[l*3],z=e[l*3+1],N=e[l*3+2],k=e[h*3],j=e[h*3+1],$=e[h*3+2],re=e[g*3],ie=e[g*3+1],Y=e[g*3+2];return Math.abs(r-z)<Math.abs(v-I)?[new $i(v,1-C),new $i(I,1-N),new $i(k,1-$),new $i(re,1-Y)]:[new $i(r,1-C),new $i(z,1-N),new $i(j,1-$),new $i(ie,1-Y)]}};function uQ(n,e,i){if(i.shapes=[],Array.isArray(n))for(let l=0,h=n.length;l<h;l++){const g=n[l];i.shapes.push(g.uuid)}else i.shapes.push(n.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class JM extends l0{constructor(e=1,i=0){const l=(1+Math.sqrt(5))/2,h=[-1,l,0,1,l,0,-1,-l,0,1,-l,0,0,-1,l,0,1,l,0,-1,-l,0,1,-l,l,0,-1,l,0,1,-l,0,-1,-l,0,1],g=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(h,g,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new JM(e.radius,e.detail)}}class QM extends Is{constructor(e=[new $i(0,-.5),new $i(.5,0),new $i(0,.5)],i=12,l=0,h=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:l,phiLength:h},i=Math.floor(i),h=os(h,0,Math.PI*2);const g=[],v=[],r=[],C=[],I=[],z=1/i,N=new gt,k=new $i,j=new gt,$=new gt,re=new gt;let ie=0,Y=0;for(let ae=0;ae<=e.length-1;ae++)switch(ae){case 0:ie=e[ae+1].x-e[ae].x,Y=e[ae+1].y-e[ae].y,j.x=Y*1,j.y=-ie,j.z=Y*0,re.copy(j),j.normalize(),C.push(j.x,j.y,j.z);break;case e.length-1:C.push(re.x,re.y,re.z);break;default:ie=e[ae+1].x-e[ae].x,Y=e[ae+1].y-e[ae].y,j.x=Y*1,j.y=-ie,j.z=Y*0,$.copy(j),j.x+=re.x,j.y+=re.y,j.z+=re.z,j.normalize(),C.push(j.x,j.y,j.z),re.copy($)}for(let ae=0;ae<=i;ae++){const ue=l+ae*z*h,me=Math.sin(ue),Ae=Math.cos(ue);for(let Se=0;Se<=e.length-1;Se++){N.x=e[Se].x*me,N.y=e[Se].y,N.z=e[Se].x*Ae,v.push(N.x,N.y,N.z),k.x=ae/i,k.y=Se/(e.length-1),r.push(k.x,k.y);const ze=C[3*Se+0]*me,je=C[3*Se+1],Ce=C[3*Se+0]*Ae;I.push(ze,je,Ce)}}for(let ae=0;ae<i;ae++)for(let ue=0;ue<e.length-1;ue++){const me=ue+ae*e.length,Ae=me,Se=me+e.length,ze=me+e.length+1,je=me+1;g.push(Ae,Se,je),g.push(ze,je,Se)}this.setIndex(g),this.setAttribute("position",new Mr(v,3)),this.setAttribute("uv",new Mr(r,2)),this.setAttribute("normal",new Mr(I,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QM(e.points,e.segments,e.phiStart,e.phiLength)}}class mw extends l0{constructor(e=1,i=0){const l=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],h=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(l,h,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new mw(e.radius,e.detail)}}class bv extends Is{constructor(e=1,i=1,l=1,h=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:l,heightSegments:h};const g=e/2,v=i/2,r=Math.floor(l),C=Math.floor(h),I=r+1,z=C+1,N=e/r,k=i/C,j=[],$=[],re=[],ie=[];for(let Y=0;Y<z;Y++){const ae=Y*k-v;for(let ue=0;ue<I;ue++){const me=ue*N-g;$.push(me,-ae,0),re.push(0,0,1),ie.push(ue/r),ie.push(1-Y/C)}}for(let Y=0;Y<C;Y++)for(let ae=0;ae<r;ae++){const ue=ae+I*Y,me=ae+I*(Y+1),Ae=ae+1+I*(Y+1),Se=ae+1+I*Y;j.push(ue,me,Se),j.push(me,Ae,Se)}this.setIndex(j),this.setAttribute("position",new Mr($,3)),this.setAttribute("normal",new Mr(re,3)),this.setAttribute("uv",new Mr(ie,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bv(e.width,e.height,e.widthSegments,e.heightSegments)}}class eE extends Is{constructor(e=.5,i=1,l=32,h=1,g=0,v=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:l,phiSegments:h,thetaStart:g,thetaLength:v},l=Math.max(3,l),h=Math.max(1,h);const r=[],C=[],I=[],z=[];let N=e;const k=(i-e)/h,j=new gt,$=new $i;for(let re=0;re<=h;re++){for(let ie=0;ie<=l;ie++){const Y=g+ie/l*v;j.x=N*Math.cos(Y),j.y=N*Math.sin(Y),C.push(j.x,j.y,j.z),I.push(0,0,1),$.x=(j.x/i+1)/2,$.y=(j.y/i+1)/2,z.push($.x,$.y)}N+=k}for(let re=0;re<h;re++){const ie=re*(l+1);for(let Y=0;Y<l;Y++){const ae=Y+ie,ue=ae,me=ae+l+1,Ae=ae+l+2,Se=ae+1;r.push(ue,me,Se),r.push(me,Ae,Se)}}this.setIndex(r),this.setAttribute("position",new Mr(C,3)),this.setAttribute("normal",new Mr(I,3)),this.setAttribute("uv",new Mr(z,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eE(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class tE extends Is{constructor(e=new my([new $i(0,.5),new $i(-.5,-.5),new $i(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const l=[],h=[],g=[],v=[];let r=0,C=0;if(Array.isArray(e)===!1)I(e);else for(let z=0;z<e.length;z++)I(e[z]),this.addGroup(r,C,z),r+=C,C=0;this.setIndex(l),this.setAttribute("position",new Mr(h,3)),this.setAttribute("normal",new Mr(g,3)),this.setAttribute("uv",new Mr(v,2));function I(z){const N=h.length/3,k=z.extractPoints(i);let j=k.shape;const $=k.holes;Am.isClockWise(j)===!1&&(j=j.reverse());for(let ie=0,Y=$.length;ie<Y;ie++){const ae=$[ie];Am.isClockWise(ae)===!0&&($[ie]=ae.reverse())}const re=Am.triangulateShape(j,$);for(let ie=0,Y=$.length;ie<Y;ie++){const ae=$[ie];j=j.concat(ae)}for(let ie=0,Y=j.length;ie<Y;ie++){const ae=j[ie];h.push(ae.x,ae.y,0),g.push(0,0,1),v.push(ae.x,ae.y)}for(let ie=0,Y=re.length;ie<Y;ie++){const ae=re[ie],ue=ae[0]+N,me=ae[1]+N,Ae=ae[2]+N;l.push(ue,me,Ae),C+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return hQ(i,e)}static fromJSON(e,i){const l=[];for(let h=0,g=e.shapes.length;h<g;h++){const v=i[e.shapes[h]];l.push(v)}return new tE(l,e.curveSegments)}}function hQ(n,e){if(e.shapes=[],Array.isArray(n))for(let i=0,l=n.length;i<l;i++){const h=n[i];e.shapes.push(h.uuid)}else e.shapes.push(n.uuid);return e}class gw extends Is{constructor(e=1,i=32,l=16,h=0,g=Math.PI*2,v=0,r=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:l,phiStart:h,phiLength:g,thetaStart:v,thetaLength:r},i=Math.max(3,Math.floor(i)),l=Math.max(2,Math.floor(l));const C=Math.min(v+r,Math.PI);let I=0;const z=[],N=new gt,k=new gt,j=[],$=[],re=[],ie=[];for(let Y=0;Y<=l;Y++){const ae=[],ue=Y/l;let me=0;Y===0&&v===0?me=.5/i:Y===l&&C===Math.PI&&(me=-.5/i);for(let Ae=0;Ae<=i;Ae++){const Se=Ae/i;N.x=-e*Math.cos(h+Se*g)*Math.sin(v+ue*r),N.y=e*Math.cos(v+ue*r),N.z=e*Math.sin(h+Se*g)*Math.sin(v+ue*r),$.push(N.x,N.y,N.z),k.copy(N).normalize(),re.push(k.x,k.y,k.z),ie.push(Se+me,1-ue),ae.push(I++)}z.push(ae)}for(let Y=0;Y<l;Y++)for(let ae=0;ae<i;ae++){const ue=z[Y][ae+1],me=z[Y][ae],Ae=z[Y+1][ae],Se=z[Y+1][ae+1];(Y!==0||v>0)&&j.push(ue,me,Se),(Y!==l-1||C<Math.PI)&&j.push(me,Ae,Se)}this.setIndex(j),this.setAttribute("position",new Mr($,3)),this.setAttribute("normal",new Mr(re,3)),this.setAttribute("uv",new Mr(ie,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gw(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class iE extends l0{constructor(e=1,i=0){const l=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],h=[2,1,0,0,3,2,1,3,0,2,3,1];super(l,h,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new iE(e.radius,e.detail)}}class nE extends Is{constructor(e=1,i=.4,l=12,h=48,g=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:l,tubularSegments:h,arc:g},l=Math.floor(l),h=Math.floor(h);const v=[],r=[],C=[],I=[],z=new gt,N=new gt,k=new gt;for(let j=0;j<=l;j++)for(let $=0;$<=h;$++){const re=$/h*g,ie=j/l*Math.PI*2;N.x=(e+i*Math.cos(ie))*Math.cos(re),N.y=(e+i*Math.cos(ie))*Math.sin(re),N.z=i*Math.sin(ie),r.push(N.x,N.y,N.z),z.x=e*Math.cos(re),z.y=e*Math.sin(re),k.subVectors(N,z).normalize(),C.push(k.x,k.y,k.z),I.push($/h),I.push(j/l)}for(let j=1;j<=l;j++)for(let $=1;$<=h;$++){const re=(h+1)*j+$-1,ie=(h+1)*(j-1)+$-1,Y=(h+1)*(j-1)+$,ae=(h+1)*j+$;v.push(re,ie,ae),v.push(ie,Y,ae)}this.setIndex(v),this.setAttribute("position",new Mr(r,3)),this.setAttribute("normal",new Mr(C,3)),this.setAttribute("uv",new Mr(I,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nE(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class rE extends Is{constructor(e=1,i=.4,l=64,h=8,g=2,v=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:l,radialSegments:h,p:g,q:v},l=Math.floor(l),h=Math.floor(h);const r=[],C=[],I=[],z=[],N=new gt,k=new gt,j=new gt,$=new gt,re=new gt,ie=new gt,Y=new gt;for(let ue=0;ue<=l;++ue){const me=ue/l*g*Math.PI*2;ae(me,g,v,e,j),ae(me+.01,g,v,e,$),ie.subVectors($,j),Y.addVectors($,j),re.crossVectors(ie,Y),Y.crossVectors(re,ie),re.normalize(),Y.normalize();for(let Ae=0;Ae<=h;++Ae){const Se=Ae/h*Math.PI*2,ze=-i*Math.cos(Se),je=i*Math.sin(Se);N.x=j.x+(ze*Y.x+je*re.x),N.y=j.y+(ze*Y.y+je*re.y),N.z=j.z+(ze*Y.z+je*re.z),C.push(N.x,N.y,N.z),k.subVectors(N,j).normalize(),I.push(k.x,k.y,k.z),z.push(ue/l),z.push(Ae/h)}}for(let ue=1;ue<=l;ue++)for(let me=1;me<=h;me++){const Ae=(h+1)*(ue-1)+(me-1),Se=(h+1)*ue+(me-1),ze=(h+1)*ue+me,je=(h+1)*(ue-1)+me;r.push(Ae,Se,je),r.push(Se,ze,je)}this.setIndex(r),this.setAttribute("position",new Mr(C,3)),this.setAttribute("normal",new Mr(I,3)),this.setAttribute("uv",new Mr(z,2));function ae(ue,me,Ae,Se,ze){const je=Math.cos(ue),Ce=Math.sin(ue),Te=Ae/me*ue,Ze=Math.cos(Te);ze.x=Se*(2+Ze)*.5*je,ze.y=Se*(2+Ze)*Ce*.5,ze.z=Se*Math.sin(Te)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rE(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class sE extends Is{constructor(e=new HI(new gt(-1,-1,0),new gt(-1,1,0),new gt(1,1,0)),i=64,l=1,h=8,g=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:l,radialSegments:h,closed:g};const v=e.computeFrenetFrames(i,g);this.tangents=v.tangents,this.normals=v.normals,this.binormals=v.binormals;const r=new gt,C=new gt,I=new $i;let z=new gt;const N=[],k=[],j=[],$=[];re(),this.setIndex($),this.setAttribute("position",new Mr(N,3)),this.setAttribute("normal",new Mr(k,3)),this.setAttribute("uv",new Mr(j,2));function re(){for(let ue=0;ue<i;ue++)ie(ue);ie(g===!1?i:0),ae(),Y()}function ie(ue){z=e.getPointAt(ue/i,z);const me=v.normals[ue],Ae=v.binormals[ue];for(let Se=0;Se<=h;Se++){const ze=Se/h*Math.PI*2,je=Math.sin(ze),Ce=-Math.cos(ze);C.x=Ce*me.x+je*Ae.x,C.y=Ce*me.y+je*Ae.y,C.z=Ce*me.z+je*Ae.z,C.normalize(),k.push(C.x,C.y,C.z),r.x=z.x+l*C.x,r.y=z.y+l*C.y,r.z=z.z+l*C.z,N.push(r.x,r.y,r.z)}}function Y(){for(let ue=1;ue<=i;ue++)for(let me=1;me<=h;me++){const Ae=(h+1)*(ue-1)+(me-1),Se=(h+1)*ue+(me-1),ze=(h+1)*ue+me,je=(h+1)*(ue-1)+me;$.push(Ae,Se,je),$.push(Se,ze,je)}}function ae(){for(let ue=0;ue<=i;ue++)for(let me=0;me<=h;me++)I.x=ue/i,I.y=me/h,j.push(I.x,I.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new sE(new fM[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class yk extends Is{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],l=new Set,h=new gt,g=new gt;if(e.index!==null){const v=e.attributes.position,r=e.index;let C=e.groups;C.length===0&&(C=[{start:0,count:r.count,materialIndex:0}]);for(let I=0,z=C.length;I<z;++I){const N=C[I],k=N.start,j=N.count;for(let $=k,re=k+j;$<re;$+=3)for(let ie=0;ie<3;ie++){const Y=r.getX($+ie),ae=r.getX($+(ie+1)%3);h.fromBufferAttribute(v,Y),g.fromBufferAttribute(v,ae),WB(h,g,l)===!0&&(i.push(h.x,h.y,h.z),i.push(g.x,g.y,g.z))}}}else{const v=e.attributes.position;for(let r=0,C=v.count/3;r<C;r++)for(let I=0;I<3;I++){const z=3*r+I,N=3*r+(I+1)%3;h.fromBufferAttribute(v,z),g.fromBufferAttribute(v,N),WB(h,g,l)===!0&&(i.push(h.x,h.y,h.z),i.push(g.x,g.y,g.z))}}this.setAttribute("position",new Mr(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function WB(n,e,i){const l=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,h=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return i.has(l)===!0||i.has(h)===!0?!1:(i.add(l),i.add(h),!0)}var ZB=Object.freeze({__proto__:null,BoxGeometry:Ay,CapsuleGeometry:WM,CircleGeometry:ZM,ConeGeometry:pw,CylinderGeometry:dw,DodecahedronGeometry:YM,EdgesGeometry:lk,ExtrudeGeometry:$M,IcosahedronGeometry:JM,LatheGeometry:QM,OctahedronGeometry:mw,PlaneGeometry:bv,PolyhedronGeometry:l0,RingGeometry:eE,ShapeGeometry:tE,SphereGeometry:gw,TetrahedronGeometry:iE,TorusGeometry:nE,TorusKnotGeometry:rE,TubeGeometry:sE,WireframeGeometry:yk});class xk extends tu{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ar(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class vk extends bh{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class qI extends tu{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ar(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a0,this.normalScale=new $i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hd,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class bk extends qI{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new $i(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return os(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ar(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ar(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ar(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class wk extends tu{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ar(16777215),this.specular=new ar(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a0,this.normalScale=new $i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hd,this.combine=uw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Sk extends tu{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ar(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a0,this.normalScale=new $i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class XI extends tu{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a0,this.normalScale=new $i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Tk extends tu{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ar(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ar(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a0,this.normalScale=new $i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hd,this.combine=uw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class WI extends tu{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=s0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ZI extends tu{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class Mk extends tu{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ar(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=a0,this.normalScale=new $i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ek extends ef{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function cy(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function Ak(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ck(n){function e(h,g){return n[h]-n[g]}const i=n.length,l=new Array(i);for(let h=0;h!==i;++h)l[h]=h;return l.sort(e),l}function gR(n,e,i){const l=n.length,h=new n.constructor(l);for(let g=0,v=0;v!==l;++g){const r=i[g]*e;for(let C=0;C!==e;++C)h[v++]=n[r+C]}return h}function YI(n,e,i,l){let h=1,g=n[0];for(;g!==void 0&&g[l]===void 0;)g=n[h++];if(g===void 0)return;let v=g[l];if(v!==void 0)if(Array.isArray(v))do v=g[l],v!==void 0&&(e.push(g.time),i.push(...v)),g=n[h++];while(g!==void 0);else if(v.toArray!==void 0)do v=g[l],v!==void 0&&(e.push(g.time),v.toArray(i,i.length)),g=n[h++];while(g!==void 0);else do v=g[l],v!==void 0&&(e.push(g.time),i.push(v)),g=n[h++];while(g!==void 0)}function fQ(n,e,i,l,h=30){const g=n.clone();g.name=e;const v=[];for(let C=0;C<g.tracks.length;++C){const I=g.tracks[C],z=I.getValueSize(),N=[],k=[];for(let j=0;j<I.times.length;++j){const $=I.times[j]*h;if(!($<i||$>=l)){N.push(I.times[j]);for(let re=0;re<z;++re)k.push(I.values[j*z+re])}}N.length!==0&&(I.times=cy(N,I.times.constructor),I.values=cy(k,I.values.constructor),v.push(I))}g.tracks=v;let r=1/0;for(let C=0;C<g.tracks.length;++C)r>g.tracks[C].times[0]&&(r=g.tracks[C].times[0]);for(let C=0;C<g.tracks.length;++C)g.tracks[C].shift(-1*r);return g.resetDuration(),g}function dQ(n,e=0,i=n,l=30){l<=0&&(l=30);const h=i.tracks.length,g=e/l;for(let v=0;v<h;++v){const r=i.tracks[v],C=r.ValueTypeName;if(C==="bool"||C==="string")continue;const I=n.tracks.find(function(Y){return Y.name===r.name&&Y.ValueTypeName===C});if(I===void 0)continue;let z=0;const N=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(z=N/3);let k=0;const j=I.getValueSize();I.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(k=j/3);const $=r.times.length-1;let re;if(g<=r.times[0]){const Y=z,ae=N-z;re=r.values.slice(Y,ae)}else if(g>=r.times[$]){const Y=$*N+z,ae=Y+N-z;re=r.values.slice(Y,ae)}else{const Y=r.createInterpolant(),ae=z,ue=N-z;Y.evaluate(g),re=Y.resultBuffer.slice(ae,ue)}C==="quaternion"&&new Yf().fromArray(re).normalize().conjugate().toArray(re);const ie=I.times.length;for(let Y=0;Y<ie;++Y){const ae=Y*j+k;if(C==="quaternion")Yf.multiplyQuaternionsFlat(I.values,ae,re,0,I.values,ae);else{const ue=j-k*2;for(let me=0;me<ue;++me)I.values[ae+me]-=re[me]}}}return n.blendMode=RI,n}class pQ{static convertArray(e,i){return cy(e,i)}static isTypedArray(e){return Ak(e)}static getKeyframeOrder(e){return Ck(e)}static sortedArray(e,i,l){return gR(e,i,l)}static flattenJSON(e,i,l,h){YI(e,i,l,h)}static subclip(e,i,l,h,g=30){return fQ(e,i,l,h,g)}static makeClipAdditive(e,i=0,l=e,h=30){return dQ(e,i,l,h)}}class _w{constructor(e,i,l,h){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=h!==void 0?h:new i.constructor(l),this.sampleValues=i,this.valueSize=l,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let l=this._cachedIndex,h=i[l],g=i[l-1];e:{t:{let v;i:{n:if(!(e<h)){for(let r=l+2;;){if(h===void 0){if(e<g)break n;return l=i.length,this._cachedIndex=l,this.copySampleValue_(l-1)}if(l===r)break;if(g=h,h=i[++l],e<h)break t}v=i.length;break i}if(!(e>=g)){const r=i[1];e<r&&(l=2,g=r);for(let C=l-2;;){if(g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(l===C)break;if(h=g,g=i[--l-1],e>=g)break t}v=l,l=0;break i}break e}for(;l<v;){const r=l+v>>>1;e<i[r]?v=r:l=r+1}if(h=i[l],g=i[l-1],g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(h===void 0)return l=i.length,this._cachedIndex=l,this.copySampleValue_(l-1)}this._cachedIndex=l,this.intervalChanged_(l,g,h)}return this.interpolate_(l,g,e,h)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,l=this.sampleValues,h=this.valueSize,g=e*h;for(let v=0;v!==h;++v)i[v]=l[g+v];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Rk extends _w{constructor(e,i,l,h){super(e,i,l,h),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:oy,endingEnd:oy}}intervalChanged_(e,i,l){const h=this.parameterPositions;let g=e-2,v=e+1,r=h[g],C=h[v];if(r===void 0)switch(this.getSettings_().endingStart){case ly:g=e,r=2*i-l;break;case Vb:g=h.length-2,r=i+h[g]-h[g+1];break;default:g=e,r=l}if(C===void 0)switch(this.getSettings_().endingEnd){case ly:v=e,C=2*l-i;break;case Vb:v=1,C=l+h[1]-h[0];break;default:v=e-1,C=i}const I=(l-i)*.5,z=this.valueSize;this._weightPrev=I/(i-r),this._weightNext=I/(C-l),this._offsetPrev=g*z,this._offsetNext=v*z}interpolate_(e,i,l,h){const g=this.resultBuffer,v=this.sampleValues,r=this.valueSize,C=e*r,I=C-r,z=this._offsetPrev,N=this._offsetNext,k=this._weightPrev,j=this._weightNext,$=(l-i)/(h-i),re=$*$,ie=re*$,Y=-k*ie+2*k*re-k*$,ae=(1+k)*ie+(-1.5-2*k)*re+(-.5+k)*$+1,ue=(-1-j)*ie+(1.5+j)*re+.5*$,me=j*ie-j*re;for(let Ae=0;Ae!==r;++Ae)g[Ae]=Y*v[z+Ae]+ae*v[I+Ae]+ue*v[C+Ae]+me*v[N+Ae];return g}}class KI extends _w{constructor(e,i,l,h){super(e,i,l,h)}interpolate_(e,i,l,h){const g=this.resultBuffer,v=this.sampleValues,r=this.valueSize,C=e*r,I=C-r,z=(l-i)/(h-i),N=1-z;for(let k=0;k!==r;++k)g[k]=v[I+k]*N+v[C+k]*z;return g}}class Ik extends _w{constructor(e,i,l,h){super(e,i,l,h)}interpolate_(e){return this.copySampleValue_(e-1)}}class Dp{constructor(e,i,l,h){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=cy(i,this.TimeBufferType),this.values=cy(l,this.ValueBufferType),this.setInterpolation(h||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let l;if(i.toJSON!==this.toJSON)l=i.toJSON(e);else{l={name:e.name,times:cy(e.times,Array),values:cy(e.values,Array)};const h=e.getInterpolation();h!==e.DefaultInterpolation&&(l.interpolation=h)}return l.type=e.ValueTypeName,l}InterpolantFactoryMethodDiscrete(e){return new Ik(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new KI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Rk(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case kb:i=this.InterpolantFactoryMethodDiscrete;break;case cM:i=this.InterpolantFactoryMethodLinear;break;case kT:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const l="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(l);return ir("KeyframeTrack:",l),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return kb;case this.InterpolantFactoryMethodLinear:return cM;case this.InterpolantFactoryMethodSmooth:return kT}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let l=0,h=i.length;l!==h;++l)i[l]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let l=0,h=i.length;l!==h;++l)i[l]*=e}return this}trim(e,i){const l=this.times,h=l.length;let g=0,v=h-1;for(;g!==h&&l[g]<e;)++g;for(;v!==-1&&l[v]>i;)--v;if(++v,g!==0||v!==h){g>=v&&(v=Math.max(v,1),g=v-1);const r=this.getValueSize();this.times=l.slice(g,v),this.values=this.values.slice(g*r,v*r)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(ys("KeyframeTrack: Invalid value size in track.",this),e=!1);const l=this.times,h=this.values,g=l.length;g===0&&(ys("KeyframeTrack: Track is empty.",this),e=!1);let v=null;for(let r=0;r!==g;r++){const C=l[r];if(typeof C=="number"&&isNaN(C)){ys("KeyframeTrack: Time is not a valid number.",this,r,C),e=!1;break}if(v!==null&&v>C){ys("KeyframeTrack: Out of order keys.",this,r,C,v),e=!1;break}v=C}if(h!==void 0&&Ak(h))for(let r=0,C=h.length;r!==C;++r){const I=h[r];if(isNaN(I)){ys("KeyframeTrack: Value is not a valid number.",this,r,I),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),l=this.getValueSize(),h=this.getInterpolation()===kT,g=e.length-1;let v=1;for(let r=1;r<g;++r){let C=!1;const I=e[r],z=e[r+1];if(I!==z&&(r!==1||I!==e[0]))if(h)C=!0;else{const N=r*l,k=N-l,j=N+l;for(let $=0;$!==l;++$){const re=i[N+$];if(re!==i[k+$]||re!==i[j+$]){C=!0;break}}}if(C){if(r!==v){e[v]=e[r];const N=r*l,k=v*l;for(let j=0;j!==l;++j)i[k+j]=i[N+j]}++v}}if(g>0){e[v]=e[g];for(let r=g*l,C=v*l,I=0;I!==l;++I)i[C+I]=i[r+I];++v}return v!==e.length?(this.times=e.slice(0,v),this.values=i.slice(0,v*l)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),l=this.constructor,h=new l(this.name,e,i);return h.createInterpolant=this.createInterpolant,h}}Dp.prototype.ValueTypeName="";Dp.prototype.TimeBufferType=Float32Array;Dp.prototype.ValueBufferType=Float32Array;Dp.prototype.DefaultInterpolation=cM;class Cy extends Dp{constructor(e,i,l){super(e,i,l)}}Cy.prototype.ValueTypeName="bool";Cy.prototype.ValueBufferType=Array;Cy.prototype.DefaultInterpolation=kb;Cy.prototype.InterpolantFactoryMethodLinear=void 0;Cy.prototype.InterpolantFactoryMethodSmooth=void 0;class $I extends Dp{constructor(e,i,l,h){super(e,i,l,h)}}$I.prototype.ValueTypeName="color";class Kb extends Dp{constructor(e,i,l,h){super(e,i,l,h)}}Kb.prototype.ValueTypeName="number";class Dk extends _w{constructor(e,i,l,h){super(e,i,l,h)}interpolate_(e,i,l,h){const g=this.resultBuffer,v=this.sampleValues,r=this.valueSize,C=(l-i)/(h-i);let I=e*r;for(let z=I+r;I!==z;I+=4)Yf.slerpFlat(g,0,v,I-r,v,I,C);return g}}class yw extends Dp{constructor(e,i,l,h){super(e,i,l,h)}InterpolantFactoryMethodLinear(e){return new Dk(this.times,this.values,this.getValueSize(),e)}}yw.prototype.ValueTypeName="quaternion";yw.prototype.InterpolantFactoryMethodSmooth=void 0;class Ry extends Dp{constructor(e,i,l){super(e,i,l)}}Ry.prototype.ValueTypeName="string";Ry.prototype.ValueBufferType=Array;Ry.prototype.DefaultInterpolation=kb;Ry.prototype.InterpolantFactoryMethodLinear=void 0;Ry.prototype.InterpolantFactoryMethodSmooth=void 0;class $b extends Dp{constructor(e,i,l,h){super(e,i,l,h)}}$b.prototype.ValueTypeName="vector";class Jb{constructor(e="",i=-1,l=[],h=BM){this.name=e,this.tracks=l,this.duration=i,this.blendMode=h,this.uuid=Vd(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const i=[],l=e.tracks,h=1/(e.fps||1);for(let v=0,r=l.length;v!==r;++v)i.push(gQ(l[v]).scale(h));const g=new this(e.name,e.duration,i,e.blendMode);return g.uuid=e.uuid,g.userData=JSON.parse(e.userData||"{}"),g}static toJSON(e){const i=[],l=e.tracks,h={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let g=0,v=l.length;g!==v;++g)i.push(Dp.toJSON(l[g]));return h}static CreateFromMorphTargetSequence(e,i,l,h){const g=i.length,v=[];for(let r=0;r<g;r++){let C=[],I=[];C.push((r+g-1)%g,r,(r+1)%g),I.push(0,1,0);const z=Ck(C);C=gR(C,1,z),I=gR(I,1,z),!h&&C[0]===0&&(C.push(g),I.push(I[0])),v.push(new Kb(".morphTargetInfluences["+i[r].name+"]",C,I).scale(1/l))}return new this(e,-1,v)}static findByName(e,i){let l=e;if(!Array.isArray(e)){const h=e;l=h.geometry&&h.geometry.animations||h.animations}for(let h=0;h<l.length;h++)if(l[h].name===i)return l[h];return null}static CreateClipsFromMorphTargetSequences(e,i,l){const h={},g=/^([\w-]*?)([\d]+)$/;for(let r=0,C=e.length;r<C;r++){const I=e[r],z=I.name.match(g);if(z&&z.length>1){const N=z[1];let k=h[N];k||(h[N]=k=[]),k.push(I)}}const v=[];for(const r in h)v.push(this.CreateFromMorphTargetSequence(r,h[r],i,l));return v}static parseAnimation(e,i){if(ir("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return ys("AnimationClip: No animation in JSONLoader data."),null;const l=function(N,k,j,$,re){if(j.length!==0){const ie=[],Y=[];YI(j,ie,Y,$),ie.length!==0&&re.push(new N(k,ie,Y))}},h=[],g=e.name||"default",v=e.fps||30,r=e.blendMode;let C=e.length||-1;const I=e.hierarchy||[];for(let N=0;N<I.length;N++){const k=I[N].keys;if(!(!k||k.length===0))if(k[0].morphTargets){const j={};let $;for($=0;$<k.length;$++)if(k[$].morphTargets)for(let re=0;re<k[$].morphTargets.length;re++)j[k[$].morphTargets[re]]=-1;for(const re in j){const ie=[],Y=[];for(let ae=0;ae!==k[$].morphTargets.length;++ae){const ue=k[$];ie.push(ue.time),Y.push(ue.morphTarget===re?1:0)}h.push(new Kb(".morphTargetInfluence["+re+"]",ie,Y))}C=j.length*v}else{const j=".bones["+i[N].name+"]";l($b,j+".position",k,"pos",h),l(yw,j+".quaternion",k,"rot",h),l($b,j+".scale",k,"scl",h)}}return h.length===0?null:new this(g,C,h,r)}resetDuration(){const e=this.tracks;let i=0;for(let l=0,h=e.length;l!==h;++l){const g=this.tracks[l];i=Math.max(i,g.times[g.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let l=0;l<this.tracks.length;l++)e.push(this.tracks[l].clone());const i=new this.constructor(this.name,this.duration,e,this.blendMode);return i.userData=JSON.parse(JSON.stringify(this.userData)),i}toJSON(){return this.constructor.toJSON(this)}}function mQ(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Kb;case"vector":case"vector2":case"vector3":case"vector4":return $b;case"color":return $I;case"quaternion":return yw;case"bool":case"boolean":return Cy;case"string":return Ry}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function gQ(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=mQ(n.type);if(n.times===void 0){const i=[],l=[];YI(n.keys,i,l,"value"),n.times=i,n.values=l}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const lg={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class JI{constructor(e,i,l){const h=this;let g=!1,v=0,r=0,C;const I=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=l,this._abortController=null,this.itemStart=function(z){r++,g===!1&&h.onStart!==void 0&&h.onStart(z,v,r),g=!0},this.itemEnd=function(z){v++,h.onProgress!==void 0&&h.onProgress(z,v,r),v===r&&(g=!1,h.onLoad!==void 0&&h.onLoad())},this.itemError=function(z){h.onError!==void 0&&h.onError(z)},this.resolveURL=function(z){return C?C(z):z},this.setURLModifier=function(z){return C=z,this},this.addHandler=function(z,N){return I.push(z,N),this},this.removeHandler=function(z){const N=I.indexOf(z);return N!==-1&&I.splice(N,2),this},this.getHandler=function(z){for(let N=0,k=I.length;N<k;N+=2){const j=I[N],$=I[N+1];if(j.global&&(j.lastIndex=0),j.test(z))return $}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const Lk=new JI;class Kf{constructor(e){this.manager=e!==void 0?e:Lk,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const l=this;return new Promise(function(h,g){l.load(e,h,i,g)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Kf.DEFAULT_MATERIAL_NAME="__DEFAULT";const jg={};class _Q extends Error{constructor(e,i){super(e),this.response=i}}class n_ extends Kf{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,i,l,h){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const g=lg.get(`file:${e}`);if(g!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(g),this.manager.itemEnd(e)},0),g;if(jg[e]!==void 0){jg[e].push({onLoad:i,onProgress:l,onError:h});return}jg[e]=[],jg[e].push({onLoad:i,onProgress:l,onError:h});const v=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),r=this.mimeType,C=this.responseType;fetch(v).then(I=>{if(I.status===200||I.status===0){if(I.status===0&&ir("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||I.body===void 0||I.body.getReader===void 0)return I;const z=jg[e],N=I.body.getReader(),k=I.headers.get("X-File-Size")||I.headers.get("Content-Length"),j=k?parseInt(k):0,$=j!==0;let re=0;const ie=new ReadableStream({start(Y){ae();function ae(){N.read().then(({done:ue,value:me})=>{if(ue)Y.close();else{re+=me.byteLength;const Ae=new ProgressEvent("progress",{lengthComputable:$,loaded:re,total:j});for(let Se=0,ze=z.length;Se<ze;Se++){const je=z[Se];je.onProgress&&je.onProgress(Ae)}Y.enqueue(me),ae()}},ue=>{Y.error(ue)})}}});return new Response(ie)}else throw new _Q(`fetch for "${I.url}" responded with ${I.status}: ${I.statusText}`,I)}).then(I=>{switch(C){case"arraybuffer":return I.arrayBuffer();case"blob":return I.blob();case"document":return I.text().then(z=>new DOMParser().parseFromString(z,r));case"json":return I.json();default:if(r==="")return I.text();{const N=/charset="?([^;"\s]*)"?/i.exec(r),k=N&&N[1]?N[1].toLowerCase():void 0,j=new TextDecoder(k);return I.arrayBuffer().then($=>j.decode($))}}}).then(I=>{lg.add(`file:${e}`,I);const z=jg[e];delete jg[e];for(let N=0,k=z.length;N<k;N++){const j=z[N];j.onLoad&&j.onLoad(I)}}).catch(I=>{const z=jg[e];if(z===void 0)throw this.manager.itemError(e),I;delete jg[e];for(let N=0,k=z.length;N<k;N++){const j=z[N];j.onError&&j.onError(I)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class yQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=this,v=new n_(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(e,function(r){try{i(g.parse(JSON.parse(r)))}catch(C){h?h(C):ys(C),g.manager.itemError(e)}},l,h)}parse(e){const i=[];for(let l=0;l<e.length;l++){const h=Jb.parse(e[l]);i.push(h)}return i}}class xQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=this,v=[],r=new qM,C=new n_(this.manager);C.setPath(this.path),C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setWithCredentials(g.withCredentials);let I=0;function z(N){C.load(e[N],function(k){const j=g.parse(k,!0);v[N]={width:j.width,height:j.height,format:j.format,mipmaps:j.mipmaps},I+=1,I===6&&(j.mipmapCount===1&&(r.minFilter=Do),r.image=v,r.format=j.format,r.needsUpdate=!0,i&&i(r))},l,h)}if(Array.isArray(e))for(let N=0,k=e.length;N<k;++N)z(N);else C.load(e,function(N){const k=g.parse(N,!0);if(k.isCubemap){const j=k.mipmaps.length/k.mipmapCount;for(let $=0;$<j;$++){v[$]={mipmaps:[]};for(let re=0;re<k.mipmapCount;re++)v[$].mipmaps.push(k.mipmaps[$*k.mipmapCount+re]),v[$].format=k.format,v[$].width=k.width,v[$].height=k.height}r.image=v}else r.image.width=k.width,r.image.height=k.height,r.mipmaps=k.mipmaps;k.mipmapCount===1&&(r.minFilter=Do),r.format=k.format,r.needsUpdate=!0,i&&i(r)},l,h);return r}}const Cx=new WeakMap;class Qb extends Kf{constructor(e){super(e)}load(e,i,l,h){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const g=this,v=lg.get(`image:${e}`);if(v!==void 0){if(v.complete===!0)g.manager.itemStart(e),setTimeout(function(){i&&i(v),g.manager.itemEnd(e)},0);else{let N=Cx.get(v);N===void 0&&(N=[],Cx.set(v,N)),N.push({onLoad:i,onError:h})}return v}const r=jb("img");function C(){z(),i&&i(this);const N=Cx.get(this)||[];for(let k=0;k<N.length;k++){const j=N[k];j.onLoad&&j.onLoad(this)}Cx.delete(this),g.manager.itemEnd(e)}function I(N){z(),h&&h(N),lg.remove(`image:${e}`);const k=Cx.get(this)||[];for(let j=0;j<k.length;j++){const $=k[j];$.onError&&$.onError(N)}Cx.delete(this),g.manager.itemError(e),g.manager.itemEnd(e)}function z(){r.removeEventListener("load",C,!1),r.removeEventListener("error",I,!1)}return r.addEventListener("load",C,!1),r.addEventListener("error",I,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),lg.add(`image:${e}`,r),g.manager.itemStart(e),r.src=e,r}}class vQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=new fw;g.colorSpace=Io;const v=new Qb(this.manager);v.setCrossOrigin(this.crossOrigin),v.setPath(this.path);let r=0;function C(I){v.load(e[I],function(z){g.images[I]=z,r++,r===6&&(g.needsUpdate=!0,i&&i(g))},void 0,h)}for(let I=0;I<e.length;++I)C(I);return g}}class bQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=this,v=new Rm,r=new n_(this.manager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(g.withCredentials),r.load(e,function(C){let I;try{I=g.parse(C)}catch(z){if(h!==void 0)h(z);else{z(z);return}}I.image!==void 0?v.image=I.image:I.data!==void 0&&(v.image.width=I.width,v.image.height=I.height,v.image.data=I.data),v.wrapS=I.wrapS!==void 0?I.wrapS:Zf,v.wrapT=I.wrapT!==void 0?I.wrapT:Zf,v.magFilter=I.magFilter!==void 0?I.magFilter:Do,v.minFilter=I.minFilter!==void 0?I.minFilter:Do,v.anisotropy=I.anisotropy!==void 0?I.anisotropy:1,I.colorSpace!==void 0&&(v.colorSpace=I.colorSpace),I.flipY!==void 0&&(v.flipY=I.flipY),I.format!==void 0&&(v.format=I.format),I.type!==void 0&&(v.type=I.type),I.mipmaps!==void 0&&(v.mipmaps=I.mipmaps,v.minFilter=og),I.mipmapCount===1&&(v.minFilter=Do),I.generateMipmaps!==void 0&&(v.generateMipmaps=I.generateMipmaps),v.needsUpdate=!0,i&&i(v,I)},l,h),v}}class wQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=new Ho,v=new Qb(this.manager);return v.setCrossOrigin(this.crossOrigin),v.setPath(this.path),v.load(e,function(r){g.image=r,g.needsUpdate=!0,i!==void 0&&i(g)},l,h),g}}class c0 extends va{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new ar(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class Pk extends c0{constructor(e,i,l){super(e,l),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(va.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ar(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const E3=new ps,YB=new gt,KB=new gt;class QI{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $i(512,512),this.mapType=xh,this.map=null,this.mapPass=null,this.matrix=new ps,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vv,this._frameExtents=new $i(1,1),this._viewportCount=1,this._viewports=[new xa(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,l=this.matrix;YB.setFromMatrixPosition(e.matrixWorld),i.position.copy(YB),KB.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(KB),i.updateMatrixWorld(),E3.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(E3,i.coordinateSystem,i.reversedDepth),i.reversedDepth?l.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(E3)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SQ extends QI{constructor(){super(new Tc(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const i=this.camera,l=av*2*e.angle*this.focus,h=this.mapSize.width/this.mapSize.height*this.aspect,g=e.distance||i.far;(l!==i.fov||h!==i.aspect||g!==i.far)&&(i.fov=l,i.aspect=h,i.far=g,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class zk extends c0{constructor(e,i,l=0,h=Math.PI/3,g=0,v=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(va.DEFAULT_UP),this.updateMatrix(),this.target=new va,this.distance=l,this.angle=h,this.penumbra=g,this.decay=v,this.map=null,this.shadow=new SQ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const $B=new ps,k1=new gt,A3=new gt;class TQ extends QI{constructor(){super(new Tc(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new $i(4,2),this._viewportCount=6,this._viewports=[new xa(2,1,1,1),new xa(0,1,1,1),new xa(3,1,1,1),new xa(1,1,1,1),new xa(3,0,1,1),new xa(1,0,1,1)],this._cubeDirections=[new gt(1,0,0),new gt(-1,0,0),new gt(0,0,1),new gt(0,0,-1),new gt(0,1,0),new gt(0,-1,0)],this._cubeUps=[new gt(0,1,0),new gt(0,1,0),new gt(0,1,0),new gt(0,1,0),new gt(0,0,1),new gt(0,0,-1)]}updateMatrices(e,i=0){const l=this.camera,h=this.matrix,g=e.distance||l.far;g!==l.far&&(l.far=g,l.updateProjectionMatrix()),k1.setFromMatrixPosition(e.matrixWorld),l.position.copy(k1),A3.copy(l.position),A3.add(this._cubeDirections[i]),l.up.copy(this._cubeUps[i]),l.lookAt(A3),l.updateMatrixWorld(),h.makeTranslation(-k1.x,-k1.y,-k1.z),$B.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix($B,l.coordinateSystem,l.reversedDepth)}}class Ok extends c0{constructor(e,i,l=0,h=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=l,this.decay=h,this.shadow=new TQ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class wv extends UM{constructor(e=-1,i=1,l=1,h=-1,g=.1,v=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=l,this.bottom=h,this.near=g,this.far=v,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,l,h,g,v){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=l,this.view.offsetY=h,this.view.width=g,this.view.height=v,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),l=(this.right+this.left)/2,h=(this.top+this.bottom)/2;let g=l-e,v=l+e,r=h+i,C=h-i;if(this.view!==null&&this.view.enabled){const I=(this.right-this.left)/this.view.fullWidth/this.zoom,z=(this.top-this.bottom)/this.view.fullHeight/this.zoom;g+=I*this.view.offsetX,v=g+I*this.view.width,r-=z*this.view.offsetY,C=r-z*this.view.height}this.projectionMatrix.makeOrthographic(g,v,r,C,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class MQ extends QI{constructor(){super(new wv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Bk extends c0{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(va.DEFAULT_UP),this.updateMatrix(),this.target=new va,this.shadow=new MQ}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Nk extends c0{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class Fk extends c0{constructor(e,i,l=10,h=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=l,this.height=h}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class Uk{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new gt)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const l=e.x,h=e.y,g=e.z,v=this.coefficients;return i.copy(v[0]).multiplyScalar(.282095),i.addScaledVector(v[1],.488603*h),i.addScaledVector(v[2],.488603*g),i.addScaledVector(v[3],.488603*l),i.addScaledVector(v[4],1.092548*(l*h)),i.addScaledVector(v[5],1.092548*(h*g)),i.addScaledVector(v[6],.315392*(3*g*g-1)),i.addScaledVector(v[7],1.092548*(l*g)),i.addScaledVector(v[8],.546274*(l*l-h*h)),i}getIrradianceAt(e,i){const l=e.x,h=e.y,g=e.z,v=this.coefficients;return i.copy(v[0]).multiplyScalar(.886227),i.addScaledVector(v[1],2*.511664*h),i.addScaledVector(v[2],2*.511664*g),i.addScaledVector(v[3],2*.511664*l),i.addScaledVector(v[4],2*.429043*l*h),i.addScaledVector(v[5],2*.429043*h*g),i.addScaledVector(v[6],.743125*g*g-.247708),i.addScaledVector(v[7],2*.429043*l*g),i.addScaledVector(v[8],.429043*(l*l-h*h)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let l=0;l<9;l++)this.coefficients[l].addScaledVector(e.coefficients[l],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let l=0;l<9;l++)this.coefficients[l].lerp(e.coefficients[l],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const l=this.coefficients;for(let h=0;h<9;h++)l[h].fromArray(e,i+h*3);return this}toArray(e=[],i=0){const l=this.coefficients;for(let h=0;h<9;h++)l[h].toArray(e,i+h*3);return e}static getBasisAt(e,i){const l=e.x,h=e.y,g=e.z;i[0]=.282095,i[1]=.488603*h,i[2]=.488603*g,i[3]=.488603*l,i[4]=1.092548*l*h,i[5]=1.092548*h*g,i[6]=.315392*(3*g*g-1),i[7]=1.092548*l*g,i[8]=.546274*(l*l-h*h)}}class kk extends c0{constructor(e=new Uk,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class aE extends Kf{constructor(e){super(e),this.textures={}}load(e,i,l,h){const g=this,v=new n_(g.manager);v.setPath(g.path),v.setRequestHeader(g.requestHeader),v.setWithCredentials(g.withCredentials),v.load(e,function(r){try{i(g.parse(JSON.parse(r)))}catch(C){h?h(C):ys(C),g.manager.itemError(e)}},l,h)}parse(e){const i=this.textures;function l(g){return i[g]===void 0&&ir("MaterialLoader: Undefined texture",g),i[g]}const h=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(h.uuid=e.uuid),e.name!==void 0&&(h.name=e.name),e.color!==void 0&&h.color!==void 0&&h.color.setHex(e.color),e.roughness!==void 0&&(h.roughness=e.roughness),e.metalness!==void 0&&(h.metalness=e.metalness),e.sheen!==void 0&&(h.sheen=e.sheen),e.sheenColor!==void 0&&(h.sheenColor=new ar().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(h.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&h.emissive!==void 0&&h.emissive.setHex(e.emissive),e.specular!==void 0&&h.specular!==void 0&&h.specular.setHex(e.specular),e.specularIntensity!==void 0&&(h.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&h.specularColor!==void 0&&h.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(h.shininess=e.shininess),e.clearcoat!==void 0&&(h.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(h.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(h.dispersion=e.dispersion),e.iridescence!==void 0&&(h.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(h.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(h.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(h.transmission=e.transmission),e.thickness!==void 0&&(h.thickness=e.thickness),e.attenuationDistance!==void 0&&(h.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&h.attenuationColor!==void 0&&h.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(h.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(h.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(h.fog=e.fog),e.flatShading!==void 0&&(h.flatShading=e.flatShading),e.blending!==void 0&&(h.blending=e.blending),e.combine!==void 0&&(h.combine=e.combine),e.side!==void 0&&(h.side=e.side),e.shadowSide!==void 0&&(h.shadowSide=e.shadowSide),e.opacity!==void 0&&(h.opacity=e.opacity),e.transparent!==void 0&&(h.transparent=e.transparent),e.alphaTest!==void 0&&(h.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(h.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(h.depthFunc=e.depthFunc),e.depthTest!==void 0&&(h.depthTest=e.depthTest),e.depthWrite!==void 0&&(h.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(h.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(h.blendSrc=e.blendSrc),e.blendDst!==void 0&&(h.blendDst=e.blendDst),e.blendEquation!==void 0&&(h.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(h.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(h.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(h.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&h.blendColor!==void 0&&h.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(h.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(h.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(h.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(h.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(h.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(h.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(h.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(h.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(h.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(h.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(h.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(h.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(h.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(h.rotation=e.rotation),e.linewidth!==void 0&&(h.linewidth=e.linewidth),e.dashSize!==void 0&&(h.dashSize=e.dashSize),e.gapSize!==void 0&&(h.gapSize=e.gapSize),e.scale!==void 0&&(h.scale=e.scale),e.polygonOffset!==void 0&&(h.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(h.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(h.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(h.dithering=e.dithering),e.alphaToCoverage!==void 0&&(h.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(h.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(h.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(h.visible=e.visible),e.toneMapped!==void 0&&(h.toneMapped=e.toneMapped),e.userData!==void 0&&(h.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?h.vertexColors=e.vertexColors>0:h.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const g in e.uniforms){const v=e.uniforms[g];switch(h.uniforms[g]={},v.type){case"t":h.uniforms[g].value=l(v.value);break;case"c":h.uniforms[g].value=new ar().setHex(v.value);break;case"v2":h.uniforms[g].value=new $i().fromArray(v.value);break;case"v3":h.uniforms[g].value=new gt().fromArray(v.value);break;case"v4":h.uniforms[g].value=new xa().fromArray(v.value);break;case"m3":h.uniforms[g].value=new Ps().fromArray(v.value);break;case"m4":h.uniforms[g].value=new ps().fromArray(v.value);break;default:h.uniforms[g].value=v.value}}if(e.defines!==void 0&&(h.defines=e.defines),e.vertexShader!==void 0&&(h.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(h.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(h.glslVersion=e.glslVersion),e.extensions!==void 0)for(const g in e.extensions)h.extensions[g]=e.extensions[g];if(e.lights!==void 0&&(h.lights=e.lights),e.clipping!==void 0&&(h.clipping=e.clipping),e.size!==void 0&&(h.size=e.size),e.sizeAttenuation!==void 0&&(h.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(h.map=l(e.map)),e.matcap!==void 0&&(h.matcap=l(e.matcap)),e.alphaMap!==void 0&&(h.alphaMap=l(e.alphaMap)),e.bumpMap!==void 0&&(h.bumpMap=l(e.bumpMap)),e.bumpScale!==void 0&&(h.bumpScale=e.bumpScale),e.normalMap!==void 0&&(h.normalMap=l(e.normalMap)),e.normalMapType!==void 0&&(h.normalMapType=e.normalMapType),e.normalScale!==void 0){let g=e.normalScale;Array.isArray(g)===!1&&(g=[g,g]),h.normalScale=new $i().fromArray(g)}return e.displacementMap!==void 0&&(h.displacementMap=l(e.displacementMap)),e.displacementScale!==void 0&&(h.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(h.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(h.roughnessMap=l(e.roughnessMap)),e.metalnessMap!==void 0&&(h.metalnessMap=l(e.metalnessMap)),e.emissiveMap!==void 0&&(h.emissiveMap=l(e.emissiveMap)),e.emissiveIntensity!==void 0&&(h.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(h.specularMap=l(e.specularMap)),e.specularIntensityMap!==void 0&&(h.specularIntensityMap=l(e.specularIntensityMap)),e.specularColorMap!==void 0&&(h.specularColorMap=l(e.specularColorMap)),e.envMap!==void 0&&(h.envMap=l(e.envMap)),e.envMapRotation!==void 0&&h.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(h.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(h.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(h.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(h.lightMap=l(e.lightMap)),e.lightMapIntensity!==void 0&&(h.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(h.aoMap=l(e.aoMap)),e.aoMapIntensity!==void 0&&(h.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(h.gradientMap=l(e.gradientMap)),e.clearcoatMap!==void 0&&(h.clearcoatMap=l(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(h.clearcoatRoughnessMap=l(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(h.clearcoatNormalMap=l(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(h.clearcoatNormalScale=new $i().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(h.iridescenceMap=l(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(h.iridescenceThicknessMap=l(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(h.transmissionMap=l(e.transmissionMap)),e.thicknessMap!==void 0&&(h.thicknessMap=l(e.thicknessMap)),e.anisotropyMap!==void 0&&(h.anisotropyMap=l(e.anisotropyMap)),e.sheenColorMap!==void 0&&(h.sheenColorMap=l(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(h.sheenRoughnessMap=l(e.sheenRoughnessMap)),h}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return aE.createMaterialFromType(e)}static createMaterialFromType(e){const i={ShadowMaterial:xk,SpriteMaterial:OI,RawShaderMaterial:vk,ShaderMaterial:bh,PointsMaterial:NI,MeshPhysicalMaterial:bk,MeshStandardMaterial:qI,MeshPhongMaterial:wk,MeshToonMaterial:Sk,MeshNormalMaterial:XI,MeshLambertMaterial:Tk,MeshDepthMaterial:WI,MeshDistanceMaterial:ZI,MeshBasicMaterial:o0,MeshMatcapMaterial:Mk,LineDashedMaterial:Ek,LineBasicMaterial:ef,Material:tu};return new i[e]}}class _R{static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class Vk extends Is{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Gk extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=this,v=new n_(g.manager);v.setPath(g.path),v.setRequestHeader(g.requestHeader),v.setWithCredentials(g.withCredentials),v.load(e,function(r){try{i(g.parse(JSON.parse(r)))}catch(C){h?h(C):ys(C),g.manager.itemError(e)}},l,h)}parse(e){const i={},l={};function h(j,$){if(i[$]!==void 0)return i[$];const ie=j.interleavedBuffers[$],Y=g(j,ie.buffer),ae=Gx(ie.type,Y),ue=new GM(ae,ie.stride);return ue.uuid=ie.uuid,i[$]=ue,ue}function g(j,$){if(l[$]!==void 0)return l[$];const ie=j.arrayBuffers[$],Y=new Uint32Array(ie).buffer;return l[$]=Y,Y}const v=e.isInstancedBufferGeometry?new Vk:new Is,r=e.data.index;if(r!==void 0){const j=Gx(r.type,r.array);v.setIndex(new Ba(j,1))}const C=e.data.attributes;for(const j in C){const $=C[j];let re;if($.isInterleavedBufferAttribute){const ie=h(e.data,$.data);re=new Ty(ie,$.itemSize,$.offset,$.normalized)}else{const ie=Gx($.type,$.array),Y=$.isInstancedBufferAttribute?cv:Ba;re=new Y(ie,$.itemSize,$.normalized)}$.name!==void 0&&(re.name=$.name),$.usage!==void 0&&re.setUsage($.usage),v.setAttribute(j,re)}const I=e.data.morphAttributes;if(I)for(const j in I){const $=I[j],re=[];for(let ie=0,Y=$.length;ie<Y;ie++){const ae=$[ie];let ue;if(ae.isInterleavedBufferAttribute){const me=h(e.data,ae.data);ue=new Ty(me,ae.itemSize,ae.offset,ae.normalized)}else{const me=Gx(ae.type,ae.array);ue=new Ba(me,ae.itemSize,ae.normalized)}ae.name!==void 0&&(ue.name=ae.name),re.push(ue)}v.morphAttributes[j]=re}e.data.morphTargetsRelative&&(v.morphTargetsRelative=!0);const N=e.data.groups||e.data.drawcalls||e.data.offsets;if(N!==void 0)for(let j=0,$=N.length;j!==$;++j){const re=N[j];v.addGroup(re.start,re.count,re.materialIndex)}const k=e.data.boundingSphere;return k!==void 0&&(v.boundingSphere=new Ou().fromJSON(k)),e.name&&(v.name=e.name),e.userData&&(v.userData=e.userData),v}}class EQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=this,v=this.path===""?_R.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||v;const r=new n_(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(C){let I=null;try{I=JSON.parse(C)}catch(N){h!==void 0&&h(N),N("ObjectLoader: Can't parse "+e+".",N.message);return}const z=I.metadata;if(z===void 0||z.type===void 0||z.type.toLowerCase()==="geometry"){h!==void 0&&h(new Error("THREE.ObjectLoader: Can't load "+e)),ys("ObjectLoader: Can't load "+e);return}g.parse(I,i)},l,h)}async loadAsync(e,i){const l=this,h=this.path===""?_R.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||h;const g=new n_(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials);const v=await g.loadAsync(e,i),r=JSON.parse(v),C=r.metadata;if(C===void 0||C.type===void 0||C.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await l.parseAsync(r)}parse(e,i){const l=this.parseAnimations(e.animations),h=this.parseShapes(e.shapes),g=this.parseGeometries(e.geometries,h),v=this.parseImages(e.images,function(){i!==void 0&&i(I)}),r=this.parseTextures(e.textures,v),C=this.parseMaterials(e.materials,r),I=this.parseObject(e.object,g,C,r,l),z=this.parseSkeletons(e.skeletons,I);if(this.bindSkeletons(I,z),this.bindLightTargets(I),i!==void 0){let N=!1;for(const k in v)if(v[k].data instanceof HTMLImageElement){N=!0;break}N===!1&&i(I)}return I}async parseAsync(e){const i=this.parseAnimations(e.animations),l=this.parseShapes(e.shapes),h=this.parseGeometries(e.geometries,l),g=await this.parseImagesAsync(e.images),v=this.parseTextures(e.textures,g),r=this.parseMaterials(e.materials,v),C=this.parseObject(e.object,h,r,v,i),I=this.parseSkeletons(e.skeletons,C);return this.bindSkeletons(C,I),this.bindLightTargets(C),C}parseShapes(e){const i={};if(e!==void 0)for(let l=0,h=e.length;l<h;l++){const g=new my().fromJSON(e[l]);i[g.uuid]=g}return i}parseSkeletons(e,i){const l={},h={};if(i.traverse(function(g){g.isBone&&(h[g.uuid]=g)}),e!==void 0)for(let g=0,v=e.length;g<v;g++){const r=new HM().fromJSON(e[g],h);l[r.uuid]=r}return l}parseGeometries(e,i){const l={};if(e!==void 0){const h=new Gk;for(let g=0,v=e.length;g<v;g++){let r;const C=e[g];switch(C.type){case"BufferGeometry":case"InstancedBufferGeometry":r=h.parse(C);break;default:C.type in ZB?r=ZB[C.type].fromJSON(C,i):ir(`ObjectLoader: Unsupported geometry type "${C.type}"`)}r.uuid=C.uuid,C.name!==void 0&&(r.name=C.name),C.userData!==void 0&&(r.userData=C.userData),l[C.uuid]=r}}return l}parseMaterials(e,i){const l={},h={};if(e!==void 0){const g=new aE;g.setTextures(i);for(let v=0,r=e.length;v<r;v++){const C=e[v];l[C.uuid]===void 0&&(l[C.uuid]=g.parse(C)),h[C.uuid]=l[C.uuid]}}return h}parseAnimations(e){const i={};if(e!==void 0)for(let l=0;l<e.length;l++){const h=e[l],g=Jb.parse(h);i[g.uuid]=g}return i}parseImages(e,i){const l=this,h={};let g;function v(C){return l.manager.itemStart(C),g.load(C,function(){l.manager.itemEnd(C)},void 0,function(){l.manager.itemError(C),l.manager.itemEnd(C)})}function r(C){if(typeof C=="string"){const I=C,z=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(I)?I:l.resourcePath+I;return v(z)}else return C.data?{data:Gx(C.type,C.data),width:C.width,height:C.height}:null}if(e!==void 0&&e.length>0){const C=new JI(i);g=new Qb(C),g.setCrossOrigin(this.crossOrigin);for(let I=0,z=e.length;I<z;I++){const N=e[I],k=N.url;if(Array.isArray(k)){const j=[];for(let $=0,re=k.length;$<re;$++){const ie=k[$],Y=r(ie);Y!==null&&(Y instanceof HTMLImageElement?j.push(Y):j.push(new Rm(Y.data,Y.width,Y.height)))}h[N.uuid]=new K_(j)}else{const j=r(N.url);h[N.uuid]=new K_(j)}}}return h}async parseImagesAsync(e){const i=this,l={};let h;async function g(v){if(typeof v=="string"){const r=v,C=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:i.resourcePath+r;return await h.loadAsync(C)}else return v.data?{data:Gx(v.type,v.data),width:v.width,height:v.height}:null}if(e!==void 0&&e.length>0){h=new Qb(this.manager),h.setCrossOrigin(this.crossOrigin);for(let v=0,r=e.length;v<r;v++){const C=e[v],I=C.url;if(Array.isArray(I)){const z=[];for(let N=0,k=I.length;N<k;N++){const j=I[N],$=await g(j);$!==null&&($ instanceof HTMLImageElement?z.push($):z.push(new Rm($.data,$.width,$.height)))}l[C.uuid]=new K_(z)}else{const z=await g(C.url);l[C.uuid]=new K_(z)}}}return l}parseTextures(e,i){function l(g,v){return typeof g=="number"?g:(ir("ObjectLoader.parseTexture: Constant should be in numeric form.",g),v[g])}const h={};if(e!==void 0)for(let g=0,v=e.length;g<v;g++){const r=e[g];r.image===void 0&&ir('ObjectLoader: No "image" specified for',r.uuid),i[r.image]===void 0&&ir("ObjectLoader: Undefined image",r.image);const C=i[r.image],I=C.data;let z;Array.isArray(I)?(z=new fw,I.length===6&&(z.needsUpdate=!0)):(I&&I.data?z=new Rm:z=new Ho,I&&(z.needsUpdate=!0)),z.source=C,z.uuid=r.uuid,r.name!==void 0&&(z.name=r.name),r.mapping!==void 0&&(z.mapping=l(r.mapping,AQ)),r.channel!==void 0&&(z.channel=r.channel),r.offset!==void 0&&z.offset.fromArray(r.offset),r.repeat!==void 0&&z.repeat.fromArray(r.repeat),r.center!==void 0&&z.center.fromArray(r.center),r.rotation!==void 0&&(z.rotation=r.rotation),r.wrap!==void 0&&(z.wrapS=l(r.wrap[0],JB),z.wrapT=l(r.wrap[1],JB)),r.format!==void 0&&(z.format=r.format),r.internalFormat!==void 0&&(z.internalFormat=r.internalFormat),r.type!==void 0&&(z.type=r.type),r.colorSpace!==void 0&&(z.colorSpace=r.colorSpace),r.minFilter!==void 0&&(z.minFilter=l(r.minFilter,QB)),r.magFilter!==void 0&&(z.magFilter=l(r.magFilter,QB)),r.anisotropy!==void 0&&(z.anisotropy=r.anisotropy),r.flipY!==void 0&&(z.flipY=r.flipY),r.generateMipmaps!==void 0&&(z.generateMipmaps=r.generateMipmaps),r.premultiplyAlpha!==void 0&&(z.premultiplyAlpha=r.premultiplyAlpha),r.unpackAlignment!==void 0&&(z.unpackAlignment=r.unpackAlignment),r.compareFunction!==void 0&&(z.compareFunction=r.compareFunction),r.userData!==void 0&&(z.userData=r.userData),h[r.uuid]=z}return h}parseObject(e,i,l,h,g){let v;function r(k){return i[k]===void 0&&ir("ObjectLoader: Undefined geometry",k),i[k]}function C(k){if(k!==void 0){if(Array.isArray(k)){const j=[];for(let $=0,re=k.length;$<re;$++){const ie=k[$];l[ie]===void 0&&ir("ObjectLoader: Undefined material",ie),j.push(l[ie])}return j}return l[k]===void 0&&ir("ObjectLoader: Undefined material",k),l[k]}}function I(k){return h[k]===void 0&&ir("ObjectLoader: Undefined texture",k),h[k]}let z,N;switch(e.type){case"Scene":v=new Xb,e.background!==void 0&&(Number.isInteger(e.background)?v.background=new ar(e.background):v.background=I(e.background)),e.environment!==void 0&&(v.environment=I(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?v.fog=new VM(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(v.fog=new kM(e.fog.color,e.fog.density)),e.fog.name!==""&&(v.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(v.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(v.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&v.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(v.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&v.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":v=new Tc(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(v.focus=e.focus),e.zoom!==void 0&&(v.zoom=e.zoom),e.filmGauge!==void 0&&(v.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(v.filmOffset=e.filmOffset),e.view!==void 0&&(v.view=Object.assign({},e.view));break;case"OrthographicCamera":v=new wv(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(v.zoom=e.zoom),e.view!==void 0&&(v.view=Object.assign({},e.view));break;case"AmbientLight":v=new Nk(e.color,e.intensity);break;case"DirectionalLight":v=new Bk(e.color,e.intensity),v.target=e.target||"";break;case"PointLight":v=new Ok(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":v=new Fk(e.color,e.intensity,e.width,e.height);break;case"SpotLight":v=new zk(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),v.target=e.target||"";break;case"HemisphereLight":v=new Pk(e.color,e.groundColor,e.intensity);break;case"LightProbe":v=new kk().fromJSON(e);break;case"SkinnedMesh":z=r(e.geometry),N=C(e.material),v=new ik(z,N),e.bindMode!==void 0&&(v.bindMode=e.bindMode),e.bindMatrix!==void 0&&v.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(v.skeleton=e.skeleton);break;case"Mesh":z=r(e.geometry),N=C(e.material),v=new sc(z,N);break;case"InstancedMesh":z=r(e.geometry),N=C(e.material);const k=e.count,j=e.instanceMatrix,$=e.instanceColor;v=new nk(z,N,k),v.instanceMatrix=new cv(new Float32Array(j.array),16),$!==void 0&&(v.instanceColor=new cv(new Float32Array($.array),$.itemSize));break;case"BatchedMesh":z=r(e.geometry),N=C(e.material),v=new rk(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,N),v.geometry=z,v.perObjectFrustumCulled=e.perObjectFrustumCulled,v.sortObjects=e.sortObjects,v._drawRanges=e.drawRanges,v._reservedRanges=e.reservedRanges,v._geometryInfo=e.geometryInfo.map(re=>{let ie=null,Y=null;return re.boundingBox!==void 0&&(ie=new yh().fromJSON(re.boundingBox)),re.boundingSphere!==void 0&&(Y=new Ou().fromJSON(re.boundingSphere)),{...re,boundingBox:ie,boundingSphere:Y}}),v._instanceInfo=e.instanceInfo,v._availableInstanceIds=e._availableInstanceIds,v._availableGeometryIds=e._availableGeometryIds,v._nextIndexStart=e.nextIndexStart,v._nextVertexStart=e.nextVertexStart,v._geometryCount=e.geometryCount,v._maxInstanceCount=e.maxInstanceCount,v._maxVertexCount=e.maxVertexCount,v._maxIndexCount=e.maxIndexCount,v._geometryInitialized=e.geometryInitialized,v._matricesTexture=I(e.matricesTexture.uuid),v._indirectTexture=I(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(v._colorsTexture=I(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(v.boundingSphere=new Ou().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(v.boundingBox=new yh().fromJSON(e.boundingBox));break;case"LOD":v=new tk;break;case"Line":v=new i0(r(e.geometry),C(e.material));break;case"LineLoop":v=new sk(r(e.geometry),C(e.material));break;case"LineSegments":v=new gg(r(e.geometry),C(e.material));break;case"PointCloud":case"Points":v=new ak(r(e.geometry),C(e.material));break;case"Sprite":v=new ek(C(e.material));break;case"Group":v=new Hx;break;case"Bone":v=new BI;break;default:v=new va}if(v.uuid=e.uuid,e.name!==void 0&&(v.name=e.name),e.matrix!==void 0?(v.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(v.matrixAutoUpdate=e.matrixAutoUpdate),v.matrixAutoUpdate&&v.matrix.decompose(v.position,v.quaternion,v.scale)):(e.position!==void 0&&v.position.fromArray(e.position),e.rotation!==void 0&&v.rotation.fromArray(e.rotation),e.quaternion!==void 0&&v.quaternion.fromArray(e.quaternion),e.scale!==void 0&&v.scale.fromArray(e.scale)),e.up!==void 0&&v.up.fromArray(e.up),e.castShadow!==void 0&&(v.castShadow=e.castShadow),e.receiveShadow!==void 0&&(v.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(v.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(v.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(v.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(v.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&v.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(v.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(v.visible=e.visible),e.frustumCulled!==void 0&&(v.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(v.renderOrder=e.renderOrder),e.userData!==void 0&&(v.userData=e.userData),e.layers!==void 0&&(v.layers.mask=e.layers),e.children!==void 0){const k=e.children;for(let j=0;j<k.length;j++)v.add(this.parseObject(k[j],i,l,h,g))}if(e.animations!==void 0){const k=e.animations;for(let j=0;j<k.length;j++){const $=k[j];v.animations.push(g[$])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(v.autoUpdate=e.autoUpdate);const k=e.levels;for(let j=0;j<k.length;j++){const $=k[j],re=v.getObjectByProperty("uuid",$.object);re!==void 0&&v.addLevel(re,$.distance,$.hysteresis)}}return v}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(l){if(l.isSkinnedMesh===!0&&l.skeleton!==void 0){const h=i[l.skeleton];h===void 0?ir("ObjectLoader: No skeleton found with UUID:",l.skeleton):l.bind(h,l.bindMatrix)}})}bindLightTargets(e){e.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const l=i.target,h=e.getObjectByProperty("uuid",l);h!==void 0?i.target=h:i.target=new va}})}}const AQ={UVMapping:CM,CubeReflectionMapping:i_,CubeRefractionMapping:e0,EquirectangularReflectionMapping:Bb,EquirectangularRefractionMapping:Nb,CubeUVReflectionMapping:yv},JB={RepeatWrapping:Fb,ClampToEdgeWrapping:Zf,MirroredRepeatWrapping:Ub},QB={NearestFilter:Fl,NearestMipmapNearestFilter:wI,NearestMipmapLinearFilter:Vx,LinearFilter:Do,LinearMipmapNearestFilter:fb,LinearMipmapLinearFilter:og},C3=new WeakMap;class CQ extends Kf{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&ir("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&ir("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,i,l,h){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const g=this,v=lg.get(`image-bitmap:${e}`);if(v!==void 0){if(g.manager.itemStart(e),v.then){v.then(I=>{if(C3.has(v)===!0)h&&h(C3.get(v)),g.manager.itemError(e),g.manager.itemEnd(e);else return i&&i(I),g.manager.itemEnd(e),I});return}return setTimeout(function(){i&&i(v),g.manager.itemEnd(e)},0),v}const r={};r.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",r.headers=this.requestHeader,r.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const C=fetch(e,r).then(function(I){return I.blob()}).then(function(I){return createImageBitmap(I,Object.assign(g.options,{colorSpaceConversion:"none"}))}).then(function(I){return lg.add(`image-bitmap:${e}`,I),i&&i(I),g.manager.itemEnd(e),I}).catch(function(I){h&&h(I),C3.set(C,I),lg.remove(`image-bitmap:${e}`),g.manager.itemError(e),g.manager.itemEnd(e)});lg.add(`image-bitmap:${e}`,C),g.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let _T;class eD{static getContext(){return _T===void 0&&(_T=new(window.AudioContext||window.webkitAudioContext)),_T}static setContext(e){_T=e}}class RQ extends Kf{constructor(e){super(e)}load(e,i,l,h){const g=this,v=new n_(this.manager);v.setResponseType("arraybuffer"),v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(e,function(C){try{const I=C.slice(0);eD.getContext().decodeAudioData(I,function(N){i(N)}).catch(r)}catch(I){r(I)}},l,h);function r(C){h?h(C):ys(C),g.manager.itemError(e)}}}const eN=new ps,tN=new ps,q0=new ps;class IQ{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Tc,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Tc,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,q0.copy(e.projectionMatrix);const h=i.eyeSep/2,g=h*i.near/i.focus,v=i.near*Math.tan(py*i.fov*.5)/i.zoom;let r,C;tN.elements[12]=-h,eN.elements[12]=h,r=-v*i.aspect+g,C=v*i.aspect+g,q0.elements[0]=2*i.near/(C-r),q0.elements[8]=(C+r)/(C-r),this.cameraL.projectionMatrix.copy(q0),r=-v*i.aspect-g,C=v*i.aspect-g,q0.elements[0]=2*i.near/(C-r),q0.elements[8]=(C+r)/(C-r),this.cameraR.projectionMatrix.copy(q0)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(tN),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(eN)}}class Hk extends Tc{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class tD{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=performance.now();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}const X0=new gt,R3=new Yf,DQ=new gt,W0=new gt,Z0=new gt;class LQ extends va{constructor(){super(),this.type="AudioListener",this.context=eD.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new tD}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const i=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(X0,R3,DQ),W0.set(0,0,-1).applyQuaternion(R3),Z0.set(0,1,0).applyQuaternion(R3),i.positionX){const l=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(X0.x,l),i.positionY.linearRampToValueAtTime(X0.y,l),i.positionZ.linearRampToValueAtTime(X0.z,l),i.forwardX.linearRampToValueAtTime(W0.x,l),i.forwardY.linearRampToValueAtTime(W0.y,l),i.forwardZ.linearRampToValueAtTime(W0.z,l),i.upX.linearRampToValueAtTime(Z0.x,l),i.upY.linearRampToValueAtTime(Z0.y,l),i.upZ.linearRampToValueAtTime(Z0.z,l)}else i.setPosition(X0.x,X0.y,X0.z),i.setOrientation(W0.x,W0.y,W0.z,Z0.x,Z0.y,Z0.z)}}class jk extends va{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){ir("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){ir("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){ir("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){ir("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){ir("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(ir("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){ir("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,i){return super.copy(e,i),e.sourceType!=="buffer"?(ir("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Y0=new gt,iN=new Yf,PQ=new gt,K0=new gt;class zQ extends jk{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,l){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=l,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Y0,iN,PQ),K0.set(0,0,1).applyQuaternion(iN);const i=this.panner;if(i.positionX){const l=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Y0.x,l),i.positionY.linearRampToValueAtTime(Y0.y,l),i.positionZ.linearRampToValueAtTime(Y0.z,l),i.orientationX.linearRampToValueAtTime(K0.x,l),i.orientationY.linearRampToValueAtTime(K0.y,l),i.orientationZ.linearRampToValueAtTime(K0.z,l)}else i.setPosition(Y0.x,Y0.y,Y0.z),i.setOrientation(K0.x,K0.y,K0.z)}}class OQ{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let l=0;l<i.length;l++)e+=i[l];return e/i.length}}class qk{constructor(e,i,l){this.binding=e,this.valueSize=l;let h,g,v;switch(i){case"quaternion":h=this._slerp,g=this._slerpAdditive,v=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(l*6),this._workIndex=5;break;case"string":case"bool":h=this._select,g=this._select,v=this._setAdditiveIdentityOther,this.buffer=new Array(l*5);break;default:h=this._lerp,g=this._lerpAdditive,v=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(l*5)}this._mixBufferRegion=h,this._mixBufferRegionAdditive=g,this._setIdentity=v,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const l=this.buffer,h=this.valueSize,g=e*h+h;let v=this.cumulativeWeight;if(v===0){for(let r=0;r!==h;++r)l[g+r]=l[r];v=i}else{v+=i;const r=i/v;this._mixBufferRegion(l,g,0,r,h)}this.cumulativeWeight=v}accumulateAdditive(e){const i=this.buffer,l=this.valueSize,h=l*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,h,0,e,l),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,l=this.buffer,h=e*i+i,g=this.cumulativeWeight,v=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,g<1){const C=i*this._origIndex;this._mixBufferRegion(l,h,C,1-g,i)}v>0&&this._mixBufferRegionAdditive(l,h,this._addIndex*i,1,i);for(let C=i,I=i+i;C!==I;++C)if(l[C]!==l[C+i]){r.setValue(l,h);break}}saveOriginalState(){const e=this.binding,i=this.buffer,l=this.valueSize,h=l*this._origIndex;e.getValue(i,h);for(let g=l,v=h;g!==v;++g)i[g]=i[h+g%l];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let l=e;l<i;l++)this.buffer[l]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let l=0;l<this.valueSize;l++)this.buffer[i+l]=this.buffer[e+l]}_select(e,i,l,h,g){if(h>=.5)for(let v=0;v!==g;++v)e[i+v]=e[l+v]}_slerp(e,i,l,h){Yf.slerpFlat(e,i,e,i,e,l,h)}_slerpAdditive(e,i,l,h,g){const v=this._workIndex*g;Yf.multiplyQuaternionsFlat(e,v,e,i,e,l),Yf.slerpFlat(e,i,e,i,e,v,h)}_lerp(e,i,l,h,g){const v=1-h;for(let r=0;r!==g;++r){const C=i+r;e[C]=e[C]*v+e[l+r]*h}}_lerpAdditive(e,i,l,h,g){for(let v=0;v!==g;++v){const r=i+v;e[r]=e[r]+e[l+v]*h}}}const iD="\\[\\]\\.:\\/",BQ=new RegExp("["+iD+"]","g"),nD="[^"+iD+"]",NQ="[^"+iD.replace("\\.","")+"]",FQ=/((?:WC+[\/:])*)/.source.replace("WC",nD),UQ=/(WCOD+)?/.source.replace("WCOD",NQ),kQ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",nD),VQ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",nD),GQ=new RegExp("^"+FQ+UQ+kQ+VQ+"$"),HQ=["material","materials","bones","map"];class jQ{constructor(e,i,l){const h=l||ya.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,h)}getValue(e,i){this.bind();const l=this._targetGroup.nCachedObjects_,h=this._bindings[l];h!==void 0&&h.getValue(e,i)}setValue(e,i){const l=this._bindings;for(let h=this._targetGroup.nCachedObjects_,g=l.length;h!==g;++h)l[h].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,l=e.length;i!==l;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,l=e.length;i!==l;++i)e[i].unbind()}}class ya{constructor(e,i,l){this.path=i,this.parsedPath=l||ya.parseTrackName(i),this.node=ya.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,l){return e&&e.isAnimationObjectGroup?new ya.Composite(e,i,l):new ya(e,i,l)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(BQ,"")}static parseTrackName(e){const i=GQ.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const l={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},h=l.nodeName&&l.nodeName.lastIndexOf(".");if(h!==void 0&&h!==-1){const g=l.nodeName.substring(h+1);HQ.indexOf(g)!==-1&&(l.nodeName=l.nodeName.substring(0,h),l.objectName=g)}if(l.propertyName===null||l.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return l}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const l=e.skeleton.getBoneByName(i);if(l!==void 0)return l}if(e.children){const l=function(g){for(let v=0;v<g.length;v++){const r=g[v];if(r.name===i||r.uuid===i)return r;const C=l(r.children);if(C)return C}return null},h=l(e.children);if(h)return h}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const l=this.resolvedProperty;for(let h=0,g=l.length;h!==g;++h)e[i++]=l[h]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const l=this.resolvedProperty;for(let h=0,g=l.length;h!==g;++h)l[h]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const l=this.resolvedProperty;for(let h=0,g=l.length;h!==g;++h)l[h]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const l=this.resolvedProperty;for(let h=0,g=l.length;h!==g;++h)l[h]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,l=i.objectName,h=i.propertyName;let g=i.propertyIndex;if(e||(e=ya.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){ir("PropertyBinding: No target node found for track: "+this.path+".");return}if(l){let I=i.objectIndex;switch(l){case"materials":if(!e.material){ys("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){ys("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){ys("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let z=0;z<e.length;z++)if(e[z].name===I){I=z;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){ys("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){ys("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[l]===void 0){ys("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[l]}if(I!==void 0){if(e[I]===void 0){ys("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[I]}}const v=e[h];if(v===void 0){const I=i.nodeName;ys("PropertyBinding: Trying to update property for track: "+I+"."+h+" but it wasn't found.",e);return}let r=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?r=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(r=this.Versioning.MatrixWorldNeedsUpdate);let C=this.BindingType.Direct;if(g!==void 0){if(h==="morphTargetInfluences"){if(!e.geometry){ys("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){ys("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[g]!==void 0&&(g=e.morphTargetDictionary[g])}C=this.BindingType.ArrayElement,this.resolvedProperty=v,this.propertyIndex=g}else v.fromArray!==void 0&&v.toArray!==void 0?(C=this.BindingType.HasFromToArray,this.resolvedProperty=v):Array.isArray(v)?(C=this.BindingType.EntireArray,this.resolvedProperty=v):this.propertyName=h;this.getValue=this.GetterByBindingType[C],this.setValue=this.SetterByBindingTypeAndVersioning[C][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ya.Composite=jQ;ya.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ya.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ya.prototype.GetterByBindingType=[ya.prototype._getValue_direct,ya.prototype._getValue_array,ya.prototype._getValue_arrayElement,ya.prototype._getValue_toArray];ya.prototype.SetterByBindingTypeAndVersioning=[[ya.prototype._setValue_direct,ya.prototype._setValue_direct_setNeedsUpdate,ya.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ya.prototype._setValue_array,ya.prototype._setValue_array_setNeedsUpdate,ya.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ya.prototype._setValue_arrayElement,ya.prototype._setValue_arrayElement_setNeedsUpdate,ya.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ya.prototype._setValue_fromArray,ya.prototype._setValue_fromArray_setNeedsUpdate,ya.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class qQ{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Vd(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let l=0,h=arguments.length;l!==h;++l)e[arguments[l].uuid]=l;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,l=this._paths,h=this._parsedPaths,g=this._bindings,v=g.length;let r,C=e.length,I=this.nCachedObjects_;for(let z=0,N=arguments.length;z!==N;++z){const k=arguments[z],j=k.uuid;let $=i[j];if($===void 0){$=C++,i[j]=$,e.push(k);for(let re=0,ie=v;re!==ie;++re)g[re].push(new ya(k,l[re],h[re]))}else if($<I){r=e[$];const re=--I,ie=e[re];i[ie.uuid]=$,e[$]=ie,i[j]=re,e[re]=k;for(let Y=0,ae=v;Y!==ae;++Y){const ue=g[Y],me=ue[re];let Ae=ue[$];ue[$]=me,Ae===void 0&&(Ae=new ya(k,l[Y],h[Y])),ue[re]=Ae}}else e[$]!==r&&ys("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=I}remove(){const e=this._objects,i=this._indicesByUUID,l=this._bindings,h=l.length;let g=this.nCachedObjects_;for(let v=0,r=arguments.length;v!==r;++v){const C=arguments[v],I=C.uuid,z=i[I];if(z!==void 0&&z>=g){const N=g++,k=e[N];i[k.uuid]=z,e[z]=k,i[I]=N,e[N]=C;for(let j=0,$=h;j!==$;++j){const re=l[j],ie=re[N],Y=re[z];re[z]=ie,re[N]=Y}}}this.nCachedObjects_=g}uncache(){const e=this._objects,i=this._indicesByUUID,l=this._bindings,h=l.length;let g=this.nCachedObjects_,v=e.length;for(let r=0,C=arguments.length;r!==C;++r){const I=arguments[r],z=I.uuid,N=i[z];if(N!==void 0)if(delete i[z],N<g){const k=--g,j=e[k],$=--v,re=e[$];i[j.uuid]=N,e[N]=j,i[re.uuid]=k,e[k]=re,e.pop();for(let ie=0,Y=h;ie!==Y;++ie){const ae=l[ie],ue=ae[k],me=ae[$];ae[N]=ue,ae[k]=me,ae.pop()}}else{const k=--v,j=e[k];k>0&&(i[j.uuid]=N),e[N]=j,e.pop();for(let $=0,re=h;$!==re;++$){const ie=l[$];ie[N]=ie[k],ie.pop()}}}this.nCachedObjects_=g}subscribe_(e,i){const l=this._bindingsIndicesByPath;let h=l[e];const g=this._bindings;if(h!==void 0)return g[h];const v=this._paths,r=this._parsedPaths,C=this._objects,I=C.length,z=this.nCachedObjects_,N=new Array(I);h=g.length,l[e]=h,v.push(e),r.push(i),g.push(N);for(let k=z,j=C.length;k!==j;++k){const $=C[k];N[k]=new ya($,e,i)}return N}unsubscribe_(e){const i=this._bindingsIndicesByPath,l=i[e];if(l!==void 0){const h=this._paths,g=this._parsedPaths,v=this._bindings,r=v.length-1,C=v[r],I=e[r];i[I]=l,v[l]=C,v.pop(),g[l]=g[r],g.pop(),h[l]=h[r],h.pop()}}}class Xk{constructor(e,i,l=null,h=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=l,this.blendMode=h;const g=i.tracks,v=g.length,r=new Array(v),C={endingStart:oy,endingEnd:oy};for(let I=0;I!==v;++I){const z=g[I].createInterpolant(null);r[I]=z,z.settings=C}this._interpolantSettings=C,this._interpolants=r,this._propertyBindings=new Array(v),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=z5,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,l=!1){if(e.fadeOut(i),this.fadeIn(i),l===!0){const h=this._clip.duration,g=e._clip.duration,v=g/h,r=h/g;e.warp(1,v,i),this.warp(r,1,i)}return this}crossFadeTo(e,i,l=!1){return e.crossFadeFrom(this,i,l)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,l){const h=this._mixer,g=h.time,v=this.timeScale;let r=this._timeScaleInterpolant;r===null&&(r=h._lendControlInterpolant(),this._timeScaleInterpolant=r);const C=r.parameterPositions,I=r.sampleValues;return C[0]=g,C[1]=g+l,I[0]=e/v,I[1]=i/v,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,l,h){if(!this.enabled){this._updateWeight(e);return}const g=this._startTime;if(g!==null){const C=(e-g)*l;C<0||l===0?i=0:(this._startTime=null,i=l*C)}i*=this._updateTimeScale(e);const v=this._updateTime(i),r=this._updateWeight(e);if(r>0){const C=this._interpolants,I=this._propertyBindings;switch(this.blendMode){case RI:for(let z=0,N=C.length;z!==N;++z)C[z].evaluate(v),I[z].accumulateAdditive(r);break;case BM:default:for(let z=0,N=C.length;z!==N;++z)C[z].evaluate(v),I[z].accumulate(h,r)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const l=this._weightInterpolant;if(l!==null){const h=l.evaluate(e)[0];i*=h,e>l.parameterPositions[1]&&(this.stopFading(),h===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const l=this._timeScaleInterpolant;if(l!==null){const h=l.evaluate(e)[0];i*=h,e>l.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,l=this.loop;let h=this.time+e,g=this._loopCount;const v=l===O5;if(e===0)return g===-1?h:v&&(g&1)===1?i-h:h;if(l===P5){g===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(h>=i)h=i;else if(h<0)h=0;else{this.time=h;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(g===-1&&(e>=0?(g=0,this._setEndings(!0,this.repetitions===0,v)):this._setEndings(this.repetitions===0,!0,v)),h>=i||h<0){const r=Math.floor(h/i);h-=i*r,g+=Math.abs(r);const C=this.repetitions-g;if(C<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,h=e>0?i:0,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(C===1){const I=e<0;this._setEndings(I,!I,v)}else this._setEndings(!1,!1,v);this._loopCount=g,this.time=h,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=h;if(v&&(g&1)===1)return i-h}return h}_setEndings(e,i,l){const h=this._interpolantSettings;l?(h.endingStart=ly,h.endingEnd=ly):(e?h.endingStart=this.zeroSlopeAtStart?ly:oy:h.endingStart=Vb,i?h.endingEnd=this.zeroSlopeAtEnd?ly:oy:h.endingEnd=Vb)}_scheduleFading(e,i,l){const h=this._mixer,g=h.time;let v=this._weightInterpolant;v===null&&(v=h._lendControlInterpolant(),this._weightInterpolant=v);const r=v.parameterPositions,C=v.sampleValues;return r[0]=g,C[0]=i,r[1]=g+e,C[1]=l,this}}const XQ=new Float32Array(1);class WQ extends jd{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const l=e._localRoot||this._root,h=e._clip.tracks,g=h.length,v=e._propertyBindings,r=e._interpolants,C=l.uuid,I=this._bindingsByRootAndName;let z=I[C];z===void 0&&(z={},I[C]=z);for(let N=0;N!==g;++N){const k=h[N],j=k.name;let $=z[j];if($!==void 0)++$.referenceCount,v[N]=$;else{if($=v[N],$!==void 0){$._cacheIndex===null&&(++$.referenceCount,this._addInactiveBinding($,C,j));continue}const re=i&&i._propertyBindings[N].binding.parsedPath;$=new qk(ya.create(l,j,re),k.ValueTypeName,k.getValueSize()),++$.referenceCount,this._addInactiveBinding($,C,j),v[N]=$}r[N].resultBuffer=$.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const l=(e._localRoot||this._root).uuid,h=e._clip.uuid,g=this._actionsByClip[h];this._bindAction(e,g&&g.knownActions[0]),this._addInactiveAction(e,h,l)}const i=e._propertyBindings;for(let l=0,h=i.length;l!==h;++l){const g=i[l];g.useCount++===0&&(this._lendBinding(g),g.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let l=0,h=i.length;l!==h;++l){const g=i[l];--g.useCount===0&&(g.restoreOriginalState(),this._takeBackBinding(g))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,l){const h=this._actions,g=this._actionsByClip;let v=g[i];if(v===void 0)v={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,g[i]=v;else{const r=v.knownActions;e._byClipCacheIndex=r.length,r.push(e)}e._cacheIndex=h.length,h.push(e),v.actionByRoot[l]=e}_removeInactiveAction(e){const i=this._actions,l=i[i.length-1],h=e._cacheIndex;l._cacheIndex=h,i[h]=l,i.pop(),e._cacheIndex=null;const g=e._clip.uuid,v=this._actionsByClip,r=v[g],C=r.knownActions,I=C[C.length-1],z=e._byClipCacheIndex;I._byClipCacheIndex=z,C[z]=I,C.pop(),e._byClipCacheIndex=null;const N=r.actionByRoot,k=(e._localRoot||this._root).uuid;delete N[k],C.length===0&&delete v[g],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let l=0,h=i.length;l!==h;++l){const g=i[l];--g.referenceCount===0&&this._removeInactiveBinding(g)}}_lendAction(e){const i=this._actions,l=e._cacheIndex,h=this._nActiveActions++,g=i[h];e._cacheIndex=h,i[h]=e,g._cacheIndex=l,i[l]=g}_takeBackAction(e){const i=this._actions,l=e._cacheIndex,h=--this._nActiveActions,g=i[h];e._cacheIndex=h,i[h]=e,g._cacheIndex=l,i[l]=g}_addInactiveBinding(e,i,l){const h=this._bindingsByRootAndName,g=this._bindings;let v=h[i];v===void 0&&(v={},h[i]=v),v[l]=e,e._cacheIndex=g.length,g.push(e)}_removeInactiveBinding(e){const i=this._bindings,l=e.binding,h=l.rootNode.uuid,g=l.path,v=this._bindingsByRootAndName,r=v[h],C=i[i.length-1],I=e._cacheIndex;C._cacheIndex=I,i[I]=C,i.pop(),delete r[g],Object.keys(r).length===0&&delete v[h]}_lendBinding(e){const i=this._bindings,l=e._cacheIndex,h=this._nActiveBindings++,g=i[h];e._cacheIndex=h,i[h]=e,g._cacheIndex=l,i[l]=g}_takeBackBinding(e){const i=this._bindings,l=e._cacheIndex,h=--this._nActiveBindings,g=i[h];e._cacheIndex=h,i[h]=e,g._cacheIndex=l,i[l]=g}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let l=e[i];return l===void 0&&(l=new KI(new Float32Array(2),new Float32Array(2),1,XQ),l.__cacheIndex=i,e[i]=l),l}_takeBackControlInterpolant(e){const i=this._controlInterpolants,l=e.__cacheIndex,h=--this._nActiveControlInterpolants,g=i[h];e.__cacheIndex=h,i[h]=e,g.__cacheIndex=l,i[l]=g}clipAction(e,i,l){const h=i||this._root,g=h.uuid;let v=typeof e=="string"?Jb.findByName(h,e):e;const r=v!==null?v.uuid:e,C=this._actionsByClip[r];let I=null;if(l===void 0&&(v!==null?l=v.blendMode:l=BM),C!==void 0){const N=C.actionByRoot[g];if(N!==void 0&&N.blendMode===l)return N;I=C.knownActions[0],v===null&&(v=I._clip)}if(v===null)return null;const z=new Xk(this,v,i,l);return this._bindAction(z,I),this._addInactiveAction(z,r,g),z}existingAction(e,i){const l=i||this._root,h=l.uuid,g=typeof e=="string"?Jb.findByName(l,e):e,v=g?g.uuid:e,r=this._actionsByClip[v];return r!==void 0&&r.actionByRoot[h]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let l=i-1;l>=0;--l)e[l].stop();return this}update(e){e*=this.timeScale;const i=this._actions,l=this._nActiveActions,h=this.time+=e,g=Math.sign(e),v=this._accuIndex^=1;for(let I=0;I!==l;++I)i[I]._update(h,e,g,v);const r=this._bindings,C=this._nActiveBindings;for(let I=0;I!==C;++I)r[I].apply(v);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,l=e.uuid,h=this._actionsByClip,g=h[l];if(g!==void 0){const v=g.knownActions;for(let r=0,C=v.length;r!==C;++r){const I=v[r];this._deactivateAction(I);const z=I._cacheIndex,N=i[i.length-1];I._cacheIndex=null,I._byClipCacheIndex=null,N._cacheIndex=z,i[z]=N,i.pop(),this._removeInactiveBindingsForAction(I)}delete h[l]}}uncacheRoot(e){const i=e.uuid,l=this._actionsByClip;for(const v in l){const r=l[v].actionByRoot,C=r[i];C!==void 0&&(this._deactivateAction(C),this._removeInactiveAction(C))}const h=this._bindingsByRootAndName,g=h[i];if(g!==void 0)for(const v in g){const r=g[v];r.restoreOriginalState(),this._removeInactiveBinding(r)}}uncacheAction(e,i){const l=this.existingAction(e,i);l!==null&&(this._deactivateAction(l),this._removeInactiveAction(l))}}class ZQ extends LI{constructor(e=1,i=1,l=1,h={}){super(e,i,h),this.isRenderTarget3D=!0,this.depth=l,this.texture=new FM(null,e,i,l),this._setTextureOptions(h),this.texture.isRenderTargetTexture=!0}}class Oa{constructor(e){this.value=e}clone(){return new Oa(this.value.clone===void 0?this.value:this.value.clone())}}let YQ=0;class KQ extends jd{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:YQ++}),this.name="",this.usage=Hb,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let l=0,h=i.length;l<h;l++){const g=Array.isArray(i[l])?i[l]:[i[l]];for(let v=0;v<g.length;v++)this.uniforms.push(g[v].clone())}return this}clone(){return new this.constructor().copy(this)}}class $Q extends GM{constructor(e,i,l=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=l}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class JQ{constructor(e,i,l,h,g,v=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=l,this.elementSize=h,this.count=g,this.normalized=v,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const nN=new ps;class Wk{constructor(e,i,l=0,h=1/0){this.ray=new xv(e,i),this.near=l,this.far=h,this.camera=null,this.layers=new ov,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):ys("Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return nN.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(nN),this}intersectObject(e,i=!0,l=[]){return yR(e,this,l,i),l.sort(rN),l}intersectObjects(e,i=!0,l=[]){for(let h=0,g=e.length;h<g;h++)yR(e[h],this,l,i);return l.sort(rN),l}}function rN(n,e){return n.distance-e.distance}function yR(n,e,i,l){let h=!0;if(n.layers.test(e.layers)&&n.raycast(e,i)===!1&&(h=!1),h===!0&&l===!0){const g=n.children;for(let v=0,r=g.length;v<r;v++)yR(g[v],e,i,!0)}}let QQ=class{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=eee.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}};function eee(){this._document.hidden===!1&&this.reset()}class tee{constructor(e=1,i=0,l=0){this.radius=e,this.phi=i,this.theta=l}set(e,i,l){return this.radius=e,this.phi=i,this.theta=l,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=os(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,l){return this.radius=Math.sqrt(e*e+i*i+l*l),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,l),this.phi=Math.acos(os(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class iee{constructor(e=1,i=0,l=0){this.radius=e,this.theta=i,this.y=l}set(e,i,l){return this.radius=e,this.theta=i,this.y=l,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,l){return this.radius=Math.sqrt(e*e+l*l),this.theta=Math.atan2(e,l),this.y=i,this}clone(){return new this.constructor().copy(this)}}class rD{constructor(e,i,l,h){rD.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,i,l,h)}identity(){return this.set(1,0,0,1),this}fromArray(e,i=0){for(let l=0;l<4;l++)this.elements[l]=e[l+i];return this}set(e,i,l,h){const g=this.elements;return g[0]=e,g[2]=i,g[1]=l,g[3]=h,this}}const sN=new $i;class nee{constructor(e=new $i(1/0,1/0),i=new $i(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,l=e.length;i<l;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const l=sN.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(l),this.max.copy(e).add(l),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,sN).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const aN=new gt,yT=new gt,Rx=new gt,Ix=new gt,I3=new gt,ree=new gt,see=new gt;class aee{constructor(e=new gt,i=new gt){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){aN.subVectors(e,this.start),yT.subVectors(this.end,this.start);const l=yT.dot(yT);let g=yT.dot(aN)/l;return i&&(g=os(g,0,1)),g}closestPointToPoint(e,i,l){const h=this.closestPointToPointParameter(e,i);return this.delta(l).multiplyScalar(h).add(this.start)}distanceSqToLine3(e,i=ree,l=see){const h=10000000000000001e-32;let g,v;const r=this.start,C=e.start,I=this.end,z=e.end;Rx.subVectors(I,r),Ix.subVectors(z,C),I3.subVectors(r,C);const N=Rx.dot(Rx),k=Ix.dot(Ix),j=Ix.dot(I3);if(N<=h&&k<=h)return i.copy(r),l.copy(C),i.sub(l),i.dot(i);if(N<=h)g=0,v=j/k,v=os(v,0,1);else{const $=Rx.dot(I3);if(k<=h)v=0,g=os(-$/N,0,1);else{const re=Rx.dot(Ix),ie=N*k-re*re;ie!==0?g=os((re*j-$*k)/ie,0,1):g=0,v=(re*g+j)/k,v<0?(v=0,g=os(-$/N,0,1)):v>1&&(v=1,g=os((re-$)/N,0,1))}}return i.copy(r).add(Rx.multiplyScalar(g)),l.copy(C).add(Ix.multiplyScalar(v)),i.sub(l),i.dot(i)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const oN=new gt;class oee extends va{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const l=new Is,h=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let v=0,r=1,C=32;v<C;v++,r++){const I=v/C*Math.PI*2,z=r/C*Math.PI*2;h.push(Math.cos(I),Math.sin(I),1,Math.cos(z),Math.sin(z),1)}l.setAttribute("position",new Mr(h,3));const g=new ef({fog:!1,toneMapped:!1});this.cone=new gg(l,g),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),oN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(oN),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const k_=new gt,xT=new ps,D3=new ps;class lee extends gg{constructor(e){const i=Zk(e),l=new Is,h=[],g=[];for(let I=0;I<i.length;I++){const z=i[I];z.parent&&z.parent.isBone&&(h.push(0,0,0),h.push(0,0,0),g.push(0,0,0),g.push(0,0,0))}l.setAttribute("position",new Mr(h,3)),l.setAttribute("color",new Mr(g,3));const v=new ef({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(l,v),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const r=new ar(255),C=new ar(65280);this.setColors(r,C)}updateMatrixWorld(e){const i=this.bones,l=this.geometry,h=l.getAttribute("position");D3.copy(this.root.matrixWorld).invert();for(let g=0,v=0;g<i.length;g++){const r=i[g];r.parent&&r.parent.isBone&&(xT.multiplyMatrices(D3,r.matrixWorld),k_.setFromMatrixPosition(xT),h.setXYZ(v,k_.x,k_.y,k_.z),xT.multiplyMatrices(D3,r.parent.matrixWorld),k_.setFromMatrixPosition(xT),h.setXYZ(v+1,k_.x,k_.y,k_.z),v+=2)}l.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,i){const h=this.geometry.getAttribute("color");for(let g=0;g<h.count;g+=2)h.setXYZ(g,e.r,e.g,e.b),h.setXYZ(g+1,i.r,i.g,i.b);return h.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Zk(n){const e=[];n.isBone===!0&&e.push(n);for(let i=0;i<n.children.length;i++)e.push(...Zk(n.children[i]));return e}class cee extends sc{constructor(e,i,l){const h=new gw(i,4,2),g=new o0({wireframe:!0,fog:!1,toneMapped:!1});super(h,g),this.light=e,this.color=l,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const uee=new gt,lN=new ar,cN=new ar;class hee extends va{constructor(e,i,l){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=l,this.type="HemisphereLightHelper";const h=new mw(i);h.rotateY(Math.PI*.5),this.material=new o0({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const g=h.getAttribute("position"),v=new Float32Array(g.count*3);h.setAttribute("color",new Ba(v,3)),this.add(new sc(h,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");lN.copy(this.light.color),cN.copy(this.light.groundColor);for(let l=0,h=i.count;l<h;l++){const g=l<h/2?lN:cN;i.setXYZ(l,g.r,g.g,g.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(uee.setFromMatrixPosition(this.light.matrixWorld).negate())}}class fee extends gg{constructor(e=10,i=10,l=4473924,h=8947848){l=new ar(l),h=new ar(h);const g=i/2,v=e/i,r=e/2,C=[],I=[];for(let k=0,j=0,$=-r;k<=i;k++,$+=v){C.push(-r,0,$,r,0,$),C.push($,0,-r,$,0,r);const re=k===g?l:h;re.toArray(I,j),j+=3,re.toArray(I,j),j+=3,re.toArray(I,j),j+=3,re.toArray(I,j),j+=3}const z=new Is;z.setAttribute("position",new Mr(C,3)),z.setAttribute("color",new Mr(I,3));const N=new ef({vertexColors:!0,toneMapped:!1});super(z,N),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class dee extends gg{constructor(e=10,i=16,l=8,h=64,g=4473924,v=8947848){g=new ar(g),v=new ar(v);const r=[],C=[];if(i>1)for(let N=0;N<i;N++){const k=N/i*(Math.PI*2),j=Math.sin(k)*e,$=Math.cos(k)*e;r.push(0,0,0),r.push(j,0,$);const re=N&1?g:v;C.push(re.r,re.g,re.b),C.push(re.r,re.g,re.b)}for(let N=0;N<l;N++){const k=N&1?g:v,j=e-e/l*N;for(let $=0;$<h;$++){let re=$/h*(Math.PI*2),ie=Math.sin(re)*j,Y=Math.cos(re)*j;r.push(ie,0,Y),C.push(k.r,k.g,k.b),re=($+1)/h*(Math.PI*2),ie=Math.sin(re)*j,Y=Math.cos(re)*j,r.push(ie,0,Y),C.push(k.r,k.g,k.b)}}const I=new Is;I.setAttribute("position",new Mr(r,3)),I.setAttribute("color",new Mr(C,3));const z=new ef({vertexColors:!0,toneMapped:!1});super(I,z),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const uN=new gt,vT=new gt,hN=new gt;class pee extends va{constructor(e,i,l){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=l,this.type="DirectionalLightHelper",i===void 0&&(i=1);let h=new Is;h.setAttribute("position",new Mr([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const g=new ef({fog:!1,toneMapped:!1});this.lightPlane=new i0(h,g),this.add(this.lightPlane),h=new Is,h.setAttribute("position",new Mr([0,0,0,0,0,1],3)),this.targetLine=new i0(h,g),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),uN.setFromMatrixPosition(this.light.matrixWorld),vT.setFromMatrixPosition(this.light.target.matrixWorld),hN.subVectors(vT,uN),this.lightPlane.lookAt(vT),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vT),this.targetLine.scale.z=hN.length()}}const bT=new gt,ml=new UM;class mee extends gg{constructor(e){const i=new Is,l=new ef({color:16777215,vertexColors:!0,toneMapped:!1}),h=[],g=[],v={};r("n1","n2"),r("n2","n4"),r("n4","n3"),r("n3","n1"),r("f1","f2"),r("f2","f4"),r("f4","f3"),r("f3","f1"),r("n1","f1"),r("n2","f2"),r("n3","f3"),r("n4","f4"),r("p","n1"),r("p","n2"),r("p","n3"),r("p","n4"),r("u1","u2"),r("u2","u3"),r("u3","u1"),r("c","t"),r("p","c"),r("cn1","cn2"),r("cn3","cn4"),r("cf1","cf2"),r("cf3","cf4");function r($,re){C($),C(re)}function C($){h.push(0,0,0),g.push(0,0,0),v[$]===void 0&&(v[$]=[]),v[$].push(h.length/3-1)}i.setAttribute("position",new Mr(h,3)),i.setAttribute("color",new Mr(g,3)),super(i,l),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=v,this.update();const I=new ar(16755200),z=new ar(16711680),N=new ar(43775),k=new ar(16777215),j=new ar(3355443);this.setColors(I,z,N,k,j)}setColors(e,i,l,h,g){const r=this.geometry.getAttribute("color");return r.setXYZ(0,e.r,e.g,e.b),r.setXYZ(1,e.r,e.g,e.b),r.setXYZ(2,e.r,e.g,e.b),r.setXYZ(3,e.r,e.g,e.b),r.setXYZ(4,e.r,e.g,e.b),r.setXYZ(5,e.r,e.g,e.b),r.setXYZ(6,e.r,e.g,e.b),r.setXYZ(7,e.r,e.g,e.b),r.setXYZ(8,e.r,e.g,e.b),r.setXYZ(9,e.r,e.g,e.b),r.setXYZ(10,e.r,e.g,e.b),r.setXYZ(11,e.r,e.g,e.b),r.setXYZ(12,e.r,e.g,e.b),r.setXYZ(13,e.r,e.g,e.b),r.setXYZ(14,e.r,e.g,e.b),r.setXYZ(15,e.r,e.g,e.b),r.setXYZ(16,e.r,e.g,e.b),r.setXYZ(17,e.r,e.g,e.b),r.setXYZ(18,e.r,e.g,e.b),r.setXYZ(19,e.r,e.g,e.b),r.setXYZ(20,e.r,e.g,e.b),r.setXYZ(21,e.r,e.g,e.b),r.setXYZ(22,e.r,e.g,e.b),r.setXYZ(23,e.r,e.g,e.b),r.setXYZ(24,i.r,i.g,i.b),r.setXYZ(25,i.r,i.g,i.b),r.setXYZ(26,i.r,i.g,i.b),r.setXYZ(27,i.r,i.g,i.b),r.setXYZ(28,i.r,i.g,i.b),r.setXYZ(29,i.r,i.g,i.b),r.setXYZ(30,i.r,i.g,i.b),r.setXYZ(31,i.r,i.g,i.b),r.setXYZ(32,l.r,l.g,l.b),r.setXYZ(33,l.r,l.g,l.b),r.setXYZ(34,l.r,l.g,l.b),r.setXYZ(35,l.r,l.g,l.b),r.setXYZ(36,l.r,l.g,l.b),r.setXYZ(37,l.r,l.g,l.b),r.setXYZ(38,h.r,h.g,h.b),r.setXYZ(39,h.r,h.g,h.b),r.setXYZ(40,g.r,g.g,g.b),r.setXYZ(41,g.r,g.g,g.b),r.setXYZ(42,g.r,g.g,g.b),r.setXYZ(43,g.r,g.g,g.b),r.setXYZ(44,g.r,g.g,g.b),r.setXYZ(45,g.r,g.g,g.b),r.setXYZ(46,g.r,g.g,g.b),r.setXYZ(47,g.r,g.g,g.b),r.setXYZ(48,g.r,g.g,g.b),r.setXYZ(49,g.r,g.g,g.b),r.needsUpdate=!0,this}update(){const e=this.geometry,i=this.pointMap,l=1,h=1;let g,v;if(ml.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)g=1,v=0;else if(this.camera.coordinateSystem===Ud)g=-1,v=1;else if(this.camera.coordinateSystem===rv)g=0,v=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Bl("c",i,e,ml,0,0,g),Bl("t",i,e,ml,0,0,v),Bl("n1",i,e,ml,-l,-h,g),Bl("n2",i,e,ml,l,-h,g),Bl("n3",i,e,ml,-l,h,g),Bl("n4",i,e,ml,l,h,g),Bl("f1",i,e,ml,-l,-h,v),Bl("f2",i,e,ml,l,-h,v),Bl("f3",i,e,ml,-l,h,v),Bl("f4",i,e,ml,l,h,v),Bl("u1",i,e,ml,l*.7,h*1.1,g),Bl("u2",i,e,ml,-l*.7,h*1.1,g),Bl("u3",i,e,ml,0,h*2,g),Bl("cf1",i,e,ml,-l,0,v),Bl("cf2",i,e,ml,l,0,v),Bl("cf3",i,e,ml,0,-h,v),Bl("cf4",i,e,ml,0,h,v),Bl("cn1",i,e,ml,-l,0,g),Bl("cn2",i,e,ml,l,0,g),Bl("cn3",i,e,ml,0,-h,g),Bl("cn4",i,e,ml,0,h,g),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Bl(n,e,i,l,h,g,v){bT.set(h,g,v).unproject(l);const r=e[n];if(r!==void 0){const C=i.getAttribute("position");for(let I=0,z=r.length;I<z;I++)C.setXYZ(r[I],bT.x,bT.y,bT.z)}}const wT=new yh;class gee extends gg{constructor(e,i=16776960){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),h=new Float32Array(24),g=new Is;g.setIndex(new Ba(l,1)),g.setAttribute("position",new Ba(h,3)),super(g,new ef({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&wT.setFromObject(this.object),wT.isEmpty())return;const e=wT.min,i=wT.max,l=this.geometry.attributes.position,h=l.array;h[0]=i.x,h[1]=i.y,h[2]=i.z,h[3]=e.x,h[4]=i.y,h[5]=i.z,h[6]=e.x,h[7]=e.y,h[8]=i.z,h[9]=i.x,h[10]=e.y,h[11]=i.z,h[12]=i.x,h[13]=i.y,h[14]=e.z,h[15]=e.x,h[16]=i.y,h[17]=e.z,h[18]=e.x,h[19]=e.y,h[20]=e.z,h[21]=i.x,h[22]=e.y,h[23]=e.z,l.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class _ee extends gg{constructor(e,i=16776960){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),h=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],g=new Is;g.setIndex(new Ba(l,1)),g.setAttribute("position",new Mr(h,3)),super(g,new ef({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class yee extends i0{constructor(e,i=1,l=16776960){const h=l,g=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],v=new Is;v.setAttribute("position",new Mr(g,3)),v.computeBoundingSphere(),super(v,new ef({color:h,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const r=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],C=new Is;C.setAttribute("position",new Mr(r,3)),C.computeBoundingSphere(),this.add(new sc(C,new o0({color:h,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const fN=new gt;let ST,L3;class xee extends va{constructor(e=new gt(0,0,1),i=new gt(0,0,0),l=1,h=16776960,g=l*.2,v=g*.2){super(),this.type="ArrowHelper",ST===void 0&&(ST=new Is,ST.setAttribute("position",new Mr([0,0,0,0,1,0],3)),L3=new pw(.5,1,5,1),L3.translate(0,-.5,0)),this.position.copy(i),this.line=new i0(ST,new ef({color:h,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new sc(L3,new o0({color:h,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(l,g,v)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{fN.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(fN,i)}}setLength(e,i=e*.2,l=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(l,i,l),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class vee extends gg{constructor(e=1){const i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],l=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],h=new Is;h.setAttribute("position",new Mr(i,3)),h.setAttribute("color",new Mr(l,3));const g=new ef({vertexColors:!0,toneMapped:!1});super(h,g),this.type="AxesHelper"}setColors(e,i,l){const h=new ar,g=this.geometry.attributes.color.array;return h.set(e),h.toArray(g,0),h.toArray(g,3),h.set(i),h.toArray(g,6),h.toArray(g,9),h.set(l),h.toArray(g,12),h.toArray(g,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class bee{constructor(){this.type="ShapePath",this.color=new ar,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new dM,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,l,h){return this.currentPath.quadraticCurveTo(e,i,l,h),this}bezierCurveTo(e,i,l,h,g,v){return this.currentPath.bezierCurveTo(e,i,l,h,g,v),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(Y){const ae=[];for(let ue=0,me=Y.length;ue<me;ue++){const Ae=Y[ue],Se=new my;Se.curves=Ae.curves,ae.push(Se)}return ae}function l(Y,ae){const ue=ae.length;let me=!1;for(let Ae=ue-1,Se=0;Se<ue;Ae=Se++){let ze=ae[Ae],je=ae[Se],Ce=je.x-ze.x,Te=je.y-ze.y;if(Math.abs(Te)>Number.EPSILON){if(Te<0&&(ze=ae[Se],Ce=-Ce,je=ae[Ae],Te=-Te),Y.y<ze.y||Y.y>je.y)continue;if(Y.y===ze.y){if(Y.x===ze.x)return!0}else{const Ze=Te*(Y.x-ze.x)-Ce*(Y.y-ze.y);if(Ze===0)return!0;if(Ze<0)continue;me=!me}}else{if(Y.y!==ze.y)continue;if(je.x<=Y.x&&Y.x<=ze.x||ze.x<=Y.x&&Y.x<=je.x)return!0}}return me}const h=Am.isClockWise,g=this.subPaths;if(g.length===0)return[];let v,r,C;const I=[];if(g.length===1)return r=g[0],C=new my,C.curves=r.curves,I.push(C),I;let z=!h(g[0].getPoints());z=e?!z:z;const N=[],k=[];let j=[],$=0,re;k[$]=void 0,j[$]=[];for(let Y=0,ae=g.length;Y<ae;Y++)r=g[Y],re=r.getPoints(),v=h(re),v=e?!v:v,v?(!z&&k[$]&&$++,k[$]={s:new my,p:re},k[$].s.curves=r.curves,z&&$++,j[$]=[]):j[$].push({h:r,p:re[0]});if(!k[0])return i(g);if(k.length>1){let Y=!1,ae=0;for(let ue=0,me=k.length;ue<me;ue++)N[ue]=[];for(let ue=0,me=k.length;ue<me;ue++){const Ae=j[ue];for(let Se=0;Se<Ae.length;Se++){const ze=Ae[Se];let je=!0;for(let Ce=0;Ce<k.length;Ce++)l(ze.p,k[Ce].p)&&(ue!==Ce&&ae++,je?(je=!1,N[Ce].push(ze)):Y=!0);je&&N[ue].push(ze)}}ae>0&&Y===!1&&(j=N)}let ie;for(let Y=0,ae=k.length;Y<ae;Y++){C=k[Y].s,I.push(C),ie=j[Y];for(let ue=0,me=ie.length;ue<me;ue++)C.holes.push(ie[ue].h)}return I}}class wee extends jd{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){ir("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function See(n,e){const i=n.image&&n.image.width?n.image.width/n.image.height:1;return i>e?(n.repeat.x=1,n.repeat.y=i/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/i,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function Tee(n,e){const i=n.image&&n.image.width?n.image.width/n.image.height:1;return i>e?(n.repeat.x=e/i,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=i/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function Mee(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function xR(n,e,i,l){const h=Eee(l);switch(i){case AI:return n*e;case LM:return n*e/h.components*h.byteLength;case hw:return n*e/h.components*h.byteLength;case PM:return n*e*2/h.components*h.byteLength;case zM:return n*e*2/h.components*h.byteLength;case CI:return n*e*3/h.components*h.byteLength;case _h:return n*e*4/h.components*h.byteLength;case OM:return n*e*4/h.components*h.byteLength;case db:case pb:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case mb:case gb:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case B2:case F2:return Math.max(n,16)*Math.max(e,8)/4;case O2:case N2:return Math.max(n,8)*Math.max(e,8)/2;case U2:case k2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case V2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case G2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case H2:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case j2:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case q2:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case X2:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case W2:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Z2:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Y2:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case K2:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case $2:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case J2:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Q2:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case eM:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case tM:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case iM:case nM:case rM:return Math.ceil(n/4)*Math.ceil(e/4)*16;case sM:case aM:return Math.ceil(n/4)*Math.ceil(e/4)*8;case oM:case lM:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function Eee(n){switch(n){case xh:case SI:return{byteLength:1,components:1};case iv:case TI:case r0:return{byteLength:2,components:1};case IM:case DM:return{byteLength:2,components:4};case dg:case RM:case $h:return{byteLength:4,components:1};case MI:case EI:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class Aee{static contain(e,i){return See(e,i)}static cover(e,i){return Tee(e,i)}static fill(e){return Mee(e)}static getByteLength(e,i,l,h){return xR(e,i,l,h)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:cw}}));typeof window<"u"&&(window.__THREE__?ir("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=cw);function Yk(){let n=null,e=!1,i=null,l=null;function h(g,v){i(g,v),l=n.requestAnimationFrame(h)}return{start:function(){e!==!0&&i!==null&&(l=n.requestAnimationFrame(h),e=!0)},stop:function(){n.cancelAnimationFrame(l),e=!1},setAnimationLoop:function(g){i=g},setContext:function(g){n=g}}}function Cee(n){const e=new WeakMap;function i(r,C){const I=r.array,z=r.usage,N=I.byteLength,k=n.createBuffer();n.bindBuffer(C,k),n.bufferData(C,I,z),r.onUploadCallback();let j;if(I instanceof Float32Array)j=n.FLOAT;else if(typeof Float16Array<"u"&&I instanceof Float16Array)j=n.HALF_FLOAT;else if(I instanceof Uint16Array)r.isFloat16BufferAttribute?j=n.HALF_FLOAT:j=n.UNSIGNED_SHORT;else if(I instanceof Int16Array)j=n.SHORT;else if(I instanceof Uint32Array)j=n.UNSIGNED_INT;else if(I instanceof Int32Array)j=n.INT;else if(I instanceof Int8Array)j=n.BYTE;else if(I instanceof Uint8Array)j=n.UNSIGNED_BYTE;else if(I instanceof Uint8ClampedArray)j=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+I);return{buffer:k,type:j,bytesPerElement:I.BYTES_PER_ELEMENT,version:r.version,size:N}}function l(r,C,I){const z=C.array,N=C.updateRanges;if(n.bindBuffer(I,r),N.length===0)n.bufferSubData(I,0,z);else{N.sort((j,$)=>j.start-$.start);let k=0;for(let j=1;j<N.length;j++){const $=N[k],re=N[j];re.start<=$.start+$.count+1?$.count=Math.max($.count,re.start+re.count-$.start):(++k,N[k]=re)}N.length=k+1;for(let j=0,$=N.length;j<$;j++){const re=N[j];n.bufferSubData(I,re.start*z.BYTES_PER_ELEMENT,z,re.start,re.count)}C.clearUpdateRanges()}C.onUploadCallback()}function h(r){return r.isInterleavedBufferAttribute&&(r=r.data),e.get(r)}function g(r){r.isInterleavedBufferAttribute&&(r=r.data);const C=e.get(r);C&&(n.deleteBuffer(C.buffer),e.delete(r))}function v(r,C){if(r.isInterleavedBufferAttribute&&(r=r.data),r.isGLBufferAttribute){const z=e.get(r);(!z||z.version<r.version)&&e.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version});return}const I=e.get(r);if(I===void 0)e.set(r,i(r,C));else if(I.version<r.version){if(I.size!==r.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");l(I.buffer,r,C),I.version=r.version}}return{get:h,remove:g,update:v}}var Ree=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Iee=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Dee=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Lee=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Pee=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,zee=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Oee=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Bee=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Nee=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Fee=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Uee=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,kee=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Vee=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Gee=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Hee=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,jee=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,qee=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Xee=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Wee=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Zee=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Yee=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Kee=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,$ee=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Jee=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Qee=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,ete=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,tte=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,ite=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,nte=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,rte=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,ste="gl_FragColor = linearToOutputTexel( gl_FragColor );",ate=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,ote=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,lte=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,cte=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ute=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,hte=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fte=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,dte=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,pte=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,mte=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gte=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,_te=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,yte=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,xte=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,vte=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,bte=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,wte=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Ste=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Tte=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Mte=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Ete=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Ate=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Cte=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Rte=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Ite=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Dte=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Lte=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Pte=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,zte=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Ote=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Bte=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Nte=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Fte=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ute=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,kte=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Vte=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Gte=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Hte=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,jte=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,qte=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Xte=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Wte=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Zte=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Yte=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Kte=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,$te=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Jte=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Qte=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,eie=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,tie=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,iie=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,nie=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,rie=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,sie=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,aie=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,oie=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,lie=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,cie=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,uie=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,hie=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,fie=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,die=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,pie=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,mie=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,gie=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,_ie=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,yie=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,xie=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,vie=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,bie=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,wie=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Sie=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Tie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Mie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Eie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Aie=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Cie=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Rie=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Iie=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Die=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Lie=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Pie=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,zie=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Oie=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Bie=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Nie=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Fie=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Uie=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,kie=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Vie=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Gie=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Hie=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jie=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qie=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xie=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Wie=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zie=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Yie=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Kie=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$ie=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Jie=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Qie=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ene=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,tne=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ine=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,nne=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rne=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sne=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ane=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,one=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Hs={alphahash_fragment:Ree,alphahash_pars_fragment:Iee,alphamap_fragment:Dee,alphamap_pars_fragment:Lee,alphatest_fragment:Pee,alphatest_pars_fragment:zee,aomap_fragment:Oee,aomap_pars_fragment:Bee,batching_pars_vertex:Nee,batching_vertex:Fee,begin_vertex:Uee,beginnormal_vertex:kee,bsdfs:Vee,iridescence_fragment:Gee,bumpmap_pars_fragment:Hee,clipping_planes_fragment:jee,clipping_planes_pars_fragment:qee,clipping_planes_pars_vertex:Xee,clipping_planes_vertex:Wee,color_fragment:Zee,color_pars_fragment:Yee,color_pars_vertex:Kee,color_vertex:$ee,common:Jee,cube_uv_reflection_fragment:Qee,defaultnormal_vertex:ete,displacementmap_pars_vertex:tte,displacementmap_vertex:ite,emissivemap_fragment:nte,emissivemap_pars_fragment:rte,colorspace_fragment:ste,colorspace_pars_fragment:ate,envmap_fragment:ote,envmap_common_pars_fragment:lte,envmap_pars_fragment:cte,envmap_pars_vertex:ute,envmap_physical_pars_fragment:bte,envmap_vertex:hte,fog_vertex:fte,fog_pars_vertex:dte,fog_fragment:pte,fog_pars_fragment:mte,gradientmap_pars_fragment:gte,lightmap_pars_fragment:_te,lights_lambert_fragment:yte,lights_lambert_pars_fragment:xte,lights_pars_begin:vte,lights_toon_fragment:wte,lights_toon_pars_fragment:Ste,lights_phong_fragment:Tte,lights_phong_pars_fragment:Mte,lights_physical_fragment:Ete,lights_physical_pars_fragment:Ate,lights_fragment_begin:Cte,lights_fragment_maps:Rte,lights_fragment_end:Ite,logdepthbuf_fragment:Dte,logdepthbuf_pars_fragment:Lte,logdepthbuf_pars_vertex:Pte,logdepthbuf_vertex:zte,map_fragment:Ote,map_pars_fragment:Bte,map_particle_fragment:Nte,map_particle_pars_fragment:Fte,metalnessmap_fragment:Ute,metalnessmap_pars_fragment:kte,morphinstance_vertex:Vte,morphcolor_vertex:Gte,morphnormal_vertex:Hte,morphtarget_pars_vertex:jte,morphtarget_vertex:qte,normal_fragment_begin:Xte,normal_fragment_maps:Wte,normal_pars_fragment:Zte,normal_pars_vertex:Yte,normal_vertex:Kte,normalmap_pars_fragment:$te,clearcoat_normal_fragment_begin:Jte,clearcoat_normal_fragment_maps:Qte,clearcoat_pars_fragment:eie,iridescence_pars_fragment:tie,opaque_fragment:iie,packing:nie,premultiplied_alpha_fragment:rie,project_vertex:sie,dithering_fragment:aie,dithering_pars_fragment:oie,roughnessmap_fragment:lie,roughnessmap_pars_fragment:cie,shadowmap_pars_fragment:uie,shadowmap_pars_vertex:hie,shadowmap_vertex:fie,shadowmask_pars_fragment:die,skinbase_vertex:pie,skinning_pars_vertex:mie,skinning_vertex:gie,skinnormal_vertex:_ie,specularmap_fragment:yie,specularmap_pars_fragment:xie,tonemapping_fragment:vie,tonemapping_pars_fragment:bie,transmission_fragment:wie,transmission_pars_fragment:Sie,uv_pars_fragment:Tie,uv_pars_vertex:Mie,uv_vertex:Eie,worldpos_vertex:Aie,background_vert:Cie,background_frag:Rie,backgroundCube_vert:Iie,backgroundCube_frag:Die,cube_vert:Lie,cube_frag:Pie,depth_vert:zie,depth_frag:Oie,distanceRGBA_vert:Bie,distanceRGBA_frag:Nie,equirect_vert:Fie,equirect_frag:Uie,linedashed_vert:kie,linedashed_frag:Vie,meshbasic_vert:Gie,meshbasic_frag:Hie,meshlambert_vert:jie,meshlambert_frag:qie,meshmatcap_vert:Xie,meshmatcap_frag:Wie,meshnormal_vert:Zie,meshnormal_frag:Yie,meshphong_vert:Kie,meshphong_frag:$ie,meshphysical_vert:Jie,meshphysical_frag:Qie,meshtoon_vert:ene,meshtoon_frag:tne,points_vert:ine,points_frag:nne,shadow_vert:rne,shadow_frag:sne,sprite_vert:ane,sprite_frag:one},tr={common:{diffuse:{value:new ar(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ps},alphaMap:{value:null},alphaMapTransform:{value:new Ps},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ps}},envmap:{envMap:{value:null},envMapRotation:{value:new Ps},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ps}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ps}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ps},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ps},normalScale:{value:new $i(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ps},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ps}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ps}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ps}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ar(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ar(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ps},alphaTest:{value:0},uvTransform:{value:new Ps}},sprite:{diffuse:{value:new ar(16777215)},opacity:{value:1},center:{value:new $i(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ps},alphaMap:{value:null},alphaMapTransform:{value:new Ps},alphaTest:{value:0}}},Sm={basic:{uniforms:jh([tr.common,tr.specularmap,tr.envmap,tr.aomap,tr.lightmap,tr.fog]),vertexShader:Hs.meshbasic_vert,fragmentShader:Hs.meshbasic_frag},lambert:{uniforms:jh([tr.common,tr.specularmap,tr.envmap,tr.aomap,tr.lightmap,tr.emissivemap,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.fog,tr.lights,{emissive:{value:new ar(0)}}]),vertexShader:Hs.meshlambert_vert,fragmentShader:Hs.meshlambert_frag},phong:{uniforms:jh([tr.common,tr.specularmap,tr.envmap,tr.aomap,tr.lightmap,tr.emissivemap,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.fog,tr.lights,{emissive:{value:new ar(0)},specular:{value:new ar(1118481)},shininess:{value:30}}]),vertexShader:Hs.meshphong_vert,fragmentShader:Hs.meshphong_frag},standard:{uniforms:jh([tr.common,tr.envmap,tr.aomap,tr.lightmap,tr.emissivemap,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.roughnessmap,tr.metalnessmap,tr.fog,tr.lights,{emissive:{value:new ar(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Hs.meshphysical_vert,fragmentShader:Hs.meshphysical_frag},toon:{uniforms:jh([tr.common,tr.aomap,tr.lightmap,tr.emissivemap,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.gradientmap,tr.fog,tr.lights,{emissive:{value:new ar(0)}}]),vertexShader:Hs.meshtoon_vert,fragmentShader:Hs.meshtoon_frag},matcap:{uniforms:jh([tr.common,tr.bumpmap,tr.normalmap,tr.displacementmap,tr.fog,{matcap:{value:null}}]),vertexShader:Hs.meshmatcap_vert,fragmentShader:Hs.meshmatcap_frag},points:{uniforms:jh([tr.points,tr.fog]),vertexShader:Hs.points_vert,fragmentShader:Hs.points_frag},dashed:{uniforms:jh([tr.common,tr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Hs.linedashed_vert,fragmentShader:Hs.linedashed_frag},depth:{uniforms:jh([tr.common,tr.displacementmap]),vertexShader:Hs.depth_vert,fragmentShader:Hs.depth_frag},normal:{uniforms:jh([tr.common,tr.bumpmap,tr.normalmap,tr.displacementmap,{opacity:{value:1}}]),vertexShader:Hs.meshnormal_vert,fragmentShader:Hs.meshnormal_frag},sprite:{uniforms:jh([tr.sprite,tr.fog]),vertexShader:Hs.sprite_vert,fragmentShader:Hs.sprite_frag},background:{uniforms:{uvTransform:{value:new Ps},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Hs.background_vert,fragmentShader:Hs.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ps}},vertexShader:Hs.backgroundCube_vert,fragmentShader:Hs.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Hs.cube_vert,fragmentShader:Hs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Hs.equirect_vert,fragmentShader:Hs.equirect_frag},distanceRGBA:{uniforms:jh([tr.common,tr.displacementmap,{referencePosition:{value:new gt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Hs.distanceRGBA_vert,fragmentShader:Hs.distanceRGBA_frag},shadow:{uniforms:jh([tr.lights,tr.fog,{color:{value:new ar(0)},opacity:{value:1}}]),vertexShader:Hs.shadow_vert,fragmentShader:Hs.shadow_frag}};Sm.physical={uniforms:jh([Sm.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ps},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ps},clearcoatNormalScale:{value:new $i(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ps},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ps},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ps},sheen:{value:0},sheenColor:{value:new ar(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ps},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ps},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ps},transmissionSamplerSize:{value:new $i},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ps},attenuationDistance:{value:0},attenuationColor:{value:new ar(0)},specularColor:{value:new ar(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ps},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ps},anisotropyVector:{value:new $i},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ps}}]),vertexShader:Hs.meshphysical_vert,fragmentShader:Hs.meshphysical_frag};const TT={r:0,b:0,g:0},$0=new Hd,lne=new ps;function cne(n,e,i,l,h,g,v){const r=new ar(0);let C=g===!0?0:1,I,z,N=null,k=0,j=null;function $(ue){let me=ue.isScene===!0?ue.background:null;return me&&me.isTexture&&(me=(ue.backgroundBlurriness>0?i:e).get(me)),me}function re(ue){let me=!1;const Ae=$(ue);Ae===null?Y(r,C):Ae&&Ae.isColor&&(Y(Ae,1),me=!0);const Se=n.xr.getEnvironmentBlendMode();Se==="additive"?l.buffers.color.setClear(0,0,0,1,v):Se==="alpha-blend"&&l.buffers.color.setClear(0,0,0,0,v),(n.autoClear||me)&&(l.buffers.depth.setTest(!0),l.buffers.depth.setMask(!0),l.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function ie(ue,me){const Ae=$(me);Ae&&(Ae.isCubeTexture||Ae.mapping===yv)?(z===void 0&&(z=new sc(new Ay(1,1,1),new bh({name:"BackgroundCubeMaterial",uniforms:lv(Sm.backgroundCube.uniforms),vertexShader:Sm.backgroundCube.vertexShader,fragmentShader:Sm.backgroundCube.fragmentShader,side:Mc,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),z.geometry.deleteAttribute("normal"),z.geometry.deleteAttribute("uv"),z.onBeforeRender=function(Se,ze,je){this.matrixWorld.copyPosition(je.matrixWorld)},Object.defineProperty(z.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),h.update(z)),$0.copy(me.backgroundRotation),$0.x*=-1,$0.y*=-1,$0.z*=-1,Ae.isCubeTexture&&Ae.isRenderTargetTexture===!1&&($0.y*=-1,$0.z*=-1),z.material.uniforms.envMap.value=Ae,z.material.uniforms.flipEnvMap.value=Ae.isCubeTexture&&Ae.isRenderTargetTexture===!1?-1:1,z.material.uniforms.backgroundBlurriness.value=me.backgroundBlurriness,z.material.uniforms.backgroundIntensity.value=me.backgroundIntensity,z.material.uniforms.backgroundRotation.value.setFromMatrix4(lne.makeRotationFromEuler($0)),z.material.toneMapped=oa.getTransfer(Ae.colorSpace)!==Ha,(N!==Ae||k!==Ae.version||j!==n.toneMapping)&&(z.material.needsUpdate=!0,N=Ae,k=Ae.version,j=n.toneMapping),z.layers.enableAll(),ue.unshift(z,z.geometry,z.material,0,0,null)):Ae&&Ae.isTexture&&(I===void 0&&(I=new sc(new bv(2,2),new bh({name:"BackgroundMaterial",uniforms:lv(Sm.background.uniforms),vertexShader:Sm.background.vertexShader,fragmentShader:Sm.background.fragmentShader,side:fg,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),I.geometry.deleteAttribute("normal"),Object.defineProperty(I.material,"map",{get:function(){return this.uniforms.t2D.value}}),h.update(I)),I.material.uniforms.t2D.value=Ae,I.material.uniforms.backgroundIntensity.value=me.backgroundIntensity,I.material.toneMapped=oa.getTransfer(Ae.colorSpace)!==Ha,Ae.matrixAutoUpdate===!0&&Ae.updateMatrix(),I.material.uniforms.uvTransform.value.copy(Ae.matrix),(N!==Ae||k!==Ae.version||j!==n.toneMapping)&&(I.material.needsUpdate=!0,N=Ae,k=Ae.version,j=n.toneMapping),I.layers.enableAll(),ue.unshift(I,I.geometry,I.material,0,0,null))}function Y(ue,me){ue.getRGB(TT,Y5(n)),l.buffers.color.setClear(TT.r,TT.g,TT.b,me,v)}function ae(){z!==void 0&&(z.geometry.dispose(),z.material.dispose(),z=void 0),I!==void 0&&(I.geometry.dispose(),I.material.dispose(),I=void 0)}return{getClearColor:function(){return r},setClearColor:function(ue,me=1){r.set(ue),C=me,Y(r,C)},getClearAlpha:function(){return C},setClearAlpha:function(ue){C=ue,Y(r,C)},render:re,addToRenderList:ie,dispose:ae}}function une(n,e){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),l={},h=k(null);let g=h,v=!1;function r(Te,Ze,Mt,mt,Gt){let kt=!1;const Re=N(mt,Mt,Ze);g!==Re&&(g=Re,I(g.object)),kt=j(Te,mt,Mt,Gt),kt&&$(Te,mt,Mt,Gt),Gt!==null&&e.update(Gt,n.ELEMENT_ARRAY_BUFFER),(kt||v)&&(v=!1,me(Te,Ze,Mt,mt),Gt!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(Gt).buffer))}function C(){return n.createVertexArray()}function I(Te){return n.bindVertexArray(Te)}function z(Te){return n.deleteVertexArray(Te)}function N(Te,Ze,Mt){const mt=Mt.wireframe===!0;let Gt=l[Te.id];Gt===void 0&&(Gt={},l[Te.id]=Gt);let kt=Gt[Ze.id];kt===void 0&&(kt={},Gt[Ze.id]=kt);let Re=kt[mt];return Re===void 0&&(Re=k(C()),kt[mt]=Re),Re}function k(Te){const Ze=[],Mt=[],mt=[];for(let Gt=0;Gt<i;Gt++)Ze[Gt]=0,Mt[Gt]=0,mt[Gt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ze,enabledAttributes:Mt,attributeDivisors:mt,object:Te,attributes:{},index:null}}function j(Te,Ze,Mt,mt){const Gt=g.attributes,kt=Ze.attributes;let Re=0;const Qe=Mt.getAttributes();for(const et in Qe)if(Qe[et].location>=0){const jt=Gt[et];let Ge=kt[et];if(Ge===void 0&&(et==="instanceMatrix"&&Te.instanceMatrix&&(Ge=Te.instanceMatrix),et==="instanceColor"&&Te.instanceColor&&(Ge=Te.instanceColor)),jt===void 0||jt.attribute!==Ge||Ge&&jt.data!==Ge.data)return!0;Re++}return g.attributesNum!==Re||g.index!==mt}function $(Te,Ze,Mt,mt){const Gt={},kt=Ze.attributes;let Re=0;const Qe=Mt.getAttributes();for(const et in Qe)if(Qe[et].location>=0){let jt=kt[et];jt===void 0&&(et==="instanceMatrix"&&Te.instanceMatrix&&(jt=Te.instanceMatrix),et==="instanceColor"&&Te.instanceColor&&(jt=Te.instanceColor));const Ge={};Ge.attribute=jt,jt&&jt.data&&(Ge.data=jt.data),Gt[et]=Ge,Re++}g.attributes=Gt,g.attributesNum=Re,g.index=mt}function re(){const Te=g.newAttributes;for(let Ze=0,Mt=Te.length;Ze<Mt;Ze++)Te[Ze]=0}function ie(Te){Y(Te,0)}function Y(Te,Ze){const Mt=g.newAttributes,mt=g.enabledAttributes,Gt=g.attributeDivisors;Mt[Te]=1,mt[Te]===0&&(n.enableVertexAttribArray(Te),mt[Te]=1),Gt[Te]!==Ze&&(n.vertexAttribDivisor(Te,Ze),Gt[Te]=Ze)}function ae(){const Te=g.newAttributes,Ze=g.enabledAttributes;for(let Mt=0,mt=Ze.length;Mt<mt;Mt++)Ze[Mt]!==Te[Mt]&&(n.disableVertexAttribArray(Mt),Ze[Mt]=0)}function ue(Te,Ze,Mt,mt,Gt,kt,Re){Re===!0?n.vertexAttribIPointer(Te,Ze,Mt,Gt,kt):n.vertexAttribPointer(Te,Ze,Mt,mt,Gt,kt)}function me(Te,Ze,Mt,mt){re();const Gt=mt.attributes,kt=Mt.getAttributes(),Re=Ze.defaultAttributeValues;for(const Qe in kt){const et=kt[Qe];if(et.location>=0){let Lt=Gt[Qe];if(Lt===void 0&&(Qe==="instanceMatrix"&&Te.instanceMatrix&&(Lt=Te.instanceMatrix),Qe==="instanceColor"&&Te.instanceColor&&(Lt=Te.instanceColor)),Lt!==void 0){const jt=Lt.normalized,Ge=Lt.itemSize,Et=e.get(Lt);if(Et===void 0)continue;const Vt=Et.buffer,ii=Et.type,ki=Et.bytesPerElement,qt=ii===n.INT||ii===n.UNSIGNED_INT||Lt.gpuType===RM;if(Lt.isInterleavedBufferAttribute){const xi=Lt.data,Fi=xi.stride,Ui=Lt.offset;if(xi.isInstancedInterleavedBuffer){for(let rn=0;rn<et.locationSize;rn++)Y(et.location+rn,xi.meshPerAttribute);Te.isInstancedMesh!==!0&&mt._maxInstanceCount===void 0&&(mt._maxInstanceCount=xi.meshPerAttribute*xi.count)}else for(let rn=0;rn<et.locationSize;rn++)ie(et.location+rn);n.bindBuffer(n.ARRAY_BUFFER,Vt);for(let rn=0;rn<et.locationSize;rn++)ue(et.location+rn,Ge/et.locationSize,ii,jt,Fi*ki,(Ui+Ge/et.locationSize*rn)*ki,qt)}else{if(Lt.isInstancedBufferAttribute){for(let xi=0;xi<et.locationSize;xi++)Y(et.location+xi,Lt.meshPerAttribute);Te.isInstancedMesh!==!0&&mt._maxInstanceCount===void 0&&(mt._maxInstanceCount=Lt.meshPerAttribute*Lt.count)}else for(let xi=0;xi<et.locationSize;xi++)ie(et.location+xi);n.bindBuffer(n.ARRAY_BUFFER,Vt);for(let xi=0;xi<et.locationSize;xi++)ue(et.location+xi,Ge/et.locationSize,ii,jt,Ge*ki,Ge/et.locationSize*xi*ki,qt)}}else if(Re!==void 0){const jt=Re[Qe];if(jt!==void 0)switch(jt.length){case 2:n.vertexAttrib2fv(et.location,jt);break;case 3:n.vertexAttrib3fv(et.location,jt);break;case 4:n.vertexAttrib4fv(et.location,jt);break;default:n.vertexAttrib1fv(et.location,jt)}}}}ae()}function Ae(){je();for(const Te in l){const Ze=l[Te];for(const Mt in Ze){const mt=Ze[Mt];for(const Gt in mt)z(mt[Gt].object),delete mt[Gt];delete Ze[Mt]}delete l[Te]}}function Se(Te){if(l[Te.id]===void 0)return;const Ze=l[Te.id];for(const Mt in Ze){const mt=Ze[Mt];for(const Gt in mt)z(mt[Gt].object),delete mt[Gt];delete Ze[Mt]}delete l[Te.id]}function ze(Te){for(const Ze in l){const Mt=l[Ze];if(Mt[Te.id]===void 0)continue;const mt=Mt[Te.id];for(const Gt in mt)z(mt[Gt].object),delete mt[Gt];delete Mt[Te.id]}}function je(){Ce(),v=!0,g!==h&&(g=h,I(g.object))}function Ce(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:r,reset:je,resetDefaultState:Ce,dispose:Ae,releaseStatesOfGeometry:Se,releaseStatesOfProgram:ze,initAttributes:re,enableAttribute:ie,disableUnusedAttributes:ae}}function hne(n,e,i){let l;function h(I){l=I}function g(I,z){n.drawArrays(l,I,z),i.update(z,l,1)}function v(I,z,N){N!==0&&(n.drawArraysInstanced(l,I,z,N),i.update(z,l,N))}function r(I,z,N){if(N===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(l,I,0,z,0,N);let j=0;for(let $=0;$<N;$++)j+=z[$];i.update(j,l,1)}function C(I,z,N,k){if(N===0)return;const j=e.get("WEBGL_multi_draw");if(j===null)for(let $=0;$<I.length;$++)v(I[$],z[$],k[$]);else{j.multiDrawArraysInstancedWEBGL(l,I,0,z,0,k,0,N);let $=0;for(let re=0;re<N;re++)$+=z[re]*k[re];i.update($,l,1)}}this.setMode=h,this.render=g,this.renderInstances=v,this.renderMultiDraw=r,this.renderMultiDrawInstances=C}function fne(n,e,i,l){let h;function g(){if(h!==void 0)return h;if(e.has("EXT_texture_filter_anisotropic")===!0){const ze=e.get("EXT_texture_filter_anisotropic");h=n.getParameter(ze.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else h=0;return h}function v(ze){return!(ze!==_h&&l.convert(ze)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function r(ze){const je=ze===r0&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(ze!==xh&&l.convert(ze)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&ze!==$h&&!je)}function C(ze){if(ze==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";ze="mediump"}return ze==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let I=i.precision!==void 0?i.precision:"highp";const z=C(I);z!==I&&(ir("WebGLRenderer:",I,"not supported, using",z,"instead."),I=z);const N=i.logarithmicDepthBuffer===!0,k=i.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),j=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),$=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),re=n.getParameter(n.MAX_TEXTURE_SIZE),ie=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),Y=n.getParameter(n.MAX_VERTEX_ATTRIBS),ae=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),ue=n.getParameter(n.MAX_VARYING_VECTORS),me=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),Ae=$>0,Se=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:g,getMaxPrecision:C,textureFormatReadable:v,textureTypeReadable:r,precision:I,logarithmicDepthBuffer:N,reversedDepthBuffer:k,maxTextures:j,maxVertexTextures:$,maxTextureSize:re,maxCubemapSize:ie,maxAttributes:Y,maxVertexUniforms:ae,maxVaryings:ue,maxFragmentUniforms:me,vertexTextures:Ae,maxSamples:Se}}function dne(n){const e=this;let i=null,l=0,h=!1,g=!1;const v=new j_,r=new Ps,C={value:null,needsUpdate:!1};this.uniform=C,this.numPlanes=0,this.numIntersection=0,this.init=function(N,k){const j=N.length!==0||k||l!==0||h;return h=k,l=N.length,j},this.beginShadows=function(){g=!0,z(null)},this.endShadows=function(){g=!1},this.setGlobalState=function(N,k){i=z(N,k,0)},this.setState=function(N,k,j){const $=N.clippingPlanes,re=N.clipIntersection,ie=N.clipShadows,Y=n.get(N);if(!h||$===null||$.length===0||g&&!ie)g?z(null):I();else{const ae=g?0:l,ue=ae*4;let me=Y.clippingState||null;C.value=me,me=z($,k,ue,j);for(let Ae=0;Ae!==ue;++Ae)me[Ae]=i[Ae];Y.clippingState=me,this.numIntersection=re?this.numPlanes:0,this.numPlanes+=ae}};function I(){C.value!==i&&(C.value=i,C.needsUpdate=l>0),e.numPlanes=l,e.numIntersection=0}function z(N,k,j,$){const re=N!==null?N.length:0;let ie=null;if(re!==0){if(ie=C.value,$!==!0||ie===null){const Y=j+re*4,ae=k.matrixWorldInverse;r.getNormalMatrix(ae),(ie===null||ie.length<Y)&&(ie=new Float32Array(Y));for(let ue=0,me=j;ue!==re;++ue,me+=4)v.copy(N[ue]).applyMatrix4(ae,r),v.normal.toArray(ie,me),ie[me+3]=v.constant}C.value=ie,C.needsUpdate=!0}return e.numPlanes=re,e.numIntersection=0,ie}}function pne(n){let e=new WeakMap;function i(v,r){return r===Bb?v.mapping=i_:r===Nb&&(v.mapping=e0),v}function l(v){if(v&&v.isTexture){const r=v.mapping;if(r===Bb||r===Nb)if(e.has(v)){const C=e.get(v).texture;return i(C,v.mapping)}else{const C=v.image;if(C&&C.height>0){const I=new J5(C.height);return I.fromEquirectangularTexture(n,v),e.set(v,I),v.addEventListener("dispose",h),i(I.texture,v.mapping)}else return null}}return v}function h(v){const r=v.target;r.removeEventListener("dispose",h);const C=e.get(r);C!==void 0&&(e.delete(r),C.dispose())}function g(){e=new WeakMap}return{get:l,dispose:g}}const $_=4,dN=[.125,.215,.35,.446,.526,.582],ny=20,mne=256,V1=new wv,pN=new ar;let P3=null,z3=0,O3=0,B3=!1;const gne=new gt;class vR{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,i=0,l=.1,h=100,g={}){const{size:v=256,position:r=gne}=g;P3=this._renderer.getRenderTarget(),z3=this._renderer.getActiveCubeFace(),O3=this._renderer.getActiveMipmapLevel(),B3=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(v);const C=this._allocateTargets();return C.depthBuffer=!0,this._sceneToCubeUV(e,l,h,C,r),i>0&&this._blur(C,0,0,i),this._applyPMREM(C),this._cleanup(C),C}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_N(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=gN(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(P3,z3,O3),this._renderer.xr.enabled=B3,e.scissorTest=!1,Dx(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===i_||e.mapping===e0?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),P3=this._renderer.getRenderTarget(),z3=this._renderer.getActiveCubeFace(),O3=this._renderer.getActiveMipmapLevel(),B3=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const l=i||this._allocateTargets();return this._textureToCubeUV(e,l),this._applyPMREM(l),this._cleanup(l),l}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,l={magFilter:Do,minFilter:Do,generateMipmaps:!1,type:r0,format:_h,colorSpace:pg,depthBuffer:!1},h=mN(e,i,l);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mN(e,i,l);const{_lodMax:g}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=_ne(g)),this._blurMaterial=xne(g,e,i)}return h}_compileMaterial(e){const i=new sc(new Is,e);this._renderer.compile(i,V1)}_sceneToCubeUV(e,i,l,h,g){const C=new Tc(90,1,i,l),I=[1,-1,1,1,1,1],z=[1,1,1,-1,-1,-1],N=this._renderer,k=N.autoClear,j=N.toneMapping;N.getClearColor(pN),N.toneMapping=Cm,N.autoClear=!1,N.state.buffers.depth.getReversed()&&(N.setRenderTarget(h),N.clearDepth(),N.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new sc(new Ay,new o0({name:"PMREM.Background",side:Mc,depthWrite:!1,depthTest:!1})));const re=this._backgroundBox,ie=re.material;let Y=!1;const ae=e.background;ae?ae.isColor&&(ie.color.copy(ae),e.background=null,Y=!0):(ie.color.copy(pN),Y=!0);for(let ue=0;ue<6;ue++){const me=ue%3;me===0?(C.up.set(0,I[ue],0),C.position.set(g.x,g.y,g.z),C.lookAt(g.x+z[ue],g.y,g.z)):me===1?(C.up.set(0,0,I[ue]),C.position.set(g.x,g.y,g.z),C.lookAt(g.x,g.y+z[ue],g.z)):(C.up.set(0,I[ue],0),C.position.set(g.x,g.y,g.z),C.lookAt(g.x,g.y,g.z+z[ue]));const Ae=this._cubeSize;Dx(h,me*Ae,ue>2?Ae:0,Ae,Ae),N.setRenderTarget(h),Y&&N.render(re,C),N.render(e,C)}N.toneMapping=j,N.autoClear=k,e.background=ae}_textureToCubeUV(e,i){const l=this._renderer,h=e.mapping===i_||e.mapping===e0;h?(this._cubemapMaterial===null&&(this._cubemapMaterial=_N()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=gN());const g=h?this._cubemapMaterial:this._equirectMaterial,v=this._lodMeshes[0];v.material=g;const r=g.uniforms;r.envMap.value=e;const C=this._cubeSize;Dx(i,0,0,3*C,2*C),l.setRenderTarget(i),l.render(v,V1)}_applyPMREM(e){const i=this._renderer,l=i.autoClear;i.autoClear=!1;const h=this._lodMeshes.length;for(let g=1;g<h;g++)this._applyGGXFilter(e,g-1,g);i.autoClear=l}_applyGGXFilter(e,i,l){const h=this._renderer,g=this._pingPongRenderTarget;if(this._ggxMaterial===null){const ae=3*Math.max(this._cubeSize,16),ue=4*this._cubeSize;this._ggxMaterial=yne(this._lodMax,ae,ue)}const v=this._ggxMaterial,r=this._lodMeshes[l];r.material=v;const C=v.uniforms,I=l/(this._lodMeshes.length-1),z=i/(this._lodMeshes.length-1),N=Math.sqrt(I*I-z*z),k=.05+I*.95,j=N*k,{_lodMax:$}=this,re=this._sizeLods[l],ie=3*re*(l>$-$_?l-$+$_:0),Y=4*(this._cubeSize-re);C.envMap.value=e.texture,C.roughness.value=j,C.mipInt.value=$-i,Dx(g,ie,Y,3*re,2*re),h.setRenderTarget(g),h.render(r,V1),C.envMap.value=g.texture,C.roughness.value=0,C.mipInt.value=$-l,Dx(e,ie,Y,3*re,2*re),h.setRenderTarget(e),h.render(r,V1)}_blur(e,i,l,h,g){const v=this._pingPongRenderTarget;this._halfBlur(e,v,i,l,h,"latitudinal",g),this._halfBlur(v,e,l,l,h,"longitudinal",g)}_halfBlur(e,i,l,h,g,v,r){const C=this._renderer,I=this._blurMaterial;v!=="latitudinal"&&v!=="longitudinal"&&ys("blur direction must be either latitudinal or longitudinal!");const z=3,N=this._lodMeshes[h];N.material=I;const k=I.uniforms,j=this._sizeLods[l]-1,$=isFinite(g)?Math.PI/(2*j):2*Math.PI/(2*ny-1),re=g/$,ie=isFinite(g)?1+Math.floor(z*re):ny;ie>ny&&ir(`sigmaRadians, ${g}, is too large and will clip, as it requested ${ie} samples when the maximum is set to ${ny}`);const Y=[];let ae=0;for(let ze=0;ze<ny;++ze){const je=ze/re,Ce=Math.exp(-je*je/2);Y.push(Ce),ze===0?ae+=Ce:ze<ie&&(ae+=2*Ce)}for(let ze=0;ze<Y.length;ze++)Y[ze]=Y[ze]/ae;k.envMap.value=e.texture,k.samples.value=ie,k.weights.value=Y,k.latitudinal.value=v==="latitudinal",r&&(k.poleAxis.value=r);const{_lodMax:ue}=this;k.dTheta.value=$,k.mipInt.value=ue-l;const me=this._sizeLods[h],Ae=3*me*(h>ue-$_?h-ue+$_:0),Se=4*(this._cubeSize-me);Dx(i,Ae,Se,3*me,2*me),C.setRenderTarget(i),C.render(N,V1)}}function _ne(n){const e=[],i=[],l=[];let h=n;const g=n-$_+1+dN.length;for(let v=0;v<g;v++){const r=Math.pow(2,h);e.push(r);let C=1/r;v>n-$_?C=dN[v-n+$_-1]:v===0&&(C=0),i.push(C);const I=1/(r-2),z=-I,N=1+I,k=[z,z,N,z,N,N,z,z,N,N,z,N],j=6,$=6,re=3,ie=2,Y=1,ae=new Float32Array(re*$*j),ue=new Float32Array(ie*$*j),me=new Float32Array(Y*$*j);for(let Se=0;Se<j;Se++){const ze=Se%3*2/3-1,je=Se>2?0:-1,Ce=[ze,je,0,ze+2/3,je,0,ze+2/3,je+1,0,ze,je,0,ze+2/3,je+1,0,ze,je+1,0];ae.set(Ce,re*$*Se),ue.set(k,ie*$*Se);const Te=[Se,Se,Se,Se,Se,Se];me.set(Te,Y*$*Se)}const Ae=new Is;Ae.setAttribute("position",new Ba(ae,re)),Ae.setAttribute("uv",new Ba(ue,ie)),Ae.setAttribute("faceIndex",new Ba(me,Y)),l.push(new sc(Ae,null)),h>$_&&h--}return{lodMeshes:l,sizeLods:e,sigmas:i}}function mN(n,e,i){const l=new vh(n,e,i);return l.texture.mapping=yv,l.texture.name="PMREM.cubeUv",l.scissorTest=!0,l}function Dx(n,e,i,l,h){n.viewport.set(e,i,l,h),n.scissor.set(e,i,l,h)}function yne(n,e,i){return new bh({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:mne,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:oE(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:kd,depthTest:!1,depthWrite:!1})}function xne(n,e,i){const l=new Float32Array(ny),h=new gt(0,1,0);return new bh({name:"SphericalGaussianBlur",defines:{n:ny,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:l},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:h}},vertexShader:oE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:kd,depthTest:!1,depthWrite:!1})}function gN(){return new bh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:oE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:kd,depthTest:!1,depthWrite:!1})}function _N(){return new bh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:oE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:kd,depthTest:!1,depthWrite:!1})}function oE(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function vne(n){let e=new WeakMap,i=null;function l(r){if(r&&r.isTexture){const C=r.mapping,I=C===Bb||C===Nb,z=C===i_||C===e0;if(I||z){let N=e.get(r);const k=N!==void 0?N.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==k)return i===null&&(i=new vR(n)),N=I?i.fromEquirectangular(r,N):i.fromCubemap(r,N),N.texture.pmremVersion=r.pmremVersion,e.set(r,N),N.texture;if(N!==void 0)return N.texture;{const j=r.image;return I&&j&&j.height>0||z&&j&&h(j)?(i===null&&(i=new vR(n)),N=I?i.fromEquirectangular(r):i.fromCubemap(r),N.texture.pmremVersion=r.pmremVersion,e.set(r,N),r.addEventListener("dispose",g),N.texture):null}}}return r}function h(r){let C=0;const I=6;for(let z=0;z<I;z++)r[z]!==void 0&&C++;return C===I}function g(r){const C=r.target;C.removeEventListener("dispose",g);const I=e.get(C);I!==void 0&&(e.delete(C),I.dispose())}function v(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:l,dispose:v}}function bne(n){const e={};function i(l){if(e[l]!==void 0)return e[l];const h=n.getExtension(l);return e[l]=h,h}return{has:function(l){return i(l)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(l){const h=i(l);return h===null&&sv("WebGLRenderer: "+l+" extension not supported."),h}}}function wne(n,e,i,l){const h={},g=new WeakMap;function v(N){const k=N.target;k.index!==null&&e.remove(k.index);for(const $ in k.attributes)e.remove(k.attributes[$]);k.removeEventListener("dispose",v),delete h[k.id];const j=g.get(k);j&&(e.remove(j),g.delete(k)),l.releaseStatesOfGeometry(k),k.isInstancedBufferGeometry===!0&&delete k._maxInstanceCount,i.memory.geometries--}function r(N,k){return h[k.id]===!0||(k.addEventListener("dispose",v),h[k.id]=!0,i.memory.geometries++),k}function C(N){const k=N.attributes;for(const j in k)e.update(k[j],n.ARRAY_BUFFER)}function I(N){const k=[],j=N.index,$=N.attributes.position;let re=0;if(j!==null){const ae=j.array;re=j.version;for(let ue=0,me=ae.length;ue<me;ue+=3){const Ae=ae[ue+0],Se=ae[ue+1],ze=ae[ue+2];k.push(Ae,Se,Se,ze,ze,Ae)}}else if($!==void 0){const ae=$.array;re=$.version;for(let ue=0,me=ae.length/3-1;ue<me;ue+=3){const Ae=ue+0,Se=ue+1,ze=ue+2;k.push(Ae,Se,Se,ze,ze,Ae)}}else return;const ie=new(q5(k)?zI:PI)(k,1);ie.version=re;const Y=g.get(N);Y&&e.remove(Y),g.set(N,ie)}function z(N){const k=g.get(N);if(k){const j=N.index;j!==null&&k.version<j.version&&I(N)}else I(N);return g.get(N)}return{get:r,update:C,getWireframeAttribute:z}}function Sne(n,e,i){let l;function h(k){l=k}let g,v;function r(k){g=k.type,v=k.bytesPerElement}function C(k,j){n.drawElements(l,j,g,k*v),i.update(j,l,1)}function I(k,j,$){$!==0&&(n.drawElementsInstanced(l,j,g,k*v,$),i.update(j,l,$))}function z(k,j,$){if($===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(l,j,0,g,k,0,$);let ie=0;for(let Y=0;Y<$;Y++)ie+=j[Y];i.update(ie,l,1)}function N(k,j,$,re){if($===0)return;const ie=e.get("WEBGL_multi_draw");if(ie===null)for(let Y=0;Y<k.length;Y++)I(k[Y]/v,j[Y],re[Y]);else{ie.multiDrawElementsInstancedWEBGL(l,j,0,g,k,0,re,0,$);let Y=0;for(let ae=0;ae<$;ae++)Y+=j[ae]*re[ae];i.update(Y,l,1)}}this.setMode=h,this.setIndex=r,this.render=C,this.renderInstances=I,this.renderMultiDraw=z,this.renderMultiDrawInstances=N}function Tne(n){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function l(g,v,r){switch(i.calls++,v){case n.TRIANGLES:i.triangles+=r*(g/3);break;case n.LINES:i.lines+=r*(g/2);break;case n.LINE_STRIP:i.lines+=r*(g-1);break;case n.LINE_LOOP:i.lines+=r*g;break;case n.POINTS:i.points+=r*g;break;default:ys("WebGLInfo: Unknown draw mode:",v);break}}function h(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:h,update:l}}function Mne(n,e,i){const l=new WeakMap,h=new xa;function g(v,r,C){const I=v.morphTargetInfluences,z=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,N=z!==void 0?z.length:0;let k=l.get(r);if(k===void 0||k.count!==N){let Ce=function(){ze.dispose(),l.delete(r),r.removeEventListener("dispose",Ce)};k!==void 0&&k.texture.dispose();const j=r.morphAttributes.position!==void 0,$=r.morphAttributes.normal!==void 0,re=r.morphAttributes.color!==void 0,ie=r.morphAttributes.position||[],Y=r.morphAttributes.normal||[],ae=r.morphAttributes.color||[];let ue=0;j===!0&&(ue=1),$===!0&&(ue=2),re===!0&&(ue=3);let me=r.attributes.position.count*ue,Ae=1;me>e.maxTextureSize&&(Ae=Math.ceil(me/e.maxTextureSize),me=e.maxTextureSize);const Se=new Float32Array(me*Ae*4*N),ze=new NM(Se,me,Ae,N);ze.type=$h,ze.needsUpdate=!0;const je=ue*4;for(let Te=0;Te<N;Te++){const Ze=ie[Te],Mt=Y[Te],mt=ae[Te],Gt=me*Ae*4*Te;for(let kt=0;kt<Ze.count;kt++){const Re=kt*je;j===!0&&(h.fromBufferAttribute(Ze,kt),Se[Gt+Re+0]=h.x,Se[Gt+Re+1]=h.y,Se[Gt+Re+2]=h.z,Se[Gt+Re+3]=0),$===!0&&(h.fromBufferAttribute(Mt,kt),Se[Gt+Re+4]=h.x,Se[Gt+Re+5]=h.y,Se[Gt+Re+6]=h.z,Se[Gt+Re+7]=0),re===!0&&(h.fromBufferAttribute(mt,kt),Se[Gt+Re+8]=h.x,Se[Gt+Re+9]=h.y,Se[Gt+Re+10]=h.z,Se[Gt+Re+11]=mt.itemSize===4?h.w:1)}}k={count:N,texture:ze,size:new $i(me,Ae)},l.set(r,k),r.addEventListener("dispose",Ce)}if(v.isInstancedMesh===!0&&v.morphTexture!==null)C.getUniforms().setValue(n,"morphTexture",v.morphTexture,i);else{let j=0;for(let re=0;re<I.length;re++)j+=I[re];const $=r.morphTargetsRelative?1:1-j;C.getUniforms().setValue(n,"morphTargetBaseInfluence",$),C.getUniforms().setValue(n,"morphTargetInfluences",I)}C.getUniforms().setValue(n,"morphTargetsTexture",k.texture,i),C.getUniforms().setValue(n,"morphTargetsTextureSize",k.size)}return{update:g}}function Ene(n,e,i,l){let h=new WeakMap;function g(C){const I=l.render.frame,z=C.geometry,N=e.get(C,z);if(h.get(N)!==I&&(e.update(N),h.set(N,I)),C.isInstancedMesh&&(C.hasEventListener("dispose",r)===!1&&C.addEventListener("dispose",r),h.get(C)!==I&&(i.update(C.instanceMatrix,n.ARRAY_BUFFER),C.instanceColor!==null&&i.update(C.instanceColor,n.ARRAY_BUFFER),h.set(C,I))),C.isSkinnedMesh){const k=C.skeleton;h.get(k)!==I&&(k.update(),h.set(k,I))}return N}function v(){h=new WeakMap}function r(C){const I=C.target;I.removeEventListener("dispose",r),i.remove(I.instanceMatrix),I.instanceColor!==null&&i.remove(I.instanceColor)}return{update:g,dispose:v}}const Kk=new Ho,yN=new XM(1,1),$k=new NM,Jk=new FM,Qk=new fw,xN=[],vN=[],bN=new Float32Array(16),wN=new Float32Array(9),SN=new Float32Array(4);function Sv(n,e,i){const l=n[0];if(l<=0||l>0)return n;const h=e*i;let g=xN[h];if(g===void 0&&(g=new Float32Array(h),xN[h]=g),e!==0){l.toArray(g,0);for(let v=1,r=0;v!==e;++v)r+=i,n[v].toArray(g,r)}return g}function Ec(n,e){if(n.length!==e.length)return!1;for(let i=0,l=n.length;i<l;i++)if(n[i]!==e[i])return!1;return!0}function Ac(n,e){for(let i=0,l=e.length;i<l;i++)n[i]=e[i]}function lE(n,e){let i=vN[e];i===void 0&&(i=new Int32Array(e),vN[e]=i);for(let l=0;l!==e;++l)i[l]=n.allocateTextureUnit();return i}function Ane(n,e){const i=this.cache;i[0]!==e&&(n.uniform1f(this.addr,e),i[0]=e)}function Cne(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ec(i,e))return;n.uniform2fv(this.addr,e),Ac(i,e)}}function Rne(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Ec(i,e))return;n.uniform3fv(this.addr,e),Ac(i,e)}}function Ine(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ec(i,e))return;n.uniform4fv(this.addr,e),Ac(i,e)}}function Dne(n,e){const i=this.cache,l=e.elements;if(l===void 0){if(Ec(i,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ac(i,e)}else{if(Ec(i,l))return;SN.set(l),n.uniformMatrix2fv(this.addr,!1,SN),Ac(i,l)}}function Lne(n,e){const i=this.cache,l=e.elements;if(l===void 0){if(Ec(i,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ac(i,e)}else{if(Ec(i,l))return;wN.set(l),n.uniformMatrix3fv(this.addr,!1,wN),Ac(i,l)}}function Pne(n,e){const i=this.cache,l=e.elements;if(l===void 0){if(Ec(i,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ac(i,e)}else{if(Ec(i,l))return;bN.set(l),n.uniformMatrix4fv(this.addr,!1,bN),Ac(i,l)}}function zne(n,e){const i=this.cache;i[0]!==e&&(n.uniform1i(this.addr,e),i[0]=e)}function One(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ec(i,e))return;n.uniform2iv(this.addr,e),Ac(i,e)}}function Bne(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Ec(i,e))return;n.uniform3iv(this.addr,e),Ac(i,e)}}function Nne(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ec(i,e))return;n.uniform4iv(this.addr,e),Ac(i,e)}}function Fne(n,e){const i=this.cache;i[0]!==e&&(n.uniform1ui(this.addr,e),i[0]=e)}function Une(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ec(i,e))return;n.uniform2uiv(this.addr,e),Ac(i,e)}}function kne(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Ec(i,e))return;n.uniform3uiv(this.addr,e),Ac(i,e)}}function Vne(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ec(i,e))return;n.uniform4uiv(this.addr,e),Ac(i,e)}}function Gne(n,e,i){const l=this.cache,h=i.allocateTextureUnit();l[0]!==h&&(n.uniform1i(this.addr,h),l[0]=h);let g;this.type===n.SAMPLER_2D_SHADOW?(yN.compareFunction=II,g=yN):g=Kk,i.setTexture2D(e||g,h)}function Hne(n,e,i){const l=this.cache,h=i.allocateTextureUnit();l[0]!==h&&(n.uniform1i(this.addr,h),l[0]=h),i.setTexture3D(e||Jk,h)}function jne(n,e,i){const l=this.cache,h=i.allocateTextureUnit();l[0]!==h&&(n.uniform1i(this.addr,h),l[0]=h),i.setTextureCube(e||Qk,h)}function qne(n,e,i){const l=this.cache,h=i.allocateTextureUnit();l[0]!==h&&(n.uniform1i(this.addr,h),l[0]=h),i.setTexture2DArray(e||$k,h)}function Xne(n){switch(n){case 5126:return Ane;case 35664:return Cne;case 35665:return Rne;case 35666:return Ine;case 35674:return Dne;case 35675:return Lne;case 35676:return Pne;case 5124:case 35670:return zne;case 35667:case 35671:return One;case 35668:case 35672:return Bne;case 35669:case 35673:return Nne;case 5125:return Fne;case 36294:return Une;case 36295:return kne;case 36296:return Vne;case 35678:case 36198:case 36298:case 36306:case 35682:return Gne;case 35679:case 36299:case 36307:return Hne;case 35680:case 36300:case 36308:case 36293:return jne;case 36289:case 36303:case 36311:case 36292:return qne}}function Wne(n,e){n.uniform1fv(this.addr,e)}function Zne(n,e){const i=Sv(e,this.size,2);n.uniform2fv(this.addr,i)}function Yne(n,e){const i=Sv(e,this.size,3);n.uniform3fv(this.addr,i)}function Kne(n,e){const i=Sv(e,this.size,4);n.uniform4fv(this.addr,i)}function $ne(n,e){const i=Sv(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,i)}function Jne(n,e){const i=Sv(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,i)}function Qne(n,e){const i=Sv(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,i)}function ere(n,e){n.uniform1iv(this.addr,e)}function tre(n,e){n.uniform2iv(this.addr,e)}function ire(n,e){n.uniform3iv(this.addr,e)}function nre(n,e){n.uniform4iv(this.addr,e)}function rre(n,e){n.uniform1uiv(this.addr,e)}function sre(n,e){n.uniform2uiv(this.addr,e)}function are(n,e){n.uniform3uiv(this.addr,e)}function ore(n,e){n.uniform4uiv(this.addr,e)}function lre(n,e,i){const l=this.cache,h=e.length,g=lE(i,h);Ec(l,g)||(n.uniform1iv(this.addr,g),Ac(l,g));for(let v=0;v!==h;++v)i.setTexture2D(e[v]||Kk,g[v])}function cre(n,e,i){const l=this.cache,h=e.length,g=lE(i,h);Ec(l,g)||(n.uniform1iv(this.addr,g),Ac(l,g));for(let v=0;v!==h;++v)i.setTexture3D(e[v]||Jk,g[v])}function ure(n,e,i){const l=this.cache,h=e.length,g=lE(i,h);Ec(l,g)||(n.uniform1iv(this.addr,g),Ac(l,g));for(let v=0;v!==h;++v)i.setTextureCube(e[v]||Qk,g[v])}function hre(n,e,i){const l=this.cache,h=e.length,g=lE(i,h);Ec(l,g)||(n.uniform1iv(this.addr,g),Ac(l,g));for(let v=0;v!==h;++v)i.setTexture2DArray(e[v]||$k,g[v])}function fre(n){switch(n){case 5126:return Wne;case 35664:return Zne;case 35665:return Yne;case 35666:return Kne;case 35674:return $ne;case 35675:return Jne;case 35676:return Qne;case 5124:case 35670:return ere;case 35667:case 35671:return tre;case 35668:case 35672:return ire;case 35669:case 35673:return nre;case 5125:return rre;case 36294:return sre;case 36295:return are;case 36296:return ore;case 35678:case 36198:case 36298:case 36306:case 35682:return lre;case 35679:case 36299:case 36307:return cre;case 35680:case 36300:case 36308:case 36293:return ure;case 36289:case 36303:case 36311:case 36292:return hre}}class dre{constructor(e,i,l){this.id=e,this.addr=l,this.cache=[],this.type=i.type,this.setValue=Xne(i.type)}}class pre{constructor(e,i,l){this.id=e,this.addr=l,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=fre(i.type)}}class mre{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,l){const h=this.seq;for(let g=0,v=h.length;g!==v;++g){const r=h[g];r.setValue(e,i[r.id],l)}}}const N3=/(\w+)(\])?(\[|\.)?/g;function TN(n,e){n.seq.push(e),n.map[e.id]=e}function gre(n,e,i){const l=n.name,h=l.length;for(N3.lastIndex=0;;){const g=N3.exec(l),v=N3.lastIndex;let r=g[1];const C=g[2]==="]",I=g[3];if(C&&(r=r|0),I===void 0||I==="["&&v+2===h){TN(i,I===void 0?new dre(r,n,e):new pre(r,n,e));break}else{let N=i.map[r];N===void 0&&(N=new mre(r),TN(i,N)),i=N}}}class GT{constructor(e,i){this.seq=[],this.map={};const l=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let h=0;h<l;++h){const g=e.getActiveUniform(i,h),v=e.getUniformLocation(i,g.name);gre(g,v,this)}}setValue(e,i,l,h){const g=this.map[i];g!==void 0&&g.setValue(e,l,h)}setOptional(e,i,l){const h=i[l];h!==void 0&&this.setValue(e,l,h)}static upload(e,i,l,h){for(let g=0,v=i.length;g!==v;++g){const r=i[g],C=l[r.id];C.needsUpdate!==!1&&r.setValue(e,C.value,h)}}static seqWithValue(e,i){const l=[];for(let h=0,g=e.length;h!==g;++h){const v=e[h];v.id in i&&l.push(v)}return l}}function MN(n,e,i){const l=n.createShader(e);return n.shaderSource(l,i),n.compileShader(l),l}const _re=37297;let yre=0;function xre(n,e){const i=n.split(`
`),l=[],h=Math.max(e-6,0),g=Math.min(e+6,i.length);for(let v=h;v<g;v++){const r=v+1;l.push(`${r===e?">":" "} ${r}: ${i[v]}`)}return l.join(`
`)}const EN=new Ps;function vre(n){oa._getMatrix(EN,oa.workingColorSpace,n);const e=`mat3( ${EN.elements.map(i=>i.toFixed(4))} )`;switch(oa.getTransfer(n)){case Gb:return[e,"LinearTransferOETF"];case Ha:return[e,"sRGBTransferOETF"];default:return ir("WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function AN(n,e,i){const l=n.getShaderParameter(e,n.COMPILE_STATUS),g=(n.getShaderInfoLog(e)||"").trim();if(l&&g==="")return"";const v=/ERROR: 0:(\d+)/.exec(g);if(v){const r=parseInt(v[1]);return i.toUpperCase()+`

`+g+`

`+xre(n.getShaderSource(e),r)}else return g}function bre(n,e){const i=vre(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function wre(n,e){let i;switch(e){case E5:i="Linear";break;case A5:i="Reinhard";break;case C5:i="Cineon";break;case bI:i="ACESFilmic";break;case I5:i="AgX";break;case D5:i="Neutral";break;case R5:i="Custom";break;default:ir("WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+n+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const MT=new gt;function Sre(){oa.getLuminanceCoefficients(MT);const n=MT.x.toFixed(4),e=MT.y.toFixed(4),i=MT.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Tre(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ib).join(`
`)}function Mre(n){const e=[];for(const i in n){const l=n[i];l!==!1&&e.push("#define "+i+" "+l)}return e.join(`
`)}function Ere(n,e){const i={},l=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let h=0;h<l;h++){const g=n.getActiveAttrib(e,h),v=g.name;let r=1;g.type===n.FLOAT_MAT2&&(r=2),g.type===n.FLOAT_MAT3&&(r=3),g.type===n.FLOAT_MAT4&&(r=4),i[v]={type:g.type,location:n.getAttribLocation(e,v),locationSize:r}}return i}function ib(n){return n!==""}function CN(n,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function RN(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Are=/^[ \t]*#include +<([\w\d./]+)>/gm;function bR(n){return n.replace(Are,Rre)}const Cre=new Map;function Rre(n,e){let i=Hs[e];if(i===void 0){const l=Cre.get(e);if(l!==void 0)i=Hs[l],ir('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,l);else throw new Error("Can not resolve #include <"+e+">")}return bR(i)}const Ire=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function IN(n){return n.replace(Ire,Dre)}function Dre(n,e,i,l){let h="";for(let g=parseInt(e);g<parseInt(i);g++)h+=l.replace(/\[\s*i\s*\]/g,"[ "+g+" ]").replace(/UNROLLED_LOOP_INDEX/g,g);return h}function DN(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Lre(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===AM?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===hb?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===bm&&(e="SHADOWMAP_TYPE_VSM"),e}function Pre(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case i_:case e0:e="ENVMAP_TYPE_CUBE";break;case yv:e="ENVMAP_TYPE_CUBE_UV";break}return e}function zre(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case e0:e="ENVMAP_MODE_REFRACTION";break}return e}function Ore(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case uw:e="ENVMAP_BLENDING_MULTIPLY";break;case T5:e="ENVMAP_BLENDING_MIX";break;case M5:e="ENVMAP_BLENDING_ADD";break}return e}function Bre(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,l=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:l,maxMip:i}}function Nre(n,e,i,l){const h=n.getContext(),g=i.defines;let v=i.vertexShader,r=i.fragmentShader;const C=Lre(i),I=Pre(i),z=zre(i),N=Ore(i),k=Bre(i),j=Tre(i),$=Mre(g),re=h.createProgram();let ie,Y,ae=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(ie=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$].filter(ib).join(`
`),ie.length>0&&(ie+=`
`),Y=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$].filter(ib).join(`
`),Y.length>0&&(Y+=`
`)):(ie=[DN(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+z:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+C:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",i.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ib).join(`
`),Y=[DN(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+I:"",i.envMap?"#define "+z:"",i.envMap?"#define "+N:"",k?"#define CUBEUV_TEXEL_WIDTH "+k.texelWidth:"",k?"#define CUBEUV_TEXEL_HEIGHT "+k.texelHeight:"",k?"#define CUBEUV_MAX_MIP "+k.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+C:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",i.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Cm?"#define TONE_MAPPING":"",i.toneMapping!==Cm?Hs.tonemapping_pars_fragment:"",i.toneMapping!==Cm?wre("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Hs.colorspace_pars_fragment,bre("linearToOutputTexel",i.outputColorSpace),Sre(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(ib).join(`
`)),v=bR(v),v=CN(v,i),v=RN(v,i),r=bR(r),r=CN(r,i),r=RN(r,i),v=IN(v),r=IN(r),i.isRawShaderMaterial!==!0&&(ae=`#version 300 es
`,ie=[j,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ie,Y=["#define varying in",i.glslVersion===fR?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===fR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Y);const ue=ae+ie+v,me=ae+Y+r,Ae=MN(h,h.VERTEX_SHADER,ue),Se=MN(h,h.FRAGMENT_SHADER,me);h.attachShader(re,Ae),h.attachShader(re,Se),i.index0AttributeName!==void 0?h.bindAttribLocation(re,0,i.index0AttributeName):i.morphTargets===!0&&h.bindAttribLocation(re,0,"position"),h.linkProgram(re);function ze(Ze){if(n.debug.checkShaderErrors){const Mt=h.getProgramInfoLog(re)||"",mt=h.getShaderInfoLog(Ae)||"",Gt=h.getShaderInfoLog(Se)||"",kt=Mt.trim(),Re=mt.trim(),Qe=Gt.trim();let et=!0,Lt=!0;if(h.getProgramParameter(re,h.LINK_STATUS)===!1)if(et=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(h,re,Ae,Se);else{const jt=AN(h,Ae,"vertex"),Ge=AN(h,Se,"fragment");ys("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(re,h.VALIDATE_STATUS)+`

Material Name: `+Ze.name+`
Material Type: `+Ze.type+`

Program Info Log: `+kt+`
`+jt+`
`+Ge)}else kt!==""?ir("WebGLProgram: Program Info Log:",kt):(Re===""||Qe==="")&&(Lt=!1);Lt&&(Ze.diagnostics={runnable:et,programLog:kt,vertexShader:{log:Re,prefix:ie},fragmentShader:{log:Qe,prefix:Y}})}h.deleteShader(Ae),h.deleteShader(Se),je=new GT(h,re),Ce=Ere(h,re)}let je;this.getUniforms=function(){return je===void 0&&ze(this),je};let Ce;this.getAttributes=function(){return Ce===void 0&&ze(this),Ce};let Te=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Te===!1&&(Te=h.getProgramParameter(re,_re)),Te},this.destroy=function(){l.releaseStatesOfProgram(this),h.deleteProgram(re),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=yre++,this.cacheKey=e,this.usedTimes=1,this.program=re,this.vertexShader=Ae,this.fragmentShader=Se,this}let Fre=0;class Ure{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,l=e.fragmentShader,h=this._getShaderStage(i),g=this._getShaderStage(l),v=this._getShaderCacheForMaterial(e);return v.has(h)===!1&&(v.add(h),h.usedTimes++),v.has(g)===!1&&(v.add(g),g.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const l of i)l.usedTimes--,l.usedTimes===0&&this.shaderCache.delete(l.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let l=i.get(e);return l===void 0&&(l=new Set,i.set(e,l)),l}_getShaderStage(e){const i=this.shaderCache;let l=i.get(e);return l===void 0&&(l=new kre(e),i.set(e,l)),l}}class kre{constructor(e){this.id=Fre++,this.code=e,this.usedTimes=0}}function Vre(n,e,i,l,h,g,v){const r=new ov,C=new Ure,I=new Set,z=[],N=h.logarithmicDepthBuffer,k=h.vertexTextures;let j=h.precision;const $={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function re(Ce){return I.add(Ce),Ce===0?"uv":`uv${Ce}`}function ie(Ce,Te,Ze,Mt,mt){const Gt=Mt.fog,kt=mt.geometry,Re=Ce.isMeshStandardMaterial?Mt.environment:null,Qe=(Ce.isMeshStandardMaterial?i:e).get(Ce.envMap||Re),et=Qe&&Qe.mapping===yv?Qe.image.height:null,Lt=$[Ce.type];Ce.precision!==null&&(j=h.getMaxPrecision(Ce.precision),j!==Ce.precision&&ir("WebGLProgram.getParameters:",Ce.precision,"not supported, using",j,"instead."));const jt=kt.morphAttributes.position||kt.morphAttributes.normal||kt.morphAttributes.color,Ge=jt!==void 0?jt.length:0;let Et=0;kt.morphAttributes.position!==void 0&&(Et=1),kt.morphAttributes.normal!==void 0&&(Et=2),kt.morphAttributes.color!==void 0&&(Et=3);let Vt,ii,ki,qt;if(Lt){const Ts=Sm[Lt];Vt=Ts.vertexShader,ii=Ts.fragmentShader}else Vt=Ce.vertexShader,ii=Ce.fragmentShader,C.update(Ce),ki=C.getVertexShaderID(Ce),qt=C.getFragmentShaderID(Ce);const xi=n.getRenderTarget(),Fi=n.state.buffers.depth.getReversed(),Ui=mt.isInstancedMesh===!0,rn=mt.isBatchedMesh===!0,Fn=!!Ce.map,Er=!!Ce.matcap,xn=!!Qe,Vi=!!Ce.aoMap,st=!!Ce.lightMap,Xi=!!Ce.bumpMap,Ji=!!Ce.normalMap,Di=!!Ce.displacementMap,tn=!!Ce.emissiveMap,Sn=!!Ce.metalnessMap,_n=!!Ce.roughnessMap,Gn=Ce.anisotropy>0,ot=Ce.clearcoat>0,De=Ce.dispersion>0,Qt=Ce.iridescence>0,Li=Ce.sheen>0,Wi=Ce.transmission>0,Ei=Gn&&!!Ce.anisotropyMap,Hn=ot&&!!Ce.clearcoatMap,An=ot&&!!Ce.clearcoatNormalMap,dr=ot&&!!Ce.clearcoatRoughnessMap,Jn=Qt&&!!Ce.iridescenceMap,Qi=Qt&&!!Ce.iridescenceThicknessMap,qi=Li&&!!Ce.sheenColorMap,Xn=Li&&!!Ce.sheenRoughnessMap,Qn=!!Ce.specularMap,Nn=!!Ce.specularColorMap,xr=!!Ce.specularIntensityMap,Rt=Wi&&!!Ce.transmissionMap,wn=Wi&&!!Ce.thicknessMap,vn=!!Ce.gradientMap,bn=!!Ce.alphaMap,Pi=Ce.alphaTest>0,zi=!!Ce.alphaHash,Kn=!!Ce.extensions;let Dr=Cm;Ce.toneMapped&&(xi===null||xi.isXRRenderTarget===!0)&&(Dr=n.toneMapping);const ls={shaderID:Lt,shaderType:Ce.type,shaderName:Ce.name,vertexShader:Vt,fragmentShader:ii,defines:Ce.defines,customVertexShaderID:ki,customFragmentShaderID:qt,isRawShaderMaterial:Ce.isRawShaderMaterial===!0,glslVersion:Ce.glslVersion,precision:j,batching:rn,batchingColor:rn&&mt._colorsTexture!==null,instancing:Ui,instancingColor:Ui&&mt.instanceColor!==null,instancingMorph:Ui&&mt.morphTexture!==null,supportsVertexTextures:k,outputColorSpace:xi===null?n.outputColorSpace:xi.isXRRenderTarget===!0?xi.texture.colorSpace:pg,alphaToCoverage:!!Ce.alphaToCoverage,map:Fn,matcap:Er,envMap:xn,envMapMode:xn&&Qe.mapping,envMapCubeUVHeight:et,aoMap:Vi,lightMap:st,bumpMap:Xi,normalMap:Ji,displacementMap:k&&Di,emissiveMap:tn,normalMapObjectSpace:Ji&&Ce.normalMapType===N5,normalMapTangentSpace:Ji&&Ce.normalMapType===a0,metalnessMap:Sn,roughnessMap:_n,anisotropy:Gn,anisotropyMap:Ei,clearcoat:ot,clearcoatMap:Hn,clearcoatNormalMap:An,clearcoatRoughnessMap:dr,dispersion:De,iridescence:Qt,iridescenceMap:Jn,iridescenceThicknessMap:Qi,sheen:Li,sheenColorMap:qi,sheenRoughnessMap:Xn,specularMap:Qn,specularColorMap:Nn,specularIntensityMap:xr,transmission:Wi,transmissionMap:Rt,thicknessMap:wn,gradientMap:vn,opaque:Ce.transparent===!1&&Ce.blending===dy&&Ce.alphaToCoverage===!1,alphaMap:bn,alphaTest:Pi,alphaHash:zi,combine:Ce.combine,mapUv:Fn&&re(Ce.map.channel),aoMapUv:Vi&&re(Ce.aoMap.channel),lightMapUv:st&&re(Ce.lightMap.channel),bumpMapUv:Xi&&re(Ce.bumpMap.channel),normalMapUv:Ji&&re(Ce.normalMap.channel),displacementMapUv:Di&&re(Ce.displacementMap.channel),emissiveMapUv:tn&&re(Ce.emissiveMap.channel),metalnessMapUv:Sn&&re(Ce.metalnessMap.channel),roughnessMapUv:_n&&re(Ce.roughnessMap.channel),anisotropyMapUv:Ei&&re(Ce.anisotropyMap.channel),clearcoatMapUv:Hn&&re(Ce.clearcoatMap.channel),clearcoatNormalMapUv:An&&re(Ce.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:dr&&re(Ce.clearcoatRoughnessMap.channel),iridescenceMapUv:Jn&&re(Ce.iridescenceMap.channel),iridescenceThicknessMapUv:Qi&&re(Ce.iridescenceThicknessMap.channel),sheenColorMapUv:qi&&re(Ce.sheenColorMap.channel),sheenRoughnessMapUv:Xn&&re(Ce.sheenRoughnessMap.channel),specularMapUv:Qn&&re(Ce.specularMap.channel),specularColorMapUv:Nn&&re(Ce.specularColorMap.channel),specularIntensityMapUv:xr&&re(Ce.specularIntensityMap.channel),transmissionMapUv:Rt&&re(Ce.transmissionMap.channel),thicknessMapUv:wn&&re(Ce.thicknessMap.channel),alphaMapUv:bn&&re(Ce.alphaMap.channel),vertexTangents:!!kt.attributes.tangent&&(Ji||Gn),vertexColors:Ce.vertexColors,vertexAlphas:Ce.vertexColors===!0&&!!kt.attributes.color&&kt.attributes.color.itemSize===4,pointsUvs:mt.isPoints===!0&&!!kt.attributes.uv&&(Fn||bn),fog:!!Gt,useFog:Ce.fog===!0,fogExp2:!!Gt&&Gt.isFogExp2,flatShading:Ce.flatShading===!0&&Ce.wireframe===!1,sizeAttenuation:Ce.sizeAttenuation===!0,logarithmicDepthBuffer:N,reversedDepthBuffer:Fi,skinning:mt.isSkinnedMesh===!0,morphTargets:kt.morphAttributes.position!==void 0,morphNormals:kt.morphAttributes.normal!==void 0,morphColors:kt.morphAttributes.color!==void 0,morphTargetsCount:Ge,morphTextureStride:Et,numDirLights:Te.directional.length,numPointLights:Te.point.length,numSpotLights:Te.spot.length,numSpotLightMaps:Te.spotLightMap.length,numRectAreaLights:Te.rectArea.length,numHemiLights:Te.hemi.length,numDirLightShadows:Te.directionalShadowMap.length,numPointLightShadows:Te.pointShadowMap.length,numSpotLightShadows:Te.spotShadowMap.length,numSpotLightShadowsWithMaps:Te.numSpotLightShadowsWithMaps,numLightProbes:Te.numLightProbes,numClippingPlanes:v.numPlanes,numClipIntersection:v.numIntersection,dithering:Ce.dithering,shadowMapEnabled:n.shadowMap.enabled&&Ze.length>0,shadowMapType:n.shadowMap.type,toneMapping:Dr,decodeVideoTexture:Fn&&Ce.map.isVideoTexture===!0&&oa.getTransfer(Ce.map.colorSpace)===Ha,decodeVideoTextureEmissive:tn&&Ce.emissiveMap.isVideoTexture===!0&&oa.getTransfer(Ce.emissiveMap.colorSpace)===Ha,premultipliedAlpha:Ce.premultipliedAlpha,doubleSided:Ce.side===jf,flipSided:Ce.side===Mc,useDepthPacking:Ce.depthPacking>=0,depthPacking:Ce.depthPacking||0,index0AttributeName:Ce.index0AttributeName,extensionClipCullDistance:Kn&&Ce.extensions.clipCullDistance===!0&&l.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Kn&&Ce.extensions.multiDraw===!0||rn)&&l.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:l.has("KHR_parallel_shader_compile"),customProgramCacheKey:Ce.customProgramCacheKey()};return ls.vertexUv1s=I.has(1),ls.vertexUv2s=I.has(2),ls.vertexUv3s=I.has(3),I.clear(),ls}function Y(Ce){const Te=[];if(Ce.shaderID?Te.push(Ce.shaderID):(Te.push(Ce.customVertexShaderID),Te.push(Ce.customFragmentShaderID)),Ce.defines!==void 0)for(const Ze in Ce.defines)Te.push(Ze),Te.push(Ce.defines[Ze]);return Ce.isRawShaderMaterial===!1&&(ae(Te,Ce),ue(Te,Ce),Te.push(n.outputColorSpace)),Te.push(Ce.customProgramCacheKey),Te.join()}function ae(Ce,Te){Ce.push(Te.precision),Ce.push(Te.outputColorSpace),Ce.push(Te.envMapMode),Ce.push(Te.envMapCubeUVHeight),Ce.push(Te.mapUv),Ce.push(Te.alphaMapUv),Ce.push(Te.lightMapUv),Ce.push(Te.aoMapUv),Ce.push(Te.bumpMapUv),Ce.push(Te.normalMapUv),Ce.push(Te.displacementMapUv),Ce.push(Te.emissiveMapUv),Ce.push(Te.metalnessMapUv),Ce.push(Te.roughnessMapUv),Ce.push(Te.anisotropyMapUv),Ce.push(Te.clearcoatMapUv),Ce.push(Te.clearcoatNormalMapUv),Ce.push(Te.clearcoatRoughnessMapUv),Ce.push(Te.iridescenceMapUv),Ce.push(Te.iridescenceThicknessMapUv),Ce.push(Te.sheenColorMapUv),Ce.push(Te.sheenRoughnessMapUv),Ce.push(Te.specularMapUv),Ce.push(Te.specularColorMapUv),Ce.push(Te.specularIntensityMapUv),Ce.push(Te.transmissionMapUv),Ce.push(Te.thicknessMapUv),Ce.push(Te.combine),Ce.push(Te.fogExp2),Ce.push(Te.sizeAttenuation),Ce.push(Te.morphTargetsCount),Ce.push(Te.morphAttributeCount),Ce.push(Te.numDirLights),Ce.push(Te.numPointLights),Ce.push(Te.numSpotLights),Ce.push(Te.numSpotLightMaps),Ce.push(Te.numHemiLights),Ce.push(Te.numRectAreaLights),Ce.push(Te.numDirLightShadows),Ce.push(Te.numPointLightShadows),Ce.push(Te.numSpotLightShadows),Ce.push(Te.numSpotLightShadowsWithMaps),Ce.push(Te.numLightProbes),Ce.push(Te.shadowMapType),Ce.push(Te.toneMapping),Ce.push(Te.numClippingPlanes),Ce.push(Te.numClipIntersection),Ce.push(Te.depthPacking)}function ue(Ce,Te){r.disableAll(),Te.supportsVertexTextures&&r.enable(0),Te.instancing&&r.enable(1),Te.instancingColor&&r.enable(2),Te.instancingMorph&&r.enable(3),Te.matcap&&r.enable(4),Te.envMap&&r.enable(5),Te.normalMapObjectSpace&&r.enable(6),Te.normalMapTangentSpace&&r.enable(7),Te.clearcoat&&r.enable(8),Te.iridescence&&r.enable(9),Te.alphaTest&&r.enable(10),Te.vertexColors&&r.enable(11),Te.vertexAlphas&&r.enable(12),Te.vertexUv1s&&r.enable(13),Te.vertexUv2s&&r.enable(14),Te.vertexUv3s&&r.enable(15),Te.vertexTangents&&r.enable(16),Te.anisotropy&&r.enable(17),Te.alphaHash&&r.enable(18),Te.batching&&r.enable(19),Te.dispersion&&r.enable(20),Te.batchingColor&&r.enable(21),Te.gradientMap&&r.enable(22),Ce.push(r.mask),r.disableAll(),Te.fog&&r.enable(0),Te.useFog&&r.enable(1),Te.flatShading&&r.enable(2),Te.logarithmicDepthBuffer&&r.enable(3),Te.reversedDepthBuffer&&r.enable(4),Te.skinning&&r.enable(5),Te.morphTargets&&r.enable(6),Te.morphNormals&&r.enable(7),Te.morphColors&&r.enable(8),Te.premultipliedAlpha&&r.enable(9),Te.shadowMapEnabled&&r.enable(10),Te.doubleSided&&r.enable(11),Te.flipSided&&r.enable(12),Te.useDepthPacking&&r.enable(13),Te.dithering&&r.enable(14),Te.transmission&&r.enable(15),Te.sheen&&r.enable(16),Te.opaque&&r.enable(17),Te.pointsUvs&&r.enable(18),Te.decodeVideoTexture&&r.enable(19),Te.decodeVideoTextureEmissive&&r.enable(20),Te.alphaToCoverage&&r.enable(21),Ce.push(r.mask)}function me(Ce){const Te=$[Ce.type];let Ze;if(Te){const Mt=Sm[Te];Ze=K5.clone(Mt.uniforms)}else Ze=Ce.uniforms;return Ze}function Ae(Ce,Te){let Ze;for(let Mt=0,mt=z.length;Mt<mt;Mt++){const Gt=z[Mt];if(Gt.cacheKey===Te){Ze=Gt,++Ze.usedTimes;break}}return Ze===void 0&&(Ze=new Nre(n,Te,Ce,g),z.push(Ze)),Ze}function Se(Ce){if(--Ce.usedTimes===0){const Te=z.indexOf(Ce);z[Te]=z[z.length-1],z.pop(),Ce.destroy()}}function ze(Ce){C.remove(Ce)}function je(){C.dispose()}return{getParameters:ie,getProgramCacheKey:Y,getUniforms:me,acquireProgram:Ae,releaseProgram:Se,releaseShaderCache:ze,programs:z,dispose:je}}function Gre(){let n=new WeakMap;function e(v){return n.has(v)}function i(v){let r=n.get(v);return r===void 0&&(r={},n.set(v,r)),r}function l(v){n.delete(v)}function h(v,r,C){n.get(v)[r]=C}function g(){n=new WeakMap}return{has:e,get:i,remove:l,update:h,dispose:g}}function Hre(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function LN(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function PN(){const n=[];let e=0;const i=[],l=[],h=[];function g(){e=0,i.length=0,l.length=0,h.length=0}function v(N,k,j,$,re,ie){let Y=n[e];return Y===void 0?(Y={id:N.id,object:N,geometry:k,material:j,groupOrder:$,renderOrder:N.renderOrder,z:re,group:ie},n[e]=Y):(Y.id=N.id,Y.object=N,Y.geometry=k,Y.material=j,Y.groupOrder=$,Y.renderOrder=N.renderOrder,Y.z=re,Y.group=ie),e++,Y}function r(N,k,j,$,re,ie){const Y=v(N,k,j,$,re,ie);j.transmission>0?l.push(Y):j.transparent===!0?h.push(Y):i.push(Y)}function C(N,k,j,$,re,ie){const Y=v(N,k,j,$,re,ie);j.transmission>0?l.unshift(Y):j.transparent===!0?h.unshift(Y):i.unshift(Y)}function I(N,k){i.length>1&&i.sort(N||Hre),l.length>1&&l.sort(k||LN),h.length>1&&h.sort(k||LN)}function z(){for(let N=e,k=n.length;N<k;N++){const j=n[N];if(j.id===null)break;j.id=null,j.object=null,j.geometry=null,j.material=null,j.group=null}}return{opaque:i,transmissive:l,transparent:h,init:g,push:r,unshift:C,finish:z,sort:I}}function jre(){let n=new WeakMap;function e(l,h){const g=n.get(l);let v;return g===void 0?(v=new PN,n.set(l,[v])):h>=g.length?(v=new PN,g.push(v)):v=g[h],v}function i(){n=new WeakMap}return{get:e,dispose:i}}function qre(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new gt,color:new ar};break;case"SpotLight":i={position:new gt,direction:new gt,color:new ar,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new gt,color:new ar,distance:0,decay:0};break;case"HemisphereLight":i={direction:new gt,skyColor:new ar,groundColor:new ar};break;case"RectAreaLight":i={color:new ar,position:new gt,halfWidth:new gt,halfHeight:new gt};break}return n[e.id]=i,i}}}function Xre(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $i};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $i};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $i,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=i,i}}}let Wre=0;function Zre(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Yre(n){const e=new qre,i=Xre(),l={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let I=0;I<9;I++)l.probe.push(new gt);const h=new gt,g=new ps,v=new ps;function r(I){let z=0,N=0,k=0;for(let Ce=0;Ce<9;Ce++)l.probe[Ce].set(0,0,0);let j=0,$=0,re=0,ie=0,Y=0,ae=0,ue=0,me=0,Ae=0,Se=0,ze=0;I.sort(Zre);for(let Ce=0,Te=I.length;Ce<Te;Ce++){const Ze=I[Ce],Mt=Ze.color,mt=Ze.intensity,Gt=Ze.distance,kt=Ze.shadow&&Ze.shadow.map?Ze.shadow.map.texture:null;if(Ze.isAmbientLight)z+=Mt.r*mt,N+=Mt.g*mt,k+=Mt.b*mt;else if(Ze.isLightProbe){for(let Re=0;Re<9;Re++)l.probe[Re].addScaledVector(Ze.sh.coefficients[Re],mt);ze++}else if(Ze.isDirectionalLight){const Re=e.get(Ze);if(Re.color.copy(Ze.color).multiplyScalar(Ze.intensity),Ze.castShadow){const Qe=Ze.shadow,et=i.get(Ze);et.shadowIntensity=Qe.intensity,et.shadowBias=Qe.bias,et.shadowNormalBias=Qe.normalBias,et.shadowRadius=Qe.radius,et.shadowMapSize=Qe.mapSize,l.directionalShadow[j]=et,l.directionalShadowMap[j]=kt,l.directionalShadowMatrix[j]=Ze.shadow.matrix,ae++}l.directional[j]=Re,j++}else if(Ze.isSpotLight){const Re=e.get(Ze);Re.position.setFromMatrixPosition(Ze.matrixWorld),Re.color.copy(Mt).multiplyScalar(mt),Re.distance=Gt,Re.coneCos=Math.cos(Ze.angle),Re.penumbraCos=Math.cos(Ze.angle*(1-Ze.penumbra)),Re.decay=Ze.decay,l.spot[re]=Re;const Qe=Ze.shadow;if(Ze.map&&(l.spotLightMap[Ae]=Ze.map,Ae++,Qe.updateMatrices(Ze),Ze.castShadow&&Se++),l.spotLightMatrix[re]=Qe.matrix,Ze.castShadow){const et=i.get(Ze);et.shadowIntensity=Qe.intensity,et.shadowBias=Qe.bias,et.shadowNormalBias=Qe.normalBias,et.shadowRadius=Qe.radius,et.shadowMapSize=Qe.mapSize,l.spotShadow[re]=et,l.spotShadowMap[re]=kt,me++}re++}else if(Ze.isRectAreaLight){const Re=e.get(Ze);Re.color.copy(Mt).multiplyScalar(mt),Re.halfWidth.set(Ze.width*.5,0,0),Re.halfHeight.set(0,Ze.height*.5,0),l.rectArea[ie]=Re,ie++}else if(Ze.isPointLight){const Re=e.get(Ze);if(Re.color.copy(Ze.color).multiplyScalar(Ze.intensity),Re.distance=Ze.distance,Re.decay=Ze.decay,Ze.castShadow){const Qe=Ze.shadow,et=i.get(Ze);et.shadowIntensity=Qe.intensity,et.shadowBias=Qe.bias,et.shadowNormalBias=Qe.normalBias,et.shadowRadius=Qe.radius,et.shadowMapSize=Qe.mapSize,et.shadowCameraNear=Qe.camera.near,et.shadowCameraFar=Qe.camera.far,l.pointShadow[$]=et,l.pointShadowMap[$]=kt,l.pointShadowMatrix[$]=Ze.shadow.matrix,ue++}l.point[$]=Re,$++}else if(Ze.isHemisphereLight){const Re=e.get(Ze);Re.skyColor.copy(Ze.color).multiplyScalar(mt),Re.groundColor.copy(Ze.groundColor).multiplyScalar(mt),l.hemi[Y]=Re,Y++}}ie>0&&(n.has("OES_texture_float_linear")===!0?(l.rectAreaLTC1=tr.LTC_FLOAT_1,l.rectAreaLTC2=tr.LTC_FLOAT_2):(l.rectAreaLTC1=tr.LTC_HALF_1,l.rectAreaLTC2=tr.LTC_HALF_2)),l.ambient[0]=z,l.ambient[1]=N,l.ambient[2]=k;const je=l.hash;(je.directionalLength!==j||je.pointLength!==$||je.spotLength!==re||je.rectAreaLength!==ie||je.hemiLength!==Y||je.numDirectionalShadows!==ae||je.numPointShadows!==ue||je.numSpotShadows!==me||je.numSpotMaps!==Ae||je.numLightProbes!==ze)&&(l.directional.length=j,l.spot.length=re,l.rectArea.length=ie,l.point.length=$,l.hemi.length=Y,l.directionalShadow.length=ae,l.directionalShadowMap.length=ae,l.pointShadow.length=ue,l.pointShadowMap.length=ue,l.spotShadow.length=me,l.spotShadowMap.length=me,l.directionalShadowMatrix.length=ae,l.pointShadowMatrix.length=ue,l.spotLightMatrix.length=me+Ae-Se,l.spotLightMap.length=Ae,l.numSpotLightShadowsWithMaps=Se,l.numLightProbes=ze,je.directionalLength=j,je.pointLength=$,je.spotLength=re,je.rectAreaLength=ie,je.hemiLength=Y,je.numDirectionalShadows=ae,je.numPointShadows=ue,je.numSpotShadows=me,je.numSpotMaps=Ae,je.numLightProbes=ze,l.version=Wre++)}function C(I,z){let N=0,k=0,j=0,$=0,re=0;const ie=z.matrixWorldInverse;for(let Y=0,ae=I.length;Y<ae;Y++){const ue=I[Y];if(ue.isDirectionalLight){const me=l.directional[N];me.direction.setFromMatrixPosition(ue.matrixWorld),h.setFromMatrixPosition(ue.target.matrixWorld),me.direction.sub(h),me.direction.transformDirection(ie),N++}else if(ue.isSpotLight){const me=l.spot[j];me.position.setFromMatrixPosition(ue.matrixWorld),me.position.applyMatrix4(ie),me.direction.setFromMatrixPosition(ue.matrixWorld),h.setFromMatrixPosition(ue.target.matrixWorld),me.direction.sub(h),me.direction.transformDirection(ie),j++}else if(ue.isRectAreaLight){const me=l.rectArea[$];me.position.setFromMatrixPosition(ue.matrixWorld),me.position.applyMatrix4(ie),v.identity(),g.copy(ue.matrixWorld),g.premultiply(ie),v.extractRotation(g),me.halfWidth.set(ue.width*.5,0,0),me.halfHeight.set(0,ue.height*.5,0),me.halfWidth.applyMatrix4(v),me.halfHeight.applyMatrix4(v),$++}else if(ue.isPointLight){const me=l.point[k];me.position.setFromMatrixPosition(ue.matrixWorld),me.position.applyMatrix4(ie),k++}else if(ue.isHemisphereLight){const me=l.hemi[re];me.direction.setFromMatrixPosition(ue.matrixWorld),me.direction.transformDirection(ie),re++}}}return{setup:r,setupView:C,state:l}}function zN(n){const e=new Yre(n),i=[],l=[];function h(z){I.camera=z,i.length=0,l.length=0}function g(z){i.push(z)}function v(z){l.push(z)}function r(){e.setup(i)}function C(z){e.setupView(i,z)}const I={lightsArray:i,shadowsArray:l,camera:null,lights:e,transmissionRenderTarget:{}};return{init:h,state:I,setupLights:r,setupLightsView:C,pushLight:g,pushShadow:v}}function Kre(n){let e=new WeakMap;function i(h,g=0){const v=e.get(h);let r;return v===void 0?(r=new zN(n),e.set(h,[r])):g>=v.length?(r=new zN(n),v.push(r)):r=v[g],r}function l(){e=new WeakMap}return{get:i,dispose:l}}const $re=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Jre=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Qre(n,e,i){let l=new vv;const h=new $i,g=new $i,v=new xa,r=new WI({depthPacking:B5}),C=new ZI,I={},z=i.maxTextureSize,N={[fg]:Mc,[Mc]:fg,[jf]:jf},k=new bh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $i},radius:{value:4}},vertexShader:$re,fragmentShader:Jre}),j=k.clone();j.defines.HORIZONTAL_PASS=1;const $=new Is;$.setAttribute("position",new Ba(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const re=new sc($,k),ie=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=AM;let Y=this.type;this.render=function(Se,ze,je){if(ie.enabled===!1||ie.autoUpdate===!1&&ie.needsUpdate===!1||Se.length===0)return;const Ce=n.getRenderTarget(),Te=n.getActiveCubeFace(),Ze=n.getActiveMipmapLevel(),Mt=n.state;Mt.setBlending(kd),Mt.buffers.depth.getReversed()===!0?Mt.buffers.color.setClear(0,0,0,0):Mt.buffers.color.setClear(1,1,1,1),Mt.buffers.depth.setTest(!0),Mt.setScissorTest(!1);const mt=Y!==bm&&this.type===bm,Gt=Y===bm&&this.type!==bm;for(let kt=0,Re=Se.length;kt<Re;kt++){const Qe=Se[kt],et=Qe.shadow;if(et===void 0){ir("WebGLShadowMap:",Qe,"has no shadow.");continue}if(et.autoUpdate===!1&&et.needsUpdate===!1)continue;h.copy(et.mapSize);const Lt=et.getFrameExtents();if(h.multiply(Lt),g.copy(et.mapSize),(h.x>z||h.y>z)&&(h.x>z&&(g.x=Math.floor(z/Lt.x),h.x=g.x*Lt.x,et.mapSize.x=g.x),h.y>z&&(g.y=Math.floor(z/Lt.y),h.y=g.y*Lt.y,et.mapSize.y=g.y)),et.map===null||mt===!0||Gt===!0){const Ge=this.type!==bm?{minFilter:Fl,magFilter:Fl}:{};et.map!==null&&et.map.dispose(),et.map=new vh(h.x,h.y,Ge),et.map.texture.name=Qe.name+".shadowMap",et.camera.updateProjectionMatrix()}n.setRenderTarget(et.map),n.clear();const jt=et.getViewportCount();for(let Ge=0;Ge<jt;Ge++){const Et=et.getViewport(Ge);v.set(g.x*Et.x,g.y*Et.y,g.x*Et.z,g.y*Et.w),Mt.viewport(v),et.updateMatrices(Qe,Ge),l=et.getFrustum(),me(ze,je,et.camera,Qe,this.type)}et.isPointLightShadow!==!0&&this.type===bm&&ae(et,je),et.needsUpdate=!1}Y=this.type,ie.needsUpdate=!1,n.setRenderTarget(Ce,Te,Ze)};function ae(Se,ze){const je=e.update(re);k.defines.VSM_SAMPLES!==Se.blurSamples&&(k.defines.VSM_SAMPLES=Se.blurSamples,j.defines.VSM_SAMPLES=Se.blurSamples,k.needsUpdate=!0,j.needsUpdate=!0),Se.mapPass===null&&(Se.mapPass=new vh(h.x,h.y)),k.uniforms.shadow_pass.value=Se.map.texture,k.uniforms.resolution.value=Se.mapSize,k.uniforms.radius.value=Se.radius,n.setRenderTarget(Se.mapPass),n.clear(),n.renderBufferDirect(ze,null,je,k,re,null),j.uniforms.shadow_pass.value=Se.mapPass.texture,j.uniforms.resolution.value=Se.mapSize,j.uniforms.radius.value=Se.radius,n.setRenderTarget(Se.map),n.clear(),n.renderBufferDirect(ze,null,je,j,re,null)}function ue(Se,ze,je,Ce){let Te=null;const Ze=je.isPointLight===!0?Se.customDistanceMaterial:Se.customDepthMaterial;if(Ze!==void 0)Te=Ze;else if(Te=je.isPointLight===!0?C:r,n.localClippingEnabled&&ze.clipShadows===!0&&Array.isArray(ze.clippingPlanes)&&ze.clippingPlanes.length!==0||ze.displacementMap&&ze.displacementScale!==0||ze.alphaMap&&ze.alphaTest>0||ze.map&&ze.alphaTest>0||ze.alphaToCoverage===!0){const Mt=Te.uuid,mt=ze.uuid;let Gt=I[Mt];Gt===void 0&&(Gt={},I[Mt]=Gt);let kt=Gt[mt];kt===void 0&&(kt=Te.clone(),Gt[mt]=kt,ze.addEventListener("dispose",Ae)),Te=kt}if(Te.visible=ze.visible,Te.wireframe=ze.wireframe,Ce===bm?Te.side=ze.shadowSide!==null?ze.shadowSide:ze.side:Te.side=ze.shadowSide!==null?ze.shadowSide:N[ze.side],Te.alphaMap=ze.alphaMap,Te.alphaTest=ze.alphaToCoverage===!0?.5:ze.alphaTest,Te.map=ze.map,Te.clipShadows=ze.clipShadows,Te.clippingPlanes=ze.clippingPlanes,Te.clipIntersection=ze.clipIntersection,Te.displacementMap=ze.displacementMap,Te.displacementScale=ze.displacementScale,Te.displacementBias=ze.displacementBias,Te.wireframeLinewidth=ze.wireframeLinewidth,Te.linewidth=ze.linewidth,je.isPointLight===!0&&Te.isMeshDistanceMaterial===!0){const Mt=n.properties.get(Te);Mt.light=je}return Te}function me(Se,ze,je,Ce,Te){if(Se.visible===!1)return;if(Se.layers.test(ze.layers)&&(Se.isMesh||Se.isLine||Se.isPoints)&&(Se.castShadow||Se.receiveShadow&&Te===bm)&&(!Se.frustumCulled||l.intersectsObject(Se))){Se.modelViewMatrix.multiplyMatrices(je.matrixWorldInverse,Se.matrixWorld);const mt=e.update(Se),Gt=Se.material;if(Array.isArray(Gt)){const kt=mt.groups;for(let Re=0,Qe=kt.length;Re<Qe;Re++){const et=kt[Re],Lt=Gt[et.materialIndex];if(Lt&&Lt.visible){const jt=ue(Se,Lt,Ce,Te);Se.onBeforeShadow(n,Se,ze,je,mt,jt,et),n.renderBufferDirect(je,null,mt,jt,Se,et),Se.onAfterShadow(n,Se,ze,je,mt,jt,et)}}}else if(Gt.visible){const kt=ue(Se,Gt,Ce,Te);Se.onBeforeShadow(n,Se,ze,je,mt,kt,null),n.renderBufferDirect(je,null,mt,kt,Se,null),Se.onAfterShadow(n,Se,ze,je,mt,kt,null)}}const Mt=Se.children;for(let mt=0,Gt=Mt.length;mt<Gt;mt++)me(Mt[mt],ze,je,Ce,Te)}function Ae(Se){Se.target.removeEventListener("dispose",Ae);for(const je in I){const Ce=I[je],Te=Se.target.uuid;Te in Ce&&(Ce[Te].dispose(),delete Ce[Te])}}}const ese={[R2]:Ob,[I2]:P2,[D2]:z2,[by]:L2,[Ob]:R2,[P2]:I2,[z2]:D2,[L2]:by};function tse(n,e){function i(){let Rt=!1;const wn=new xa;let vn=null;const bn=new xa(0,0,0,0);return{setMask:function(Pi){vn!==Pi&&!Rt&&(n.colorMask(Pi,Pi,Pi,Pi),vn=Pi)},setLocked:function(Pi){Rt=Pi},setClear:function(Pi,zi,Kn,Dr,ls){ls===!0&&(Pi*=Dr,zi*=Dr,Kn*=Dr),wn.set(Pi,zi,Kn,Dr),bn.equals(wn)===!1&&(n.clearColor(Pi,zi,Kn,Dr),bn.copy(wn))},reset:function(){Rt=!1,vn=null,bn.set(-1,0,0,0)}}}function l(){let Rt=!1,wn=!1,vn=null,bn=null,Pi=null;return{setReversed:function(zi){if(wn!==zi){const Kn=e.get("EXT_clip_control");zi?Kn.clipControlEXT(Kn.LOWER_LEFT_EXT,Kn.ZERO_TO_ONE_EXT):Kn.clipControlEXT(Kn.LOWER_LEFT_EXT,Kn.NEGATIVE_ONE_TO_ONE_EXT),wn=zi;const Dr=Pi;Pi=null,this.setClear(Dr)}},getReversed:function(){return wn},setTest:function(zi){zi?xi(n.DEPTH_TEST):Fi(n.DEPTH_TEST)},setMask:function(zi){vn!==zi&&!Rt&&(n.depthMask(zi),vn=zi)},setFunc:function(zi){if(wn&&(zi=ese[zi]),bn!==zi){switch(zi){case R2:n.depthFunc(n.NEVER);break;case Ob:n.depthFunc(n.ALWAYS);break;case I2:n.depthFunc(n.LESS);break;case by:n.depthFunc(n.LEQUAL);break;case D2:n.depthFunc(n.EQUAL);break;case L2:n.depthFunc(n.GEQUAL);break;case P2:n.depthFunc(n.GREATER);break;case z2:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}bn=zi}},setLocked:function(zi){Rt=zi},setClear:function(zi){Pi!==zi&&(wn&&(zi=1-zi),n.clearDepth(zi),Pi=zi)},reset:function(){Rt=!1,vn=null,bn=null,Pi=null,wn=!1}}}function h(){let Rt=!1,wn=null,vn=null,bn=null,Pi=null,zi=null,Kn=null,Dr=null,ls=null;return{setTest:function(Ts){Rt||(Ts?xi(n.STENCIL_TEST):Fi(n.STENCIL_TEST))},setMask:function(Ts){wn!==Ts&&!Rt&&(n.stencilMask(Ts),wn=Ts)},setFunc:function(Ts,Xt,ja){(vn!==Ts||bn!==Xt||Pi!==ja)&&(n.stencilFunc(Ts,Xt,ja),vn=Ts,bn=Xt,Pi=ja)},setOp:function(Ts,Xt,ja){(zi!==Ts||Kn!==Xt||Dr!==ja)&&(n.stencilOp(Ts,Xt,ja),zi=Ts,Kn=Xt,Dr=ja)},setLocked:function(Ts){Rt=Ts},setClear:function(Ts){ls!==Ts&&(n.clearStencil(Ts),ls=Ts)},reset:function(){Rt=!1,wn=null,vn=null,bn=null,Pi=null,zi=null,Kn=null,Dr=null,ls=null}}}const g=new i,v=new l,r=new h,C=new WeakMap,I=new WeakMap;let z={},N={},k=new WeakMap,j=[],$=null,re=!1,ie=null,Y=null,ae=null,ue=null,me=null,Ae=null,Se=null,ze=new ar(0,0,0),je=0,Ce=!1,Te=null,Ze=null,Mt=null,mt=null,Gt=null;const kt=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Re=!1,Qe=0;const et=n.getParameter(n.VERSION);et.indexOf("WebGL")!==-1?(Qe=parseFloat(/^WebGL (\d)/.exec(et)[1]),Re=Qe>=1):et.indexOf("OpenGL ES")!==-1&&(Qe=parseFloat(/^OpenGL ES (\d)/.exec(et)[1]),Re=Qe>=2);let Lt=null,jt={};const Ge=n.getParameter(n.SCISSOR_BOX),Et=n.getParameter(n.VIEWPORT),Vt=new xa().fromArray(Ge),ii=new xa().fromArray(Et);function ki(Rt,wn,vn,bn){const Pi=new Uint8Array(4),zi=n.createTexture();n.bindTexture(Rt,zi),n.texParameteri(Rt,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Rt,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Kn=0;Kn<vn;Kn++)Rt===n.TEXTURE_3D||Rt===n.TEXTURE_2D_ARRAY?n.texImage3D(wn,0,n.RGBA,1,1,bn,0,n.RGBA,n.UNSIGNED_BYTE,Pi):n.texImage2D(wn+Kn,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Pi);return zi}const qt={};qt[n.TEXTURE_2D]=ki(n.TEXTURE_2D,n.TEXTURE_2D,1),qt[n.TEXTURE_CUBE_MAP]=ki(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),qt[n.TEXTURE_2D_ARRAY]=ki(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),qt[n.TEXTURE_3D]=ki(n.TEXTURE_3D,n.TEXTURE_3D,1,1),g.setClear(0,0,0,1),v.setClear(1),r.setClear(0),xi(n.DEPTH_TEST),v.setFunc(by),Xi(!1),Ji(aR),xi(n.CULL_FACE),Vi(kd);function xi(Rt){z[Rt]!==!0&&(n.enable(Rt),z[Rt]=!0)}function Fi(Rt){z[Rt]!==!1&&(n.disable(Rt),z[Rt]=!1)}function Ui(Rt,wn){return N[Rt]!==wn?(n.bindFramebuffer(Rt,wn),N[Rt]=wn,Rt===n.DRAW_FRAMEBUFFER&&(N[n.FRAMEBUFFER]=wn),Rt===n.FRAMEBUFFER&&(N[n.DRAW_FRAMEBUFFER]=wn),!0):!1}function rn(Rt,wn){let vn=j,bn=!1;if(Rt){vn=k.get(wn),vn===void 0&&(vn=[],k.set(wn,vn));const Pi=Rt.textures;if(vn.length!==Pi.length||vn[0]!==n.COLOR_ATTACHMENT0){for(let zi=0,Kn=Pi.length;zi<Kn;zi++)vn[zi]=n.COLOR_ATTACHMENT0+zi;vn.length=Pi.length,bn=!0}}else vn[0]!==n.BACK&&(vn[0]=n.BACK,bn=!0);bn&&n.drawBuffers(vn)}function Fn(Rt){return $!==Rt?(n.useProgram(Rt),$=Rt,!0):!1}const Er={[X_]:n.FUNC_ADD,[o5]:n.FUNC_SUBTRACT,[l5]:n.FUNC_REVERSE_SUBTRACT};Er[c5]=n.MIN,Er[u5]=n.MAX;const xn={[h5]:n.ZERO,[f5]:n.ONE,[d5]:n.SRC_COLOR,[A2]:n.SRC_ALPHA,[x5]:n.SRC_ALPHA_SATURATE,[_5]:n.DST_COLOR,[m5]:n.DST_ALPHA,[p5]:n.ONE_MINUS_SRC_COLOR,[C2]:n.ONE_MINUS_SRC_ALPHA,[y5]:n.ONE_MINUS_DST_COLOR,[g5]:n.ONE_MINUS_DST_ALPHA,[v5]:n.CONSTANT_COLOR,[b5]:n.ONE_MINUS_CONSTANT_COLOR,[w5]:n.CONSTANT_ALPHA,[S5]:n.ONE_MINUS_CONSTANT_ALPHA};function Vi(Rt,wn,vn,bn,Pi,zi,Kn,Dr,ls,Ts){if(Rt===kd){re===!0&&(Fi(n.BLEND),re=!1);return}if(re===!1&&(xi(n.BLEND),re=!0),Rt!==a5){if(Rt!==ie||Ts!==Ce){if((Y!==X_||me!==X_)&&(n.blendEquation(n.FUNC_ADD),Y=X_,me=X_),Ts)switch(Rt){case dy:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case oR:n.blendFunc(n.ONE,n.ONE);break;case lR:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case cR:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:ys("WebGLState: Invalid blending: ",Rt);break}else switch(Rt){case dy:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case oR:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case lR:ys("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case cR:ys("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:ys("WebGLState: Invalid blending: ",Rt);break}ae=null,ue=null,Ae=null,Se=null,ze.set(0,0,0),je=0,ie=Rt,Ce=Ts}return}Pi=Pi||wn,zi=zi||vn,Kn=Kn||bn,(wn!==Y||Pi!==me)&&(n.blendEquationSeparate(Er[wn],Er[Pi]),Y=wn,me=Pi),(vn!==ae||bn!==ue||zi!==Ae||Kn!==Se)&&(n.blendFuncSeparate(xn[vn],xn[bn],xn[zi],xn[Kn]),ae=vn,ue=bn,Ae=zi,Se=Kn),(Dr.equals(ze)===!1||ls!==je)&&(n.blendColor(Dr.r,Dr.g,Dr.b,ls),ze.copy(Dr),je=ls),ie=Rt,Ce=!1}function st(Rt,wn){Rt.side===jf?Fi(n.CULL_FACE):xi(n.CULL_FACE);let vn=Rt.side===Mc;wn&&(vn=!vn),Xi(vn),Rt.blending===dy&&Rt.transparent===!1?Vi(kd):Vi(Rt.blending,Rt.blendEquation,Rt.blendSrc,Rt.blendDst,Rt.blendEquationAlpha,Rt.blendSrcAlpha,Rt.blendDstAlpha,Rt.blendColor,Rt.blendAlpha,Rt.premultipliedAlpha),v.setFunc(Rt.depthFunc),v.setTest(Rt.depthTest),v.setMask(Rt.depthWrite),g.setMask(Rt.colorWrite);const bn=Rt.stencilWrite;r.setTest(bn),bn&&(r.setMask(Rt.stencilWriteMask),r.setFunc(Rt.stencilFunc,Rt.stencilRef,Rt.stencilFuncMask),r.setOp(Rt.stencilFail,Rt.stencilZFail,Rt.stencilZPass)),tn(Rt.polygonOffset,Rt.polygonOffsetFactor,Rt.polygonOffsetUnits),Rt.alphaToCoverage===!0?xi(n.SAMPLE_ALPHA_TO_COVERAGE):Fi(n.SAMPLE_ALPHA_TO_COVERAGE)}function Xi(Rt){Te!==Rt&&(Rt?n.frontFace(n.CW):n.frontFace(n.CCW),Te=Rt)}function Ji(Rt){Rt!==n5?(xi(n.CULL_FACE),Rt!==Ze&&(Rt===aR?n.cullFace(n.BACK):Rt===r5?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Fi(n.CULL_FACE),Ze=Rt}function Di(Rt){Rt!==Mt&&(Re&&n.lineWidth(Rt),Mt=Rt)}function tn(Rt,wn,vn){Rt?(xi(n.POLYGON_OFFSET_FILL),(mt!==wn||Gt!==vn)&&(n.polygonOffset(wn,vn),mt=wn,Gt=vn)):Fi(n.POLYGON_OFFSET_FILL)}function Sn(Rt){Rt?xi(n.SCISSOR_TEST):Fi(n.SCISSOR_TEST)}function _n(Rt){Rt===void 0&&(Rt=n.TEXTURE0+kt-1),Lt!==Rt&&(n.activeTexture(Rt),Lt=Rt)}function Gn(Rt,wn,vn){vn===void 0&&(Lt===null?vn=n.TEXTURE0+kt-1:vn=Lt);let bn=jt[vn];bn===void 0&&(bn={type:void 0,texture:void 0},jt[vn]=bn),(bn.type!==Rt||bn.texture!==wn)&&(Lt!==vn&&(n.activeTexture(vn),Lt=vn),n.bindTexture(Rt,wn||qt[Rt]),bn.type=Rt,bn.texture=wn)}function ot(){const Rt=jt[Lt];Rt!==void 0&&Rt.type!==void 0&&(n.bindTexture(Rt.type,null),Rt.type=void 0,Rt.texture=void 0)}function De(){try{n.compressedTexImage2D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Qt(){try{n.compressedTexImage3D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Li(){try{n.texSubImage2D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Wi(){try{n.texSubImage3D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Ei(){try{n.compressedTexSubImage2D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Hn(){try{n.compressedTexSubImage3D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function An(){try{n.texStorage2D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function dr(){try{n.texStorage3D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Jn(){try{n.texImage2D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function Qi(){try{n.texImage3D(...arguments)}catch(Rt){Rt("WebGLState:",Rt)}}function qi(Rt){Vt.equals(Rt)===!1&&(n.scissor(Rt.x,Rt.y,Rt.z,Rt.w),Vt.copy(Rt))}function Xn(Rt){ii.equals(Rt)===!1&&(n.viewport(Rt.x,Rt.y,Rt.z,Rt.w),ii.copy(Rt))}function Qn(Rt,wn){let vn=I.get(wn);vn===void 0&&(vn=new WeakMap,I.set(wn,vn));let bn=vn.get(Rt);bn===void 0&&(bn=n.getUniformBlockIndex(wn,Rt.name),vn.set(Rt,bn))}function Nn(Rt,wn){const bn=I.get(wn).get(Rt);C.get(wn)!==bn&&(n.uniformBlockBinding(wn,bn,Rt.__bindingPointIndex),C.set(wn,bn))}function xr(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),v.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),z={},Lt=null,jt={},N={},k=new WeakMap,j=[],$=null,re=!1,ie=null,Y=null,ae=null,ue=null,me=null,Ae=null,Se=null,ze=new ar(0,0,0),je=0,Ce=!1,Te=null,Ze=null,Mt=null,mt=null,Gt=null,Vt.set(0,0,n.canvas.width,n.canvas.height),ii.set(0,0,n.canvas.width,n.canvas.height),g.reset(),v.reset(),r.reset()}return{buffers:{color:g,depth:v,stencil:r},enable:xi,disable:Fi,bindFramebuffer:Ui,drawBuffers:rn,useProgram:Fn,setBlending:Vi,setMaterial:st,setFlipSided:Xi,setCullFace:Ji,setLineWidth:Di,setPolygonOffset:tn,setScissorTest:Sn,activeTexture:_n,bindTexture:Gn,unbindTexture:ot,compressedTexImage2D:De,compressedTexImage3D:Qt,texImage2D:Jn,texImage3D:Qi,updateUBOMapping:Qn,uniformBlockBinding:Nn,texStorage2D:An,texStorage3D:dr,texSubImage2D:Li,texSubImage3D:Wi,compressedTexSubImage2D:Ei,compressedTexSubImage3D:Hn,scissor:qi,viewport:Xn,reset:xr}}function ise(n,e,i,l,h,g,v){const r=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,C=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),I=new $i,z=new WeakMap;let N;const k=new WeakMap;let j=!1;try{j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function $(ot,De){return j?new OffscreenCanvas(ot,De):jb("canvas")}function re(ot,De,Qt){let Li=1;const Wi=Gn(ot);if((Wi.width>Qt||Wi.height>Qt)&&(Li=Qt/Math.max(Wi.width,Wi.height)),Li<1)if(typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ot instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ot instanceof ImageBitmap||typeof VideoFrame<"u"&&ot instanceof VideoFrame){const Ei=Math.floor(Li*Wi.width),Hn=Math.floor(Li*Wi.height);N===void 0&&(N=$(Ei,Hn));const An=De?$(Ei,Hn):N;return An.width=Ei,An.height=Hn,An.getContext("2d").drawImage(ot,0,0,Ei,Hn),ir("WebGLRenderer: Texture has been resized from ("+Wi.width+"x"+Wi.height+") to ("+Ei+"x"+Hn+")."),An}else return"data"in ot&&ir("WebGLRenderer: Image in DataTexture is too big ("+Wi.width+"x"+Wi.height+")."),ot;return ot}function ie(ot){return ot.generateMipmaps}function Y(ot){n.generateMipmap(ot)}function ae(ot){return ot.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:ot.isWebGL3DRenderTarget?n.TEXTURE_3D:ot.isWebGLArrayRenderTarget||ot.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function ue(ot,De,Qt,Li,Wi=!1){if(ot!==null){if(n[ot]!==void 0)return n[ot];ir("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ot+"'")}let Ei=De;if(De===n.RED&&(Qt===n.FLOAT&&(Ei=n.R32F),Qt===n.HALF_FLOAT&&(Ei=n.R16F),Qt===n.UNSIGNED_BYTE&&(Ei=n.R8)),De===n.RED_INTEGER&&(Qt===n.UNSIGNED_BYTE&&(Ei=n.R8UI),Qt===n.UNSIGNED_SHORT&&(Ei=n.R16UI),Qt===n.UNSIGNED_INT&&(Ei=n.R32UI),Qt===n.BYTE&&(Ei=n.R8I),Qt===n.SHORT&&(Ei=n.R16I),Qt===n.INT&&(Ei=n.R32I)),De===n.RG&&(Qt===n.FLOAT&&(Ei=n.RG32F),Qt===n.HALF_FLOAT&&(Ei=n.RG16F),Qt===n.UNSIGNED_BYTE&&(Ei=n.RG8)),De===n.RG_INTEGER&&(Qt===n.UNSIGNED_BYTE&&(Ei=n.RG8UI),Qt===n.UNSIGNED_SHORT&&(Ei=n.RG16UI),Qt===n.UNSIGNED_INT&&(Ei=n.RG32UI),Qt===n.BYTE&&(Ei=n.RG8I),Qt===n.SHORT&&(Ei=n.RG16I),Qt===n.INT&&(Ei=n.RG32I)),De===n.RGB_INTEGER&&(Qt===n.UNSIGNED_BYTE&&(Ei=n.RGB8UI),Qt===n.UNSIGNED_SHORT&&(Ei=n.RGB16UI),Qt===n.UNSIGNED_INT&&(Ei=n.RGB32UI),Qt===n.BYTE&&(Ei=n.RGB8I),Qt===n.SHORT&&(Ei=n.RGB16I),Qt===n.INT&&(Ei=n.RGB32I)),De===n.RGBA_INTEGER&&(Qt===n.UNSIGNED_BYTE&&(Ei=n.RGBA8UI),Qt===n.UNSIGNED_SHORT&&(Ei=n.RGBA16UI),Qt===n.UNSIGNED_INT&&(Ei=n.RGBA32UI),Qt===n.BYTE&&(Ei=n.RGBA8I),Qt===n.SHORT&&(Ei=n.RGBA16I),Qt===n.INT&&(Ei=n.RGBA32I)),De===n.RGB&&(Qt===n.UNSIGNED_INT_5_9_9_9_REV&&(Ei=n.RGB9_E5),Qt===n.UNSIGNED_INT_10F_11F_11F_REV&&(Ei=n.R11F_G11F_B10F)),De===n.RGBA){const Hn=Wi?Gb:oa.getTransfer(Li);Qt===n.FLOAT&&(Ei=n.RGBA32F),Qt===n.HALF_FLOAT&&(Ei=n.RGBA16F),Qt===n.UNSIGNED_BYTE&&(Ei=Hn===Ha?n.SRGB8_ALPHA8:n.RGBA8),Qt===n.UNSIGNED_SHORT_4_4_4_4&&(Ei=n.RGBA4),Qt===n.UNSIGNED_SHORT_5_5_5_1&&(Ei=n.RGB5_A1)}return(Ei===n.R16F||Ei===n.R32F||Ei===n.RG16F||Ei===n.RG32F||Ei===n.RGBA16F||Ei===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Ei}function me(ot,De){let Qt;return ot?De===null||De===dg||De===wy?Qt=n.DEPTH24_STENCIL8:De===$h?Qt=n.DEPTH32F_STENCIL8:De===iv&&(Qt=n.DEPTH24_STENCIL8,ir("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):De===null||De===dg||De===wy?Qt=n.DEPTH_COMPONENT24:De===$h?Qt=n.DEPTH_COMPONENT32F:De===iv&&(Qt=n.DEPTH_COMPONENT16),Qt}function Ae(ot,De){return ie(ot)===!0||ot.isFramebufferTexture&&ot.minFilter!==Fl&&ot.minFilter!==Do?Math.log2(Math.max(De.width,De.height))+1:ot.mipmaps!==void 0&&ot.mipmaps.length>0?ot.mipmaps.length:ot.isCompressedTexture&&Array.isArray(ot.image)?De.mipmaps.length:1}function Se(ot){const De=ot.target;De.removeEventListener("dispose",Se),je(De),De.isVideoTexture&&z.delete(De)}function ze(ot){const De=ot.target;De.removeEventListener("dispose",ze),Te(De)}function je(ot){const De=l.get(ot);if(De.__webglInit===void 0)return;const Qt=ot.source,Li=k.get(Qt);if(Li){const Wi=Li[De.__cacheKey];Wi.usedTimes--,Wi.usedTimes===0&&Ce(ot),Object.keys(Li).length===0&&k.delete(Qt)}l.remove(ot)}function Ce(ot){const De=l.get(ot);n.deleteTexture(De.__webglTexture);const Qt=ot.source,Li=k.get(Qt);delete Li[De.__cacheKey],v.memory.textures--}function Te(ot){const De=l.get(ot);if(ot.depthTexture&&(ot.depthTexture.dispose(),l.remove(ot.depthTexture)),ot.isWebGLCubeRenderTarget)for(let Li=0;Li<6;Li++){if(Array.isArray(De.__webglFramebuffer[Li]))for(let Wi=0;Wi<De.__webglFramebuffer[Li].length;Wi++)n.deleteFramebuffer(De.__webglFramebuffer[Li][Wi]);else n.deleteFramebuffer(De.__webglFramebuffer[Li]);De.__webglDepthbuffer&&n.deleteRenderbuffer(De.__webglDepthbuffer[Li])}else{if(Array.isArray(De.__webglFramebuffer))for(let Li=0;Li<De.__webglFramebuffer.length;Li++)n.deleteFramebuffer(De.__webglFramebuffer[Li]);else n.deleteFramebuffer(De.__webglFramebuffer);if(De.__webglDepthbuffer&&n.deleteRenderbuffer(De.__webglDepthbuffer),De.__webglMultisampledFramebuffer&&n.deleteFramebuffer(De.__webglMultisampledFramebuffer),De.__webglColorRenderbuffer)for(let Li=0;Li<De.__webglColorRenderbuffer.length;Li++)De.__webglColorRenderbuffer[Li]&&n.deleteRenderbuffer(De.__webglColorRenderbuffer[Li]);De.__webglDepthRenderbuffer&&n.deleteRenderbuffer(De.__webglDepthRenderbuffer)}const Qt=ot.textures;for(let Li=0,Wi=Qt.length;Li<Wi;Li++){const Ei=l.get(Qt[Li]);Ei.__webglTexture&&(n.deleteTexture(Ei.__webglTexture),v.memory.textures--),l.remove(Qt[Li])}l.remove(ot)}let Ze=0;function Mt(){Ze=0}function mt(){const ot=Ze;return ot>=h.maxTextures&&ir("WebGLTextures: Trying to use "+ot+" texture units while this GPU supports only "+h.maxTextures),Ze+=1,ot}function Gt(ot){const De=[];return De.push(ot.wrapS),De.push(ot.wrapT),De.push(ot.wrapR||0),De.push(ot.magFilter),De.push(ot.minFilter),De.push(ot.anisotropy),De.push(ot.internalFormat),De.push(ot.format),De.push(ot.type),De.push(ot.generateMipmaps),De.push(ot.premultiplyAlpha),De.push(ot.flipY),De.push(ot.unpackAlignment),De.push(ot.colorSpace),De.join()}function kt(ot,De){const Qt=l.get(ot);if(ot.isVideoTexture&&Sn(ot),ot.isRenderTargetTexture===!1&&ot.isExternalTexture!==!0&&ot.version>0&&Qt.__version!==ot.version){const Li=ot.image;if(Li===null)ir("WebGLRenderer: Texture marked for update but no image data found.");else if(Li.complete===!1)ir("WebGLRenderer: Texture marked for update but image is incomplete");else{qt(Qt,ot,De);return}}else ot.isExternalTexture&&(Qt.__webglTexture=ot.sourceTexture?ot.sourceTexture:null);i.bindTexture(n.TEXTURE_2D,Qt.__webglTexture,n.TEXTURE0+De)}function Re(ot,De){const Qt=l.get(ot);if(ot.isRenderTargetTexture===!1&&ot.version>0&&Qt.__version!==ot.version){qt(Qt,ot,De);return}else ot.isExternalTexture&&(Qt.__webglTexture=ot.sourceTexture?ot.sourceTexture:null);i.bindTexture(n.TEXTURE_2D_ARRAY,Qt.__webglTexture,n.TEXTURE0+De)}function Qe(ot,De){const Qt=l.get(ot);if(ot.isRenderTargetTexture===!1&&ot.version>0&&Qt.__version!==ot.version){qt(Qt,ot,De);return}i.bindTexture(n.TEXTURE_3D,Qt.__webglTexture,n.TEXTURE0+De)}function et(ot,De){const Qt=l.get(ot);if(ot.version>0&&Qt.__version!==ot.version){xi(Qt,ot,De);return}i.bindTexture(n.TEXTURE_CUBE_MAP,Qt.__webglTexture,n.TEXTURE0+De)}const Lt={[Fb]:n.REPEAT,[Zf]:n.CLAMP_TO_EDGE,[Ub]:n.MIRRORED_REPEAT},jt={[Fl]:n.NEAREST,[wI]:n.NEAREST_MIPMAP_NEAREST,[Vx]:n.NEAREST_MIPMAP_LINEAR,[Do]:n.LINEAR,[fb]:n.LINEAR_MIPMAP_NEAREST,[og]:n.LINEAR_MIPMAP_LINEAR},Ge={[F5]:n.NEVER,[j5]:n.ALWAYS,[U5]:n.LESS,[II]:n.LEQUAL,[k5]:n.EQUAL,[H5]:n.GEQUAL,[V5]:n.GREATER,[G5]:n.NOTEQUAL};function Et(ot,De){if(De.type===$h&&e.has("OES_texture_float_linear")===!1&&(De.magFilter===Do||De.magFilter===fb||De.magFilter===Vx||De.magFilter===og||De.minFilter===Do||De.minFilter===fb||De.minFilter===Vx||De.minFilter===og)&&ir("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(ot,n.TEXTURE_WRAP_S,Lt[De.wrapS]),n.texParameteri(ot,n.TEXTURE_WRAP_T,Lt[De.wrapT]),(ot===n.TEXTURE_3D||ot===n.TEXTURE_2D_ARRAY)&&n.texParameteri(ot,n.TEXTURE_WRAP_R,Lt[De.wrapR]),n.texParameteri(ot,n.TEXTURE_MAG_FILTER,jt[De.magFilter]),n.texParameteri(ot,n.TEXTURE_MIN_FILTER,jt[De.minFilter]),De.compareFunction&&(n.texParameteri(ot,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(ot,n.TEXTURE_COMPARE_FUNC,Ge[De.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(De.magFilter===Fl||De.minFilter!==Vx&&De.minFilter!==og||De.type===$h&&e.has("OES_texture_float_linear")===!1)return;if(De.anisotropy>1||l.get(De).__currentAnisotropy){const Qt=e.get("EXT_texture_filter_anisotropic");n.texParameterf(ot,Qt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(De.anisotropy,h.getMaxAnisotropy())),l.get(De).__currentAnisotropy=De.anisotropy}}}function Vt(ot,De){let Qt=!1;ot.__webglInit===void 0&&(ot.__webglInit=!0,De.addEventListener("dispose",Se));const Li=De.source;let Wi=k.get(Li);Wi===void 0&&(Wi={},k.set(Li,Wi));const Ei=Gt(De);if(Ei!==ot.__cacheKey){Wi[Ei]===void 0&&(Wi[Ei]={texture:n.createTexture(),usedTimes:0},v.memory.textures++,Qt=!0),Wi[Ei].usedTimes++;const Hn=Wi[ot.__cacheKey];Hn!==void 0&&(Wi[ot.__cacheKey].usedTimes--,Hn.usedTimes===0&&Ce(De)),ot.__cacheKey=Ei,ot.__webglTexture=Wi[Ei].texture}return Qt}function ii(ot,De,Qt){return Math.floor(Math.floor(ot/Qt)/De)}function ki(ot,De,Qt,Li){const Ei=ot.updateRanges;if(Ei.length===0)i.texSubImage2D(n.TEXTURE_2D,0,0,0,De.width,De.height,Qt,Li,De.data);else{Ei.sort((Qi,qi)=>Qi.start-qi.start);let Hn=0;for(let Qi=1;Qi<Ei.length;Qi++){const qi=Ei[Hn],Xn=Ei[Qi],Qn=qi.start+qi.count,Nn=ii(Xn.start,De.width,4),xr=ii(qi.start,De.width,4);Xn.start<=Qn+1&&Nn===xr&&ii(Xn.start+Xn.count-1,De.width,4)===Nn?qi.count=Math.max(qi.count,Xn.start+Xn.count-qi.start):(++Hn,Ei[Hn]=Xn)}Ei.length=Hn+1;const An=n.getParameter(n.UNPACK_ROW_LENGTH),dr=n.getParameter(n.UNPACK_SKIP_PIXELS),Jn=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,De.width);for(let Qi=0,qi=Ei.length;Qi<qi;Qi++){const Xn=Ei[Qi],Qn=Math.floor(Xn.start/4),Nn=Math.ceil(Xn.count/4),xr=Qn%De.width,Rt=Math.floor(Qn/De.width),wn=Nn,vn=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,xr),n.pixelStorei(n.UNPACK_SKIP_ROWS,Rt),i.texSubImage2D(n.TEXTURE_2D,0,xr,Rt,wn,vn,Qt,Li,De.data)}ot.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,An),n.pixelStorei(n.UNPACK_SKIP_PIXELS,dr),n.pixelStorei(n.UNPACK_SKIP_ROWS,Jn)}}function qt(ot,De,Qt){let Li=n.TEXTURE_2D;(De.isDataArrayTexture||De.isCompressedArrayTexture)&&(Li=n.TEXTURE_2D_ARRAY),De.isData3DTexture&&(Li=n.TEXTURE_3D);const Wi=Vt(ot,De),Ei=De.source;i.bindTexture(Li,ot.__webglTexture,n.TEXTURE0+Qt);const Hn=l.get(Ei);if(Ei.version!==Hn.__version||Wi===!0){i.activeTexture(n.TEXTURE0+Qt);const An=oa.getPrimaries(oa.workingColorSpace),dr=De.colorSpace===Mm?null:oa.getPrimaries(De.colorSpace),Jn=De.colorSpace===Mm||An===dr?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,De.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,De.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Jn);let Qi=re(De.image,!1,h.maxTextureSize);Qi=_n(De,Qi);const qi=g.convert(De.format,De.colorSpace),Xn=g.convert(De.type);let Qn=ue(De.internalFormat,qi,Xn,De.colorSpace,De.isVideoTexture);Et(Li,De);let Nn;const xr=De.mipmaps,Rt=De.isVideoTexture!==!0,wn=Hn.__version===void 0||Wi===!0,vn=Ei.dataReady,bn=Ae(De,Qi);if(De.isDepthTexture)Qn=me(De.format===Sy,De.type),wn&&(Rt?i.texStorage2D(n.TEXTURE_2D,1,Qn,Qi.width,Qi.height):i.texImage2D(n.TEXTURE_2D,0,Qn,Qi.width,Qi.height,0,qi,Xn,null));else if(De.isDataTexture)if(xr.length>0){Rt&&wn&&i.texStorage2D(n.TEXTURE_2D,bn,Qn,xr[0].width,xr[0].height);for(let Pi=0,zi=xr.length;Pi<zi;Pi++)Nn=xr[Pi],Rt?vn&&i.texSubImage2D(n.TEXTURE_2D,Pi,0,0,Nn.width,Nn.height,qi,Xn,Nn.data):i.texImage2D(n.TEXTURE_2D,Pi,Qn,Nn.width,Nn.height,0,qi,Xn,Nn.data);De.generateMipmaps=!1}else Rt?(wn&&i.texStorage2D(n.TEXTURE_2D,bn,Qn,Qi.width,Qi.height),vn&&ki(De,Qi,qi,Xn)):i.texImage2D(n.TEXTURE_2D,0,Qn,Qi.width,Qi.height,0,qi,Xn,Qi.data);else if(De.isCompressedTexture)if(De.isCompressedArrayTexture){Rt&&wn&&i.texStorage3D(n.TEXTURE_2D_ARRAY,bn,Qn,xr[0].width,xr[0].height,Qi.depth);for(let Pi=0,zi=xr.length;Pi<zi;Pi++)if(Nn=xr[Pi],De.format!==_h)if(qi!==null)if(Rt){if(vn)if(De.layerUpdates.size>0){const Kn=xR(Nn.width,Nn.height,De.format,De.type);for(const Dr of De.layerUpdates){const ls=Nn.data.subarray(Dr*Kn/Nn.data.BYTES_PER_ELEMENT,(Dr+1)*Kn/Nn.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Pi,0,0,Dr,Nn.width,Nn.height,1,qi,ls)}De.clearLayerUpdates()}else i.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Pi,0,0,0,Nn.width,Nn.height,Qi.depth,qi,Nn.data)}else i.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Pi,Qn,Nn.width,Nn.height,Qi.depth,0,Nn.data,0,0);else ir("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Rt?vn&&i.texSubImage3D(n.TEXTURE_2D_ARRAY,Pi,0,0,0,Nn.width,Nn.height,Qi.depth,qi,Xn,Nn.data):i.texImage3D(n.TEXTURE_2D_ARRAY,Pi,Qn,Nn.width,Nn.height,Qi.depth,0,qi,Xn,Nn.data)}else{Rt&&wn&&i.texStorage2D(n.TEXTURE_2D,bn,Qn,xr[0].width,xr[0].height);for(let Pi=0,zi=xr.length;Pi<zi;Pi++)Nn=xr[Pi],De.format!==_h?qi!==null?Rt?vn&&i.compressedTexSubImage2D(n.TEXTURE_2D,Pi,0,0,Nn.width,Nn.height,qi,Nn.data):i.compressedTexImage2D(n.TEXTURE_2D,Pi,Qn,Nn.width,Nn.height,0,Nn.data):ir("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Rt?vn&&i.texSubImage2D(n.TEXTURE_2D,Pi,0,0,Nn.width,Nn.height,qi,Xn,Nn.data):i.texImage2D(n.TEXTURE_2D,Pi,Qn,Nn.width,Nn.height,0,qi,Xn,Nn.data)}else if(De.isDataArrayTexture)if(Rt){if(wn&&i.texStorage3D(n.TEXTURE_2D_ARRAY,bn,Qn,Qi.width,Qi.height,Qi.depth),vn)if(De.layerUpdates.size>0){const Pi=xR(Qi.width,Qi.height,De.format,De.type);for(const zi of De.layerUpdates){const Kn=Qi.data.subarray(zi*Pi/Qi.data.BYTES_PER_ELEMENT,(zi+1)*Pi/Qi.data.BYTES_PER_ELEMENT);i.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,zi,Qi.width,Qi.height,1,qi,Xn,Kn)}De.clearLayerUpdates()}else i.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Qi.width,Qi.height,Qi.depth,qi,Xn,Qi.data)}else i.texImage3D(n.TEXTURE_2D_ARRAY,0,Qn,Qi.width,Qi.height,Qi.depth,0,qi,Xn,Qi.data);else if(De.isData3DTexture)Rt?(wn&&i.texStorage3D(n.TEXTURE_3D,bn,Qn,Qi.width,Qi.height,Qi.depth),vn&&i.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Qi.width,Qi.height,Qi.depth,qi,Xn,Qi.data)):i.texImage3D(n.TEXTURE_3D,0,Qn,Qi.width,Qi.height,Qi.depth,0,qi,Xn,Qi.data);else if(De.isFramebufferTexture){if(wn)if(Rt)i.texStorage2D(n.TEXTURE_2D,bn,Qn,Qi.width,Qi.height);else{let Pi=Qi.width,zi=Qi.height;for(let Kn=0;Kn<bn;Kn++)i.texImage2D(n.TEXTURE_2D,Kn,Qn,Pi,zi,0,qi,Xn,null),Pi>>=1,zi>>=1}}else if(xr.length>0){if(Rt&&wn){const Pi=Gn(xr[0]);i.texStorage2D(n.TEXTURE_2D,bn,Qn,Pi.width,Pi.height)}for(let Pi=0,zi=xr.length;Pi<zi;Pi++)Nn=xr[Pi],Rt?vn&&i.texSubImage2D(n.TEXTURE_2D,Pi,0,0,qi,Xn,Nn):i.texImage2D(n.TEXTURE_2D,Pi,Qn,qi,Xn,Nn);De.generateMipmaps=!1}else if(Rt){if(wn){const Pi=Gn(Qi);i.texStorage2D(n.TEXTURE_2D,bn,Qn,Pi.width,Pi.height)}vn&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,qi,Xn,Qi)}else i.texImage2D(n.TEXTURE_2D,0,Qn,qi,Xn,Qi);ie(De)&&Y(Li),Hn.__version=Ei.version,De.onUpdate&&De.onUpdate(De)}ot.__version=De.version}function xi(ot,De,Qt){if(De.image.length!==6)return;const Li=Vt(ot,De),Wi=De.source;i.bindTexture(n.TEXTURE_CUBE_MAP,ot.__webglTexture,n.TEXTURE0+Qt);const Ei=l.get(Wi);if(Wi.version!==Ei.__version||Li===!0){i.activeTexture(n.TEXTURE0+Qt);const Hn=oa.getPrimaries(oa.workingColorSpace),An=De.colorSpace===Mm?null:oa.getPrimaries(De.colorSpace),dr=De.colorSpace===Mm||Hn===An?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,De.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,De.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,dr);const Jn=De.isCompressedTexture||De.image[0].isCompressedTexture,Qi=De.image[0]&&De.image[0].isDataTexture,qi=[];for(let zi=0;zi<6;zi++)!Jn&&!Qi?qi[zi]=re(De.image[zi],!0,h.maxCubemapSize):qi[zi]=Qi?De.image[zi].image:De.image[zi],qi[zi]=_n(De,qi[zi]);const Xn=qi[0],Qn=g.convert(De.format,De.colorSpace),Nn=g.convert(De.type),xr=ue(De.internalFormat,Qn,Nn,De.colorSpace),Rt=De.isVideoTexture!==!0,wn=Ei.__version===void 0||Li===!0,vn=Wi.dataReady;let bn=Ae(De,Xn);Et(n.TEXTURE_CUBE_MAP,De);let Pi;if(Jn){Rt&&wn&&i.texStorage2D(n.TEXTURE_CUBE_MAP,bn,xr,Xn.width,Xn.height);for(let zi=0;zi<6;zi++){Pi=qi[zi].mipmaps;for(let Kn=0;Kn<Pi.length;Kn++){const Dr=Pi[Kn];De.format!==_h?Qn!==null?Rt?vn&&i.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn,0,0,Dr.width,Dr.height,Qn,Dr.data):i.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn,xr,Dr.width,Dr.height,0,Dr.data):ir("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Rt?vn&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn,0,0,Dr.width,Dr.height,Qn,Nn,Dr.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn,xr,Dr.width,Dr.height,0,Qn,Nn,Dr.data)}}}else{if(Pi=De.mipmaps,Rt&&wn){Pi.length>0&&bn++;const zi=Gn(qi[0]);i.texStorage2D(n.TEXTURE_CUBE_MAP,bn,xr,zi.width,zi.height)}for(let zi=0;zi<6;zi++)if(Qi){Rt?vn&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,0,0,0,qi[zi].width,qi[zi].height,Qn,Nn,qi[zi].data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,0,xr,qi[zi].width,qi[zi].height,0,Qn,Nn,qi[zi].data);for(let Kn=0;Kn<Pi.length;Kn++){const ls=Pi[Kn].image[zi].image;Rt?vn&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn+1,0,0,ls.width,ls.height,Qn,Nn,ls.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn+1,xr,ls.width,ls.height,0,Qn,Nn,ls.data)}}else{Rt?vn&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,0,0,0,Qn,Nn,qi[zi]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,0,xr,Qn,Nn,qi[zi]);for(let Kn=0;Kn<Pi.length;Kn++){const Dr=Pi[Kn];Rt?vn&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn+1,0,0,Qn,Nn,Dr.image[zi]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+zi,Kn+1,xr,Qn,Nn,Dr.image[zi])}}}ie(De)&&Y(n.TEXTURE_CUBE_MAP),Ei.__version=Wi.version,De.onUpdate&&De.onUpdate(De)}ot.__version=De.version}function Fi(ot,De,Qt,Li,Wi,Ei){const Hn=g.convert(Qt.format,Qt.colorSpace),An=g.convert(Qt.type),dr=ue(Qt.internalFormat,Hn,An,Qt.colorSpace),Jn=l.get(De),Qi=l.get(Qt);if(Qi.__renderTarget=De,!Jn.__hasExternalTextures){const qi=Math.max(1,De.width>>Ei),Xn=Math.max(1,De.height>>Ei);Wi===n.TEXTURE_3D||Wi===n.TEXTURE_2D_ARRAY?i.texImage3D(Wi,Ei,dr,qi,Xn,De.depth,0,Hn,An,null):i.texImage2D(Wi,Ei,dr,qi,Xn,0,Hn,An,null)}i.bindFramebuffer(n.FRAMEBUFFER,ot),tn(De)?r.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Li,Wi,Qi.__webglTexture,0,Di(De)):(Wi===n.TEXTURE_2D||Wi>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Wi<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Li,Wi,Qi.__webglTexture,Ei),i.bindFramebuffer(n.FRAMEBUFFER,null)}function Ui(ot,De,Qt){if(n.bindRenderbuffer(n.RENDERBUFFER,ot),De.depthBuffer){const Li=De.depthTexture,Wi=Li&&Li.isDepthTexture?Li.type:null,Ei=me(De.stencilBuffer,Wi),Hn=De.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,An=Di(De);tn(De)?r.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,An,Ei,De.width,De.height):Qt?n.renderbufferStorageMultisample(n.RENDERBUFFER,An,Ei,De.width,De.height):n.renderbufferStorage(n.RENDERBUFFER,Ei,De.width,De.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Hn,n.RENDERBUFFER,ot)}else{const Li=De.textures;for(let Wi=0;Wi<Li.length;Wi++){const Ei=Li[Wi],Hn=g.convert(Ei.format,Ei.colorSpace),An=g.convert(Ei.type),dr=ue(Ei.internalFormat,Hn,An,Ei.colorSpace),Jn=Di(De);Qt&&tn(De)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Jn,dr,De.width,De.height):tn(De)?r.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Jn,dr,De.width,De.height):n.renderbufferStorage(n.RENDERBUFFER,dr,De.width,De.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function rn(ot,De){if(De&&De.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(n.FRAMEBUFFER,ot),!(De.depthTexture&&De.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Li=l.get(De.depthTexture);Li.__renderTarget=De,(!Li.__webglTexture||De.depthTexture.image.width!==De.width||De.depthTexture.image.height!==De.height)&&(De.depthTexture.image.width=De.width,De.depthTexture.image.height=De.height,De.depthTexture.needsUpdate=!0),kt(De.depthTexture,0);const Wi=Li.__webglTexture,Ei=Di(De);if(De.depthTexture.format===nv)tn(De)?r.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Wi,0,Ei):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Wi,0);else if(De.depthTexture.format===Sy)tn(De)?r.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Wi,0,Ei):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Wi,0);else throw new Error("Unknown depthTexture format")}function Fn(ot){const De=l.get(ot),Qt=ot.isWebGLCubeRenderTarget===!0;if(De.__boundDepthTexture!==ot.depthTexture){const Li=ot.depthTexture;if(De.__depthDisposeCallback&&De.__depthDisposeCallback(),Li){const Wi=()=>{delete De.__boundDepthTexture,delete De.__depthDisposeCallback,Li.removeEventListener("dispose",Wi)};Li.addEventListener("dispose",Wi),De.__depthDisposeCallback=Wi}De.__boundDepthTexture=Li}if(ot.depthTexture&&!De.__autoAllocateDepthBuffer){if(Qt)throw new Error("target.depthTexture not supported in Cube render targets");const Li=ot.texture.mipmaps;Li&&Li.length>0?rn(De.__webglFramebuffer[0],ot):rn(De.__webglFramebuffer,ot)}else if(Qt){De.__webglDepthbuffer=[];for(let Li=0;Li<6;Li++)if(i.bindFramebuffer(n.FRAMEBUFFER,De.__webglFramebuffer[Li]),De.__webglDepthbuffer[Li]===void 0)De.__webglDepthbuffer[Li]=n.createRenderbuffer(),Ui(De.__webglDepthbuffer[Li],ot,!1);else{const Wi=ot.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ei=De.__webglDepthbuffer[Li];n.bindRenderbuffer(n.RENDERBUFFER,Ei),n.framebufferRenderbuffer(n.FRAMEBUFFER,Wi,n.RENDERBUFFER,Ei)}}else{const Li=ot.texture.mipmaps;if(Li&&Li.length>0?i.bindFramebuffer(n.FRAMEBUFFER,De.__webglFramebuffer[0]):i.bindFramebuffer(n.FRAMEBUFFER,De.__webglFramebuffer),De.__webglDepthbuffer===void 0)De.__webglDepthbuffer=n.createRenderbuffer(),Ui(De.__webglDepthbuffer,ot,!1);else{const Wi=ot.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ei=De.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Ei),n.framebufferRenderbuffer(n.FRAMEBUFFER,Wi,n.RENDERBUFFER,Ei)}}i.bindFramebuffer(n.FRAMEBUFFER,null)}function Er(ot,De,Qt){const Li=l.get(ot);De!==void 0&&Fi(Li.__webglFramebuffer,ot,ot.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),Qt!==void 0&&Fn(ot)}function xn(ot){const De=ot.texture,Qt=l.get(ot),Li=l.get(De);ot.addEventListener("dispose",ze);const Wi=ot.textures,Ei=ot.isWebGLCubeRenderTarget===!0,Hn=Wi.length>1;if(Hn||(Li.__webglTexture===void 0&&(Li.__webglTexture=n.createTexture()),Li.__version=De.version,v.memory.textures++),Ei){Qt.__webglFramebuffer=[];for(let An=0;An<6;An++)if(De.mipmaps&&De.mipmaps.length>0){Qt.__webglFramebuffer[An]=[];for(let dr=0;dr<De.mipmaps.length;dr++)Qt.__webglFramebuffer[An][dr]=n.createFramebuffer()}else Qt.__webglFramebuffer[An]=n.createFramebuffer()}else{if(De.mipmaps&&De.mipmaps.length>0){Qt.__webglFramebuffer=[];for(let An=0;An<De.mipmaps.length;An++)Qt.__webglFramebuffer[An]=n.createFramebuffer()}else Qt.__webglFramebuffer=n.createFramebuffer();if(Hn)for(let An=0,dr=Wi.length;An<dr;An++){const Jn=l.get(Wi[An]);Jn.__webglTexture===void 0&&(Jn.__webglTexture=n.createTexture(),v.memory.textures++)}if(ot.samples>0&&tn(ot)===!1){Qt.__webglMultisampledFramebuffer=n.createFramebuffer(),Qt.__webglColorRenderbuffer=[],i.bindFramebuffer(n.FRAMEBUFFER,Qt.__webglMultisampledFramebuffer);for(let An=0;An<Wi.length;An++){const dr=Wi[An];Qt.__webglColorRenderbuffer[An]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Qt.__webglColorRenderbuffer[An]);const Jn=g.convert(dr.format,dr.colorSpace),Qi=g.convert(dr.type),qi=ue(dr.internalFormat,Jn,Qi,dr.colorSpace,ot.isXRRenderTarget===!0),Xn=Di(ot);n.renderbufferStorageMultisample(n.RENDERBUFFER,Xn,qi,ot.width,ot.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+An,n.RENDERBUFFER,Qt.__webglColorRenderbuffer[An])}n.bindRenderbuffer(n.RENDERBUFFER,null),ot.depthBuffer&&(Qt.__webglDepthRenderbuffer=n.createRenderbuffer(),Ui(Qt.__webglDepthRenderbuffer,ot,!0)),i.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Ei){i.bindTexture(n.TEXTURE_CUBE_MAP,Li.__webglTexture),Et(n.TEXTURE_CUBE_MAP,De);for(let An=0;An<6;An++)if(De.mipmaps&&De.mipmaps.length>0)for(let dr=0;dr<De.mipmaps.length;dr++)Fi(Qt.__webglFramebuffer[An][dr],ot,De,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+An,dr);else Fi(Qt.__webglFramebuffer[An],ot,De,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+An,0);ie(De)&&Y(n.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(Hn){for(let An=0,dr=Wi.length;An<dr;An++){const Jn=Wi[An],Qi=l.get(Jn);let qi=n.TEXTURE_2D;(ot.isWebGL3DRenderTarget||ot.isWebGLArrayRenderTarget)&&(qi=ot.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),i.bindTexture(qi,Qi.__webglTexture),Et(qi,Jn),Fi(Qt.__webglFramebuffer,ot,Jn,n.COLOR_ATTACHMENT0+An,qi,0),ie(Jn)&&Y(qi)}i.unbindTexture()}else{let An=n.TEXTURE_2D;if((ot.isWebGL3DRenderTarget||ot.isWebGLArrayRenderTarget)&&(An=ot.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),i.bindTexture(An,Li.__webglTexture),Et(An,De),De.mipmaps&&De.mipmaps.length>0)for(let dr=0;dr<De.mipmaps.length;dr++)Fi(Qt.__webglFramebuffer[dr],ot,De,n.COLOR_ATTACHMENT0,An,dr);else Fi(Qt.__webglFramebuffer,ot,De,n.COLOR_ATTACHMENT0,An,0);ie(De)&&Y(An),i.unbindTexture()}ot.depthBuffer&&Fn(ot)}function Vi(ot){const De=ot.textures;for(let Qt=0,Li=De.length;Qt<Li;Qt++){const Wi=De[Qt];if(ie(Wi)){const Ei=ae(ot),Hn=l.get(Wi).__webglTexture;i.bindTexture(Ei,Hn),Y(Ei),i.unbindTexture()}}}const st=[],Xi=[];function Ji(ot){if(ot.samples>0){if(tn(ot)===!1){const De=ot.textures,Qt=ot.width,Li=ot.height;let Wi=n.COLOR_BUFFER_BIT;const Ei=ot.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Hn=l.get(ot),An=De.length>1;if(An)for(let Jn=0;Jn<De.length;Jn++)i.bindFramebuffer(n.FRAMEBUFFER,Hn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Jn,n.RENDERBUFFER,null),i.bindFramebuffer(n.FRAMEBUFFER,Hn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Jn,n.TEXTURE_2D,null,0);i.bindFramebuffer(n.READ_FRAMEBUFFER,Hn.__webglMultisampledFramebuffer);const dr=ot.texture.mipmaps;dr&&dr.length>0?i.bindFramebuffer(n.DRAW_FRAMEBUFFER,Hn.__webglFramebuffer[0]):i.bindFramebuffer(n.DRAW_FRAMEBUFFER,Hn.__webglFramebuffer);for(let Jn=0;Jn<De.length;Jn++){if(ot.resolveDepthBuffer&&(ot.depthBuffer&&(Wi|=n.DEPTH_BUFFER_BIT),ot.stencilBuffer&&ot.resolveStencilBuffer&&(Wi|=n.STENCIL_BUFFER_BIT)),An){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Hn.__webglColorRenderbuffer[Jn]);const Qi=l.get(De[Jn]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Qi,0)}n.blitFramebuffer(0,0,Qt,Li,0,0,Qt,Li,Wi,n.NEAREST),C===!0&&(st.length=0,Xi.length=0,st.push(n.COLOR_ATTACHMENT0+Jn),ot.depthBuffer&&ot.resolveDepthBuffer===!1&&(st.push(Ei),Xi.push(Ei),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Xi)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,st))}if(i.bindFramebuffer(n.READ_FRAMEBUFFER,null),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),An)for(let Jn=0;Jn<De.length;Jn++){i.bindFramebuffer(n.FRAMEBUFFER,Hn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Jn,n.RENDERBUFFER,Hn.__webglColorRenderbuffer[Jn]);const Qi=l.get(De[Jn]).__webglTexture;i.bindFramebuffer(n.FRAMEBUFFER,Hn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Jn,n.TEXTURE_2D,Qi,0)}i.bindFramebuffer(n.DRAW_FRAMEBUFFER,Hn.__webglMultisampledFramebuffer)}else if(ot.depthBuffer&&ot.resolveDepthBuffer===!1&&C){const De=ot.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[De])}}}function Di(ot){return Math.min(h.maxSamples,ot.samples)}function tn(ot){const De=l.get(ot);return ot.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&De.__useRenderToTexture!==!1}function Sn(ot){const De=v.render.frame;z.get(ot)!==De&&(z.set(ot,De),ot.update())}function _n(ot,De){const Qt=ot.colorSpace,Li=ot.format,Wi=ot.type;return ot.isCompressedTexture===!0||ot.isVideoTexture===!0||Qt!==pg&&Qt!==Mm&&(oa.getTransfer(Qt)===Ha?(Li!==_h||Wi!==xh)&&ir("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):ys("WebGLTextures: Unsupported texture color space:",Qt)),De}function Gn(ot){return typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement?(I.width=ot.naturalWidth||ot.width,I.height=ot.naturalHeight||ot.height):typeof VideoFrame<"u"&&ot instanceof VideoFrame?(I.width=ot.displayWidth,I.height=ot.displayHeight):(I.width=ot.width,I.height=ot.height),I}this.allocateTextureUnit=mt,this.resetTextureUnits=Mt,this.setTexture2D=kt,this.setTexture2DArray=Re,this.setTexture3D=Qe,this.setTextureCube=et,this.rebindTextures=Er,this.setupRenderTarget=xn,this.updateRenderTargetMipmap=Vi,this.updateMultisampleRenderTarget=Ji,this.setupDepthRenderbuffer=Fn,this.setupFrameBufferTexture=Fi,this.useMultisampledRTT=tn}function eV(n,e){function i(l,h=Mm){let g;const v=oa.getTransfer(h);if(l===xh)return n.UNSIGNED_BYTE;if(l===IM)return n.UNSIGNED_SHORT_4_4_4_4;if(l===DM)return n.UNSIGNED_SHORT_5_5_5_1;if(l===MI)return n.UNSIGNED_INT_5_9_9_9_REV;if(l===EI)return n.UNSIGNED_INT_10F_11F_11F_REV;if(l===SI)return n.BYTE;if(l===TI)return n.SHORT;if(l===iv)return n.UNSIGNED_SHORT;if(l===RM)return n.INT;if(l===dg)return n.UNSIGNED_INT;if(l===$h)return n.FLOAT;if(l===r0)return n.HALF_FLOAT;if(l===AI)return n.ALPHA;if(l===CI)return n.RGB;if(l===_h)return n.RGBA;if(l===nv)return n.DEPTH_COMPONENT;if(l===Sy)return n.DEPTH_STENCIL;if(l===LM)return n.RED;if(l===hw)return n.RED_INTEGER;if(l===PM)return n.RG;if(l===zM)return n.RG_INTEGER;if(l===OM)return n.RGBA_INTEGER;if(l===db||l===pb||l===mb||l===gb)if(v===Ha)if(g=e.get("WEBGL_compressed_texture_s3tc_srgb"),g!==null){if(l===db)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(l===pb)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(l===mb)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(l===gb)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(g=e.get("WEBGL_compressed_texture_s3tc"),g!==null){if(l===db)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(l===pb)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(l===mb)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(l===gb)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(l===O2||l===B2||l===N2||l===F2)if(g=e.get("WEBGL_compressed_texture_pvrtc"),g!==null){if(l===O2)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(l===B2)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(l===N2)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(l===F2)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(l===U2||l===k2||l===V2)if(g=e.get("WEBGL_compressed_texture_etc"),g!==null){if(l===U2||l===k2)return v===Ha?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;if(l===V2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(l===G2||l===H2||l===j2||l===q2||l===X2||l===W2||l===Z2||l===Y2||l===K2||l===$2||l===J2||l===Q2||l===eM||l===tM)if(g=e.get("WEBGL_compressed_texture_astc"),g!==null){if(l===G2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(l===H2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;if(l===j2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(l===q2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(l===X2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(l===W2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(l===Z2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(l===Y2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(l===K2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(l===$2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(l===J2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(l===Q2)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(l===eM)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(l===tM)return v===Ha?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(l===iM||l===nM||l===rM)if(g=e.get("EXT_texture_compression_bptc"),g!==null){if(l===iM)return v===Ha?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(l===nM)return g.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(l===rM)return g.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(l===sM||l===aM||l===oM||l===lM)if(g=e.get("EXT_texture_compression_rgtc"),g!==null){if(l===sM)return g.COMPRESSED_RED_RGTC1_EXT;if(l===aM)return g.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(l===oM)return g.COMPRESSED_RED_GREEN_RGTC2_EXT;if(l===lM)return g.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return l===wy?n.UNSIGNED_INT_24_8:n[l]!==void 0?n[l]:null}return{convert:i}}const nse=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,rse=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class sse{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i){if(this.texture===null){const l=new FI(e.texture);(e.depthNear!==i.depthNear||e.depthFar!==i.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=l}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,l=new bh({vertexShader:nse,fragmentShader:rse,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new sc(new bv(20,20),l)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class ase extends jd{constructor(e,i){super();const l=this;let h=null,g=1,v=null,r="local-floor",C=1,I=null,z=null,N=null,k=null,j=null,$=null;const re=typeof XRWebGLBinding<"u",ie=new sse,Y={},ae=i.getContextAttributes();let ue=null,me=null;const Ae=[],Se=[],ze=new $i;let je=null;const Ce=new Tc;Ce.viewport=new xa;const Te=new Tc;Te.viewport=new xa;const Ze=[Ce,Te],Mt=new Hk;let mt=null,Gt=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(qt){let xi=Ae[qt];return xi===void 0&&(xi=new VT,Ae[qt]=xi),xi.getTargetRaySpace()},this.getControllerGrip=function(qt){let xi=Ae[qt];return xi===void 0&&(xi=new VT,Ae[qt]=xi),xi.getGripSpace()},this.getHand=function(qt){let xi=Ae[qt];return xi===void 0&&(xi=new VT,Ae[qt]=xi),xi.getHandSpace()};function kt(qt){const xi=Se.indexOf(qt.inputSource);if(xi===-1)return;const Fi=Ae[xi];Fi!==void 0&&(Fi.update(qt.inputSource,qt.frame,I||v),Fi.dispatchEvent({type:qt.type,data:qt.inputSource}))}function Re(){h.removeEventListener("select",kt),h.removeEventListener("selectstart",kt),h.removeEventListener("selectend",kt),h.removeEventListener("squeeze",kt),h.removeEventListener("squeezestart",kt),h.removeEventListener("squeezeend",kt),h.removeEventListener("end",Re),h.removeEventListener("inputsourceschange",Qe);for(let qt=0;qt<Ae.length;qt++){const xi=Se[qt];xi!==null&&(Se[qt]=null,Ae[qt].disconnect(xi))}mt=null,Gt=null,ie.reset();for(const qt in Y)delete Y[qt];e.setRenderTarget(ue),j=null,k=null,N=null,h=null,me=null,ki.stop(),l.isPresenting=!1,e.setPixelRatio(je),e.setSize(ze.width,ze.height,!1),l.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(qt){g=qt,l.isPresenting===!0&&ir("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(qt){r=qt,l.isPresenting===!0&&ir("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return I||v},this.setReferenceSpace=function(qt){I=qt},this.getBaseLayer=function(){return k!==null?k:j},this.getBinding=function(){return N===null&&re&&(N=new XRWebGLBinding(h,i)),N},this.getFrame=function(){return $},this.getSession=function(){return h},this.setSession=async function(qt){if(h=qt,h!==null){if(ue=e.getRenderTarget(),h.addEventListener("select",kt),h.addEventListener("selectstart",kt),h.addEventListener("selectend",kt),h.addEventListener("squeeze",kt),h.addEventListener("squeezestart",kt),h.addEventListener("squeezeend",kt),h.addEventListener("end",Re),h.addEventListener("inputsourceschange",Qe),ae.xrCompatible!==!0&&await i.makeXRCompatible(),je=e.getPixelRatio(),e.getSize(ze),re&&"createProjectionLayer"in XRWebGLBinding.prototype){let Fi=null,Ui=null,rn=null;ae.depth&&(rn=ae.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,Fi=ae.stencil?Sy:nv,Ui=ae.stencil?wy:dg);const Fn={colorFormat:i.RGBA8,depthFormat:rn,scaleFactor:g};N=this.getBinding(),k=N.createProjectionLayer(Fn),h.updateRenderState({layers:[k]}),e.setPixelRatio(1),e.setSize(k.textureWidth,k.textureHeight,!1),me=new vh(k.textureWidth,k.textureHeight,{format:_h,type:xh,depthTexture:new XM(k.textureWidth,k.textureHeight,Ui,void 0,void 0,void 0,void 0,void 0,void 0,Fi),stencilBuffer:ae.stencil,colorSpace:e.outputColorSpace,samples:ae.antialias?4:0,resolveDepthBuffer:k.ignoreDepthValues===!1,resolveStencilBuffer:k.ignoreDepthValues===!1})}else{const Fi={antialias:ae.antialias,alpha:!0,depth:ae.depth,stencil:ae.stencil,framebufferScaleFactor:g};j=new XRWebGLLayer(h,i,Fi),h.updateRenderState({baseLayer:j}),e.setPixelRatio(1),e.setSize(j.framebufferWidth,j.framebufferHeight,!1),me=new vh(j.framebufferWidth,j.framebufferHeight,{format:_h,type:xh,colorSpace:e.outputColorSpace,stencilBuffer:ae.stencil,resolveDepthBuffer:j.ignoreDepthValues===!1,resolveStencilBuffer:j.ignoreDepthValues===!1})}me.isXRRenderTarget=!0,this.setFoveation(C),I=null,v=await h.requestReferenceSpace(r),ki.setContext(h),ki.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(h!==null)return h.environmentBlendMode},this.getDepthTexture=function(){return ie.getDepthTexture()};function Qe(qt){for(let xi=0;xi<qt.removed.length;xi++){const Fi=qt.removed[xi],Ui=Se.indexOf(Fi);Ui>=0&&(Se[Ui]=null,Ae[Ui].disconnect(Fi))}for(let xi=0;xi<qt.added.length;xi++){const Fi=qt.added[xi];let Ui=Se.indexOf(Fi);if(Ui===-1){for(let Fn=0;Fn<Ae.length;Fn++)if(Fn>=Se.length){Se.push(Fi),Ui=Fn;break}else if(Se[Fn]===null){Se[Fn]=Fi,Ui=Fn;break}if(Ui===-1)break}const rn=Ae[Ui];rn&&rn.connect(Fi)}}const et=new gt,Lt=new gt;function jt(qt,xi,Fi){et.setFromMatrixPosition(xi.matrixWorld),Lt.setFromMatrixPosition(Fi.matrixWorld);const Ui=et.distanceTo(Lt),rn=xi.projectionMatrix.elements,Fn=Fi.projectionMatrix.elements,Er=rn[14]/(rn[10]-1),xn=rn[14]/(rn[10]+1),Vi=(rn[9]+1)/rn[5],st=(rn[9]-1)/rn[5],Xi=(rn[8]-1)/rn[0],Ji=(Fn[8]+1)/Fn[0],Di=Er*Xi,tn=Er*Ji,Sn=Ui/(-Xi+Ji),_n=Sn*-Xi;if(xi.matrixWorld.decompose(qt.position,qt.quaternion,qt.scale),qt.translateX(_n),qt.translateZ(Sn),qt.matrixWorld.compose(qt.position,qt.quaternion,qt.scale),qt.matrixWorldInverse.copy(qt.matrixWorld).invert(),rn[10]===-1)qt.projectionMatrix.copy(xi.projectionMatrix),qt.projectionMatrixInverse.copy(xi.projectionMatrixInverse);else{const Gn=Er+Sn,ot=xn+Sn,De=Di-_n,Qt=tn+(Ui-_n),Li=Vi*xn/ot*Gn,Wi=st*xn/ot*Gn;qt.projectionMatrix.makePerspective(De,Qt,Li,Wi,Gn,ot),qt.projectionMatrixInverse.copy(qt.projectionMatrix).invert()}}function Ge(qt,xi){xi===null?qt.matrixWorld.copy(qt.matrix):qt.matrixWorld.multiplyMatrices(xi.matrixWorld,qt.matrix),qt.matrixWorldInverse.copy(qt.matrixWorld).invert()}this.updateCamera=function(qt){if(h===null)return;let xi=qt.near,Fi=qt.far;ie.texture!==null&&(ie.depthNear>0&&(xi=ie.depthNear),ie.depthFar>0&&(Fi=ie.depthFar)),Mt.near=Te.near=Ce.near=xi,Mt.far=Te.far=Ce.far=Fi,(mt!==Mt.near||Gt!==Mt.far)&&(h.updateRenderState({depthNear:Mt.near,depthFar:Mt.far}),mt=Mt.near,Gt=Mt.far),Mt.layers.mask=qt.layers.mask|6,Ce.layers.mask=Mt.layers.mask&3,Te.layers.mask=Mt.layers.mask&5;const Ui=qt.parent,rn=Mt.cameras;Ge(Mt,Ui);for(let Fn=0;Fn<rn.length;Fn++)Ge(rn[Fn],Ui);rn.length===2?jt(Mt,Ce,Te):Mt.projectionMatrix.copy(Ce.projectionMatrix),Et(qt,Mt,Ui)};function Et(qt,xi,Fi){Fi===null?qt.matrix.copy(xi.matrixWorld):(qt.matrix.copy(Fi.matrixWorld),qt.matrix.invert(),qt.matrix.multiply(xi.matrixWorld)),qt.matrix.decompose(qt.position,qt.quaternion,qt.scale),qt.updateMatrixWorld(!0),qt.projectionMatrix.copy(xi.projectionMatrix),qt.projectionMatrixInverse.copy(xi.projectionMatrixInverse),qt.isPerspectiveCamera&&(qt.fov=av*2*Math.atan(1/qt.projectionMatrix.elements[5]),qt.zoom=1)}this.getCamera=function(){return Mt},this.getFoveation=function(){if(!(k===null&&j===null))return C},this.setFoveation=function(qt){C=qt,k!==null&&(k.fixedFoveation=qt),j!==null&&j.fixedFoveation!==void 0&&(j.fixedFoveation=qt)},this.hasDepthSensing=function(){return ie.texture!==null},this.getDepthSensingMesh=function(){return ie.getMesh(Mt)},this.getCameraTexture=function(qt){return Y[qt]};let Vt=null;function ii(qt,xi){if(z=xi.getViewerPose(I||v),$=xi,z!==null){const Fi=z.views;j!==null&&(e.setRenderTargetFramebuffer(me,j.framebuffer),e.setRenderTarget(me));let Ui=!1;Fi.length!==Mt.cameras.length&&(Mt.cameras.length=0,Ui=!0);for(let xn=0;xn<Fi.length;xn++){const Vi=Fi[xn];let st=null;if(j!==null)st=j.getViewport(Vi);else{const Ji=N.getViewSubImage(k,Vi);st=Ji.viewport,xn===0&&(e.setRenderTargetTextures(me,Ji.colorTexture,Ji.depthStencilTexture),e.setRenderTarget(me))}let Xi=Ze[xn];Xi===void 0&&(Xi=new Tc,Xi.layers.enable(xn),Xi.viewport=new xa,Ze[xn]=Xi),Xi.matrix.fromArray(Vi.transform.matrix),Xi.matrix.decompose(Xi.position,Xi.quaternion,Xi.scale),Xi.projectionMatrix.fromArray(Vi.projectionMatrix),Xi.projectionMatrixInverse.copy(Xi.projectionMatrix).invert(),Xi.viewport.set(st.x,st.y,st.width,st.height),xn===0&&(Mt.matrix.copy(Xi.matrix),Mt.matrix.decompose(Mt.position,Mt.quaternion,Mt.scale)),Ui===!0&&Mt.cameras.push(Xi)}const rn=h.enabledFeatures;if(rn&&rn.includes("depth-sensing")&&h.depthUsage=="gpu-optimized"&&re){N=l.getBinding();const xn=N.getDepthInformation(Fi[0]);xn&&xn.isValid&&xn.texture&&ie.init(xn,h.renderState)}if(rn&&rn.includes("camera-access")&&re){e.state.unbindTexture(),N=l.getBinding();for(let xn=0;xn<Fi.length;xn++){const Vi=Fi[xn].camera;if(Vi){let st=Y[Vi];st||(st=new FI,Y[Vi]=st);const Xi=N.getCameraImage(Vi);st.sourceTexture=Xi}}}}for(let Fi=0;Fi<Ae.length;Fi++){const Ui=Se[Fi],rn=Ae[Fi];Ui!==null&&rn!==void 0&&rn.update(Ui,xi,I||v)}Vt&&Vt(qt,xi),xi.detectedPlanes&&l.dispatchEvent({type:"planesdetected",data:xi}),$=null}const ki=new Yk;ki.setAnimationLoop(ii),this.setAnimationLoop=function(qt){Vt=qt},this.dispose=function(){}}}const J0=new Hd,ose=new ps;function lse(n,e){function i(ie,Y){ie.matrixAutoUpdate===!0&&ie.updateMatrix(),Y.value.copy(ie.matrix)}function l(ie,Y){Y.color.getRGB(ie.fogColor.value,Y5(n)),Y.isFog?(ie.fogNear.value=Y.near,ie.fogFar.value=Y.far):Y.isFogExp2&&(ie.fogDensity.value=Y.density)}function h(ie,Y,ae,ue,me){Y.isMeshBasicMaterial||Y.isMeshLambertMaterial?g(ie,Y):Y.isMeshToonMaterial?(g(ie,Y),N(ie,Y)):Y.isMeshPhongMaterial?(g(ie,Y),z(ie,Y)):Y.isMeshStandardMaterial?(g(ie,Y),k(ie,Y),Y.isMeshPhysicalMaterial&&j(ie,Y,me)):Y.isMeshMatcapMaterial?(g(ie,Y),$(ie,Y)):Y.isMeshDepthMaterial?g(ie,Y):Y.isMeshDistanceMaterial?(g(ie,Y),re(ie,Y)):Y.isMeshNormalMaterial?g(ie,Y):Y.isLineBasicMaterial?(v(ie,Y),Y.isLineDashedMaterial&&r(ie,Y)):Y.isPointsMaterial?C(ie,Y,ae,ue):Y.isSpriteMaterial?I(ie,Y):Y.isShadowMaterial?(ie.color.value.copy(Y.color),ie.opacity.value=Y.opacity):Y.isShaderMaterial&&(Y.uniformsNeedUpdate=!1)}function g(ie,Y){ie.opacity.value=Y.opacity,Y.color&&ie.diffuse.value.copy(Y.color),Y.emissive&&ie.emissive.value.copy(Y.emissive).multiplyScalar(Y.emissiveIntensity),Y.map&&(ie.map.value=Y.map,i(Y.map,ie.mapTransform)),Y.alphaMap&&(ie.alphaMap.value=Y.alphaMap,i(Y.alphaMap,ie.alphaMapTransform)),Y.bumpMap&&(ie.bumpMap.value=Y.bumpMap,i(Y.bumpMap,ie.bumpMapTransform),ie.bumpScale.value=Y.bumpScale,Y.side===Mc&&(ie.bumpScale.value*=-1)),Y.normalMap&&(ie.normalMap.value=Y.normalMap,i(Y.normalMap,ie.normalMapTransform),ie.normalScale.value.copy(Y.normalScale),Y.side===Mc&&ie.normalScale.value.negate()),Y.displacementMap&&(ie.displacementMap.value=Y.displacementMap,i(Y.displacementMap,ie.displacementMapTransform),ie.displacementScale.value=Y.displacementScale,ie.displacementBias.value=Y.displacementBias),Y.emissiveMap&&(ie.emissiveMap.value=Y.emissiveMap,i(Y.emissiveMap,ie.emissiveMapTransform)),Y.specularMap&&(ie.specularMap.value=Y.specularMap,i(Y.specularMap,ie.specularMapTransform)),Y.alphaTest>0&&(ie.alphaTest.value=Y.alphaTest);const ae=e.get(Y),ue=ae.envMap,me=ae.envMapRotation;ue&&(ie.envMap.value=ue,J0.copy(me),J0.x*=-1,J0.y*=-1,J0.z*=-1,ue.isCubeTexture&&ue.isRenderTargetTexture===!1&&(J0.y*=-1,J0.z*=-1),ie.envMapRotation.value.setFromMatrix4(ose.makeRotationFromEuler(J0)),ie.flipEnvMap.value=ue.isCubeTexture&&ue.isRenderTargetTexture===!1?-1:1,ie.reflectivity.value=Y.reflectivity,ie.ior.value=Y.ior,ie.refractionRatio.value=Y.refractionRatio),Y.lightMap&&(ie.lightMap.value=Y.lightMap,ie.lightMapIntensity.value=Y.lightMapIntensity,i(Y.lightMap,ie.lightMapTransform)),Y.aoMap&&(ie.aoMap.value=Y.aoMap,ie.aoMapIntensity.value=Y.aoMapIntensity,i(Y.aoMap,ie.aoMapTransform))}function v(ie,Y){ie.diffuse.value.copy(Y.color),ie.opacity.value=Y.opacity,Y.map&&(ie.map.value=Y.map,i(Y.map,ie.mapTransform))}function r(ie,Y){ie.dashSize.value=Y.dashSize,ie.totalSize.value=Y.dashSize+Y.gapSize,ie.scale.value=Y.scale}function C(ie,Y,ae,ue){ie.diffuse.value.copy(Y.color),ie.opacity.value=Y.opacity,ie.size.value=Y.size*ae,ie.scale.value=ue*.5,Y.map&&(ie.map.value=Y.map,i(Y.map,ie.uvTransform)),Y.alphaMap&&(ie.alphaMap.value=Y.alphaMap,i(Y.alphaMap,ie.alphaMapTransform)),Y.alphaTest>0&&(ie.alphaTest.value=Y.alphaTest)}function I(ie,Y){ie.diffuse.value.copy(Y.color),ie.opacity.value=Y.opacity,ie.rotation.value=Y.rotation,Y.map&&(ie.map.value=Y.map,i(Y.map,ie.mapTransform)),Y.alphaMap&&(ie.alphaMap.value=Y.alphaMap,i(Y.alphaMap,ie.alphaMapTransform)),Y.alphaTest>0&&(ie.alphaTest.value=Y.alphaTest)}function z(ie,Y){ie.specular.value.copy(Y.specular),ie.shininess.value=Math.max(Y.shininess,1e-4)}function N(ie,Y){Y.gradientMap&&(ie.gradientMap.value=Y.gradientMap)}function k(ie,Y){ie.metalness.value=Y.metalness,Y.metalnessMap&&(ie.metalnessMap.value=Y.metalnessMap,i(Y.metalnessMap,ie.metalnessMapTransform)),ie.roughness.value=Y.roughness,Y.roughnessMap&&(ie.roughnessMap.value=Y.roughnessMap,i(Y.roughnessMap,ie.roughnessMapTransform)),Y.envMap&&(ie.envMapIntensity.value=Y.envMapIntensity)}function j(ie,Y,ae){ie.ior.value=Y.ior,Y.sheen>0&&(ie.sheenColor.value.copy(Y.sheenColor).multiplyScalar(Y.sheen),ie.sheenRoughness.value=Y.sheenRoughness,Y.sheenColorMap&&(ie.sheenColorMap.value=Y.sheenColorMap,i(Y.sheenColorMap,ie.sheenColorMapTransform)),Y.sheenRoughnessMap&&(ie.sheenRoughnessMap.value=Y.sheenRoughnessMap,i(Y.sheenRoughnessMap,ie.sheenRoughnessMapTransform))),Y.clearcoat>0&&(ie.clearcoat.value=Y.clearcoat,ie.clearcoatRoughness.value=Y.clearcoatRoughness,Y.clearcoatMap&&(ie.clearcoatMap.value=Y.clearcoatMap,i(Y.clearcoatMap,ie.clearcoatMapTransform)),Y.clearcoatRoughnessMap&&(ie.clearcoatRoughnessMap.value=Y.clearcoatRoughnessMap,i(Y.clearcoatRoughnessMap,ie.clearcoatRoughnessMapTransform)),Y.clearcoatNormalMap&&(ie.clearcoatNormalMap.value=Y.clearcoatNormalMap,i(Y.clearcoatNormalMap,ie.clearcoatNormalMapTransform),ie.clearcoatNormalScale.value.copy(Y.clearcoatNormalScale),Y.side===Mc&&ie.clearcoatNormalScale.value.negate())),Y.dispersion>0&&(ie.dispersion.value=Y.dispersion),Y.iridescence>0&&(ie.iridescence.value=Y.iridescence,ie.iridescenceIOR.value=Y.iridescenceIOR,ie.iridescenceThicknessMinimum.value=Y.iridescenceThicknessRange[0],ie.iridescenceThicknessMaximum.value=Y.iridescenceThicknessRange[1],Y.iridescenceMap&&(ie.iridescenceMap.value=Y.iridescenceMap,i(Y.iridescenceMap,ie.iridescenceMapTransform)),Y.iridescenceThicknessMap&&(ie.iridescenceThicknessMap.value=Y.iridescenceThicknessMap,i(Y.iridescenceThicknessMap,ie.iridescenceThicknessMapTransform))),Y.transmission>0&&(ie.transmission.value=Y.transmission,ie.transmissionSamplerMap.value=ae.texture,ie.transmissionSamplerSize.value.set(ae.width,ae.height),Y.transmissionMap&&(ie.transmissionMap.value=Y.transmissionMap,i(Y.transmissionMap,ie.transmissionMapTransform)),ie.thickness.value=Y.thickness,Y.thicknessMap&&(ie.thicknessMap.value=Y.thicknessMap,i(Y.thicknessMap,ie.thicknessMapTransform)),ie.attenuationDistance.value=Y.attenuationDistance,ie.attenuationColor.value.copy(Y.attenuationColor)),Y.anisotropy>0&&(ie.anisotropyVector.value.set(Y.anisotropy*Math.cos(Y.anisotropyRotation),Y.anisotropy*Math.sin(Y.anisotropyRotation)),Y.anisotropyMap&&(ie.anisotropyMap.value=Y.anisotropyMap,i(Y.anisotropyMap,ie.anisotropyMapTransform))),ie.specularIntensity.value=Y.specularIntensity,ie.specularColor.value.copy(Y.specularColor),Y.specularColorMap&&(ie.specularColorMap.value=Y.specularColorMap,i(Y.specularColorMap,ie.specularColorMapTransform)),Y.specularIntensityMap&&(ie.specularIntensityMap.value=Y.specularIntensityMap,i(Y.specularIntensityMap,ie.specularIntensityMapTransform))}function $(ie,Y){Y.matcap&&(ie.matcap.value=Y.matcap)}function re(ie,Y){const ae=e.get(Y).light;ie.referencePosition.value.setFromMatrixPosition(ae.matrixWorld),ie.nearDistance.value=ae.shadow.camera.near,ie.farDistance.value=ae.shadow.camera.far}return{refreshFogUniforms:l,refreshMaterialUniforms:h}}function cse(n,e,i,l){let h={},g={},v=[];const r=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function C(ae,ue){const me=ue.program;l.uniformBlockBinding(ae,me)}function I(ae,ue){let me=h[ae.id];me===void 0&&($(ae),me=z(ae),h[ae.id]=me,ae.addEventListener("dispose",ie));const Ae=ue.program;l.updateUBOMapping(ae,Ae);const Se=e.render.frame;g[ae.id]!==Se&&(k(ae),g[ae.id]=Se)}function z(ae){const ue=N();ae.__bindingPointIndex=ue;const me=n.createBuffer(),Ae=ae.__size,Se=ae.usage;return n.bindBuffer(n.UNIFORM_BUFFER,me),n.bufferData(n.UNIFORM_BUFFER,Ae,Se),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,ue,me),me}function N(){for(let ae=0;ae<r;ae++)if(v.indexOf(ae)===-1)return v.push(ae),ae;return ys("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function k(ae){const ue=h[ae.id],me=ae.uniforms,Ae=ae.__cache;n.bindBuffer(n.UNIFORM_BUFFER,ue);for(let Se=0,ze=me.length;Se<ze;Se++){const je=Array.isArray(me[Se])?me[Se]:[me[Se]];for(let Ce=0,Te=je.length;Ce<Te;Ce++){const Ze=je[Ce];if(j(Ze,Se,Ce,Ae)===!0){const Mt=Ze.__offset,mt=Array.isArray(Ze.value)?Ze.value:[Ze.value];let Gt=0;for(let kt=0;kt<mt.length;kt++){const Re=mt[kt],Qe=re(Re);typeof Re=="number"||typeof Re=="boolean"?(Ze.__data[0]=Re,n.bufferSubData(n.UNIFORM_BUFFER,Mt+Gt,Ze.__data)):Re.isMatrix3?(Ze.__data[0]=Re.elements[0],Ze.__data[1]=Re.elements[1],Ze.__data[2]=Re.elements[2],Ze.__data[3]=0,Ze.__data[4]=Re.elements[3],Ze.__data[5]=Re.elements[4],Ze.__data[6]=Re.elements[5],Ze.__data[7]=0,Ze.__data[8]=Re.elements[6],Ze.__data[9]=Re.elements[7],Ze.__data[10]=Re.elements[8],Ze.__data[11]=0):(Re.toArray(Ze.__data,Gt),Gt+=Qe.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,Mt,Ze.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function j(ae,ue,me,Ae){const Se=ae.value,ze=ue+"_"+me;if(Ae[ze]===void 0)return typeof Se=="number"||typeof Se=="boolean"?Ae[ze]=Se:Ae[ze]=Se.clone(),!0;{const je=Ae[ze];if(typeof Se=="number"||typeof Se=="boolean"){if(je!==Se)return Ae[ze]=Se,!0}else if(je.equals(Se)===!1)return je.copy(Se),!0}return!1}function $(ae){const ue=ae.uniforms;let me=0;const Ae=16;for(let ze=0,je=ue.length;ze<je;ze++){const Ce=Array.isArray(ue[ze])?ue[ze]:[ue[ze]];for(let Te=0,Ze=Ce.length;Te<Ze;Te++){const Mt=Ce[Te],mt=Array.isArray(Mt.value)?Mt.value:[Mt.value];for(let Gt=0,kt=mt.length;Gt<kt;Gt++){const Re=mt[Gt],Qe=re(Re),et=me%Ae,Lt=et%Qe.boundary,jt=et+Lt;me+=Lt,jt!==0&&Ae-jt<Qe.storage&&(me+=Ae-jt),Mt.__data=new Float32Array(Qe.storage/Float32Array.BYTES_PER_ELEMENT),Mt.__offset=me,me+=Qe.storage}}}const Se=me%Ae;return Se>0&&(me+=Ae-Se),ae.__size=me,ae.__cache={},this}function re(ae){const ue={boundary:0,storage:0};return typeof ae=="number"||typeof ae=="boolean"?(ue.boundary=4,ue.storage=4):ae.isVector2?(ue.boundary=8,ue.storage=8):ae.isVector3||ae.isColor?(ue.boundary=16,ue.storage=12):ae.isVector4?(ue.boundary=16,ue.storage=16):ae.isMatrix3?(ue.boundary=48,ue.storage=48):ae.isMatrix4?(ue.boundary=64,ue.storage=64):ae.isTexture?ir("WebGLRenderer: Texture samplers can not be part of an uniforms group."):ir("WebGLRenderer: Unsupported uniform value type.",ae),ue}function ie(ae){const ue=ae.target;ue.removeEventListener("dispose",ie);const me=v.indexOf(ue.__bindingPointIndex);v.splice(me,1),n.deleteBuffer(h[ue.id]),delete h[ue.id],delete g[ue.id]}function Y(){for(const ae in h)n.deleteBuffer(h[ae]);v=[],h={},g={}}return{bind:C,update:I,dispose:Y}}const use=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let qg=null;function hse(){return qg===null&&(qg=new Rm(use,32,32,PM,r0),qg.minFilter=Do,qg.magFilter=Do,qg.wrapS=Zf,qg.wrapT=Zf,qg.generateMipmaps=!1,qg.needsUpdate=!0),qg}class tV{constructor(e={}){const{canvas:i=X5(),context:l=null,depth:h=!0,stencil:g=!1,alpha:v=!1,antialias:r=!1,premultipliedAlpha:C=!0,preserveDrawingBuffer:I=!1,powerPreference:z="default",failIfMajorPerformanceCaveat:N=!1,reversedDepthBuffer:k=!1}=e;this.isWebGLRenderer=!0;let j;if(l!==null){if(typeof WebGLRenderingContext<"u"&&l instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");j=l.getContextAttributes().alpha}else j=v;const $=new Set([OM,zM,hw]),re=new Set([xh,dg,iv,wy,IM,DM]),ie=new Uint32Array(4),Y=new Int32Array(4);let ae=null,ue=null;const me=[],Ae=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Cm,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const Se=this;let ze=!1;this._outputColorSpace=Io;let je=0,Ce=0,Te=null,Ze=-1,Mt=null;const mt=new xa,Gt=new xa;let kt=null;const Re=new ar(0);let Qe=0,et=i.width,Lt=i.height,jt=1,Ge=null,Et=null;const Vt=new xa(0,0,et,Lt),ii=new xa(0,0,et,Lt);let ki=!1;const qt=new vv;let xi=!1,Fi=!1;const Ui=new ps,rn=new gt,Fn=new xa,Er={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let xn=!1;function Vi(){return Te===null?jt:1}let st=l;function Xi(ye,it){return i.getContext(ye,it)}try{const ye={alpha:!0,depth:h,stencil:g,antialias:r,premultipliedAlpha:C,preserveDrawingBuffer:I,powerPreference:z,failIfMajorPerformanceCaveat:N};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${cw}`),i.addEventListener("webglcontextlost",Pi,!1),i.addEventListener("webglcontextrestored",zi,!1),i.addEventListener("webglcontextcreationerror",Kn,!1),st===null){const it="webgl2";if(st=Xi(it,ye),st===null)throw Xi(it)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ye){throw ye("WebGLRenderer: "+ye.message),ye}let Ji,Di,tn,Sn,_n,Gn,ot,De,Qt,Li,Wi,Ei,Hn,An,dr,Jn,Qi,qi,Xn,Qn,Nn,xr,Rt,wn;function vn(){Ji=new bne(st),Ji.init(),xr=new eV(st,Ji),Di=new fne(st,Ji,e,xr),tn=new tse(st,Ji),Di.reversedDepthBuffer&&k&&tn.buffers.depth.setReversed(!0),Sn=new Tne(st),_n=new Gre,Gn=new ise(st,Ji,tn,_n,Di,xr,Sn),ot=new pne(Se),De=new vne(Se),Qt=new Cee(st),Rt=new une(st,Qt),Li=new wne(st,Qt,Sn,Rt),Wi=new Ene(st,Li,Qt,Sn),Xn=new Mne(st,Di,Gn),Jn=new dne(_n),Ei=new Vre(Se,ot,De,Ji,Di,Rt,Jn),Hn=new lse(Se,_n),An=new jre,dr=new Kre(Ji),qi=new cne(Se,ot,De,tn,Wi,j,C),Qi=new Qre(Se,Wi,Di),wn=new cse(st,Sn,Di,tn),Qn=new hne(st,Ji,Sn),Nn=new Sne(st,Ji,Sn),Sn.programs=Ei.programs,Se.capabilities=Di,Se.extensions=Ji,Se.properties=_n,Se.renderLists=An,Se.shadowMap=Qi,Se.state=tn,Se.info=Sn}vn();const bn=new ase(Se,st);this.xr=bn,this.getContext=function(){return st},this.getContextAttributes=function(){return st.getContextAttributes()},this.forceContextLoss=function(){const ye=Ji.get("WEBGL_lose_context");ye&&ye.loseContext()},this.forceContextRestore=function(){const ye=Ji.get("WEBGL_lose_context");ye&&ye.restoreContext()},this.getPixelRatio=function(){return jt},this.setPixelRatio=function(ye){ye!==void 0&&(jt=ye,this.setSize(et,Lt,!1))},this.getSize=function(ye){return ye.set(et,Lt)},this.setSize=function(ye,it,wt=!0){if(bn.isPresenting){ir("WebGLRenderer: Can't change size while VR device is presenting.");return}et=ye,Lt=it,i.width=Math.floor(ye*jt),i.height=Math.floor(it*jt),wt===!0&&(i.style.width=ye+"px",i.style.height=it+"px"),this.setViewport(0,0,ye,it)},this.getDrawingBufferSize=function(ye){return ye.set(et*jt,Lt*jt).floor()},this.setDrawingBufferSize=function(ye,it,wt){et=ye,Lt=it,jt=wt,i.width=Math.floor(ye*wt),i.height=Math.floor(it*wt),this.setViewport(0,0,ye,it)},this.getCurrentViewport=function(ye){return ye.copy(mt)},this.getViewport=function(ye){return ye.copy(Vt)},this.setViewport=function(ye,it,wt,ht){ye.isVector4?Vt.set(ye.x,ye.y,ye.z,ye.w):Vt.set(ye,it,wt,ht),tn.viewport(mt.copy(Vt).multiplyScalar(jt).round())},this.getScissor=function(ye){return ye.copy(ii)},this.setScissor=function(ye,it,wt,ht){ye.isVector4?ii.set(ye.x,ye.y,ye.z,ye.w):ii.set(ye,it,wt,ht),tn.scissor(Gt.copy(ii).multiplyScalar(jt).round())},this.getScissorTest=function(){return ki},this.setScissorTest=function(ye){tn.setScissorTest(ki=ye)},this.setOpaqueSort=function(ye){Ge=ye},this.setTransparentSort=function(ye){Et=ye},this.getClearColor=function(ye){return ye.copy(qi.getClearColor())},this.setClearColor=function(){qi.setClearColor(...arguments)},this.getClearAlpha=function(){return qi.getClearAlpha()},this.setClearAlpha=function(){qi.setClearAlpha(...arguments)},this.clear=function(ye=!0,it=!0,wt=!0){let ht=0;if(ye){let bt=!1;if(Te!==null){const mi=Te.texture.format;bt=$.has(mi)}if(bt){const mi=Te.texture.type,bi=re.has(mi),ji=qi.getClearColor(),pn=qi.getClearAlpha(),Vn=ji.r,Un=ji.g,kn=ji.b;bi?(ie[0]=Vn,ie[1]=Un,ie[2]=kn,ie[3]=pn,st.clearBufferuiv(st.COLOR,0,ie)):(Y[0]=Vn,Y[1]=Un,Y[2]=kn,Y[3]=pn,st.clearBufferiv(st.COLOR,0,Y))}else ht|=st.COLOR_BUFFER_BIT}it&&(ht|=st.DEPTH_BUFFER_BIT),wt&&(ht|=st.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),st.clear(ht)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Pi,!1),i.removeEventListener("webglcontextrestored",zi,!1),i.removeEventListener("webglcontextcreationerror",Kn,!1),qi.dispose(),An.dispose(),dr.dispose(),_n.dispose(),ot.dispose(),De.dispose(),Wi.dispose(),Rt.dispose(),wn.dispose(),Ei.dispose(),bn.dispose(),bn.removeEventListener("sessionstart",ac),bn.removeEventListener("sessionend",Ar),js.stop()};function Pi(ye){ye.preventDefault(),qb("WebGLRenderer: Context Lost."),ze=!0}function zi(){qb("WebGLRenderer: Context Restored."),ze=!1;const ye=Sn.autoReset,it=Qi.enabled,wt=Qi.autoUpdate,ht=Qi.needsUpdate,bt=Qi.type;vn(),Sn.autoReset=ye,Qi.enabled=it,Qi.autoUpdate=wt,Qi.needsUpdate=ht,Qi.type=bt}function Kn(ye){ys("WebGLRenderer: A WebGL context could not be created. Reason: ",ye.statusMessage)}function Dr(ye){const it=ye.target;it.removeEventListener("dispose",Dr),ls(it)}function ls(ye){Ts(ye),_n.remove(ye)}function Ts(ye){const it=_n.get(ye).programs;it!==void 0&&(it.forEach(function(wt){Ei.releaseProgram(wt)}),ye.isShaderMaterial&&Ei.releaseShaderCache(ye))}this.renderBufferDirect=function(ye,it,wt,ht,bt,mi){it===null&&(it=Er);const bi=bt.isMesh&&bt.matrixWorld.determinant()<0,ji=Ke(ye,it,wt,ht,bt);tn.setMaterial(ht,bi);let pn=wt.index,Vn=1;if(ht.wireframe===!0){if(pn=Li.getWireframeAttribute(wt),pn===void 0)return;Vn=2}const Un=wt.drawRange,kn=wt.attributes.position;let Wn=Un.start*Vn,Cn=(Un.start+Un.count)*Vn;mi!==null&&(Wn=Math.max(Wn,mi.start*Vn),Cn=Math.min(Cn,(mi.start+mi.count)*Vn)),pn!==null?(Wn=Math.max(Wn,0),Cn=Math.min(Cn,pn.count)):kn!=null&&(Wn=Math.max(Wn,0),Cn=Math.min(Cn,kn.count));const or=Cn-Wn;if(or<0||or===1/0)return;Rt.setup(bt,ht,ji,wt,pn);let jn,Tn=Qn;if(pn!==null&&(jn=Qt.get(pn),Tn=Nn,Tn.setIndex(jn)),bt.isMesh)ht.wireframe===!0?(tn.setLineWidth(ht.wireframeLinewidth*Vi()),Tn.setMode(st.LINES)):Tn.setMode(st.TRIANGLES);else if(bt.isLine){let In=ht.linewidth;In===void 0&&(In=1),tn.setLineWidth(In*Vi()),bt.isLineSegments?Tn.setMode(st.LINES):bt.isLineLoop?Tn.setMode(st.LINE_LOOP):Tn.setMode(st.LINE_STRIP)}else bt.isPoints?Tn.setMode(st.POINTS):bt.isSprite&&Tn.setMode(st.TRIANGLES);if(bt.isBatchedMesh)if(bt._multiDrawInstances!==null)sv("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Tn.renderMultiDrawInstances(bt._multiDrawStarts,bt._multiDrawCounts,bt._multiDrawCount,bt._multiDrawInstances);else if(Ji.get("WEBGL_multi_draw"))Tn.renderMultiDraw(bt._multiDrawStarts,bt._multiDrawCounts,bt._multiDrawCount);else{const In=bt._multiDrawStarts,Qr=bt._multiDrawCounts,kr=bt._multiDrawCount,qs=pn?Qt.get(pn).bytesPerElement:1,bl=_n.get(ht).currentProgram.getUniforms();for(let Kr=0;Kr<kr;Kr++)bl.setValue(st,"_gl_DrawID",Kr),Tn.render(In[Kr]/qs,Qr[Kr])}else if(bt.isInstancedMesh)Tn.renderInstances(Wn,or,bt.count);else if(wt.isInstancedBufferGeometry){const In=wt._maxInstanceCount!==void 0?wt._maxInstanceCount:1/0,Qr=Math.min(wt.instanceCount,In);Tn.renderInstances(Wn,or,Qr)}else Tn.render(Wn,or)};function Xt(ye,it,wt){ye.transparent===!0&&ye.side===jf&&ye.forceSinglePass===!1?(ye.side=Mc,ye.needsUpdate=!0,ge(ye,it,wt),ye.side=fg,ye.needsUpdate=!0,ge(ye,it,wt),ye.side=jf):ge(ye,it,wt)}this.compile=function(ye,it,wt=null){wt===null&&(wt=ye),ue=dr.get(wt),ue.init(it),Ae.push(ue),wt.traverseVisible(function(bt){bt.isLight&&bt.layers.test(it.layers)&&(ue.pushLight(bt),bt.castShadow&&ue.pushShadow(bt))}),ye!==wt&&ye.traverseVisible(function(bt){bt.isLight&&bt.layers.test(it.layers)&&(ue.pushLight(bt),bt.castShadow&&ue.pushShadow(bt))}),ue.setupLights();const ht=new Set;return ye.traverse(function(bt){if(!(bt.isMesh||bt.isPoints||bt.isLine||bt.isSprite))return;const mi=bt.material;if(mi)if(Array.isArray(mi))for(let bi=0;bi<mi.length;bi++){const ji=mi[bi];Xt(ji,wt,bt),ht.add(ji)}else Xt(mi,wt,bt),ht.add(mi)}),ue=Ae.pop(),ht},this.compileAsync=function(ye,it,wt=null){const ht=this.compile(ye,it,wt);return new Promise(bt=>{function mi(){if(ht.forEach(function(bi){_n.get(bi).currentProgram.isReady()&&ht.delete(bi)}),ht.size===0){bt(ye);return}setTimeout(mi,10)}Ji.get("KHR_parallel_shader_compile")!==null?mi():setTimeout(mi,10)})};let ja=null;function $f(ye){ja&&ja(ye)}function ac(){js.stop()}function Ar(){js.start()}const js=new Yk;js.setAnimationLoop($f),typeof self<"u"&&js.setContext(self),this.setAnimationLoop=function(ye){ja=ye,bn.setAnimationLoop(ye),ye===null?js.stop():js.start()},bn.addEventListener("sessionstart",ac),bn.addEventListener("sessionend",Ar),this.render=function(ye,it){if(it!==void 0&&it.isCamera!==!0){ys("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ze===!0)return;if(ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),it.parent===null&&it.matrixWorldAutoUpdate===!0&&it.updateMatrixWorld(),bn.enabled===!0&&bn.isPresenting===!0&&(bn.cameraAutoUpdate===!0&&bn.updateCamera(it),it=bn.getCamera()),ye.isScene===!0&&ye.onBeforeRender(Se,ye,it,Te),ue=dr.get(ye,Ae.length),ue.init(it),Ae.push(ue),Ui.multiplyMatrices(it.projectionMatrix,it.matrixWorldInverse),qt.setFromProjectionMatrix(Ui,Ud,it.reversedDepth),Fi=this.localClippingEnabled,xi=Jn.init(this.clippingPlanes,Fi),ae=An.get(ye,me.length),ae.init(),me.push(ae),bn.enabled===!0&&bn.isPresenting===!0){const mi=Se.xr.getDepthSensingMesh();mi!==null&&Bu(mi,it,-1/0,Se.sortObjects)}Bu(ye,it,0,Se.sortObjects),ae.finish(),Se.sortObjects===!0&&ae.sort(Ge,Et),xn=bn.enabled===!1||bn.isPresenting===!1||bn.hasDepthSensing()===!1,xn&&qi.addToRenderList(ae,ye),this.info.render.frame++,xi===!0&&Jn.beginShadows();const wt=ue.state.shadowsArray;Qi.render(wt,ye,it),xi===!0&&Jn.endShadows(),this.info.autoReset===!0&&this.info.reset();const ht=ae.opaque,bt=ae.transmissive;if(ue.setupLights(),it.isArrayCamera){const mi=it.cameras;if(bt.length>0)for(let bi=0,ji=mi.length;bi<ji;bi++){const pn=mi[bi];jo(ht,bt,ye,pn)}xn&&qi.render(ye);for(let bi=0,ji=mi.length;bi<ji;bi++){const pn=mi[bi];Lo(ae,ye,pn,pn.viewport)}}else bt.length>0&&jo(ht,bt,ye,it),xn&&qi.render(ye),Lo(ae,ye,it);Te!==null&&Ce===0&&(Gn.updateMultisampleRenderTarget(Te),Gn.updateRenderTargetMipmap(Te)),ye.isScene===!0&&ye.onAfterRender(Se,ye,it),Rt.resetDefaultState(),Ze=-1,Mt=null,Ae.pop(),Ae.length>0?(ue=Ae[Ae.length-1],xi===!0&&Jn.setGlobalState(Se.clippingPlanes,ue.state.camera)):ue=null,me.pop(),me.length>0?ae=me[me.length-1]:ae=null};function Bu(ye,it,wt,ht){if(ye.visible===!1)return;if(ye.layers.test(it.layers)){if(ye.isGroup)wt=ye.renderOrder;else if(ye.isLOD)ye.autoUpdate===!0&&ye.update(it);else if(ye.isLight)ue.pushLight(ye),ye.castShadow&&ue.pushShadow(ye);else if(ye.isSprite){if(!ye.frustumCulled||qt.intersectsSprite(ye)){ht&&Fn.setFromMatrixPosition(ye.matrixWorld).applyMatrix4(Ui);const bi=Wi.update(ye),ji=ye.material;ji.visible&&ae.push(ye,bi,ji,wt,Fn.z,null)}}else if((ye.isMesh||ye.isLine||ye.isPoints)&&(!ye.frustumCulled||qt.intersectsObject(ye))){const bi=Wi.update(ye),ji=ye.material;if(ht&&(ye.boundingSphere!==void 0?(ye.boundingSphere===null&&ye.computeBoundingSphere(),Fn.copy(ye.boundingSphere.center)):(bi.boundingSphere===null&&bi.computeBoundingSphere(),Fn.copy(bi.boundingSphere.center)),Fn.applyMatrix4(ye.matrixWorld).applyMatrix4(Ui)),Array.isArray(ji)){const pn=bi.groups;for(let Vn=0,Un=pn.length;Vn<Un;Vn++){const kn=pn[Vn],Wn=ji[kn.materialIndex];Wn&&Wn.visible&&ae.push(ye,bi,Wn,wt,Fn.z,kn)}}else ji.visible&&ae.push(ye,bi,ji,wt,Fn.z,null)}}const mi=ye.children;for(let bi=0,ji=mi.length;bi<ji;bi++)Bu(mi[bi],it,wt,ht)}function Lo(ye,it,wt,ht){const{opaque:bt,transmissive:mi,transparent:bi}=ye;ue.setupLightsView(wt),xi===!0&&Jn.setGlobalState(Se.clippingPlanes,wt),ht&&tn.viewport(mt.copy(ht)),bt.length>0&&ft(bt,it,wt),mi.length>0&&ft(mi,it,wt),bi.length>0&&ft(bi,it,wt),tn.buffers.depth.setTest(!0),tn.buffers.depth.setMask(!0),tn.buffers.color.setMask(!0),tn.setPolygonOffset(!1)}function jo(ye,it,wt,ht){if((wt.isScene===!0?wt.overrideMaterial:null)!==null)return;ue.state.transmissionRenderTarget[ht.id]===void 0&&(ue.state.transmissionRenderTarget[ht.id]=new vh(1,1,{generateMipmaps:!0,type:Ji.has("EXT_color_buffer_half_float")||Ji.has("EXT_color_buffer_float")?r0:xh,minFilter:og,samples:4,stencilBuffer:g,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:oa.workingColorSpace}));const mi=ue.state.transmissionRenderTarget[ht.id],bi=ht.viewport||mt;mi.setSize(bi.z*Se.transmissionResolutionScale,bi.w*Se.transmissionResolutionScale);const ji=Se.getRenderTarget(),pn=Se.getActiveCubeFace(),Vn=Se.getActiveMipmapLevel();Se.setRenderTarget(mi),Se.getClearColor(Re),Qe=Se.getClearAlpha(),Qe<1&&Se.setClearColor(16777215,.5),Se.clear(),xn&&qi.render(wt);const Un=Se.toneMapping;Se.toneMapping=Cm;const kn=ht.viewport;if(ht.viewport!==void 0&&(ht.viewport=void 0),ue.setupLightsView(ht),xi===!0&&Jn.setGlobalState(Se.clippingPlanes,ht),ft(ye,wt,ht),Gn.updateMultisampleRenderTarget(mi),Gn.updateRenderTargetMipmap(mi),Ji.has("WEBGL_multisampled_render_to_texture")===!1){let Wn=!1;for(let Cn=0,or=it.length;Cn<or;Cn++){const jn=it[Cn],{object:Tn,geometry:In,material:Qr,group:kr}=jn;if(Qr.side===jf&&Tn.layers.test(ht.layers)){const qs=Qr.side;Qr.side=Mc,Qr.needsUpdate=!0,oe(Tn,wt,ht,In,Qr,kr),Qr.side=qs,Qr.needsUpdate=!0,Wn=!0}}Wn===!0&&(Gn.updateMultisampleRenderTarget(mi),Gn.updateRenderTargetMipmap(mi))}Se.setRenderTarget(ji,pn,Vn),Se.setClearColor(Re,Qe),kn!==void 0&&(ht.viewport=kn),Se.toneMapping=Un}function ft(ye,it,wt){const ht=it.isScene===!0?it.overrideMaterial:null;for(let bt=0,mi=ye.length;bt<mi;bt++){const bi=ye[bt],{object:ji,geometry:pn,group:Vn}=bi;let Un=bi.material;Un.allowOverride===!0&&ht!==null&&(Un=ht),ji.layers.test(wt.layers)&&oe(ji,it,wt,pn,Un,Vn)}}function oe(ye,it,wt,ht,bt,mi){ye.onBeforeRender(Se,it,wt,ht,bt,mi),ye.modelViewMatrix.multiplyMatrices(wt.matrixWorldInverse,ye.matrixWorld),ye.normalMatrix.getNormalMatrix(ye.modelViewMatrix),bt.onBeforeRender(Se,it,wt,ht,ye,mi),bt.transparent===!0&&bt.side===jf&&bt.forceSinglePass===!1?(bt.side=Mc,bt.needsUpdate=!0,Se.renderBufferDirect(wt,it,ht,bt,ye,mi),bt.side=fg,bt.needsUpdate=!0,Se.renderBufferDirect(wt,it,ht,bt,ye,mi),bt.side=jf):Se.renderBufferDirect(wt,it,ht,bt,ye,mi),ye.onAfterRender(Se,it,wt,ht,bt,mi)}function ge(ye,it,wt){it.isScene!==!0&&(it=Er);const ht=_n.get(ye),bt=ue.state.lights,mi=ue.state.shadowsArray,bi=bt.state.version,ji=Ei.getParameters(ye,bt.state,mi,it,wt),pn=Ei.getProgramCacheKey(ji);let Vn=ht.programs;ht.environment=ye.isMeshStandardMaterial?it.environment:null,ht.fog=it.fog,ht.envMap=(ye.isMeshStandardMaterial?De:ot).get(ye.envMap||ht.environment),ht.envMapRotation=ht.environment!==null&&ye.envMap===null?it.environmentRotation:ye.envMapRotation,Vn===void 0&&(ye.addEventListener("dispose",Dr),Vn=new Map,ht.programs=Vn);let Un=Vn.get(pn);if(Un!==void 0){if(ht.currentProgram===Un&&ht.lightsStateVersion===bi)return $e(ye,ji),Un}else ji.uniforms=Ei.getUniforms(ye),ye.onBeforeCompile(ji,Se),Un=Ei.acquireProgram(ji,pn),Vn.set(pn,Un),ht.uniforms=ji.uniforms;const kn=ht.uniforms;return(!ye.isShaderMaterial&&!ye.isRawShaderMaterial||ye.clipping===!0)&&(kn.clippingPlanes=Jn.uniform),$e(ye,ji),ht.needsLights=At(ye),ht.lightsStateVersion=bi,ht.needsLights&&(kn.ambientLightColor.value=bt.state.ambient,kn.lightProbe.value=bt.state.probe,kn.directionalLights.value=bt.state.directional,kn.directionalLightShadows.value=bt.state.directionalShadow,kn.spotLights.value=bt.state.spot,kn.spotLightShadows.value=bt.state.spotShadow,kn.rectAreaLights.value=bt.state.rectArea,kn.ltc_1.value=bt.state.rectAreaLTC1,kn.ltc_2.value=bt.state.rectAreaLTC2,kn.pointLights.value=bt.state.point,kn.pointLightShadows.value=bt.state.pointShadow,kn.hemisphereLights.value=bt.state.hemi,kn.directionalShadowMap.value=bt.state.directionalShadowMap,kn.directionalShadowMatrix.value=bt.state.directionalShadowMatrix,kn.spotShadowMap.value=bt.state.spotShadowMap,kn.spotLightMatrix.value=bt.state.spotLightMatrix,kn.spotLightMap.value=bt.state.spotLightMap,kn.pointShadowMap.value=bt.state.pointShadowMap,kn.pointShadowMatrix.value=bt.state.pointShadowMatrix),ht.currentProgram=Un,ht.uniformsList=null,Un}function Ie(ye){if(ye.uniformsList===null){const it=ye.currentProgram.getUniforms();ye.uniformsList=GT.seqWithValue(it.seq,ye.uniforms)}return ye.uniformsList}function $e(ye,it){const wt=_n.get(ye);wt.outputColorSpace=it.outputColorSpace,wt.batching=it.batching,wt.batchingColor=it.batchingColor,wt.instancing=it.instancing,wt.instancingColor=it.instancingColor,wt.instancingMorph=it.instancingMorph,wt.skinning=it.skinning,wt.morphTargets=it.morphTargets,wt.morphNormals=it.morphNormals,wt.morphColors=it.morphColors,wt.morphTargetsCount=it.morphTargetsCount,wt.numClippingPlanes=it.numClippingPlanes,wt.numIntersection=it.numClipIntersection,wt.vertexAlphas=it.vertexAlphas,wt.vertexTangents=it.vertexTangents,wt.toneMapping=it.toneMapping}function Ke(ye,it,wt,ht,bt){it.isScene!==!0&&(it=Er),Gn.resetTextureUnits();const mi=it.fog,bi=ht.isMeshStandardMaterial?it.environment:null,ji=Te===null?Se.outputColorSpace:Te.isXRRenderTarget===!0?Te.texture.colorSpace:pg,pn=(ht.isMeshStandardMaterial?De:ot).get(ht.envMap||bi),Vn=ht.vertexColors===!0&&!!wt.attributes.color&&wt.attributes.color.itemSize===4,Un=!!wt.attributes.tangent&&(!!ht.normalMap||ht.anisotropy>0),kn=!!wt.morphAttributes.position,Wn=!!wt.morphAttributes.normal,Cn=!!wt.morphAttributes.color;let or=Cm;ht.toneMapped&&(Te===null||Te.isXRRenderTarget===!0)&&(or=Se.toneMapping);const jn=wt.morphAttributes.position||wt.morphAttributes.normal||wt.morphAttributes.color,Tn=jn!==void 0?jn.length:0,In=_n.get(ht),Qr=ue.state.lights;if(xi===!0&&(Fi===!0||ye!==Mt)){const Ma=ye===Mt&&ht.id===Ze;Jn.setState(ht,ye,Ma)}let kr=!1;ht.version===In.__version?(In.needsLights&&In.lightsStateVersion!==Qr.state.version||In.outputColorSpace!==ji||bt.isBatchedMesh&&In.batching===!1||!bt.isBatchedMesh&&In.batching===!0||bt.isBatchedMesh&&In.batchingColor===!0&&bt.colorTexture===null||bt.isBatchedMesh&&In.batchingColor===!1&&bt.colorTexture!==null||bt.isInstancedMesh&&In.instancing===!1||!bt.isInstancedMesh&&In.instancing===!0||bt.isSkinnedMesh&&In.skinning===!1||!bt.isSkinnedMesh&&In.skinning===!0||bt.isInstancedMesh&&In.instancingColor===!0&&bt.instanceColor===null||bt.isInstancedMesh&&In.instancingColor===!1&&bt.instanceColor!==null||bt.isInstancedMesh&&In.instancingMorph===!0&&bt.morphTexture===null||bt.isInstancedMesh&&In.instancingMorph===!1&&bt.morphTexture!==null||In.envMap!==pn||ht.fog===!0&&In.fog!==mi||In.numClippingPlanes!==void 0&&(In.numClippingPlanes!==Jn.numPlanes||In.numIntersection!==Jn.numIntersection)||In.vertexAlphas!==Vn||In.vertexTangents!==Un||In.morphTargets!==kn||In.morphNormals!==Wn||In.morphColors!==Cn||In.toneMapping!==or||In.morphTargetsCount!==Tn)&&(kr=!0):(kr=!0,In.__version=ht.version);let qs=In.currentProgram;kr===!0&&(qs=ge(ht,it,bt));let bl=!1,Kr=!1,qa=!1;const as=qs.getUniforms(),la=In.uniforms;if(tn.useProgram(qs.program)&&(bl=!0,Kr=!0,qa=!0),ht.id!==Ze&&(Ze=ht.id,Kr=!0),bl||Mt!==ye){tn.buffers.depth.getReversed()&&ye.reversedDepth!==!0&&(ye._reversedDepth=!0,ye.updateProjectionMatrix()),as.setValue(st,"projectionMatrix",ye.projectionMatrix),as.setValue(st,"viewMatrix",ye.matrixWorldInverse);const ma=as.map.cameraPosition;ma!==void 0&&ma.setValue(st,rn.setFromMatrixPosition(ye.matrixWorld)),Di.logarithmicDepthBuffer&&as.setValue(st,"logDepthBufFC",2/(Math.log(ye.far+1)/Math.LN2)),(ht.isMeshPhongMaterial||ht.isMeshToonMaterial||ht.isMeshLambertMaterial||ht.isMeshBasicMaterial||ht.isMeshStandardMaterial||ht.isShaderMaterial)&&as.setValue(st,"isOrthographic",ye.isOrthographicCamera===!0),Mt!==ye&&(Mt=ye,Kr=!0,qa=!0)}if(bt.isSkinnedMesh){as.setOptional(st,bt,"bindMatrix"),as.setOptional(st,bt,"bindMatrixInverse");const Ma=bt.skeleton;Ma&&(Ma.boneTexture===null&&Ma.computeBoneTexture(),as.setValue(st,"boneTexture",Ma.boneTexture,Gn))}bt.isBatchedMesh&&(as.setOptional(st,bt,"batchingTexture"),as.setValue(st,"batchingTexture",bt._matricesTexture,Gn),as.setOptional(st,bt,"batchingIdTexture"),as.setValue(st,"batchingIdTexture",bt._indirectTexture,Gn),as.setOptional(st,bt,"batchingColorTexture"),bt._colorsTexture!==null&&as.setValue(st,"batchingColorTexture",bt._colorsTexture,Gn));const xs=wt.morphAttributes;if((xs.position!==void 0||xs.normal!==void 0||xs.color!==void 0)&&Xn.update(bt,wt,qs),(Kr||In.receiveShadow!==bt.receiveShadow)&&(In.receiveShadow=bt.receiveShadow,as.setValue(st,"receiveShadow",bt.receiveShadow)),ht.isMeshGouraudMaterial&&ht.envMap!==null&&(la.envMap.value=pn,la.flipEnvMap.value=pn.isCubeTexture&&pn.isRenderTargetTexture===!1?-1:1),ht.isMeshStandardMaterial&&ht.envMap===null&&it.environment!==null&&(la.envMapIntensity.value=it.environmentIntensity),la.dfgLUT!==void 0&&(la.dfgLUT.value=hse()),Kr&&(as.setValue(st,"toneMappingExposure",Se.toneMappingExposure),In.needsLights&&at(la,qa),mi&&ht.fog===!0&&Hn.refreshFogUniforms(la,mi),Hn.refreshMaterialUniforms(la,ht,jt,Lt,ue.state.transmissionRenderTarget[ye.id]),GT.upload(st,Ie(In),la,Gn)),ht.isShaderMaterial&&ht.uniformsNeedUpdate===!0&&(GT.upload(st,Ie(In),la,Gn),ht.uniformsNeedUpdate=!1),ht.isSpriteMaterial&&as.setValue(st,"center",bt.center),as.setValue(st,"modelViewMatrix",bt.modelViewMatrix),as.setValue(st,"normalMatrix",bt.normalMatrix),as.setValue(st,"modelMatrix",bt.matrixWorld),ht.isShaderMaterial||ht.isRawShaderMaterial){const Ma=ht.uniformsGroups;for(let ma=0,Ul=Ma.length;ma<Ul;ma++){const wl=Ma[ma];wn.update(wl,qs),wn.bind(wl,qs)}}return qs}function at(ye,it){ye.ambientLightColor.needsUpdate=it,ye.lightProbe.needsUpdate=it,ye.directionalLights.needsUpdate=it,ye.directionalLightShadows.needsUpdate=it,ye.pointLights.needsUpdate=it,ye.pointLightShadows.needsUpdate=it,ye.spotLights.needsUpdate=it,ye.spotLightShadows.needsUpdate=it,ye.rectAreaLights.needsUpdate=it,ye.hemisphereLights.needsUpdate=it}function At(ye){return ye.isMeshLambertMaterial||ye.isMeshToonMaterial||ye.isMeshPhongMaterial||ye.isMeshStandardMaterial||ye.isShadowMaterial||ye.isShaderMaterial&&ye.lights===!0}this.getActiveCubeFace=function(){return je},this.getActiveMipmapLevel=function(){return Ce},this.getRenderTarget=function(){return Te},this.setRenderTargetTextures=function(ye,it,wt){const ht=_n.get(ye);ht.__autoAllocateDepthBuffer=ye.resolveDepthBuffer===!1,ht.__autoAllocateDepthBuffer===!1&&(ht.__useRenderToTexture=!1),_n.get(ye.texture).__webglTexture=it,_n.get(ye.depthTexture).__webglTexture=ht.__autoAllocateDepthBuffer?void 0:wt,ht.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(ye,it){const wt=_n.get(ye);wt.__webglFramebuffer=it,wt.__useDefaultFramebuffer=it===void 0};const lt=st.createFramebuffer();this.setRenderTarget=function(ye,it=0,wt=0){Te=ye,je=it,Ce=wt;let ht=!0,bt=null,mi=!1,bi=!1;if(ye){const pn=_n.get(ye);if(pn.__useDefaultFramebuffer!==void 0)tn.bindFramebuffer(st.FRAMEBUFFER,null),ht=!1;else if(pn.__webglFramebuffer===void 0)Gn.setupRenderTarget(ye);else if(pn.__hasExternalTextures)Gn.rebindTextures(ye,_n.get(ye.texture).__webglTexture,_n.get(ye.depthTexture).__webglTexture);else if(ye.depthBuffer){const kn=ye.depthTexture;if(pn.__boundDepthTexture!==kn){if(kn!==null&&_n.has(kn)&&(ye.width!==kn.image.width||ye.height!==kn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Gn.setupDepthRenderbuffer(ye)}}const Vn=ye.texture;(Vn.isData3DTexture||Vn.isDataArrayTexture||Vn.isCompressedArrayTexture)&&(bi=!0);const Un=_n.get(ye).__webglFramebuffer;ye.isWebGLCubeRenderTarget?(Array.isArray(Un[it])?bt=Un[it][wt]:bt=Un[it],mi=!0):ye.samples>0&&Gn.useMultisampledRTT(ye)===!1?bt=_n.get(ye).__webglMultisampledFramebuffer:Array.isArray(Un)?bt=Un[wt]:bt=Un,mt.copy(ye.viewport),Gt.copy(ye.scissor),kt=ye.scissorTest}else mt.copy(Vt).multiplyScalar(jt).floor(),Gt.copy(ii).multiplyScalar(jt).floor(),kt=ki;if(wt!==0&&(bt=lt),tn.bindFramebuffer(st.FRAMEBUFFER,bt)&&ht&&tn.drawBuffers(ye,bt),tn.viewport(mt),tn.scissor(Gt),tn.setScissorTest(kt),mi){const pn=_n.get(ye.texture);st.framebufferTexture2D(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.TEXTURE_CUBE_MAP_POSITIVE_X+it,pn.__webglTexture,wt)}else if(bi){const pn=it;for(let Vn=0;Vn<ye.textures.length;Vn++){const Un=_n.get(ye.textures[Vn]);st.framebufferTextureLayer(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0+Vn,Un.__webglTexture,wt,pn)}}else if(ye!==null&&wt!==0){const pn=_n.get(ye.texture);st.framebufferTexture2D(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.TEXTURE_2D,pn.__webglTexture,wt)}Ze=-1},this.readRenderTargetPixels=function(ye,it,wt,ht,bt,mi,bi,ji=0){if(!(ye&&ye.isWebGLRenderTarget)){ys("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let pn=_n.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&bi!==void 0&&(pn=pn[bi]),pn){tn.bindFramebuffer(st.FRAMEBUFFER,pn);try{const Vn=ye.textures[ji],Un=Vn.format,kn=Vn.type;if(!Di.textureFormatReadable(Un)){ys("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Di.textureTypeReadable(kn)){ys("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}it>=0&&it<=ye.width-ht&&wt>=0&&wt<=ye.height-bt&&(ye.textures.length>1&&st.readBuffer(st.COLOR_ATTACHMENT0+ji),st.readPixels(it,wt,ht,bt,xr.convert(Un),xr.convert(kn),mi))}finally{const Vn=Te!==null?_n.get(Te).__webglFramebuffer:null;tn.bindFramebuffer(st.FRAMEBUFFER,Vn)}}},this.readRenderTargetPixelsAsync=async function(ye,it,wt,ht,bt,mi,bi,ji=0){if(!(ye&&ye.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let pn=_n.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&bi!==void 0&&(pn=pn[bi]),pn)if(it>=0&&it<=ye.width-ht&&wt>=0&&wt<=ye.height-bt){tn.bindFramebuffer(st.FRAMEBUFFER,pn);const Vn=ye.textures[ji],Un=Vn.format,kn=Vn.type;if(!Di.textureFormatReadable(Un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Di.textureTypeReadable(kn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Wn=st.createBuffer();st.bindBuffer(st.PIXEL_PACK_BUFFER,Wn),st.bufferData(st.PIXEL_PACK_BUFFER,mi.byteLength,st.STREAM_READ),ye.textures.length>1&&st.readBuffer(st.COLOR_ATTACHMENT0+ji),st.readPixels(it,wt,ht,bt,xr.convert(Un),xr.convert(kn),0);const Cn=Te!==null?_n.get(Te).__webglFramebuffer:null;tn.bindFramebuffer(st.FRAMEBUFFER,Cn);const or=st.fenceSync(st.SYNC_GPU_COMMANDS_COMPLETE,0);return st.flush(),await C$(st,or,4),st.bindBuffer(st.PIXEL_PACK_BUFFER,Wn),st.getBufferSubData(st.PIXEL_PACK_BUFFER,0,mi),st.deleteBuffer(Wn),st.deleteSync(or),mi}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(ye,it=null,wt=0){const ht=Math.pow(2,-wt),bt=Math.floor(ye.image.width*ht),mi=Math.floor(ye.image.height*ht),bi=it!==null?it.x:0,ji=it!==null?it.y:0;Gn.setTexture2D(ye,0),st.copyTexSubImage2D(st.TEXTURE_2D,wt,0,0,bi,ji,bt,mi),tn.unbindTexture()};const Tt=st.createFramebuffer(),Wt=st.createFramebuffer();this.copyTextureToTexture=function(ye,it,wt=null,ht=null,bt=0,mi=null){mi===null&&(bt!==0?(sv("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),mi=bt,bt=0):mi=0);let bi,ji,pn,Vn,Un,kn,Wn,Cn,or;const jn=ye.isCompressedTexture?ye.mipmaps[mi]:ye.image;if(wt!==null)bi=wt.max.x-wt.min.x,ji=wt.max.y-wt.min.y,pn=wt.isBox3?wt.max.z-wt.min.z:1,Vn=wt.min.x,Un=wt.min.y,kn=wt.isBox3?wt.min.z:0;else{const xs=Math.pow(2,-bt);bi=Math.floor(jn.width*xs),ji=Math.floor(jn.height*xs),ye.isDataArrayTexture?pn=jn.depth:ye.isData3DTexture?pn=Math.floor(jn.depth*xs):pn=1,Vn=0,Un=0,kn=0}ht!==null?(Wn=ht.x,Cn=ht.y,or=ht.z):(Wn=0,Cn=0,or=0);const Tn=xr.convert(it.format),In=xr.convert(it.type);let Qr;it.isData3DTexture?(Gn.setTexture3D(it,0),Qr=st.TEXTURE_3D):it.isDataArrayTexture||it.isCompressedArrayTexture?(Gn.setTexture2DArray(it,0),Qr=st.TEXTURE_2D_ARRAY):(Gn.setTexture2D(it,0),Qr=st.TEXTURE_2D),st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,it.flipY),st.pixelStorei(st.UNPACK_PREMULTIPLY_ALPHA_WEBGL,it.premultiplyAlpha),st.pixelStorei(st.UNPACK_ALIGNMENT,it.unpackAlignment);const kr=st.getParameter(st.UNPACK_ROW_LENGTH),qs=st.getParameter(st.UNPACK_IMAGE_HEIGHT),bl=st.getParameter(st.UNPACK_SKIP_PIXELS),Kr=st.getParameter(st.UNPACK_SKIP_ROWS),qa=st.getParameter(st.UNPACK_SKIP_IMAGES);st.pixelStorei(st.UNPACK_ROW_LENGTH,jn.width),st.pixelStorei(st.UNPACK_IMAGE_HEIGHT,jn.height),st.pixelStorei(st.UNPACK_SKIP_PIXELS,Vn),st.pixelStorei(st.UNPACK_SKIP_ROWS,Un),st.pixelStorei(st.UNPACK_SKIP_IMAGES,kn);const as=ye.isDataArrayTexture||ye.isData3DTexture,la=it.isDataArrayTexture||it.isData3DTexture;if(ye.isDepthTexture){const xs=_n.get(ye),Ma=_n.get(it),ma=_n.get(xs.__renderTarget),Ul=_n.get(Ma.__renderTarget);tn.bindFramebuffer(st.READ_FRAMEBUFFER,ma.__webglFramebuffer),tn.bindFramebuffer(st.DRAW_FRAMEBUFFER,Ul.__webglFramebuffer);for(let wl=0;wl<pn;wl++)as&&(st.framebufferTextureLayer(st.READ_FRAMEBUFFER,st.COLOR_ATTACHMENT0,_n.get(ye).__webglTexture,bt,kn+wl),st.framebufferTextureLayer(st.DRAW_FRAMEBUFFER,st.COLOR_ATTACHMENT0,_n.get(it).__webglTexture,mi,or+wl)),st.blitFramebuffer(Vn,Un,bi,ji,Wn,Cn,bi,ji,st.DEPTH_BUFFER_BIT,st.NEAREST);tn.bindFramebuffer(st.READ_FRAMEBUFFER,null),tn.bindFramebuffer(st.DRAW_FRAMEBUFFER,null)}else if(bt!==0||ye.isRenderTargetTexture||_n.has(ye)){const xs=_n.get(ye),Ma=_n.get(it);tn.bindFramebuffer(st.READ_FRAMEBUFFER,Tt),tn.bindFramebuffer(st.DRAW_FRAMEBUFFER,Wt);for(let ma=0;ma<pn;ma++)as?st.framebufferTextureLayer(st.READ_FRAMEBUFFER,st.COLOR_ATTACHMENT0,xs.__webglTexture,bt,kn+ma):st.framebufferTexture2D(st.READ_FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.TEXTURE_2D,xs.__webglTexture,bt),la?st.framebufferTextureLayer(st.DRAW_FRAMEBUFFER,st.COLOR_ATTACHMENT0,Ma.__webglTexture,mi,or+ma):st.framebufferTexture2D(st.DRAW_FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.TEXTURE_2D,Ma.__webglTexture,mi),bt!==0?st.blitFramebuffer(Vn,Un,bi,ji,Wn,Cn,bi,ji,st.COLOR_BUFFER_BIT,st.NEAREST):la?st.copyTexSubImage3D(Qr,mi,Wn,Cn,or+ma,Vn,Un,bi,ji):st.copyTexSubImage2D(Qr,mi,Wn,Cn,Vn,Un,bi,ji);tn.bindFramebuffer(st.READ_FRAMEBUFFER,null),tn.bindFramebuffer(st.DRAW_FRAMEBUFFER,null)}else la?ye.isDataTexture||ye.isData3DTexture?st.texSubImage3D(Qr,mi,Wn,Cn,or,bi,ji,pn,Tn,In,jn.data):it.isCompressedArrayTexture?st.compressedTexSubImage3D(Qr,mi,Wn,Cn,or,bi,ji,pn,Tn,jn.data):st.texSubImage3D(Qr,mi,Wn,Cn,or,bi,ji,pn,Tn,In,jn):ye.isDataTexture?st.texSubImage2D(st.TEXTURE_2D,mi,Wn,Cn,bi,ji,Tn,In,jn.data):ye.isCompressedTexture?st.compressedTexSubImage2D(st.TEXTURE_2D,mi,Wn,Cn,jn.width,jn.height,Tn,jn.data):st.texSubImage2D(st.TEXTURE_2D,mi,Wn,Cn,bi,ji,Tn,In,jn);st.pixelStorei(st.UNPACK_ROW_LENGTH,kr),st.pixelStorei(st.UNPACK_IMAGE_HEIGHT,qs),st.pixelStorei(st.UNPACK_SKIP_PIXELS,bl),st.pixelStorei(st.UNPACK_SKIP_ROWS,Kr),st.pixelStorei(st.UNPACK_SKIP_IMAGES,qa),mi===0&&it.generateMipmaps&&st.generateMipmap(Qr),tn.unbindTexture()},this.initRenderTarget=function(ye){_n.get(ye).__webglFramebuffer===void 0&&Gn.setupRenderTarget(ye)},this.initTexture=function(ye){ye.isCubeTexture?Gn.setTextureCube(ye,0):ye.isData3DTexture?Gn.setTexture3D(ye,0):ye.isDataArrayTexture||ye.isCompressedArrayTexture?Gn.setTexture2DArray(ye,0):Gn.setTexture2D(ye,0),tn.unbindTexture()},this.resetState=function(){je=0,Ce=0,Te=null,tn.reset(),Rt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ud}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=oa._getDrawingBufferColorSpace(e),i.unpackColorSpace=oa._getUnpackColorSpace()}}const fse=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:bI,AddEquation:X_,AddOperation:M5,AdditiveAnimationBlendMode:RI,AdditiveBlending:oR,AgXToneMapping:I5,AlphaFormat:AI,AlwaysCompare:j5,AlwaysDepth:Ob,AlwaysStencilFunc:hR,AmbientLight:Nk,AnimationAction:Xk,AnimationClip:Jb,AnimationLoader:yQ,AnimationMixer:WQ,AnimationObjectGroup:qQ,AnimationUtils:pQ,ArcCurve:ck,ArrayCamera:Hk,ArrowHelper:xee,AttachedBindMode:uR,Audio:jk,AudioAnalyser:OQ,AudioContext:eD,AudioListener:LQ,AudioLoader:RQ,AxesHelper:vee,BackSide:Mc,BasicDepthPacking:s0,BasicShadowMap:s5,BatchedMesh:rk,Bone:BI,BooleanKeyframeTrack:Cy,Box2:nee,Box3:yh,Box3Helper:_ee,BoxGeometry:Ay,BoxHelper:gee,BufferAttribute:Ba,BufferGeometry:Is,BufferGeometryLoader:Gk,ByteType:SI,Cache:lg,Camera:UM,CameraHelper:mee,CanvasTexture:NJ,CapsuleGeometry:WM,CatmullRomCurve3:uk,CineonToneMapping:C5,CircleGeometry:ZM,ClampToEdgeWrapping:Zf,Clock:tD,Color:ar,ColorKeyframeTrack:$I,ColorManagement:oa,CompressedArrayTexture:OJ,CompressedCubeTexture:BJ,CompressedTexture:qM,CompressedTextureLoader:xQ,ConeGeometry:pw,ConstantAlphaFactor:w5,ConstantColorFactor:v5,Controls:wee,CubeCamera:$5,CubeReflectionMapping:i_,CubeRefractionMapping:e0,CubeTexture:fw,CubeTextureLoader:vQ,CubeUVReflectionMapping:yv,CubicBezierCurve:kI,CubicBezierCurve3:hk,CubicInterpolant:Rk,CullFaceBack:aR,CullFaceFront:r5,CullFaceFrontBack:GK,CullFaceNone:n5,Curve:Dm,CurvePath:dk,CustomBlending:a5,CustomToneMapping:R5,CylinderGeometry:dw,Cylindrical:iee,Data3DTexture:FM,DataArrayTexture:NM,DataTexture:Rm,DataTextureLoader:bQ,DataUtils:aJ,DecrementStencilOp:i$,DecrementWrapStencilOp:r$,DefaultLoadingManager:Lk,DepthFormat:nv,DepthStencilFormat:Sy,DepthTexture:XM,DetachedBindMode:L5,DirectionalLight:Bk,DirectionalLightHelper:pee,DiscreteInterpolant:Ik,DodecahedronGeometry:YM,DoubleSide:jf,DstAlphaFactor:m5,DstColorFactor:_5,DynamicCopyUsage:x$,DynamicDrawUsage:d$,DynamicReadUsage:g$,EdgesGeometry:lk,EllipseCurve:KM,EqualCompare:k5,EqualDepth:D2,EqualStencilFunc:l$,EquirectangularReflectionMapping:Bb,EquirectangularRefractionMapping:Nb,Euler:Hd,EventDispatcher:jd,ExternalTexture:FI,ExtrudeGeometry:$M,FileLoader:n_,Float16BufferAttribute:dJ,Float32BufferAttribute:Mr,FloatType:$h,Fog:VM,FogExp2:kM,FramebufferTexture:zJ,FrontSide:fg,Frustum:vv,FrustumArray:jM,GLBufferAttribute:JQ,GLSL1:b$,GLSL3:fR,GreaterCompare:V5,GreaterDepth:P2,GreaterEqualCompare:H5,GreaterEqualDepth:L2,GreaterEqualStencilFunc:f$,GreaterStencilFunc:u$,GridHelper:fee,Group:Hx,HalfFloatType:r0,HemisphereLight:Pk,HemisphereLightHelper:hee,IcosahedronGeometry:JM,ImageBitmapLoader:CQ,ImageLoader:Qb,ImageUtils:W5,IncrementStencilOp:t$,IncrementWrapStencilOp:n$,InstancedBufferAttribute:cv,InstancedBufferGeometry:Vk,InstancedInterleavedBuffer:$Q,InstancedMesh:nk,Int16BufferAttribute:hJ,Int32BufferAttribute:fJ,Int8BufferAttribute:lJ,IntType:RM,InterleavedBuffer:GM,InterleavedBufferAttribute:Ty,Interpolant:_w,InterpolateDiscrete:kb,InterpolateLinear:cM,InterpolateSmooth:kT,InterpolationSamplingMode:T$,InterpolationSamplingType:S$,InvertStencilOp:s$,KeepStencilOp:iy,KeyframeTrack:Dp,LOD:tk,LatheGeometry:QM,Layers:ov,LessCompare:U5,LessDepth:I2,LessEqualCompare:II,LessEqualDepth:by,LessEqualStencilFunc:c$,LessStencilFunc:o$,Light:c0,LightProbe:kk,Line:i0,Line3:aee,LineBasicMaterial:ef,LineCurve:VI,LineCurve3:fk,LineDashedMaterial:Ek,LineLoop:sk,LineSegments:gg,LinearFilter:Do,LinearInterpolant:KI,LinearMipMapLinearFilter:XK,LinearMipMapNearestFilter:qK,LinearMipmapLinearFilter:og,LinearMipmapNearestFilter:fb,LinearSRGBColorSpace:pg,LinearToneMapping:E5,LinearTransfer:Gb,Loader:Kf,LoaderUtils:_R,LoadingManager:JI,LoopOnce:P5,LoopPingPong:O5,LoopRepeat:z5,MOUSE:kK,Material:tu,MaterialLoader:aE,MathUtils:q$,Matrix2:rD,Matrix3:Ps,Matrix4:ps,MaxEquation:u5,Mesh:sc,MeshBasicMaterial:o0,MeshDepthMaterial:WI,MeshDistanceMaterial:ZI,MeshLambertMaterial:Tk,MeshMatcapMaterial:Mk,MeshNormalMaterial:XI,MeshPhongMaterial:wk,MeshPhysicalMaterial:bk,MeshStandardMaterial:qI,MeshToonMaterial:Sk,MinEquation:c5,MirroredRepeatWrapping:Ub,MixOperation:T5,MultiplyBlending:cR,MultiplyOperation:uw,NearestFilter:Fl,NearestMipMapLinearFilter:jK,NearestMipMapNearestFilter:HK,NearestMipmapLinearFilter:Vx,NearestMipmapNearestFilter:wI,NeutralToneMapping:D5,NeverCompare:F5,NeverDepth:R2,NeverStencilFunc:a$,NoBlending:kd,NoColorSpace:Mm,NoToneMapping:Cm,NormalAnimationBlendMode:BM,NormalBlending:dy,NotEqualCompare:G5,NotEqualDepth:z2,NotEqualStencilFunc:h$,NumberKeyframeTrack:Kb,Object3D:va,ObjectLoader:EQ,ObjectSpaceNormalMap:N5,OctahedronGeometry:mw,OneFactor:f5,OneMinusConstantAlphaFactor:S5,OneMinusConstantColorFactor:b5,OneMinusDstAlphaFactor:g5,OneMinusDstColorFactor:y5,OneMinusSrcAlphaFactor:C2,OneMinusSrcColorFactor:p5,OrthographicCamera:wv,PCFShadowMap:AM,PCFSoftShadowMap:hb,PMREMGenerator:vR,Path:dM,PerspectiveCamera:Tc,Plane:j_,PlaneGeometry:bv,PlaneHelper:yee,PointLight:Ok,PointLightHelper:cee,Points:ak,PointsMaterial:NI,PolarGridHelper:dee,PolyhedronGeometry:l0,PositionalAudio:zQ,PropertyBinding:ya,PropertyMixer:qk,QuadraticBezierCurve:GI,QuadraticBezierCurve3:HI,Quaternion:Yf,QuaternionKeyframeTrack:yw,QuaternionLinearInterpolant:Dk,RED_GREEN_RGTC2_Format:oM,RED_RGTC1_Format:sM,REVISION:cw,RGBADepthPacking:B5,RGBAFormat:_h,RGBAIntegerFormat:OM,RGBA_ASTC_10x10_Format:Q2,RGBA_ASTC_10x5_Format:K2,RGBA_ASTC_10x6_Format:$2,RGBA_ASTC_10x8_Format:J2,RGBA_ASTC_12x10_Format:eM,RGBA_ASTC_12x12_Format:tM,RGBA_ASTC_4x4_Format:G2,RGBA_ASTC_5x4_Format:H2,RGBA_ASTC_5x5_Format:j2,RGBA_ASTC_6x5_Format:q2,RGBA_ASTC_6x6_Format:X2,RGBA_ASTC_8x5_Format:W2,RGBA_ASTC_8x6_Format:Z2,RGBA_ASTC_8x8_Format:Y2,RGBA_BPTC_Format:iM,RGBA_ETC2_EAC_Format:V2,RGBA_PVRTC_2BPPV1_Format:F2,RGBA_PVRTC_4BPPV1_Format:N2,RGBA_S3TC_DXT1_Format:pb,RGBA_S3TC_DXT3_Format:mb,RGBA_S3TC_DXT5_Format:gb,RGBDepthPacking:$K,RGBFormat:CI,RGBIntegerFormat:WK,RGB_BPTC_SIGNED_Format:nM,RGB_BPTC_UNSIGNED_Format:rM,RGB_ETC1_Format:U2,RGB_ETC2_Format:k2,RGB_PVRTC_2BPPV1_Format:B2,RGB_PVRTC_4BPPV1_Format:O2,RGB_S3TC_DXT1_Format:db,RGDepthPacking:JK,RGFormat:PM,RGIntegerFormat:zM,RawShaderMaterial:vk,Ray:xv,Raycaster:Wk,RectAreaLight:Fk,RedFormat:LM,RedIntegerFormat:hw,ReinhardToneMapping:A5,RenderTarget:LI,RenderTarget3D:ZQ,RepeatWrapping:Fb,ReplaceStencilOp:e$,ReverseSubtractEquation:l5,RingGeometry:eE,SIGNED_RED_GREEN_RGTC2_Format:lM,SIGNED_RED_RGTC1_Format:aM,SRGBColorSpace:Io,SRGBTransfer:Ha,Scene:Xb,ShaderChunk:Hs,ShaderLib:Sm,ShaderMaterial:bh,ShadowMaterial:xk,Shape:my,ShapeGeometry:tE,ShapePath:bee,ShapeUtils:Am,ShortType:TI,Skeleton:HM,SkeletonHelper:lee,SkinnedMesh:ik,Source:K_,Sphere:Ou,SphereGeometry:gw,Spherical:tee,SphericalHarmonics3:Uk,SplineCurve:jI,SpotLight:zk,SpotLightHelper:oee,Sprite:ek,SpriteMaterial:OI,SrcAlphaFactor:A2,SrcAlphaSaturateFactor:x5,SrcColorFactor:d5,StaticCopyUsage:y$,StaticDrawUsage:Hb,StaticReadUsage:m$,StereoCamera:IQ,StreamCopyUsage:v$,StreamDrawUsage:p$,StreamReadUsage:_$,StringKeyframeTrack:Ry,SubtractEquation:o5,SubtractiveBlending:lR,TOUCH:VK,TangentSpaceNormalMap:a0,TetrahedronGeometry:iE,Texture:Ho,TextureLoader:wQ,TextureUtils:Aee,Timer:QQ,TimestampQuery:w$,TorusGeometry:nE,TorusKnotGeometry:rE,Triangle:qf,TriangleFanDrawMode:KK,TriangleStripDrawMode:YK,TrianglesDrawMode:ZK,TubeGeometry:sE,UVMapping:CM,Uint16BufferAttribute:PI,Uint32BufferAttribute:zI,Uint8BufferAttribute:cJ,Uint8ClampedBufferAttribute:uJ,Uniform:Oa,UniformsGroup:KQ,UniformsLib:tr,UniformsUtils:K5,UnsignedByteType:xh,UnsignedInt101111Type:EI,UnsignedInt248Type:wy,UnsignedInt5999Type:MI,UnsignedIntType:dg,UnsignedShort4444Type:IM,UnsignedShort5551Type:DM,UnsignedShortType:iv,VSMShadowMap:bm,Vector2:$i,Vector3:gt,Vector4:xa,VectorKeyframeTrack:$b,VideoFrameTexture:PJ,VideoTexture:ok,WebGL3DRenderTarget:K$,WebGLArrayRenderTarget:Y$,WebGLCoordinateSystem:Ud,WebGLCubeRenderTarget:J5,WebGLRenderTarget:vh,WebGLRenderer:tV,WebGLUtils:eV,WebGPUCoordinateSystem:rv,WebXRController:VT,WireframeGeometry:yk,WrapAroundEnding:Vb,ZeroCurvatureEnding:oy,ZeroFactor:h5,ZeroSlopeEnding:ly,ZeroStencilOp:QK,createCanvasElement:X5,error:ys,getConsoleFunction:A$,log:qb,setConsoleFunction:E$,warn:ir,warnOnce:sv},Symbol.toStringTag,{value:"Module"}));var F3={exports:{}},U3={},k3={exports:{}},V3={};var ON;function dse(){if(ON)return V3;ON=1;var n=fv();function e(N,k){return N===k&&(N!==0||1/N===1/k)||N!==N&&k!==k}var i=typeof Object.is=="function"?Object.is:e,l=n.useState,h=n.useEffect,g=n.useLayoutEffect,v=n.useDebugValue;function r(N,k){var j=k(),$=l({inst:{value:j,getSnapshot:k}}),re=$[0].inst,ie=$[1];return g(function(){re.value=j,re.getSnapshot=k,C(re)&&ie({inst:re})},[N,j,k]),h(function(){return C(re)&&ie({inst:re}),N(function(){C(re)&&ie({inst:re})})},[N]),v(j),j}function C(N){var k=N.getSnapshot;N=N.value;try{var j=k();return!i(N,j)}catch{return!0}}function I(N,k){return k()}var z=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?I:r;return V3.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:z,V3}var BN;function pse(){return BN||(BN=1,k3.exports=dse()),k3.exports}var NN;function mse(){if(NN)return U3;NN=1;var n=fv(),e=pse();function i(I,z){return I===z&&(I!==0||1/I===1/z)||I!==I&&z!==z}var l=typeof Object.is=="function"?Object.is:i,h=e.useSyncExternalStore,g=n.useRef,v=n.useEffect,r=n.useMemo,C=n.useDebugValue;return U3.useSyncExternalStoreWithSelector=function(I,z,N,k,j){var $=g(null);if($.current===null){var re={hasValue:!1,value:null};$.current=re}else re=$.current;$=r(function(){function Y(Se){if(!ae){if(ae=!0,ue=Se,Se=k(Se),j!==void 0&&re.hasValue){var ze=re.value;if(j(ze,Se))return me=ze}return me=Se}if(ze=me,l(ue,Se))return ze;var je=k(Se);return j!==void 0&&j(ze,je)?(ue=Se,ze):(ue=Se,me=je)}var ae=!1,ue,me,Ae=N===void 0?null:N;return[function(){return Y(z())},Ae===null?void 0:function(){return Y(Ae())}]},[z,N,k,j]);var ie=h(I,$[0],$[1]);return v(function(){re.hasValue=!0,re.value=ie},[ie]),C(ie),ie},U3}var FN;function gse(){return FN||(FN=1,F3.exports=mse()),F3.exports}var _se=gse();const yse=yM(_se),UN=n=>{let e;const i=new Set,l=(I,z)=>{const N=typeof I=="function"?I(e):I;if(!Object.is(N,e)){const k=e;e=z??(typeof N!="object"||N===null)?N:Object.assign({},e,N),i.forEach(j=>j(e,k))}},h=()=>e,r={setState:l,getState:h,getInitialState:()=>C,subscribe:I=>(i.add(I),()=>i.delete(I))},C=e=n(l,h,r);return r},xse=(n=>n?UN(n):UN),{useSyncExternalStoreWithSelector:vse}=yse,bse=n=>n;function wse(n,e=bse,i){const l=vse(n.subscribe,n.getState,n.getInitialState,e,i);return mF.useDebugValue(l),l}const kN=(n,e)=>{const i=xse(n),l=(h,g=e)=>wse(i,h,g);return Object.assign(l,i),l},Sse=((n,e)=>n?kN(n,e):kN);var G3={exports:{}},H3={exports:{}},j3={exports:{}},q3={};var VN;function Tse(){return VN||(VN=1,(function(n){function e(Re,Qe){var et=Re.length;Re.push(Qe);e:for(;0<et;){var Lt=et-1>>>1,jt=Re[Lt];if(0<h(jt,Qe))Re[Lt]=Qe,Re[et]=jt,et=Lt;else break e}}function i(Re){return Re.length===0?null:Re[0]}function l(Re){if(Re.length===0)return null;var Qe=Re[0],et=Re.pop();if(et!==Qe){Re[0]=et;e:for(var Lt=0,jt=Re.length,Ge=jt>>>1;Lt<Ge;){var Et=2*(Lt+1)-1,Vt=Re[Et],ii=Et+1,ki=Re[ii];if(0>h(Vt,et))ii<jt&&0>h(ki,Vt)?(Re[Lt]=ki,Re[ii]=et,Lt=ii):(Re[Lt]=Vt,Re[Et]=et,Lt=Et);else if(ii<jt&&0>h(ki,et))Re[Lt]=ki,Re[ii]=et,Lt=ii;else break e}}return Qe}function h(Re,Qe){var et=Re.sortIndex-Qe.sortIndex;return et!==0?et:Re.id-Qe.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var g=performance;n.unstable_now=function(){return g.now()}}else{var v=Date,r=v.now();n.unstable_now=function(){return v.now()-r}}var C=[],I=[],z=1,N=null,k=3,j=!1,$=!1,re=!1,ie=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,ae=typeof setImmediate<"u"?setImmediate:null;function ue(Re){for(var Qe=i(I);Qe!==null;){if(Qe.callback===null)l(I);else if(Qe.startTime<=Re)l(I),Qe.sortIndex=Qe.expirationTime,e(C,Qe);else break;Qe=i(I)}}function me(Re){if(re=!1,ue(Re),!$)if(i(C)!==null)$=!0,Gt();else{var Qe=i(I);Qe!==null&&kt(me,Qe.startTime-Re)}}var Ae=!1,Se=-1,ze=5,je=-1;function Ce(){return!(n.unstable_now()-je<ze)}function Te(){if(Ae){var Re=n.unstable_now();je=Re;var Qe=!0;try{e:{$=!1,re&&(re=!1,Y(Se),Se=-1),j=!0;var et=k;try{t:{for(ue(Re),N=i(C);N!==null&&!(N.expirationTime>Re&&Ce());){var Lt=N.callback;if(typeof Lt=="function"){N.callback=null,k=N.priorityLevel;var jt=Lt(N.expirationTime<=Re);if(Re=n.unstable_now(),typeof jt=="function"){N.callback=jt,ue(Re),Qe=!0;break t}N===i(C)&&l(C),ue(Re)}else l(C);N=i(C)}if(N!==null)Qe=!0;else{var Ge=i(I);Ge!==null&&kt(me,Ge.startTime-Re),Qe=!1}}break e}finally{N=null,k=et,j=!1}Qe=void 0}}finally{Qe?Ze():Ae=!1}}}var Ze;if(typeof ae=="function")Ze=function(){ae(Te)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,mt=Mt.port2;Mt.port1.onmessage=Te,Ze=function(){mt.postMessage(null)}}else Ze=function(){ie(Te,0)};function Gt(){Ae||(Ae=!0,Ze())}function kt(Re,Qe){Se=ie(function(){Re(n.unstable_now())},Qe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){$||j||($=!0,Gt())},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ze=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return i(C)},n.unstable_next=function(Re){switch(k){case 1:case 2:case 3:var Qe=3;break;default:Qe=k}var et=k;k=Qe;try{return Re()}finally{k=et}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,Qe){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var et=k;k=Re;try{return Qe()}finally{k=et}},n.unstable_scheduleCallback=function(Re,Qe,et){var Lt=n.unstable_now();switch(typeof et=="object"&&et!==null?(et=et.delay,et=typeof et=="number"&&0<et?Lt+et:Lt):et=Lt,Re){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=et+jt,Re={id:z++,callback:Qe,priorityLevel:Re,startTime:et,expirationTime:jt,sortIndex:-1},et>Lt?(Re.sortIndex=et,e(I,Re),i(C)===null&&Re===i(I)&&(re?(Y(Se),Se=-1):re=!0,kt(me,et-Lt))):(Re.sortIndex=jt,e(C,Re),$||j||($=!0,Gt())),Re},n.unstable_shouldYield=Ce,n.unstable_wrapCallback=function(Re){var Qe=k;return function(){var et=k;k=Qe;try{return Re.apply(this,arguments)}finally{k=et}}}})(q3)),q3}var GN;function Mse(){return GN||(GN=1,j3.exports=Tse()),j3.exports}var HN;function Ese(){return HN||(HN=1,(function(n){n.exports=function(e){function i(w,T,B,q){return new Vm(w,T,B,q)}function l(){}function h(w){var T="https://react.dev/errors/"+w;if(1<arguments.length){T+="?args[]="+encodeURIComponent(arguments[1]);for(var B=2;B<arguments.length;B++)T+="&args[]="+encodeURIComponent(arguments[B])}return"Minified React error #"+w+"; visit "+T+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function g(w){return w===null||typeof w!="object"?null:(w=xg&&w[xg]||w["@@iterator"],typeof w=="function"?w:null)}function v(w){if(w==null)return null;if(typeof w=="function")return w.$$typeof===eh?null:w.displayName||w.name||null;if(typeof w=="string")return w;switch(w){case xu:return"Fragment";case pc:return"Portal";case dd:return"Profiler";case fd:return"StrictMode";case Lh:return"Suspense";case xf:return"SuspenseList"}if(typeof w=="object")switch(w.$$typeof){case Bc:return(w.displayName||"Context")+".Provider";case Qu:return(w._context.displayName||"Context")+".Consumer";case yf:var T=w.render;return w=w.displayName,w||(w=T.displayName||T.name||"",w=w!==""?"ForwardRef("+w+")":"ForwardRef"),w;case Gp:return T=w.displayName||null,T!==null?T:v(w.type)||"Memo";case Nc:T=w._payload,w=w._init;try{return v(w(T))}catch{}}return null}function r(w){if(jp===void 0)try{throw Error()}catch(B){var T=B.stack.trim().match(/\n( *(at )?)/);jp=T&&T[1]||"",vf=-1<B.stack.indexOf(`
    at`)?" (<anonymous>)":-1<B.stack.indexOf("@")?"@unknown:0:0":""}return`
`+jp+w+vf}function C(w,T){if(!w||th)return"";th=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var q={DetermineComponentFrameRoot:function(){try{if(T){var En=function(){throw Error()};if(Object.defineProperty(En.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(En,[])}catch(br){var On=br}Reflect.construct(w,[],En)}else{try{En.call()}catch(br){On=br}w.call(En.prototype)}}else{try{throw Error()}catch(br){On=br}(En=w())&&typeof En.catch=="function"&&En.catch(function(){})}}catch(br){if(br&&On&&typeof br.stack=="string")return[br.stack,On.stack]}return[null,null]}};q.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var te=Object.getOwnPropertyDescriptor(q.DetermineComponentFrameRoot,"name");te&&te.configurable&&Object.defineProperty(q.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var fe=q.DetermineComponentFrameRoot(),We=fe[0],vt=fe[1];if(We&&vt){var Ht=We.split(`
`),Ri=vt.split(`
`);for(te=q=0;q<Ht.length&&!Ht[q].includes("DetermineComponentFrameRoot");)q++;for(;te<Ri.length&&!Ri[te].includes("DetermineComponentFrameRoot");)te++;if(q===Ht.length||te===Ri.length)for(q=Ht.length-1,te=Ri.length-1;1<=q&&0<=te&&Ht[q]!==Ri[te];)te--;for(;1<=q&&0<=te;q--,te--)if(Ht[q]!==Ri[te]){if(q!==1||te!==1)do if(q--,te--,0>te||Ht[q]!==Ri[te]){var on=`
`+Ht[q].replace(" at new "," at ");return w.displayName&&on.includes("<anonymous>")&&(on=on.replace("<anonymous>",w.displayName)),on}while(1<=q&&0<=te);break}}}finally{th=!1,Error.prepareStackTrace=B}return(B=w?w.displayName||w.name:"")?r(B):""}function I(w){switch(w.tag){case 26:case 27:case 5:return r(w.type);case 16:return r("Lazy");case 13:return r("Suspense");case 19:return r("SuspenseList");case 0:case 15:return w=C(w.type,!1),w;case 11:return w=C(w.type.render,!1),w;case 1:return w=C(w.type,!0),w;default:return""}}function z(w){try{var T="";do T+=I(w),w=w.return;while(w);return T}catch(B){return`
Error generating stack: `+B.message+`
`+B.stack}}function N(w){var T=w,B=w;if(w.alternate)for(;T.return;)T=T.return;else{w=T;do T=w,(T.flags&4098)!==0&&(B=T.return),w=T.return;while(w)}return T.tag===3?B:null}function k(w){if(N(w)!==w)throw Error(h(188))}function j(w){var T=w.alternate;if(!T){if(T=N(w),T===null)throw Error(h(188));return T!==w?null:w}for(var B=w,q=T;;){var te=B.return;if(te===null)break;var fe=te.alternate;if(fe===null){if(q=te.return,q!==null){B=q;continue}break}if(te.child===fe.child){for(fe=te.child;fe;){if(fe===B)return k(te),w;if(fe===q)return k(te),T;fe=fe.sibling}throw Error(h(188))}if(B.return!==q.return)B=te,q=fe;else{for(var We=!1,vt=te.child;vt;){if(vt===B){We=!0,B=te,q=fe;break}if(vt===q){We=!0,q=te,B=fe;break}vt=vt.sibling}if(!We){for(vt=fe.child;vt;){if(vt===B){We=!0,B=fe,q=te;break}if(vt===q){We=!0,q=fe,B=te;break}vt=vt.sibling}if(!We)throw Error(h(189))}}if(B.alternate!==q)throw Error(h(190))}if(B.tag!==3)throw Error(h(188));return B.stateNode.current===B?w:T}function $(w){var T=w.tag;if(T===5||T===26||T===27||T===6)return w;for(w=w.child;w!==null;){if(T=$(w),T!==null)return T;w=w.sibling}return null}function re(w){var T=w.tag;if(T===5||T===26||T===27||T===6)return w;for(w=w.child;w!==null;){if(w.tag!==4&&(T=re(w),T!==null))return T;w=w.sibling}return null}function ie(w){return{current:w}}function Y(w){0>Ru||(w.current=Ef[Ru],Ef[Ru]=null,Ru--)}function ae(w,T){Ru++,Ef[Ru]=w.current,w.current=T}function ue(w){return w>>>=0,w===0?32:31-(Af(w)/Jl|0)|0}function me(w){var T=w&42;if(T!==0)return T;switch(w&-w){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return w&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return w}}function Ae(w,T){var B=w.pendingLanes;if(B===0)return 0;var q=0,te=w.suspendedLanes,fe=w.pingedLanes,We=w.warmLanes;w=w.finishedLanes!==0;var vt=B&134217727;return vt!==0?(B=vt&~te,B!==0?q=me(B):(fe&=vt,fe!==0?q=me(fe):w||(We=vt&~We,We!==0&&(q=me(We))))):(vt=B&~te,vt!==0?q=me(vt):fe!==0?q=me(fe):w||(We=B&~We,We!==0&&(q=me(We)))),q===0?0:T!==0&&T!==q&&(T&te)===0&&(te=q&-q,We=T&-T,te>=We||te===32&&(We&4194176)!==0)?T:q}function Se(w,T){return(w.pendingLanes&~(w.suspendedLanes&~w.pingedLanes)&T)===0}function ze(w,T){switch(w){case 1:case 2:case 4:case 8:return T+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return T+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function je(){var w=Uh;return Uh<<=1,(Uh&4194176)===0&&(Uh=128),w}function Ce(){var w=Cf;return Cf<<=1,(Cf&62914560)===0&&(Cf=4194304),w}function Te(w){for(var T=[],B=0;31>B;B++)T.push(w);return T}function Ze(w,T){w.pendingLanes|=T,T!==268435456&&(w.suspendedLanes=0,w.pingedLanes=0,w.warmLanes=0)}function Mt(w,T,B,q,te,fe){var We=w.pendingLanes;w.pendingLanes=B,w.suspendedLanes=0,w.pingedLanes=0,w.warmLanes=0,w.expiredLanes&=B,w.entangledLanes&=B,w.errorRecoveryDisabledLanes&=B,w.shellSuspendCounter=0;var vt=w.entanglements,Ht=w.expirationTimes,Ri=w.hiddenUpdates;for(B=We&~B;0<B;){var on=31-io(B),En=1<<on;vt[on]=0,Ht[on]=-1;var On=Ri[on];if(On!==null)for(Ri[on]=null,on=0;on<On.length;on++){var br=On[on];br!==null&&(br.lane&=-536870913)}B&=~En}q!==0&&mt(w,q,0),fe!==0&&te===0&&w.tag!==0&&(w.suspendedLanes|=fe&~(We&~T))}function mt(w,T,B){w.pendingLanes|=T,w.suspendedLanes&=~T;var q=31-io(T);w.entangledLanes|=T,w.entanglements[q]=w.entanglements[q]|1073741824|B&4194218}function Gt(w,T){var B=w.entangledLanes|=T;for(w=w.entanglements;B;){var q=31-io(B),te=1<<q;te&T|w[q]&T&&(w[q]|=T),B&=~te}}function kt(w){return w&=-w,2<w?8<w?(w&134217727)!==0?32:268435456:8:2}function Re(w){if(no&&typeof no.onCommitFiberRoot=="function")try{no.onCommitFiberRoot(mo,w,void 0,(w.current.flags&128)===128)}catch{}}function Qe(w){if(typeof Ed=="function"&&Xc(w),no&&typeof no.setStrictMode=="function")try{no.setStrictMode(mo,w)}catch{}}function et(w,T){return w===T&&(w!==0||1/w===1/T)||w!==w&&T!==T}function Lt(w,T){if(typeof w=="object"&&w!==null){var B=Ad.get(w);return B!==void 0?B:(T={value:w,source:T,stack:z(T)},Ad.set(w,T),T)}return{value:w,source:T,stack:z(T)}}function jt(w,T){ga[Ca++]=pp,ga[Ca++]=If,If=w,pp=T}function Ge(w,T,B){hl[Ql++]=Zc,hl[Ql++]=Pl,hl[Ql++]=Wc,Wc=w;var q=Zc;w=Pl;var te=32-io(q)-1;q&=~(1<<te),B+=1;var fe=32-io(T)+te;if(30<fe){var We=te-te%5;fe=(q&(1<<We)-1).toString(32),q>>=We,te-=We,Zc=1<<32-io(T)+te|B<<te|q,Pl=fe+w}else Zc=1<<fe|B<<te|q,Pl=w}function Et(w){w.return!==null&&(jt(w,1),Ge(w,1,0))}function Vt(w){for(;w===If;)If=ga[--Ca],ga[Ca]=null,pp=ga[--Ca],ga[Ca]=null;for(;w===Wc;)Wc=hl[--Ql],hl[Ql]=null,Pl=hl[--Ql],hl[Ql]=null,Zc=hl[--Ql],hl[Ql]=null}function ii(w,T){ae(yc,T),ae(Cd,w),ae(Mo,null),w=nh(T),Y(Mo),ae(Mo,w)}function ki(){Y(Mo),Y(Cd),Y(yc)}function qt(w){w.memoizedState!==null&&ae(Rd,w);var T=Mo.current,B=vg(T,w.type);T!==B&&(ae(Cd,w),ae(Mo,B))}function xi(w){Cd.current===w&&(Y(Mo),Y(Cd)),Rd.current===w&&(Y(Rd),sh?oi._currentValue=po:oi._currentValue2=po)}function Fi(w){var T=Error(h(418,""));throw xn(Lt(T,w)),Es}function Ui(w,T){if(!cl)throw Error(h(175));c_(w.stateNode,w.type,w.memoizedProps,T,w)||Fi(w)}function rn(w){for(Eo=w.return;Eo;)switch(Eo.tag){case 3:case 27:vc=!0;return;case 5:case 13:vc=!1;return;default:Eo=Eo.return}}function Fn(w){if(!cl||w!==Eo)return!1;if(!Ws)return rn(w),Ws=!0,!1;var T=!1;if(So?w.tag!==3&&w.tag!==27&&(w.tag!==5||Mg(w.type)&&!bu(w.type,w.memoizedProps))&&(T=!0):w.tag!==3&&(w.tag!==5||Mg(w.type)&&!bu(w.type,w.memoizedProps))&&(T=!0),T&&ro&&Fi(w),rn(w),w.tag===13){if(!cl)throw Error(h(316));if(w=w.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(h(317));ro=$p(w)}else ro=Eo?Hc(w.stateNode):null;return!0}function Er(){cl&&(ro=Eo=null,Ws=!1)}function xn(w){xc===null?xc=[w]:xc.push(w)}function Vi(){for(var w=Df,T=mp=Df=0;T<w;){var B=fl[T];fl[T++]=null;var q=fl[T];fl[T++]=null;var te=fl[T];fl[T++]=null;var fe=fl[T];if(fl[T++]=null,q!==null&&te!==null){var We=q.pending;We===null?te.next=te:(te.next=We.next,We.next=te),q.pending=te}fe!==0&&Di(B,te,fe)}}function st(w,T,B,q){fl[Df++]=w,fl[Df++]=T,fl[Df++]=B,fl[Df++]=q,mp|=q,w.lanes|=q,w=w.alternate,w!==null&&(w.lanes|=q)}function Xi(w,T,B,q){return st(w,T,B,q),tn(w)}function Ji(w,T){return st(w,null,null,T),tn(w)}function Di(w,T,B){w.lanes|=B;var q=w.alternate;q!==null&&(q.lanes|=B);for(var te=!1,fe=w.return;fe!==null;)fe.childLanes|=B,q=fe.alternate,q!==null&&(q.childLanes|=B),fe.tag===22&&(w=fe.stateNode,w===null||w._visibility&1||(te=!0)),w=fe,fe=fe.return;te&&T!==null&&w.tag===3&&(fe=w.stateNode,te=31-io(B),fe=fe.hiddenUpdates,w=fe[te],w===null?fe[te]=[T]:w.push(T),T.lane=B|536870912)}function tn(w){if(50<Nr)throw Nr=0,rr=null,Error(h(185));for(var T=w.return;T!==null;)w=T,T=w.return;return w.tag===3?w.stateNode:null}function Sn(w){w!==Iu&&w.next===null&&(Iu===null?gp=Iu=w:Iu=Iu.next=w),Dd=!0,Id||(Id=!0,Li(Gn))}function _n(w,T){if(!ec&&Dd){ec=!0;do for(var B=!1,q=gp;q!==null;){if(w!==0){var te=q.pendingLanes;if(te===0)var fe=0;else{var We=q.suspendedLanes,vt=q.pingedLanes;fe=(1<<31-io(42|w)+1)-1,fe&=te&~(We&~vt),fe=fe&201326677?fe&201326677|1:fe?fe|2:0}fe!==0&&(B=!0,Qt(q,fe))}else fe=pt,fe=Ae(q,q===qe?fe:0),(fe&3)===0||Se(q,fe)||(B=!0,Qt(q,fe));q=q.next}while(B);ec=!1}}function Gn(){Dd=Id=!1;var w=0;dl!==0&&(ah()&&(w=dl),dl=0);for(var T=To(),B=null,q=gp;q!==null;){var te=q.next,fe=ot(q,T);fe===0?(q.next=null,B===null?gp=te:B.next=te,te===null&&(Iu=B)):(B=q,(w!==0||(fe&3)!==0)&&(Dd=!0)),q=te}_n(w)}function ot(w,T){for(var B=w.suspendedLanes,q=w.pingedLanes,te=w.expirationTimes,fe=w.pendingLanes&-62914561;0<fe;){var We=31-io(fe),vt=1<<We,Ht=te[We];Ht===-1?((vt&B)===0||(vt&q)!==0)&&(te[We]=ze(vt,T)):Ht<=T&&(w.expiredLanes|=vt),fe&=~vt}if(T=qe,B=pt,B=Ae(w,w===T?B:0),q=w.callbackNode,B===0||w===T&&Ut===2||w.cancelPendingCommit!==null)return q!==null&&q!==null&&Td(q),w.callbackNode=null,w.callbackPriority=0;if((B&3)===0||Se(w,B)){if(T=B&-B,T===w.callbackPriority)return T;switch(q!==null&&Td(q),kt(B)){case 2:case 8:B=Rf;break;case 32:B=fp;break;case 268435456:B=dp;break;default:B=fp}return q=De.bind(null,w),B=kh(B,q),w.callbackPriority=T,w.callbackNode=B,T}return q!==null&&q!==null&&Td(q),w.callbackPriority=2,w.callbackNode=null,2}function De(w,T){var B=w.callbackNode;if(vo()&&w.callbackNode!==B)return null;var q=pt;return q=Ae(w,w===qe?q:0),q===0?null:(mf(w,q,T),ot(w,To()),w.callbackNode!=null&&w.callbackNode===B?De.bind(null,w):null)}function Qt(w,T){if(vo())return null;mf(w,T,!0)}function Li(w){ha?Su(function(){(nt&6)!==0?kh(tm,w):w()}):kh(tm,w)}function Wi(){return dl===0&&(dl=je()),dl}function Ei(w,T){if(Lf===null){var B=Lf=[];_a=0,Ga=Wi(),Yc={status:"pending",value:void 0,then:function(q){B.push(q)}}}return _a++,T.then(Hn,Hn),T}function Hn(){if(--_a===0&&Lf!==null){Yc!==null&&(Yc.status="fulfilled");var w=Lf;Lf=null,Ga=0,Yc=null;for(var T=0;T<w.length;T++)(0,w[T])()}}function An(w,T){var B=[],q={status:"pending",value:null,reason:null,then:function(te){B.push(te)}};return w.then(function(){q.status="fulfilled",q.value=T;for(var te=0;te<B.length;te++)(0,B[te])(T)},function(te){for(q.status="rejected",q.reason=te,te=0;te<B.length;te++)(0,B[te])(void 0)}),q}function dr(w){w.updateQueue={baseState:w.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Jn(w,T){w=w.updateQueue,T.updateQueue===w&&(T.updateQueue={baseState:w.baseState,firstBaseUpdate:w.firstBaseUpdate,lastBaseUpdate:w.lastBaseUpdate,shared:w.shared,callbacks:null})}function Qi(w){return{lane:w,tag:0,payload:null,callback:null,next:null}}function qi(w,T,B){var q=w.updateQueue;if(q===null)return null;if(q=q.shared,(nt&2)!==0){var te=q.pending;return te===null?T.next=T:(T.next=te.next,te.next=T),q.pending=T,T=tn(w),Di(w,null,B),T}return st(w,q,T,B),tn(w)}function Xn(w,T,B){if(T=T.updateQueue,T!==null&&(T=T.shared,(B&4194176)!==0)){var q=T.lanes;q&=w.pendingLanes,B|=q,T.lanes=B,Gt(w,B)}}function Qn(w,T){var B=w.updateQueue,q=w.alternate;if(q!==null&&(q=q.updateQueue,B===q)){var te=null,fe=null;if(B=B.firstBaseUpdate,B!==null){do{var We={lane:B.lane,tag:B.tag,payload:B.payload,callback:null,next:null};fe===null?te=fe=We:fe=fe.next=We,B=B.next}while(B!==null);fe===null?te=fe=T:fe=fe.next=T}else te=fe=T;B={baseState:q.baseState,firstBaseUpdate:te,lastBaseUpdate:fe,shared:q.shared,callbacks:q.callbacks},w.updateQueue=B;return}w=B.lastBaseUpdate,w===null?B.firstBaseUpdate=T:w.next=T,B.lastBaseUpdate=T}function Nn(){if(oh){var w=Yc;if(w!==null)throw w}}function xr(w,T,B,q){oh=!1;var te=w.updateQueue;Kc=!1;var fe=te.firstBaseUpdate,We=te.lastBaseUpdate,vt=te.shared.pending;if(vt!==null){te.shared.pending=null;var Ht=vt,Ri=Ht.next;Ht.next=null,We===null?fe=Ri:We.next=Ri,We=Ht;var on=w.alternate;on!==null&&(on=on.updateQueue,vt=on.lastBaseUpdate,vt!==We&&(vt===null?on.firstBaseUpdate=Ri:vt.next=Ri,on.lastBaseUpdate=Ht))}if(fe!==null){var En=te.baseState;We=0,on=Ri=Ht=null,vt=fe;do{var On=vt.lane&-536870913,br=On!==vt.lane;if(br?(pt&On)===On:(q&On)===On){On!==0&&On===Ga&&(oh=!0),on!==null&&(on=on.next={lane:0,tag:vt.tag,payload:vt.payload,callback:null,next:null});e:{var is=w,$s=vt;On=T;var Yr=B;switch($s.tag){case 1:if(is=$s.payload,typeof is=="function"){En=is.call(Yr,En,On);break e}En=is;break e;case 3:is.flags=is.flags&-65537|128;case 0:if(is=$s.payload,On=typeof is=="function"?is.call(Yr,En,On):is,On==null)break e;En=Rl({},En,On);break e;case 2:Kc=!0}}On=vt.callback,On!==null&&(w.flags|=64,br&&(w.flags|=8192),br=te.callbacks,br===null?te.callbacks=[On]:br.push(On))}else br={lane:On,tag:vt.tag,payload:vt.payload,callback:vt.callback,next:null},on===null?(Ri=on=br,Ht=En):on=on.next=br,We|=On;if(vt=vt.next,vt===null){if(vt=te.shared.pending,vt===null)break;br=vt,vt=br.next,br.next=null,te.lastBaseUpdate=br,te.shared.pending=null}}while(!0);on===null&&(Ht=En),te.baseState=Ht,te.firstBaseUpdate=Ri,te.lastBaseUpdate=on,fe===null&&(te.shared.lanes=0),Ai|=We,w.lanes=We,w.memoizedState=En}}function Rt(w,T){if(typeof w!="function")throw Error(h(191,w));w.call(T)}function wn(w,T){var B=w.callbacks;if(B!==null)for(w.callbacks=null,w=0;w<B.length;w++)Rt(B[w],T)}function vn(w,T){if(Ll(w,T))return!0;if(typeof w!="object"||w===null||typeof T!="object"||T===null)return!1;var B=Object.keys(w),q=Object.keys(T);if(B.length!==q.length)return!1;for(q=0;q<B.length;q++){var te=B[q];if(!im.call(T,te)||!Ll(w[te],T[te]))return!1}return!0}function bn(w){return w=w.status,w==="fulfilled"||w==="rejected"}function Pi(){}function zi(w,T,B){switch(B=w[B],B===void 0?w.push(T):B!==T&&(T.then(Pi,Pi),T=B),T.status){case"fulfilled":return T.value;case"rejected":throw w=T.reason,w===Ks?Error(h(483)):w;default:if(typeof T.status=="string")T.then(Pi,Pi);else{if(w=qe,w!==null&&100<w.shellSuspendCounter)throw Error(h(482));w=T,w.status="pending",w.then(function(q){if(T.status==="pending"){var te=T;te.status="fulfilled",te.value=q}},function(q){if(T.status==="pending"){var te=T;te.status="rejected",te.reason=q}})}switch(T.status){case"fulfilled":return T.value;case"rejected":throw w=T.reason,w===Ks?Error(h(483)):w}throw lh=T,Ks}}function Kn(){if(lh===null)throw Error(h(459));var w=lh;return lh=null,w}function Dr(w){var T=pl;return pl+=1,$c===null&&($c=[]),zi($c,w,T)}function ls(w,T){T=T.props.ref,w.ref=T!==void 0?T:null}function Ts(w,T){throw T.$$typeof===np?Error(h(525)):(w=Object.prototype.toString.call(T),Error(h(31,w==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":w)))}function Xt(w){var T=w._init;return T(w._payload)}function ja(w){function T(Kt,Pt){if(w){var $t=Kt.deletions;$t===null?(Kt.deletions=[Pt],Kt.flags|=16):$t.push(Pt)}}function B(Kt,Pt){if(!w)return null;for(;Pt!==null;)T(Kt,Pt),Pt=Pt.sibling;return null}function q(Kt){for(var Pt=new Map;Kt!==null;)Kt.key!==null?Pt.set(Kt.key,Kt):Pt.set(Kt.index,Kt),Kt=Kt.sibling;return Pt}function te(Kt,Pt){return Kt=Zo(Kt,Pt),Kt.index=0,Kt.sibling=null,Kt}function fe(Kt,Pt,$t){return Kt.index=$t,w?($t=Kt.alternate,$t!==null?($t=$t.index,$t<Pt?(Kt.flags|=33554434,Pt):$t):(Kt.flags|=33554434,Pt)):(Kt.flags|=1048576,Pt)}function We(Kt){return w&&Kt.alternate===null&&(Kt.flags|=33554434),Kt}function vt(Kt,Pt,$t,ln){return Pt===null||Pt.tag!==6?(Pt=Ju($t,Kt.mode,ln),Pt.return=Kt,Pt):(Pt=te(Pt,$t),Pt.return=Kt,Pt)}function Ht(Kt,Pt,$t,ln){var _r=$t.type;return _r===xu?on(Kt,Pt,$t.props.children,ln,$t.key):Pt!==null&&(Pt.elementType===_r||typeof _r=="object"&&_r!==null&&_r.$$typeof===Nc&&Xt(_r)===Pt.type)?(Pt=te(Pt,$t.props),ls(Pt,$t),Pt.return=Kt,Pt):(Pt=zc($t.type,$t.key,$t.props,null,Kt.mode,ln),ls(Pt,$t),Pt.return=Kt,Pt)}function Ri(Kt,Pt,$t,ln){return Pt===null||Pt.tag!==4||Pt.stateNode.containerInfo!==$t.containerInfo||Pt.stateNode.implementation!==$t.implementation?(Pt=gf($t,Kt.mode,ln),Pt.return=Kt,Pt):(Pt=te(Pt,$t.children||[]),Pt.return=Kt,Pt)}function on(Kt,Pt,$t,ln,_r){return Pt===null||Pt.tag!==7?(Pt=Ih($t,Kt.mode,ln,_r),Pt.return=Kt,Pt):(Pt=te(Pt,$t),Pt.return=Kt,Pt)}function En(Kt,Pt,$t){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint")return Pt=Ju(""+Pt,Kt.mode,$t),Pt.return=Kt,Pt;if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case Oc:return $t=zc(Pt.type,Pt.key,Pt.props,null,Kt.mode,$t),ls($t,Pt),$t.return=Kt,$t;case pc:return Pt=gf(Pt,Kt.mode,$t),Pt.return=Kt,Pt;case Nc:var ln=Pt._init;return Pt=ln(Pt._payload),En(Kt,Pt,$t)}if(ih(Pt)||g(Pt))return Pt=Ih(Pt,Kt.mode,$t,null),Pt.return=Kt,Pt;if(typeof Pt.then=="function")return En(Kt,Dr(Pt),$t);if(Pt.$$typeof===Bc)return En(Kt,nd(Kt,Pt),$t);Ts(Kt,Pt)}return null}function On(Kt,Pt,$t,ln){var _r=Pt!==null?Pt.key:null;if(typeof $t=="string"&&$t!==""||typeof $t=="number"||typeof $t=="bigint")return _r!==null?null:vt(Kt,Pt,""+$t,ln);if(typeof $t=="object"&&$t!==null){switch($t.$$typeof){case Oc:return $t.key===_r?Ht(Kt,Pt,$t,ln):null;case pc:return $t.key===_r?Ri(Kt,Pt,$t,ln):null;case Nc:return _r=$t._init,$t=_r($t._payload),On(Kt,Pt,$t,ln)}if(ih($t)||g($t))return _r!==null?null:on(Kt,Pt,$t,ln,null);if(typeof $t.then=="function")return On(Kt,Pt,Dr($t),ln);if($t.$$typeof===Bc)return On(Kt,Pt,nd(Kt,$t),ln);Ts(Kt,$t)}return null}function br(Kt,Pt,$t,ln,_r){if(typeof ln=="string"&&ln!==""||typeof ln=="number"||typeof ln=="bigint")return Kt=Kt.get($t)||null,vt(Pt,Kt,""+ln,_r);if(typeof ln=="object"&&ln!==null){switch(ln.$$typeof){case Oc:return Kt=Kt.get(ln.key===null?$t:ln.key)||null,Ht(Pt,Kt,ln,_r);case pc:return Kt=Kt.get(ln.key===null?$t:ln.key)||null,Ri(Pt,Kt,ln,_r);case Nc:var Bs=ln._init;return ln=Bs(ln._payload),br(Kt,Pt,$t,ln,_r)}if(ih(ln)||g(ln))return Kt=Kt.get($t)||null,on(Pt,Kt,ln,_r,null);if(typeof ln.then=="function")return br(Kt,Pt,$t,Dr(ln),_r);if(ln.$$typeof===Bc)return br(Kt,Pt,$t,nd(Pt,ln),_r);Ts(Pt,ln)}return null}function is(Kt,Pt,$t,ln){for(var _r=null,Bs=null,Hr=Pt,As=Pt=0,fa=null;Hr!==null&&As<$t.length;As++){Hr.index>As?(fa=Hr,Hr=null):fa=Hr.sibling;var _s=On(Kt,Hr,$t[As],ln);if(_s===null){Hr===null&&(Hr=fa);break}w&&Hr&&_s.alternate===null&&T(Kt,Hr),Pt=fe(_s,Pt,As),Bs===null?_r=_s:Bs.sibling=_s,Bs=_s,Hr=fa}if(As===$t.length)return B(Kt,Hr),Ws&&jt(Kt,As),_r;if(Hr===null){for(;As<$t.length;As++)Hr=En(Kt,$t[As],ln),Hr!==null&&(Pt=fe(Hr,Pt,As),Bs===null?_r=Hr:Bs.sibling=Hr,Bs=Hr);return Ws&&jt(Kt,As),_r}for(Hr=q(Hr);As<$t.length;As++)fa=br(Hr,Kt,As,$t[As],ln),fa!==null&&(w&&fa.alternate!==null&&Hr.delete(fa.key===null?As:fa.key),Pt=fe(fa,Pt,As),Bs===null?_r=fa:Bs.sibling=fa,Bs=fa);return w&&Hr.forEach(function(ic){return T(Kt,ic)}),Ws&&jt(Kt,As),_r}function $s(Kt,Pt,$t,ln){if($t==null)throw Error(h(151));for(var _r=null,Bs=null,Hr=Pt,As=Pt=0,fa=null,_s=$t.next();Hr!==null&&!_s.done;As++,_s=$t.next()){Hr.index>As?(fa=Hr,Hr=null):fa=Hr.sibling;var ic=On(Kt,Hr,_s.value,ln);if(ic===null){Hr===null&&(Hr=fa);break}w&&Hr&&ic.alternate===null&&T(Kt,Hr),Pt=fe(ic,Pt,As),Bs===null?_r=ic:Bs.sibling=ic,Bs=ic,Hr=fa}if(_s.done)return B(Kt,Hr),Ws&&jt(Kt,As),_r;if(Hr===null){for(;!_s.done;As++,_s=$t.next())_s=En(Kt,_s.value,ln),_s!==null&&(Pt=fe(_s,Pt,As),Bs===null?_r=_s:Bs.sibling=_s,Bs=_s);return Ws&&jt(Kt,As),_r}for(Hr=q(Hr);!_s.done;As++,_s=$t.next())_s=br(Hr,Kt,As,_s.value,ln),_s!==null&&(w&&_s.alternate!==null&&Hr.delete(_s.key===null?As:_s.key),Pt=fe(_s,Pt,As),Bs===null?_r=_s:Bs.sibling=_s,Bs=_s);return w&&Hr.forEach(function(Lu){return T(Kt,Lu)}),Ws&&jt(Kt,As),_r}function Yr(Kt,Pt,$t,ln){if(typeof $t=="object"&&$t!==null&&$t.type===xu&&$t.key===null&&($t=$t.props.children),typeof $t=="object"&&$t!==null){switch($t.$$typeof){case Oc:e:{for(var _r=$t.key;Pt!==null;){if(Pt.key===_r){if(_r=$t.type,_r===xu){if(Pt.tag===7){B(Kt,Pt.sibling),ln=te(Pt,$t.props.children),ln.return=Kt,Kt=ln;break e}}else if(Pt.elementType===_r||typeof _r=="object"&&_r!==null&&_r.$$typeof===Nc&&Xt(_r)===Pt.type){B(Kt,Pt.sibling),ln=te(Pt,$t.props),ls(ln,$t),ln.return=Kt,Kt=ln;break e}B(Kt,Pt);break}else T(Kt,Pt);Pt=Pt.sibling}$t.type===xu?(ln=Ih($t.props.children,Kt.mode,ln,$t.key),ln.return=Kt,Kt=ln):(ln=zc($t.type,$t.key,$t.props,null,Kt.mode,ln),ls(ln,$t),ln.return=Kt,Kt=ln)}return We(Kt);case pc:e:{for(_r=$t.key;Pt!==null;){if(Pt.key===_r)if(Pt.tag===4&&Pt.stateNode.containerInfo===$t.containerInfo&&Pt.stateNode.implementation===$t.implementation){B(Kt,Pt.sibling),ln=te(Pt,$t.children||[]),ln.return=Kt,Kt=ln;break e}else{B(Kt,Pt);break}else T(Kt,Pt);Pt=Pt.sibling}ln=gf($t,Kt.mode,ln),ln.return=Kt,Kt=ln}return We(Kt);case Nc:return _r=$t._init,$t=_r($t._payload),Yr(Kt,Pt,$t,ln)}if(ih($t))return is(Kt,Pt,$t,ln);if(g($t)){if(_r=g($t),typeof _r!="function")throw Error(h(150));return $t=_r.call($t),$s(Kt,Pt,$t,ln)}if(typeof $t.then=="function")return Yr(Kt,Pt,Dr($t),ln);if($t.$$typeof===Bc)return Yr(Kt,Pt,nd(Kt,$t),ln);Ts(Kt,$t)}return typeof $t=="string"&&$t!==""||typeof $t=="number"||typeof $t=="bigint"?($t=""+$t,Pt!==null&&Pt.tag===6?(B(Kt,Pt.sibling),ln=te(Pt,$t),ln.return=Kt,Kt=ln):(B(Kt,Pt),ln=Ju($t,Kt.mode,ln),ln.return=Kt,Kt=ln),We(Kt)):B(Kt,Pt)}return function(Kt,Pt,$t,ln){try{pl=0;var _r=Yr(Kt,Pt,$t,ln);return $c=null,_r}catch(Hr){if(Hr===Ks)throw Hr;var Bs=i(29,Hr,null,Kt.mode);return Bs.lanes=ln,Bs.return=Kt,Bs}finally{}}}function $f(w,T){w=Zi,ae(so,w),ae(Fo,T),Zi=w|T.baseLanes}function ac(){ae(so,Zi),ae(Fo,Fo.current)}function Ar(){Zi=so.current,Y(Fo),Y(so)}function js(w){var T=w.alternate;ae(na,na.current&1),ae(ao,w),Ao===null&&(T===null||Fo.current!==null||T.memoizedState!==null)&&(Ao=w)}function Bu(w){if(w.tag===22){if(ae(na,na.current),ae(ao,w),Ao===null){var T=w.alternate;T!==null&&T.memoizedState!==null&&(Ao=w)}}else Lo()}function Lo(){ae(na,na.current),ae(ao,ao.current)}function jo(w){Y(ao),Ao===w&&(Ao=null),Y(na)}function ft(w){for(var T=w;T!==null;){if(T.tag===13){var B=T.memoizedState;if(B!==null&&(B=B.dehydrated,B===null||Mi(B)||Au(B)))return T}else if(T.tag===19&&T.memoizedProps.revealOrder!==void 0){if((T.flags&128)!==0)return T}else if(T.child!==null){T.child.return=T,T=T.child;continue}if(T===w)break;for(;T.sibling===null;){if(T.return===null||T.return===w)return null;T=T.return}T.sibling.return=T.return,T=T.sibling}return null}function oe(){throw Error(h(321))}function ge(w,T){if(T===null)return!1;for(var B=0;B<T.length&&B<w.length;B++)if(!Ll(w[B],T[B]))return!1;return!0}function Ie(w,T,B,q,te,fe){return ch=fe,gs=T,T.memoizedState=null,T.updateQueue=null,T.lanes=0,Vr.H=w===null||w.memoizedState===null?wa:lo,go=!1,fe=B(q,te),go=!1,cs&&(fe=Ke(T,B,q,te)),$e(w),fe}function $e(w){Vr.H=rs;var T=ta!==null&&ta.next!==null;if(ch=0,oo=ta=gs=null,tc=!1,Wa=0,Du=null,T)throw Error(h(300));w===null||b||(w=w.dependencies,w!==null&&Fu(w)&&(b=!0))}function Ke(w,T,B,q){gs=w;var te=0;do{if(cs&&(Du=null),Wa=0,cs=!1,25<=te)throw Error(h(301));if(te+=1,oo=ta=null,w.updateQueue!=null){var fe=w.updateQueue;fe.lastEffect=null,fe.events=null,fe.stores=null,fe.memoCache!=null&&(fe.memoCache.index=0)}Vr.H=p,fe=T(B,q)}while(cs);return fe}function at(){var w=Vr.H,T=w.useState()[0];return T=typeof T.then=="function"?it(T):T,w=w.useState()[0],(ta!==null?ta.memoizedState:null)!==w&&(gs.flags|=1024),T}function At(){var w=zf!==0;return zf=0,w}function lt(w,T,B){T.updateQueue=w.updateQueue,T.flags&=-2053,w.lanes&=~B}function Tt(w){if(tc){for(w=w.memoizedState;w!==null;){var T=w.queue;T!==null&&(T.pending=null),w=w.next}tc=!1}ch=0,oo=ta=gs=null,cs=!1,Wa=zf=0,Du=null}function Wt(){var w={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oo===null?gs.memoizedState=oo=w:oo=oo.next=w,oo}function ye(){if(ta===null){var w=gs.alternate;w=w!==null?w.memoizedState:null}else w=ta.next;var T=oo===null?gs.memoizedState:oo.next;if(T!==null)oo=T,ta=w;else{if(w===null)throw gs.alternate===null?Error(h(467)):Error(h(310));ta=w,w={memoizedState:ta.memoizedState,baseState:ta.baseState,baseQueue:ta.baseQueue,queue:ta.queue,next:null},oo===null?gs.memoizedState=oo=w:oo=oo.next=w}return oo}function it(w){var T=Wa;return Wa+=1,Du===null&&(Du=[]),w=zi(Du,w,T),T=gs,(oo===null?T.memoizedState:oo.next)===null&&(T=T.alternate,Vr.H=T===null||T.memoizedState===null?wa:lo),w}function wt(w){if(w!==null&&typeof w=="object"){if(typeof w.then=="function")return it(w);if(w.$$typeof===Bc)return uo(w)}throw Error(h(438,String(w)))}function ht(w){var T=null,B=gs.updateQueue;if(B!==null&&(T=B.memoCache),T==null){var q=gs.alternate;q!==null&&(q=q.updateQueue,q!==null&&(q=q.memoCache,q!=null&&(T={data:q.data.map(function(te){return te.slice()}),index:0})))}if(T==null&&(T={data:[],index:0}),B===null&&(B=zl(),gs.updateQueue=B),B.memoCache=T,B=T.data[T.index],B===void 0)for(B=T.data[T.index]=Array(w),q=0;q<w;q++)B[q]=Hp;return T.index++,B}function bt(w,T){return typeof T=="function"?T(w):T}function mi(w){var T=ye();return bi(T,ta,w)}function bi(w,T,B){var q=w.queue;if(q===null)throw Error(h(311));q.lastRenderedReducer=B;var te=w.baseQueue,fe=q.pending;if(fe!==null){if(te!==null){var We=te.next;te.next=fe.next,fe.next=We}T.baseQueue=te=fe,q.pending=null}if(fe=w.baseState,te===null)w.memoizedState=fe;else{T=te.next;var vt=We=null,Ht=null,Ri=T,on=!1;do{var En=Ri.lane&-536870913;if(En!==Ri.lane?(pt&En)===En:(ch&En)===En){var On=Ri.revertLane;if(On===0)Ht!==null&&(Ht=Ht.next={lane:0,revertLane:0,action:Ri.action,hasEagerState:Ri.hasEagerState,eagerState:Ri.eagerState,next:null}),En===Ga&&(on=!0);else if((ch&On)===On){Ri=Ri.next,On===Ga&&(on=!0);continue}else En={lane:0,revertLane:Ri.revertLane,action:Ri.action,hasEagerState:Ri.hasEagerState,eagerState:Ri.eagerState,next:null},Ht===null?(vt=Ht=En,We=fe):Ht=Ht.next=En,gs.lanes|=On,Ai|=On;En=Ri.action,go&&B(fe,En),fe=Ri.hasEagerState?Ri.eagerState:B(fe,En)}else On={lane:En,revertLane:Ri.revertLane,action:Ri.action,hasEagerState:Ri.hasEagerState,eagerState:Ri.eagerState,next:null},Ht===null?(vt=Ht=On,We=fe):Ht=Ht.next=On,gs.lanes|=En,Ai|=En;Ri=Ri.next}while(Ri!==null&&Ri!==T);if(Ht===null?We=fe:Ht.next=vt,!Ll(fe,w.memoizedState)&&(b=!0,on&&(B=Yc,B!==null)))throw B;w.memoizedState=fe,w.baseState=We,w.baseQueue=Ht,q.lastRenderedState=fe}return te===null&&(q.lanes=0),[w.memoizedState,q.dispatch]}function ji(w){var T=ye(),B=T.queue;if(B===null)throw Error(h(311));B.lastRenderedReducer=w;var q=B.dispatch,te=B.pending,fe=T.memoizedState;if(te!==null){B.pending=null;var We=te=te.next;do fe=w(fe,We.action),We=We.next;while(We!==te);Ll(fe,T.memoizedState)||(b=!0),T.memoizedState=fe,T.baseQueue===null&&(T.baseState=fe),B.lastRenderedState=fe}return[fe,q]}function pn(w,T,B){var q=gs,te=ye(),fe=Ws;if(fe){if(B===void 0)throw Error(h(407));B=B()}else B=T();var We=!Ll((ta||te).memoizedState,B);if(We&&(te.memoizedState=B,b=!0),te=te.queue,kl(kn.bind(null,q,te,w),[w]),te.getSnapshot!==T||We||oo!==null&&oo.memoizedState.tag&1){if(q.flags|=2048,ma(9,Un.bind(null,q,te,B,T),{destroy:void 0},null),qe===null)throw Error(h(349));fe||(ch&60)!==0||Vn(q,T,B)}return B}function Vn(w,T,B){w.flags|=16384,w={getSnapshot:T,value:B},T=gs.updateQueue,T===null?(T=zl(),gs.updateQueue=T,T.stores=[w]):(B=T.stores,B===null?T.stores=[w]:B.push(w))}function Un(w,T,B,q){T.value=B,T.getSnapshot=q,Wn(T)&&Cn(w)}function kn(w,T,B){return B(function(){Wn(T)&&Cn(w)})}function Wn(w){var T=w.getSnapshot;w=w.value;try{var B=T();return!Ll(w,B)}catch{return!0}}function Cn(w){var T=Ji(w,2);T!==null&&Ua(T,w,2)}function or(w){var T=Wt();if(typeof w=="function"){var B=w;if(w=B(),go){Qe(!0);try{B()}finally{Qe(!1)}}}return T.memoizedState=T.baseState=w,T.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bt,lastRenderedState:w},T}function jn(w,T,B,q){return w.baseState=B,bi(w,ta,typeof q=="function"?q:bt)}function Tn(w,T,B,q,te){if(wr(w))throw Error(h(485));if(w=T.action,w!==null){var fe={payload:te,action:w,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(We){fe.listeners.push(We)}};Vr.T!==null?B(!0):fe.isTransition=!1,q(fe),B=T.pending,B===null?(fe.next=T.pending=fe,In(T,fe)):(fe.next=B.next,T.pending=B.next=fe)}}function In(w,T){var B=T.action,q=T.payload,te=w.state;if(T.isTransition){var fe=Vr.T,We={};Vr.T=We;try{var vt=B(te,q),Ht=Vr.S;Ht!==null&&Ht(We,vt),Qr(w,T,vt)}catch(Ri){qs(w,T,Ri)}finally{Vr.T=fe}}else try{fe=B(te,q),Qr(w,T,fe)}catch(Ri){qs(w,T,Ri)}}function Qr(w,T,B){B!==null&&typeof B=="object"&&typeof B.then=="function"?B.then(function(q){kr(w,T,q)},function(q){return qs(w,T,q)}):kr(w,T,B)}function kr(w,T,B){T.status="fulfilled",T.value=B,bl(T),w.state=B,T=w.pending,T!==null&&(B=T.next,B===T?w.pending=null:(B=B.next,T.next=B,In(w,B)))}function qs(w,T,B){var q=w.pending;if(w.pending=null,q!==null){q=q.next;do T.status="rejected",T.reason=B,bl(T),T=T.next;while(T!==q)}w.action=null}function bl(w){w=w.listeners;for(var T=0;T<w.length;T++)(0,w[T])()}function Kr(w,T){return T}function qa(w,T){if(Ws){var B=qe.formState;if(B!==null){e:{var q=gs;if(Ws){if(ro){var te=Sg(ro,vc);if(te){ro=Hc(te),q=Yp(te);break e}}Fi(q)}q=!1}q&&(T=B[0])}}B=Wt(),B.memoizedState=B.baseState=T,q={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kr,lastRenderedState:T},B.queue=q,B=zm.bind(null,gs,q),q.dispatch=B,q=or(!1);var fe=nf.bind(null,gs,!1,q.queue);return q=Wt(),te={state:T,dispatch:null,action:w,pending:null},q.queue=te,B=Tn.bind(null,gs,te,fe,B),te.dispatch=B,q.memoizedState=w,[T,B,!1]}function as(w){var T=ye();return la(T,ta,w)}function la(w,T,B){T=bi(w,T,Kr)[0],w=mi(bt)[0],T=typeof T=="object"&&T!==null&&typeof T.then=="function"?it(T):T;var q=ye(),te=q.queue,fe=te.dispatch;return B!==q.memoizedState&&(gs.flags|=2048,ma(9,xs.bind(null,te,B),{destroy:void 0},null)),[T,fe,w]}function xs(w,T){w.action=T}function Ma(w){var T=ye(),B=ta;if(B!==null)return la(T,B,w);ye(),T=T.memoizedState,B=ye();var q=B.queue.dispatch;return B.memoizedState=w,[T,q,!1]}function ma(w,T,B,q){return w={tag:w,create:T,inst:B,deps:q,next:null},T=gs.updateQueue,T===null&&(T=zl(),gs.updateQueue=T),B=T.lastEffect,B===null?T.lastEffect=w.next=w:(q=B.next,B.next=w,w.next=q,T.lastEffect=w),w}function Ul(){return ye().memoizedState}function wl(w,T,B,q){var te=Wt();gs.flags|=w,te.memoizedState=ma(1|T,B,{destroy:void 0},q===void 0?null:q)}function tf(w,T,B,q){var te=ye();q=q===void 0?null:q;var fe=te.memoizedState.inst;ta!==null&&q!==null&&ge(q,ta.memoizedState.deps)?te.memoizedState=ma(T,B,fe,q):(gs.flags|=w,te.memoizedState=ma(1|T,B,fe,q))}function Jf(w,T){wl(8390656,8,w,T)}function kl(w,T){tf(2048,8,w,T)}function tl(w,T){return tf(4,2,w,T)}function Cc(w,T){return tf(4,4,w,T)}function Sl(w,T){if(typeof T=="function"){w=w();var B=T(w);return function(){typeof B=="function"?B():T(null)}}if(T!=null)return w=w(),T.current=w,function(){T.current=null}}function Ka(w,T,B){B=B!=null?B.concat([w]):null,tf(4,4,Sl.bind(null,T,w),B)}function Vl(){}function iu(w,T){var B=ye();T=T===void 0?null:T;var q=B.memoizedState;return T!==null&&ge(T,q[1])?q[0]:(B.memoizedState=[w,T],w)}function oc(w,T){var B=ye();T=T===void 0?null:T;var q=B.memoizedState;if(T!==null&&ge(T,q[1]))return q[0];if(q=w(),go){Qe(!0);try{w()}finally{Qe(!1)}}return B.memoizedState=[q,T],q}function nu(w,T,B){return B===void 0||(ch&1073741824)!==0?w.memoizedState=T:(w.memoizedState=B,w=ol(),gs.lanes|=w,Ai|=w,B)}function wh(w,T,B,q){return Ll(B,T)?B:Fo.current!==null?(w=nu(w,B,q),Ll(w,T)||(b=!0),w):(ch&42)===0?(b=!0,w.memoizedState=B):(w=ol(),gs.lanes|=w,Ai|=w,T)}function Qf(w,T,B,q,te){var fe=La();ka(fe!==0&&8>fe?fe:8);var We=Vr.T,vt={};Vr.T=vt,nf(w,!1,T,B);try{var Ht=te(),Ri=Vr.S;if(Ri!==null&&Ri(vt,Ht),Ht!==null&&typeof Ht=="object"&&typeof Ht.then=="function"){var on=An(Ht,q);Sh(w,T,on,Qa(w))}else Sh(w,T,q,Qa(w))}catch(En){Sh(w,T,{then:function(){},status:"rejected",reason:En},Qa())}finally{ka(fe),Vr.T=We}}function Pm(w){var T=w.memoizedState;if(T!==null)return T;T={memoizedState:po,baseState:po,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:bt,lastRenderedState:po},next:null};var B={};return T.next={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:bt,lastRenderedState:B},next:null},w.memoizedState=T,w=w.alternate,w!==null&&(w.memoizedState=T),T}function ru(){return uo(oi)}function Na(){return ye().memoizedState}function ed(){return ye().memoizedState}function su(w){for(var T=w.return;T!==null;){switch(T.tag){case 24:case 3:var B=Qa();w=Qi(B);var q=qi(T,w,B);q!==null&&(Ua(q,T,B),Xn(q,T,B)),T={cache:xo()},w.payload=T;return}T=T.return}}function il(w,T,B){var q=Qa();B={lane:q,revertLane:0,action:B,hasEagerState:!1,eagerState:null,next:null},wr(w)?rf(T,B):(B=Xi(w,T,B,q),B!==null&&(Ua(B,w,q),Lp(B,T,q)))}function zm(w,T,B){var q=Qa();Sh(w,T,B,q)}function Sh(w,T,B,q){var te={lane:q,revertLane:0,action:B,hasEagerState:!1,eagerState:null,next:null};if(wr(w))rf(T,te);else{var fe=w.alternate;if(w.lanes===0&&(fe===null||fe.lanes===0)&&(fe=T.lastRenderedReducer,fe!==null))try{var We=T.lastRenderedState,vt=fe(We,B);if(te.hasEagerState=!0,te.eagerState=vt,Ll(vt,We))return st(w,T,te,0),qe===null&&Vi(),!1}catch{}finally{}if(B=Xi(w,T,te,q),B!==null)return Ua(B,w,q),Lp(B,T,q),!0}return!1}function nf(w,T,B,q){if(q={lane:2,revertLane:Wi(),action:q,hasEagerState:!1,eagerState:null,next:null},wr(w)){if(T)throw Error(h(479))}else T=Xi(w,B,q,2),T!==null&&Ua(T,w,2)}function wr(w){var T=w.alternate;return w===gs||T!==null&&T===gs}function rf(w,T){cs=tc=!0;var B=w.pending;B===null?T.next=T:(T.next=B.next,B.next=T),w.pending=T}function Lp(w,T,B){if((B&4194176)!==0){var q=T.lanes;q&=w.pendingLanes,B|=q,T.lanes=B,Gt(w,B)}}function qo(w,T,B,q){T=w.memoizedState,B=B(q,T),B=B==null?T:Rl({},T,B),w.memoizedState=B,w.lanes===0&&(w.updateQueue.baseState=B)}function Th(w,T,B,q,te,fe,We){return w=w.stateNode,typeof w.shouldComponentUpdate=="function"?w.shouldComponentUpdate(q,fe,We):T.prototype&&T.prototype.isPureReactComponent?!vn(B,q)||!vn(te,fe):!0}function Rc(w,T,B,q){w=T.state,typeof T.componentWillReceiveProps=="function"&&T.componentWillReceiveProps(B,q),typeof T.UNSAFE_componentWillReceiveProps=="function"&&T.UNSAFE_componentWillReceiveProps(B,q),T.state!==w&&s.enqueueReplaceState(T,T.state,null)}function Tl(w,T){var B=T;if("ref"in T){B={};for(var q in T)q!=="ref"&&(B[q]=T[q])}if(w=w.defaultProps){B===T&&(B=Rl({},B));for(var te in w)B[te]===void 0&&(B[te]=w[te])}return B}function sf(w,T){try{var B=w.onUncaughtError;B(T.value,{componentStack:T.stack})}catch(q){setTimeout(function(){throw q})}}function qd(w,T,B){try{var q=w.onCaughtError;q(B.value,{componentStack:B.stack,errorBoundary:T.tag===1?T.stateNode:null})}catch(te){setTimeout(function(){throw te})}}function af(w,T,B){return B=Qi(B),B.tag=3,B.payload={element:null},B.callback=function(){sf(w,T)},B}function Ml(w){return w=Qi(w),w.tag=3,w}function Mh(w,T,B,q){var te=B.type.getDerivedStateFromError;if(typeof te=="function"){var fe=q.value;w.payload=function(){return te(fe)},w.callback=function(){qd(T,B,q)}}var We=B.stateNode;We!==null&&typeof We.componentDidCatch=="function"&&(w.callback=function(){qd(T,B,q),typeof te!="function"&&(Sr===null?Sr=new Set([this]):Sr.add(this));var vt=q.stack;this.componentDidCatch(q.value,{componentStack:vt!==null?vt:""})})}function Om(w,T,B,q,te){if(B.flags|=32768,q!==null&&typeof q=="object"&&typeof q.then=="function"){if(T=B.alternate,T!==null&&Gl(T,B,te,!0),B=ao.current,B!==null){switch(B.tag){case 13:return Ao===null?Xl():B.alternate===null&&Si===0&&(Si=3),B.flags&=-257,B.flags|=65536,B.lanes=te,q===Ym?B.flags|=16384:(T=B.updateQueue,T===null?B.updateQueue=new Set([q]):T.add(q),ud(w,q,te)),!1;case 22:return B.flags|=65536,q===Ym?B.flags|=16384:(T=B.updateQueue,T===null?(T={transitions:null,markerInstances:null,retryQueue:new Set([q])},B.updateQueue=T):(B=T.retryQueue,B===null?T.retryQueue=new Set([q]):B.add(q)),ud(w,q,te)),!1}throw Error(h(435,B.tag))}return ud(w,q,te),Xl(),!1}if(Ws)return T=ao.current,T!==null?((T.flags&65536)===0&&(T.flags|=256),T.flags|=65536,T.lanes=te,q!==Es&&(w=Error(h(422),{cause:q}),xn(Lt(w,B)))):(q!==Es&&(T=Error(h(423),{cause:q}),xn(Lt(T,B))),w=w.current.alternate,w.flags|=65536,te&=-te,w.lanes|=te,q=Lt(q,B),te=af(w.stateNode,q,te),Qn(w,te),Si!==4&&(Si=2)),!1;var fe=Error(h(520),{cause:q});if(fe=Lt(fe,B),Lr===null?Lr=[fe]:Lr.push(fe),Si!==4&&(Si=2),T===null)return!0;q=Lt(q,B),B=T;do{switch(B.tag){case 3:return B.flags|=65536,w=te&-te,B.lanes|=w,w=af(B.stateNode,q,w),Qn(B,w),!1;case 1:if(T=B.type,fe=B.stateNode,(B.flags&128)===0&&(typeof T.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(Sr===null||!Sr.has(fe))))return B.flags|=65536,te&=-te,B.lanes|=te,te=Ml(te),Mh(te,w,B,q),Qn(B,te),!1}B=B.return}while(B!==null);return!1}function Da(w,T,B,q){T.child=w===null?Pf(T,null,B,q):Jc(T,w.child,B,q)}function of(w,T,B,q,te){B=B.render;var fe=T.ref;if("ref"in q){var We={};for(var vt in q)vt!=="ref"&&(We[vt]=q[vt])}else We=q;return au(T),q=Ie(w,T,B,We,fe,te),vt=At(),w!==null&&!b?(lt(w,T,te),zo(w,T,te)):(Ws&&vt&&Et(T),T.flags|=1,Da(w,T,q,te),T.child)}function Po(w,T,B,q,te){if(w===null){var fe=B.type;return typeof fe=="function"&&!Zl(fe)&&fe.defaultProps===void 0&&B.compare===null?(T.tag=15,T.type=fe,td(w,T,fe,q,te)):(w=zc(B.type,null,q,T,T.mode,te),w.ref=T.ref,w.return=T,T.child=w)}if(fe=w.child,!Xr(w,te)){var We=fe.memoizedProps;if(B=B.compare,B=B!==null?B:vn,B(We,q)&&w.ref===T.ref)return zo(w,T,te)}return T.flags|=1,w=Zo(fe,q),w.ref=T.ref,w.return=T,T.child=w}function td(w,T,B,q,te){if(w!==null){var fe=w.memoizedProps;if(vn(fe,q)&&w.ref===T.ref)if(b=!1,T.pendingProps=q=fe,Xr(w,te))(w.flags&131072)!==0&&(b=!0);else return T.lanes=w.lanes,zo(w,T,te)}return Bm(w,T,B,q,te)}function Xd(w,T,B){var q=T.pendingProps,te=q.children,fe=(T.stateNode._pendingVisibility&2)!==0,We=w!==null?w.memoizedState:null;if(qr(w,T),q.mode==="hidden"||fe){if((T.flags&128)!==0){if(q=We!==null?We.baseLanes|B:B,w!==null){for(te=T.child=w.child,fe=0;te!==null;)fe=fe|te.lanes|te.childLanes,te=te.sibling;T.childLanes=fe&~q}else T.childLanes=0,T.child=null;return lc(w,T,q,B)}if((B&536870912)!==0)T.memoizedState={baseLanes:0,cachePool:null},w!==null&&Uu(T,We!==null?We.cachePool:null),We!==null?$f(T,We):ac(),Bu(T);else return T.lanes=T.childLanes=536870912,lc(w,T,We!==null?We.baseLanes|B:B,B)}else We!==null?(Uu(T,We.cachePool),$f(T,We),Lo(),T.memoizedState=null):(w!==null&&Uu(T,null),ac(),Lo());return Da(w,T,te,B),T.child}function lc(w,T,B,q){var te=Fa();return te=te===null?null:{parent:sh?K._currentValue:K._currentValue2,pool:te},T.memoizedState={baseLanes:B,cachePool:te},w!==null&&Uu(T,null),ac(),Bu(T),w!==null&&Gl(w,T,q,!0),null}function qr(w,T){var B=T.ref;if(B===null)w!==null&&w.ref!==null&&(T.flags|=2097664);else{if(typeof B!="function"&&typeof B!="object")throw Error(h(284));(w===null||w.ref!==B)&&(T.flags|=2097664)}}function Bm(w,T,B,q,te){return au(T),B=Ie(w,T,B,q,void 0,te),q=At(),w!==null&&!b?(lt(w,T,te),zo(w,T,te)):(Ws&&q&&Et(T),T.flags|=1,Da(w,T,B,te),T.child)}function _g(w,T,B,q,te,fe){return au(T),T.updateQueue=null,B=Ke(T,q,B,te),$e(w),q=At(),w!==null&&!b?(lt(w,T,fe),zo(w,T,fe)):(Ws&&q&&Et(T),T.flags|=1,Da(w,T,B,fe),T.child)}function Nm(w,T,B,q,te){if(au(T),T.stateNode===null){var fe=Fh,We=B.contextType;typeof We=="object"&&We!==null&&(fe=uo(We)),fe=new B(q,fe),T.memoizedState=fe.state!==null&&fe.state!==void 0?fe.state:null,fe.updater=s,T.stateNode=fe,fe._reactInternals=T,fe=T.stateNode,fe.props=q,fe.state=T.memoizedState,fe.refs={},dr(T),We=B.contextType,fe.context=typeof We=="object"&&We!==null?uo(We):Fh,fe.state=T.memoizedState,We=B.getDerivedStateFromProps,typeof We=="function"&&(qo(T,B,We,q),fe.state=T.memoizedState),typeof B.getDerivedStateFromProps=="function"||typeof fe.getSnapshotBeforeUpdate=="function"||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(We=fe.state,typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount(),We!==fe.state&&s.enqueueReplaceState(fe,fe.state,null),xr(T,q,fe,te),Nn(),fe.state=T.memoizedState),typeof fe.componentDidMount=="function"&&(T.flags|=4194308),q=!0}else if(w===null){fe=T.stateNode;var vt=T.memoizedProps,Ht=Tl(B,vt);fe.props=Ht;var Ri=fe.context,on=B.contextType;We=Fh,typeof on=="object"&&on!==null&&(We=uo(on));var En=B.getDerivedStateFromProps;on=typeof En=="function"||typeof fe.getSnapshotBeforeUpdate=="function",vt=T.pendingProps!==vt,on||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(vt||Ri!==We)&&Rc(T,fe,q,We),Kc=!1;var On=T.memoizedState;fe.state=On,xr(T,q,fe,te),Nn(),Ri=T.memoizedState,vt||On!==Ri||Kc?(typeof En=="function"&&(qo(T,B,En,q),Ri=T.memoizedState),(Ht=Kc||Th(T,B,Ht,q,On,Ri,We))?(on||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(T.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(T.flags|=4194308),T.memoizedProps=q,T.memoizedState=Ri),fe.props=q,fe.state=Ri,fe.context=We,q=Ht):(typeof fe.componentDidMount=="function"&&(T.flags|=4194308),q=!1)}else{fe=T.stateNode,Jn(w,T),We=T.memoizedProps,on=Tl(B,We),fe.props=on,En=T.pendingProps,On=fe.context,Ri=B.contextType,Ht=Fh,typeof Ri=="object"&&Ri!==null&&(Ht=uo(Ri)),vt=B.getDerivedStateFromProps,(Ri=typeof vt=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(We!==En||On!==Ht)&&Rc(T,fe,q,Ht),Kc=!1,On=T.memoizedState,fe.state=On,xr(T,q,fe,te),Nn();var br=T.memoizedState;We!==En||On!==br||Kc||w!==null&&w.dependencies!==null&&Fu(w.dependencies)?(typeof vt=="function"&&(qo(T,B,vt,q),br=T.memoizedState),(on=Kc||Th(T,B,on,q,On,br,Ht)||w!==null&&w.dependencies!==null&&Fu(w.dependencies))?(Ri||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(q,br,Ht),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(q,br,Ht)),typeof fe.componentDidUpdate=="function"&&(T.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(T.flags|=1024)):(typeof fe.componentDidUpdate!="function"||We===w.memoizedProps&&On===w.memoizedState||(T.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||We===w.memoizedProps&&On===w.memoizedState||(T.flags|=1024),T.memoizedProps=q,T.memoizedState=br),fe.props=q,fe.state=br,fe.context=Ht,q=on):(typeof fe.componentDidUpdate!="function"||We===w.memoizedProps&&On===w.memoizedState||(T.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||We===w.memoizedProps&&On===w.memoizedState||(T.flags|=1024),q=!1)}return fe=q,qr(w,T),q=(T.flags&128)!==0,fe||q?(fe=T.stateNode,B=q&&typeof B.getDerivedStateFromError!="function"?null:fe.render(),T.flags|=1,w!==null&&q?(T.child=Jc(T,w.child,null,te),T.child=Jc(T,null,B,te)):Da(w,T,B,te),T.memoizedState=fe.state,w=T.child):w=zo(w,T,te),w}function Rn(w,T,B,q){return Er(),T.flags|=256,Da(w,T,B,q),T.child}function Pp(w){return{baseLanes:w,cachePool:rd()}}function id(w,T,B){return w=w!==null?w.childLanes&~B:0,T&&(w|=Mn),w}function cc(w,T,B){var q=T.pendingProps,te=!1,fe=(T.flags&128)!==0,We;if((We=fe)||(We=w!==null&&w.memoizedState===null?!1:(na.current&2)!==0),We&&(te=!0,T.flags&=-129),We=(T.flags&32)!==0,T.flags&=-33,w===null){if(Ws){if(te?js(T):Lo(),Ws){var vt=ro,Ht;(Ht=vt)&&(vt=l_(vt,vc),vt!==null?(T.memoizedState={dehydrated:vt,treeContext:Wc!==null?{id:Zc,overflow:Pl}:null,retryLane:536870912},Ht=i(18,null,null,0),Ht.stateNode=vt,Ht.return=T,T.child=Ht,Eo=T,ro=null,Ht=!0):Ht=!1),Ht||Fi(T)}if(vt=T.memoizedState,vt!==null&&(vt=vt.dehydrated,vt!==null))return Au(vt)?T.lanes=16:T.lanes=536870912,null;jo(T)}return vt=q.children,q=q.fallback,te?(Lo(),te=T.mode,vt=uc({mode:"hidden",children:vt},te),q=Ih(q,te,B,null),vt.return=T,q.return=T,vt.sibling=q,T.child=vt,te=T.child,te.memoizedState=Pp(B),te.childLanes=id(w,We,B),T.memoizedState=M,q):(js(T),Nu(T,vt))}if(Ht=w.memoizedState,Ht!==null&&(vt=Ht.dehydrated,vt!==null)){if(fe)T.flags&256?(js(T),T.flags&=-257,T=hn(w,T,B)):T.memoizedState!==null?(Lo(),T.child=w.child,T.flags|=128,T=null):(Lo(),te=q.fallback,vt=T.mode,q=uc({mode:"visible",children:q.children},vt),te=Ih(te,vt,B,null),te.flags|=2,q.return=T,te.return=T,q.sibling=te,T.child=q,Jc(T,w.child,null,B),q=T.child,q.memoizedState=Pp(B),q.childLanes=id(w,We,B),T.memoizedState=M,T=te);else if(js(T),Au(vt))We=Ys(vt).digest,q=Error(h(419)),q.stack="",q.digest=We,xn({value:q,source:null,stack:null}),T=hn(w,T,B);else if(b||Gl(w,T,B,!1),We=(B&w.childLanes)!==0,b||We){if(We=qe,We!==null){if(q=B&-B,(q&42)!==0)q=1;else switch(q){case 2:q=1;break;case 8:q=4;break;case 32:q=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:q=64;break;case 268435456:q=134217728;break;default:q=0}if(q=(q&(We.suspendedLanes|B))!==0?0:q,q!==0&&q!==Ht.retryLane)throw Ht.retryLane=q,Ji(w,q),Ua(We,w,q),m}Mi(vt)||Xl(),T=hn(w,T,B)}else Mi(vt)?(T.flags|=128,T.child=w.child,T=yu.bind(null,w),dt(vt,T),T=null):(w=Ht.treeContext,cl&&(ro=Tg(vt),Eo=T,Ws=!0,xc=null,vc=!1,w!==null&&(hl[Ql++]=Zc,hl[Ql++]=Pl,hl[Ql++]=Wc,Zc=w.id,Pl=w.overflow,Wc=T)),T=Nu(T,q.children),T.flags|=4096);return T}return te?(Lo(),te=q.fallback,vt=T.mode,Ht=w.child,fe=Ht.sibling,q=Zo(Ht,{mode:"hidden",children:q.children}),q.subtreeFlags=Ht.subtreeFlags&31457280,fe!==null?te=Zo(fe,te):(te=Ih(te,vt,B,null),te.flags|=2),te.return=T,q.return=T,q.sibling=te,T.child=q,q=te,te=T.child,vt=w.child.memoizedState,vt===null?vt=Pp(B):(Ht=vt.cachePool,Ht!==null?(fe=sh?K._currentValue:K._currentValue2,Ht=Ht.parent!==fe?{parent:fe,pool:fe}:Ht):Ht=rd(),vt={baseLanes:vt.baseLanes|B,cachePool:Ht}),te.memoizedState=vt,te.childLanes=id(w,We,B),T.memoizedState=M,q):(js(T),B=w.child,w=B.sibling,B=Zo(B,{mode:"visible",children:q.children}),B.return=T,B.sibling=null,w!==null&&(We=T.deletions,We===null?(T.deletions=[w],T.flags|=16):We.push(w)),T.child=B,T.memoizedState=null,B)}function Nu(w,T){return T=uc({mode:"visible",children:T},w.mode),T.return=w,w.child=T}function uc(w,T){return Qd(w,T,0,null)}function hn(w,T,B){return Jc(T,w.child,null,B),w=Nu(T,T.pendingProps.children),w.flags|=2,T.memoizedState=null,w}function Rr(w,T,B){w.lanes|=T;var q=w.alternate;q!==null&&(q.lanes|=T),ca(w.return,T,B)}function Zr(w,T,B,q,te){var fe=w.memoizedState;fe===null?w.memoizedState={isBackwards:T,rendering:null,renderingStartTime:0,last:q,tail:B,tailMode:te}:(fe.isBackwards=T,fe.rendering=null,fe.renderingStartTime=0,fe.last=q,fe.tail=B,fe.tailMode=te)}function nl(w,T,B){var q=T.pendingProps,te=q.revealOrder,fe=q.tail;if(Da(w,T,q.children,B),q=na.current,(q&2)!==0)q=q&1|2,T.flags|=128;else{if(w!==null&&(w.flags&128)!==0)e:for(w=T.child;w!==null;){if(w.tag===13)w.memoizedState!==null&&Rr(w,B,T);else if(w.tag===19)Rr(w,B,T);else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===T)break e;for(;w.sibling===null;){if(w.return===null||w.return===T)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}q&=1}switch(ae(na,q),te){case"forwards":for(B=T.child,te=null;B!==null;)w=B.alternate,w!==null&&ft(w)===null&&(te=B),B=B.sibling;B=te,B===null?(te=T.child,T.child=null):(te=B.sibling,B.sibling=null),Zr(T,!1,te,B,fe);break;case"backwards":for(B=null,te=T.child,T.child=null;te!==null;){if(w=te.alternate,w!==null&&ft(w)===null){T.child=te;break}w=te.sibling,te.sibling=B,B=te,te=w}Zr(T,!0,B,null,fe);break;case"together":Zr(T,!1,null,null,void 0);break;default:T.memoizedState=null}return T.child}function zo(w,T,B){if(w!==null&&(T.dependencies=w.dependencies),Ai|=T.lanes,(B&T.childLanes)===0)if(w!==null){if(Gl(w,T,B,!1),(B&T.childLanes)===0)return null}else return null;if(w!==null&&T.child!==w.child)throw Error(h(153));if(T.child!==null){for(w=T.child,B=Zo(w,w.pendingProps),T.child=B,B.return=T;w.sibling!==null;)w=w.sibling,B=B.sibling=Zo(w,w.pendingProps),B.return=T;B.sibling=null}return T.child}function Xr(w,T){return(w.lanes&T)!==0?!0:(w=w.dependencies,!!(w!==null&&Fu(w)))}function Fm(w,T,B){switch(T.tag){case 3:ii(T,T.stateNode.containerInfo),Ic(T,K,w.memoizedState.cache),Er();break;case 27:case 5:qt(T);break;case 4:ii(T,T.stateNode.containerInfo);break;case 10:Ic(T,T.type,T.memoizedProps.value);break;case 13:var q=T.memoizedState;if(q!==null)return q.dehydrated!==null?(js(T),T.flags|=128,null):(B&T.child.childLanes)!==0?cc(w,T,B):(js(T),w=zo(w,T,B),w!==null?w.sibling:null);js(T);break;case 19:var te=(w.flags&128)!==0;if(q=(B&T.childLanes)!==0,q||(Gl(w,T,B,!1),q=(B&T.childLanes)!==0),te){if(q)return nl(w,T,B);T.flags|=128}if(te=T.memoizedState,te!==null&&(te.rendering=null,te.tail=null,te.lastEffect=null),ae(na,na.current),q)break;return null;case 22:case 23:return T.lanes=0,Xd(w,T,B);case 24:Ic(T,K,w.memoizedState.cache)}return zo(w,T,B)}function Wd(w,T,B){if(w!==null)if(w.memoizedProps!==T.pendingProps)b=!0;else{if(!Xr(w,B)&&(T.flags&128)===0)return b=!1,Fm(w,T,B);b=(w.flags&131072)!==0}else b=!1,Ws&&(T.flags&1048576)!==0&&Ge(T,pp,T.index);switch(T.lanes=0,T.tag){case 16:e:{w=T.pendingProps;var q=T.elementType,te=q._init;if(q=te(q._payload),T.type=q,typeof q=="function")Zl(q)?(w=Tl(q,w),T.tag=1,T=Nm(null,T,q,w,B)):(T.tag=0,T=Bm(null,T,q,w,B));else{if(q!=null){if(te=q.$$typeof,te===yf){T.tag=11,T=of(null,T,q,w,B);break e}else if(te===Gp){T.tag=14,T=Po(null,T,q,w,B);break e}}throw T=v(q)||q,Error(h(306,T,""))}}return T;case 0:return Bm(w,T,T.type,T.pendingProps,B);case 1:return q=T.type,te=Tl(q,T.pendingProps),Nm(w,T,q,te,B);case 3:e:{if(ii(T,T.stateNode.containerInfo),w===null)throw Error(h(387));var fe=T.pendingProps;te=T.memoizedState,q=te.element,Jn(w,T),xr(T,fe,null,B);var We=T.memoizedState;if(fe=We.cache,Ic(T,K,fe),fe!==te.cache&&yg(T,[K],B,!0),Nn(),fe=We.element,cl&&te.isDehydrated)if(te={element:fe,isDehydrated:!1,cache:We.cache},T.updateQueue.baseState=te,T.memoizedState=te,T.flags&256){T=Rn(w,T,fe,B);break e}else if(fe!==q){q=Lt(Error(h(424)),T),xn(q),T=Rn(w,T,fe,B);break e}else for(cl&&(ro=bf(T.stateNode.containerInfo),Eo=T,Ws=!0,xc=null,vc=!0),B=Pf(T,null,fe,B),T.child=B;B;)B.flags=B.flags&-3|4096,B=B.sibling;else{if(Er(),fe===q){T=zo(w,T,B);break e}Da(w,T,fe,B)}T=T.child}return T;case 26:if($l)return qr(w,T),w===null?(B=Jp(T.type,null,T.pendingProps,null))?T.memoizedState=B:Ws||(T.stateNode=Tf(T.type,T.pendingProps,yc.current,T)):T.memoizedState=Jp(T.type,w.memoizedProps,T.pendingProps,w.memoizedState),null;case 27:if(So)return qt(T),w===null&&So&&Ws&&(q=T.stateNode=em(T.type,T.pendingProps,yc.current,Mo.current,!1),Eo=T,vc=!0,ro=xd(q)),q=T.pendingProps.children,w!==null||Ws?Da(w,T,q,B):T.child=Jc(T,null,q,B),qr(w,T),T.child;case 5:return w===null&&Ws&&(Eg(T.type,T.pendingProps,Mo.current),(te=q=ro)&&(q=vd(q,T.type,T.pendingProps,vc),q!==null?(T.stateNode=q,Eo=T,ro=xd(q),vc=!1,te=!0):te=!1),te||Fi(T)),qt(T),te=T.type,fe=T.pendingProps,We=w!==null?w.memoizedProps:null,q=fe.children,bu(te,fe)?q=null:We!==null&&bu(te,We)&&(T.flags|=32),T.memoizedState!==null&&(te=Ie(w,T,at,null,null,B),sh?oi._currentValue=te:oi._currentValue2=te),qr(w,T),Da(w,T,q,B),T.child;case 6:return w===null&&Ws&&(Ag(T.pendingProps,Mo.current),(w=B=ro)&&(B=o_(B,T.pendingProps,vc),B!==null?(T.stateNode=B,Eo=T,ro=null,w=!0):w=!1),w||Fi(T)),null;case 13:return cc(w,T,B);case 4:return ii(T,T.stateNode.containerInfo),q=T.pendingProps,w===null?T.child=Jc(T,null,q,B):Da(w,T,q,B),T.child;case 11:return of(w,T,T.type,T.pendingProps,B);case 7:return Da(w,T,T.pendingProps,B),T.child;case 8:return Da(w,T,T.pendingProps.children,B),T.child;case 12:return Da(w,T,T.pendingProps.children,B),T.child;case 10:return q=T.pendingProps,Ic(T,T.type,q.value),Da(w,T,q.children,B),T.child;case 9:return te=T.type._context,q=T.pendingProps.children,au(T),te=uo(te),q=q(te),T.flags|=1,Da(w,T,q,B),T.child;case 14:return Po(w,T,T.type,T.pendingProps,B);case 15:return td(w,T,T.type,T.pendingProps,B);case 19:return nl(w,T,B);case 22:return Xd(w,T,B);case 24:return au(T),q=uo(K),w===null?(te=Fa(),te===null&&(te=qe,fe=xo(),te.pooledCache=fe,fe.refCount++,fe!==null&&(te.pooledCacheLanes|=B),te=fe),T.memoizedState={parent:q,cache:te},dr(T),Ic(T,K,te)):((w.lanes&B)!==0&&(Jn(w,T),xr(T,null,null,B),Nn()),te=w.memoizedState,fe=T.memoizedState,te.parent!==q?(te={parent:q,cache:q},T.memoizedState=te,T.lanes===0&&(T.memoizedState=T.updateQueue.baseState=te),Ic(T,K,q)):(q=fe.cache,Ic(T,K,q),q!==te.cache&&yg(T,[K],B,!0))),Da(w,T,T.pendingProps.children,B),T.child;case 29:throw T.pendingProps}throw Error(h(156,T.tag))}function Ic(w,T,B){sh?(ae(A,T._currentValue),T._currentValue=B):(ae(A,T._currentValue2),T._currentValue2=B)}function ba(w){var T=A.current;sh?w._currentValue=T:w._currentValue2=T,Y(A)}function ca(w,T,B){for(;w!==null;){var q=w.alternate;if((w.childLanes&T)!==T?(w.childLanes|=T,q!==null&&(q.childLanes|=T)):q!==null&&(q.childLanes&T)!==T&&(q.childLanes|=T),w===B)break;w=w.return}}function yg(w,T,B,q){var te=w.child;for(te!==null&&(te.return=w);te!==null;){var fe=te.dependencies;if(fe!==null){var We=te.child;fe=fe.firstContext;e:for(;fe!==null;){var vt=fe;fe=te;for(var Ht=0;Ht<T.length;Ht++)if(vt.context===T[Ht]){fe.lanes|=B,vt=fe.alternate,vt!==null&&(vt.lanes|=B),ca(fe.return,B,w),q||(We=null);break e}fe=vt.next}}else if(te.tag===18){if(We=te.return,We===null)throw Error(h(341));We.lanes|=B,fe=We.alternate,fe!==null&&(fe.lanes|=B),ca(We,B,w),We=null}else We=te.child;if(We!==null)We.return=te;else for(We=te;We!==null;){if(We===w){We=null;break}if(te=We.sibling,te!==null){te.return=We.return,We=te;break}We=We.return}te=We}}function Gl(w,T,B,q){w=null;for(var te=T,fe=!1;te!==null;){if(!fe){if((te.flags&524288)!==0)fe=!0;else if((te.flags&262144)!==0)break}if(te.tag===10){var We=te.alternate;if(We===null)throw Error(h(387));if(We=We.memoizedProps,We!==null){var vt=te.type;Ll(te.pendingProps.value,We.value)||(w!==null?w.push(vt):w=[vt])}}else if(te===Rd.current){if(We=te.alternate,We===null)throw Error(h(387));We.memoizedState.memoizedState!==te.memoizedState.memoizedState&&(w!==null?w.push(oi):w=[oi])}te=te.return}w!==null&&yg(T,w,B,q),T.flags|=262144}function Fu(w){for(w=w.firstContext;w!==null;){var T=w.context;if(!Ll(sh?T._currentValue:T._currentValue2,w.memoizedValue))return!0;w=w.next}return!1}function au(w){D=w,O=null,w=w.dependencies,w!==null&&(w.firstContext=null)}function uo(w){return Zd(D,w)}function nd(w,T){return D===null&&au(w),Zd(w,T)}function Zd(w,T){var B=sh?T._currentValue:T._currentValue2;if(T={context:T,memoizedValue:B,next:null},O===null){if(w===null)throw Error(h(308));O=T,w.dependencies={lanes:0,firstContext:T},w.flags|=524288}else O=O.next=T;return B}function xo(){return{controller:new V,data:new Map,refCount:0}}function Hl(w){w.refCount--,w.refCount===0&&H(Q,function(){w.controller.abort()})}function Fa(){var w=le.current;return w!==null?w:qe.pooledCache}function Uu(w,T){T===null?ae(le,le.current):ae(le,T.pool)}function rd(){var w=Fa();return w===null?null:{parent:sh?K._currentValue:K._currentValue2,pool:w}}function Xs(w){w.flags|=4}function jl(w,T){if(w!==null&&w.child===T.child)return!1;if((T.flags&16)!==0)return!0;for(w=T.child;w!==null;){if((w.flags&13878)!==0||(w.subtreeFlags&13878)!==0)return!0;w=w.sibling}return!1}function Dc(w,T,B,q){if(Yo)for(B=T.child;B!==null;){if(B.tag===5||B.tag===6)vu(w,B.stateNode);else if(!(B.tag===4||So&&B.tag===27)&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===T)break;for(;B.sibling===null;){if(B.return===null||B.return===T)return;B=B.return}B.sibling.return=B.return,B=B.sibling}else if(Yl)for(var te=T.child;te!==null;){if(te.tag===5){var fe=te.stateNode;B&&q&&(fe=Bh(fe,te.type,te.memoizedProps)),vu(w,fe)}else if(te.tag===6)fe=te.stateNode,B&&q&&(fe=fi(fe,te.memoizedProps)),vu(w,fe);else if(te.tag!==4){if(te.tag===22&&te.memoizedState!==null)fe=te.child,fe!==null&&(fe.return=te),Dc(w,te,!0,!0);else if(te.child!==null){te.child.return=te,te=te.child;continue}}if(te===T)break;for(;te.sibling===null;){if(te.return===null||te.return===T)return;te=te.return}te.sibling.return=te.return,te=te.sibling}}function ua(w,T,B,q){if(Yl)for(var te=T.child;te!==null;){if(te.tag===5){var fe=te.stateNode;B&&q&&(fe=Bh(fe,te.type,te.memoizedProps)),Xm(w,fe)}else if(te.tag===6)fe=te.stateNode,B&&q&&(fe=fi(fe,te.memoizedProps)),Xm(w,fe);else if(te.tag!==4){if(te.tag===22&&te.memoizedState!==null)fe=te.child,fe!==null&&(fe.return=te),ua(w,te,!(te.memoizedProps!==null&&te.memoizedProps.mode==="manual"),!0);else if(te.child!==null){te.child.return=te,te=te.child;continue}}if(te===T)break;for(;te.sibling===null;){if(te.return===null||te.return===T)return;te=te.return}te.sibling.return=te.return,te=te.sibling}}function lf(w,T){if(Yl&&jl(w,T)){w=T.stateNode;var B=w.containerInfo,q=Zp();ua(q,T,!1,!1),w.pendingChildren=q,Xs(T),wg(B,q)}}function hc(w,T,B,q){if(Yo)w.memoizedProps!==q&&Xs(T);else if(Yl){var te=w.stateNode,fe=w.memoizedProps;if((w=jl(w,T))||fe!==q){var We=Mo.current;fe=qm(te,B,fe,q,!w,null),fe===te?T.stateNode=te:(rh(fe,B,q,We)&&Xs(T),T.stateNode=fe,w?Dc(fe,T,!1,!1):Xs(T))}else T.stateNode=te}}function El(w,T,B){if(kc(T,B)){if(w.flags|=16777216,!wu(T,B))if(kp())w.flags|=8192;else throw lh=Ym,_p}else w.flags&=-16777217}function $n(w,T){if(Sd(T)){if(w.flags|=16777216,!Cu(T))if(kp())w.flags|=8192;else throw lh=Ym,_p}else w.flags&=-16777217}function sn(w,T){T!==null&&(w.flags|=4),w.flags&16384&&(T=w.tag!==22?Ce():536870912,w.lanes|=T,lr|=T)}function ku(w,T){if(!Ws)switch(w.tailMode){case"hidden":T=w.tail;for(var B=null;T!==null;)T.alternate!==null&&(B=T),T=T.sibling;B===null?w.tail=null:B.sibling=null;break;case"collapsed":B=w.tail;for(var q=null;B!==null;)B.alternate!==null&&(q=B),B=B.sibling;q===null?T||w.tail===null?w.tail=null:w.tail.sibling=null:q.sibling=null}}function fn(w){var T=w.alternate!==null&&w.alternate.child===w.child,B=0,q=0;if(T)for(var te=w.child;te!==null;)B|=te.lanes|te.childLanes,q|=te.subtreeFlags&31457280,q|=te.flags&31457280,te.return=w,te=te.sibling;else for(te=w.child;te!==null;)B|=te.lanes|te.childLanes,q|=te.subtreeFlags,q|=te.flags,te.return=w,te=te.sibling;return w.subtreeFlags|=q,w.childLanes=B,T}function sd(w,T,B){var q=T.pendingProps;switch(Vt(T),T.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fn(T),null;case 1:return fn(T),null;case 3:return B=T.stateNode,q=null,w!==null&&(q=w.memoizedState.cache),T.memoizedState.cache!==q&&(T.flags|=2048),ba(K),ki(),B.pendingContext&&(B.context=B.pendingContext,B.pendingContext=null),(w===null||w.child===null)&&(Fn(T)?Xs(T):w===null||w.memoizedState.isDehydrated&&(T.flags&256)===0||(T.flags|=1024,xc!==null&&(Zu(xc),xc=null))),lf(w,T),fn(T),null;case 26:if($l){B=T.type;var te=T.memoizedState;return w===null?(Xs(T),te!==null?(fn(T),$n(T,te)):(fn(T),El(T,B,q))):te?te!==w.memoizedState?(Xs(T),fn(T),$n(T,te)):(fn(T),T.flags&=-16777217):(Yo?w.memoizedProps!==q&&Xs(T):hc(w,T,B,q),fn(T),El(T,B,q)),null}case 27:if(So){if(xi(T),B=yc.current,te=T.type,w!==null&&T.stateNode!=null)Yo?w.memoizedProps!==q&&Xs(T):hc(w,T,te,q);else{if(!q){if(T.stateNode===null)throw Error(h(166));return fn(T),null}w=Mo.current,Fn(T)?Ui(T,w):(w=em(te,q,B,w,!0),T.stateNode=w,Xs(T))}return fn(T),null}case 5:if(xi(T),B=T.type,w!==null&&T.stateNode!=null)hc(w,T,B,q);else{if(!q){if(T.stateNode===null)throw Error(h(166));return fn(T),null}w=Mo.current,Fn(T)?Ui(T,w):(te=md(B,q,yc.current,w,T),Dc(te,T,!1,!1),T.stateNode=te,rh(te,B,q,w)&&Xs(T))}return fn(T),El(T,T.type,T.pendingProps),null;case 6:if(w&&T.stateNode!=null)B=w.memoizedProps,Yo?B!==q&&Xs(T):Yl&&(B!==q?(T.stateNode=gd(q,yc.current,Mo.current,T),Xs(T)):T.stateNode=w.stateNode);else{if(typeof q!="string"&&T.stateNode===null)throw Error(h(166));if(w=yc.current,B=Mo.current,Fn(T)){if(!cl)throw Error(h(176));if(w=T.stateNode,B=T.memoizedProps,q=null,te=Eo,te!==null)switch(te.tag){case 27:case 5:q=te.memoizedProps}Kp(w,B,T,q)||Fi(T)}else T.stateNode=gd(q,w,B,T)}return fn(T),null;case 13:if(q=T.memoizedState,w===null||w.memoizedState!==null&&w.memoizedState.dehydrated!==null){if(te=Fn(T),q!==null&&q.dehydrated!==null){if(w===null){if(!te)throw Error(h(318));if(!cl)throw Error(h(344));if(te=T.memoizedState,te=te!==null?te.dehydrated:null,!te)throw Error(h(317));Nh(te,T)}else Er(),(T.flags&128)===0&&(T.memoizedState=null),T.flags|=4;fn(T),te=!1}else xc!==null&&(Zu(xc),xc=null),te=!0;if(!te)return T.flags&256?(jo(T),T):(jo(T),null)}if(jo(T),(T.flags&128)!==0)return T.lanes=B,T;if(B=q!==null,w=w!==null&&w.memoizedState!==null,B){q=T.child,te=null,q.alternate!==null&&q.alternate.memoizedState!==null&&q.alternate.memoizedState.cachePool!==null&&(te=q.alternate.memoizedState.cachePool.pool);var fe=null;q.memoizedState!==null&&q.memoizedState.cachePool!==null&&(fe=q.memoizedState.cachePool.pool),fe!==te&&(q.flags|=2048)}return B!==w&&B&&(T.child.flags|=8192),sn(T,T.updateQueue),fn(T),null;case 4:return ki(),lf(w,T),w===null&&_d(T.stateNode.containerInfo),fn(T),null;case 10:return ba(T.type),fn(T),null;case 19:if(Y(na),te=T.memoizedState,te===null)return fn(T),null;if(q=(T.flags&128)!==0,fe=te.rendering,fe===null)if(q)ku(te,!1);else{if(Si!==0||w!==null&&(w.flags&128)!==0)for(w=T.child;w!==null;){if(fe=ft(w),fe!==null){for(T.flags|=128,ku(te,!1),w=fe.updateQueue,T.updateQueue=w,sn(T,w),T.subtreeFlags=0,w=B,B=T.child;B!==null;)Rh(B,w),B=B.sibling;return ae(na,na.current&1|2),T.child}w=w.sibling}te.tail!==null&&To()>er&&(T.flags|=128,q=!0,ku(te,!1),T.lanes=4194304)}else{if(!q)if(w=ft(fe),w!==null){if(T.flags|=128,q=!0,w=w.updateQueue,T.updateQueue=w,sn(T,w),ku(te,!0),te.tail===null&&te.tailMode==="hidden"&&!fe.alternate&&!Ws)return fn(T),null}else 2*To()-te.renderingStartTime>er&&B!==536870912&&(T.flags|=128,q=!0,ku(te,!1),T.lanes=4194304);te.isBackwards?(fe.sibling=T.child,T.child=fe):(w=te.last,w!==null?w.sibling=fe:T.child=fe,te.last=fe)}return te.tail!==null?(T=te.tail,te.rendering=T,te.tail=T.sibling,te.renderingStartTime=To(),T.sibling=null,w=na.current,ae(na,q?w&1|2:w&1),T):(fn(T),null);case 22:case 23:return jo(T),Ar(),q=T.memoizedState!==null,w!==null?w.memoizedState!==null!==q&&(T.flags|=8192):q&&(T.flags|=8192),q?(B&536870912)!==0&&(T.flags&128)===0&&(fn(T),T.subtreeFlags&6&&(T.flags|=8192)):fn(T),B=T.updateQueue,B!==null&&sn(T,B.retryQueue),B=null,w!==null&&w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(B=w.memoizedState.cachePool.pool),q=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(q=T.memoizedState.cachePool.pool),q!==B&&(T.flags|=2048),w!==null&&Y(le),null;case 24:return B=null,w!==null&&(B=w.memoizedState.cache),T.memoizedState.cache!==B&&(T.flags|=2048),ba(K),fn(T),null;case 25:return null}throw Error(h(156,T.tag))}function zp(w,T){switch(Vt(T),T.tag){case 1:return w=T.flags,w&65536?(T.flags=w&-65537|128,T):null;case 3:return ba(K),ki(),w=T.flags,(w&65536)!==0&&(w&128)===0?(T.flags=w&-65537|128,T):null;case 26:case 27:case 5:return xi(T),null;case 13:if(jo(T),w=T.memoizedState,w!==null&&w.dehydrated!==null){if(T.alternate===null)throw Error(h(340));Er()}return w=T.flags,w&65536?(T.flags=w&-65537|128,T):null;case 19:return Y(na),null;case 4:return ki(),null;case 10:return ba(T.type),null;case 22:case 23:return jo(T),Ar(),w!==null&&Y(le),w=T.flags,w&65536?(T.flags=w&-65537|128,T):null;case 24:return ba(K),null;case 25:return null;default:return null}}function zn(w,T){switch(Vt(T),T.tag){case 3:ba(K),ki();break;case 26:case 27:case 5:xi(T);break;case 4:ki();break;case 13:jo(T);break;case 19:Y(na);break;case 10:ba(T.type);break;case 22:case 23:jo(T),Ar(),w!==null&&Y(le);break;case 24:ba(K)}}function ql(w,T){try{var B=T.updateQueue,q=B!==null?B.lastEffect:null;if(q!==null){var te=q.next;B=te;do{if((B.tag&w)===w){q=void 0;var fe=B.create,We=B.inst;q=fe(),We.destroy=q}B=B.next}while(B!==te)}}catch(vt){ws(T,T.return,vt)}}function Vu(w,T,B){try{var q=T.updateQueue,te=q!==null?q.lastEffect:null;if(te!==null){var fe=te.next;q=fe;do{if((q.tag&w)===w){var We=q.inst,vt=We.destroy;if(vt!==void 0){We.destroy=void 0,te=T;var Ht=B;try{vt()}catch(Ri){ws(te,Ht,Ri)}}}q=q.next}while(q!==fe)}}catch(Ri){ws(T,T.return,Ri)}}function Op(w){var T=w.updateQueue;if(T!==null){var B=w.stateNode;try{wn(T,B)}catch(q){ws(w,w.return,q)}}}function Xo(w,T,B){B.props=Tl(w.type,w.memoizedProps),B.state=w.memoizedState;try{B.componentWillUnmount()}catch(q){ws(w,T,q)}}function Gu(w,T){try{var B=w.ref;if(B!==null){var q=w.stateNode;switch(w.tag){case 26:case 27:case 5:var te=Uc(q);break;default:te=q}typeof B=="function"?w.refCleanup=B(te):B.current=te}}catch(fe){ws(w,T,fe)}}function ts(w,T){var B=w.ref,q=w.refCleanup;if(B!==null)if(typeof q=="function")try{q()}catch(te){ws(w,T,te)}finally{w.refCleanup=null,w=w.alternate,w!=null&&(w.refCleanup=null)}else if(typeof B=="function")try{B(null)}catch(te){ws(w,T,te)}else B.current=null}function Eh(w){var T=w.type,B=w.memoizedProps,q=w.stateNode;try{bg(q,T,B,w)}catch(te){ws(w,w.return,te)}}function fc(w,T,B){try{Bo(w.stateNode,w.type,B,T,w)}catch(q){ws(w,w.return,q)}}function Bp(w){return w.tag===5||w.tag===3||($l?w.tag===26:!1)||(So?w.tag===27:!1)||w.tag===4}function ou(w){e:for(;;){for(;w.sibling===null;){if(w.return===null||Bp(w.return))return null;w=w.return}for(w.sibling.return=w.return,w=w.sibling;w.tag!==5&&w.tag!==6&&(!So||w.tag!==27)&&w.tag!==18;){if(w.flags&2||w.child===null||w.tag===4)continue e;w.child.return=w,w=w.child}if(!(w.flags&2))return w.stateNode}}function Al(w,T,B){var q=w.tag;if(q===5||q===6)w=w.stateNode,T?yd(B,w,T):a_(B,w);else if(!(q===4||So&&q===27)&&(w=w.child,w!==null))for(Al(w,T,B),w=w.sibling;w!==null;)Al(w,T,B),w=w.sibling}function Hu(w,T,B){var q=w.tag;if(q===5||q===6)w=w.stateNode,T?Eu(B,w,T):Mu(B,w);else if(!(q===4||So&&q===27)&&(w=w.child,w!==null))for(Hu(w,T,B),w=w.sibling;w!==null;)Hu(w,T,B),w=w.sibling}function r_(w,T,B){w=w.containerInfo;try{Oh(w,B)}catch(q){ws(T,T.return,q)}}function lu(w,T){for(Il(w.containerInfo),Me=T;Me!==null;)if(w=Me,T=w.child,(w.subtreeFlags&1028)!==0&&T!==null)T.return=w,Me=T;else for(;Me!==null;){w=Me;var B=w.alternate;switch(T=w.flags,w.tag){case 0:break;case 11:case 15:break;case 1:if((T&1024)!==0&&B!==null){T=void 0;var q=w,te=B.memoizedProps;B=B.memoizedState;var fe=q.stateNode;try{var We=Tl(q.type,te,q.elementType===q.type);T=fe.getSnapshotBeforeUpdate(We,B),fe.__reactInternalSnapshotBeforeUpdate=T}catch(vt){ws(q,q.return,vt)}}break;case 3:(T&1024)!==0&&Yo&&hp(w.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((T&1024)!==0)throw Error(h(163))}if(T=w.sibling,T!==null){T.return=w.return,Me=T;break}Me=w.return}return We=we,we=!1,We}function cf(w,T,B){var q=B.flags;switch(B.tag){case 0:case 11:case 15:uu(w,B),q&4&&ql(5,B);break;case 1:if(uu(w,B),q&4)if(w=B.stateNode,T===null)try{w.componentDidMount()}catch(vt){ws(B,B.return,vt)}else{var te=Tl(B.type,T.memoizedProps);T=T.memoizedState;try{w.componentDidUpdate(te,T,w.__reactInternalSnapshotBeforeUpdate)}catch(vt){ws(B,B.return,vt)}}q&64&&Op(B),q&512&&Gu(B,B.return);break;case 3:if(uu(w,B),q&64&&(q=B.updateQueue,q!==null)){if(w=null,B.child!==null)switch(B.child.tag){case 27:case 5:w=Uc(B.child.stateNode);break;case 1:w=B.child.stateNode}try{wn(q,w)}catch(vt){ws(B,B.return,vt)}}break;case 26:if($l){uu(w,B),q&512&&Gu(B,B.return);break}case 27:case 5:uu(w,B),T===null&&q&4&&Eh(B),q&512&&Gu(B,B.return);break;case 12:uu(w,B);break;case 13:uu(w,B),q&4&&uf(w,B);break;case 22:if(te=B.memoizedState!==null||se,!te){T=T!==null&&T.memoizedState!==null||pe;var fe=se,We=pe;se=te,(pe=T)&&!We?hu(w,B,(B.subtreeFlags&8772)!==0):uu(w,B),se=fe,pe=We}q&512&&(B.memoizedProps.mode==="manual"?Gu(B,B.return):ts(B,B.return));break;default:uu(w,B)}}function ju(w){var T=w.alternate;T!==null&&(w.alternate=null,ju(T)),w.child=null,w.deletions=null,w.sibling=null,w.tag===5&&(T=w.stateNode,T!==null&&op(T)),w.stateNode=null,w.return=null,w.dependencies=null,w.memoizedProps=null,w.memoizedState=null,w.pendingProps=null,w.stateNode=null,w.updateQueue=null}function $a(w,T,B){for(B=B.child;B!==null;)cu(w,T,B),B=B.sibling}function cu(w,T,B){if(no&&typeof no.onCommitFiberUnmount=="function")try{no.onCommitFiberUnmount(mo,B)}catch{}switch(B.tag){case 26:if($l){pe||ts(B,T),$a(w,T,B),B.memoizedState?Cg(B.memoizedState):B.stateNode&&Wm(B.stateNode);break}case 27:if(So){pe||ts(B,T);var q=Ue,te=Pe;Ue=B.stateNode,$a(w,T,B),ul(B.stateNode),Ue=q,Pe=te;break}case 5:pe||ts(B,T);case 6:if(Yo){if(q=Ue,te=Pe,Ue=null,$a(w,T,B),Ue=q,Pe=te,Ue!==null)if(Pe)try{Pa(Ue,B.stateNode)}catch(fe){ws(B,T,fe)}else try{No(Ue,B.stateNode)}catch(fe){ws(B,T,fe)}}else $a(w,T,B);break;case 18:Yo&&Ue!==null&&(Pe?gc(Ue,B.stateNode):Sf(Ue,B.stateNode));break;case 4:Yo?(q=Ue,te=Pe,Ue=B.stateNode.containerInfo,Pe=!0,$a(w,T,B),Ue=q,Pe=te):(Yl&&r_(B.stateNode,B,Zp()),$a(w,T,B));break;case 0:case 11:case 14:case 15:pe||Vu(2,B,T),pe||Vu(4,B,T),$a(w,T,B);break;case 1:pe||(ts(B,T),q=B.stateNode,typeof q.componentWillUnmount=="function"&&Xo(B,T,q)),$a(w,T,B);break;case 21:$a(w,T,B);break;case 22:pe||ts(B,T),pe=(q=pe)||B.memoizedState!==null,$a(w,T,B),pe=q;break;default:$a(w,T,B)}}function uf(w,T){if(cl&&T.memoizedState===null&&(w=T.alternate,w!==null&&(w=w.memoizedState,w!==null&&(w=w.dehydrated,w!==null))))try{wf(w)}catch(B){ws(T,T.return,B)}}function hf(w){switch(w.tag){case 13:case 19:var T=w.stateNode;return T===null&&(T=w.stateNode=new be),T;case 22:return w=w.stateNode,T=w._retryCache,T===null&&(T=w._retryCache=new be),T;default:throw Error(h(435,w.tag))}}function Np(w,T){var B=hf(w);T.forEach(function(q){var te=km.bind(null,w,q);B.has(q)||(B.add(q),q.then(te,te))})}function rl(w,T){var B=T.deletions;if(B!==null)for(var q=0;q<B.length;q++){var te=B[q],fe=w,We=T;if(Yo){var vt=We;e:for(;vt!==null;){switch(vt.tag){case 27:case 5:Ue=vt.stateNode,Pe=!1;break e;case 3:Ue=vt.stateNode.containerInfo,Pe=!0;break e;case 4:Ue=vt.stateNode.containerInfo,Pe=!0;break e}vt=vt.return}if(Ue===null)throw Error(h(160));cu(fe,We,te),Ue=null,Pe=!1}else cu(fe,We,te);fe=te.alternate,fe!==null&&(fe.return=null),te.return=null}if(T.subtreeFlags&13878)for(T=T.child;T!==null;)Ah(T,w),T=T.sibling}function Ah(w,T){var B=w.alternate,q=w.flags;switch(w.tag){case 0:case 11:case 14:case 15:rl(T,w),sl(w),q&4&&(Vu(3,w,w.return),ql(3,w),Vu(5,w,w.return));break;case 1:rl(T,w),sl(w),q&512&&(pe||B===null||ts(B,B.return)),q&64&&se&&(w=w.updateQueue,w!==null&&(q=w.callbacks,q!==null&&(B=w.shared.hiddenCallbacks,w.shared.hiddenCallbacks=B===null?q:B.concat(q))));break;case 26:if($l){var te=Ne;rl(T,w),sl(w),q&512&&(pe||B===null||ts(B,B.return)),q&4&&(q=B!==null?B.memoizedState:null,T=w.memoizedState,B===null?T===null?w.stateNode===null?w.stateNode=Ms(te,w.type,w.memoizedProps,w):vr(te,w.type,w.stateNode):w.stateNode=wd(te,T,w.memoizedProps):q!==T?(q===null?B.stateNode!==null&&Wm(B.stateNode):Cg(q),T===null?vr(te,w.type,w.stateNode):wd(te,T,w.memoizedProps)):T===null&&w.stateNode!==null&&fc(w,w.memoizedProps,B.memoizedProps));break}case 27:if(So&&q&4&&w.alternate===null){te=w.stateNode;var fe=w.memoizedProps;try{Zm(te),_c(w.type,fe,te,w)}catch(on){ws(w,w.return,on)}}case 5:if(rl(T,w),sl(w),q&512&&(pe||B===null||ts(B,B.return)),Yo){if(w.flags&32){T=w.stateNode;try{zh(T)}catch(on){ws(w,w.return,on)}}q&4&&w.stateNode!=null&&(T=w.memoizedProps,fc(w,T,B!==null?B.memoizedProps:T)),q&1024&&(de=!0)}break;case 6:if(rl(T,w),sl(w),q&4&&Yo){if(w.stateNode===null)throw Error(h(162));q=w.memoizedProps,B=B!==null?B.memoizedProps:q,T=w.stateNode;try{Dl(T,B,q)}catch(on){ws(w,w.return,on)}}break;case 3:if($l?(Mf(),te=Ne,Ne=wo(T.containerInfo),rl(T,w),Ne=te):rl(T,w),sl(w),q&4){if(Yo&&cl&&B!==null&&B.memoizedState.isDehydrated)try{bd(T.containerInfo)}catch(on){ws(w,w.return,on)}if(Yl){q=T.containerInfo,B=T.pendingChildren;try{Oh(q,B)}catch(on){ws(w,w.return,on)}}}de&&(de=!1,qu(w));break;case 4:$l?(B=Ne,Ne=wo(w.stateNode.containerInfo),rl(T,w),sl(w),Ne=B):(rl(T,w),sl(w)),q&4&&Yl&&r_(w.stateNode,w,w.stateNode.pendingChildren);break;case 12:rl(T,w),sl(w);break;case 13:rl(T,w),sl(w),w.child.flags&8192&&w.memoizedState!==null!=(B!==null&&B.memoizedState!==null)&&(Dn=To()),q&4&&(q=w.updateQueue,q!==null&&(w.updateQueue=null,Np(w,q)));break;case 22:q&512&&(pe||B===null||ts(B,B.return)),te=w.memoizedState!==null;var We=B!==null&&B.memoizedState!==null,vt=se,Ht=pe;if(se=vt||te,pe=Ht||We,rl(T,w),pe=Ht,se=vt,sl(w),T=w.stateNode,T._current=w,T._visibility&=-3,T._visibility|=T._pendingVisibility&2,q&8192&&(T._visibility=te?T._visibility&-2:T._visibility|1,te&&(T=se||pe,B===null||We||T||ad(w)),Yo&&(w.memoizedProps===null||w.memoizedProps.mode!=="manual"))){e:if(B=null,Yo)for(T=w;;){if(T.tag===5||$l&&T.tag===26||So&&T.tag===27){if(B===null){We=B=T;try{fe=We.stateNode,te?up(fe):ms(We.stateNode,We.memoizedProps)}catch(on){ws(We,We.return,on)}}}else if(T.tag===6){if(B===null){We=T;try{var Ri=We.stateNode;te?Vc(Ri):Gc(Ri,We.memoizedProps)}catch(on){ws(We,We.return,on)}}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===w)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===w)break e;for(;T.sibling===null;){if(T.return===null||T.return===w)break e;B===T&&(B=null),T=T.return}B===T&&(B=null),T.sibling.return=T.return,T=T.sibling}}q&4&&(q=w.updateQueue,q!==null&&(B=q.retryQueue,B!==null&&(q.retryQueue=null,Np(w,B))));break;case 19:rl(T,w),sl(w),q&4&&(q=w.updateQueue,q!==null&&(w.updateQueue=null,Np(w,q)));break;case 21:break;default:rl(T,w),sl(w)}}function sl(w){var T=w.flags;if(T&2){try{if(Yo&&(!So||w.tag!==27)){e:{for(var B=w.return;B!==null;){if(Bp(B)){var q=B;break e}B=B.return}throw Error(h(160))}switch(q.tag){case 27:if(So){var te=q.stateNode,fe=ou(w);Hu(w,fe,te);break}case 5:var We=q.stateNode;q.flags&32&&(zh(We),q.flags&=-33);var vt=ou(w);Hu(w,vt,We);break;case 3:case 4:var Ht=q.stateNode.containerInfo,Ri=ou(w);Al(w,Ri,Ht);break;default:throw Error(h(161))}}}catch(on){ws(w,w.return,on)}w.flags&=-3}T&4096&&(w.flags&=-4097)}function qu(w){if(w.subtreeFlags&1024)for(w=w.child;w!==null;){var T=w;qu(T),T.tag===5&&T.flags&1024&&Js(T.stateNode),w=w.sibling}}function uu(w,T){if(T.subtreeFlags&8772)for(T=T.child;T!==null;)cf(w,T.alternate,T),T=T.sibling}function ad(w){for(w=w.child;w!==null;){var T=w;switch(T.tag){case 0:case 11:case 14:case 15:Vu(4,T,T.return),ad(T);break;case 1:ts(T,T.return);var B=T.stateNode;typeof B.componentWillUnmount=="function"&&Xo(T,T.return,B),ad(T);break;case 26:case 27:case 5:ts(T,T.return),ad(T);break;case 22:ts(T,T.return),T.memoizedState===null&&ad(T);break;default:ad(T)}w=w.sibling}}function hu(w,T,B){for(B=B&&(T.subtreeFlags&8772)!==0,T=T.child;T!==null;){var q=T.alternate,te=w,fe=T,We=fe.flags;switch(fe.tag){case 0:case 11:case 15:hu(te,fe,B),ql(4,fe);break;case 1:if(hu(te,fe,B),q=fe,te=q.stateNode,typeof te.componentDidMount=="function")try{te.componentDidMount()}catch(Ri){ws(q,q.return,Ri)}if(q=fe,te=q.updateQueue,te!==null){var vt=q.stateNode;try{var Ht=te.shared.hiddenCallbacks;if(Ht!==null)for(te.shared.hiddenCallbacks=null,te=0;te<Ht.length;te++)Rt(Ht[te],vt)}catch(Ri){ws(q,q.return,Ri)}}B&&We&64&&Op(fe),Gu(fe,fe.return);break;case 26:case 27:case 5:hu(te,fe,B),B&&q===null&&We&4&&Eh(fe),Gu(fe,fe.return);break;case 12:hu(te,fe,B);break;case 13:hu(te,fe,B),B&&We&4&&uf(te,fe);break;case 22:fe.memoizedState===null&&hu(te,fe,B),Gu(fe,fe.return);break;default:hu(te,fe,B)}T=T.sibling}}function Xu(w,T){var B=null;w!==null&&w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(B=w.memoizedState.cachePool.pool),w=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(w=T.memoizedState.cachePool.pool),w!==B&&(w!=null&&w.refCount++,B!=null&&Hl(B))}function ff(w,T){w=null,T.alternate!==null&&(w=T.alternate.memoizedState.cache),T=T.memoizedState.cache,T!==w&&(T.refCount++,w!=null&&Hl(w))}function ho(w,T,B,q){if(T.subtreeFlags&10256)for(T=T.child;T!==null;)Fp(w,T,B,q),T=T.sibling}function Fp(w,T,B,q){var te=T.flags;switch(T.tag){case 0:case 11:case 15:ho(w,T,B,q),te&2048&&ql(9,T);break;case 3:ho(w,T,B,q),te&2048&&(w=null,T.alternate!==null&&(w=T.alternate.memoizedState.cache),T=T.memoizedState.cache,T!==w&&(T.refCount++,w!=null&&Hl(w)));break;case 12:if(te&2048){ho(w,T,B,q),w=T.stateNode;try{var fe=T.memoizedProps,We=fe.id,vt=fe.onPostCommit;typeof vt=="function"&&vt(We,T.alternate===null?"mount":"update",w.passiveEffectDuration,-0)}catch(Ht){ws(T,T.return,Ht)}}else ho(w,T,B,q);break;case 23:break;case 22:fe=T.stateNode,T.memoizedState!==null?fe._visibility&4?ho(w,T,B,q):dc(w,T):fe._visibility&4?ho(w,T,B,q):(fe._visibility|=4,Ja(w,T,B,q,(T.subtreeFlags&10256)!==0)),te&2048&&Xu(T.alternate,T);break;case 24:ho(w,T,B,q),te&2048&&ff(T.alternate,T);break;default:ho(w,T,B,q)}}function Ja(w,T,B,q,te){for(te=te&&(T.subtreeFlags&10256)!==0,T=T.child;T!==null;){var fe=w,We=T,vt=B,Ht=q,Ri=We.flags;switch(We.tag){case 0:case 11:case 15:Ja(fe,We,vt,Ht,te),ql(8,We);break;case 23:break;case 22:var on=We.stateNode;We.memoizedState!==null?on._visibility&4?Ja(fe,We,vt,Ht,te):dc(fe,We):(on._visibility|=4,Ja(fe,We,vt,Ht,te)),te&&Ri&2048&&Xu(We.alternate,We);break;case 24:Ja(fe,We,vt,Ht,te),te&&Ri&2048&&ff(We.alternate,We);break;default:Ja(fe,We,vt,Ht,te)}T=T.sibling}}function dc(w,T){if(T.subtreeFlags&10256)for(T=T.child;T!==null;){var B=w,q=T,te=q.flags;switch(q.tag){case 22:dc(B,q),te&2048&&Xu(q.alternate,q);break;case 24:dc(B,q),te&2048&&ff(q.alternate,q);break;default:dc(B,q)}T=T.sibling}}function fo(w){if(w.subtreeFlags&Oe)for(w=w.child;w!==null;)Wu(w),w=w.sibling}function Wu(w){switch(w.tag){case 26:fo(w),w.flags&Oe&&(w.memoizedState!==null?Qp(Ne,w.memoizedState,w.memoizedProps):Va(w.type,w.memoizedProps));break;case 5:fo(w),w.flags&Oe&&Va(w.type,w.memoizedProps);break;case 3:case 4:if($l){var T=Ne;Ne=wo(w.stateNode.containerInfo),fo(w),Ne=T}else fo(w);break;case 22:w.memoizedState===null&&(T=w.alternate,T!==null&&T.memoizedState!==null?(T=Oe,Oe=16777216,fo(w),Oe=T):fo(w));break;default:fo(w)}}function al(w){var T=w.alternate;if(T!==null&&(w=T.child,w!==null)){T.child=null;do T=w.sibling,w.sibling=null,w=T;while(w!==null)}}function fu(w){var T=w.deletions;if((w.flags&16)!==0){if(T!==null)for(var B=0;B<T.length;B++){var q=T[B];Me=q,du(q,w)}al(w)}if(w.subtreeFlags&10256)for(w=w.child;w!==null;)gi(w),w=w.sibling}function gi(w){switch(w.tag){case 0:case 11:case 15:fu(w),w.flags&2048&&Vu(9,w,w.return);break;case 3:fu(w);break;case 12:fu(w);break;case 22:var T=w.stateNode;w.memoizedState!==null&&T._visibility&4&&(w.return===null||w.return.tag!==13)?(T._visibility&=-5,df(w)):fu(w);break;default:fu(w)}}function df(w){var T=w.deletions;if((w.flags&16)!==0){if(T!==null)for(var B=0;B<T.length;B++){var q=T[B];Me=q,du(q,w)}al(w)}for(w=w.child;w!==null;){switch(T=w,T.tag){case 0:case 11:case 15:Vu(8,T,T.return),df(T);break;case 22:B=T.stateNode,B._visibility&4&&(B._visibility&=-5,df(T));break;default:df(T)}w=w.sibling}}function du(w,T){for(;Me!==null;){var B=Me;switch(B.tag){case 0:case 11:case 15:Vu(8,B,T);break;case 23:case 22:if(B.memoizedState!==null&&B.memoizedState.cachePool!==null){var q=B.memoizedState.cachePool.pool;q!=null&&q.refCount++}break;case 24:Hl(B.memoizedState.cache)}if(q=B.child,q!==null)q.return=B,Me=q;else e:for(B=w;Me!==null;){q=Me;var te=q.sibling,fe=q.return;if(ju(q),q===B){Me=null;break e}if(te!==null){te.return=fe,Me=te;break e}Me=fe}}}function od(w){var T=ap(w);if(T!=null){if(typeof T.memoizedProps["data-testname"]!="string")throw Error(h(364));return T}if(w=Tu(w),w===null)throw Error(h(362));return w.stateNode.current}function pf(w,T){var B=w.tag;switch(T.$$typeof){case Ye:if(w.type===T.value)return!0;break;case ct:e:{for(T=T.value,w=[w,0],B=0;B<w.length;){var q=w[B++],te=q.tag,fe=w[B++],We=T[fe];if(te!==5&&te!==26&&te!==27||!mc(q)){for(;We!=null&&pf(q,We);)fe++,We=T[fe];if(fe===T.length){T=!0;break e}else for(q=q.child;q!==null;)w.push(q,fe),q=q.sibling}}T=!1}return T;case rt:if((B===5||B===26||B===27)&&jm(w.stateNode,T.value))return!0;break;case xt:if((B===5||B===6||B===26||B===27)&&(w=cp(w),w!==null&&0<=w.indexOf(T.value)))return!0;break;case _t:if((B===5||B===26||B===27)&&(w=w.memoizedProps["data-testname"],typeof w=="string"&&w.toLowerCase()===T.value.toLowerCase()))return!0;break;default:throw Error(h(365))}return!1}function Lc(w){switch(w.$$typeof){case Ye:return"<"+(v(w.value)||"Unknown")+">";case ct:return":has("+(Lc(w)||"")+")";case rt:return'[role="'+w.value+'"]';case xt:return'"'+w.value+'"';case _t:return'[data-testname="'+w.value+'"]';default:throw Error(h(365))}}function pu(w,T){var B=[];w=[w,0];for(var q=0;q<w.length;){var te=w[q++],fe=te.tag,We=w[q++],vt=T[We];if(fe!==5&&fe!==26&&fe!==27||!mc(te)){for(;vt!=null&&pf(te,vt);)We++,vt=T[We];if(We===T.length)B.push(te);else for(te=te.child;te!==null;)w.push(te,We),te=te.sibling}}return B}function Wo(w,T){if(!gn)throw Error(h(363));w=od(w),w=pu(w,T),T=[],w=Array.from(w);for(var B=0;B<w.length;){var q=w[B++],te=q.tag;if(te===5||te===26||te===27)mc(q)||T.push(q.stateNode);else for(q=q.child;q!==null;)w.push(q),q=q.sibling}return T}function Qa(){if((nt&2)!==0&&pt!==0)return pt&-pt;if(Vr.T!==null){var w=Ga;return w!==0?w:Wi()}return Oo()}function ol(){Mn===0&&(Mn=(pt&536870912)===0||Ws?je():536870912);var w=ao.current;return w!==null&&(w.flags|=32),Mn}function Ua(w,T,B){(w===qe&&Ut===2||w.cancelPendingCommit!==null)&&(ur(w,0),Pc(w,pt,Mn,!1)),Ze(w,B),((nt&2)===0||w!==qe)&&(w===qe&&((nt&2)===0&&(Oi|=B),Si===4&&Pc(w,pt,Mn,!1)),Sn(w))}function mf(w,T,B){if((nt&6)!==0)throw Error(h(327));var q=!B&&(T&60)===0&&(T&w.expiredLanes)===0||Se(w,T),te=q?mu(w,T):ns(w,T,!0),fe=q;do{if(te===0){ni&&!q&&Pc(w,T,0,!1);break}else if(te===6)Pc(w,T,0,!vi);else{if(B=w.current.alternate,fe&&!s_(B)){te=ns(w,T,!1),fe=!1;continue}if(te===2){if(fe=T,w.errorRecoveryDisabledLanes&fe)var We=0;else We=w.pendingLanes&-536870913,We=We!==0?We:We&536870912?536870912:0;if(We!==0){T=We;e:{var vt=w;te=Lr;var Ht=cl&&vt.current.memoizedState.isDehydrated;if(Ht&&(ur(vt,We).flags|=256),We=ns(vt,We,!1),We!==2){if(ti&&!Ht){vt.errorRecoveryDisabledLanes|=fe,Oi|=fe,te=4;break e}fe=Yi,Yi=te,fe!==null&&Zu(fe)}te=We}if(fe=!1,te!==2)continue}}if(te===1){ur(w,0),Pc(w,T,0,!0);break}e:{switch(q=w,te){case 0:case 1:throw Error(h(345));case 4:if((T&4194176)===T){Pc(q,T,Mn,!vi);break e}break;case 2:Yi=null;break;case 3:case 5:break;default:throw Error(h(329))}if(q.finishedWork=B,q.finishedLanes=T,(T&62914560)===T&&(fe=Dn+300-To(),10<fe)){if(Pc(q,T,Mn,!vi),Ae(q,0)!==0)break e;q.timeoutHandle=Hm(ld.bind(null,q,B,Yi,Pr,Ir,T,Mn,Oi,lr,vi,2,-0,0),fe);break e}ld(q,B,Yi,Pr,Ir,T,Mn,Oi,lr,vi,0,-0,0)}}break}while(!0);Sn(w)}function Zu(w){Yi===null?Yi=w:Yi.push.apply(Yi,w)}function ld(w,T,B,q,te,fe,We,vt,Ht,Ri,on,En,On){var br=T.subtreeFlags;if((br&8192||(br&16785408)===16785408)&&(Kl(),Wu(T),T=Ph(),T!==null)){w.cancelPendingCommit=T(ea.bind(null,w,B,q,te,We,vt,Ht,1,En,On)),Pc(w,fe,We,!Ri);return}ea(w,B,q,te,We,vt,Ht,on,En,On)}function s_(w){for(var T=w;;){var B=T.tag;if((B===0||B===11||B===15)&&T.flags&16384&&(B=T.updateQueue,B!==null&&(B=B.stores,B!==null)))for(var q=0;q<B.length;q++){var te=B[q],fe=te.getSnapshot;te=te.value;try{if(!Ll(fe(),te))return!1}catch{return!1}}if(B=T.child,T.subtreeFlags&16384&&B!==null)B.return=T,T=B;else{if(T===w)break;for(;T.sibling===null;){if(T.return===null||T.return===w)return!0;T=T.return}T.sibling.return=T.return,T=T.sibling}}return!0}function Pc(w,T,B,q){T&=~an,T&=~Oi,w.suspendedLanes|=T,w.pingedLanes&=~T,q&&(w.warmLanes|=T),q=w.expirationTimes;for(var te=T;0<te;){var fe=31-io(te),We=1<<fe;q[fe]=-1,te&=~We}B!==0&&mt(w,B,T)}function Up(){return(nt&6)===0?(_n(0),!1):!0}function eo(){if(yt!==null){if(Ut===0)var w=yt.return;else w=yt,O=D=null,Tt(w),$c=null,pl=0,w=yt;for(;w!==null;)zn(w.alternate,w),w=w.return;yt=null}}function ur(w,T){w.finishedWork=null,w.finishedLanes=0;var B=w.timeoutHandle;B!==ll&&(w.timeoutHandle=ll,sp(B)),B=w.cancelPendingCommit,B!==null&&(w.cancelPendingCommit=null,B()),eo(),qe=w,yt=B=Zo(w.current,null),pt=T,Ut=0,ei=null,vi=!1,ni=Se(w,T),ti=!1,lr=Mn=an=Oi=Ai=Si=0,Yi=Lr=null,Ir=!1,(T&8)!==0&&(T|=T&32);var q=w.entangledLanes;if(q!==0)for(w=w.entanglements,q&=T;0<q;){var te=31-io(q),fe=1<<te;T|=w[te],q&=~fe}return Zi=T,Vi(),B}function cd(w,T){gs=null,Vr.H=rs,T===Ks?(T=Kn(),Ut=3):T===_p?(T=Kn(),Ut=4):Ut=T===m?8:T!==null&&typeof T=="object"&&typeof T.then=="function"?6:1,ei=T,yt===null&&(Si=1,sf(w,Lt(T,w.current)))}function kp(){var w=ao.current;return w===null?!0:(pt&4194176)===pt?Ao===null:(pt&62914560)===pt||(pt&536870912)!==0?w===Ao:!1}function Yd(){var w=Vr.H;return Vr.H=rs,w===null?rs:w}function Cl(){var w=Vr.A;return Vr.A=Le,w}function Xl(){Si=4,vi||(pt&4194176)!==pt&&ao.current!==null||(ni=!0),(Ai&134217727)===0&&(Oi&134217727)===0||qe===null||Pc(qe,pt,Mn,!1)}function ns(w,T,B){var q=nt;nt|=2;var te=Yd(),fe=Cl();(qe!==w||pt!==T)&&(Pr=null,ur(w,T)),T=!1;var We=Si;e:do try{if(Ut!==0&&yt!==null){var vt=yt,Ht=ei;switch(Ut){case 8:eo(),We=6;break e;case 3:case 2:case 6:ao.current===null&&(T=!0);var Ri=Ut;if(Ut=0,ei=null,Wl(w,vt,Ht,Ri),B&&ni){We=0;break e}break;default:Ri=Ut,Ut=0,ei=null,Wl(w,vt,Ht,Ri)}}Yu(),We=Si;break}catch(on){cd(w,on)}while(!0);return T&&w.shellSuspendCounter++,O=D=null,nt=q,Vr.H=te,Vr.A=fe,yt===null&&(qe=null,pt=0,Vi()),We}function Yu(){for(;yt!==null;)Kd(yt)}function mu(w,T){var B=nt;nt|=2;var q=Yd(),te=Cl();qe!==w||pt!==T?(Pr=null,er=To()+500,ur(w,T)):ni=Se(w,T);e:do try{if(Ut!==0&&yt!==null){T=yt;var fe=ei;t:switch(Ut){case 1:Ut=0,ei=null,Wl(w,T,fe,1);break;case 2:if(bn(fe)){Ut=0,ei=null,$d(T);break}T=function(){Ut===2&&qe===w&&(Ut=7),Sn(w)},fe.then(T,T);break e;case 3:Ut=7;break e;case 4:Ut=5;break e;case 7:bn(fe)?(Ut=0,ei=null,$d(T)):(Ut=0,ei=null,Wl(w,T,fe,7));break;case 5:var We=null;switch(yt.tag){case 26:We=yt.memoizedState;case 5:case 27:var vt=yt,Ht=vt.type,Ri=vt.pendingProps;if(We?Cu(We):wu(Ht,Ri)){Ut=0,ei=null;var on=vt.sibling;if(on!==null)yt=on;else{var En=vt.return;En!==null?(yt=En,Ku(En)):yt=null}break t}}Ut=0,ei=null,Wl(w,T,fe,5);break;case 6:Ut=0,ei=null,Wl(w,T,fe,6);break;case 8:eo(),Si=6;break e;default:throw Error(h(462))}}gu();break}catch(On){cd(w,On)}while(!0);return O=D=null,Vr.H=q,Vr.A=te,nt=B,yt!==null?0:(qe=null,pt=0,Vi(),Si)}function gu(){for(;yt!==null&&!Aa();)Kd(yt)}function Kd(w){var T=Wd(w.alternate,w,Zi);w.memoizedProps=w.pendingProps,T===null?Ku(w):yt=T}function $d(w){var T=w,B=T.alternate;switch(T.tag){case 15:case 0:T=_g(B,T,T.pendingProps,T.type,void 0,pt);break;case 11:T=_g(B,T,T.pendingProps,T.type.render,T.ref,pt);break;case 5:Tt(T);default:zn(B,T),T=yt=Rh(T,Zi),T=Wd(B,T,Zi)}w.memoizedProps=w.pendingProps,T===null?Ku(w):yt=T}function Wl(w,T,B,q){O=D=null,Tt(T),$c=null,pl=0;var te=T.return;try{if(Om(w,te,T,B,pt)){Si=1,sf(w,Lt(B,w.current)),yt=null;return}}catch(fe){if(te!==null)throw yt=te,fe;Si=1,sf(w,Lt(B,w.current)),yt=null;return}T.flags&32768?(Ws||q===1?w=!0:ni||(pt&536870912)!==0?w=!1:(vi=w=!0,(q===2||q===3||q===6)&&(q=ao.current,q!==null&&q.tag===13&&(q.flags|=16384))),Xa(T,w)):Ku(T)}function Ku(w){var T=w;do{if((T.flags&32768)!==0){Xa(T,vi);return}w=T.return;var B=sd(T.alternate,T,Zi);if(B!==null){yt=B;return}if(T=T.sibling,T!==null){yt=T;return}yt=T=w}while(T!==null);Si===0&&(Si=5)}function Xa(w,T){do{var B=zp(w.alternate,w);if(B!==null){B.flags&=32767,yt=B;return}if(B=w.return,B!==null&&(B.flags|=32768,B.subtreeFlags=0,B.deletions=null),!T&&(w=w.sibling,w!==null)){yt=w;return}yt=w=B}while(w!==null);Si=6,yt=null}function ea(w,T,B,q,te,fe,We,vt,Ht,Ri){var on=Vr.T,En=La();try{ka(2),Vr.T=null,zs(w,T,B,q,En,te,fe,We,vt,Ht,Ri)}finally{Vr.T=on,ka(En)}}function zs(w,T,B,q,te,fe,We,vt){do vo();while(qn!==null);if((nt&6)!==0)throw Error(h(327));var Ht=w.finishedWork;if(q=w.finishedLanes,Ht===null)return null;if(w.finishedWork=null,w.finishedLanes=0,Ht===w.current)throw Error(h(177));w.callbackNode=null,w.callbackPriority=0,w.cancelPendingCommit=null;var Ri=Ht.lanes|Ht.childLanes;if(Ri|=mp,Mt(w,q,Ri,fe,We,vt),w===qe&&(yt=qe=null,pt=0),(Ht.subtreeFlags&10256)===0&&(Ht.flags&10256)===0||pr||(pr=!0,Os=Ri,us=B,Jd(fp,function(){return vo(),null})),B=(Ht.flags&15990)!==0,(Ht.subtreeFlags&15990)!==0||B?(B=Vr.T,Vr.T=null,fe=La(),ka(2),We=nt,nt|=4,lu(w,Ht),Ah(Ht,w),Xp(w.containerInfo),w.current=Ht,cf(w,Ht.alternate,Ht),Md(),nt=We,ka(fe),Vr.T=B):w.current=Ht,pr?(pr=!1,qn=w,zr=q):_u(w,Ri),Ri=w.pendingLanes,Ri===0&&(Sr=null),Re(Ht.stateNode),Sn(w),T!==null)for(te=w.onRecoverableError,Ht=0;Ht<T.length;Ht++)Ri=T[Ht],te(Ri.value,{componentStack:Ri.stack});return(zr&3)!==0&&vo(),Ri=w.pendingLanes,(q&4194218)!==0&&(Ri&42)!==0?w===rr?Nr++:(Nr=0,rr=w):Nr=0,_n(0),null}function _u(w,T){(w.pooledCacheLanes&=T)===0&&(T=w.pooledCache,T!=null&&(w.pooledCache=null,Hl(T)))}function vo(){if(qn!==null){var w=qn,T=Os;Os=0;var B=kt(zr),q=32>B?32:B;B=Vr.T;var te=La();try{if(ka(q),Vr.T=null,qn===null)var fe=!1;else{q=us,us=null;var We=qn,vt=zr;if(qn=null,zr=0,(nt&6)!==0)throw Error(h(331));var Ht=nt;if(nt|=4,gi(We.current),Fp(We,We.current,vt,q),nt=Ht,_n(0,!1),no&&typeof no.onPostCommitFiberRoot=="function")try{no.onPostCommitFiberRoot(mo,We)}catch{}fe=!0}return fe}finally{ka(te),Vr.T=B,_u(w,T)}}return!1}function Ch(w,T,B){T=Lt(B,T),T=af(w.stateNode,T,2),w=qi(w,T,2),w!==null&&(Ze(w,2),Sn(w))}function ws(w,T,B){if(w.tag===3)Ch(w,w,B);else for(;T!==null;){if(T.tag===3){Ch(T,w,B);break}else if(T.tag===1){var q=T.stateNode;if(typeof T.type.getDerivedStateFromError=="function"||typeof q.componentDidCatch=="function"&&(Sr===null||!Sr.has(q))){w=Lt(B,w),B=Ml(2),q=qi(T,B,2),q!==null&&(Mh(B,q,T,w),Ze(q,2),Sn(q));break}}T=T.return}}function ud(w,T,B){var q=w.pingCache;if(q===null){q=w.pingCache=new Ft;var te=new Set;q.set(T,te)}else te=q.get(T),te===void 0&&(te=new Set,q.set(T,te));te.has(B)||(ti=!0,te.add(B),w=Um.bind(null,w,T,B),T.then(w,w))}function Um(w,T,B){var q=w.pingCache;q!==null&&q.delete(T),w.pingedLanes|=w.suspendedLanes&B,w.warmLanes&=~B,qe===w&&(pt&B)===B&&(Si===4||Si===3&&(pt&62914560)===pt&&300>To()-Dn?(nt&2)===0&&ur(w,0):an|=B,lr===pt&&(lr=0)),Sn(w)}function $u(w,T){T===0&&(T=Ce()),w=Ji(w,T),w!==null&&(Ze(w,T),Sn(w))}function yu(w){var T=w.memoizedState,B=0;T!==null&&(B=T.retryLane),$u(w,B)}function km(w,T){var B=0;switch(w.tag){case 13:var q=w.stateNode,te=w.memoizedState;te!==null&&(B=te.retryLane);break;case 19:q=w.stateNode;break;case 22:q=w.stateNode._retryCache;break;default:throw Error(h(314))}q!==null&&q.delete(T),$u(w,B)}function Jd(w,T){return kh(w,T)}function Vm(w,T,B,q){this.tag=w,this.key=B,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=T,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=q,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zl(w){return w=w.prototype,!(!w||!w.isReactComponent)}function Zo(w,T){var B=w.alternate;return B===null?(B=i(w.tag,T,w.key,w.mode),B.elementType=w.elementType,B.type=w.type,B.stateNode=w.stateNode,B.alternate=w,w.alternate=B):(B.pendingProps=T,B.type=w.type,B.flags=0,B.subtreeFlags=0,B.deletions=null),B.flags=w.flags&31457280,B.childLanes=w.childLanes,B.lanes=w.lanes,B.child=w.child,B.memoizedProps=w.memoizedProps,B.memoizedState=w.memoizedState,B.updateQueue=w.updateQueue,T=w.dependencies,B.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext},B.sibling=w.sibling,B.index=w.index,B.ref=w.ref,B.refCleanup=w.refCleanup,B}function Rh(w,T){w.flags&=31457282;var B=w.alternate;return B===null?(w.childLanes=0,w.lanes=T,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=B.childLanes,w.lanes=B.lanes,w.child=B.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=B.memoizedProps,w.memoizedState=B.memoizedState,w.updateQueue=B.updateQueue,w.type=B.type,T=B.dependencies,w.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext}),w}function zc(w,T,B,q,te,fe){var We=0;if(q=w,typeof w=="function")Zl(w)&&(We=1);else if(typeof w=="string")We=$l&&So?jc(w,B,Mo.current)?26:qc(w)?27:5:$l?jc(w,B,Mo.current)?26:5:So&&qc(w)?27:5;else e:switch(w){case xu:return Ih(B.children,te,fe,T);case fd:We=8,te|=24;break;case dd:return w=i(12,B,T,te|2),w.elementType=dd,w.lanes=fe,w;case Lh:return w=i(13,B,T,te),w.elementType=Lh,w.lanes=fe,w;case xf:return w=i(19,B,T,te),w.elementType=xf,w.lanes=fe,w;case rp:return Qd(B,te,fe,T);default:if(typeof w=="object"&&w!==null)switch(w.$$typeof){case Vp:case Bc:We=10;break e;case Qu:We=9;break e;case yf:We=11;break e;case Gp:We=14;break e;case Nc:We=16,q=null;break e}We=29,B=Error(h(130,w===null?"null":typeof w,"")),q=null}return T=i(We,B,T,te),T.elementType=w,T.type=q,T.lanes=fe,T}function Ih(w,T,B,q){return w=i(7,w,q,T),w.lanes=B,w}function Qd(w,T,B,q){w=i(22,w,q,T),w.elementType=rp,w.lanes=B;var te={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var fe=te._current;if(fe===null)throw Error(h(456));if((te._pendingVisibility&2)===0){var We=Ji(fe,2);We!==null&&(te._pendingVisibility|=2,Ua(We,fe,2))}},attach:function(){var fe=te._current;if(fe===null)throw Error(h(456));if((te._pendingVisibility&2)!==0){var We=Ji(fe,2);We!==null&&(te._pendingVisibility&=-3,Ua(We,fe,2))}}};return w.stateNode=te,w}function Ju(w,T,B){return w=i(6,w,null,T),w.lanes=B,w}function gf(w,T,B){return T=i(4,w.children!==null?w.children:[],w.key,T),T.lanes=B,T.stateNode={containerInfo:w.containerInfo,pendingChildren:null,implementation:w.implementation},T}function Dh(w,T,B,q,te,fe,We,vt){this.tag=1,this.containerInfo=w,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ll,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Te(0),this.hiddenUpdates=Te(null),this.identifierPrefix=q,this.onUncaughtError=te,this.onCaughtError=fe,this.onRecoverableError=We,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=vt,this.incompleteTransitions=new Map}function bo(w,T,B,q,te,fe,We,vt,Ht,Ri,on,En){return w=new Dh(w,T,B,We,vt,Ht,Ri,En),T=1,fe===!0&&(T|=24),fe=i(3,null,null,T),w.current=fe,fe.stateNode=w,T=xo(),T.refCount++,w.pooledCache=T,T.refCount++,fe.memoizedState={element:q,isDehydrated:B,cache:T},dr(fe),w}function _f(w){return w?(w=Fh,w):Fh}function ep(w){var T=w._reactInternals;if(T===void 0)throw typeof w.render=="function"?Error(h(188)):(w=Object.keys(w).join(","),Error(h(268,w)));return w=j(T),w=w!==null?$(w):null,w===null?null:Uc(w.stateNode)}function hd(w,T,B,q,te,fe){te=_f(te),q.context===null?q.context=te:q.pendingContext=te,q=Qi(T),q.payload={element:B},fe=fe===void 0?null:fe,fe!==null&&(q.callback=fe),B=qi(w,q,T),B!==null&&(Ua(B,w,T),Xn(B,w,T))}function tp(w,T){if(w=w.memoizedState,w!==null&&w.dehydrated!==null){var B=w.retryLane;w.retryLane=B!==0&&B<T?B:T}}function Gm(w,T){tp(w,T),(w=w.alternate)&&tp(w,T)}var nr={},ip=fv(),to=Mse(),Rl=Object.assign,np=Symbol.for("react.element"),Oc=Symbol.for("react.transitional.element"),pc=Symbol.for("react.portal"),xu=Symbol.for("react.fragment"),fd=Symbol.for("react.strict_mode"),dd=Symbol.for("react.profiler"),Vp=Symbol.for("react.provider"),Qu=Symbol.for("react.consumer"),Bc=Symbol.for("react.context"),yf=Symbol.for("react.forward_ref"),Lh=Symbol.for("react.suspense"),xf=Symbol.for("react.suspense_list"),Gp=Symbol.for("react.memo"),Nc=Symbol.for("react.lazy"),rp=Symbol.for("react.offscreen"),Hp=Symbol.for("react.memo_cache_sentinel"),xg=Symbol.iterator,eh=Symbol.for("react.client.reference"),Vr=ip.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,jp,vf,th=!1,ih=Array.isArray,qp=e.rendererVersion,pd=e.rendererPackageName,Fc=e.extraDevToolsConfig,Uc=e.getPublicInstance,nh=e.getRootHostContext,vg=e.getChildHostContext,Il=e.prepareForCommit,Xp=e.resetAfterCommit,md=e.createInstance,vu=e.appendInitialChild,rh=e.finalizeInitialChildren,bu=e.shouldSetTextContent,gd=e.createTextInstance,Hm=e.scheduleTimeout,sp=e.cancelTimeout,ll=e.noTimeout,sh=e.isPrimaryRenderer;e.warnsIfNotActing;var Yo=e.supportsMutation,Yl=e.supportsPersistence,cl=e.supportsHydration,ap=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var _d=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var ka=e.setCurrentUpdatePriority,La=e.getCurrentUpdatePriority,Oo=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var ah=e.shouldAttemptEagerTransition,op=e.detachDeletedInstance;e.requestPostPaintCallback;var kc=e.maySuspendCommit,wu=e.preloadInstance,Kl=e.startSuspendingCommit,Va=e.suspendInstance,Ph=e.waitForCommitToBeReady,po=e.NotPendingTransition,oi=e.HostTransitionContext,Js=e.resetFormInstance;e.bindToConsole;var ha=e.supportsMicrotasks,Su=e.scheduleMicrotask,gn=e.supportsTestSelectors,Tu=e.findFiberRoot,lp=e.getBoundingRect,cp=e.getTextContent,mc=e.isHiddenSubtree,jm=e.matchAccessibilityRole,Ea=e.setFocusIfFocusable,Wp=e.setupIntersectionObserver,Mu=e.appendChild,a_=e.appendChildToContainer,Dl=e.commitTextUpdate,bg=e.commitMount,Bo=e.commitUpdate,Eu=e.insertBefore,yd=e.insertInContainerBefore,No=e.removeChild,Pa=e.removeChildFromContainer,zh=e.resetTextContent,up=e.hideInstance,Vc=e.hideTextInstance,ms=e.unhideInstance,Gc=e.unhideTextInstance,hp=e.clearContainer,qm=e.cloneInstance,Zp=e.createContainerChildSet,Xm=e.appendChildToContainerChildSet,wg=e.finalizeContainerChildren,Oh=e.replaceContainerChildren,Bh=e.cloneHiddenInstance,fi=e.cloneHiddenTextInstance,Mi=e.isSuspenseInstancePending,Au=e.isSuspenseInstanceFallback,Ys=e.getSuspenseInstanceFallbackErrorDetails,dt=e.registerSuspenseInstanceRetry,Sg=e.canHydrateFormStateMarker,Yp=e.isFormStateMarkerMatching,Hc=e.getNextHydratableSibling,xd=e.getFirstHydratableChild,bf=e.getFirstHydratableChildWithinContainer,Tg=e.getFirstHydratableChildWithinSuspenseInstance,vd=e.canHydrateInstance,o_=e.canHydrateTextInstance,l_=e.canHydrateSuspenseInstance,c_=e.hydrateInstance,Kp=e.hydrateTextInstance,Nh=e.hydrateSuspenseInstance,$p=e.getNextHydratableInstanceAfterSuspenseInstance,bd=e.commitHydratedContainer,wf=e.commitHydratedSuspenseInstance,Sf=e.clearSuspenseBoundary,gc=e.clearSuspenseBoundaryFromContainer,Mg=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var Eg=e.validateHydratableInstance,Ag=e.validateHydratableTextInstance,$l=e.supportsResources,jc=e.isHostHoistableType,wo=e.getHoistableRoot,Jp=e.getResource,wd=e.acquireResource,Cg=e.releaseResource,Ms=e.hydrateHoistable,vr=e.mountHoistable,Wm=e.unmountHoistable,Tf=e.createHoistableInstance,Mf=e.prepareToCommitHoistables,Sd=e.mayResourceSuspendCommit,Cu=e.preloadResource,Qp=e.suspendResource,So=e.supportsSingletons,em=e.resolveSingletonInstance,Zm=e.clearSingleton,_c=e.acquireSingletonInstance,ul=e.releaseSingletonInstance,qc=e.isHostSingletonType,Ef=[],Ru=-1,Fh={},io=Math.clz32?Math.clz32:ue,Af=Math.log,Jl=Math.LN2,Uh=128,Cf=4194304,kh=to.unstable_scheduleCallback,Td=to.unstable_cancelCallback,Aa=to.unstable_shouldYield,Md=to.unstable_requestPaint,To=to.unstable_now,tm=to.unstable_ImmediatePriority,Rf=to.unstable_UserBlockingPriority,fp=to.unstable_NormalPriority,dp=to.unstable_IdlePriority,Ed=to.log,Xc=to.unstable_setDisableYieldValue,mo=null,no=null,Ll=typeof Object.is=="function"?Object.is:et,Ad=new WeakMap,ga=[],Ca=0,If=null,pp=0,hl=[],Ql=0,Wc=null,Zc=1,Pl="",Mo=ie(null),Cd=ie(null),yc=ie(null),Rd=ie(null),Eo=null,ro=null,Ws=!1,xc=null,vc=!1,Es=Error(h(519)),fl=[],Df=0,mp=0,gp=null,Iu=null,Id=!1,Dd=!1,ec=!1,dl=0,Lf=null,_a=0,Ga=0,Yc=null,Kc=!1,oh=!1,im=Object.prototype.hasOwnProperty,Ks=Error(h(460)),_p=Error(h(474)),Ym={then:function(){}},lh=null,$c=null,pl=0,Jc=ja(!0),Pf=ja(!1),Fo=ie(null),so=ie(0),ao=ie(null),Ao=null,na=ie(0),ch=0,gs=null,ta=null,oo=null,tc=!1,cs=!1,go=!1,zf=0,Wa=0,Du=null,Km=0,zl=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},rs={readContext:uo,use:wt,useCallback:oe,useContext:oe,useEffect:oe,useImperativeHandle:oe,useLayoutEffect:oe,useInsertionEffect:oe,useMemo:oe,useReducer:oe,useRef:oe,useState:oe,useDebugValue:oe,useDeferredValue:oe,useTransition:oe,useSyncExternalStore:oe,useId:oe};rs.useCacheRefresh=oe,rs.useMemoCache=oe,rs.useHostTransitionStatus=oe,rs.useFormState=oe,rs.useActionState=oe,rs.useOptimistic=oe;var wa={readContext:uo,use:wt,useCallback:function(w,T){return Wt().memoizedState=[w,T===void 0?null:T],w},useContext:uo,useEffect:Jf,useImperativeHandle:function(w,T,B){B=B!=null?B.concat([w]):null,wl(4194308,4,Sl.bind(null,T,w),B)},useLayoutEffect:function(w,T){return wl(4194308,4,w,T)},useInsertionEffect:function(w,T){wl(4,2,w,T)},useMemo:function(w,T){var B=Wt();T=T===void 0?null:T;var q=w();if(go){Qe(!0);try{w()}finally{Qe(!1)}}return B.memoizedState=[q,T],q},useReducer:function(w,T,B){var q=Wt();if(B!==void 0){var te=B(T);if(go){Qe(!0);try{B(T)}finally{Qe(!1)}}}else te=T;return q.memoizedState=q.baseState=te,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:w,lastRenderedState:te},q.queue=w,w=w.dispatch=il.bind(null,gs,w),[q.memoizedState,w]},useRef:function(w){var T=Wt();return w={current:w},T.memoizedState=w},useState:function(w){w=or(w);var T=w.queue,B=zm.bind(null,gs,T);return T.dispatch=B,[w.memoizedState,B]},useDebugValue:Vl,useDeferredValue:function(w,T){var B=Wt();return nu(B,w,T)},useTransition:function(){var w=or(!1);return w=Qf.bind(null,gs,w.queue,!0,!1),Wt().memoizedState=w,[!1,w]},useSyncExternalStore:function(w,T,B){var q=gs,te=Wt();if(Ws){if(B===void 0)throw Error(h(407));B=B()}else{if(B=T(),qe===null)throw Error(h(349));(pt&60)!==0||Vn(q,T,B)}te.memoizedState=B;var fe={value:B,getSnapshot:T};return te.queue=fe,Jf(kn.bind(null,q,fe,w),[w]),q.flags|=2048,ma(9,Un.bind(null,q,fe,B,T),{destroy:void 0},null),B},useId:function(){var w=Wt(),T=qe.identifierPrefix;if(Ws){var B=Pl,q=Zc;B=(q&~(1<<32-io(q)-1)).toString(32)+B,T=":"+T+"R"+B,B=zf++,0<B&&(T+="H"+B.toString(32)),T+=":"}else B=Km++,T=":"+T+"r"+B.toString(32)+":";return w.memoizedState=T},useCacheRefresh:function(){return Wt().memoizedState=su.bind(null,gs)}};wa.useMemoCache=ht,wa.useHostTransitionStatus=ru,wa.useFormState=qa,wa.useActionState=qa,wa.useOptimistic=function(w){var T=Wt();T.memoizedState=T.baseState=w;var B={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return T.queue=B,T=nf.bind(null,gs,!0,B),B.dispatch=T,[w,T]};var lo={readContext:uo,use:wt,useCallback:iu,useContext:uo,useEffect:kl,useImperativeHandle:Ka,useInsertionEffect:tl,useLayoutEffect:Cc,useMemo:oc,useReducer:mi,useRef:Ul,useState:function(){return mi(bt)},useDebugValue:Vl,useDeferredValue:function(w,T){var B=ye();return wh(B,ta.memoizedState,w,T)},useTransition:function(){var w=mi(bt)[0],T=ye().memoizedState;return[typeof w=="boolean"?w:it(w),T]},useSyncExternalStore:pn,useId:Na};lo.useCacheRefresh=ed,lo.useMemoCache=ht,lo.useHostTransitionStatus=ru,lo.useFormState=as,lo.useActionState=as,lo.useOptimistic=function(w,T){var B=ye();return jn(B,ta,w,T)};var p={readContext:uo,use:wt,useCallback:iu,useContext:uo,useEffect:kl,useImperativeHandle:Ka,useInsertionEffect:tl,useLayoutEffect:Cc,useMemo:oc,useReducer:ji,useRef:Ul,useState:function(){return ji(bt)},useDebugValue:Vl,useDeferredValue:function(w,T){var B=ye();return ta===null?nu(B,w,T):wh(B,ta.memoizedState,w,T)},useTransition:function(){var w=ji(bt)[0],T=ye().memoizedState;return[typeof w=="boolean"?w:it(w),T]},useSyncExternalStore:pn,useId:Na};p.useCacheRefresh=ed,p.useMemoCache=ht,p.useHostTransitionStatus=ru,p.useFormState=Ma,p.useActionState=Ma,p.useOptimistic=function(w,T){var B=ye();return ta!==null?jn(B,ta,w,T):(B.baseState=w,[w,B.queue.dispatch])};var s={isMounted:function(w){return(w=w._reactInternals)?N(w)===w:!1},enqueueSetState:function(w,T,B){w=w._reactInternals;var q=Qa(),te=Qi(q);te.payload=T,B!=null&&(te.callback=B),T=qi(w,te,q),T!==null&&(Ua(T,w,q),Xn(T,w,q))},enqueueReplaceState:function(w,T,B){w=w._reactInternals;var q=Qa(),te=Qi(q);te.tag=1,te.payload=T,B!=null&&(te.callback=B),T=qi(w,te,q),T!==null&&(Ua(T,w,q),Xn(T,w,q))},enqueueForceUpdate:function(w,T){w=w._reactInternals;var B=Qa(),q=Qi(B);q.tag=2,T!=null&&(q.callback=T),T=qi(w,q,B),T!==null&&(Ua(T,w,B),Xn(T,w,B))}},c=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var T=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(T))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)},m=Error(h(461)),b=!1,M={dehydrated:null,treeContext:null,retryLane:0},A=ie(null),D=null,O=null,V=typeof AbortController<"u"?AbortController:function(){var w=[],T=this.signal={aborted:!1,addEventListener:function(B,q){w.push(q)}};this.abort=function(){T.aborted=!0,w.forEach(function(B){return B()})}},H=to.unstable_scheduleCallback,Q=to.unstable_NormalPriority,K={$$typeof:Bc,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},ee=Vr.S;Vr.S=function(w,T){typeof T=="object"&&T!==null&&typeof T.then=="function"&&Ei(w,T),ee!==null&&ee(w,T)};var le=ie(null),se=!1,pe=!1,de=!1,be=typeof WeakSet=="function"?WeakSet:Set,Me=null,we=!1,Ue=null,Pe=!1,Ne=null,Oe=8192,Le={getCacheForType:function(w){var T=uo(K),B=T.data.get(w);return B===void 0&&(B=w(),T.data.set(w,B)),B}},Ye=0,ct=1,rt=2,_t=3,xt=4;if(typeof Symbol=="function"&&Symbol.for){var St=Symbol.for;Ye=St("selector.component"),ct=St("selector.has_pseudo_class"),rt=St("selector.role"),_t=St("selector.test_id"),xt=St("selector.text")}var Ft=typeof WeakMap=="function"?WeakMap:Map,nt=0,qe=null,yt=null,pt=0,Ut=0,ei=null,vi=!1,ni=!1,ti=!1,Zi=0,Si=0,Ai=0,Oi=0,an=0,Mn=0,lr=0,Lr=null,Yi=null,Ir=!1,Dn=0,er=1/0,Pr=null,Sr=null,pr=!1,qn=null,zr=0,Os=0,us=null,Nr=0,rr=null;return nr.attemptContinuousHydration=function(w){if(w.tag===13){var T=Ji(w,67108864);T!==null&&Ua(T,w,67108864),Gm(w,67108864)}},nr.attemptHydrationAtCurrentPriority=function(w){if(w.tag===13){var T=Qa(),B=Ji(w,T);B!==null&&Ua(B,w,T),Gm(w,T)}},nr.attemptSynchronousHydration=function(w){switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var T=me(w.pendingLanes);if(T!==0){for(w.pendingLanes|=2,w.entangledLanes|=2;T;){var B=1<<31-io(T);w.entanglements[1]|=B,T&=~B}Sn(w),(nt&6)===0&&(er=To()+500,_n(0))}}break;case 13:T=Ji(w,2),T!==null&&Ua(T,w,2),Up(),Gm(w,2)}},nr.batchedUpdates=function(w,T){return w(T)},nr.createComponentSelector=function(w){return{$$typeof:Ye,value:w}},nr.createContainer=function(w,T,B,q,te,fe,We,vt,Ht,Ri){return bo(w,T,!1,null,B,q,fe,We,vt,Ht,Ri,null)},nr.createHasPseudoClassSelector=function(w){return{$$typeof:ct,value:w}},nr.createHydrationContainer=function(w,T,B,q,te,fe,We,vt,Ht,Ri,on,En,On){return w=bo(B,q,!0,w,te,fe,vt,Ht,Ri,on,En,On),w.context=_f(null),B=w.current,q=Qa(),te=Qi(q),te.callback=T??null,qi(B,te,q),w.current.lanes=q,Ze(w,q),Sn(w),w},nr.createPortal=function(w,T,B){var q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pc,key:q==null?null:""+q,children:w,containerInfo:T,implementation:B}},nr.createRoleSelector=function(w){return{$$typeof:rt,value:w}},nr.createTestNameSelector=function(w){return{$$typeof:_t,value:w}},nr.createTextSelector=function(w){return{$$typeof:xt,value:w}},nr.defaultOnCaughtError=function(w){console.error(w)},nr.defaultOnRecoverableError=function(w){c(w)},nr.defaultOnUncaughtError=function(w){c(w)},nr.deferredUpdates=function(w){var T=Vr.T,B=La();try{return ka(32),Vr.T=null,w()}finally{ka(B),Vr.T=T}},nr.discreteUpdates=function(w,T,B,q,te){var fe=Vr.T,We=La();try{return ka(2),Vr.T=null,w(T,B,q,te)}finally{ka(We),Vr.T=fe,nt===0&&(er=To()+500)}},nr.findAllNodes=Wo,nr.findBoundingRects=function(w,T){if(!gn)throw Error(h(363));T=Wo(w,T),w=[];for(var B=0;B<T.length;B++)w.push(lp(T[B]));for(T=w.length-1;0<T;T--){B=w[T];for(var q=B.x,te=q+B.width,fe=B.y,We=fe+B.height,vt=T-1;0<=vt;vt--)if(T!==vt){var Ht=w[vt],Ri=Ht.x,on=Ri+Ht.width,En=Ht.y,On=En+Ht.height;if(q>=Ri&&fe>=En&&te<=on&&We<=On){w.splice(T,1);break}else if(q!==Ri||B.width!==Ht.width||On<fe||En>We){if(!(fe!==En||B.height!==Ht.height||on<q||Ri>te)){Ri>q&&(Ht.width+=Ri-q,Ht.x=q),on<te&&(Ht.width=te-Ri),w.splice(T,1);break}}else{En>fe&&(Ht.height+=En-fe,Ht.y=fe),On<We&&(Ht.height=We-En),w.splice(T,1);break}}}return w},nr.findHostInstance=ep,nr.findHostInstanceWithNoPortals=function(w){return w=j(w),w=w!==null?re(w):null,w===null?null:Uc(w.stateNode)},nr.findHostInstanceWithWarning=function(w){return ep(w)},nr.flushPassiveEffects=vo,nr.flushSyncFromReconciler=function(w){var T=nt;nt|=1;var B=Vr.T,q=La();try{if(ka(2),Vr.T=null,w)return w()}finally{ka(q),Vr.T=B,nt=T,(nt&6)===0&&_n(0)}},nr.flushSyncWork=Up,nr.focusWithin=function(w,T){if(!gn)throw Error(h(363));for(w=od(w),T=pu(w,T),T=Array.from(T),w=0;w<T.length;){var B=T[w++],q=B.tag;if(!mc(B)){if((q===5||q===26||q===27)&&Ea(B.stateNode))return!0;for(B=B.child;B!==null;)T.push(B),B=B.sibling}}return!1},nr.getFindAllNodesFailureDescription=function(w,T){if(!gn)throw Error(h(363));var B=0,q=[];w=[od(w),0];for(var te=0;te<w.length;){var fe=w[te++],We=fe.tag,vt=w[te++],Ht=T[vt];if((We!==5&&We!==26&&We!==27||!mc(fe))&&(pf(fe,Ht)&&(q.push(Lc(Ht)),vt++,vt>B&&(B=vt)),vt<T.length))for(fe=fe.child;fe!==null;)w.push(fe,vt),fe=fe.sibling}if(B<T.length){for(w=[];B<T.length;B++)w.push(Lc(T[B]));return`findAllNodes was able to match part of the selector:
  `+(q.join(" > ")+`

No matching component was found for:
  `)+w.join(" > ")}return null},nr.getPublicRootInstance=function(w){if(w=w.current,!w.child)return null;switch(w.child.tag){case 27:case 5:return Uc(w.child.stateNode);default:return w.child.stateNode}},nr.injectIntoDevTools=function(){var w={bundleType:0,version:qp,rendererPackageName:pd,currentDispatcherRef:Vr,findFiberByHostInstance:ap,reconcilerVersion:"19.0.0"};if(Fc!==null&&(w.rendererConfig=Fc),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")w=!1;else{var T=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(T.isDisabled||!T.supportsFiber)w=!0;else{try{mo=T.inject(w),no=T}catch{}w=!!T.checkDCE}}return w},nr.isAlreadyRendering=function(){return!1},nr.observeVisibleRects=function(w,T,B,q){if(!gn)throw Error(h(363));w=Wo(w,T);var te=Wp(w,B,q).disconnect;return{disconnect:function(){te()}}},nr.shouldError=function(){return null},nr.shouldSuspend=function(){return!1},nr.startHostTransition=function(w,T,B,q){if(w.tag!==5)throw Error(h(476));var te=Pm(w).queue;Qf(w,te,T,po,B===null?l:function(){var fe=Pm(w).next.queue;return Sh(w,fe,{},Qa()),B(q)})},nr.updateContainer=function(w,T,B,q){var te=T.current,fe=Qa();return hd(te,fe,w,T,B,q),fe},nr.updateContainerSync=function(w,T,B,q){return T.tag===0&&vo(),hd(T.current,2,w,T,B,q),2},nr},n.exports.default=n.exports,Object.defineProperty(n.exports,"__esModule",{value:!0})})(H3)),H3.exports}var jN;function Ase(){return jN||(jN=1,G3.exports=Ese()),G3.exports}var Cse=Ase();const Rse=yM(Cse);var X3={exports:{}},W3={};var qN;function Ise(){return qN||(qN=1,(function(n){function e(Re,Qe){var et=Re.length;Re.push(Qe);e:for(;0<et;){var Lt=et-1>>>1,jt=Re[Lt];if(0<h(jt,Qe))Re[Lt]=Qe,Re[et]=jt,et=Lt;else break e}}function i(Re){return Re.length===0?null:Re[0]}function l(Re){if(Re.length===0)return null;var Qe=Re[0],et=Re.pop();if(et!==Qe){Re[0]=et;e:for(var Lt=0,jt=Re.length,Ge=jt>>>1;Lt<Ge;){var Et=2*(Lt+1)-1,Vt=Re[Et],ii=Et+1,ki=Re[ii];if(0>h(Vt,et))ii<jt&&0>h(ki,Vt)?(Re[Lt]=ki,Re[ii]=et,Lt=ii):(Re[Lt]=Vt,Re[Et]=et,Lt=Et);else if(ii<jt&&0>h(ki,et))Re[Lt]=ki,Re[ii]=et,Lt=ii;else break e}}return Qe}function h(Re,Qe){var et=Re.sortIndex-Qe.sortIndex;return et!==0?et:Re.id-Qe.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var g=performance;n.unstable_now=function(){return g.now()}}else{var v=Date,r=v.now();n.unstable_now=function(){return v.now()-r}}var C=[],I=[],z=1,N=null,k=3,j=!1,$=!1,re=!1,ie=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,ae=typeof setImmediate<"u"?setImmediate:null;function ue(Re){for(var Qe=i(I);Qe!==null;){if(Qe.callback===null)l(I);else if(Qe.startTime<=Re)l(I),Qe.sortIndex=Qe.expirationTime,e(C,Qe);else break;Qe=i(I)}}function me(Re){if(re=!1,ue(Re),!$)if(i(C)!==null)$=!0,Gt();else{var Qe=i(I);Qe!==null&&kt(me,Qe.startTime-Re)}}var Ae=!1,Se=-1,ze=5,je=-1;function Ce(){return!(n.unstable_now()-je<ze)}function Te(){if(Ae){var Re=n.unstable_now();je=Re;var Qe=!0;try{e:{$=!1,re&&(re=!1,Y(Se),Se=-1),j=!0;var et=k;try{t:{for(ue(Re),N=i(C);N!==null&&!(N.expirationTime>Re&&Ce());){var Lt=N.callback;if(typeof Lt=="function"){N.callback=null,k=N.priorityLevel;var jt=Lt(N.expirationTime<=Re);if(Re=n.unstable_now(),typeof jt=="function"){N.callback=jt,ue(Re),Qe=!0;break t}N===i(C)&&l(C),ue(Re)}else l(C);N=i(C)}if(N!==null)Qe=!0;else{var Ge=i(I);Ge!==null&&kt(me,Ge.startTime-Re),Qe=!1}}break e}finally{N=null,k=et,j=!1}Qe=void 0}}finally{Qe?Ze():Ae=!1}}}var Ze;if(typeof ae=="function")Ze=function(){ae(Te)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,mt=Mt.port2;Mt.port1.onmessage=Te,Ze=function(){mt.postMessage(null)}}else Ze=function(){ie(Te,0)};function Gt(){Ae||(Ae=!0,Ze())}function kt(Re,Qe){Se=ie(function(){Re(n.unstable_now())},Qe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){$||j||($=!0,Gt())},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ze=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return i(C)},n.unstable_next=function(Re){switch(k){case 1:case 2:case 3:var Qe=3;break;default:Qe=k}var et=k;k=Qe;try{return Re()}finally{k=et}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,Qe){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var et=k;k=Re;try{return Qe()}finally{k=et}},n.unstable_scheduleCallback=function(Re,Qe,et){var Lt=n.unstable_now();switch(typeof et=="object"&&et!==null?(et=et.delay,et=typeof et=="number"&&0<et?Lt+et:Lt):et=Lt,Re){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=et+jt,Re={id:z++,callback:Qe,priorityLevel:Re,startTime:et,expirationTime:jt,sortIndex:-1},et>Lt?(Re.sortIndex=et,e(I,Re),i(C)===null&&Re===i(I)&&(re?(Y(Se),Se=-1):re=!0,kt(me,et-Lt))):(Re.sortIndex=jt,e(C,Re),$||j||($=!0,Gt())),Re},n.unstable_shouldYield=Ce,n.unstable_wrapCallback=function(Re){var Qe=k;return function(){var et=k;k=Qe;try{return Re.apply(this,arguments)}finally{k=et}}}})(W3)),W3}var XN;function Dse(){return XN||(XN=1,X3.exports=Ise()),X3.exports}var WN=Dse();function sD(n,e,i){if(!n)return;if(i(n)===!0)return n;let l=e?n.return:n.child;for(;l;){const h=sD(l,e,i);if(h)return h;l=e?null:l.sibling}}function iV(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const aD=iV(Ii.createContext(null));class nV extends Ii.Component{render(){return Ii.createElement(aD.Provider,{value:this._reactInternals},this.props.children)}}function rV(){const n=Ii.useContext(aD);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Ii.useId();return Ii.useMemo(()=>{for(const i of[n,n?.alternate]){if(!i)continue;const l=sD(i,!1,h=>{let g=h.memoizedState;for(;g;){if(g.memoizedState===e)return!0;g=g.next}});if(l)return l}},[n,e])}const Lse=Symbol.for("react.context"),Pse=n=>n!==null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===Lse;function zse(){const n=rV(),[e]=Ii.useState(()=>new Map);e.clear();let i=n;for(;i;){const l=i.type;Pse(l)&&l!==aD&&!e.has(l)&&e.set(l,Ii.use(iV(l))),i=i.return}return e}function Ose(){const n=zse();return Ii.useMemo(()=>Array.from(n.keys()).reduce((e,i)=>l=>Ii.createElement(e,null,Ii.createElement(i.Provider,{...l,value:n.get(i)})),e=>Ii.createElement(nV,{...e})),[n])}function sV(n){let e=n.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const aV=n=>n&&n.isOrthographicCamera,Bse=n=>n&&n.hasOwnProperty("current"),Nse=n=>n!=null&&(typeof n=="string"||typeof n=="number"||n.isColor),xw=((n,e)=>typeof window<"u"&&(((n=window.document)==null?void 0:n.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Ii.useLayoutEffect:Ii.useEffect;function oV(n){const e=Ii.useRef(n);return xw(()=>void(e.current=n),[n]),e}function Fse(){const n=rV(),e=Ose();return Ii.useMemo(()=>({children:i})=>{const h=!!sD(n,!0,g=>g.type===Ii.StrictMode)?Ii.StrictMode:Ii.Fragment;return hi.jsx(h,{children:hi.jsx(e,{children:i})})},[n,e])}function Use({set:n}){return xw(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}const kse=(n=>(n=class extends Ii.Component{constructor(...i){super(...i),this.state={error:!1}}componentDidCatch(i){this.props.set(i)}render(){return this.state.error?null:this.props.children}},n.getDerivedStateFromError=()=>({error:!0}),n))();function lV(n){var e;const i=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],i),n[1]):n}function Lx(n){var e;return(e=n.__r3f)==null?void 0:e.root.getState()}const $o={obj:n=>n===Object(n)&&!$o.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,nul:n=>n===null,arr:n=>Array.isArray(n),equ(n,e,{arrays:i="shallow",objects:l="reference",strict:h=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if($o.str(n)||$o.num(n)||$o.boo(n))return n===e;const g=$o.obj(n);if(g&&l==="reference")return n===e;const v=$o.arr(n);if(v&&i==="reference")return n===e;if((v||g)&&n===e)return!0;let r;for(r in n)if(!(r in e))return!1;if(g&&i==="shallow"&&l==="shallow"){for(r in h?e:n)if(!$o.equ(n[r],e[r],{strict:h,objects:"reference"}))return!1}else for(r in h?e:n)if(n[r]!==e[r])return!1;if($o.und(r)){if(v&&n.length===0&&e.length===0||g&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Vse(n){n.type!=="Scene"&&(n.dispose==null||n.dispose());for(const e in n){const i=n[e];i?.type!=="Scene"&&(i==null||i.dispose==null||i.dispose())}}const cV=["children","key","ref"];function Gse(n){const e={};for(const i in n)cV.includes(i)||(e[i]=n[i]);return e}function pM(n,e,i,l){const h=n;let g=h?.__r3f;return g||(g={root:e,type:i,parent:null,children:[],props:Gse(l),object:h,eventCount:0,handlers:{},isHidden:!1},h&&(h.__r3f=g)),g}function ew(n,e){if(!e.includes("-"))return{root:n,key:e,target:n[e]};if(e in n)return{root:n,key:e,target:n[e]};let i=n;const l=e.split("-");for(const h of l){if(typeof i!="object"||i===null){if(i!==void 0){const g=l.slice(l.indexOf(h)).join("-");return{root:i,key:g,target:void 0}}return{root:n,key:e,target:void 0}}e=h,n=i,i=i[e]}return{root:n,key:e,target:i}}const ZN=/-\d+$/;function mM(n,e){if($o.str(e.props.attach)){if(ZN.test(e.props.attach)){const h=e.props.attach.replace(ZN,""),{root:g,key:v}=ew(n.object,h);Array.isArray(g[v])||(g[v]=[])}const{root:i,key:l}=ew(n.object,e.props.attach);e.previousAttach=i[l],i[l]=e.object}else $o.fun(e.props.attach)&&(e.previousAttach=e.props.attach(n.object,e.object))}function gM(n,e){if($o.str(e.props.attach)){const{root:i,key:l}=ew(n.object,e.props.attach),h=e.previousAttach;h===void 0?delete i[l]:i[l]=h}else e.previousAttach==null||e.previousAttach(n.object,e.object);delete e.previousAttach}const wR=[...cV,"args","dispose","attach","object","onUpdate","dispose"],YN=new Map;function Hse(n){let e=YN.get(n.constructor);try{e||(e=new n.constructor,YN.set(n.constructor,e))}catch{}return e}function jse(n,e){const i={};for(const l in e)if(!wR.includes(l)&&!$o.equ(e[l],n.props[l])){i[l]=e[l];for(const h in e)h.startsWith(`${l}-`)&&(i[h]=e[h])}for(const l in n.props){if(wR.includes(l)||e.hasOwnProperty(l))continue;const{root:h,key:g}=ew(n.object,l);if(h.constructor&&h.constructor.length===0){const v=Hse(h);$o.und(v)||(i[g]=v[g])}else i[g]=0}return i}const qse=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Xse=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function W_(n,e){var i;const l=n.__r3f,h=l&&sV(l).getState(),g=l?.eventCount;for(const r in e){let C=e[r];if(wR.includes(r))continue;if(l&&Xse.test(r)){typeof C=="function"?l.handlers[r]=C:delete l.handlers[r],l.eventCount=Object.keys(l.handlers).length;continue}if(C===void 0)continue;let{root:I,key:z,target:N}=ew(n,r);if(N===void 0&&(typeof I!="object"||I===null))throw Error(`R3F: Cannot set "${r}". Ensure it is an object before setting "${z}".`);if(N instanceof ov&&C instanceof ov)N.mask=C.mask;else if(N instanceof ar&&Nse(C))N.set(C);else if(N!==null&&typeof N=="object"&&typeof N.set=="function"&&typeof N.copy=="function"&&C!=null&&C.constructor&&N.constructor===C.constructor)N.copy(C);else if(N!==null&&typeof N=="object"&&typeof N.set=="function"&&Array.isArray(C))typeof N.fromArray=="function"?N.fromArray(C):N.set(...C);else if(N!==null&&typeof N=="object"&&typeof N.set=="function"&&typeof C=="number")typeof N.setScalar=="function"?N.setScalar(C):N.set(C);else{var v;I[z]=C,h&&!h.linear&&qse.includes(z)&&(v=I[z])!=null&&v.isTexture&&I[z].format===_h&&I[z].type===xh&&(I[z].colorSpace=Io)}}if(l!=null&&l.parent&&h!=null&&h.internal&&(i=l.object)!=null&&i.isObject3D&&g!==l.eventCount){const r=l.object,C=h.internal.interaction.indexOf(r);C>-1&&h.internal.interaction.splice(C,1),l.eventCount&&r.raycast!==null&&h.internal.interaction.push(r)}return l&&l.props.attach===void 0&&(l.object.isBufferGeometry?l.props.attach="geometry":l.object.isMaterial&&(l.props.attach="material")),l&&Tv(l),n}function Tv(n){var e;if(!n.parent)return;n.props.onUpdate==null||n.props.onUpdate(n.object);const i=(e=n.root)==null||e.getState==null?void 0:e.getState();i&&i.internal.frames===0&&i.invalidate()}function Wse(n,e){n.manual||(aV(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix())}const Gf=n=>n?.isObject3D;function ET(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function uV(n,e,i,l){const h=i.get(e);h&&(i.delete(e),i.size===0&&(n.delete(l),h.target.releasePointerCapture(l)))}function Zse(n,e){const{internal:i}=n.getState();i.interaction=i.interaction.filter(l=>l!==e),i.initialHits=i.initialHits.filter(l=>l!==e),i.hovered.forEach((l,h)=>{(l.eventObject===e||l.object===e)&&i.hovered.delete(h)}),i.capturedMap.forEach((l,h)=>{uV(i.capturedMap,e,l,h)})}function Yse(n){function e(C){const{internal:I}=n.getState(),z=C.offsetX-I.initialClick[0],N=C.offsetY-I.initialClick[1];return Math.round(Math.sqrt(z*z+N*N))}function i(C){return C.filter(I=>["Move","Over","Enter","Out","Leave"].some(z=>{var N;return(N=I.__r3f)==null?void 0:N.handlers["onPointer"+z]}))}function l(C,I){const z=n.getState(),N=new Set,k=[],j=I?I(z.internal.interaction):z.internal.interaction;for(let Y=0;Y<j.length;Y++){const ae=Lx(j[Y]);ae&&(ae.raycaster.camera=void 0)}z.previousRoot||z.events.compute==null||z.events.compute(C,z);function $(Y){const ae=Lx(Y);if(!ae||!ae.events.enabled||ae.raycaster.camera===null)return[];if(ae.raycaster.camera===void 0){var ue;ae.events.compute==null||ae.events.compute(C,ae,(ue=ae.previousRoot)==null?void 0:ue.getState()),ae.raycaster.camera===void 0&&(ae.raycaster.camera=null)}return ae.raycaster.camera?ae.raycaster.intersectObject(Y,!0):[]}let re=j.flatMap($).sort((Y,ae)=>{const ue=Lx(Y.object),me=Lx(ae.object);return!ue||!me?Y.distance-ae.distance:me.events.priority-ue.events.priority||Y.distance-ae.distance}).filter(Y=>{const ae=ET(Y);return N.has(ae)?!1:(N.add(ae),!0)});z.events.filter&&(re=z.events.filter(re,z));for(const Y of re){let ae=Y.object;for(;ae;){var ie;(ie=ae.__r3f)!=null&&ie.eventCount&&k.push({...Y,eventObject:ae}),ae=ae.parent}}if("pointerId"in C&&z.internal.capturedMap.has(C.pointerId))for(let Y of z.internal.capturedMap.get(C.pointerId).values())N.has(ET(Y.intersection))||k.push(Y.intersection);return k}function h(C,I,z,N){if(C.length){const k={stopped:!1};for(const j of C){let $=Lx(j.object);if($||j.object.traverseAncestors(re=>{const ie=Lx(re);if(ie)return $=ie,!1}),$){const{raycaster:re,pointer:ie,camera:Y,internal:ae}=$,ue=new gt(ie.x,ie.y,0).unproject(Y),me=Ce=>{var Te,Ze;return(Te=(Ze=ae.capturedMap.get(Ce))==null?void 0:Ze.has(j.eventObject))!=null?Te:!1},Ae=Ce=>{const Te={intersection:j,target:I.target};ae.capturedMap.has(Ce)?ae.capturedMap.get(Ce).set(j.eventObject,Te):ae.capturedMap.set(Ce,new Map([[j.eventObject,Te]])),I.target.setPointerCapture(Ce)},Se=Ce=>{const Te=ae.capturedMap.get(Ce);Te&&uV(ae.capturedMap,j.eventObject,Te,Ce)};let ze={};for(let Ce in I){let Te=I[Ce];typeof Te!="function"&&(ze[Ce]=Te)}let je={...j,...ze,pointer:ie,intersections:C,stopped:k.stopped,delta:z,unprojectedPoint:ue,ray:re.ray,camera:Y,stopPropagation(){const Ce="pointerId"in I&&ae.capturedMap.get(I.pointerId);if((!Ce||Ce.has(j.eventObject))&&(je.stopped=k.stopped=!0,ae.hovered.size&&Array.from(ae.hovered.values()).find(Te=>Te.eventObject===j.eventObject))){const Te=C.slice(0,C.indexOf(j));g([...Te,j])}},target:{hasPointerCapture:me,setPointerCapture:Ae,releasePointerCapture:Se},currentTarget:{hasPointerCapture:me,setPointerCapture:Ae,releasePointerCapture:Se},nativeEvent:I};if(N(je),k.stopped===!0)break}}}return C}function g(C){const{internal:I}=n.getState();for(const z of I.hovered.values())if(!C.length||!C.find(N=>N.object===z.object&&N.index===z.index&&N.instanceId===z.instanceId)){const k=z.eventObject.__r3f;if(I.hovered.delete(ET(z)),k!=null&&k.eventCount){const j=k.handlers,$={...z,intersections:C};j.onPointerOut==null||j.onPointerOut($),j.onPointerLeave==null||j.onPointerLeave($)}}}function v(C,I){for(let z=0;z<I.length;z++){const N=I[z].__r3f;N==null||N.handlers.onPointerMissed==null||N.handlers.onPointerMissed(C)}}function r(C){switch(C){case"onPointerLeave":case"onPointerCancel":return()=>g([]);case"onLostPointerCapture":return I=>{const{internal:z}=n.getState();"pointerId"in I&&z.capturedMap.has(I.pointerId)&&requestAnimationFrame(()=>{z.capturedMap.has(I.pointerId)&&(z.capturedMap.delete(I.pointerId),g([]))})}}return function(z){const{onPointerMissed:N,internal:k}=n.getState();k.lastEvent.current=z;const j=C==="onPointerMove",$=C==="onClick"||C==="onContextMenu"||C==="onDoubleClick",ie=l(z,j?i:void 0),Y=$?e(z):0;C==="onPointerDown"&&(k.initialClick=[z.offsetX,z.offsetY],k.initialHits=ie.map(ue=>ue.eventObject)),$&&!ie.length&&Y<=2&&(v(z,k.interaction),N&&N(z)),j&&g(ie);function ae(ue){const me=ue.eventObject,Ae=me.__r3f;if(!(Ae!=null&&Ae.eventCount))return;const Se=Ae.handlers;if(j){if(Se.onPointerOver||Se.onPointerEnter||Se.onPointerOut||Se.onPointerLeave){const ze=ET(ue),je=k.hovered.get(ze);je?je.stopped&&ue.stopPropagation():(k.hovered.set(ze,ue),Se.onPointerOver==null||Se.onPointerOver(ue),Se.onPointerEnter==null||Se.onPointerEnter(ue))}Se.onPointerMove==null||Se.onPointerMove(ue)}else{const ze=Se[C];ze?(!$||k.initialHits.includes(me))&&(v(z,k.interaction.filter(je=>!k.initialHits.includes(je))),ze(ue)):$&&k.initialHits.includes(me)&&v(z,k.interaction.filter(je=>!k.initialHits.includes(je)))}}h(ie,z,Y,ae)}}return{handlePointer:r}}const KN=n=>!!(n!=null&&n.render),hV=Ii.createContext(null),Kse=(n,e)=>{const i=Sse((r,C)=>{const I=new gt,z=new gt,N=new gt;function k(Y=C().camera,ae=z,ue=C().size){const{width:me,height:Ae,top:Se,left:ze}=ue,je=me/Ae;ae.isVector3?N.copy(ae):N.set(...ae);const Ce=Y.getWorldPosition(I).distanceTo(N);if(aV(Y))return{width:me/Y.zoom,height:Ae/Y.zoom,top:Se,left:ze,factor:1,distance:Ce,aspect:je};{const Te=Y.fov*Math.PI/180,Ze=2*Math.tan(Te/2)*Ce,Mt=Ze*(me/Ae);return{width:Mt,height:Ze,top:Se,left:ze,factor:me/Mt,distance:Ce,aspect:je}}}let j;const $=Y=>r(ae=>({performance:{...ae.performance,current:Y}})),re=new $i;return{set:r,get:C,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(Y=1)=>n(C(),Y),advance:(Y,ae)=>e(Y,ae,C()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new tD,pointer:re,mouse:re,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const Y=C();j&&clearTimeout(j),Y.performance.current!==Y.performance.min&&$(Y.performance.min),j=setTimeout(()=>$(C().performance.max),Y.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:k},setEvents:Y=>r(ae=>({...ae,events:{...ae.events,...Y}})),setSize:(Y,ae,ue=0,me=0)=>{const Ae=C().camera,Se={width:Y,height:ae,top:ue,left:me};r(ze=>({size:Se,viewport:{...ze.viewport,...k(Ae,z,Se)}}))},setDpr:Y=>r(ae=>{const ue=lV(Y);return{viewport:{...ae.viewport,dpr:ue,initialDpr:ae.viewport.initialDpr||ue}}}),setFrameloop:(Y="always")=>{const ae=C().clock;ae.stop(),ae.elapsedTime=0,Y!=="never"&&(ae.start(),ae.elapsedTime=0),r(()=>({frameloop:Y}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Ii.createRef(),active:!1,frames:0,priority:0,subscribe:(Y,ae,ue)=>{const me=C().internal;return me.priority=me.priority+(ae>0?1:0),me.subscribers.push({ref:Y,priority:ae,store:ue}),me.subscribers=me.subscribers.sort((Ae,Se)=>Ae.priority-Se.priority),()=>{const Ae=C().internal;Ae!=null&&Ae.subscribers&&(Ae.priority=Ae.priority-(ae>0?1:0),Ae.subscribers=Ae.subscribers.filter(Se=>Se.ref!==Y))}}}}}),l=i.getState();let h=l.size,g=l.viewport.dpr,v=l.camera;return i.subscribe(()=>{const{camera:r,size:C,viewport:I,gl:z,set:N}=i.getState();if(C.width!==h.width||C.height!==h.height||I.dpr!==g){h=C,g=I.dpr,Wse(r,C),I.dpr>0&&z.setPixelRatio(I.dpr);const k=typeof HTMLCanvasElement<"u"&&z.domElement instanceof HTMLCanvasElement;z.setSize(C.width,C.height,k)}r!==v&&(v=r,N(k=>({viewport:{...k.viewport,...k.viewport.getCurrentViewport(r)}})))}),i.subscribe(r=>n(r)),i};function fV(){const n=Ii.useContext(hV);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function oD(n=i=>i,e){return fV()(n,e)}function dV(n,e=0){const i=fV(),l=i.getState().internal.subscribe,h=oV(n);return xw(()=>l(h,e,i),[e,l,i]),null}function $se(n){const e=Rse(n);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Ii.version}),e}const pV=0,hv={},Jse=/^three(?=[A-Z])/,cE=n=>`${n[0].toUpperCase()}${n.slice(1)}`;let Qse=0;const eae=n=>typeof n=="function";function mV(n){if(eae(n)){const e=`${Qse++}`;return hv[e]=n,e}else Object.assign(hv,n)}function gV(n,e){const i=cE(n),l=hv[i];if(n!=="primitive"&&!l)throw new Error(`R3F: ${i} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(n==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function tae(n,e,i){var l;return n=cE(n)in hv?n:n.replace(Jse,""),gV(n,e),n==="primitive"&&(l=e.object)!=null&&l.__r3f&&delete e.object.__r3f,pM(e.object,i,n,e)}function iae(n){if(!n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?gM(n.parent,n):Gf(n.object)&&(n.object.visible=!1),n.isHidden=!0,Tv(n)}}function _V(n){if(n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?mM(n.parent,n):Gf(n.object)&&n.props.visible!==!1&&(n.object.visible=!0),n.isHidden=!1,Tv(n)}}function lD(n,e,i){const l=e.root.getState();if(!(!n.parent&&n.object!==l.scene)){if(!e.object){var h,g;const v=hv[cE(e.type)];e.object=(h=e.props.object)!=null?h:new v(...(g=e.props.args)!=null?g:[]),e.object.__r3f=e}if(W_(e.object,e.props),e.props.attach)mM(n,e);else if(Gf(e.object)&&Gf(n.object)){const v=n.object.children.indexOf(i?.object);if(i&&v!==-1){const r=n.object.children.indexOf(e.object);if(r!==-1){n.object.children.splice(r,1);const C=r<v?v-1:v;n.object.children.splice(C,0,e.object)}else e.object.parent=n.object,n.object.children.splice(v,0,e.object),e.object.dispatchEvent({type:"added"}),n.object.dispatchEvent({type:"childadded",child:e.object})}else n.object.add(e.object)}for(const v of e.children)lD(e,v);Tv(e)}}function Z3(n,e){e&&(e.parent=n,n.children.push(e),lD(n,e))}function $N(n,e,i){if(!e||!i)return;e.parent=n;const l=n.children.indexOf(i);l!==-1?n.children.splice(l,0,e):n.children.push(e),lD(n,e,i)}function yV(n){if(typeof n.dispose=="function"){const e=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():WN.unstable_scheduleCallback(WN.unstable_IdlePriority,e)}}function SR(n,e,i){if(!e)return;e.parent=null;const l=n.children.indexOf(e);l!==-1&&n.children.splice(l,1),e.props.attach?gM(n,e):Gf(e.object)&&Gf(n.object)&&(n.object.remove(e.object),Zse(sV(e),e.object));const h=e.props.dispose!==null&&i!==!1;for(let g=e.children.length-1;g>=0;g--){const v=e.children[g];SR(e,v,h)}e.children.length=0,delete e.object.__r3f,h&&e.type!=="primitive"&&e.object.type!=="Scene"&&yV(e.object),i===void 0&&Tv(e)}function nae(n,e){for(const i of[n,n.alternate])if(i!==null)if(typeof i.ref=="function"){i.refCleanup==null||i.refCleanup();const l=i.ref(e);typeof l=="function"&&(i.refCleanup=l)}else i.ref&&(i.ref.current=e)}const HT=[];function rae(){for(const[i]of HT){const l=i.parent;if(l){i.props.attach?gM(l,i):Gf(i.object)&&Gf(l.object)&&l.object.remove(i.object);for(const h of i.children)h.props.attach?gM(i,h):Gf(h.object)&&Gf(i.object)&&i.object.remove(h.object)}i.isHidden&&_V(i),i.object.__r3f&&delete i.object.__r3f,i.type!=="primitive"&&yV(i.object)}for(const[i,l,h]of HT){i.props=l;const g=i.parent;if(g){var n,e;const v=hv[cE(i.type)];i.object=(n=i.props.object)!=null?n:new v(...(e=i.props.args)!=null?e:[]),i.object.__r3f=i,nae(h,i.object),W_(i.object,i.props),i.props.attach?mM(g,i):Gf(i.object)&&Gf(g.object)&&g.object.add(i.object);for(const r of i.children)r.props.attach?mM(i,r):Gf(r.object)&&Gf(i.object)&&i.object.add(r.object);Tv(i)}}HT.length=0}const Y3=()=>{},JN={};let AT=pV;const sae=0,aae=4,TR=$se({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:tae,removeChild:SR,appendChild:Z3,appendInitialChild:Z3,insertBefore:$N,appendChildToContainer(n,e){const i=n.getState().scene.__r3f;!e||!i||Z3(i,e)},removeChildFromContainer(n,e){const i=n.getState().scene.__r3f;!e||!i||SR(i,e)},insertInContainerBefore(n,e,i){const l=n.getState().scene.__r3f;!e||!i||!l||$N(l,e,i)},getRootHostContext:()=>JN,getChildHostContext:()=>JN,commitUpdate(n,e,i,l,h){var g,v,r;gV(e,l);let C=!1;if((n.type==="primitive"&&i.object!==l.object||((g=l.args)==null?void 0:g.length)!==((v=i.args)==null?void 0:v.length)||(r=l.args)!=null&&r.some((z,N)=>{var k;return z!==((k=i.args)==null?void 0:k[N])}))&&(C=!0),C)HT.push([n,{...l},h]);else{const z=jse(n,l);Object.keys(z).length&&(Object.assign(n.props,z),W_(n.object,z))}(h.sibling===null||(h.flags&aae)===sae)&&rae()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:n=>n?.object,prepareForCommit:()=>null,preparePortalMount:n=>pM(n.getState().scene,n,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:iae,unhideInstance:_V,createTextInstance:Y3,hideTextInstance:Y3,unhideTextInstance:Y3,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Ii.createContext(null),setCurrentUpdatePriority(n){AT=n},getCurrentUpdatePriority(){return AT},resolveUpdatePriority(){var n;if(AT!==pV)return AT;switch(typeof window<"u"&&((n=window.event)==null?void 0:n.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return UT.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return UT.ContinuousEventPriority;default:return UT.DefaultEventPriority}},resetFormInstance(){}}),Ey=new Map,Px={objects:"shallow",strict:!1};function oae(n,e){if(!e&&typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:i,height:l,top:h,left:g}=n.parentElement.getBoundingClientRect();return{width:i,height:l,top:h,left:g}}else if(!e&&typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function lae(n){const e=Ey.get(n),i=e?.fiber,l=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const h=typeof reportError=="function"?reportError:console.error,g=l||Kse(AR,eF),v=i||TR.createContainer(g,UT.ConcurrentRoot,null,!1,null,"",h,h,h,null);e||Ey.set(n,{fiber:v,store:g});let r,C,I=!1,z=null;return{async configure(N={}){let k;z=new Promise(Ge=>k=Ge);let{gl:j,size:$,scene:re,events:ie,onCreated:Y,shadows:ae=!1,linear:ue=!1,flat:me=!1,legacy:Ae=!1,orthographic:Se=!1,frameloop:ze="always",dpr:je=[1,2],performance:Ce,raycaster:Te,camera:Ze,onPointerMissed:Mt}=N,mt=g.getState(),Gt=mt.gl;if(!mt.gl){const Ge={canvas:n,powerPreference:"high-performance",antialias:!0,alpha:!0},Et=typeof j=="function"?await j(Ge):j;KN(Et)?Gt=Et:Gt=new tV({...Ge,...j}),mt.set({gl:Gt})}let kt=mt.raycaster;kt||mt.set({raycaster:kt=new Wk});const{params:Re,...Qe}=Te||{};if($o.equ(Qe,kt,Px)||W_(kt,{...Qe}),$o.equ(Re,kt.params,Px)||W_(kt,{params:{...kt.params,...Re}}),!mt.camera||mt.camera===C&&!$o.equ(C,Ze,Px)){C=Ze;const Ge=Ze?.isCamera,Et=Ge?Ze:Se?new wv(0,0,0,0,.1,1e3):new Tc(75,0,.1,1e3);Ge||(Et.position.z=5,Ze&&(W_(Et,Ze),Et.manual||("aspect"in Ze||"left"in Ze||"right"in Ze||"bottom"in Ze||"top"in Ze)&&(Et.manual=!0,Et.updateProjectionMatrix())),!mt.camera&&!(Ze!=null&&Ze.rotation)&&Et.lookAt(0,0,0)),mt.set({camera:Et}),kt.camera=Et}if(!mt.scene){let Ge;re!=null&&re.isScene?(Ge=re,pM(Ge,g,"",{})):(Ge=new Xb,pM(Ge,g,"",{}),re&&W_(Ge,re)),mt.set({scene:Ge})}ie&&!mt.events.handlers&&mt.set({events:ie(g)});const et=oae(n,$);if($o.equ(et,mt.size,Px)||mt.setSize(et.width,et.height,et.top,et.left),je&&mt.viewport.dpr!==lV(je)&&mt.setDpr(je),mt.frameloop!==ze&&mt.setFrameloop(ze),mt.onPointerMissed||mt.set({onPointerMissed:Mt}),Ce&&!$o.equ(Ce,mt.performance,Px)&&mt.set(Ge=>({performance:{...Ge.performance,...Ce}})),!mt.xr){var Lt;const Ge=(ii,ki)=>{const qt=g.getState();qt.frameloop!=="never"&&eF(ii,!0,qt,ki)},Et=()=>{const ii=g.getState();ii.gl.xr.enabled=ii.gl.xr.isPresenting,ii.gl.xr.setAnimationLoop(ii.gl.xr.isPresenting?Ge:null),ii.gl.xr.isPresenting||AR(ii)},Vt={connect(){const ii=g.getState().gl;ii.xr.addEventListener("sessionstart",Et),ii.xr.addEventListener("sessionend",Et)},disconnect(){const ii=g.getState().gl;ii.xr.removeEventListener("sessionstart",Et),ii.xr.removeEventListener("sessionend",Et)}};typeof((Lt=Gt.xr)==null?void 0:Lt.addEventListener)=="function"&&Vt.connect(),mt.set({xr:Vt})}if(Gt.shadowMap){const Ge=Gt.shadowMap.enabled,Et=Gt.shadowMap.type;if(Gt.shadowMap.enabled=!!ae,$o.boo(ae))Gt.shadowMap.type=hb;else if($o.str(ae)){var jt;const Vt={basic:s5,percentage:AM,soft:hb,variance:bm};Gt.shadowMap.type=(jt=Vt[ae])!=null?jt:hb}else $o.obj(ae)&&Object.assign(Gt.shadowMap,ae);(Ge!==Gt.shadowMap.enabled||Et!==Gt.shadowMap.type)&&(Gt.shadowMap.needsUpdate=!0)}return oa.enabled=!Ae,I||(Gt.outputColorSpace=ue?pg:Io,Gt.toneMapping=me?Cm:bI),mt.legacy!==Ae&&mt.set(()=>({legacy:Ae})),mt.linear!==ue&&mt.set(()=>({linear:ue})),mt.flat!==me&&mt.set(()=>({flat:me})),j&&!$o.fun(j)&&!KN(j)&&!$o.equ(j,Gt,Px)&&W_(Gt,j),r=Y,I=!0,k(),this},render(N){return!I&&!z&&this.configure(),z.then(()=>{TR.updateContainer(hi.jsx(cae,{store:g,children:N,onCreated:r,rootElement:n}),v,null,()=>{})}),g},unmount(){xV(n)}}}function cae({store:n,children:e,onCreated:i,rootElement:l}){return xw(()=>{const h=n.getState();h.set(g=>({internal:{...g.internal,active:!0}})),i&&i(h),n.getState().events.connected||h.events.connect==null||h.events.connect(l)},[]),hi.jsx(hV.Provider,{value:n,children:e})}function xV(n,e){const i=Ey.get(n),l=i?.fiber;if(l){const h=i?.store.getState();h&&(h.internal.active=!1),TR.updateContainer(null,l,null,()=>{h&&setTimeout(()=>{try{var g,v,r,C;h.events.disconnect==null||h.events.disconnect(),(g=h.gl)==null||(v=g.renderLists)==null||v.dispose==null||v.dispose(),(r=h.gl)==null||r.forceContextLoss==null||r.forceContextLoss(),(C=h.gl)!=null&&C.xr&&h.xr.disconnect(),Vse(h.scene),Ey.delete(n)}catch{}},500)})}}const uae=new Set,hae=new Set,fae=new Set;function K3(n,e){if(n.size)for(const{callback:i}of n.values())i(e)}function vb(n,e){switch(n){case"before":return K3(uae,e);case"after":return K3(hae,e);case"tail":return K3(fae,e)}}let $3,J3;function MR(n,e,i){let l=e.clock.getDelta();e.frameloop==="never"&&typeof n=="number"&&(l=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),$3=e.internal.subscribers;for(let h=0;h<$3.length;h++)J3=$3[h],J3.ref.current(J3.store.getState(),l,i);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let _M=!1,ER=!1,Q3,QN,zx;function vV(n){QN=requestAnimationFrame(vV),_M=!0,Q3=0,vb("before",n),ER=!0;for(const i of Ey.values()){var e;zx=i.store.getState(),zx.internal.active&&(zx.frameloop==="always"||zx.internal.frames>0)&&!((e=zx.gl.xr)!=null&&e.isPresenting)&&(Q3+=MR(n,zx))}if(ER=!1,vb("after",n),Q3===0)return vb("tail",n),_M=!1,cancelAnimationFrame(QN)}function AR(n,e=1){var i;if(!n)return Ey.forEach(l=>AR(l.store.getState(),e));(i=n.gl.xr)!=null&&i.isPresenting||!n.internal.active||n.frameloop==="never"||(e>1?n.internal.frames=Math.min(60,n.internal.frames+e):ER?n.internal.frames=2:n.internal.frames=1,_M||(_M=!0,requestAnimationFrame(vV)))}function eF(n,e=!0,i,l){if(e&&vb("before",n),i)MR(n,i,l);else for(const h of Ey.values())MR(n,h.store.getState());e&&vb("after",n)}const eC={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function dae(n){const{handlePointer:e}=Yse(n);return{priority:1,enabled:!0,compute(i,l,h){l.pointer.set(i.offsetX/l.size.width*2-1,-(i.offsetY/l.size.height)*2+1),l.raycaster.setFromCamera(l.pointer,l.camera)},connected:void 0,handlers:Object.keys(eC).reduce((i,l)=>({...i,[l]:e(l)}),{}),update:()=>{var i;const{events:l,internal:h}=n.getState();(i=h.lastEvent)!=null&&i.current&&l.handlers&&l.handlers.onPointerMove(h.lastEvent.current)},connect:i=>{const{set:l,events:h}=n.getState();if(h.disconnect==null||h.disconnect(),l(g=>({events:{...g.events,connected:i}})),h.handlers)for(const g in h.handlers){const v=h.handlers[g],[r,C]=eC[g];i.addEventListener(r,v,{passive:C})}},disconnect:()=>{const{set:i,events:l}=n.getState();if(l.connected){if(l.handlers)for(const h in l.handlers){const g=l.handlers[h],[v]=eC[h];l.connected.removeEventListener(v,g)}i(h=>({events:{...h.events,connected:void 0}}))}}}}function tF(n,e){let i;return(...l)=>{window.clearTimeout(i),i=window.setTimeout(()=>n(...l),e)}}function pae({debounce:n,scroll:e,polyfill:i,offsetSize:l}={debounce:0,scroll:!1,offsetSize:!1}){const h=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!h)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[g,v]=Ii.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),r=Ii.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:g,orientationHandler:null}),C=n?typeof n=="number"?n:n.scroll:null,I=n?typeof n=="number"?n:n.resize:null,z=Ii.useRef(!1);Ii.useEffect(()=>(z.current=!0,()=>void(z.current=!1)));const[N,k,j]=Ii.useMemo(()=>{const Y=()=>{if(!r.current.element)return;const{left:ae,top:ue,width:me,height:Ae,bottom:Se,right:ze,x:je,y:Ce}=r.current.element.getBoundingClientRect(),Te={left:ae,top:ue,width:me,height:Ae,bottom:Se,right:ze,x:je,y:Ce};r.current.element instanceof HTMLElement&&l&&(Te.height=r.current.element.offsetHeight,Te.width=r.current.element.offsetWidth),Object.freeze(Te),z.current&&!yae(r.current.lastBounds,Te)&&v(r.current.lastBounds=Te)};return[Y,I?tF(Y,I):Y,C?tF(Y,C):Y]},[v,l,C,I]);function $(){r.current.scrollContainers&&(r.current.scrollContainers.forEach(Y=>Y.removeEventListener("scroll",j,!0)),r.current.scrollContainers=null),r.current.resizeObserver&&(r.current.resizeObserver.disconnect(),r.current.resizeObserver=null),r.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",r.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",r.current.orientationHandler))}function re(){r.current.element&&(r.current.resizeObserver=new h(j),r.current.resizeObserver.observe(r.current.element),e&&r.current.scrollContainers&&r.current.scrollContainers.forEach(Y=>Y.addEventListener("scroll",j,{capture:!0,passive:!0})),r.current.orientationHandler=()=>{j()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",r.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",r.current.orientationHandler))}const ie=Y=>{!Y||Y===r.current.element||($(),r.current.element=Y,r.current.scrollContainers=bV(Y),re())};return gae(j,!!e),mae(k),Ii.useEffect(()=>{$(),re()},[e,j,k]),Ii.useEffect(()=>$,[]),[ie,g,N]}function mae(n){Ii.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function gae(n,e){Ii.useEffect(()=>{if(e){const i=n;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[n,e])}function bV(n){const e=[];if(!n||n===document.body)return e;const{overflow:i,overflowX:l,overflowY:h}=window.getComputedStyle(n);return[i,l,h].some(g=>g==="auto"||g==="scroll")&&e.push(n),[...e,...bV(n.parentElement)]}const _ae=["x","y","top","bottom","left","right","width","height"],yae=(n,e)=>_ae.every(i=>n[i]===e[i]);function xae({ref:n,children:e,fallback:i,resize:l,style:h,gl:g,events:v=dae,eventSource:r,eventPrefix:C,shadows:I,linear:z,flat:N,legacy:k,orthographic:j,frameloop:$,dpr:re,performance:ie,raycaster:Y,camera:ae,scene:ue,onPointerMissed:me,onCreated:Ae,...Se}){Ii.useMemo(()=>mV(fse),[]);const ze=Fse(),[je,Ce]=pae({scroll:!0,debounce:{scroll:50,resize:0},...l}),Te=Ii.useRef(null),Ze=Ii.useRef(null);Ii.useImperativeHandle(n,()=>Te.current);const Mt=oV(me),[mt,Gt]=Ii.useState(!1),[kt,Re]=Ii.useState(!1);if(mt)throw mt;if(kt)throw kt;const Qe=Ii.useRef(null);xw(()=>{const Lt=Te.current;if(Ce.width>0&&Ce.height>0&&Lt){Qe.current||(Qe.current=lae(Lt));async function jt(){await Qe.current.configure({gl:g,scene:ue,events:v,shadows:I,linear:z,flat:N,legacy:k,orthographic:j,frameloop:$,dpr:re,performance:ie,raycaster:Y,camera:ae,size:Ce,onPointerMissed:(...Ge)=>Mt.current==null?void 0:Mt.current(...Ge),onCreated:Ge=>{Ge.events.connect==null||Ge.events.connect(r?Bse(r)?r.current:r:Ze.current),C&&Ge.setEvents({compute:(Et,Vt)=>{const ii=Et[C+"X"],ki=Et[C+"Y"];Vt.pointer.set(ii/Vt.size.width*2-1,-(ki/Vt.size.height)*2+1),Vt.raycaster.setFromCamera(Vt.pointer,Vt.camera)}}),Ae?.(Ge)}}),Qe.current.render(hi.jsx(ze,{children:hi.jsx(kse,{set:Re,children:hi.jsx(Ii.Suspense,{fallback:hi.jsx(Use,{set:Gt}),children:e??null})})}))}jt()}}),Ii.useEffect(()=>{const Lt=Te.current;if(Lt)return()=>xV(Lt)},[]);const et=r?"none":"auto";return hi.jsx("div",{ref:Ze,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:et,...h},...Se,children:hi.jsx("div",{ref:je,style:{width:"100%",height:"100%"},children:hi.jsx("canvas",{ref:Te,style:{display:"block"},children:i})})})}function vae(n){return hi.jsx(nV,{children:hi.jsx(xae,{...n})})}var tC=1/1e3,bae=1e3,wae=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*tC}get fixedDelta(){return this._fixedDelta*tC}set fixedDelta(n){this._fixedDelta=n*bae}get elapsed(){return this._elapsed*tC}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Sae=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),i=new Is;return i.setAttribute("position",new Ba(n,3)),i.setAttribute("uv",new Ba(e,2)),i})(),Lm=class CR{static get fullscreenGeometry(){return Sae}constructor(e="Pass",i=new Xb,l=new wv){this.name=e,this.renderer=null,this.scene=i,this.camera=l,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const i=this.fullscreenMaterial;i!==null&&(i.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let i=this.screen;i!==null?i.material=e:(i=new sc(CR.fullscreenGeometry,e),i.frustumCulled=!1,this.scene===null&&(this.scene=new Xb),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,i=s0){}render(e,i,l,h,g){throw new Error("Render method not implemented!")}setSize(e,i){}initialize(e,i,l){}dispose(){for(const e of Object.keys(this)){const i=this[e];(i instanceof vh||i instanceof tu||i instanceof Ho||i instanceof CR)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Tae=class extends Lm{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,i,l,h){const g=n.state.buffers.stencil;g.setLocked(!1),g.setTest(!1)}},Mae=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,Eae="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Aae=class extends bh{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new Oa(null),depthBuffer:new Oa(null),channelWeights:new Oa(null),opacity:new Oa(1)},blending:kd,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Mae,vertexShader:Eae}),this.depthFunc=Ob}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(n){const e=n!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){const e=n!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(n){n!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=n):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Cae=class extends Lm{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Aae,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new vh(1,1,{minFilter:Do,magFilter:Do,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,i,l,h){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==xh?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Io&&(this.renderTarget.texture.colorSpace=Io))}},iF=new ar,wV=class extends Lm{constructor(n=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,i){this.color=n,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,i,l,h){const g=this.overrideClearColor,v=this.overrideClearAlpha,r=n.getClearAlpha(),C=g!==null,I=v>=0;C?(n.getClearColor(iF),n.setClearColor(g,I?v:r)):I&&n.setClearAlpha(v),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),C?n.setClearColor(iF,r):I&&n.setClearAlpha(r)}},Rae=class extends Lm{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new wV(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,i,l,h){const g=n.getContext(),v=n.state.buffers,r=this.scene,C=this.camera,I=this.clearPass,z=this.inverted?0:1,N=1-z;v.color.setMask(!1),v.depth.setMask(!1),v.color.setLocked(!0),v.depth.setLocked(!0),v.stencil.setTest(!0),v.stencil.setOp(g.REPLACE,g.REPLACE,g.REPLACE),v.stencil.setFunc(g.ALWAYS,z,4294967295),v.stencil.setClear(N),v.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?I.render(n,null):(I.render(n,e),I.render(n,i))),this.renderToScreen?(n.setRenderTarget(null),n.render(r,C)):(n.setRenderTarget(e),n.render(r,C),n.setRenderTarget(i),n.render(r,C)),v.color.setLocked(!1),v.depth.setLocked(!1),v.stencil.setLocked(!1),v.stencil.setFunc(g.EQUAL,1,4294967295),v.stencil.setOp(g.KEEP,g.KEEP,g.KEEP),v.stencil.setLocked(!0)}},Iae=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:l=0,frameBufferType:h}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,i,h,l),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Cae,this.depthTexture=null,this.passes=[],this.timer=new wae,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,i=this.multisampling;i>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new $i),i=n.getContext().getContextAttributes().alpha,l=this.inputBuffer.texture.type;l===xh&&n.outputColorSpace===Io&&(this.inputBuffer.texture.colorSpace=Io,this.outputBuffer.texture.colorSpace=Io,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const h of this.passes)h.initialize(n,i,l)}}replaceRenderer(n,e=!0){const i=this.renderer,l=i.domElement.parentNode;return this.setRenderer(n),e&&l!==null&&(l.removeChild(i.domElement),l.appendChild(n.domElement)),i}createDepthTexture(){const n=this.depthTexture=new XM;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Sy,n.type=wy):n.type=dg,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,i,l){const h=this.renderer,g=h===null?new $i:h.getDrawingBufferSize(new $i),v={minFilter:Do,magFilter:Do,stencilBuffer:e,depthBuffer:n,type:i},r=new vh(g.width,g.height,v);return l>0&&(r.samples=l),i===xh&&h!==null&&h.outputColorSpace===Io&&(r.texture.colorSpace=Io),r.texture.name="EffectComposer.Buffer",r.texture.generateMipmaps=!1,r}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const i=this.passes,l=this.renderer,h=l.getDrawingBufferSize(new $i),g=l.getContext().getContextAttributes().alpha,v=this.inputBuffer.texture.type;if(n.setRenderer(l),n.setSize(h.width,h.height),n.initialize(l,g,v),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,n):i.push(n),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const r=this.createDepthTexture();for(n of i)n.setDepthTexture(r)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,i=e.indexOf(n);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){const g=(r,C)=>r||C.needsDepthTexture;e.reduce(g,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,i=this.copyPass;let l=this.inputBuffer,h=this.outputBuffer,g=!1,v,r,C;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const I of this.passes)I.enabled&&(I.render(e,l,h,n,g),I.needsSwap&&(g&&(i.renderToScreen=I.renderToScreen,v=e.getContext(),r=e.state.buffers.stencil,r.setFunc(v.NOTEQUAL,1,4294967295),i.render(e,l,h,n,g),r.setFunc(v.EQUAL,1,4294967295)),C=l,l=h,h=C),I instanceof Rae?g=!0:I instanceof Tae&&(g=!1))}setSize(n,e,i){const l=this.renderer,h=l.getSize(new $i);(n===void 0||e===void 0)&&(n=h.width,e=h.height),(h.width!==n||h.height!==e)&&l.setSize(n,e,i);const g=l.getDrawingBufferSize(new $i);this.inputBuffer.setSize(g.width,g.height),this.outputBuffer.setSize(g.width,g.height);for(const v of this.passes)v.setSize(g.width,g.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Lm.fullscreenGeometry.dispose()}},gy={NONE:0,DEPTH:1,CONVOLUTION:2},Ta={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Dae=class{constructor(){this.shaderParts=new Map([[Ta.FRAGMENT_HEAD,null],[Ta.FRAGMENT_MAIN_UV,null],[Ta.FRAGMENT_MAIN_IMAGE,null],[Ta.VERTEX_HEAD,null],[Ta.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=gy.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=pg}},iC=!1,nF=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case jf:i=this.materialsFlatShadedDoubleSide;break;case Mc:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case jf:i=this.materialsDoubleSide;break;case Mc:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof bh))return n.clone();const e=n.uniforms,i=new Map;for(const h in e){const g=e[h].value;g.isRenderTargetTexture&&(e[h].value=null,i.set(h,g))}const l=n.clone();for(const h of i)e[h[0]].value=h[1],l.uniforms[h[0]].value=h[1];return l}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const i of e)i.uniforms=Object.assign({},n.uniforms),i.side=fg;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{const l=this.cloneMaterial(i);return l.uniforms=Object.assign({},n.uniforms),l.side=Mc,l}),this.materialsDoubleSide=e.map(i=>{const l=this.cloneMaterial(i);return l.uniforms=Object.assign({},n.uniforms),l.side=jf,l}),this.materialsFlatShaded=e.map(i=>{const l=this.cloneMaterial(i);return l.uniforms=Object.assign({},n.uniforms),l.flatShading=!0,l}),this.materialsFlatShadedBackSide=e.map(i=>{const l=this.cloneMaterial(i);return l.uniforms=Object.assign({},n.uniforms),l.flatShading=!0,l.side=Mc,l}),this.materialsFlatShadedDoubleSide=e.map(i=>{const l=this.cloneMaterial(i);return l.uniforms=Object.assign({},n.uniforms),l.flatShading=!0,l.side=jf,l})}}render(n,e,i){const l=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,iC){const h=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,i);for(const g of h)g[0].material=g[1];this.meshCount!==h.size&&h.clear()}else{const h=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,i),e.overrideMaterial=h}n.shadowMap.enabled=l}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return iC}static set workaroundEnabled(n){iC=n}},V_=-1,Zx=class extends jd{constructor(n,e=V_,i=V_,l=1){super(),this.resizable=n,this.baseSize=new $i(1,1),this.preferredSize=new $i(e,i),this.target=this.preferredSize,this.s=l,this.effectiveSize=new $i,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,i=this.effectiveSize,l=this.scale;e.width!==V_?i.width=e.width:e.height!==V_?i.width=Math.round(e.height*(n.width/Math.max(n.height,1))):i.width=Math.round(n.width*l),e.height!==V_?i.height=e.height:e.width!==V_?i.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):i.height=Math.round(n.height*l)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(V_),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return V_}},pa={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Lae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",Pae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",zae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",Oae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",Bae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Nae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",Fae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",Uae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",kae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",Vae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Gae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",Hae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",jae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",qae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",Xae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",Wae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",Zae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",Yae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",Kae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",$ae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",Jae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",Qae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",eoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",toe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",ioe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",noe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",roe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",soe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",aoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",ooe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",loe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",coe=new Map([[pa.ADD,Lae],[pa.AVERAGE,Pae],[pa.COLOR,zae],[pa.COLOR_BURN,Oae],[pa.COLOR_DODGE,Bae],[pa.DARKEN,Nae],[pa.DIFFERENCE,Fae],[pa.DIVIDE,Uae],[pa.DST,null],[pa.EXCLUSION,kae],[pa.HARD_LIGHT,Vae],[pa.HARD_MIX,Gae],[pa.HUE,Hae],[pa.INVERT,jae],[pa.INVERT_RGB,qae],[pa.LIGHTEN,Xae],[pa.LINEAR_BURN,Wae],[pa.LINEAR_DODGE,Zae],[pa.LINEAR_LIGHT,Yae],[pa.LUMINOSITY,Kae],[pa.MULTIPLY,$ae],[pa.NEGATION,Jae],[pa.NORMAL,Qae],[pa.OVERLAY,eoe],[pa.PIN_LIGHT,toe],[pa.REFLECT,ioe],[pa.SATURATION,noe],[pa.SCREEN,roe],[pa.SOFT_LIGHT,soe],[pa.SRC,aoe],[pa.SUBTRACT,ooe],[pa.VIVID_LIGHT,loe]]),uoe=class extends jd{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Oa(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return coe.get(this.blendFunction)}},RR=class extends jd{constructor(n,e,{attributes:i=gy.NONE,blendFunction:l=pa.NORMAL,defines:h=new Map,uniforms:g=new Map,extensions:v=null,vertexShader:r=null}={}){super(),this.name=n,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=r,this.defines=h,this.uniforms=g,this.extensions=v,this.blendMode=new uoe(l),this.blendMode.addEventListener("change",C=>this.setChanged()),this._inputColorSpace=pg,this._outputColorSpace=Mm}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=s0){}update(n,e,i){}setSize(n,e){}initialize(n,e,i){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof vh||e instanceof tu||e instanceof Ho||e instanceof Lm)&&this[n].dispose()}}},SV=class extends Lm{constructor(n,e,i=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new wV,this.overrideMaterialManager=i===null?null:new nF(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new nF(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,i,l,h){const g=this.scene,v=this.camera,r=this.selection,C=v.layers.mask,I=g.background,z=n.shadowMap.autoUpdate,N=this.renderToScreen?null:e;r!==null&&v.layers.set(r.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(g.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(N),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,g,v):n.render(g,v),v.layers.mask=C,g.background=I,n.shadowMap.autoUpdate=z}},hoe=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,foe="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",doe=class extends bh{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Oa(null),normalBuffer:new Oa(null),texelSize:new Oa(new $i)},blending:kd,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hoe,vertexShader:foe})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=s0){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},poe=class extends Lm{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:i=Zx.AUTO_SIZE,height:l=Zx.AUTO_SIZE,resolutionX:h=i,resolutionY:g=l}={}){super("DepthDownsamplingPass");const v=new doe;v.normalBuffer=n,this.fullscreenMaterial=v,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new vh(1,1,{minFilter:Fl,magFilter:Fl,depthBuffer:!1,type:$h}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const r=this.resolution=new Zx(this,h,g,e);r.addEventListener("change",C=>this.setSize(r.baseWidth,r.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=s0){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,i,l,h){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){const l=n.getContext();if(!(l.getExtension("EXT_color_buffer_float")||l.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},moe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,goe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",_oe=class extends bh{constructor(n,e,i,l,h=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:cw.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Oa(null),depthBuffer:new Oa(null),resolution:new Oa(new $i),texelSize:new Oa(new $i),cameraNear:new Oa(.3),cameraFar:new Oa(1e3),aspect:new Oa(1),time:new Oa(0)},blending:kd,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:h}),n&&this.setShaderParts(n),e&&this.setDefines(e),i&&this.setUniforms(i),this.copyCameraSettings(l)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=s0){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=moe.replace(Ta.FRAGMENT_HEAD,n.get(Ta.FRAGMENT_HEAD)||"").replace(Ta.FRAGMENT_MAIN_UV,n.get(Ta.FRAGMENT_MAIN_UV)||"").replace(Ta.FRAGMENT_MAIN_IMAGE,n.get(Ta.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=goe.replace(Ta.VERTEX_HEAD,n.get(Ta.VERTEX_HEAD)||"").replace(Ta.VERTEX_MAIN_SUPPORT,n.get(Ta.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Tc?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms;i.resolution.value.set(n,e),i.texelSize.value.set(1/n,1/e),i.aspect.value=n/e}static get Section(){return Ta}};function rF(n,e,i){for(const l of e){const h="$1"+n+l.charAt(0).toUpperCase()+l.slice(1),g=new RegExp("([^\\.])(\\b"+l+"\\b)","g");for(const v of i.entries())v[1]!==null&&i.set(v[0],v[1].replace(g,h))}}function yoe(n,e,i){let l=e.getFragmentShader(),h=e.getVertexShader();const g=l!==void 0&&/mainImage/.test(l),v=l!==void 0&&/mainUv/.test(l);if(i.attributes|=e.getAttributes(),l===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(v&&(i.attributes&gy.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!g&&!v)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const r=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,C=i.shaderParts;let I=C.get(Ta.FRAGMENT_HEAD)||"",z=C.get(Ta.FRAGMENT_MAIN_UV)||"",N=C.get(Ta.FRAGMENT_MAIN_IMAGE)||"",k=C.get(Ta.VERTEX_HEAD)||"",j=C.get(Ta.VERTEX_MAIN_SUPPORT)||"";const $=new Set,re=new Set;if(v&&(z+=`	${n}MainUv(UV);
`,i.uvTransformation=!0),h!==null&&/mainSupport/.test(h)){const ae=/mainSupport *\([\w\s]*?uv\s*?\)/.test(h);j+=`	${n}MainSupport(`,j+=ae?`vUv);
`:`);
`;for(const ue of h.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const me of ue[1].split(/\s*,\s*/))i.varyings.add(me),$.add(me),re.add(me);for(const ue of h.matchAll(r))re.add(ue[1])}for(const ae of l.matchAll(r))re.add(ae[1]);for(const ae of e.defines.keys())re.add(ae.replace(/\([\w\s,]*\)/g,""));for(const ae of e.uniforms.keys())re.add(ae);re.delete("while"),re.delete("for"),re.delete("if"),e.uniforms.forEach((ae,ue)=>i.uniforms.set(n+ue.charAt(0).toUpperCase()+ue.slice(1),ae)),e.defines.forEach((ae,ue)=>i.defines.set(n+ue.charAt(0).toUpperCase()+ue.slice(1),ae));const ie=new Map([["fragment",l],["vertex",h]]);rF(n,re,i.defines),rF(n,re,ie),l=ie.get("fragment"),h=ie.get("vertex");const Y=e.blendMode;if(i.blendModes.set(Y.blendFunction,Y),g){e.inputColorSpace!==null&&e.inputColorSpace!==i.colorSpace&&(N+=e.inputColorSpace===Io?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Mm?i.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(i.colorSpace=e.inputColorSpace);const ae=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;N+=`${n}MainImage(color0, UV, `,(i.attributes&gy.DEPTH)!==0&&ae.test(l)&&(N+="depth, ",i.readDepth=!0),N+=`color1);
	`;const ue=n+"BlendOpacity";i.uniforms.set(ue,Y.opacity),N+=`color0 = blend${Y.blendFunction}(color0, color1, ${ue});

	`,I+=`uniform float ${ue};

`}if(I+=l+`
`,h!==null&&(k+=h+`
`),C.set(Ta.FRAGMENT_HEAD,I),C.set(Ta.FRAGMENT_MAIN_UV,z),C.set(Ta.FRAGMENT_MAIN_IMAGE,N),C.set(Ta.VERTEX_HEAD,k),C.set(Ta.VERTEX_MAIN_SUPPORT,j),e.extensions!==null)for(const ae of e.extensions)i.extensions.add(ae)}}var xoe=class extends Lm{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new _oe(null,null,null,n),this.listener=i=>this.handleEvent(i),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,i)=>i.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Dae;let e=0;for(const v of this.effects)if(v.blendMode.blendFunction===pa.DST)n.attributes|=v.getAttributes()&gy.DEPTH;else{if((n.attributes&v.getAttributes()&gy.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${v.name})`);yoe("e"+e++,v,n)}let i=n.shaderParts.get(Ta.FRAGMENT_HEAD),l=n.shaderParts.get(Ta.FRAGMENT_MAIN_IMAGE),h=n.shaderParts.get(Ta.FRAGMENT_MAIN_UV);const g=/\bblend\b/g;for(const v of n.blendModes.values())i+=v.getShaderCode().replace(g,`blend${v.blendFunction}`)+`
`;(n.attributes&gy.DEPTH)!==0?(n.readDepth&&(l=`float depth = readDepth(UV);

	`+l),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Io&&(l+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(h=`vec2 transformedUv = vUv;
`+h,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(Ta.FRAGMENT_HEAD,i),n.shaderParts.set(Ta.FRAGMENT_MAIN_IMAGE,l),n.shaderParts.set(Ta.FRAGMENT_MAIN_UV,h);for(const[v,r]of n.shaderParts)r!==null&&n.shaderParts.set(v,r.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=s0){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const i of this.effects)i.setDepthTexture(n,e)}render(n,e,i,l,h){for(const g of this.effects)g.update(n,e,l);if(!this.skipRendering||this.renderToScreen){const g=this.fullscreenMaterial;g.inputBuffer=e.texture,g.time+=l*this.timeScale,n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const i of this.effects)i.setSize(n,e)}initialize(n,e,i){this.renderer=n;for(const l of this.effects)l.initialize(n,e,i);this.updateMaterial(),i!==void 0&&i!==xh&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},voe=class extends Lm{constructor(n,e,{renderTarget:i,resolutionScale:l=1,width:h=Zx.AUTO_SIZE,height:g=Zx.AUTO_SIZE,resolutionX:v=h,resolutionY:r=g}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new SV(n,e,new XI);const C=this.renderPass;C.ignoreBackground=!0,C.skipShadowMapUpdate=!0;const I=C.getClearPass();I.overrideClearColor=new ar(7829503),I.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new vh(1,1,{minFilter:Fl,magFilter:Fl}),this.renderTarget.texture.name="NormalPass.Target");const z=this.resolution=new Zx(this,v,r,l);z.addEventListener("change",N=>this.setSize(z.baseWidth,z.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,l,h){const g=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,g,g)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}};function bb(n,e,i){return e in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}new $i;new $i;function TV(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Mp=function n(e,i,l){var h=this;TV(this,n),bb(this,"dot2",function(g,v){return h.x*g+h.y*v}),bb(this,"dot3",function(g,v,r){return h.x*g+h.y*v+h.z*r}),this.x=e,this.y=i,this.z=l},boe=[new Mp(1,1,0),new Mp(-1,1,0),new Mp(1,-1,0),new Mp(-1,-1,0),new Mp(1,0,1),new Mp(-1,0,1),new Mp(1,0,-1),new Mp(-1,0,-1),new Mp(0,1,1),new Mp(0,-1,1),new Mp(0,1,-1),new Mp(0,-1,-1)],sF=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],aF=new Array(512),oF=new Array(512),woe=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var i=0;i<256;i++){var l;i&1?l=sF[i]^e&255:l=sF[i]^e>>8&255,aF[i]=aF[i+256]=l,oF[i]=oF[i+256]=boe[l%12]}};woe(0);function Soe(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var i=0;i<e.length;i++)n=(n+(i+1)*(e.charCodeAt(i)%96))%2147483647}return n===0&&(n=311),n}function lF(n){var e=Soe(n);return function(){var i=e*48271%2147483647;return e=i,i/2147483647}}var Toe=function n(e){var i=this;TV(this,n),bb(this,"seed",0),bb(this,"init",function(l){i.seed=l,i.value=lF(l)}),bb(this,"value",lF(this.seed)),this.init(e)};new Toe(Math.random());const Moe=Ii.createContext(null),cF=n=>(n.getAttributes()&2)===2,Eoe=Ii.memo(Ii.forwardRef(({children:n,camera:e,scene:i,resolutionScale:l,enabled:h=!0,renderPriority:g=1,autoClear:v=!0,depthBuffer:r,enableNormalPass:C,stencilBuffer:I,multisampling:z=8,frameBufferType:N=r0},k)=>{const{gl:j,scene:$,camera:re,size:ie}=oD(),Y=i||$,ae=e||re,[ue,me,Ae]=Ii.useMemo(()=>{const je=new Iae(j,{depthBuffer:r,stencilBuffer:I,multisampling:z,frameBufferType:N});je.addPass(new SV(Y,ae));let Ce=null,Te=null;return C&&(Te=new voe(Y,ae),Te.enabled=!1,je.addPass(Te),l!==void 0&&(Ce=new poe({normalBuffer:Te.texture,resolutionScale:l}),Ce.enabled=!1,je.addPass(Ce))),[je,Te,Ce]},[ae,j,r,I,z,N,Y,C,l]);Ii.useEffect(()=>ue?.setSize(ie.width,ie.height),[ue,ie]),dV((je,Ce)=>{if(h){const Te=j.autoClear;j.autoClear=v,I&&!v&&j.clearStencil(),ue.render(Ce),j.autoClear=Te}},h?g:0);const Se=Ii.useRef(null);Ii.useLayoutEffect(()=>{const je=[],Ce=Se.current.__r3f;if(Ce&&ue){const Te=Ce.children;for(let Ze=0;Ze<Te.length;Ze++){const Mt=Te[Ze].object;if(Mt instanceof RR){const mt=[Mt];if(!cF(Mt)){let kt=null;for(;(kt=Te[Ze+1]?.object)instanceof RR&&!cF(kt);)mt.push(kt),Ze++}const Gt=new xoe(ae,...mt);je.push(Gt)}else Mt instanceof Lm&&je.push(Mt)}for(const Ze of je)ue?.addPass(Ze);me&&(me.enabled=!0),Ae&&(Ae.enabled=!0)}return()=>{for(const Te of je)ue?.removePass(Te);me&&(me.enabled=!1),Ae&&(Ae.enabled=!1)}},[ue,n,ae,me,Ae]),Ii.useEffect(()=>{const je=j.toneMapping;return j.toneMapping=Cm,()=>{j.toneMapping=je}},[j]);const ze=Ii.useMemo(()=>({composer:ue,normalPass:me,downSamplingPass:Ae,resolutionScale:l,camera:ae,scene:Y}),[ue,me,Ae,l,ae,Y]);return Ii.useImperativeHandle(k,()=>ue,[ue]),hi.jsx(Moe.Provider,{value:ze,children:hi.jsx("group",{ref:Se,children:n})})}));let Aoe=0;const uF=new WeakMap,Coe=(n,e)=>function({blendFunction:i=e?.blendFunction,opacity:l=e?.opacity,...h}){let g=uF.get(n);if(!g){const C=`@react-three/postprocessing/${n.name}-${Aoe++}`;mV({[C]:n}),uF.set(n,g=C)}const v=oD(C=>C.camera),r=mF.useMemo(()=>[...e?.args??[],...h.args??[{...e,...h}]],[JSON.stringify(h)]);return hi.jsx(g,{camera:v,"blendMode-blendFunction":i,"blendMode-opacity-value":l,...h,args:r})};function MV(n){var e,i,l="";if(typeof n=="string"||typeof n=="number")l+=n;else if(typeof n=="object")if(Array.isArray(n)){var h=n.length;for(e=0;e<h;e++)n[e]&&(i=MV(n[e]))&&(l&&(l+=" "),l+=i)}else for(i in n)n[i]&&(l&&(l+=" "),l+=i);return l}function Roe(){for(var n,e,i=0,l="",h=arguments.length;i<h;i++)(n=arguments[i])&&(e=MV(n))&&(l&&(l+=" "),l+=e);return l}const Ioe=`
precision highp float;
varying vec2 vUv;
void main() {
  vUv = uv;
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  gl_Position = projectionMatrix * viewPosition;
}
`,Doe=`
precision highp float;
uniform vec2 resolution;
uniform float time;
uniform float waveSpeed;
uniform float waveFrequency;
uniform float waveAmplitude;
uniform vec3 waveColor;
uniform vec2 mousePos;
uniform int enableMouseInteraction;
uniform float mouseRadius;

vec4 mod289(vec4 x) { return x - floor(x * (1.0/289.0)) * 289.0; }
vec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }
vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
vec2 fade(vec2 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }

float cnoise(vec2 P) {
  vec4 Pi = floor(P.xyxy) + vec4(0.0,0.0,1.0,1.0);
  vec4 Pf = fract(P.xyxy) - vec4(0.0,0.0,1.0,1.0);
  Pi = mod289(Pi);
  vec4 ix = Pi.xzxz;
  vec4 iy = Pi.yyww;
  vec4 fx = Pf.xzxz;
  vec4 fy = Pf.yyww;
  vec4 i = permute(permute(ix) + iy);
  vec4 gx = fract(i * (1.0/41.0)) * 2.0 - 1.0;
  vec4 gy = abs(gx) - 0.5;
  vec4 tx = floor(gx + 0.5);
  gx = gx - tx;
  vec2 g00 = vec2(gx.x, gy.x);
  vec2 g10 = vec2(gx.y, gy.y);
  vec2 g01 = vec2(gx.z, gy.z);
  vec2 g11 = vec2(gx.w, gy.w);
  vec4 norm = taylorInvSqrt(vec4(dot(g00,g00), dot(g01,g01), dot(g10,g10), dot(g11,g11)));
  g00 *= norm.x; g01 *= norm.y; g10 *= norm.z; g11 *= norm.w;
  float n00 = dot(g00, vec2(fx.x, fy.x));
  float n10 = dot(g10, vec2(fx.y, fy.y));
  float n01 = dot(g01, vec2(fx.z, fy.z));
  float n11 = dot(g11, vec2(fx.w, fy.w));
  vec2 fade_xy = fade(Pf.xy);
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);
  return 2.3 * mix(n_x.x, n_x.y, fade_xy.y);
}

const int OCTAVES = 4;
float fbm(vec2 p) {
  float value = 0.0;
  float amp = 1.0;
  float freq = waveFrequency;
  for (int i = 0; i < OCTAVES; i++) {
    value += amp * abs(cnoise(p));
    p *= freq;
    amp *= waveAmplitude;
  }
  return value;
}

float pattern(vec2 p) {
  vec2 p2 = p - time * waveSpeed;
  return fbm(p + fbm(p2)); 
}

void main() {
  vec2 uv = gl_FragCoord.xy / resolution.xy;
  uv -= 0.5;
  uv.x *= resolution.x / resolution.y;
  float f = pattern(uv);
  if (enableMouseInteraction == 1) {
    vec2 mouseNDC = (mousePos / resolution - 0.5) * vec2(1.0, -1.0);
    mouseNDC.x *= resolution.x / resolution.y;
    float dist = length(uv - mouseNDC);
    float effect = 1.0 - smoothstep(0.0, mouseRadius, dist);
    f -= 0.5 * effect;
  }
  vec3 col = mix(vec3(0.0), waveColor, f);
  gl_FragColor = vec4(col, 1.0);
}
`,Loe=`
precision highp float;
uniform float colorNum;
uniform float pixelSize;
const float bayerMatrix8x8[64] = float[64](
  0.0/64.0, 48.0/64.0, 12.0/64.0, 60.0/64.0,  3.0/64.0, 51.0/64.0, 15.0/64.0, 63.0/64.0,
  32.0/64.0,16.0/64.0, 44.0/64.0, 28.0/64.0, 35.0/64.0,19.0/64.0, 47.0/64.0, 31.0/64.0,
  8.0/64.0, 56.0/64.0,  4.0/64.0, 52.0/64.0, 11.0/64.0,59.0/64.0,  7.0/64.0, 55.0/64.0,
  40.0/64.0,24.0/64.0, 36.0/64.0, 20.0/64.0, 43.0/64.0,27.0/64.0, 39.0/64.0, 23.0/64.0,
  2.0/64.0, 50.0/64.0, 14.0/64.0, 62.0/64.0,  1.0/64.0,49.0/64.0, 13.0/64.0, 61.0/64.0,
  34.0/64.0,18.0/64.0, 46.0/64.0, 30.0/64.0, 33.0/64.0,17.0/64.0, 45.0/64.0, 29.0/64.0,
  10.0/64.0,58.0/64.0,  6.0/64.0, 54.0/64.0,  9.0/64.0,57.0/64.0,  5.0/64.0, 53.0/64.0,
  42.0/64.0,26.0/64.0, 38.0/64.0, 22.0/64.0, 41.0/64.0,25.0/64.0, 37.0/64.0, 21.0/64.0
);

vec3 dither(vec2 uv, vec3 color) {
  vec2 scaledCoord = floor(uv * resolution / pixelSize);
  int x = int(mod(scaledCoord.x, 8.0));
  int y = int(mod(scaledCoord.y, 8.0));
  float threshold = bayerMatrix8x8[y * 8 + x] - 0.25;
  float step = 1.0 / (colorNum - 1.0);
  color += threshold * step;
  float bias = 0.2;
  color = clamp(color - bias, 0.0, 1.0);
  return floor(color * (colorNum - 1.0) + 0.5) / (colorNum - 1.0);
}

void mainImage(in vec4 inputColor, in vec2 uv, out vec4 outputColor) {
  vec2 normalizedPixelSize = pixelSize / resolution;
  vec2 uvPixel = normalizedPixelSize * floor(uv / normalizedPixelSize);
  vec4 color = texture2D(inputBuffer, uvPixel);
  color.rgb = dither(uv, color.rgb);
  outputColor = color;
}
`;class Poe extends RR{constructor(){const e=new Map([["colorNum",new Oa(4)],["pixelSize",new Oa(2)]]);super("RetroEffect",Loe,{uniforms:e}),this.uniforms=e}set colorNum(e){this.uniforms.get("colorNum").value=e}get colorNum(){return this.uniforms.get("colorNum").value}set pixelSize(e){this.uniforms.get("pixelSize").value=e}get pixelSize(){return this.uniforms.get("pixelSize").value}}const zoe=Coe(Poe),EV=Ii.forwardRef((n,e)=>{const{colorNum:i,pixelSize:l}=n;return hi.jsx(zoe,{ref:e,colorNum:i,pixelSize:l})});EV.displayName="RetroEffect";function Ooe({waveSpeed:n,waveFrequency:e,waveAmplitude:i,waveColor:l,colorNum:h,pixelSize:g,disableAnimation:v,enableMouseInteraction:r,mouseRadius:C}){const I=Ii.useRef(null),z=Ii.useRef(new $i),{viewport:N,size:k,gl:j}=oD(),$=Ii.useRef({time:new Oa(0),resolution:new Oa(new $i(0,0)),waveSpeed:new Oa(n),waveFrequency:new Oa(e),waveAmplitude:new Oa(i),waveColor:new Oa(new ar(...l)),mousePos:new Oa(new $i(0,0)),enableMouseInteraction:new Oa(r?1:0),mouseRadius:new Oa(C)});Ii.useEffect(()=>{const Y=j.getPixelRatio(),ae=Math.floor(k.width*Y),ue=Math.floor(k.height*Y),me=$.current.resolution.value;(me.x!==ae||me.y!==ue)&&me.set(ae,ue)},[k,j]);const re=Ii.useRef([...l]);dV(({clock:Y})=>{const ae=$.current;v||(ae.time.value=Y.getElapsedTime()),ae.waveSpeed.value!==n&&(ae.waveSpeed.value=n),ae.waveFrequency.value!==e&&(ae.waveFrequency.value=e),ae.waveAmplitude.value!==i&&(ae.waveAmplitude.value=i),re.current.every((ue,me)=>ue===l[me])||(ae.waveColor.value.set(...l),re.current=[...l]),ae.enableMouseInteraction.value=r?1:0,ae.mouseRadius.value=C,r&&ae.mousePos.value.copy(z.current)});const ie=Y=>{if(!r)return;const ae=j.domElement.getBoundingClientRect(),ue=j.getPixelRatio();z.current.set((Y.clientX-ae.left)*ue,(Y.clientY-ae.top)*ue)};return hi.jsxs(hi.Fragment,{children:[hi.jsxs("mesh",{ref:I,scale:[N.width,N.height,1],children:[hi.jsx("planeGeometry",{args:[1,1]}),hi.jsx("shaderMaterial",{vertexShader:Ioe,fragmentShader:Doe,uniforms:$.current})]}),hi.jsx(Eoe,{children:hi.jsx(EV,{colorNum:h,pixelSize:g})}),hi.jsxs("mesh",{onPointerMove:ie,position:[0,0,.01],scale:[N.width,N.height,1],visible:!1,children:[hi.jsx("planeGeometry",{args:[1,1]}),hi.jsx("meshBasicMaterial",{transparent:!0,opacity:0})]})]})}function cD({waveSpeed:n=.05,waveFrequency:e=3,waveAmplitude:i=.3,waveColor:l=[.5,.5,.5],colorNum:h=4,pixelSize:g=2,disableAnimation:v=!1,enableMouseInteraction:r=!0,mouseRadius:C=1,className:I=""}){const z=Roe("dither-container",r?"dither-container--interactive":"dither-container--static",I);return hi.jsx(vae,{className:z,camera:{position:[0,0,6]},dpr:1,gl:{antialias:!0,preserveDrawingBuffer:!0},children:hi.jsx(Ooe,{waveSpeed:n,waveFrequency:e,waveAmplitude:i,waveColor:l,colorNum:h,pixelSize:g,disableAnimation:v,enableMouseInteraction:r,mouseRadius:C})})}const hF="/dsc-106-final-proj/";function AV(){return hi.jsx("header",{className:"fixed top-6 left-1/2 z-50 -translate-x-1/2 w-full max-w-2xl px-4",children:hi.jsxs("nav",{className:"flex items-center justify-between gap-8 rounded-full border border-white/10 bg-glass px-8 py-4 shadow-[0_0_30px_rgba(0,255,128,0.15)] backdrop-blur-xl",children:[hi.jsxs("a",{href:`${hF}`,className:"flex items-center gap-2 transition hover:text-neon hover:drop-shadow-[0_0_8px_rgba(0,255,128,0.6)] font-medium","aria-label":"GridCast Home",children:[hi.jsx("span",{className:"text-2xl drop-shadow-[0_0_8px_rgba(0,255,128,0.4)]",role:"img","aria-label":"Lightning",children:""}),hi.jsx("span",{className:"text-xl font-bold tracking-tight text-white",children:"GridCast"})]}),hi.jsxs("ul",{className:"flex items-center gap-6 text-sm text-white/70",children:[hi.jsx("li",{children:hi.jsx("a",{href:`${hF}dashboard`,className:"transition hover:text-neon hover:drop-shadow-[0_0_8px_rgba(0,255,128,0.6)] font-medium",children:"Dashboard"})}),hi.jsx("li",{children:hi.jsx("a",{href:"#datacenters",className:"transition hover:text-neon hover:drop-shadow-[0_0_8px_rgba(0,255,128,0.6)] font-medium",children:"More Info"})})]})]})})}var jT={exports:{}},Boe=jT.exports,fF;function Noe(){return fF||(fF=1,(function(n,e){(function(i,l){n.exports=l()})(Boe,(function(){var i,l,h;function g(r,C){if(!i)i=C;else if(!l)l=C;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",z={};i(z),h=C(z),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}g(["exports"],(function(r){var C=1e-6,I=typeof Float32Array<"u"?Float32Array:Array;function z(o,t){var a=t[0],u=t[1],d=t[2],_=t[3],x=a*_-d*u;return x?(o[0]=_*(x=1/x),o[1]=-u*x,o[2]=-d*x,o[3]=a*x,o):null}function N(){var o=new I(9);return I!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function k(o,t){var a=t[0],u=t[1],d=t[2],_=t[3],x=t[4],S=t[5],R=t[6],L=t[7],F=t[8];return o[0]=x*F-S*L,o[1]=d*L-u*F,o[2]=u*S-d*x,o[3]=S*R-_*F,o[4]=a*F-d*R,o[5]=d*_-a*S,o[6]=_*L-x*R,o[7]=u*R-a*L,o[8]=a*x-u*_,o}function j(o,t,a){var u=t[0],d=t[1],_=t[2],x=t[3],S=t[4],R=t[5],L=t[6],F=t[7],U=t[8],G=a[0],X=a[1],Z=a[2],ne=a[3],he=a[4],ce=a[5],_e=a[6],xe=a[7],Ee=a[8];return o[0]=G*u+X*x+Z*L,o[1]=G*d+X*S+Z*F,o[2]=G*_+X*R+Z*U,o[3]=ne*u+he*x+ce*L,o[4]=ne*d+he*S+ce*F,o[5]=ne*_+he*R+ce*U,o[6]=_e*u+xe*x+Ee*L,o[7]=_e*d+xe*S+Ee*F,o[8]=_e*_+xe*R+Ee*U,o}function $(){var o=new I(16);return I!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function re(o){var t=new I(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t}function ie(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Y(o,t){var a=t[0],u=t[1],d=t[2],_=t[3],x=t[4],S=t[5],R=t[6],L=t[7],F=t[8],U=t[9],G=t[10],X=t[11],Z=t[12],ne=t[13],he=t[14],ce=t[15],_e=a*S-u*x,xe=a*R-d*x,Ee=a*L-_*x,ke=u*R-d*S,Be=u*L-_*S,He=d*L-_*R,Je=F*ne-U*Z,tt=F*he-G*Z,It=F*ce-X*Z,ut=U*he-G*ne,Ot=U*ce-X*ne,Zt=G*ce-X*he,Yt=_e*Zt-xe*Ot+Ee*ut+ke*It-Be*tt+He*Je;return Yt?(o[0]=(S*Zt-R*Ot+L*ut)*(Yt=1/Yt),o[1]=(d*Ot-u*Zt-_*ut)*Yt,o[2]=(ne*He-he*Be+ce*ke)*Yt,o[3]=(G*Be-U*He-X*ke)*Yt,o[4]=(R*It-x*Zt-L*tt)*Yt,o[5]=(a*Zt-d*It+_*tt)*Yt,o[6]=(he*Ee-Z*He-ce*xe)*Yt,o[7]=(F*He-G*Ee+X*xe)*Yt,o[8]=(x*Ot-S*It+L*Je)*Yt,o[9]=(u*It-a*Ot-_*Je)*Yt,o[10]=(Z*Be-ne*Ee+ce*_e)*Yt,o[11]=(U*Ee-F*Be-X*_e)*Yt,o[12]=(S*tt-x*ut-R*Je)*Yt,o[13]=(a*ut-u*tt+d*Je)*Yt,o[14]=(ne*xe-Z*ke-he*_e)*Yt,o[15]=(F*ke-U*xe+G*_e)*Yt,o):null}function ae(o,t,a){var u=t[0],d=t[1],_=t[2],x=t[3],S=t[4],R=t[5],L=t[6],F=t[7],U=t[8],G=t[9],X=t[10],Z=t[11],ne=t[12],he=t[13],ce=t[14],_e=t[15],xe=a[0],Ee=a[1],ke=a[2],Be=a[3];return o[0]=xe*u+Ee*S+ke*U+Be*ne,o[1]=xe*d+Ee*R+ke*G+Be*he,o[2]=xe*_+Ee*L+ke*X+Be*ce,o[3]=xe*x+Ee*F+ke*Z+Be*_e,o[4]=(xe=a[4])*u+(Ee=a[5])*S+(ke=a[6])*U+(Be=a[7])*ne,o[5]=xe*d+Ee*R+ke*G+Be*he,o[6]=xe*_+Ee*L+ke*X+Be*ce,o[7]=xe*x+Ee*F+ke*Z+Be*_e,o[8]=(xe=a[8])*u+(Ee=a[9])*S+(ke=a[10])*U+(Be=a[11])*ne,o[9]=xe*d+Ee*R+ke*G+Be*he,o[10]=xe*_+Ee*L+ke*X+Be*ce,o[11]=xe*x+Ee*F+ke*Z+Be*_e,o[12]=(xe=a[12])*u+(Ee=a[13])*S+(ke=a[14])*U+(Be=a[15])*ne,o[13]=xe*d+Ee*R+ke*G+Be*he,o[14]=xe*_+Ee*L+ke*X+Be*ce,o[15]=xe*x+Ee*F+ke*Z+Be*_e,o}function ue(o,t,a){var u,d,_,x,S,R,L,F,U,G,X,Z,ne=a[0],he=a[1],ce=a[2];return t===o?(o[12]=t[0]*ne+t[4]*he+t[8]*ce+t[12],o[13]=t[1]*ne+t[5]*he+t[9]*ce+t[13],o[14]=t[2]*ne+t[6]*he+t[10]*ce+t[14],o[15]=t[3]*ne+t[7]*he+t[11]*ce+t[15]):(d=t[1],_=t[2],x=t[3],S=t[4],R=t[5],L=t[6],F=t[7],U=t[8],G=t[9],X=t[10],Z=t[11],o[0]=u=t[0],o[1]=d,o[2]=_,o[3]=x,o[4]=S,o[5]=R,o[6]=L,o[7]=F,o[8]=U,o[9]=G,o[10]=X,o[11]=Z,o[12]=u*ne+S*he+U*ce+t[12],o[13]=d*ne+R*he+G*ce+t[13],o[14]=_*ne+L*he+X*ce+t[14],o[15]=x*ne+F*he+Z*ce+t[15]),o}function me(o,t,a){var u=a[0],d=a[1],_=a[2];return o[0]=t[0]*u,o[1]=t[1]*u,o[2]=t[2]*u,o[3]=t[3]*u,o[4]=t[4]*d,o[5]=t[5]*d,o[6]=t[6]*d,o[7]=t[7]*d,o[8]=t[8]*_,o[9]=t[9]*_,o[10]=t[10]*_,o[11]=t[11]*_,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function Ae(o,t,a){var u=Math.sin(a),d=Math.cos(a),_=t[4],x=t[5],S=t[6],R=t[7],L=t[8],F=t[9],U=t[10],G=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=_*d+L*u,o[5]=x*d+F*u,o[6]=S*d+U*u,o[7]=R*d+G*u,o[8]=L*d-_*u,o[9]=F*d-x*u,o[10]=U*d-S*u,o[11]=G*d-R*u,o}function Se(o,t,a){var u=Math.sin(a),d=Math.cos(a),_=t[0],x=t[1],S=t[2],R=t[3],L=t[8],F=t[9],U=t[10],G=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=_*d-L*u,o[1]=x*d-F*u,o[2]=S*d-U*u,o[3]=R*d-G*u,o[8]=_*u+L*d,o[9]=x*u+F*d,o[10]=S*u+U*d,o[11]=R*u+G*d,o}function ze(o,t,a){var u=Math.sin(a),d=Math.cos(a),_=t[0],x=t[1],S=t[2],R=t[3],L=t[4],F=t[5],U=t[6],G=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=_*d+L*u,o[1]=x*d+F*u,o[2]=S*d+U*u,o[3]=R*d+G*u,o[4]=L*d-_*u,o[5]=F*d-x*u,o[6]=U*d-S*u,o[7]=G*d-R*u,o}function je(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ce(o,t,a){var u,d,_,x=a[0],S=a[1],R=a[2],L=Math.sqrt(x*x+S*S+R*R);return L<C?null:(x*=L=1/L,S*=L,R*=L,u=Math.sin(t),d=Math.cos(t),o[0]=x*x*(_=1-d)+d,o[1]=S*x*_+R*u,o[2]=R*x*_-S*u,o[3]=0,o[4]=x*S*_-R*u,o[5]=S*S*_+d,o[6]=R*S*_+x*u,o[7]=0,o[8]=x*R*_+S*u,o[9]=S*R*_-x*u,o[10]=R*R*_+d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function Te(o,t){var a=t[0],u=t[1],d=t[2],_=t[4],x=t[5],S=t[6],R=t[8],L=t[9],F=t[10];return o[0]=Math.sqrt(a*a+u*u+d*d),o[1]=Math.sqrt(_*_+x*x+S*S),o[2]=Math.sqrt(R*R+L*L+F*F),o}function Ze(o,t){var a=t[0],u=t[1],d=t[2],_=t[3],x=a+a,S=u+u,R=d+d,L=a*x,F=u*x,U=u*S,G=d*x,X=d*S,Z=d*R,ne=_*x,he=_*S,ce=_*R;return o[0]=1-U-Z,o[1]=F+ce,o[2]=G-he,o[3]=0,o[4]=F-ce,o[5]=1-L-Z,o[6]=X+ne,o[7]=0,o[8]=G+he,o[9]=X-ne,o[10]=1-L-U,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var Mt=ae;function mt(){var o=new I(3);return I!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Gt(o){var t=new I(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function kt(o){var t=o[0],a=o[1],u=o[2];return Math.sqrt(t*t+a*a+u*u)}function Re(o,t,a){var u=new I(3);return u[0]=o,u[1]=t,u[2]=a,u}function Qe(o,t,a,u){return o[0]=t,o[1]=a,o[2]=u,o}function et(o,t,a){return o[0]=t[0]+a[0],o[1]=t[1]+a[1],o[2]=t[2]+a[2],o}function Lt(o,t,a){return o[0]=t[0]-a[0],o[1]=t[1]-a[1],o[2]=t[2]-a[2],o}function jt(o,t,a){return o[0]=t[0]*a[0],o[1]=t[1]*a[1],o[2]=t[2]*a[2],o}function Ge(o,t,a){return o[0]=Math.min(t[0],a[0]),o[1]=Math.min(t[1],a[1]),o[2]=Math.min(t[2],a[2]),o}function Et(o,t,a){return o[0]=Math.max(t[0],a[0]),o[1]=Math.max(t[1],a[1]),o[2]=Math.max(t[2],a[2]),o}function Vt(o,t,a){return o[0]=t[0]*a,o[1]=t[1]*a,o[2]=t[2]*a,o}function ii(o,t,a,u){return o[0]=t[0]+a[0]*u,o[1]=t[1]+a[1]*u,o[2]=t[2]+a[2]*u,o}function ki(o,t){var a=t[0]-o[0],u=t[1]-o[1],d=t[2]-o[2];return Math.sqrt(a*a+u*u+d*d)}function qt(o,t){var a=t[0]-o[0],u=t[1]-o[1],d=t[2]-o[2];return a*a+u*u+d*d}function xi(o){var t=o[0],a=o[1],u=o[2];return t*t+a*a+u*u}function Fi(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o}function Ui(o,t){var a=t[0],u=t[1],d=t[2],_=a*a+u*u+d*d;return _>0&&(_=1/Math.sqrt(_)),o[0]=t[0]*_,o[1]=t[1]*_,o[2]=t[2]*_,o}function rn(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function Fn(o,t,a){var u=t[0],d=t[1],_=t[2],x=a[0],S=a[1],R=a[2];return o[0]=d*R-_*S,o[1]=_*x-u*R,o[2]=u*S-d*x,o}function Er(o,t,a,u){var d=t[0],_=t[1],x=t[2];return o[0]=d+u*(a[0]-d),o[1]=_+u*(a[1]-_),o[2]=x+u*(a[2]-x),o}function xn(o,t,a){var u=t[0],d=t[1],_=t[2],x=a[3]*u+a[7]*d+a[11]*_+a[15];return o[0]=(a[0]*u+a[4]*d+a[8]*_+a[12])/(x=x||1),o[1]=(a[1]*u+a[5]*d+a[9]*_+a[13])/x,o[2]=(a[2]*u+a[6]*d+a[10]*_+a[14])/x,o}function Vi(o,t,a){var u=t[0],d=t[1],_=t[2];return o[0]=u*a[0]+d*a[3]+_*a[6],o[1]=u*a[1]+d*a[4]+_*a[7],o[2]=u*a[2]+d*a[5]+_*a[8],o}function st(o,t,a){var u=a[0],d=a[1],_=a[2],x=a[3],S=t[0],R=t[1],L=t[2],F=d*L-_*R,U=_*S-u*L,G=u*R-d*S;return o[0]=S+x*(F+=F)+d*(G+=G)-_*(U+=U),o[1]=R+x*U+_*F-u*G,o[2]=L+x*G+u*U-d*F,o}function Xi(o){return o[0]=0,o[1]=0,o[2]=0,o}function Ji(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]}var Di=Lt,tn=jt,Sn=kt;function _n(){var o=new I(4);return I!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function Gn(o,t,a){return o[0]=t[0]*a,o[1]=t[1]*a,o[2]=t[2]*a,o[3]=t[3]*a,o}function ot(o,t){var a=t[0],u=t[1],d=t[2],_=t[3],x=a*a+u*u+d*d+_*_;return x>0&&(x=1/Math.sqrt(x)),o[0]=a*x,o[1]=u*x,o[2]=d*x,o[3]=_*x,o}function De(o,t,a){var u=t[0],d=t[1],_=t[2],x=t[3];return o[0]=a[0]*u+a[4]*d+a[8]*_+a[12]*x,o[1]=a[1]*u+a[5]*d+a[9]*_+a[13]*x,o[2]=a[2]*u+a[6]*d+a[10]*_+a[14]*x,o[3]=a[3]*u+a[7]*d+a[11]*_+a[15]*x,o}function Qt(){var o=new I(4);return I!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Li(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Wi(o,t,a){a*=.5;var u=t[0],d=t[1],_=t[2],x=t[3],S=Math.sin(a),R=Math.cos(a);return o[0]=u*R+x*S,o[1]=d*R+_*S,o[2]=_*R-d*S,o[3]=x*R-u*S,o}function Ei(o,t,a){a*=.5;var u=t[0],d=t[1],_=t[2],x=t[3],S=Math.sin(a),R=Math.cos(a);return o[0]=u*R-_*S,o[1]=d*R+x*S,o[2]=_*R+u*S,o[3]=x*R-d*S,o}mt(),_n();var Hn,An,dr,Jn=ot,Qi=(Hn=mt(),An=Re(1,0,0),dr=Re(0,1,0),function(o,t,a){var u=rn(t,a);return u<-.999999?(Fn(Hn,An,t),Sn(Hn)<1e-6&&Fn(Hn,dr,t),Ui(Hn,Hn),(function(d,_,x){x*=.5;var S=Math.sin(x);d[0]=S*_[0],d[1]=S*_[1],d[2]=S*_[2],d[3]=Math.cos(x)})(o,Hn,Math.PI),o):u>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Fn(Hn,t,a),o[0]=Hn[0],o[1]=Hn[1],o[2]=Hn[2],o[3]=1+u,Jn(o,o))});function qi(){var o=new I(2);return I!=Float32Array&&(o[0]=0,o[1]=0),o}function Xn(o,t){var a=new I(2);return a[0]=o,a[1]=t,a}function Qn(o,t,a){return o[0]=t,o[1]=a,o}function Nn(o,t,a){return o[0]=t[0]+a[0],o[1]=t[1]+a[1],o}function xr(o,t,a){return o[0]=t[0]-a[0],o[1]=t[1]-a[1],o}function Rt(o,t,a){return o[0]=t[0]*a,o[1]=t[1]*a,o}function wn(o){var t=o[0],a=o[1];return Math.sqrt(t*t+a*a)}function vn(o,t){var a=t[0],u=t[1],d=a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),o[0]=t[0]*d,o[1]=t[1]*d,o}function bn(o,t){return o[0]*t[0]+o[1]*t[1]}Qt(),Qt(),N();var Pi,zi,Kn=xr;function Dr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}qi();var ls=(function(){if(zi)return Pi;function o(t,a,u,d){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=u,this.p2y=d}return zi=1,Pi=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,a){if(a===void 0&&(a=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,d=0;d<8;d++){var _=this.sampleCurveX(u)-t;if(Math.abs(_)<a)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=_/x}var S=0,R=1;for(u=t,d=0;d<20&&(_=this.sampleCurveX(u),!(Math.abs(_-t)<a));d++)t>_?S=u:R=u,u=.5*(R-S)+S;return u},solve:function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))}},Pi})(),Ts=Dr(ls);function Xt(o,t){this.x=o,this.y=t}function ja(o,t){if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let a=0;a<o.length;a++)if(!ja(o[a],t[a]))return!1;return!0}if(typeof o=="object"&&o!==null&&t!==null){if(typeof t!="object"||Object.keys(o).length!==Object.keys(t).length)return!1;for(const a in o)if(!ja(o[a],t[a]))return!1;return!0}return o===t}Xt.prototype={clone(){return new Xt(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,t){return this.clone()._rotateAround(o,t)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const t=o.x-this.x,a=o.y-this.y;return t*t+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,t){return Math.atan2(this.x*t-this.y*o,this.x*o+this.y*t)},_matMult(o){const t=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=t,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const t=Math.cos(o),a=Math.sin(o),u=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=u,this},_rotateAround(o,t){const a=Math.cos(o),u=Math.sin(o),d=t.y+u*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-u*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Xt},Xt.convert=function(o){if(o instanceof Xt)return o;if(Array.isArray(o))return new Xt(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Xt(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const $f=Math.PI/180,ac=180/Math.PI;function Ar(o){return o*$f}function js(o){return o*ac}const Bu=[[0,0],[1,0],[1,1],[0,1]];function Lo(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,a=t*o;return 4*(o<.5?a:3*(o-t)+a-.75)}function jo(o,t,a,u){const d=new Ts(o,t,a,u);return function(_){return d.solve(_)}}const ft=jo(.25,.1,.25,1);function oe(o,t,a){return Math.min(a,Math.max(t,o))}function ge(o,t,a){return(a=oe((a-o)/(t-o),0,1))*a*(3-2*a)}function Ie(o,t,a){const u=a-t,d=((o-t)%u+u)%u+t;return d===t?a:d}function $e(o,t,a){if(!o.length)return a(null,[]);let u=o.length;const d=new Array(o.length);let _=null;o.forEach(((x,S)=>{t(x,((R,L)=>{R&&(_=R),d[S]=L,--u==0&&a(_,d)}))}))}let Ke=1;function at(){return Ke++}function At(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function lt(o,t){o.forEach((a=>{t[a]&&(t[a]=t[a].bind(t))}))}function Tt(o,t,a){const u={};for(const d in o)u[d]=t.call(this,o[d],d,o);return u}function Wt(o,t,a){const u={};for(const d in o)t.call(this,o[d],d,o)&&(u[d]=o[d]);return u}function ye(o){return Array.isArray(o)?o.map(ye):typeof o=="object"&&o?Tt(o,ye):o}function it(o,t){for(let a=0;a<o.length;a++)if(t.indexOf(o[a])>=0)return!0;return!1}const wt={};function ht(o){wt[o]||(typeof console<"u"&&console.warn(o),wt[o]=!0)}function bt(o,t,a){return(a.y-o.y)*(t.x-o.x)>(t.y-o.y)*(a.x-o.x)}function mi(o){let t=0;for(let a,u,d=0,_=o.length,x=_-1;d<_;x=d++)a=o[d],u=o[x],t+=(u.x-a.x)*(a.y+u.y);return t}function bi([o,t,a]){const u=Ar(t+90),d=Ar(a);return{x:o*Math.cos(u)*Math.sin(d),y:o*Math.sin(u)*Math.sin(d),z:o*Math.cos(d),azimuthal:t,polar:a}}function ji(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function pn(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((a,u,d,_)=>{const x=d||_;return t[u]=!x||x.toLowerCase(),""})),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t}let Vn=null;function Un(o,t){return[o[4*t],o[4*t+1],o[4*t+2],o[4*t+3]]}function kn(o,t,a,u){for(;t<a;){const d=t+a>>1;o[d]<u?t=d+1:a=d}return t}function Wn(o,t,a,u){for(;t<a;){const d=t+a>>1;o[d]<=u?t=d+1:a=d}return t}function Cn(o){return o>0?1/(1.001-o):1+o}function or(o){return o>0?1-1/(1.001-o):-o}function jn(o,t,a){return(o-t.min)*(a.max-a.min)/(t.max-t.min)+a.min}const Tn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Tn.API_URL)return null;try{const o=new URL(Tn.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function In(o){return Tn.API_URL_REGEX.test(o)}function Qr(o){return Tn.API_SPRITE_REGEX.test(o)}let kr,qs,bl,Kr,qa,as;function la(){return kr==null&&(kr=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),kr}const xs={now:()=>Kr!==void 0?Kr:performance.now(),setNow(o){Kr=o},restoreNow(){Kr=void 0},frame(o){const t=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(o,t=0){const{width:a,height:u}=o;qa||(qa=document.createElement("canvas"));const d=qa.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(a>qa.width||u>qa.height)&&(qa.width=a,qa.height=u),d.clearRect(-t,-t,a+2*t,u+2*t),d.drawImage(o,0,0,a,u),d.getImageData(-t,-t,a+2*t,u+2*t)},resolveURL:o=>(qs||(qs=document.createElement("a")),qs.href=o,qs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(bl==null&&(bl=window.matchMedia("(prefers-reduced-motion: reduce)")),bl.matches)},hasCanvasFingerprintNoise(){if(as!==void 0)return as;if(!la())return as=!1,!1;const o=new OffscreenCanvas(85,1),t=o.getContext("2d",{willReadFrequently:!0});let a=0;for(let d=0;d<o.width;++d)t.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,t.fillRect(d,0,1,1);const u=t.getImageData(0,0,o.width,o.height);a=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&a++!==u.data[d])return as=!0,!0;return as=!1,!1}};function Ma(o,t){const a=o.indexOf("?");if(a<0)return`${o}?${new URLSearchParams(t).toString()}`;const u=new URLSearchParams(o.slice(a));for(const d in t)u.set(d,t[d]);return`${o.slice(0,a)}?${u.toString()}`}function ma(o,t={persistentParams:[]}){const a=o.indexOf("?");if(a<0)return o;const u=new URLSearchParams,d=new URLSearchParams(o.slice(a));for(const x of t.persistentParams){const S=d.get(x);S&&u.set(x,S)}const _=u.toString();return`${o.slice(0,a)}${_.length>0?`?${_}`:""}`}const Ul="mapbox-tiles";let wl=500,tf=50;const Jf=["language","worldview","jobid"];let kl,tl;function Cc(){try{return caches}catch{}}function Sl(){const o=Cc();o&&kl==null&&(kl=o.open(Ul))}let Ka=1/0;const Vl={supported:!1,testSupport:function(o){!nu&&oc&&(wh?Pm(o):iu=o)}};let iu,oc,nu=!1,wh=!1;const Qf=typeof self<"u"?self:{};function Pm(o){const t=o.createTexture();o.bindTexture(o.TEXTURE_2D,t);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,oc),o.isContextLost())return;Vl.supported=!0}catch{}o.deleteTexture(t),nu=!0}Qf.document&&(oc=Qf.document.createElement("img"),oc.onload=function(){iu&&Pm(iu),iu=null,wh=!0},oc.onerror=function(){nu=!0,iu=null},oc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ru={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ru);class Na extends Error{constructor(t,a,u){a===401&&In(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ed=ji()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,su=function(o,t){if(!(/^file:/.test(a=o.url)||/^file:/.test(ed())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,d){const _=new AbortController,x=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ed(),referrerPolicy:u.referrerPolicy,signal:_.signal});let S=!1,R=!1;const L=(F=x.url).indexOf("sku=")>0&&In(F);var F;u.type==="json"&&x.headers.set("Accept","application/json");const U=(X,Z,ne)=>{if(R)return;if(X&&X.message!=="SecurityError"&&ht(X.toString()),Z&&ne)return G(Z);const he=Date.now();fetch(x).then((ce=>{if(ce.ok){const _e=L?ce.clone():null;return G(ce,_e,he)}return d(new Na(ce.statusText,ce.status,u.url))})).catch((ce=>{ce.name!=="AbortError"&&d(new Error(`${ce.message} ${u.url}`))}))},G=(X,Z,ne)=>{(u.type==="arrayBuffer"?X.arrayBuffer():u.type==="json"?X.json():X.text()).then((he=>{R||(Z&&ne&&(function(ce,_e,xe){if(Sl(),kl==null)return;const Ee=pn(_e.headers.get("Cache-Control")||"");if(Ee["no-store"])return;const ke={status:_e.status,statusText:_e.statusText,headers:new Headers};_e.headers.forEach(((Je,tt)=>ke.headers.set(tt,Je))),Ee["max-age"]&&ke.headers.set("Expires",new Date(xe+1e3*Ee["max-age"]).toUTCString());const Be=ke.headers.get("Expires");if(!Be||new Date(Be).getTime()-xe<42e4)return;let He=ma(ce.url,{persistentParams:Jf});if(_e.status===206){const Je=ce.headers.get("Range");if(!Je)return;ke.status=200,He=Ma(He,{range:Je})}(function(Je,tt){if(tl===void 0)try{new Response(new ReadableStream),tl=!0}catch{tl=!1}tl?tt(Je.body):Je.blob().then(tt).catch((It=>ht(It.message)))})(_e,(Je=>{const tt=new Response((It=_e.status)!==200&&It!==404&&[101,103,204,205,304].includes(It)?null:Je,ke);var It;Sl(),kl?.then((ut=>ut.put(He,tt))).catch((ut=>ht(ut.message)))}))})(x,Z,ne),S=!0,d(null,he,X.headers))})).catch((he=>{R||d(new Error(he.message))}))};return L?(function(X,Z){if(Sl(),kl==null)return Z(null);kl.then((ne=>{let he=ma(X.url,{persistentParams:Jf});const ce=X.headers.get("Range");ce&&(he=Ma(he,{range:ce})),ne.match(he).then((_e=>{const xe=(function(Ee){if(!Ee)return!1;const ke=new Date(Ee.headers.get("Expires")||0),Be=pn(Ee.headers.get("Cache-Control")||"");return Number(ke)>Date.now()&&!Be["no-cache"]})(_e);ne.delete(he).catch(Z),xe&&ne.put(he,_e.clone()).catch(Z),Z(null,_e,xe)})).catch(Z)})).catch(Z)})(x,U):U(null,null),{cancel:()=>{R=!0,S||_.abort()}}})(o,t);if(ji(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,t,void 0,!0)}var a;return(function(u,d){const _=new XMLHttpRequest;_.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const x in u.headers)_.setRequestHeader(x,u.headers[x]);return u.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=u.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let x=_.response;if(u.type==="json")try{x=JSON.parse(_.response)}catch(R){return d(R)}const S=new Headers;_.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((R=>{const L=R.split(": "),F=L.shift(),U=L.join(": ");S.append(F,U)})),d(null,x,S)}else d(new Na(_.statusText,_.status,u.url))},_.send(u.body),{cancel:()=>_.abort()}})(o,t)},il=function(o,t){return su(Object.assign(o,{type:"arrayBuffer"}),t)};function zm(o){const t=document.createElement("a");return t.href=o,t.protocol===location.protocol&&t.host===location.host}const Sh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nf,wr;nf=[],wr=0;const rf=function(o,t){if(Vl.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),wr>=Tn.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:o,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return nf.push(_),_}wr++;let a=!1;const u=()=>{if(!a)for(a=!0,wr--;nf.length&&wr<Tn.MAX_PARALLEL_IMAGE_REQUESTS;){const _=nf.shift(),{requestParameters:x,callback:S,cancelled:R}=_;R||(_.cancel=rf(x,S).cancel)}},d=il(o,((_,x,S)=>{u(),_?t(_):x&&(self.createImageBitmap?(function(R,L){const F=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(F).then((U=>{L(null,U)})).catch((U=>{L(new Error(`Could not load image because of ${U.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(x,((R,L)=>t(R,L,S))):(function(R,L){const F=new Image;F.onload=()=>{L(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame((()=>{F.src=Sh}))},F.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new Blob([new Uint8Array(R)],{type:"image/png"});F.src=R.byteLength?URL.createObjectURL(U):Sh})(x,((R,L)=>t(R,L,S))))}));return{cancel:()=>{d.cancel(),u()}}};var Lp,qo,Th,Rc={exports:{}},Tl={exports:{}},sf={exports:{}},qd=(function(){if(Th)return Rc.exports;Th=1;var o=(Lp||(Lp=1,Tl.exports=function(a,u){var d,_,x,S,R,L,F,U;for(_=a.length-(d=3&a.length),x=u,R=3432918353,L=461845907,U=0;U<_;)F=255&a.charCodeAt(U)|(255&a.charCodeAt(++U))<<8|(255&a.charCodeAt(++U))<<16|(255&a.charCodeAt(++U))<<24,++U,x=27492+(65535&(S=5*(65535&(x=(x^=F=(65535&(F=(F=(65535&F)*R+(((F>>>16)*R&65535)<<16)&4294967295)<<15|F>>>17))*L+(((F>>>16)*L&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(F=0,d){case 3:F^=(255&a.charCodeAt(U+2))<<16;case 2:F^=(255&a.charCodeAt(U+1))<<8;case 1:x^=F=(65535&(F=(F=(65535&(F^=255&a.charCodeAt(U)))*R+(((F>>>16)*R&65535)<<16)&4294967295)<<15|F>>>17))*L+(((F>>>16)*L&65535)<<16)&4294967295}return x^=a.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),Tl.exports),t=(qo||(qo=1,sf.exports=function(a,u){for(var d,_=a.length,x=u^_,S=0;_>=4;)d=1540483477*(65535&(d=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(d>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++S;switch(_){case 3:x^=(255&a.charCodeAt(S+2))<<16;case 2:x^=(255&a.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&a.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),sf.exports);return Rc.exports=o,Rc.exports.murmur3=o,Rc.exports.murmur2=t,Rc.exports})(),af=Dr(qd);class Ml{constructor(t,...a){Object.assign(this,a[0]||{}),this.type=t}}class Mh extends Ml{constructor(t,a={}){super("error",Object.assign({error:t},a))}}function Om(o,t,a){a[o]&&a[o].indexOf(t)!==-1||(a[o]=a[o]||[],a[o].push(t))}function Da(o,t,a){if(a&&a[o]){const u=a[o].indexOf(t);u!==-1&&a[o].splice(u,1)}}class of{on(t,a){return this._listeners=this._listeners||{},Om(t,a,this._listeners),this}off(t,a){return Da(t,a,this._listeners),Da(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Om(t,a,this._oneTimeListeners),this):new Promise((u=>{this.once(t,u)}))}fire(t,a){const u=typeof t=="string"?new Ml(t,a):t,d=u.type;if(this.listens(d)){u.target=this;const _=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const R of _)R.call(this,u);const x=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const R of x)Da(d,R,this._oneTimeListeners),R.call(this,u);const S=this._eventedParent;if(S){const R=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,R),S.fire(u)}}else u instanceof Mh&&console.error(u.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}class Po{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new Po(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[a,u]=t.split("");return new Po({name:a,iconsetId:u})}static isEqual(t,a){return t.name===a.name&&t.iconsetId===a.iconsetId}toString(){return Po.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var td,Xd={},lc=(function(){if(td)return Xd;td=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(_){return(_=Math.round(_))<0?0:_>255?255:_}function a(_){return t(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function u(_){return(x=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:x>1?1:x;var x}function d(_,x,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?_+(x-_)*S*6:2*S<1?x:3*S<2?_+(x-_)*(2/3-S)*6:_}try{Xd.parseCSSColor=function(_){var x,S=_.replace(/ /g,"").toLowerCase();if(S in o)return o[S].slice();if(S[0]==="#")return S.length===4?(x=parseInt(S.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:S.length===7&&(x=parseInt(S.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var R=S.indexOf("("),L=S.indexOf(")");if(R!==-1&&L+1===S.length){var F=S.substr(0,R),U=S.substr(R+1,L-(R+1)).split(","),G=1;switch(F){case"rgba":if(U.length!==4)return null;G=u(U.pop());case"rgb":return U.length!==3?null:[a(U[0]),a(U[1]),a(U[2]),G];case"hsla":if(U.length!==4)return null;G=u(U.pop());case"hsl":if(U.length!==3)return null;var X=(parseFloat(U[0])%360+360)%360/360,Z=u(U[1]),ne=u(U[2]),he=ne<=.5?ne*(Z+1):ne+Z-ne*Z,ce=2*ne-he;return[t(255*d(ce,he,X+1/3)),t(255*d(ce,he,X)),t(255*d(ce,he,X-1/3)),G];default:return null}}return null}}catch{}return Xd})();class qr{constructor(t,a,u,d=1){this.r=t,this.g=a,this.b=u,this.a=d}static parse(t){if(!t)return;if(t instanceof qr)return t;if(typeof t!="string")return;const a=lc.parseCSSColor(t);return a?new qr(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[t,a,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*a)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(t){const{r:a,g:u,b:d,a:_}=this;return new _g(t,a,u,d,_)}toPremultipliedRenderColor(t){const{r:a,g:u,b:d,a:_}=this;return new Nm(t,a*_,u*_,d*_,_)}clone(){return new qr(this.r,this.g,this.b,this.a)}}class Bm{constructor(t,a,u,d,_,x=!1){if(this.premultiplied=!1,this.premultiplied=x,t){const S=t.image.height,R=S*S;this.premultiplied?(a=_===0?0:a/_*(S-1),u=_===0?0:u/_*(S-1),d=_===0?0:d/_*(S-1)):(a*=S-1,u*=S-1,d*=S-1);const L=Math.floor(a),F=Math.floor(u),U=Math.floor(d),G=Math.ceil(a),X=Math.ceil(u),Z=Math.ceil(d),ne=a-L,he=u-F,ce=d-U,_e=t.image.data,xe=4*(L+F*R+U*S),Ee=4*(L+F*R+Z*S),ke=4*(L+X*R+U*S),Be=4*(L+X*R+Z*S),He=4*(G+F*R+U*S),Je=4*(G+F*R+Z*S),tt=4*(G+X*R+U*S),It=4*(G+X*R+Z*S);if(xe<0||It>=_e.length)throw new Error("out of range");this.r=Rn(Rn(Rn(_e[xe],_e[Ee],ce),Rn(_e[ke],_e[Be],ce),he),Rn(Rn(_e[He],_e[Je],ce),Rn(_e[tt],_e[It],ce),he),ne)/255*(this.premultiplied?_:1),this.g=Rn(Rn(Rn(_e[xe+1],_e[Ee+1],ce),Rn(_e[ke+1],_e[Be+1],ce),he),Rn(Rn(_e[He+1],_e[Je+1],ce),Rn(_e[tt+1],_e[It+1],ce),he),ne)/255*(this.premultiplied?_:1),this.b=Rn(Rn(Rn(_e[xe+2],_e[Ee+2],ce),Rn(_e[ke+2],_e[Be+2],ce),he),Rn(Rn(_e[He+2],_e[Je+2],ce),Rn(_e[tt+2],_e[It+2],ce),he),ne)/255*(this.premultiplied?_:1),this.a=_}else this.r=a,this.g=u,this.b=d,this.a=_}toArray(){const{r:t,g:a,b:u,a:d}=this;return[255*t,255*a,255*u,d]}toHslaArray(){let{r:t,g:a,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const Z=1/d;t*=Z,a*=Z,u*=Z}const _=Math.min(Math.max(t,0),1),x=Math.min(Math.max(a,0),1),S=Math.min(Math.max(u,0),1),R=Math.min(_,x,S),L=Math.max(_,x,S),F=L-R,U=.5*(R+L);if(F===0)return[0,0,100*U,d];const G=U>.5?F/(2-L-R):F/(L+R);let X;switch(L){case _:X=60*((x-S)/F+(x<S?6:0));break;case x:X=60*((S-_)/F+2);break;default:X=60*((_-x)/F+4)}return[X,100*G,100*U,d]}toArray01(){const{r:t,g:a,b:u,a:d}=this;return[t,a,u,d]}toArray01Scaled(t){const{r:a,g:u,b:d}=this;return[a*t,u*t,d*t]}toArray01Linear(){const{r:t,g:a,b:u,a:d}=this;return[Math.pow(t,2.2),Math.pow(a,2.2),Math.pow(u,2.2),d]}}class _g extends Bm{constructor(t,a,u,d,_){super(t,a,u,d,_,!1)}}class Nm extends Bm{constructor(t,a,u,d,_){super(t,a,u,d,_,!0)}}function Rn(o,t,a){return o*(1-a)+t*a}function Pp(o,t,a){return o.map(((u,d)=>Rn(u,t[d],a)))}qr.black=new qr(0,0,0,1),qr.white=new qr(1,1,1,1),qr.transparent=new qr(0,0,0,0),qr.red=new qr(1,0,0,1),qr.blue=new qr(0,0,1,1);var id=Object.freeze({__proto__:null,array:Pp,color:function(o,t,a){return new qr(Rn(o.r,t.r,a),Rn(o.g,t.g,a),Rn(o.b,t.b,a),Rn(o.a,t.a,a))},number:Rn});class cc extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class Nu{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(t){return new Nu(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const uc={kind:"null"},hn={kind:"number"},Rr={kind:"string"},Zr={kind:"boolean"},nl={kind:"color"},zo={kind:"object"},Xr={kind:"value"},Fm={kind:"collator"},Wd={kind:"formatted"},Ic={kind:"resolvedImage"};function ba(o,t){return{kind:"array",itemType:o,N:t}}function ca(o){if(o.kind==="array"){const t=ca(o.itemType);return typeof o.N=="number"?`array<${t}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${t}>`}return o.kind}const yg=[uc,hn,Rr,Zr,nl,Wd,zo,ba(Xr),Ic];function Gl(o,t){if(t.kind==="error")return null;if(o.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Gl(o.itemType,t.itemType))&&(typeof o.N!="number"||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if(o.kind==="value"){for(const a of yg)if(!Gl(a,t))return null}}return`Expected ${ca(o)} but found ${ca(t)} instead.`}function Fu(o,t){return t.some((a=>a.kind===o.kind))}function au(o,t){return t.some((a=>a==="null"?o===null:a==="array"?Array.isArray(o):a==="object"?o&&!Array.isArray(o)&&typeof o=="object":a===typeof o))}function uo(o,t){return o.kind==="array"&&t.kind==="array"?o.N===t.N&&uo(o.itemType,t.itemType):o.kind===t.kind}class nd{constructor(t,a,u){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zd{constructor(t,a,u,d,_){this.text=t.normalize?t.normalize():t,this.image=a,this.scale=u,this.fontStack=d,this.textColor=_}}class xo{constructor(t){this.sections=t}static fromString(t){return new xo([new Zd(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||!!t.image&&t.image.hasPrimary()))}static factory(t){return t instanceof xo?t:xo.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const a of this.sections){if(a.image){const d=a.image.getPrimary().id.toString();t.push(["image",d]);continue}t.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(u)}return t}}class Hl{constructor(t,a={}){this.id=Po.from(t),this.params=a.params,this.sx=a.sx||1,this.sy=a.sy||1}toString(){return JSON.stringify(this)}static parse(t){let a,u,d,_;try{({id:a,params:u,sx:d,sy:_}=JSON.parse(t)||{})}catch{return null}return a?new Hl(a,{params:u,sx:d,sy:_}):null}scaleSelf(t,a=t){return this.sx*=t,this.sy*=a,this}}class Fa{constructor(t,a,u,d,_=!1){this.primaryId=Po.from(t),this.primaryOptions=a,u&&(this.secondaryId=Po.from(u)),this.secondaryOptions=d,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Hl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Hl(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?Fa.build({name:t}):t}static build(t,a,u,d){return!t||typeof t=="object"&&!("name"in t)?null:new Fa(t,u,a,d)}}function Uu(o,t,a,u){return typeof o=="number"&&o>=0&&o<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[o,t,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[o,t,a,u]:[o,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rd(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof qr||o instanceof nd||o instanceof xo||o instanceof Fa)return!0;if(Array.isArray(o)){for(const t of o)if(!rd(t))return!1;return!0}if(typeof o=="object"){for(const t in o)if(!rd(o[t]))return!1;return!0}return!1}function Xs(o){if(o===null)return uc;if(typeof o=="string")return Rr;if(typeof o=="boolean")return Zr;if(typeof o=="number")return hn;if(o instanceof qr)return nl;if(o instanceof nd)return Fm;if(o instanceof xo)return Wd;if(o instanceof Fa)return Ic;if(Array.isArray(o)){const t=o.length;let a;for(const u of o){const d=Xs(u);if(a){if(a===d)continue;a=Xr;break}a=d}return ba(a||Xr,t)}return zo}function jl(o){const t=typeof o;return o===null?"":t==="string"||t==="number"||t==="boolean"?String(o):o instanceof xo||o instanceof Fa||o instanceof qr?o.toString():JSON.stringify(o)}class Dc{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!rd(t[1]))return a.error("invalid value");const u=t[1];let d=Xs(u);const _=a.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Dc(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof qr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof xo?this.value.serialize():this.value}}class ua{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const lf={string:Rr,number:hn,boolean:Zr,object:zo};class hc{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let u,d=1;const _=t[0];if(_==="array"){let S,R;if(t.length>2){const L=t[1];if(typeof L!="string"||!(L in lf)||L==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);S=lf[L],d++}else S=Xr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);R=t[2],d++}u=ba(S,R)}else u=lf[_];const x=[];for(;d<t.length;d++){const S=a.parse(t[d],d,Xr);if(!S)return null;x.push(S)}return new hc(u,x)}evaluate(t){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(t);if(!Gl(this.type,Xs(u)))return u;if(a===this.args.length-1)throw new ua(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${ca(Xs(u))} but was expected to be of type ${ca(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,a=[t.kind];if(t.kind==="array"){const u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const d=t.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map((u=>u.serialize())))}}class El{constructor(t){this.type=Wd,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const d=[];let _=!1;for(let x=1;x<=t.length-1;++x){const S=t[x];if(_&&typeof S=="object"&&!Array.isArray(S)){_=!1;let R=null;if(S["font-scale"]&&(R=a.parseObjectValue(S["font-scale"],x,"font-scale",hn),!R))return null;let L=null;if(S["text-font"]&&(L=a.parseObjectValue(S["text-font"],x,"text-font",ba(Rr)),!L))return null;let F=null;if(S["text-color"]&&(F=a.parseObjectValue(S["text-color"],x,"text-color",nl),!F))return null;const U=d[d.length-1];U.scale=R,U.font=L,U.textColor=F}else{const R=a.parse(t[x],x,Xr);if(!R)return null;const L=R.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:R,scale:null,font:null,textColor:null})}}return new El(d)}evaluate(t){return new xo(this.sections.map((a=>{const u=a.content.evaluate(t);return uo(Xs(u),Ic)?new Zd("",u,null,null,null):new Zd(jl(u),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)})))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const a of this.sections){t.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),t.push(u)}return t}}class $n{constructor(t,a,u,d){this._imageWarnHistory={},this.type=Ic,this.namePrimary=t,this.nameSecondary=a,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(t,a){if(t.length<2)return a.error("Expected two or more arguments.");let u=1;const d=[];function _(){if(u<t.length){const S=a.parse(t[u],u++,Rr);return S?(d.push({image:S,options:{}}),!0):(a.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(u<t.length){const R=t[u];if((S=R)===null||typeof S!="object"||Array.isArray(S))return!0;const L=R.params,F=R.iconset,U=a.concat(u);if(!L&&!F)return u++,!0;if(L){if(typeof L!="object"||L.constructor!==Object)return U.error('Image options "params" should be an object'),!1;const G={},X=U.concat(void 0,"params");for(const Z in L){if(!Z)return X.error("Image parameter name should be non-empty"),!1;const ne=X.concat(void 0,Z).parse(L[Z],void 0,nl,void 0,{typeAnnotation:"coerce"});if(!ne)return!1;G[Z]=ne}d[d.length-1].options.params=G}if(F){if(typeof F!="object"||F.constructor!==Object)return U.error('Image options "iconset" should be an object'),!1;if(!F.id)return U.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=F}return u++,!0}var S;return!0}for(let S=0;S<2;S++)if(!_()||!x())return;return new $n(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(t,a){const u={};if(a){for(const d in a)if(a[d])try{u[d]=a[d].evaluate(t)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(t){const a={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,d=Fa.build(a,u,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(d&&t.availableImages){const _=d.getPrimary().id;if(d.available=t.availableImages.some((x=>Po.isEqual(x,_))),d.available){const x=d.getSecondary()?d.getSecondary().id:null;x&&(d.available=t.availableImages.some((S=>Po.isEqual(S,x))))}}return d}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&t(this.paramsPrimary[a]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&t(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(t,a){const u={};if(a&&(u.iconset={id:a}),t){u.params={};for(const d in t)t[d]&&(u.params[d]=t[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&t.push(a)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&t.push(a)}return t}}function sn(o){return fn(o)?"string":sd(o)?"number":zp(o)?"boolean":Array.isArray(o)?"array":o===null?"null":ku(o)?"object":typeof o}function ku(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function fn(o){return typeof o=="string"||o instanceof String}function sd(o){return typeof o=="number"||o instanceof Number}function zp(o){return typeof o=="boolean"||o instanceof Boolean}const zn={"to-boolean":Zr,"to-color":nl,"to-number":hn,"to-string":Rr};class ql{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[0],d=[];let _=uc;if(u==="to-array"){if(!Array.isArray(t[1]))return null;const x=t[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);_=ba(a.expectedType.itemType,x)}else{if(!(x>0&&rd(t[1][0])))return null;_=ba(Xs(t[1][0]),x)}for(let S=0;S<x;S++){const R=t[1][S];let L;if(Array.isArray(R))L=a.parse(R,void 0,_.itemType);else{const F=sn(R);if(F!==_.itemType.kind)return a.error(`Expected ${_.itemType.kind} but found ${F}.`);L=a.registry.literal.parse(["literal",R===void 0?null:R],a)}if(!L)return null;d.push(L)}}else{if((u==="to-boolean"||u==="to-string")&&t.length!==2)return a.error("Expected one argument.");_=zn[u];for(let x=1;x<t.length;x++){const S=a.parse(t[x],x,Xr);if(!S)return null;d.push(S)}}return new ql(_,d)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let a,u;for(const d of this.args){if(a=d.evaluate(t),u=null,a instanceof qr)return a;if(typeof a=="string"){const _=t.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Uu(a[0],a[1],a[2],a[3]),!u))return new qr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ua(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(t),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new ua(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?xo.fromString(jl(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Fa.build(jl(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map((a=>a.evaluate(t))):jl(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new El([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $n(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((a=>{t.push(a.serialize())})),t}}const Vu=["Unknown","Point","LineString","Polygon"];class Op{constructor(t,a,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=a,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-t[0])+this.featureDistanceData.bearing[1]*(d*a-t[1])}return 0}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=qr.parse(t)),a}getConfig(t){return this.options?this.options.get(t):null}}class Xo{constructor(t,a,u,d,_){this.name=t,this.type=a,this._evaluate=u,this.args=d,this._overloadIndex=_}evaluate(t){if(!this._evaluate){const a=Xo.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,a){const u=t[0],d=Xo.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,x=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,S=[];let R=null,L=-1;for(const[F,U]of x){if(Array.isArray(F)&&F.length!==t.length-1)continue;S.push(F),L++,R=new ud(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const G=[];let X=!1;for(let Z=1;Z<t.length;Z++){const ne=t[Z],he=Array.isArray(F)?F[Z-1]:F.type,ce=R.parse(ne,1+G.length,he);if(!ce){X=!0;break}G.push(ce)}if(!X)if(Array.isArray(F)&&F.length!==G.length)R.error(`Expected ${F.length} arguments, but found ${G.length} instead.`);else{for(let Z=0;Z<G.length;Z++){const ne=Array.isArray(F)?F[Z]:F.type,he=G[Z];R.concat(Z+1).checkSubtype(ne,he.type)}if(R.errors.length===0)return new Xo(u,_,U,G,L)}}if(S.length===1)a.errors.push(...R.errors);else{const F=(S.length?S:x.map((([G])=>G))).map(Gu).join(" | "),U=[];for(let G=1;G<t.length;G++){const X=a.parse(t[G],1+U.length);if(!X)return null;U.push(ca(X.type))}a.error(`Expected arguments of type ${F}, but found (${U.join(", ")}) instead.`)}return null}static register(t,a){Xo.definitions=a;for(const u in a)t[u]=Xo}}function Gu(o){return Array.isArray(o)?`(${o.map(ca).join(", ")})`:`(${ca(o.type)}...)`}class ts{constructor(t,a,u){this.type=Fm,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?a.parse(!1,1,Zr):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Zr);if(!d)return null;const _=u["diacritic-sensitive"]===void 0?a.parse(!1,1,Zr):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Zr);if(!_)return null;let x=null;return u.locale&&(x=a.parseObjectValue(u.locale,1,"locale",Rr),!x)?null:new ts(d,_,x)}evaluate(t){return new nd(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Eh(o,t,a=0,u=o.length-1,d=Bp){for(;u>a;){if(u-a>600){const R=u-a+1,L=t-a+1,F=Math.log(R),U=.5*Math.exp(2*F/3),G=.5*Math.sqrt(F*U*(R-U)/R)*(L-R/2<0?-1:1);Eh(o,t,Math.max(a,Math.floor(t-L*U/R+G)),Math.min(u,Math.floor(t+(R-L)*U/R+G)),d)}const _=o[t];let x=a,S=u;for(fc(o,a,t),d(o[u],_)>0&&fc(o,a,u);x<S;){for(fc(o,x,S),x++,S--;d(o[x],_)<0;)x++;for(;d(o[S],_)>0;)S--}d(o[a],_)===0?fc(o,a,S):(S++,fc(o,S,u)),S<=t&&(a=S+1),t<=S&&(u=S-1)}}function fc(o,t,a){const u=o[t];o[t]=o[a],o[a]=u}function Bp(o,t){return o<t?-1:o>t?1:0}function ou(o){let t=0;for(let a,u,d=0,_=o.length,x=_-1;d<_;x=d++)a=o[d],u=o[x],t+=(u.x-a.x)*(a.y+u.y);return t}function Al(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function Hu(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function r_(o,t,a){const u=o[0]-t[0],d=o[1]-t[1],_=o[0]-a[0],x=o[1]-a[1];return u*x-_*d==0&&u*_<=0&&d*x<=0}function lu(o,t,a=!1){let u=!1;for(let S=0,R=t.length;S<R;S++){const L=t[S];for(let F=0,U=L.length,G=U-1;F<U;G=F++){const X=L[G],Z=L[F];if(r_(o,X,Z))return a;(_=X)[1]>(d=o)[1]!=(x=Z)[1]>d[1]&&d[0]<(x[0]-_[0])*(d[1]-_[1])/(x[1]-_[1])+_[0]&&(u=!u)}}var d,_,x;return u}function cf(o,t,a,u){const d=u[0]-a[0],_=u[1]-a[1],x=(o[0]-a[0])*_-d*(o[1]-a[1]),S=(t[0]-a[0])*_-d*(t[1]-a[1]);return x>0&&S<0||x<0&&S>0}function ju(o,t,a,u){return(d=[u[0]-a[0],u[1]-a[1]])[0]*(_=[t[0]-o[0],t[1]-o[1]])[1]-d[1]*_[0]!=0&&!(!cf(o,t,a,u)||!cf(a,u,o,t));var d,_}function $a(o){const t=new Xt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Xt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of o[0])t.x>u.x&&(t.x=u.x),t.y>u.y&&(t.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:t,max:a}}const cu=8192;function uf(o,t){const a=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(a*d*cu),Math.round(u*d*cu)]}function hf(o,t){for(let a=0;a<t.length;a++)if(lu(o,t[a]))return!0;return!1}function Np(o,t,a){for(const u of a)for(let d=0,_=u.length,x=_-1;d<_;x=d++)if(ju(o,t,u[x],u[d]))return!0;return!1}function rl(o,t){for(let a=0;a<o.length;++a)if(!lu(o[a],t))return!1;for(let a=0;a<o.length-1;++a)if(Np(o[a],o[a+1],t))return!1;return!0}function Ah(o,t){for(let a=0;a<t.length;a++)if(rl(o,t[a]))return!0;return!1}function sl(o,t,a){const u=[];for(let d=0;d<o.length;d++){const _=[];for(let x=0;x<o[d].length;x++){const S=uf(o[d][x],a);Al(t,S),_.push(S)}u.push(_)}return u}function qu(o,t,a){const u=[];for(let d=0;d<o.length;d++){const _=sl(o[d],t,a);u.push(_)}return u}function uu(o,t,a,u){if(o[0]<a[0]||o[0]>a[2]){const d=.5*u;let _=o[0]-a[0]>d?-u:a[0]-o[0]>d?u:0;_===0&&(_=o[0]-a[2]>d?-u:a[2]-o[0]>d?u:0),o[0]+=_}Al(t,o)}function ad(o,t,a,u){const d=Math.pow(2,u.z)*cu,_=[u.x*cu,u.y*cu],x=[];if(!o)return x;for(const S of o)for(const R of S){const L=[R.x+_[0],R.y+_[1]];uu(L,t,a,d),x.push(L)}return x}function hu(o,t,a,u){const d=Math.pow(2,u.z)*cu,_=[u.x*cu,u.y*cu],x=[];if(!o)return x;for(const R of o){const L=[];for(const F of R){const U=[F.x+_[0],F.y+_[1]];Al(t,U),L.push(U)}x.push(L)}if(t[2]-t[0]<=d/2){(S=t)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const R of x)for(const L of R)uu(L,t,a,d)}var S;return x}class Xu{constructor(t,a){this.type=Zr,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(rd(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const _=u.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Xu(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Xu(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Xu(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(a,u){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if(u.type==="Polygon"){const S=sl(u.coordinates,_,x),R=ad(a.geometry(),d,_,x);if(!Hu(d,_))return!1;for(const L of R)if(!lu(L,S))return!1}if(u.type==="MultiPolygon"){const S=qu(u.coordinates,_,x),R=ad(a.geometry(),d,_,x);if(!Hu(d,_))return!1;for(const L of R)if(!hf(L,S))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(a,u){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if(u.type==="Polygon"){const S=sl(u.coordinates,_,x),R=hu(a.geometry(),d,_,x);if(!Hu(d,_))return!1;for(const L of R)if(!rl(L,S))return!1}if(u.type==="MultiPolygon"){const S=qu(u.coordinates,_,x),R=hu(a.geometry(),d,_,x);if(!Hu(d,_))return!1;for(const L of R)if(!Ah(L,S))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ff={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ho=1/298.257223563,Fp=ho*(2-ho),Ja=Math.PI/180;class dc{static fromTile(t,a,u){const d=Math.PI*(1-2*(t+.5)/Math.pow(2,a)),_=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Ja;return new dc(_,u)}static get units(){return ff}constructor(t,a){if(t===void 0)throw new Error("No latitude given.");if(a&&!ff[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(ff).join(", ")}`);const u=6378.137*Ja*(a?ff[a]:1),d=Math.cos(t*Ja),_=1/(1-Fp*(1-d*d)),x=Math.sqrt(_);this.kx=u*x*d,this.ky=u*x*_*(1-Fp)}distance(t,a){const u=al(t[0]-a[0])*this.kx,d=(t[1]-a[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(t,a){const u=al(a[0]-t[0])*this.kx;return Math.atan2(u,(a[1]-t[1])*this.ky)/Ja}destination(t,a,u){const d=u*Ja;return this.offset(t,Math.sin(d)*a,Math.cos(d)*a)}offset(t,a,u){return[t[0]+a/this.kx,t[1]+u/this.ky]}lineDistance(t){let a=0;for(let u=0;u<t.length-1;u++)a+=this.distance(t[u],t[u+1]);return a}area(t){let a=0;for(let u=0;u<t.length;u++){const d=t[u];for(let _=0,x=d.length,S=x-1;_<x;S=_++)a+=al(d[_][0]-d[S][0])*(d[_][1]+d[S][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(t,a){let u=0;if(a<=0)return t[0];for(let d=0;d<t.length-1;d++){const _=t[d],x=t[d+1],S=this.distance(_,x);if(u+=S,u>a)return Wu(_,x,(a-(u-S))/S)}return t[t.length-1]}pointToSegmentDistance(t,a,u){let[d,_]=a,x=al(u[0]-d)*this.kx,S=(u[1]-_)*this.ky;if(x!==0||S!==0){const R=(al(t[0]-d)*this.kx*x+(t[1]-_)*this.ky*S)/(x*x+S*S);R>1?(d=u[0],_=u[1]):R>0&&(d+=x/this.kx*R,_+=S/this.ky*R)}return x=al(t[0]-d)*this.kx,S=(t[1]-_)*this.ky,Math.sqrt(x*x+S*S)}pointOnLine(t,a){let u=1/0,d=t[0][0],_=t[0][1],x=0,S=0;for(let R=0;R<t.length-1;R++){let L=t[R][0],F=t[R][1],U=al(t[R+1][0]-L)*this.kx,G=(t[R+1][1]-F)*this.ky,X=0;U===0&&G===0||(X=(al(a[0]-L)*this.kx*U+(a[1]-F)*this.ky*G)/(U*U+G*G),X>1?(L=t[R+1][0],F=t[R+1][1]):X>0&&(L+=U/this.kx*X,F+=G/this.ky*X)),U=al(a[0]-L)*this.kx,G=(a[1]-F)*this.ky;const Z=U*U+G*G;Z<u&&(u=Z,d=L,_=F,x=R,S=X)}return{point:[d,_],index:x,t:Math.max(0,Math.min(1,S))}}lineSlice(t,a,u){let d=this.pointOnLine(u,t),_=this.pointOnLine(u,a);if(d.index>_.index||d.index===_.index&&d.t>_.t){const L=d;d=_,_=L}const x=[d.point],S=d.index+1,R=_.index;!fo(u[S],x[0])&&S<=R&&x.push(u[S]);for(let L=S+1;L<=R;L++)x.push(u[L]);return fo(u[R],_.point)||x.push(_.point),x}lineSliceAlong(t,a,u){let d=0;const _=[];for(let x=0;x<u.length-1;x++){const S=u[x],R=u[x+1],L=this.distance(S,R);if(d+=L,d>t&&_.length===0&&_.push(Wu(S,R,(t-(d-L))/L)),d>=a)return _.push(Wu(S,R,(a-(d-L))/L)),_;d>t&&_.push(R)}return _}bufferPoint(t,a){const u=a/this.ky,d=a/this.kx;return[t[0]-d,t[1]-u,t[0]+d,t[1]+u]}bufferBBox(t,a){const u=a/this.ky,d=a/this.kx;return[t[0]-d,t[1]-u,t[2]+d,t[3]+u]}insideBBox(t,a){return al(t[0]-a[0])>=0&&al(t[0]-a[2])<=0&&t[1]>=a[1]&&t[1]<=a[3]}}function fo(o,t){return o[0]===t[0]&&o[1]===t[1]}function Wu(o,t,a){const u=al(t[0]-o[0]);return[o[0]+u*a,o[1]+(t[1]-o[1])*a]}function al(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class fu{constructor(t=[],a=((u,d)=>u<d?-1:u>d?1:0)){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:u}=this,d=a[t];for(;t>0;){const _=t-1>>1,x=a[_];if(u(d,x)>=0)break;a[t]=x,t=_}a[t]=d}_down(t){const{data:a,compare:u}=this,d=this.length>>1,_=a[t];for(;t<d;){let x=1+(t<<1);const S=x+1;if(S<this.length&&u(a[S],a[x])<0&&(x=S),u(a[x],_)>=0)break;a[t]=a[x],t=x}a[t]=_}}var gi=8192;function df(o,t){return t.dist-o.dist}const du=100,od=50;function pf(o){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==o.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==o[a])return!1;return!0}function Lc(o){return o[1]-o[0]+1}function pu(o,t){const a=o[1]>=o[0]&&o[1]<t;return a||console.warn("Distance Expression: Index is out of range"),a}function Wo(o,t){if(o[0]>o[1])return[null,null];const a=Lc(o);if(t){if(a===2)return[o,null];const u=Math.floor(a/2);return[[o[0],o[0]+u],[o[0]+u,o[1]]]}{if(a===1)return[o,null];const u=Math.floor(a/2)-1;return[[o[0],o[0]+u],[o[0]+u+1,o[1]]]}}function Qa(o,t){const a=[1/0,1/0,-1/0,-1/0];if(!pu(t,o.length))return a;for(let u=t[0];u<=t[1];++u)Al(a,o[u]);return a}function ol(o){const t=[1/0,1/0,-1/0,-1/0];for(let a=0;a<o.length;++a)for(let u=0;u<o[a].length;++u)Al(t,o[a][u]);return t}function Ua(o,t,a){if(pf(o)||pf(t))return NaN;let u=0,d=0;return o[2]<t[0]&&(u=t[0]-o[2]),o[0]>t[2]&&(u=o[0]-t[2]),o[1]>t[3]&&(d=o[1]-t[3]),o[3]<t[1]&&(d=t[1]-o[3]),a.distance([0,0],[u,d])}function mf(o){return 360*o-180}function Zu(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ld(o,t){const a=Math.pow(2,t.z),u=(o.y/gi+t.y)/a;return[mf((o.x/gi+t.x)/a),Zu(u)]}function s_(o,t){const a=[];for(let u=0;u<o.length;++u)a.push(ld(o[u],t));return a}function Pc(o,t,a){const u=a.pointOnLine(t,o).point;return a.distance(o,u)}function Up(o,t,a,u,d){const _=a.slice(u[0],u[1]+1);let x=1/0;for(let S=t[0];S<=t[1];++S)if((x=Math.min(x,Pc(o[S],_,d)))===0)return 0;return x}function eo(o,t,a,u,d){const _=Math.min(d.pointToSegmentDistance(o,a,u),d.pointToSegmentDistance(t,a,u)),x=Math.min(d.pointToSegmentDistance(a,o,t),d.pointToSegmentDistance(u,o,t));return Math.min(_,x)}function ur(o,t,a,u,d){if(!pu(t,o.length)||!pu(u,a.length))return NaN;let _=1/0;for(let x=t[0];x<t[1];++x)for(let S=u[0];S<u[1];++S){if(ju(o[x],o[x+1],a[S],a[S+1]))return 0;_=Math.min(_,eo(o[x],o[x+1],a[S],a[S+1],d))}return _}function cd(o,t,a,u,d){if(!pu(t,o.length)||!pu(u,a.length))return NaN;let _=1/0;for(let x=t[0];x<=t[1];++x)for(let S=u[0];S<=u[1];++S)if((_=Math.min(_,d.distance(o[x],a[S])))===0)return _;return _}function kp(o,t,a){if(lu(o,t,!0))return 0;let u=1/0;for(const d of t){const _=d.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[_-1]&&(u=Math.min(u,a.pointToSegmentDistance(o,d[_-1],d[0])))===0||(u=Math.min(u,Pc(o,d,a)))===0)return u}return u}function Yd(o,t,a,u){if(!pu(t,o.length))return NaN;for(let _=t[0];_<=t[1];++_)if(lu(o[_],a,!0))return 0;let d=1/0;for(let _=t[0];_<t[1];++_)for(const x of a)for(let S=0,R=x.length,L=R-1;S<R;L=S++){if(ju(o[_],o[_+1],x[L],x[S]))return 0;d=Math.min(d,eo(o[_],o[_+1],x[L],x[S],u))}return d}function Cl(o,t){for(const a of o)for(let u=0;u<=a.length-1;++u)if(lu(a[u],t,!0))return!0;return!1}function Xl(o,t,a,u=1/0){const d=ol(o),_=ol(t);if(u!==1/0&&Ua(d,_,a)>=u)return u;if(Hu(d,_)){if(Cl(o,t))return 0}else if(Cl(t,o))return 0;let x=u;for(const S of o)for(let R=0,L=S.length,F=L-1;R<L;F=R++)for(const U of t)for(let G=0,X=U.length,Z=X-1;G<X;Z=G++){if(ju(S[F],S[R],U[Z],U[G]))return 0;x=Math.min(x,eo(S[F],S[R],U[Z],U[G],a))}return x}function ns(o,t,a,u,d,_,x){if(_===null||x===null)return;const S=Ua(Qa(u,_),Qa(d,x),a);S<t&&o.push({dist:S,range1:_,range2:x})}function Yu(o,t,a,u,d=1/0){let _=Math.min(u.distance(o[0],a[0][0]),d);if(_===0)return _;const x=new fu([{dist:0,range1:[0,o.length-1],range2:[0,0]}],df),S=t?od:du,R=ol(a);for(;x.length;){const L=x.pop();if(L.dist>=_)continue;const F=L.range1;if(Lc(F)<=S){if(!pu(F,o.length))return NaN;if(t){const U=Yd(o,F,a,u);if((_=Math.min(_,U))===0)return _}else for(let U=F[0];U<=F[1];++U){const G=kp(o[U],a,u);if((_=Math.min(_,G))===0)return _}}else{const U=Wo(F,t);if(U[0]!==null){const G=Ua(Qa(o,U[0]),R,u);G<_&&x.push({dist:G,range1:U[0],range2:[0,0]})}if(U[1]!==null){const G=Ua(Qa(o,U[1]),R,u);G<_&&x.push({dist:G,range1:U[1],range2:[0,0]})}}}return _}function mu(o,t,a,u,d,_=1/0){let x=Math.min(_,d.distance(o[0],a[0]));if(x===0)return x;const S=new fu([{dist:0,range1:[0,o.length-1],range2:[0,a.length-1]}],df),R=t?od:du,L=u?od:du;for(;S.length;){const F=S.pop();if(F.dist>=x)continue;const U=F.range1,G=F.range2;if(Lc(U)<=R&&Lc(G)<=L){if(!pu(U,o.length)||!pu(G,a.length))return NaN;if(t&&u?x=Math.min(x,ur(o,U,a,G,d)):t||u?t&&!u?x=Math.min(x,Up(a,G,o,U,d)):!t&&u&&(x=Math.min(x,Up(o,U,a,G,d))):x=Math.min(x,cd(o,U,a,G,d)),x===0)return x}else{const X=Wo(U,t),Z=Wo(G,u);ns(S,x,d,o,a,X[0],Z[0]),ns(S,x,d,o,a,X[0],Z[1]),ns(S,x,d,o,a,X[1],Z[0]),ns(S,x,d,o,a,X[1],Z[1])}}return x}function gu(o,t,a,u,d=1/0){let _=d;const x=Qa(o,[0,o.length-1]);for(const S of a)if(!(_!==1/0&&Ua(x,Qa(S,[0,S.length-1]),u)>=_)&&(_=Math.min(_,mu(o,t,S,!0,u,_)),_===0))return _;return _}function Kd(o,t,a,u,d=1/0){let _=d;const x=Qa(o,[0,o.length-1]);for(const S of a){if(_!==1/0&&Ua(x,ol(S),u)>=_)continue;const R=Yu(o,t,S,u,_);if(isNaN(R))return R;if((_=Math.min(_,R))===0)return _}return _}function $d(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Wl{constructor(t,a){this.type=hn,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(rd(t[1])){const u=t[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if($d(u.features[d].geometry.type))return new Wl(u,u.features[d].geometry)}else if(u.type==="Feature"){if($d(u.geometry.type))return new Wl(u,u.geometry)}else if($d(u.type))return new Wl(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const a=t.geometry(),u=t.canonicalID();if(a!=null&&u!=null){if(t.geometryType()==="Point")return(function(d,_,x){const S=[];for(const L of d)for(const F of L)S.push(ld(F,_));const R=new dc(S[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?mu(S,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",R):x.type==="MultiLineString"?gu(S,!1,x.coordinates,R):x.type==="Polygon"||x.type==="MultiPolygon"?Kd(S,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,R):null})(a,u,this.geometries);if(t.geometryType()==="LineString")return(function(d,_,x){const S=[];for(const L of d){const F=[];for(const U of L)F.push(ld(U,_));S.push(F)}const R=new dc(S[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return gu(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",S,R);if(x.type==="MultiLineString"){let L=1/0;for(let F=0;F<x.coordinates.length;F++){const U=gu(x.coordinates[F],!0,S,R,L);if(isNaN(U))return U;if((L=Math.min(L,U))===0)return L}return L}if(x.type==="Polygon"||x.type==="MultiPolygon"){let L=1/0;for(let F=0;F<S.length;F++){const U=Kd(S[F],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,R,L);if(isNaN(U))return U;if((L=Math.min(L,U))===0)return L}return L}return null})(a,u,this.geometries);if(t.geometryType()==="Polygon")return(function(d,_,x){const S=[];for(const L of(function(F,U){const G=F.length;if(G<=1)return[F];const X=[];let Z,ne;for(let he=0;he<G;he++){const ce=ou(F[he]);ce!==0&&(F[he].area=Math.abs(ce),ne===void 0&&(ne=ce<0),ne===ce<0?(Z&&X.push(Z),Z=[F[he]]):Z.push(F[he]))}return Z&&X.push(Z),X})(d)){const F=[];for(let U=0;U<L.length;++U)F.push(s_(L[U],_));S.push(F)}const R=new dc(S[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Kd(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",S,R);if(x.type==="MultiLineString"){let L=1/0;for(let F=0;F<x.coordinates.length;F++){const U=Kd(x.coordinates[F],!0,S,R,L);if(isNaN(U))return U;if((L=Math.min(L,U))===0)return L}return L}return x.type==="Polygon"||x.type==="MultiPolygon"?(function(L,F,U){let G=1/0;for(const X of L)for(const Z of F){const ne=Xl(X,Z,U,G);if(isNaN(ne))return ne;if((G=Math.min(G,ne))===0)return G}return G})(x.type==="Polygon"?[x.coordinates]:x.coordinates,S,R):null})(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ku(o){if(o instanceof Xo&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Xu||o instanceof Wl)return!1;if(o instanceof Ch)return o.featureConstant;let t=!0;return o.eachChild((a=>{t&&!Ku(a)&&(t=!1)})),t}function Xa(o){if(o instanceof Xo&&o.name==="feature-state")return!1;let t=!0;return o.eachChild((a=>{t&&!Xa(a)&&(t=!1)})),t}function ea(o,t){if(o instanceof Xo&&t.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild((u=>{a&&!ea(u,t)&&(a=!1)})),a}function zs(o,t,a){return[o,t,a].filter(Boolean).join("")}function _u(o,t){switch(o){case"string":return jl(t);case"number":return+t;case"boolean":return!!t;case"color":return qr.parse(t);case"formatted":return xo.fromString(jl(t));case"resolvedImage":return Fa.build(jl(t))}return t}function vo(o,t,a,u){return u!==void 0&&(o=u*Math.round(o/u)),t!==void 0&&o<t&&(o=t),a!==void 0&&o>a&&(o=a),o}class Ch{constructor(t,a,u,d=!1){this.type=t,this.key=a,this.scope=u,this.featureConstant=d}static parse(t,a){let u=a.expectedType;if(u==null&&(u=Xr),t.length<2||t.length>3)return a.error("Invalid number of arguments for 'config' expression.");const d=a.parse(t[1],1);if(!(d instanceof Dc))return a.error("Key name of 'config' expression must be a string literal.");let _,x=!0;const S=jl(d.value);if(t.length>=3){const R=a.parse(t[2],2);if(!(R instanceof Dc))return a.error("Scope of 'config' expression must be a string literal.");_=jl(R.value)}if(a.options){const R=zs(S,_,a._scope),L=a.options.get(R);L&&(x=Ku(L.value||L.default))}return new Ch(u,S,_,x)}evaluate(t){const a=zs(this.key,this.scope,t.scope),u=t.getConfig(a);if(!u)return null;const{type:d,value:_,values:x,minValue:S,maxValue:R,stepValue:L}=u,F=u.default.evaluate(t);let U=F;if(_){const G=t.scope;t.scope=(G||"").split("").slice(1).join(""),U=_.evaluate(t),t.scope=G}return d&&(U=_u(d,U)),U===void 0||S===void 0&&R===void 0&&L===void 0||(typeof U=="number"?U=vo(U,S,R,L):Array.isArray(U)&&(U=U.map((G=>typeof G=="number"?vo(G,S,R,L):G)))),_!==void 0&&U!==void 0&&x&&!x.includes(U)&&(U=F,d&&(U=_u(d,U))),(d&&d!==this.type||U!==void 0&&!uo(Xs(U),this.type))&&(U=_u(this.type.kind,U)),U}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class ws{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=t[1];return a.scope.has(u)?new ws(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ud{constructor(t,a=[],u,d=new Nu,_=[],x,S,R){this.registry=t,this.path=a,this.key=a.map((L=>typeof L=="string"?`['${L}']`:`[${L}]`)).join(""),this.scope=d,this.errors=_,this.expectedType=u,this._scope=x,this.options=S,this.iconImageUseTheme=R}parse(t,a,u,d,_={}){return a||u?this.concat(a,null,u,d)._parse(t,_):this._parse(t,_)}parseObjectValue(t,a,u,d,_,x={}){return this.concat(a,u,d,_)._parse(t,x)}_parse(t,a){function u(d,_,x){return x==="assert"?new hc(_,[d]):x==="coerce"?new ql(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(d){let _=d.parse(t,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,S=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||S.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(x,S))return null}else _=u(_,x,a.typeAnnotation||"coerce");else _=u(_,x,a.typeAnnotation||"assert")}if(!(_ instanceof Dc)&&_.type.kind!=="resolvedImage"&&Um(_)){const x=new Op(this._scope,this.options,this.iconImageUseTheme);try{_=new Dc(_.type,_.evaluate(x))}catch(S){return this.error(S.message),null}}return _}return ql.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,u,d){let _=typeof t=="number"?this.path.concat(t):this.path;_=typeof a=="string"?_.concat(a):_;const x=d?this.scope.concat(d):this.scope;return new ud(this.registry,_,u||null,x,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(t,...a){const u=`${this.key}${a.map((d=>`[${d}]`)).join("")}`;this.errors.push(new cc(u,t))}checkSubtype(t,a){const u=Gl(t,a);return u&&this.error(u),u}}function Um(o){if(o instanceof ws)return Um(o.boundExpression);if(o instanceof Xo&&o.name==="error"||o instanceof ts||o instanceof Xu||o instanceof Wl||o instanceof Ch)return!1;const t=o instanceof ql||o instanceof hc;let a=!0;return o.eachChild((u=>{a=t?a&&Um(u):a&&u instanceof Dc})),!!a&&Ku(o)&&ea(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function $u(o,t){const a=o.length-1;let u,d,_=0,x=a,S=0;for(;_<=x;)if(S=Math.floor((_+x)/2),u=o[S],d=o[S+1],u<=t){if(S===a||t<d)return S;_=S+1}else{if(!(u>t))throw new ua("Input is not a number.");x=S-1}return 0}class yu{constructor(t,a,u){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[d,_]of u)this.labels.push(d),this.outputs.push(_)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(t[1],1,hn);if(!u)return null;const d=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let x=1;x<t.length;x+=2){const S=x===1?-1/0:t[x],R=t[x+1],L=x,F=x+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(d.length&&d[d.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const U=a.parse(R,F,_);if(!U)return null;_=_||U.type,d.push([S,U])}return new yu(_,u,d)}evaluate(t){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return u[0].evaluate(t);const _=a.length;return d>=a[_-1]?u[_-1].evaluate(t):u[$u(a,d)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t}}const km=.95047,Jd=1.08883,Vm=4/29,Zl=6/29,Zo=3*Zl*Zl,Rh=Zl*Zl*Zl,zc=Math.PI/180,Ih=180/Math.PI;function Qd(o){return o>Rh?Math.pow(o,1/3):o/Zo+Vm}function Ju(o){return o>Zl?o*o*o:Zo*(o-Vm)}function gf(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Dh(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function bo(o){const t=Dh(o.r),a=Dh(o.g),u=Dh(o.b),d=Qd((.4124564*t+.3575761*a+.1804375*u)/km),_=Qd((.2126729*t+.7151522*a+.072175*u)/1);return{l:116*_-16,a:500*(d-_),b:200*(_-Qd((.0193339*t+.119192*a+.9503041*u)/Jd)),alpha:o.a}}function _f(o){let t=(o.l+16)/116,a=isNaN(o.a)?t:t+o.a/500,u=isNaN(o.b)?t:t-o.b/200;return t=1*Ju(t),a=km*Ju(a),u=Jd*Ju(u),new qr(gf(3.2404542*a-1.5371385*t-.4985314*u),gf(-.969266*a+1.8760108*t+.041556*u),gf(.0556434*a-.2040259*t+1.0572252*u),o.alpha)}function ep(o,t,a){const u=t-o;return o+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const hd={forward:bo,reverse:_f,interpolate:function(o,t,a){return{l:Rn(o.l,t.l,a),a:Rn(o.a,t.a,a),b:Rn(o.b,t.b,a),alpha:Rn(o.alpha,t.alpha,a)}}},tp={forward:function(o){const{l:t,a,b:u}=bo(o),d=Math.atan2(u,a)*Ih;return{h:d<0?d+360:d,c:Math.sqrt(a*a+u*u),l:t,alpha:o.a}},reverse:function(o){const t=o.h*zc,a=o.c;return _f({l:o.l,a:Math.cos(t)*a,b:Math.sin(t)*a,alpha:o.alpha})},interpolate:function(o,t,a){return{h:ep(o.h,t.h,a),c:Rn(o.c,t.c,a),l:Rn(o.l,t.l,a),alpha:Rn(o.alpha,t.alpha,a)}}};var Gm=Object.freeze({__proto__:null,hcl:tp,lab:hd});class nr{constructor(t,a,u,d,_){this.type=t,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[x,S]of _)this.labels.push(x),this.outputs.push(S)}static interpolationFactor(t,a,u,d){let _=0;if(t.name==="exponential")_=ip(a,t.base,u,d);else if(t.name==="linear")_=ip(a,1,u,d);else if(t.name==="cubic-bezier"){const x=t.controlPoints;_=new Ts(x[0],x[1],x[2],x[3]).solve(ip(a,1,u,d))}return _}static parse(t,a){let[u,d,_,...x]=t;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const L=d[1];if(typeof L!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:L}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const L=d.slice(1);if(L.length!==4||L.some((F=>typeof F!="number"||F<0||F>1)))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:L}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,hn),!_)return null;const S=[];let R=null;u==="interpolate-hcl"||u==="interpolate-lab"?R=nl:a.expectedType&&a.expectedType.kind!=="value"&&(R=a.expectedType);for(let L=0;L<x.length;L+=2){const F=x[L],U=x[L+1],G=L+3,X=L+4;if(typeof F!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(S.length&&S[S.length-1][0]>=F)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const Z=a.parse(U,X,R);if(!Z)return null;R=R||Z.type,S.push([F,Z])}return R.kind==="number"||R.kind==="color"||R.kind==="array"&&R.itemType.kind==="number"&&typeof R.N=="number"?new nr(R,u,d,_,S):a.error(`Type ${ca(R)} is not interpolatable.`)}evaluate(t){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return u[0].evaluate(t);const _=a.length;if(d>=a[_-1])return u[_-1].evaluate(t);const x=$u(a,d),S=nr.interpolationFactor(this.interpolation,d,a[x],a[x+1]),R=u[x].evaluate(t),L=u[x+1].evaluate(t);return this.operator==="interpolate"?id[this.type.kind.toLowerCase()](R,L,S):this.operator==="interpolate-hcl"?tp.reverse(tp.interpolate(tp.forward(R),tp.forward(L),S)):hd.reverse(hd.interpolate(hd.forward(R),hd.forward(L),S))}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function ip(o,t,a,u){const d=u-a,_=o-a;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}class to{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&d.kind!=="value"&&(u=d);const _=[];for(const S of t.slice(1)){const R=a.parse(S,1+_.length,u,void 0,{typeAnnotation:"omit"});if(!R)return null;u=u||R.type,_.push(R)}const x=d&&_.some((S=>Gl(d,S.type)));return new to(x?Xr:u,_)}evaluate(t){let a,u=null,d=0;for(const _ of this.args){if(d++,u=_.evaluate(t),u&&u instanceof Fa&&!u.available&&(a||(a=u),u=null,d===this.args.length))return a;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((a=>{t.push(a.serialize())})),t}}class Rl{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let _=1;_<t.length-1;_+=2){const x=t[_];if(typeof x!="string")return a.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const S=a.parse(t[_+1],_+1);if(!S)return null;u.push([x,S])}const d=a.parse(t[t.length-1],t.length-1,a.expectedType,u);return d?new Rl(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[a,u]of this.bindings)t.push(a,u.serialize());return t.push(this.result.serialize()),t}}class np{constructor(t,a,u){this.type=t,this.index=a,this.input=u}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,hn),d=a.parse(t[2],2,ba(a.expectedType||Xr));return u&&d?new np(d.type.itemType,u,d):null}evaluate(t){const a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new ua("Array index out of bounds: negative index");if(a>=u.length)throw new ua("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new ua("Array index must be an integer. Use at-interpolated for fractional indices");return u[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Oc{constructor(t,a,u){this.type=t,this.index=a,this.input=u}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,hn),d=a.parse(t[2],2,ba(a.expectedType||Xr));return u&&d?new Oc(d.type.itemType,u,d):null}evaluate(t){const a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new ua(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new ua(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];const d=Math.floor(a),_=Math.ceil(a),x=u[d],S=u[_];if(typeof x!="number"||typeof S!="number")throw new ua(`Cannot interpolate between non-number values at index ${a}.`);const R=a-d;return x*(1-R)+S*R}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class pc{constructor(t,a){this.type=Zr,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,Xr),d=a.parse(t[2],2,Xr);return u&&d?Fu(u.type,[Zr,Rr,hn,uc,Xr])?new pc(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ca(u.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!au(a,["boolean","string","number","null"]))throw new ua(`Expected first argument to be of type boolean, string, number or null, but found ${ca(Xs(a))} instead.`);if(!au(u,["string","array"]))throw new ua(`Expected second argument to be of type array or string, but found ${ca(Xs(u))} instead.`);return u.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class xu{constructor(t,a,u){this.type=hn,this.needle=t,this.haystack=a,this.fromIndex=u}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,Xr),d=a.parse(t[2],2,Xr);if(!u||!d)return null;if(!Fu(u.type,[Zr,Rr,hn,uc,Xr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ca(u.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,hn);return _?new xu(u,d,_):null}return new xu(u,d)}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!au(a,["boolean","string","number","null"]))throw new ua(`Expected first argument to be of type boolean, string, number or null, but found ${ca(Xs(a))} instead.`);if(!au(u,["string","array"]))throw new ua(`Expected second argument to be of type array or string, but found ${ca(Xs(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fd{constructor(t,a,u,d,_,x){this.inputType=t,this.type=a,this.input=u,this.cases=d,this.outputs=_,this.otherwise=x}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const _={},x=[];for(let L=2;L<t.length-1;L+=2){let F=t[L];const U=t[L+1];Array.isArray(F)||(F=[F]);const G=a.concat(L);if(F.length===0)return G.error("Expected at least one branch label.");for(const Z of F){if(typeof Z!="number"&&typeof Z!="string")return G.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return G.error("Numeric branch labels must be integer values.");if(u){if(G.checkSubtype(u,Xs(Z)))return null}else u=Xs(Z);if(_[String(Z)]!==void 0)return G.error("Branch labels must be unique.");_[String(Z)]=x.length}const X=a.parse(U,L,d);if(!X)return null;d=d||X.type,x.push(X)}const S=a.parse(t[1],1,Xr);if(!S)return null;const R=a.parse(t[t.length-1],t.length-1,d);return R?S.type.kind!=="value"&&a.concat(1).checkSubtype(u,S.type)?null:new fd(u,d,S,_,x,R):null}evaluate(t){const a=this.input.evaluate(t);return(uo(Xs(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],d={};for(const x of a){const S=d[this.cases[x]];S===void 0?(d[this.cases[x]]=u.length,u.push([this.cases[x],[x]])):u[S][1].push(x)}const _=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,S]of u)t.push(S.length===1?_(S[0]):S.map(_)),t.push(this.outputs[x].serialize());return t.push(this.otherwise.serialize()),t}}class dd{constructor(t,a,u){this.type=t,this.branches=a,this.otherwise=u}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const d=[];for(let x=1;x<t.length-1;x+=2){const S=a.parse(t[x],x,Zr);if(!S)return null;const R=a.parse(t[x+1],x+1,u);if(!R)return null;d.push([S,R]),u=u||R.type}const _=a.parse(t[t.length-1],t.length-1,u);return _?new dd(u,d,_):null}evaluate(t){for(const[a,u]of this.branches)if(a.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,u]of this.branches)t(a),t(u);t(this.otherwise)}outputDefined(){return this.branches.every((([t,a])=>a.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((a=>{t.push(a.serialize())})),t}}class Vp{constructor(t,a,u,d){this.type=t,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,Xr),d=a.parse(t[2],2,hn);if(!u||!d)return null;if(!Fu(u.type,[ba(Xr),Rr,Xr]))return a.error(`Expected first argument to be of type array or string, but found ${ca(u.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,hn);return _?new Vp(u.type,u,d,_):null}return new Vp(u.type,u,d)}evaluate(t){const a=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!au(a,["string","array"]))throw new ua(`Expected first argument to be of type array or string, but found ${ca(Xs(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return a.slice(u,d)}return a.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Qu{constructor(t,a){this.type=ba(Rr),this.str=t,this.delimiter=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,Rr),d=a.parse(t[2],2,Rr);return u&&d?new Qu(u,d):void 0}evaluate(t){const a=this.str.evaluate(t),u=this.delimiter.evaluate(t);return a.split(u)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Bc(o,t){return o==="=="||o==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function yf(o,t,a,u){return u.compare(t,a)===0}function Lh(o,t,a){const u=o!=="=="&&o!=="!=";return class CV{constructor(_,x,S){this.type=Zr,this.lhs=_,this.rhs=x,this.collator=S,this.hasUntypedArgument=_.type.kind==="value"||x.type.kind==="value"}static parse(_,x){if(_.length!==3&&_.length!==4)return x.error("Expected two or three arguments.");const S=_[0];let R=x.parse(_[1],1,Xr);if(!R)return null;if(!Bc(S,R.type))return x.concat(1).error(`"${S}" comparisons are not supported for type '${ca(R.type)}'.`);let L=x.parse(_[2],2,Xr);if(!L)return null;if(!Bc(S,L.type))return x.concat(2).error(`"${S}" comparisons are not supported for type '${ca(L.type)}'.`);if(R.type.kind!==L.type.kind&&R.type.kind!=="value"&&L.type.kind!=="value")return x.error(`Cannot compare types '${ca(R.type)}' and '${ca(L.type)}'.`);u&&(R.type.kind==="value"&&L.type.kind!=="value"?R=new hc(L.type,[R]):R.type.kind!=="value"&&L.type.kind==="value"&&(L=new hc(R.type,[L])));let F=null;if(_.length===4){if(R.type.kind!=="string"&&L.type.kind!=="string"&&R.type.kind!=="value"&&L.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(F=x.parse(_[3],3,Fm),!F)return null}return new CV(R,L,F)}evaluate(_){const x=this.lhs.evaluate(_),S=this.rhs.evaluate(_);if(u&&this.hasUntypedArgument){const R=Xs(x),L=Xs(S);if(R.kind!==L.kind||R.kind!=="string"&&R.kind!=="number")throw new ua(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${R.kind}, ${L.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const R=Xs(x),L=Xs(S);if(R.kind!=="string"||L.kind!=="string")return t(_,x,S)}return this.collator?a(_,x,S,this.collator.evaluate(_)):t(_,x,S)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[o];return this.eachChild((x=>{_.push(x.serialize())})),_}}}const xf=Lh("==",(function(o,t,a){return t===a}),yf),Gp=Lh("!=",(function(o,t,a){return t!==a}),(function(o,t,a,u){return!yf(0,t,a,u)})),Nc=Lh("<",(function(o,t,a){return t<a}),(function(o,t,a,u){return u.compare(t,a)<0})),rp=Lh(">",(function(o,t,a){return t>a}),(function(o,t,a,u){return u.compare(t,a)>0})),Hp=Lh("<=",(function(o,t,a){return t<=a}),(function(o,t,a,u){return u.compare(t,a)<=0})),xg=Lh(">=",(function(o,t,a){return t>=a}),(function(o,t,a,u){return u.compare(t,a)>=0}));class eh{constructor(t,a,u,d,_,x){this.type=Rr,this.number=t,this.locale=a,this.currency=u,this.unit=d,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const u=a.parse(t[1],1,hn);if(!u)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=a.parseObjectValue(d.locale,2,"locale",Rr),!_))return null;let x=null;if(d.currency&&(x=a.parseObjectValue(d.currency,2,"currency",Rr),!x))return null;let S=null;if(d.unit&&(S=a.parseObjectValue(d.unit,2,"unit",Rr),!S))return null;let R=null;if(d["min-fraction-digits"]&&(R=a.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",hn),!R))return null;let L=null;return d["max-fraction-digits"]&&(L=a.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",hn),!L)?null:new eh(u,_,x,S,R,L)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Vr{constructor(t){this.type=hn,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=a.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${ca(u.type)} instead.`):new Vr(u):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ua(`Expected value to be of type string or array, but found ${ca(Xs(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((a=>{t.push(a.serialize())})),t}}function jp(o){return function(){o=1831565813+(o|=0)|0;let t=Math.imul(o^o>>>15,1|o);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const vf={"==":xf,"!=":Gp,">":rp,"<":Nc,">=":xg,"<=":Hp,array:hc,at:np,"at-interpolated":Oc,boolean:hc,case:dd,coalesce:to,collator:ts,format:El,image:$n,in:pc,"index-of":xu,interpolate:nr,"interpolate-hcl":nr,"interpolate-lab":nr,length:Vr,let:Rl,literal:Dc,match:fd,number:hc,"number-format":eh,object:hc,slice:Vp,step:yu,string:hc,"to-boolean":ql,"to-color":ql,"to-number":ql,"to-string":ql,var:ws,within:Xu,distance:Wl,config:Ch,split:Qu};function th(o,[t,a,u,d]){t=t.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const _=d?d.evaluate(o):1,x=Uu(t,a,u,_);if(x)throw new ua(x);return new qr(t/255,a/255,u/255,_)}function ih(o,[t,a,u,d]){t=t.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const _=d?d.evaluate(o):1,x=(function(L,F,U,G){return typeof L=="number"&&L>=0&&L<=360?typeof F=="number"&&F>=0&&F<=100&&typeof U=="number"&&U>=0&&U<=100?G===void 0||typeof G=="number"&&G>=0&&G<=1?null:`Invalid hsla value [${[L,F,U,G].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof G=="number"?[L,F,U,G]:[L,F,U]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof G=="number"?[L,F,U,G]:[L,F,U]).join(", ")}]: 'h' must be between 0 and 360.`})(t,a,u,_);if(x)throw new ua(x);const S=`hsla(${t}, ${a}%, ${u}%, ${_})`,R=qr.parse(S);if(!R)throw new ua(`Failed to parse HSLA color: ${S}`);return R}function qp(o,t){return o in t}function pd(o,t){const a=t[o];return a===void 0?null:a}function Fc(o){return{type:o}}function Uc(o){if(o instanceof Ch)return new Set([o.key]);let t=new Set;return o.eachChild((a=>{t=new Set([...t,...Uc(a)])})),t}function nh(o){if(o instanceof Xo&&o.name==="is-active-floor")return!0;let t=!1;return o.eachChild((a=>{!t&&nh(a)&&(t=!0)})),t}function vg(o){return{result:"success",value:o}}function Il(o){return{result:"error",value:o}}function Xp(o,t){return!!o&&!!o.parameters&&o.parameters.indexOf(t)>-1}function md(o){return o["property-type"]==="data-driven"}function vu(o){return Xp(o.expression,"measure-light")}function rh(o){return Xp(o.expression,"zoom")}function bu(o){return!!o.expression&&o.expression.interpolated}function gd(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Hm(o){return o}function sp(o,t){const a=t.type==="color",u=o.stops&&typeof o.stops[0][0]=="object",d=u||!(u||o.property!==void 0),_=o.type||(bu(t)?"exponential":"interval");if(a&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map((L=>[L[0],qr.parse(L[1])]))),o.default=qr.parse(o.default?o.default:t.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Gm[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let x,S,R;if(_==="exponential")x=Yl;else if(_==="interval")x=Yo;else if(_==="categorical"){x=sh,S=Object.create(null);for(const L of o.stops)S[L[0]]=L[1];R=typeof o.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);x=cl}if(u){const L={},F=[];for(let X=0;X<o.stops.length;X++){const Z=o.stops[X],ne=Z[0].zoom;L[ne]===void 0&&(L[ne]={zoom:ne,type:o.type,property:o.property,default:o.default,stops:[]},F.push(ne)),L[ne].stops.push([Z[0].value,Z[1]])}const U=[];for(const X of F)U.push([L[X].zoom,sp(L[X],t)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:nr.interpolationFactor.bind(void 0,G),zoomStops:U.map((X=>X[0])),evaluate:({zoom:X},Z)=>Yl({stops:U,base:o.base},t,X).evaluate(X,Z)}}if(d){const L=_==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:nr.interpolationFactor.bind(void 0,L),zoomStops:o.stops.map((F=>F[0])),evaluate:({zoom:F})=>x(o,t,F,S,R)}}return{kind:"source",evaluate(L,F){const U=F&&F.properties?F.properties[o.property]:void 0;return U===void 0?ll(o.default,t.default):x(o,t,U,S,R)}}}function ll(o,t,a){return o!==void 0?o:t!==void 0?t:a!==void 0?a:void 0}function sh(o,t,a,u,d){return ll(typeof a===d?u[a]:void 0,o.default,t.default)}function Yo(o,t,a){if(!sd(a))return ll(o.default,t.default);const u=o.stops.length;if(u===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[u-1][0])return o.stops[u-1][1];const d=$u(o.stops.map((_=>_[0])),a);return o.stops[d][1]}function Yl(o,t,a){const u=o.base!==void 0?o.base:1;if(!sd(a))return ll(o.default,t.default);const d=o.stops.length;if(d===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[d-1][0])return o.stops[d-1][1];const _=$u(o.stops.map((F=>F[0])),a),x=(function(F,U,G,X){const Z=X-G,ne=F-G;return Z===0?0:U===1?ne/Z:(Math.pow(U,ne)-1)/(Math.pow(U,Z)-1)})(a,u,o.stops[_][0],o.stops[_+1][0]),S=o.stops[_][1],R=o.stops[_+1][1];let L=id[t.type]||Hm;if(o.colorSpace&&o.colorSpace!=="rgb"){const F=Gm[o.colorSpace];L=(U,G)=>F.reverse(F.interpolate(F.forward(U),F.forward(G),x))}return typeof S.evaluate=="function"?{evaluate(...F){const U=S.evaluate.apply(void 0,F),G=R.evaluate.apply(void 0,F);if(U!==void 0&&G!==void 0)return L(U,G,x)}}:L(S,R,x)}function cl(o,t,a){return t.type==="color"?a=qr.parse(a):t.type==="formatted"?a=xo.fromString(a.toString()):t.type==="resolvedImage"?a=Fa.build(a.toString()):sn(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0),ll(a,o.default,t.default)}Xo.register(vf,{error:[{kind:"error"},[Rr],(o,[t])=>{throw new ua(t.evaluate(o))}],typeof:[Rr,[Xr],(o,[t])=>ca(Xs(t.evaluate(o)))],"to-rgba":[ba(hn,4),[nl],(o,[t])=>t.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ba(hn,4),[nl],(o,[t])=>t.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[nl,[hn,hn,hn],th],rgba:[nl,[hn,hn,hn,hn],th],hsl:[nl,[hn,hn,hn],ih],hsla:[nl,[hn,hn,hn,hn],ih],has:{type:Zr,overloads:[[[Rr],(o,[t])=>qp(t.evaluate(o),o.properties())],[[Rr,zo],(o,[t,a])=>qp(t.evaluate(o),a.evaluate(o))]]},get:{type:Xr,overloads:[[[Rr],(o,[t])=>pd(t.evaluate(o),o.properties())],[[Rr,zo],(o,[t,a])=>pd(t.evaluate(o),a.evaluate(o))]]},"feature-state":[Xr,[Rr],(o,[t])=>pd(t.evaluate(o),o.featureState||{})],properties:[zo,[],o=>o.properties()],"geometry-type":[Rr,[],o=>o.geometryType()],worldview:[Rr,[],o=>o.globals.worldview||""],"is-active-floor":[Zr,Fc(Rr),(o,t)=>{if(!(o.globals.activeFloors&&o.globals.activeFloors.size>0))return!1;const a=o.globals.activeFloors;return t.some((u=>{const d=u.evaluate(o);return a.has(d)}))}],id:[Xr,[],o=>o.id()],zoom:[hn,[],o=>o.globals.zoom],pitch:[hn,[],o=>o.globals.pitch||0],"distance-from-center":[hn,[],o=>o.distanceFromCenter()],"measure-light":[hn,[Rr],(o,[t])=>o.measureLight(t.evaluate(o))],"heatmap-density":[hn,[],o=>o.globals.heatmapDensity||0],"line-progress":[hn,[],o=>o.globals.lineProgress||0],"raster-value":[hn,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[hn,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[hn,[],o=>o.globals.skyRadialProgress||0],accumulated:[Xr,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[hn,Fc(hn),(o,t)=>{let a=0;for(const u of t)a+=u.evaluate(o);return a}],"*":[hn,Fc(hn),(o,t)=>{let a=1;for(const u of t)a*=u.evaluate(o);return a}],"-":{type:hn,overloads:[[[hn,hn],(o,[t,a])=>t.evaluate(o)-a.evaluate(o)],[[hn],(o,[t])=>-t.evaluate(o)]]},"/":[hn,[hn,hn],(o,[t,a])=>t.evaluate(o)/a.evaluate(o)],"%":[hn,[hn,hn],(o,[t,a])=>t.evaluate(o)%a.evaluate(o)],ln2:[hn,[],()=>Math.LN2],pi:[hn,[],()=>Math.PI],e:[hn,[],()=>Math.E],"^":[hn,[hn,hn],(o,[t,a])=>Math.pow(t.evaluate(o),a.evaluate(o))],sqrt:[hn,[hn],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[hn,[hn],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[hn,[hn],(o,[t])=>Math.log(t.evaluate(o))],log2:[hn,[hn],(o,[t])=>Math.log2(t.evaluate(o))],sin:[hn,[hn],(o,[t])=>Math.sin(t.evaluate(o))],cos:[hn,[hn],(o,[t])=>Math.cos(t.evaluate(o))],tan:[hn,[hn],(o,[t])=>Math.tan(t.evaluate(o))],asin:[hn,[hn],(o,[t])=>Math.asin(t.evaluate(o))],acos:[hn,[hn],(o,[t])=>Math.acos(t.evaluate(o))],atan:[hn,[hn],(o,[t])=>Math.atan(t.evaluate(o))],min:[hn,Fc(hn),(o,t)=>Math.min(...t.map((a=>a.evaluate(o))))],max:[hn,Fc(hn),(o,t)=>Math.max(...t.map((a=>a.evaluate(o))))],abs:[hn,[hn],(o,[t])=>Math.abs(t.evaluate(o))],round:[hn,[hn],(o,[t])=>{const a=t.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[hn,[hn],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[hn,[hn],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[Zr,[Rr,Xr],(o,[t,a])=>o.properties()[t.value]===a.value],"filter-id-==":[Zr,[Xr],(o,[t])=>o.id()===t.value],"filter-type-==":[Zr,[Rr],(o,[t])=>o.geometryType()===t.value],"filter-<":[Zr,[Rr,Xr],(o,[t,a])=>{const u=o.properties()[t.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Zr,[Xr],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a<u}],"filter->":[Zr,[Rr,Xr],(o,[t,a])=>{const u=o.properties()[t.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[Zr,[Xr],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a>u}],"filter-<=":[Zr,[Rr,Xr],(o,[t,a])=>{const u=o.properties()[t.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Zr,[Xr],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a<=u}],"filter->=":[Zr,[Rr,Xr],(o,[t,a])=>{const u=o.properties()[t.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Zr,[Xr],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a>=u}],"filter-has":[Zr,[Xr],(o,[t])=>t.value in o.properties()],"filter-has-id":[Zr,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Zr,[ba(Rr)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[Zr,[ba(Xr)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[Zr,[Rr,ba(Xr)],(o,[t,a])=>a.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[Zr,[Rr,ba(Xr)],(o,[t,a])=>(function(u,d,_,x){for(;_<=x;){const S=_+x>>1;if(d[S]===u)return!0;d[S]>u?x=S-1:_=S+1}return!1})(o.properties()[t.value],a.value,0,a.value.length-1)],all:{type:Zr,overloads:[[[Zr,Zr],(o,[t,a])=>t.evaluate(o)&&a.evaluate(o)],[Fc(Zr),(o,t)=>{for(const a of t)if(!a.evaluate(o))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],(o,[t,a])=>t.evaluate(o)||a.evaluate(o)],[Fc(Zr),(o,t)=>{for(const a of t)if(a.evaluate(o))return!0;return!1}]]},"!":[Zr,[Zr],(o,[t])=>!t.evaluate(o)],"is-supported-script":[Zr,[Rr],(o,[t])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(t.evaluate(o))}],upcase:[Rr,[Rr],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Rr,[Rr],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Rr,Fc(Xr),(o,t)=>t.map((a=>jl(a.evaluate(o)))).join("")],"resolved-locale":[Rr,[Fm],(o,[t])=>t.evaluate(o).resolvedLocale()],random:[hn,[hn,hn,Xr],(o,t)=>{const[a,u,d]=t.map((x=>x.evaluate(o)));if(a>u||a===u)return a;let _;if(typeof d=="string")_=(function(x){let S=0;if(x.length===0)return S;for(let R=0;R<x.length;R++)S=(S<<5)-S+x.charCodeAt(R),S|=0;return S})(d);else{if(typeof d!="number")throw new ua(`Invalid seed input: ${d}`);_=d}return a+jp(_)()*(u-a)}]});class ap{constructor(t,a,u,d,_){this.expression=t,this._warningHistory={},this._scope=u,this._options=d,this._iconImageUseTheme=_,this._evaluator=new Op(u,d,_),this._defaultValue=a?(function(x){return x.type==="color"&&(gd(x.default)||Array.isArray(x.default))?new qr(0,0,0,0):x.type==="color"?qr.parse(x.default)||null:x.default===void 0?null:x.default})(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=Uc(t),this.isIndoorDependent=nh(t)}evaluateWithoutErrorHandling(t,a,u,d,_,x,S,R){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=R||null,this.expression.evaluate(this._evaluator)}evaluate(t,a,u,d,_,x,S,R,L){this._evaluator||(this._evaluator=new Op(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=R||null,this._evaluator.iconImageUseTheme=L||null;try{const F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new ua(`Expected value to be one of ${Object.keys(this._enumValues).map((U=>JSON.stringify(U))).join(", ")}, but found ${JSON.stringify(F)} instead.`);return F}catch(F){const U=F;return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${U.message}`)),this._defaultValue}}}function _d(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in vf}function ka(o,t,a,u,d){const _=new ud(vf,[],t?(function(S){const R={color:nl,string:Rr,number:hn,enum:Rr,boolean:Zr,formatted:Wd,resolvedImage:Ic};return S.type==="array"?ba(R[S.value]||Xr,S.length):R[S.type]})(t):void 0,void 0,void 0,a,u,d),x=_.parse(o,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?vg(new ap(x,t,a,u,d)):Il(_.errors)}class La{constructor(t,a,u,d){this.kind=t,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=t!=="constant"&&!Xa(a.expression),this.configDependencies=Uc(a.expression),this.isIndoorDependent=nh(a.expression)}evaluateWithoutErrorHandling(t,a,u,d,_,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,d,_,x)}evaluate(t,a,u,d,_,x,S){return this._styleExpression.evaluate(t,a,u,d,_,x,void 0,void 0,S)}}class Oo{constructor(t,a,u,d,_,x){this.kind=t,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Xa(a.expression),this.isIndoorDependent=nh(a.expression),this.isLightConstant=_,this.isLineProgressConstant=x,this.configDependencies=Uc(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,a,u,d,_,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,d,_,x)}evaluate(t,a,u,d,_,x){return this._styleExpression.evaluate(t,a,u,d,_,x)}interpolationFactor(t,a,u){return this.interpolationType?nr.interpolationFactor(this.interpolationType,t,a,u):0}}function ah(o,t,a,u,d){if((o=ka(o,t,a,u,d)).result==="error")return o;const _=o.value.expression,x=Ku(_);if(!x&&!md(t))return Il([new cc("","data expressions not supported")]);const S=ea(_,["zoom","pitch","distance-from-center"]);if(!S&&!rh(t))return Il([new cc("","zoom expressions not supported")]);const R=ea(_,["measure-light"]);if(!R&&!vu(t))return Il([new cc("","measure-light expression not supported")]);const L=ea(_,["line-progress"]);if(!L&&!(function(G){return Xp(G.expression,"line-progress")})(t))return Il([new cc("","line-progress expression not supported")]);const F=t.expression&&t.expression.relaxZoomRestriction,U=kc(_);return U||S||F?U instanceof cc?Il([U]):U instanceof nr&&!bu(t)?Il([new cc("",'"interpolate" expressions cannot be used with this property')]):vg(U?new Oo(x&&L?"camera":"composite",o.value,U.labels,U instanceof nr?U.interpolation:void 0,R,L):new La(x&&L?"constant":"source",o.value,R,L)):Il([new cc("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class op{constructor(t,a){this._parameters=t,this._specification=a,Object.assign(this,sp(this._parameters,this._specification))}static deserialize(t){return new op(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function kc(o){let t=null;if(o instanceof Rl)t=kc(o.result);else if(o instanceof to){for(const a of o.args)if(t=kc(a),t)break}else(o instanceof yu||o instanceof nr)&&o.input instanceof Xo&&o.input.name==="zoom"&&(t=o);return t instanceof cc||o.eachChild((a=>{const u=kc(a);u instanceof cc?t=u:t&&u&&t!==u&&(t=new cc("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var wu,Kl,Va=(function(){if(Kl)return wu;Kl=1,wu=t;var o=3;function t(a,u,d){var _=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var x=new Int32Array(this.arrayBuffer);a=x[0],this.d=(u=x[1])+2*(d=x[2]);for(var S=0;S<this.d*this.d;S++){var R=x[o+S],L=x[o+S+1];_.push(R===L?null:x.subarray(R,L))}var F=x[o+_.length+1];this.keys=x.subarray(x[o+_.length],F),this.bboxes=x.subarray(F),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var U=0;U<this.d*this.d;U++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=d,this.scale=u/a,this.uid=0;var G=d/u*a;this.min=-G,this.max=a+G}return t.prototype.insert=function(a,u,d,_,x){this._forEachCell(u,d,_,x,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(a,u,d,_,x,S){this.cells[x].push(S)},t.prototype.query=function(a,u,d,_,x){var S=this.min,R=this.max;if(a<=S&&u<=S&&R<=d&&R<=_&&!x)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(a,u,d,_,this._queryCell,L,{},x),L},t.prototype._queryCell=function(a,u,d,_,x,S,R,L){var F=this.cells[x];if(F!==null)for(var U=this.keys,G=this.bboxes,X=0;X<F.length;X++){var Z=F[X];if(R[Z]===void 0){var ne=4*Z;(L?L(G[ne+0],G[ne+1],G[ne+2],G[ne+3]):a<=G[ne+2]&&u<=G[ne+3]&&d>=G[ne+0]&&_>=G[ne+1])?(R[Z]=!0,S.push(U[Z])):R[Z]=!1}}},t.prototype._forEachCell=function(a,u,d,_,x,S,R,L){for(var F=this._convertToCellCoord(a),U=this._convertToCellCoord(u),G=this._convertToCellCoord(d),X=this._convertToCellCoord(_),Z=F;Z<=G;Z++)for(var ne=U;ne<=X;ne++){var he=this.d*ne+Z;if((!L||L(this._convertFromCellCoord(Z),this._convertFromCellCoord(ne),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(ne+1)))&&x.call(this,a,u,d,_,he,S,R,L))return}},t.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},t.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=o+this.cells.length+1+1,d=0,_=0;_<this.cells.length;_++)d+=this.cells[_].length;var x=new Int32Array(u+d+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var S=u,R=0;R<a.length;R++){var L=a[R];x[o+R]=S,x.set(L,S),S+=L.length}return x[o+a.length]=S,x.set(this.keys,S),x[o+a.length+1]=S+=this.keys.length,x.set(this.bboxes,S),S+=this.bboxes.length,x.buffer},wu})(),Ph=Dr(Va);const po={};function oi(o,t,a={}){Object.defineProperty(o,"_classRegistryKey",{value:t,writable:!1}),po[t]={klass:o,omit:a.omit||[]}}oi(Object,"Object"),Ph.serialize=function(o,t){const a=o.toArrayBuffer();return t&&t.add(a),{buffer:a}},Ph.deserialize=function(o){return new Ph(o.buffer)},Object.defineProperty(Ph,"name",{value:"Grid"}),oi(Ph,"Grid"),delete Xt.prototype.constructor,oi(qr,"Color"),oi(Error,"Error"),oi(xo,"Formatted"),oi(Zd,"FormattedSection"),oi(Na,"AJAXError"),oi(Fa,"ResolvedImage"),oi(op,"StylePropertyFunction"),oi(ap,"StyleExpression",{omit:["_evaluator"]}),oi(Po,"ImageId"),oi(Hl,"ImageVariant"),oi(Oo,"ZoomDependentExpression"),oi(La,"ZoomConstantExpression"),oi(Xo,"CompoundExpression",{omit:["_evaluate"]});for(const o in vf)po[vf[o]._classRegistryKey]||oi(vf[o],`Expression${o}`);function Js(o){return o&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ha(o,t){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Js(o)||o instanceof ImageBitmap)return t&&t.add(o),o;if(ArrayBuffer.isView(o))return t&&t.add(o.buffer),o;if(o instanceof ImageData)return t&&t.add(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const u of o)a.push(ha(u,t));return a}if(o instanceof Map){const a={$name:"Map",entries:[]};for(const[u,d]of o.entries())a.entries.push(ha(u),ha(d,t));return a}if(o instanceof Set){const a={$name:"Set"};let u=0;for(const d of o.values())a[++u]=ha(d);return a}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const a=o.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const d=a.serialize?a.serialize(o,t):{};if(!a.serialize){for(const _ in o)o.hasOwnProperty(_)&&(po[u].omit.indexOf(_)>=0||(d[_]=ha(o[_],t)));o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof o)}function Su(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Js(o)||o instanceof ImageBitmap||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Su);if(typeof o=="object"){const t=o.$name||"Object";if(t==="Map"){const d=o.entries||[],_=new Map;for(let x=0;x<d.length;x+=2)_.set(Su(d[x]),Su(d[x+1]));return _}if(t==="Set"){const d=new Set;for(const _ of Object.keys(o))_!=="$name"&&d.add(Su(o[_]));return d}if(t==="BigInt")return BigInt(o.value);const{klass:a}=po[t];if(!a)throw new Error(`Can't deserialize unregistered class "${t}".`);if(a.deserialize)return a.deserialize(o);const u=Object.create(a.prototype);for(const d of Object.keys(o))d!=="$name"&&(u[d]=Su(o[d]));return u}throw new Error("can't deserialize object of type "+typeof o)}const gn={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Tu(o){for(const t of o)if(mc(t.charCodeAt(0)))return!0;return!1}function lp(o){for(const t of o)if(!cp(t.charCodeAt(0)))return!1;return!0}function cp(o){return!(gn.Arabic(o)||gn["Arabic Supplement"](o)||gn["Arabic Extended-A"](o)||gn["Arabic Presentation Forms-A"](o)||gn["Arabic Presentation Forms-B"](o))}function mc(o){return!(o!==746&&o!==747&&(o<4352||!(gn["Bopomofo Extended"](o)||gn.Bopomofo(o)||gn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||gn["CJK Compatibility Ideographs"](o)||gn["CJK Compatibility"](o)||gn["CJK Radicals Supplement"](o)||gn["CJK Strokes"](o)||!(!gn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||gn["CJK Unified Ideographs Extension A"](o)||gn["CJK Unified Ideographs"](o)||gn["Enclosed CJK Letters and Months"](o)||gn["Hangul Compatibility Jamo"](o)||gn["Hangul Jamo Extended-A"](o)||gn["Hangul Jamo Extended-B"](o)||gn["Hangul Jamo"](o)||gn["Hangul Syllables"](o)||gn.Hiragana(o)||gn["Ideographic Description Characters"](o)||gn.Kanbun(o)||gn["Kangxi Radicals"](o)||gn["Katakana Phonetic Extensions"](o)||gn.Katakana(o)&&o!==12540||!(!gn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!gn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||gn["Unified Canadian Aboriginal Syllabics"](o)||gn["Unified Canadian Aboriginal Syllabics Extended"](o)||gn["Vertical Forms"](o)||gn["Yijing Hexagram Symbols"](o)||gn["Yi Syllables"](o)||gn["Yi Radicals"](o))))}function jm(o){return!(mc(o)||(function(t){return!!(gn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||gn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||gn["Letterlike Symbols"](t)||gn["Number Forms"](t)||gn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||gn["Control Pictures"](t)&&t!==9251||gn["Optical Character Recognition"](t)||gn["Enclosed Alphanumerics"](t)||gn["Geometric Shapes"](t)||gn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||gn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||gn["CJK Symbols and Punctuation"](t)||gn.Katakana(t)||gn["Private Use Area"](t)||gn["CJK Compatibility Forms"](t)||gn["Small Form Variants"](t)||gn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(o))}function Ea(o){return gn.Arabic(o)||gn["Arabic Supplement"](o)||gn["Arabic Extended-A"](o)||gn["Arabic Presentation Forms-A"](o)||gn["Arabic Presentation Forms-B"](o)}function Wp(o){return o>=1424&&o<=2303||gn["Arabic Presentation Forms-A"](o)||gn["Arabic Presentation Forms-B"](o)}function Mu(o,t){return!(!t&&Wp(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||gn.Khmer(o))}function a_(o){for(const t of o)if(Wp(t.charCodeAt(0)))return!0;return!1}const Dl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let bg=null,Bo=Dl.unavailable,Eu=null;const yd=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Bo=Dl.error),bg&&bg(o)};function No(){Pa.fire(new Ml("pluginStateChange",{pluginStatus:Bo,pluginURL:Eu}))}const Pa=new of,zh=function(){return Bo},up=function(){if(Bo!==Dl.deferred||!Eu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bo=Dl.loading,No(),Eu&&il({url:Eu},(o=>{o?yd(o):(Bo=Dl.loaded,No())}))},Vc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Bo===Dl.loaded||Vc.applyArabicShaping!=null,isLoading:()=>Bo===Dl.loading,setState(o){Bo=o.pluginStatus,Eu=o.pluginURL},isParsing:()=>Bo===Dl.parsing,isParsed:()=>Bo===Dl.parsed,getPluginURL:()=>Eu};class ms{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return(function(a,u){for(const d of a)if(!Mu(d.charCodeAt(0),u))return!1;return!0})(t,Vc.isLoaded())}}class Gc{constructor(t,a,u,d,_){this.property=t,this.value=a,this.expression=(function(x,S,R,L,F){if(gd(x))return new op(x,S);if(_d(x)||Array.isArray(x)&&x.length>0){const U=ah(x,S,R,L,F);if(U.result==="error")throw new Error(U.value.map((G=>`${G.key}: ${G.message}`)).join(", "));return U.value}{let U=x;return typeof x=="string"&&S.type==="color"&&(U=qr.parse(x)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>U}}})(a===void 0?t.specification.default:a,t.specification,u,d,_)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,u,d){return this.property.possiblyEvaluate(this,t,a,u,d)}}class hp{constructor(t,a,u,d){this.property=t,this.value=new Gc(t,void 0,a,u,d)}transitioned(t,a){return new Zp(this.property,this.value,a,Object.assign({},t.transition,this.transition),t.now)}untransitioned(){return new Zp(this.property,this.value,null,{},0)}}class qm{constructor(t,a,u,d){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return ye(this._values[t].value.value)}setValue(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new hp(this._values[t].property,this._scope,this._options,this._iconImageUseTheme)),this._values[t].value=new Gc(this._values[t].property,a===null?void 0:ye(a),this._scope,this._options,this._iconImageUseTheme),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].value.isIndoorDependent())}setTransitionOrValue(t,a){a&&(this._options=a);const u=this._properties.properties;if(t)for(const d in t){const _=t[d];if(d.endsWith("-transition")){const x=d.slice(0,-11);u[x]&&this.setTransition(x,_)}else u.hasOwnProperty(d)&&this.setValue(d,_)}}getTransition(t){return ye(this._values[t].transition)}setTransition(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new hp(this._values[t].property)),this._values[t].transition=ye(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(t[a]=u);const d=this.getTransition(a);d!==void 0&&(t[`${a}-transition`]=d)}return t}transitioned(t,a){const u=new Xm(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(t,a._values[d]);return u}untransitioned(){const t=new Xm(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}isIndoorDependent(){return this._isIndoorDependent}}class Zp{constructor(t,a,u,d,_){const x=d.delay||0,S=d.duration||0;_=_||0,this.property=t,this.value=a,this.begin=_+x,this.end=this.begin+S,t.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(t,a,u){const d=t.now||0,_=this.value.possiblyEvaluate(t,a,u),x=this.prior;if(x){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return x.possiblyEvaluate(t,a,u);{const S=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,a,u),_,Lo(S))}}return _}}class Xm{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,u){const d=new Bh(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,a,u);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class wg{constructor(t,a,u,d){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(t){return ye(this._values[t].value)}setValue(t,a){this._values[t]=new Gc(this._values[t].property,a===null?void 0:ye(a),this._scope,this._options,this._iconImageUseTheme),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[t].isIndoorDependent())}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(t[a]=u)}return t}possiblyEvaluate(t,a,u,d){const _=new Bh(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(t,a,u,d);return _}isIndoorDependent(){return this._isIndoorDependent}}class Oh{constructor(t,a,u,d){this.property=t,this.value=a,this.parameters=u,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,u,d){return this.property.evaluate(this.value,this.parameters,t,a,u,d,this.iconImageUseTheme)}}class Bh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class fi{constructor(t){this.specification=t}possiblyEvaluate(t,a){return t.expression.evaluate(a)}interpolate(t,a,u){const d=id[this.specification.type];return d?d(t,a,u):t}}class Mi{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,u,d,_){return t.expression.kind==="constant"||t.expression.kind==="camera"?new Oh(this,{kind:"constant",value:t.expression.evaluate(a,null,{},u,d,void 0,_)},a):new Oh(this,t.expression,a,_)}interpolate(t,a,u){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new Oh(this,{kind:"constant",value:void 0},t.parameters);const d=id[this.specification.type];return d?new Oh(this,{kind:"constant",value:d(t.value.value,a.value.value,u)},t.parameters):t}evaluate(t,a,u,d,_,x,S){return t.kind==="constant"?t.value:t.evaluate(a,u,d,_,x,void 0,S)}}class Au{constructor(t){this.specification=t}possiblyEvaluate(t,a,u,d){return!!t.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class Ys{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new ms(0,{});for(const u in t){const d=t[u];d.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new Gc(d,void 0),x=this.defaultTransitionablePropertyValues[u]=new hp(d);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate(a)}}}oi(Mi,"DataDrivenProperty"),oi(fi,"DataConstantProperty"),oi(Au,"ColorRampProperty");var dt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Sg(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Yp(o){if(Array.isArray(o))return o.map(Yp);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const a in o)t[a]=Yp(o[a]);return t}return Sg(o)}function Hc(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!Hc(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function xd(o,t="",a=null,u="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hc(o)||(o=Kp(o));const d=o;let _=!0;try{_=(function(F){if(!vd(F))return F;let U=Yp(F);return Tg(U),U=bf(U),U})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let x=null,S=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){S=dt[`filter_${u}`];const F=ka(_,S,t,a);if(F.result==="error")throw new Error(F.value.map((U=>`${U.key}: ${U.message}`)).join(", "));x=(U,G,X)=>F.value.evaluate(U,G,{},X)}let R=null,L=null;if(_!==d){const F=ka(d,S,t,a);if(F.result==="error")throw new Error(F.value.map((U=>`${U.key}: ${U.message}`)).join(", "));R=(U,G,X,Z,ne)=>F.value.evaluate(U,G,{},X,void 0,void 0,Z,ne),L=!Ku(F.value.expression)}return{filter:x,dynamicFilter:R||void 0,needGeometry:c_(_),needFeature:!!L}}function bf(o){if(!Array.isArray(o))return o;const t=(function(a){if(o_.has(a[0])){for(let u=1;u<a.length;u++)if(vd(a[u]))return!0}return a})(o);return t===!0?t:t.map((a=>bf(a)))}function Tg(o){let t=!1;const a=[];if(o[0]==="case"){for(let u=1;u<o.length-1;u+=2)t=t||vd(o[u]),a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="match"){t=t||vd(o[1]);for(let u=2;u<o.length-1;u+=2)a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="step"){t=t||vd(o[1]);for(let u=1;u<o.length-1;u+=2)a.push(o[u+1])}t&&(o.length=0,o.push("any",...a));for(let u=1;u<o.length;u++)Tg(o[u])}function vd(o){if(!Array.isArray(o))return!1;if((t=o[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let a=1;a<o.length;a++)if(vd(o[a]))return!0;return!1}const o_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function l_(o,t){return o<t?-1:o>t?1:0}function c_(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let t=1;t<o.length;t++)if(c_(o[t]))return!0;return!1}function Kp(o){if(!o)return!0;const t=o[0];return o.length<=1?t!=="any":t==="=="?Nh(o[1],o[2],"=="):t==="!="?wf(Nh(o[1],o[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Nh(o[1],o[2],t):t==="any"?(a=o.slice(1),["any"].concat(a.map(Kp))):t==="all"?["all"].concat(o.slice(1).map(Kp)):t==="none"?["all"].concat(o.slice(1).map(Kp).map(wf)):t==="in"?$p(o[1],o.slice(2)):t==="!in"?wf($p(o[1],o.slice(2))):t==="has"?bd(o[1]):t!=="!has"||wf(bd(o[1]));var a}function Nh(o,t,a){switch(o){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,o,t]}}function $p(o,t){if(t.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((a=>typeof a!=typeof t[0]))?["filter-in-large",o,["literal",t.sort(l_)]]:["filter-in-small",o,["literal",t]]}}function bd(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function wf(o){return["!",o]}const Sf="";function gc(o,t){return t?`${o}${Sf}${t}`:o}let Mg;const Eg=()=>Mg||(Mg=new Ys({"icon-size":new Mi(dt.layout_symbol["icon-size"]),"icon-image":new Mi(dt.layout_symbol["icon-image"]),"icon-rotate":new Mi(dt.layout_symbol["icon-rotate"]),"icon-offset":new Mi(dt.layout_symbol["icon-offset"]),"text-size":new Mi(dt.layout_symbol["text-size"]),"text-rotate":new Mi(dt.layout_symbol["text-rotate"]),"text-offset":new Mi(dt.layout_symbol["text-offset"])}));class Ag{constructor(t,a,u,d,_,x){const S=ka(t,dt.appearance.condition);if(S.result==="success"&&(this.condition=S.value),this.name=a,u){this.properties=new Bh(Eg()),this.unevaluatedLayout=new wg(Eg(),d,_,x);for(const R in u)this.unevaluatedLayout.setValue(R,u[R])}}isActive(t){return!(this.condition||!t.isHidden||this.name!=="hidden")||this.condition.evaluate(t.globals,t.feature,t.featureState,t.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(t){return this.properties.get(t)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(t){return this.unevaluatedLayout._values[t]}recalculate(t,a,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(t,void 0,a,u))}serialize(){const t={};return t.condition=this.condition.expression.serialize(),this.name&&(t.name=this.name),this.unevaluatedLayout&&(t.properties=this.unevaluatedLayout.serialize()),t}hasIconProperties(){const t=this.hasProperty("icon-image"),a=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return t||a||u||d}hasTextProperties(){const t=this.hasProperty("text-size"),a=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return t||a||u}hasProperty(t){return this.getUnevaluatedProperty(t).value!==void 0}}const $l="-transition",jc=new Set(["fill","line","background","hillshade","raster"]);class wo extends of{constructor(t,a,u,d,_,x){if(super(),this.id=t.id,this.fqid=gc(this.id,u),this.type=t.type,this.scope=u,this.lut=d,this.options=_,this.iconImageUseTheme=x,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const S=ka(this.filter,dt[`filter_${t.type}`]);S.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...S.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||S.value.isIndoorDependent)}if(t.slot&&(this.slot=t.slot),t.appearances&&this.setAppearances(t.appearances),a.layout&&(this._unevaluatedLayout=new wg(a.layout,this.scope,_,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new qm(a.paint,this.scope,_);for(const S in t.paint)this.setPaintProperty(S,t.paint[S]);for(const S in t.layout)this.setLayoutProperty(S,t.layout[S]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bh(a.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&jc.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a){if(this.type==="custom"&&t==="visibility")return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[t]&&(u.setValue(t,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),t==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(t){this.appearances=[],t.forEach((a=>{this.appearances.push(new Ag(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith($l)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}isPaintProperty(t){return!!this._transitionablePaint._properties.properties[t]}setPaintProperty(t,a){const u=this._transitionablePaint,d=u._properties.properties;if(t.endsWith($l)){const U=t.slice(0,-11);return d[U]&&u.setTransition(U,a||void 0),!1}if(!d[t])return!1;const _=u._values[t],x=_.value.isDataDriven(),S=_.value;u.setValue(t,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(t);const R=u._values[t].value,L=R.isDataDriven(),F=t.endsWith("pattern")||t==="line-dasharray";return L||x||F||this._handleOverridablePaintPropertyUpdate(t,S,R)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,a,u){return null}_handleOverridablePaintPropertyUpdate(t,a,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(t.appearances=this.appearances.map((a=>a.serialize()))),Wt(t,((a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length)))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof Oh&&md(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const t of this.appearances)if(!Xa(t.condition.expression))return!0;return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=xd(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(t,a,u){return{}}queryRadius(t){}queryIntersectsFeature(t,a,u,d,_,x,S,R,L){}}const Jp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wd{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Cg=new ArrayBuffer(0);class Ms{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(t,a){return t._trim(),a&&t.arrayBuffer&&a.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,t.arrayBuffer?a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement:(a.capacity=0,a.arrayBuffer=Cg),a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this._reallocCount++,this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}reserveForAdditional(t){this.reserve(this.length+t)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function vr(o,t=1){let a=0,u=0;return{members:o.map((d=>{const _=Jp[d.type].BYTES_PER_ELEMENT,x=a=Wm(a,Math.max(t,_)),S=d.components||1;return u=Math.max(u,_),a+=_*S,{name:d.name,type:d.type,components:S,offset:x}})),size:Wm(a,Math.max(u,t)),alignment:t}}function Wm(o,t){return Math.ceil(o/t)*t}class Tf extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.int16[d+0]=a,this.int16[d+1]=u,t}}Tf.prototype.bytesPerElement=4,oi(Tf,"StructArrayLayout2i4");class Mf extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=3*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.int16[_+2]=d,t}}Mf.prototype.bytesPerElement=6,oi(Mf,"StructArrayLayout3i6");class Sd extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const x=4*t;return this.int16[x+0]=a,this.int16[x+1]=u,this.int16[x+2]=d,this.int16[x+3]=_,t}}Sd.prototype.bytesPerElement=8,oi(Sd,"StructArrayLayout4i8");class Cu extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}Cu.prototype.bytesPerElement=4,oi(Cu,"StructArrayLayout1f4");class Qp extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=4*t,x=2*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.float32[x+1]=d,t}}Qp.prototype.bytesPerElement=8,oi(Qp,"StructArrayLayout2i1f8");class So extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=4*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.int16[_+2]=d,t}}So.prototype.bytesPerElement=8,oi(So,"StructArrayLayout3i8");class em extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,_)}emplace(t,a,u,d,_,x){const S=5*t;return this.int16[S+0]=a,this.int16[S+1]=u,this.int16[S+2]=d,this.int16[S+3]=_,this.int16[S+4]=x,t}}em.prototype.bytesPerElement=10,oi(em,"StructArrayLayout5i10");class Zm extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S){const R=this.length;return this.resize(R+1),this.emplace(R,t,a,u,d,_,x,S)}emplace(t,a,u,d,_,x,S,R){const L=6*t,F=12*t,U=3*t;return this.int16[L+0]=a,this.int16[L+1]=u,this.uint8[F+4]=d,this.uint8[F+5]=_,this.uint8[F+6]=x,this.uint8[F+7]=S,this.float32[U+2]=R,t}}Zm.prototype.bytesPerElement=12,oi(Zm,"StructArrayLayout2i4ub1f12");class _c extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=3*t;return this.float32[_+0]=a,this.float32[_+1]=u,this.float32[_+2]=d,t}}_c.prototype.bytesPerElement=12,oi(_c,"StructArrayLayout3f12");class ul extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,_)}emplace(t,a,u,d,_,x){const S=6*t,R=3*t;return this.uint16[S+0]=a,this.uint16[S+1]=u,this.uint16[S+2]=d,this.uint16[S+3]=_,this.float32[R+2]=x,t}}ul.prototype.bytesPerElement=12,oi(ul,"StructArrayLayout4ui1f12");class qc extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const x=4*t;return this.uint16[x+0]=a,this.uint16[x+1]=u,this.uint16[x+2]=d,this.uint16[x+3]=_,t}}qc.prototype.bytesPerElement=8,oi(qc,"StructArrayLayout4ui8");class Ef extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,x)}emplace(t,a,u,d,_,x,S){const R=6*t;return this.int16[R+0]=a,this.int16[R+1]=u,this.int16[R+2]=d,this.int16[R+3]=_,this.int16[R+4]=x,this.int16[R+5]=S,t}}Ef.prototype.bytesPerElement=12,oi(Ef,"StructArrayLayout6i12");class Ru extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L,F,U,G){const X=this.length;return this.resize(X+1),this.emplace(X,t,a,u,d,_,x,S,R,L,F,U,G)}emplace(t,a,u,d,_,x,S,R,L,F,U,G,X){const Z=12*t;return this.int16[Z+0]=a,this.int16[Z+1]=u,this.int16[Z+2]=d,this.int16[Z+3]=_,this.uint16[Z+4]=x,this.uint16[Z+5]=S,this.uint16[Z+6]=R,this.uint16[Z+7]=L,this.int16[Z+8]=F,this.int16[Z+9]=U,this.int16[Z+10]=G,this.int16[Z+11]=X,t}}Ru.prototype.bytesPerElement=24,oi(Ru,"StructArrayLayout4i4ui4i24");class Fh extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,x)}emplace(t,a,u,d,_,x,S){const R=10*t,L=5*t;return this.int16[R+0]=a,this.int16[R+1]=u,this.int16[R+2]=d,this.float32[L+2]=_,this.float32[L+3]=x,this.float32[L+4]=S,t}}Fh.prototype.bytesPerElement=20,oi(Fh,"StructArrayLayout3i3f20");class io extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const x=4*t;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=d,this.float32[x+3]=_,t}}io.prototype.bytesPerElement=16,oi(io,"StructArrayLayout4f16");class Af extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}Af.prototype.bytesPerElement=4,oi(Af,"StructArrayLayout1ul4");class Jl extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.uint16[d+0]=a,this.uint16[d+1]=u,t}}Jl.prototype.bytesPerElement=4,oi(Jl,"StructArrayLayout2ui4");class Uh extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L,F,U,G,X){const Z=this.length;return this.resize(Z+1),this.emplace(Z,t,a,u,d,_,x,S,R,L,F,U,G,X)}emplace(t,a,u,d,_,x,S,R,L,F,U,G,X,Z){const ne=20*t,he=10*t;return this.int16[ne+0]=a,this.int16[ne+1]=u,this.int16[ne+2]=d,this.int16[ne+3]=_,this.int16[ne+4]=x,this.float32[he+3]=S,this.float32[he+4]=R,this.float32[he+5]=L,this.float32[he+6]=F,this.int16[ne+14]=U,this.uint32[he+8]=G,this.uint16[ne+18]=X,this.uint16[ne+19]=Z,t}}Uh.prototype.bytesPerElement=40,oi(Uh,"StructArrayLayout5i4f1i1ul2ui40");class Cf extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S){const R=this.length;return this.resize(R+1),this.emplace(R,t,a,u,d,_,x,S)}emplace(t,a,u,d,_,x,S,R){const L=8*t;return this.int16[L+0]=a,this.int16[L+1]=u,this.int16[L+2]=d,this.int16[L+4]=_,this.int16[L+5]=x,this.int16[L+6]=S,this.int16[L+7]=R,t}}Cf.prototype.bytesPerElement=16,oi(Cf,"StructArrayLayout3i2i2i16");class kh extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,_)}emplace(t,a,u,d,_,x){const S=4*t,R=8*t;return this.float32[S+0]=a,this.float32[S+1]=u,this.float32[S+2]=d,this.int16[R+6]=_,this.int16[R+7]=x,t}}kh.prototype.bytesPerElement=16,oi(kh,"StructArrayLayout2f1f2i16");class Td extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,x)}emplace(t,a,u,d,_,x,S){const R=20*t,L=5*t;return this.uint8[R+0]=a,this.uint8[R+1]=u,this.float32[L+1]=d,this.float32[L+2]=_,this.float32[L+3]=x,this.float32[L+4]=S,t}}Td.prototype.bytesPerElement=20,oi(Td,"StructArrayLayout2ub4f20");class Aa extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=3*t;return this.uint16[_+0]=a,this.uint16[_+1]=u,this.uint16[_+2]=d,t}}Aa.prototype.bytesPerElement=6,oi(Aa,"StructArrayLayout3ui6");class Md extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke){const Be=this.length;return this.resize(Be+1),this.emplace(Be,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke)}emplace(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke,Be){const He=30*t,Je=15*t,tt=60*t;return this.int16[He+0]=a,this.int16[He+1]=u,this.int16[He+2]=d,this.float32[Je+2]=_,this.float32[Je+3]=x,this.uint16[He+8]=S,this.uint16[He+9]=R,this.uint32[Je+5]=L,this.uint32[Je+6]=F,this.uint32[Je+7]=U,this.uint16[He+16]=G,this.uint16[He+17]=X,this.uint16[He+18]=Z,this.float32[Je+10]=ne,this.float32[Je+11]=he,this.uint8[tt+48]=ce,this.uint8[tt+49]=_e,this.uint8[tt+50]=xe,this.uint32[Je+13]=Ee,this.int16[He+28]=ke,this.uint8[tt+58]=Be,t}}Md.prototype.bytesPerElement=60,oi(Md,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class To extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke,Be,He,Je,tt,It,ut,Ot,Zt,Yt,li,ui,ri){const si=this.length;return this.resize(si+1),this.emplace(si,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke,Be,He,Je,tt,It,ut,Ot,Zt,Yt,li,ui,ri)}emplace(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke,Be,He,Je,tt,It,ut,Ot,Zt,Yt,li,ui,ri,si){const zt=20*t,Dt=40*t,ai=80*t;return this.float32[zt+0]=a,this.float32[zt+1]=u,this.int16[Dt+4]=d,this.int16[Dt+5]=_,this.int16[Dt+6]=x,this.int16[Dt+7]=S,this.int16[Dt+8]=R,this.int16[Dt+9]=L,this.int16[Dt+10]=F,this.int16[Dt+11]=U,this.int16[Dt+12]=G,this.uint16[Dt+13]=X,this.uint16[Dt+14]=Z,this.uint16[Dt+15]=ne,this.uint16[Dt+16]=he,this.uint16[Dt+17]=ce,this.uint16[Dt+18]=_e,this.uint16[Dt+19]=xe,this.uint16[Dt+20]=Ee,this.uint16[Dt+21]=ke,this.uint16[Dt+22]=Be,this.uint16[Dt+23]=He,this.uint16[Dt+24]=Je,this.uint16[Dt+25]=tt,this.uint16[Dt+26]=It,this.uint16[Dt+27]=ut,this.uint32[zt+14]=Ot,this.float32[zt+15]=Zt,this.float32[zt+16]=Yt,this.float32[zt+17]=li,this.float32[zt+18]=ui,this.uint8[ai+76]=ri,this.uint16[Dt+39]=si,t}}To.prototype.bytesPerElement=80,oi(To,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class tm extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,x)}emplace(t,a,u,d,_,x,S){const R=6*t;return this.float32[R+0]=a,this.float32[R+1]=u,this.float32[R+2]=d,this.float32[R+3]=_,this.float32[R+4]=x,this.float32[R+5]=S,t}}tm.prototype.bytesPerElement=24,oi(tm,"StructArrayLayout6f24");class Rf extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,_)}emplace(t,a,u,d,_,x){const S=5*t;return this.float32[S+0]=a,this.float32[S+1]=u,this.float32[S+2]=d,this.float32[S+3]=_,this.float32[S+4]=x,t}}Rf.prototype.bytesPerElement=20,oi(Rf,"StructArrayLayout5f20");class fp extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S){const R=this.length;return this.resize(R+1),this.emplace(R,t,a,u,d,_,x,S)}emplace(t,a,u,d,_,x,S,R){const L=7*t;return this.float32[L+0]=a,this.float32[L+1]=u,this.float32[L+2]=d,this.float32[L+3]=_,this.float32[L+4]=x,this.float32[L+5]=S,this.float32[L+6]=R,t}}fp.prototype.bytesPerElement=28,oi(fp,"StructArrayLayout7f28");class dp extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L,F,U){const G=this.length;return this.resize(G+1),this.emplace(G,t,a,u,d,_,x,S,R,L,F,U)}emplace(t,a,u,d,_,x,S,R,L,F,U,G){const X=11*t;return this.float32[X+0]=a,this.float32[X+1]=u,this.float32[X+2]=d,this.float32[X+3]=_,this.float32[X+4]=x,this.float32[X+5]=S,this.float32[X+6]=R,this.float32[X+7]=L,this.float32[X+8]=F,this.float32[X+9]=U,this.float32[X+10]=G,t}}dp.prototype.bytesPerElement=44,oi(dp,"StructArrayLayout11f44");class Ed extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L){const F=this.length;return this.resize(F+1),this.emplace(F,t,a,u,d,_,x,S,R,L)}emplace(t,a,u,d,_,x,S,R,L,F){const U=9*t;return this.float32[U+0]=a,this.float32[U+1]=u,this.float32[U+2]=d,this.float32[U+3]=_,this.float32[U+4]=x,this.float32[U+5]=S,this.float32[U+6]=R,this.float32[U+7]=L,this.float32[U+8]=F,t}}Ed.prototype.bytesPerElement=36,oi(Ed,"StructArrayLayout9f36");class Xc extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.float32[d+0]=a,this.float32[d+1]=u,t}}Xc.prototype.bytesPerElement=8,oi(Xc,"StructArrayLayout2f8");class mo extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const x=6*t;return this.uint32[3*t+0]=a,this.uint16[x+2]=u,this.uint16[x+3]=d,this.uint16[x+4]=_,t}}mo.prototype.bytesPerElement=12,oi(mo,"StructArrayLayout1ul3ui12");class no extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}no.prototype.bytesPerElement=2,oi(no,"StructArrayLayout1ui2");class Ll extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he){const ce=this.length;return this.resize(ce+1),this.emplace(ce,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he)}emplace(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce){const _e=16*t;return this.float32[_e+0]=a,this.float32[_e+1]=u,this.float32[_e+2]=d,this.float32[_e+3]=_,this.float32[_e+4]=x,this.float32[_e+5]=S,this.float32[_e+6]=R,this.float32[_e+7]=L,this.float32[_e+8]=F,this.float32[_e+9]=U,this.float32[_e+10]=G,this.float32[_e+11]=X,this.float32[_e+12]=Z,this.float32[_e+13]=ne,this.float32[_e+14]=he,this.float32[_e+15]=ce,t}}Ll.prototype.bytesPerElement=64,oi(Ll,"StructArrayLayout16f64");class Ad extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,x,S){const R=this.length;return this.resize(R+1),this.emplace(R,t,a,u,d,_,x,S)}emplace(t,a,u,d,_,x,S,R){const L=10*t,F=5*t;return this.uint16[L+0]=a,this.uint16[L+1]=u,this.uint16[L+2]=d,this.uint16[L+3]=_,this.float32[F+2]=x,this.float32[F+3]=S,this.float32[F+4]=R,t}}Ad.prototype.bytesPerElement=20,oi(Ad,"StructArrayLayout4ui3f20");class ga extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.int16[1*t+0]=a,t}}ga.prototype.bytesPerElement=2,oi(ga,"StructArrayLayout1i2");class Ca extends Ms{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint8[1*t+0]=a,t}}Ca.prototype.bytesPerElement=1,oi(Ca,"StructArrayLayout1ub1");class If extends wd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}If.prototype.size=40;class pp extends Uh{get(t){return new If(this,t)}}oi(pp,"CollisionBoxArray");class hl extends wd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}hl.prototype.size=60;class Ql extends Md{get(t){return new hl(this,t)}}oi(Ql,"PlacedSymbolArray");class Wc extends wd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Wc.prototype.size=80;class Zc extends To{get(t){return new Wc(this,t)}}oi(Zc,"SymbolInstanceArray");class Pl extends Cu{getoffsetX(t){return this.float32[1*t+0]}}oi(Pl,"GlyphOffsetArray");class Mo extends Tf{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}oi(Mo,"SymbolLineVertexArray");class Cd extends wd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Cd.prototype.size=12;class yc extends mo{get(t){return new Cd(this,t)}}oi(yc,"FeatureIndexArray");class Rd extends Jl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}oi(Rd,"FillExtrusionCentroidArray");class Eo extends wd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Eo.prototype.size=6;class ro extends Mf{get(t){return new Eo(this,t)}}oi(ro,"FillExtrusionWallArray");const Ws=vr([{name:"a_pos",components:2,type:"Int16"}],4),xc=vr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),vc=vr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Es{constructor(t=[]){this.segments=t}_prepareSegment(t,a,u,d){let _=this.segments[this.segments.length-1];return t>Es.MAX_VERTEX_ARRAY_LENGTH&&ht(`Max vertices per segment is ${Es.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>Es.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}prepareSegment(t,a,u,d){return this._prepareSegment(t,a.length,u.length,d)}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,u,d){return new Es([{vertexOffset:t,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function fl(o,t){return 256*(o=oe(Math.floor(o),0,255))+oe(Math.floor(t),0,255)}Es.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,oi(Es,"SegmentVector");const Df=vr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mp=vr([{name:"a_pattern_b",components:4,type:"Uint16"}]),gp=vr([{name:"a_dash",components:4,type:"Uint16"}]);class Iu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,a,u,d){this.ids.push(Id(t)),this.positions.push(a,u,d)}eachPosition(t,a){const u=Id(t);let d=0,_=this.ids.length-1;for(;d<_;){const x=d+_>>1;this.ids[x]>=u?_=x:d=x+1}for(;this.ids[d]===u;)a(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(t,a){const u=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Dd(u,d,0,u.length-1),a&&(a.add(u.buffer),a.add(d.buffer)),{ids:u,positions:d}}static deserialize(t){const a=new Iu;let u;a.ids=t.ids,a.positions=t.positions;for(const d of a.ids)d!==u&&a.uniqueIds.push(d),u=d;return a.indexed=!0,a}}function Id(o){const t=+o;return Number.isSafeInteger(t)?t:af(String(o))}function Dd(o,t,a,u){for(;a<u;){const d=o[a+u>>1];let _=a-1,x=u+1;for(;;){do _++;while(o[_]<d);do x--;while(o[x]>d);if(_>=x)break;ec(o,_,x),ec(t,3*_,3*x),ec(t,3*_+1,3*x+1),ec(t,3*_+2,3*x+2)}x-a<u-x?(Dd(o,t,a,x),a=x+1):(Dd(o,t,x+1,u),u=x)}}function ec(o,t,a){const u=o[t];o[t]=o[a],o[a]=u}oi(Iu,"FeaturePositionMap");class dl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,a),this.initialized=!0),!!this.location}set(t,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Lf extends dl{constructor(t){super(t),this.current=0}set(t,a,u){this.fetchUniformLocation(t,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class _a extends dl{constructor(t){super(t),this.current=0}set(t,a,u){this.fetchUniformLocation(t,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Ga extends dl{constructor(t){super(t),this.current=[0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Yc extends dl{constructor(t){super(t),this.current=[0,0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Kc extends dl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class oh extends dl{constructor(t){super(t),this.current=qr.transparent.toPremultipliedRenderColor(null)}set(t,a,u){this.fetchUniformLocation(t,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const im=new Float32Array(16);class Ks extends dl{constructor(t){super(t),this.current=im}set(t,a,u){if(this.fetchUniformLocation(t,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const _p=new Float32Array(9),Ym=new Float32Array(4);class lh extends dl{constructor(t){super(t),this.current=Ym}set(t,a,u){if(this.fetchUniformLocation(t,a)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function $c(o){return[fl(255*o.r,255*o.g),fl(255*o.b,255*o.a)]}function pl(o,t,a,u,d,_,x,S){return!!o&&(o.kind==="composite"||o.kind==="source"?o.evaluate(new ms(0,{brightness:_,worldview:S}),t,a,d,u,x)==="none":o.value==="none")}class Jc{constructor(t,a,u,d){this.value=t,this.uniformNames=a.map((_=>`u_${_}`)),this.type=u,this.context=d}setUniform(t,a,u,d,_){const x=d.constantOr(this.value);a.set(t,_,x instanceof qr?x.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(t,a){return this.type==="color"?new oh(t):new _a(t)}}class Pf{constructor(t,a){this.uniformNames=a.map((u=>`u_${u}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,a){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(t,a,u,d,_){let x=null;_!=="u_pattern"&&_!=="u_dash"||(x=this.pattern),_==="u_pattern_b"&&(x=this.patternTransition),_==="u_pixel_ratio"&&(x=this.pixelRatio),x&&a.set(t,_,x)}getBinding(t,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new Kc(t):new _a(t)}}class Fo{constructor(t,a,u,d){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map((_=>({name:`a_${_}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(t,a,u,d,_,x,S,R){const L=this.paintVertexArray.length,F=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ms(0,{brightness:x,worldview:R}),a,{},_,d,S):this.expression.kind==="constant"&&this.expression.value,U=pl(this.lutExpression,a,{},d,_,x,S,R);this.paintVertexArray.resize(t),this._setPaintValue(L,t,F,U?null:this.context.lut)}updatePaintArray(t,a,u,d,_,x,S,R){const L=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:R},u,d,void 0,_):this.expression.kind==="constant"&&this.expression.value,F=pl(this.lutExpression,u,d,_,void 0,S,void 0,R);this._setPaintValue(t,a,L,F?null:this.context.lut)}_setPaintValue(t,a,u,d){if(this.type==="color"){const _=$c(u.toPremultipliedRenderColor(d));for(let x=t;x<a;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=t;_<a;_++)this.paintVertexArray.emplace(_,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class so{constructor(t,a,u,d,_,x){this.expression=t,this.uniformNames=a.map((S=>`u_${S}_t`)),this.type=u,this.useIntegerZoom=d,this.context=_,this.maxValue=0,this.paintVertexAttributes=a.map((S=>({name:`a_${S}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new x}populatePaintArray(t,a,u,d,_,x,S,R){const L=this.expression.evaluate(new ms(this.context.zoom,{brightness:x,worldview:R}),a,{},_,d,S),F=this.expression.evaluate(new ms(this.context.zoom+1,{brightness:x,worldview:R}),a,{},_,d,S),U=pl(this.lutExpression,a,{},d,_,x,S,R),G=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(G,t,L,F,U?null:this.context.lut)}updatePaintArray(t,a,u,d,_,x,S,R){const L=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:R},u,d,void 0,_),F=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:R},u,d,void 0,_),U=pl(this.lutExpression,u,d,_,void 0,S,void 0,R);this._setPaintValue(t,a,L,F,U?null:this.context.lut)}_setPaintValue(t,a,u,d,_){if(this.type==="color"){const x=$c(u.toPremultipliedRenderColor(_)),S=$c(u.toPremultipliedRenderColor(_));for(let R=t;R<a;R++)this.paintVertexArray.emplace(R,x[0],x[1],S[0],S[1])}else{for(let x=t;x<a;x++)this.paintVertexArray.emplace(x,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a,u,d,_){const x=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,S=oe(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);a.set(t,_,S)}getBinding(t,a){return new _a(t)}}class ao{constructor(t,a,u,d,_){this.expression=t,this.layerId=_,this.paintVertexAttributes=(u==="array"?gp:Df).members;for(let x=0;x<a.length;++x);this.paintVertexArray=new d,this.paintTransitionVertexArray=new qc}populatePaintArray(t,a,u,d){const _=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(_,t,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(t,a,u,d,_,x,S){this._setPaintValues(t,a,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(t,a,u,d){if(!d||!u)return;const _=d[u[0]],x=d[u[1]];if(_){if(_){const{tl:S,br:R,pixelRatio:L}=_;for(let F=t;F<a;F++)this.paintVertexArray.emplace(F,S[0],S[1],R[0],R[1],L)}if(x){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:R}=x;for(let L=t;L<a;L++)this.paintTransitionVertexArray.emplace(L,S[0],S[1],R[0],R[1])}}}upload(t){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,mp.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Ao{constructor(t,a,u=(()=>!0)){this.binders={},this._buffers=[],this.context=a;const d=[];for(const _ in t.paint._values){const x=t.paint.get(_);if(_.endsWith("-use-theme")||!u(_)||!(x instanceof Oh&&md(x.property.specification)))continue;const S=gs(_,t.type),R=x.value,L=x.property.specification.type,F=!!x.property.useIntegerZoom,U=_==="line-dasharray"||_.endsWith("pattern"),G=t.paint.get(`${_}-use-theme`),X=_==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||G&&G.value.kind!=="constant";if(R.kind!=="constant"||X)if(R.kind==="source"||X||U){const Z=tc(_,L,"source");this.binders[_]=U?new ao(R,S,L,Z,t.id):new Fo(R,S,L,Z),d.push(`/a_${_}`)}else{const Z=tc(_,L,"composite");this.binders[_]=new so(R,S,L,F,a,Z),d.push(`/z_${_}`)}else this.binders[_]=U?new Pf(R.value,S):new Jc(R.value,S,L,a),d.push(`/u_${_}`);G&&(this.binders[_].lutExpression=G.value)}this.cacheKey=d.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof Fo||a instanceof so?a.maxValue:0}populatePaintArrays(t,a,u,d,_,x,S,R){for(const L in this.binders){const F=this.binders[L];F.context=this.context,(F instanceof Fo||F instanceof so||F instanceof ao)&&F.populatePaintArray(t,a,u,d,_,x,S,R)}}setConstantPatternPositions(t,a){for(const u in this.binders){const d=this.binders[u];d instanceof Pf&&d.setConstantPatternPositions(t,a)}}getPatternTransitionVertexBuffer(t){const a=this.binders[t];return a instanceof ao?a.paintTransitionVertexBuffer:null}updatePaintArrays(t,a,u,d,_,x,S,R,L,F){let U=!1;const G=Object.keys(t),X=G.length!==0&&!R,Z=X?G:a.uniqueIds;this.context.lut=_.lut;for(const ne in this.binders){const he=this.binders[ne];if(he.context=this.context,(he instanceof Fo||he instanceof so||he instanceof ao)&&he.expression&&he.expression.kind&&he.expression.kind!=="constant"&&(he.expression.isStateDependent===!0||he.expression.isLightConstant===!1)){const ce=_.paint.get(ne);he.expression=ce.value;for(const _e of Z){const xe=t[_e.toString()];a.eachPosition(_e,((Ee,ke,Be)=>{const He=d.feature(Ee);he.updatePaintArray(ke,Be,He,xe,x,S,L,F)}))}if(!X)for(const _e of u.uniqueIds){const xe=t[_e.toString()];u.eachPosition(_e,((Ee,ke,Be)=>{const He=d.feature(Ee);he.updatePaintArray(ke,Be,He,xe,x,S,L,F)}))}U=!0}}return U}defines(){const t=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Jc||u instanceof Pf)&&t.push(...u.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const a=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Jc||d instanceof Pf||d instanceof so)for(const _ of d.uniformNames)a.push({name:_,property:u,binding:d.getBinding(t,_)})}return a}setUniforms(t,a,u,d,_){for(const{name:x,property:S,binding:R}of u)this.binders[S].setUniform(t,R,_,d.get(S),x)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const a=this.binders[t];(a instanceof Fo||a instanceof so||a instanceof ao)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof ao&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(t){for(const a in this.binders){const u=this.binders[a];(u instanceof Fo||u instanceof so||u instanceof ao)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof Fo||a instanceof so||a instanceof ao)&&a.destroy()}}}class na{constructor(t,a,u=(()=>!0)){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Ao(d,a,u);this.needsUpload=!1,this._featureMap=new Iu,this._featureMapWithoutIds=new Iu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,a,u,d,_,x,S,R,L){for(const F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(t,a,d,_,x,S,R,L);a.id!==void 0?this._featureMap.add(a.id,u,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,u,d,_,x,S,R){for(const L of u)this.needsUpload=this.programConfigurations[L.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,a,L,d,_,x,S||0,R)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const ch={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function gs(o,t){return ch[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}const ta={"line-pattern":{source:ul,composite:ul},"fill-pattern":{source:ul,composite:ul},"fill-extrusion-pattern":{source:ul,composite:ul},"line-dasharray":{source:qc,composite:qc}},oo={color:{source:Xc,composite:io},number:{source:Cu,composite:Xc}};function tc(o,t,a){const u=ta[o];return u&&u[a]||oo[t][a]}oi(Jc,"ConstantBinder"),oi(Pf,"PatternConstantBinder"),oi(Fo,"SourceExpressionBinder"),oi(ao,"PatternCompositeBinder"),oi(so,"CompositeExpressionBinder"),oi(Ao,"ProgramConfiguration",{omit:["_buffers"]}),oi(na,"ProgramConfigurationSet");const cs=gi/Math.PI/2,go=5,zf=6,Wa=16383,Du=64,Km=[Du,32,16],zl=-cs,rs=cs;function wa(o,t,a,u=cs){return a=Ar(a),[o*Math.sin(a)*u,-t*u,o*Math.cos(a)*u]}function lo(o,t,a){return wa(Math.cos(Ar(o)),Math.sin(Ar(o)),t,a)}const p=63710088e-1,s=2*Math.PI*p;class c{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(Ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,u=this.lat*a,d=t.lat*a,_=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((t.lng-this.lng)*a);return p*Math.acos(Math.min(_,1))}toBounds(t=0){const a=360*t/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new m({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(t){return lo(this.lat,this.lng,cs+t*cs/p)}static convert(t){if(t instanceof c)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new c(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new c(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class m{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof c?new c(t.lng,t.lat):c.convert(t),this}setSouthWest(t){return this._sw=t instanceof c?new c(t.lng,t.lat):c.convert(t),this}extend(t){const a=this._sw,u=this._ne;let d,_;if(t instanceof c)d=t,_=t;else{if(!(t instanceof m))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(m.convert(t)):this.extend(c.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(c.convert(t)):this;if(d=t._sw,_=t._ne,!d||!_)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(_.lng,u.lng),u.lat=Math.max(_.lat,u.lat)):(this._sw=new c(d.lng,d.lat),this._ne=new c(_.lng,_.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=c.convert(t);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(t){if(t)return t instanceof m?t:new m(t)}}const b=0,M=25.5;function A(o){return s*Math.cos(o*Math.PI/180)}function D(o){return(180+o)/360}function O(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function V(o,t){return o/A(t)}function H(o){return 360*o-180}function Q(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function K(o,t){return o*A(Q(t))}const ee=85.051129;function le(o){return Math.cos(Ar(oe(o,-ee,ee)))}function se(o,t){const a=oe(t,b,M),u=Math.pow(2,a);return le(o)*s/(512*u)}function pe(o){return 1/Math.cos(o*Math.PI/180)}function de(o,t=0){const a=Math.exp(Math.PI*(1-(o.y+t/gi)/(1<<o.z)*2));return 80150034*a/(a*a+1)/gi/(1<<o.z)}class be{constructor(t,a,u=0){this.x=+t,this.y=+a,this.z=+u}static fromLngLat(t,a=0){const u=c.convert(t);return new be(D(u.lng),O(u.lat),V(a,u.lat))}toLngLat(){return new c(H(this.x),Q(this.y))}toAltitude(){return K(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/s*pe(Q(this.y))}}function Me(o,t,a,u,d,_,x,S,R){const L=(t+u)/2,F=(a+d)/2,U=new Xt(L,F);S(U),(function(G,X,Z,ne,he,ce){const _e=Z-he,xe=ne-ce;return Math.abs((ne-X)*_e-(Z-G)*xe)/Math.hypot(_e,xe)})(U.x,U.y,_.x,_.y,x.x,x.y)>=R?(Me(o,t,a,L,F,_,U,S,R),Me(o,L,F,u,d,U,x,S,R)):o.push(x)}function we(o,t,a){let u=o[0],d=u.x,_=u.y;t(u);const x=[u];for(let S=1;S<o.length;S++){const R=o[S],{x:L,y:F}=R;t(R),Me(x,d,_,L,F,u,R,t,a),d=L,_=F,u=R}return x}function Ue(o,t,a,u){if(u(t,a)){const d=t.add(a)._mult(.5);Ue(o,t,d,u),Ue(o,d,a,u)}else o.push(a)}function Pe(o,t){let a=o[0];const u=[a];for(let d=1;d<o.length;d++){const _=o[d];Ue(u,a,_,t),a=_}return u}const Ne=Math.pow(2,14)-1,Oe=-Ne-1;function Le(o,t){const a=Math.round(o.x*t),u=Math.round(o.y*t);return o.x=oe(a,Oe,Ne),o.y=oe(u,Oe,Ne),(a<o.x||a>o.x+1||u<o.y||u>o.y+1)&&ht("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ye(o,t,a){const u=o.loadGeometry(),d=o.extent,_=gi/d;if(t&&a&&a.projection.isReprojectedInTileSpace){const x=1<<t.z,{scale:S,x:R,y:L,projection:F}=a,U=G=>{const X=H((t.x+G.x/d)/x),Z=Q((t.y+G.y/d)/x),ne=F.project(X,Z);G.x=(ne.x*S-R)*d,G.y=(ne.y*S-L)*d};for(let G=0;G<u.length;G++)if(o.type!==1)u[G]=we(u[G],U,1);else{const X=[];for(const Z of u[G])Z.x<0||Z.x>=d||Z.y<0||Z.y>=d||(U(Z),X.push(Z));u[G]=X}}for(const x of u)for(const S of x)Le(S,_);return u}function ct(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?Ye(o):[]}}class rt{constructor(t,a,u,d,_){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=_,t.readFields(_t,this,a)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const a=t.readVarint()+t.pos,u=[];let d,_=1,x=0,S=0,R=0;for(;t.pos<a;){if(x<=0){const L=t.readVarint();_=7&L,x=L>>3}if(x--,_===1||_===2)S+=t.readSVarint(),R+=t.readSVarint(),_===1&&(d&&u.push(d),d=[]),d&&d.push(new Xt(S,R));else{if(_!==7)throw new Error(`unknown command ${_}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){const t=this._pbf;t.pos=this._geometry;const a=t.readVarint()+t.pos;let u=1,d=0,_=0,x=0,S=1/0,R=-1/0,L=1/0,F=-1/0;for(;t.pos<a;){if(d<=0){const U=t.readVarint();u=7&U,d=U>>3}if(d--,u===1||u===2)_+=t.readSVarint(),x+=t.readSVarint(),_<S&&(S=_),_>R&&(R=_),x<L&&(L=x),x>F&&(F=x);else if(u!==7)throw new Error(`unknown command ${u}`)}return[S,L,R,F]}toGeoJSON(t,a,u){const d=this.extent*Math.pow(2,u),_=this.extent*t,x=this.extent*a,S=this.loadGeometry();function R(G){return[360*(G.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(G.y+x)/d)*Math.PI))-90]}function L(G){return G.map(R)}let F;if(this.type===1){const G=[];for(const Z of S)G.push(Z[0]);const X=L(G);F=G.length===1?{type:"Point",coordinates:X[0]}:{type:"MultiPoint",coordinates:X}}else if(this.type===2){const G=S.map(L);F=G.length===1?{type:"LineString",coordinates:G[0]}:{type:"MultiLineString",coordinates:G}}else{if(this.type!==3)throw new Error("unknown feature type");{const G=(function(Z){const ne=Z.length;if(ne<=1)return[Z];const he=[];let ce,_e;for(let xe=0;xe<ne;xe++){const Ee=xt(Z[xe]);Ee!==0&&(_e===void 0&&(_e=Ee<0),_e===Ee<0?(ce&&he.push(ce),ce=[Z[xe]]):ce&&ce.push(Z[xe]))}return ce&&he.push(ce),he})(S),X=[];for(const Z of G)X.push(Z.map(L));F=X.length===1?{type:"Polygon",coordinates:X[0]}:{type:"MultiPolygon",coordinates:X}}}const U={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(U.id=this.id),U}}function _t(o,t,a){o===1?t.id=a.readVarint():o===2?(function(u,d){const _=u.readVarint()+u.pos;for(;u.pos<_;){const x=d._keys[u.readVarint()],S=d._values[u.readVarint()];d.properties[x]=S}})(a,t):o===3?t.type=a.readVarint():o===4&&(t._geometry=a.pos)}function xt(o){let t=0;for(let a,u,d=0,_=o.length,x=_-1;d<_;x=d++)a=o[d],u=o[x],t+=(u.x-a.x)*(a.y+u.y);return t}rt.types=["Unknown","Point","LineString","Polygon"];class St{constructor(t,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ft,this,a),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const a=this._pbf.readVarint()+this._pbf.pos;return new rt(this._pbf,a,this.extent,this._keys,this._values)}}function Ft(o,t,a){o===15?t.version=a.readVarint():o===1?t.name=a.readString():o===5?t.extent=a.readVarint():o===2?t._features.push(a.pos):o===3?t._keys.push(a.readString()):o===4&&t._values.push((function(u){let d=null;const _=u.readVarint()+u.pos;for(;u.pos<_;){const x=u.readVarint()>>3;d=x===1?u.readString():x===2?u.readFloat():x===3?u.readDouble():x===4?u.readVarint64():x===5?u.readVarint():x===6?u.readSVarint():x===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(a))}class nt{constructor(t,a){this.layers=t.readFields(qe,{},a)}}function qe(o,t,a){if(o===3){const u=new St(a,a.readVarint()+a.pos);u.length&&(t[u.name]=u)}}const yt="3d_elevation_id",pt="level";class Ut{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,a){return this._valid&&t(a(this._geometry)),this}require(t,a,u){return this.get(t,!0,a,u)}optional(t,a,u){return this.get(t,!1,a,u)}success(){return this._valid}get(t,a,u,d){const _=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?u(d?d(_):_):a&&(this._valid=!1),this}}class ei{constructor(t,a){this.featureFunc=t,this.vertexFunc=a}parseFeature(t,a,u){return this.featureFunc(t,a,u)}parseVertex(t,a,u){return this.vertexFunc(t,a,u)}}const vi=new ei(((o,t,a)=>o.reset(t).require(yt,(u=>{a.id=u})).optional("fixed_height_relative",(u=>{a.constantHeight=u}),ti.decodeRelativeHeight).geometry((u=>{a.bounds=u}),$a).success()),((o,t,a)=>o.reset(t).require(yt,(u=>{a.id=u})).require("elevation_idx",(u=>{a.idx=u})).require("extent",(u=>{a.extent=u})).require("height_relative",(u=>{a.height=u}),ti.decodeRelativeHeight).geometry((u=>{a.position=u}),ti.getPoint).success())),ni=new ei(((o,t,a)=>o.reset(t).require(yt,(u=>{a.id=u})).optional("fixed_height",(u=>{a.constantHeight=u}),ti.decodeMetricHeight).geometry((u=>{a.bounds=u}),$a).success()),((o,t,a)=>o.reset(t).require(yt,(u=>{a.id=u})).require("elevation_idx",(u=>{a.idx=u})).require("extent",(u=>{a.extent=u})).require("height",(u=>{a.height=u}),ti.decodeMetricHeight).geometry((u=>{a.position=u}),ti.getPoint).success()));class ti{static getPoint(t){return Xn(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static getVersionSchema(t){return t?t==="1.0.1"?ni:void 0:vi}static parse(t){const a=[],u=[],d=t.length,_=new Ut;for(let x=0;x<d;x++){const S=t.feature(x),R=S.properties.version,L=ti.getVersionSchema(R);if(L===void 0){ht(`Unknown elevation feature version number ${R||"(unknown)"}`);continue}const F=S.properties.type;if(!F)continue;const U=rt.types[S.type];if(U==="Point"&&F==="curve_point"){const G={};L.parseVertex(_,S,G)&&a.push(G)}else if(U==="Polygon"&&F==="curve_meta"){const G={};L.parseFeature(_,S,G)&&u.push(G)}}return{vertices:a,features:u}}}class Zi{constructor(t,a){this.pos=t,this.dir=a}intersectsPlane(t,a,u){const d=bn(a,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((t[0]-this.pos[0])*a[0]+(t[1]-this.pos[1])*a[1])/d;return u[0]=this.pos[0]+this.dir[0]*_,u[1]=this.pos[1]+this.dir[1]*_,!0}}class Si{constructor(t,a){this.pos=t,this.dir=a}intersectsPlane(t,a,u){const d=rn(a,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((t[0]-this.pos[0])*a[0]+(t[1]-this.pos[1])*a[1]+(t[2]-this.pos[2])*a[2])/d;return u[0]=this.pos[0]+this.dir[0]*_,u[1]=this.pos[1]+this.dir[1]*_,u[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(t,a,u){if((function(X,Z){var ne=X[0],he=X[1],ce=X[2],_e=Z[0],xe=Z[1],Ee=Z[2];return Math.abs(ne-_e)<=C*Math.max(1,Math.abs(ne),Math.abs(_e))&&Math.abs(he-xe)<=C*Math.max(1,Math.abs(he),Math.abs(xe))&&Math.abs(ce-Ee)<=C*Math.max(1,Math.abs(ce),Math.abs(Ee))})(this.pos,t)||a===0)return u[0]=u[1]=u[2]=0,!1;const[d,_,x]=this.dir,S=this.pos[0]-t[0],R=this.pos[1]-t[1],L=this.pos[2]-t[2],F=d*d+_*_+x*x,U=2*(S*d+R*_+L*x),G=U*U-4*F*(S*S+R*R+L*L-a*a);if(G<0){const X=Math.max(-U/2,0),Z=S+d*X,ne=R+_*X,he=L+x*X,ce=Math.hypot(Z,ne,he);return u[0]=Z*a/ce,u[1]=ne*a/ce,u[2]=he*a/ce,!1}{const X=(-U-Math.sqrt(G))/(2*F);if(X<0){const Z=Math.hypot(S,R,L);return u[0]=S*a/Z,u[1]=R*a/Z,u[2]=L*a/Z,!1}return u[0]=S+d*X,u[1]=R+_*X,u[2]=L+x*X,!0}}}class Ai{constructor(t,a,u,d,_){this.TL=t,this.TR=a,this.BR=u,this.BL=d,this.horizon=_}static fromInvProjectionMatrix(t,a,u){const d=[-1,1,1],_=[1,1,1],x=[1,-1,1],S=[-1,-1,1],R=xn(d,d,t),L=xn(_,_,t),F=xn(x,x,t),U=xn(S,S,t);return new Ai(R,L,F,U,a/u)}}function Oi(o,t,a){let u=1/0,d=-1/0;const _=[];for(const x of o){Di(_,x,t);const S=rn(_,a);u=Math.min(u,S),d=Math.max(d,S)}return[u,d]}function an(o,t){let a=!0;for(let u=0;u<o.planes.length;u++){const d=o.planes[u];let _=0;for(let x=0;x<t.length;x++)_+=+(rn(d,t[x])+d[3]>=0);if(_===0)return 0;_!==t.length&&(a=!1)}return a?2:1}function Mn(o,t){for(const a of o.projections){const u=Oi(t,o.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function lr(o,t){let a=0;const u=[0,0,0,0];for(let x=0;x<o.length;x++)u[0]=o[x][0],u[1]=o[x][1],u[2]=o[x][2],u[3]=1,(d=u)[0]*(_=t)[0]+d[1]*_[1]+d[2]*_[2]+d[3]*_[3]>=0&&a++;var d,_;return a}class Lr{constructor(t,a){this.points=t||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Yi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Di([],this.points[2],this.points[3]),Di([],this.points[0],this.points[3]),Di([],this.points[4],this.points[0]),Di([],this.points[5],this.points[1]),Di([],this.points[6],this.points[2]),Di([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],_=[u[2],0,-u[0]];this.projections.push({axis:d,projection:Oi(this.points,this.points[0],d)}),this.projections.push({axis:_,projection:Oi(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(t,a,u,d){const _=Math.pow(2,u),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((L=>{const F=De([],L,t),U=1/F[3]/a*_;return(G=F)[0]=(X=F)[0]*(Z=[U,U,d?1/F[3]:U,U])[0],G[1]=X[1]*Z[1],G[2]=X[2]*Z[2],G[3]=X[3]*Z[3],G;var G,X,Z})),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((L=>{const F=Ui([],Fn([],Di([],x[L[0]],x[L[1]]),Di([],x[L[2]],x[L[1]]))),U=-rn(F,x[L[1]]);return F.concat(U)})),R=[];for(let L=0;L<x.length;L++)R.push([x[L][0],x[L][1],x[L][2]]);return new Lr(R,S)}intersectsPrecise(t,a,u){for(let d=0;d<a.length;d++)if(!lr(t,a[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!lr(t,this.planes[d]))return 0;for(const d of u)for(const _ of this.frustumEdges){const x=Fn([],d,_),S=kt(x);if(S===0)continue;Vt(x,x,1/S);const R=Oi(this.points,this.points[0],x),L=Oi(t,this.points[0],x);if(R[0]>L[1]||L[0]>R[1])return 0}return 1}containsPoint(t){for(const a of this.planes){const u=a[3];if(rn([a[0],a[1],a[2]],t)+u<0)return!1}return!0}}class Yi{static fromPoints(t){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of t)Ge(a,a,d),Et(u,u,d);return new Yi(a,u)}static fromTileIdAndHeight(t,a,u){const d=1<<t.canonical.z,_=t.canonical.x,x=t.canonical.y;return new Yi([_/d,x/d,a],[(_+1)/d,(x+1)/d,u])}static applyTransform(t,a){const u=t.getCorners();for(let d=0;d<u.length;++d)xn(u[d],u[d],a);return Yi.fromPoints(u)}static applyTransformFast(t,a){const u=[a[12],a[13],a[14]],d=[...u];for(let _=0;_<3;_++)for(let x=0;x<3;x++){const S=a[4*x+_],R=S*t.min[x],L=S*t.max[x];u[_]+=Math.min(R,L),d[_]+=Math.max(R,L)}return new Yi(u,d)}static projectAabbCorners(t,a){const u=t.getCorners();for(let d=0;d<u.length;++d)xn(u[d],u[d],a);return u}constructor(t,a){this.min=t,this.max=a,this.center=Vt([],et([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],u=Gt(this.min),d=Gt(this.max);for(let _=0;_<a.length;_++)u[_]=a[_]?this.min[_]:this.center[_],d[_]=a[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Yi(u,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,a=this.max;return[[t[0],t[1],t[2]],[a[0],t[1],t[2]],[a[0],a[1],t[2]],[t[0],a[1],t[2]],[t[0],t[1],a[2]],[a[0],t[1],a[2]],[a[0],a[1],a[2]],[t[0],a[1],a[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?an(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?an(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,a){return a||this.intersects(t)?Mn(t,this.getCorners()):0}intersectsPreciseFlat(t,a){return a||this.intersectsFlat(t)?Mn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let a=0;a<3;++a)if(this.min[a]>t.max[a]||t.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],t.min[a]),this.max[a]=Math.max(this.max[a],t.max[a])}encapsulatePoint(t){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],t[a]),this.max[a]=Math.max(this.max[a],t[a])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}oi(Yi,"Aabb");class Ir{constructor(t,a){this.feature=t,this.metersToTile=a,this.index=0}get(){const t=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,u=a[1],d=-a[0],_=(t.extent+1)*this.metersToTile;return[new Xt(Math.trunc(t.position[0]+u*_),Math.trunc(t.position[1]+d*_)),new Xt(Math.trunc(t.position[0]-u*_),Math.trunc(t.position[1]-d*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Dn{constructor(t,a,u,d,_,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[qi(),qi(),qi(),qi(),qi(),qi(),qi()],this.id=t,this.heightRange={min:u,max:u},this.safeArea=a,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=_,this.edges=this.edges.filter((S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((R=this.vertices[S.a].position)[0]===(L=this.vertices[S.b].position)[0]&&R[1]===L[1]);var R,L})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:Xn(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const R=this.vertices[S.a].position,L=this.vertices[S.b].position,F=xr(qi(),L,R),U=wn(F),G=Rt(qi(),F,1/U);this.edgeProps.push({vec:F,dir:G,len:U});const X=this.vertexProps[S.a].dir,Z=this.vertexProps[S.b].dir;Nn(X,X,G),Nn(Z,Z,G)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||vn(S.dir,S.dir);this.tessellate(x)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(t);if(a==null)return 0;const[u,d]=a;return Rn(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(t,a){const u=this.getClosestEdge(t);if(!u)return Re(0,0,1);const d=u[0],_=this.edges[d],x=this.edgeProps[d].vec,S=Re(x[0],x[1],(this.vertices[_.b].height-this.vertices[_.a].height)*a),R=Re(S[1],-S[0],0);Fn(R,R,S);const L=kt(R);return L>0?Vt(R,R,1/L):Qe(R,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let a=0,u=Number.POSITIVE_INFINITY,d=0;const[_,x,S,R,L,F,U]=this._tmpVec2;Qn(U,t.x,t.y);const G=new Zi(U,null);for(let X=0;X<this.edges.length;X++){const Z=this.edges[X],ne=this.edgeProps[X].dir;G.dir=ne;const he=this.vertices[Z.a].position,ce=this.vertices[Z.b].position,_e=G.intersectsPlane(he,this.vertexProps[Z.a].dir,_),xe=G.intersectsPlane(ce,this.vertexProps[Z.b].dir,x);if(!_e||!xe)continue;xr(S,x,_),xr(R,U,_);const Ee=bn(S,S),ke=Ee>0?bn(R,S)/Ee:0,Be=oe(ke,0,1),He=Math.abs((ke-Be)*this.edgeProps[X].len);xr(L,U,he),Qn(F,ne[1],-ne[0]);const Je=He+Math.abs(bn(L,F));Je<u&&(a=X,u=Je,d=Be)}return[a,d]}tessellate(t){const a=mt(),u=mt(),d=mt(),_=mt();for(let x=this.edges.length-1;x>=0;--x){const S=this.edges[x].a,R=this.edges[x].b,{position:L,height:F,extent:U}=this.vertices[S],{position:G,height:X,extent:Z}=this.vertices[R],ne=this.vertexProps[S].dir,he=this.vertexProps[R].dir;if(Qe(a,L[0]/t,L[1]/t,F),Qe(u,G[0]/t,G[1]/t,X),Qe(d,ne[1],-ne[0],0),Vt(d,d,U),Qe(_,he[1],-he[0],0),Vt(_,_,Z),this.distSqLines(Re(a[0]+.5*d[0],a[1]+.5*d[1],a[2]+.5*d[2]),Re(u[0]-.5*_[0],u[1]-.5*_[1],u[2]-.5*_[2]),Re(a[0]-.5*d[0],a[1]-.5*d[1],a[2]-.5*d[2]),Re(u[0]+.5*_[0],u[1]+.5*_[1],u[2]+.5*_[2]))<=.0025000000000000005)continue;const ce=this.vertices.length,_e=Nn(qi(),L,G);this.vertices.push({position:Rt(_e,_e,.5),height:.5*(F+X),extent:.5*(U+Z)});const xe=Nn(qi(),ne,he);this.vertexProps.push({dir:vn(xe,xe)}),this.edges.splice(x,1),this.edgeProps.splice(x,1),this.edges.push({a:S,b:ce}),this.edges.push({a:ce,b:R});const Ee=xr(qi(),this.vertices[ce].position,L),ke=wn(Ee),Be={vec:Ee,dir:Rt(qi(),Ee,1/ke),len:ke};this.edgeProps.push(Be),this.edgeProps.push(Be)}}distSqLines(t,a,u,d){const _=Lt(mt(),a,t),x=Lt(mt(),d,u),S=Lt(mt(),t,u),R=rn(_,_),L=rn(_,x),F=rn(_,S),U=rn(x,x),G=rn(x,S),X=R*U-L*L;if(X===0)return qt(Er(_,u,d,rn(S,x)/rn(x,x)),t);const Z=(R*G-L*F)/X;return qt(Er(_,t,a,(L*G-F*U)/X),Er(x,u,d,Z))}}class er{static parseFrom(t,a){const u=ti.parse(t);if(!u)return[];let{vertices:d,features:_}=u;const x=1/de(a);_.sort(((F,U)=>F.id-U.id)),d.sort(((F,U)=>F.id-U.id||F.idx-U.idx)),d=d.filter(((F,U,G)=>U===G.findIndex((X=>X.id===F.id&&X.idx===F.idx))));const S=new Array;let R=0;const L=d.length;for(const F of _){if(F.constantHeight){S.push(new Dn(F.id,F.bounds,F.constantHeight));continue}for(;R!==L&&d[R].id<F.id;)R++;if(R===L||d[R].id!==F.id)continue;const U=new Array,G=new Array,X=R;for(;R!==L&&d[R].id===F.id;){const Z=d[R];if(U.push({position:Z.position,height:Z.height,extent:Z.extent}),R!==X&&d[R-1].idx===Z.idx-1){const ne=R-X;G.push({a:ne-1,b:ne})}R++}S.push(new Dn(F.id,F.bounds,void 0,U,G,x))}return S}static getElevationFeature(t,a){if(!a)return;const u=+t.properties[yt];return Number.isNaN(u)?void 0:a.find((d=>d.id===u))}}class Pr{constructor(t,a){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(a)||(this.zScale=Math.pow(2,a.z-t.z),this.xOffset=(t.x*this.zScale-a.x)*gi,this.yOffset=(t.y*this.zScale-a.y)*gi)}constantElevation(t,a){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,a)}pointElevation(t,a,u){const d=this.constantElevation(a,u);return d??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(t),u))}computeBiasedHeight(t,a){return a<=0?t:t+a*ge(0,a,t>=0?t:Math.abs(.5*t))}}oi(Dn,"ElevationFeature");class Sr{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Tf,this.indexArray=new Aa,this.segments=new Es,this.programConfigurations=new na(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Cu),this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,a){}updateAppearances(t,a,u,d){}populate(t,a,u,d){const _=this.layers[0],x=[];let S=null;_.type==="circle"&&(S=_.layout.get("circle-sort-key"));for(const{feature:L,id:F,index:U,sourceLayerIndex:G}of t){const X=this.layers[0]._featureFilter.needGeometry,Z=ct(L,X);if(!this.layers[0]._featureFilter.filter(new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Z,u))continue;const ne=S?S.evaluate(Z,{},u):void 0,he={id:F,properties:L.properties,type:L.type,sourceLayerIndex:G,index:U,geometry:X?Z.geometry:Ye(L,u,d),patterns:{},sortKey:ne};x.push(he)}S&&x.sort(((L,F)=>L.sortKey-F.sortKey));let R=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Ef,R=d.projection);for(const L of x){const{geometry:F,index:U,sourceLayerIndex:G}=L,X=t[U].feature;this.addFeature(L,F,U,a.availableImages,u,R,a.brightness,a.elevationFeatures),a.featureIndex.insert(X,F,U,G,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,a,u,d,_,x,S){this.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ws.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,vc.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,xc.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,a,u,d,_,x,S,R){let L;this.elevationMode!=="none"&&(L=er.getElevationFeature(t,R));for(const F of a)for(const U of F){const G=U.x,X=U.y;if(G<0||G>=gi||X<0||X>=gi)continue;if(x){const he=x.projectTilePoint(G,X,_),ce=x.upVector(_,G,X);this.addGlobeExtVertex(he,ce),this.addGlobeExtVertex(he,ce),this.addGlobeExtVertex(he,ce),this.addGlobeExtVertex(he,ce)}const Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ne=Z.vertexLength;if(this.addCircleVertex(G,X,-1,-1),this.addCircleVertex(G,X,1,-1),this.addCircleVertex(G,X,1,1),this.addCircleVertex(G,X,-1,1),this.elevationMode!=="none"){const he=L?L.pointElevation(new Xt(G,X)):0;this.hasElevation=this.hasElevation||he!==0;for(let ce=0;ce<4;ce++)this.elevatedLayoutVertexArray.emplaceBack(he)}this.indexArray.emplaceBack(ne,ne+1,ne+2),this.indexArray.emplaceBack(ne,ne+2,ne+3),Z.vertexLength+=4,Z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},d,_,S,void 0,this.worldview)}addCircleVertex(t,a,u,d){this.layoutVertexArray.emplaceBack(2*t+(u+1)/2,2*a+(d+1)/2)}addGlobeExtVertex(t,a){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function pr(o,t){for(let a=0;a<o.length;a++)if(te(t,o[a]))return!0;for(let a=0;a<t.length;a++)if(te(o,t[a]))return!0;return!!us(o,t)}function qn(o,t,a){return!!te(o,t)||!!T(t,o,a)}function zr(o,t){if(o.length===1)return q(t,o[0]);for(let a=0;a<t.length;a++){const u=t[a];for(let d=0;d<u.length;d++)if(te(o,u[d]))return!0}for(let a=0;a<o.length;a++)if(q(t,o[a]))return!0;for(let a=0;a<t.length;a++)if(us(o,t[a]))return!0;return!1}function Os(o,t,a){if(o.length>1){if(us(o,t))return!0;for(let u=0;u<t.length;u++)if(T(t[u],o,a))return!0}for(let u=0;u<o.length;u++)if(T(o[u],t,a))return!0;return!1}function us(o,t){if(o.length===0||t.length===0)return!1;for(let a=0;a<o.length-1;a++){const u=o[a],d=o[a+1];for(let _=0;_<t.length-1;_++)if(Nr(u,d,t[_],t[_+1]))return!0}return!1}function Nr(o,t,a,u){return bt(o,a,u)!==bt(t,a,u)&&bt(o,t,a)!==bt(o,t,u)}function rr(o,t,a){return(o.x-a.x)*(t.y-a.y)-(o.y-a.y)*(t.x-a.x)}function w(o,t,a,u){const d=rr(o,t,u),_=rr(o,t,a);if(Math.sign(d)===Math.sign(_))return;const x=rr(a,u,o),S=x+_-d;return Math.sign(x)!==Math.sign(S)?[x/(x-S),_/(_-d)]:void 0}function T(o,t,a){const u=a*a;if(t.length===1)return o.distSqr(t[0])<u;for(let d=1;d<t.length;d++)if(B(o,t[d-1],t[d])<u)return!0;return!1}function B(o,t,a){const u=t.distSqr(a);if(u===0)return o.distSqr(t);const d=((o.x-t.x)*(a.x-t.x)+(o.y-t.y)*(a.y-t.y))/u;return o.distSqr(d<0?t:d>1?a:a.sub(t)._mult(d)._add(t))}function q(o,t){let a,u,d,_=!1;for(let x=0;x<o.length;x++){a=o[x];for(let S=0,R=a.length-1;S<a.length;R=S++)u=a[S],d=a[R],u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(_=!_)}return _}function te(o,t){let a=!1;for(let u=0,d=o.length-1;u<o.length;d=u++){const _=o[u],x=o[d];_.y>t.y!=x.y>t.y&&t.x<(x.x-_.x)*(t.y-_.y)/(x.y-_.y)+_.x&&(a=!a)}return a}function fe(o,t,a,u,d){for(const x of o)if(t<=x.x&&a<=x.y&&u>=x.x&&d>=x.y)return!0;const _=[new Xt(t,a),new Xt(t,d),new Xt(u,d),new Xt(u,a)];if(o.length>2){for(const x of _)if(te(o,x))return!0}for(let x=0;x<o.length-1;x++)if(We(o[x],o[x+1],_))return!0;return!1}function We(o,t,a){const u=a[0],d=a[2];if(o.x<u.x&&t.x<u.x||o.x>d.x&&t.x>d.x||o.y<u.y&&t.y<u.y||o.y>d.y&&t.y>d.y)return!1;const _=bt(o,t,a[0]);return _!==bt(o,t,a[1])||_!==bt(o,t,a[2])||_!==bt(o,t,a[3])}function vt(o,t,a,u,d,_){let x=t.y-o.y,S=o.x-t.x;if(_=_||0){const R=x*x+S*S;if(R===0)return!0;const L=Math.sqrt(R);x/=L,S/=L}return!((a.x-o.x)*x+(a.y-o.y)*S-_<0||(u.x-o.x)*x+(u.y-o.y)*S-_<0||(d.x-o.x)*x+(d.y-o.y)*S-_<0)}function Ht(o,t,a,u,d,_,x){return!(vt(o,t,u,d,_,x)||vt(t,a,u,d,_,x)||vt(a,o,u,d,_,x)||vt(u,d,o,t,a,x)||vt(d,_,o,t,a,x)||vt(_,u,o,t,a,x))}function Ri(o,t,a){const u=t.paint.get(o).value;return u.kind==="constant"?u.value:a.programConfigurations.get(t.id).getMaxValue(o)}function on(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function En(o,t,a,u,d){if(!t[0]&&!t[1])return o;const _=Xt.convert(t)._mult(d);a==="viewport"&&_._rotate(-u);const x=[];for(let S=0;S<o.length;S++)x.push(o[S].sub(_));return x}function On(o,t,a,u){const d=Xt.convert(o)._mult(u);return t==="viewport"&&d._rotate(-a),d}let br,is;function $s(o,t,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[o*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}oi(Sr,"CircleBucket",{omit:["layers"]});class Yr{constructor(t,a,u){this.z=t,this.x=a,this.y=u,this.key=$t(0,t,t,a,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){const a=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>a&&t.y===this.y>>a}url(t,a){const u=(function(_,x,S){var R=$s(256*_,256*(x=Math.pow(2,S)-x-1),S),L=$s(256*(_+1),256*(x+1),S);return R[0]+","+R[1]+","+L[0]+","+L[1]})(this.x,this.y,this.z),d=(function(_,x,S){let R,L="";for(let F=_;F>0;F--)R=1<<F-1,L+=(x&R?1:0)+(S&R?2:0);return L})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kt{constructor(t,a){this.wrap=t,this.canonical=a,this.key=$t(t,a.z,a.z,a.x,a.y)}}class Pt{constructor(t,a,u,d,_){this.overscaledZ=t,this.wrap=a,this.canonical=new Yr(u,+d,+_),this.key=a===0&&t===u?this.canonical.key:$t(a,t,u,d,_)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const a=this.canonical.z-t;return t>this.canonical.z?new Pt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Pt(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a=!0){if(this.overscaledZ===t&&a)return this.key;if(t>this.canonical.z)return $t(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-t;return $t(this.wrap*+a,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new Pt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new Pt(a,this.wrap,a,u,d),new Pt(a,this.wrap,a,u+1,d),new Pt(a,this.wrap,a,u,d+1),new Pt(a,this.wrap,a,u+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Pt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Pt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $t(o,t,a,u,d){const _=1<<Math.min(a,22);let x=_*(d%_)+u%_;return o&&a<22&&(x+=_*_*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*x+a)+(t-a)}const ln=[o=>{let t=o.canonical.x-1,a=o.wrap;return t<0&&(t=(1<<o.canonical.z)-1,a--),new Pt(o.overscaledZ,a,o.canonical.z,t,o.canonical.y)},o=>{let t=o.canonical.x+1,a=o.wrap;return t===1<<o.canonical.z&&(t=0,a++),new Pt(o.overscaledZ,a,o.canonical.z,t,o.canonical.y)},o=>new Pt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Pt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];oi(Yr,"CanonicalTileID"),oi(Pt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const _r=vr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Bs}=_r,Hr=vr([{name:"a_pos_3",components:3,type:"Int16"}]);var As=vr([{name:"a_pos",type:"Int16",components:2}]);function fa(o){return o*cs/p}const _s=[new Yi([zl,zl,zl],[rs,rs,rs]),new Yi([zl,zl,zl],[0,0,rs]),new Yi([0,zl,zl],[rs,0,rs]),new Yi([zl,0,zl],[0,rs,rs]),new Yi([0,0,zl],[rs,rs,rs])];function ic(o,t,a,u=!0){const d=Vt([],o._camera.position,o.worldSize),_=[t,a,1,1];De(_,_,o.pixelMatrixInverse),Gn(_,_,1/_[3]);const x=Ui([],Di([],_,d)),S=o.globeMatrix,R=[S[12],S[13],S[14]],L=Di([],R,d),F=kt(L),U=Ui([],L),G=o.worldSize/(2*Math.PI),X=rn(U,x),Z=Math.asin(G/F);if(Z<Math.acos(X)){if(!u)return null;const It=[],ut=[];Vt(It,x,F/X),Ui(ut,Di(ut,It,L)),Ui(x,et(x,L,Vt(x,ut,Math.tan(Z)*F)))}const ne=[];new Si(d,x).closestPointOnSphere(R,G,ne);const he=Ui([],Un(S,0)),ce=Ui([],Un(S,1)),_e=Ui([],Un(S,2)),xe=rn(he,ne),Ee=rn(ce,ne),ke=rn(_e,ne),Be=js(Math.asin(-Ee/G));let He=js(Math.atan2(xe,ke));He=o.center.lng+(function(It,ut){const Ot=(ut-It+180)%360-180;return Ot<-180?Ot+360:Ot})(o.center.lng,He);const Je=D(He),tt=oe(O(Be),0,1);return new be(Je,tt)}class Lu{constructor(t,a,u){this.a=Di([],t,u),this.b=Di([],a,u),this.center=u;const d=Ui([],this.a),_=Ui([],this.b);this.angle=Math.acos(rn(d,_))}}function Of(o,t){if(o.angle===0)return null;let a;return a=o.a[t]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[t]/o.a[t]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:(function(u,d,_,x){const S=Math.sin(_);return u*(Math.sin((1-x)*_)/S)+d*(Math.sin(x*_)/S)})(o.a[t],o.b[t],o.angle,oe(a,0,1))+o.center[t]}function uh(o){if(o.z<=1)return _s[o.z+2*o.y+o.x];const t=Mv(u0(o));return Yi.fromPoints(t)}function ks(o,t,a){return Vt(o,o,1-a),ii(o,o,t,a)}function Iy(o,t,a){for(const u of o)xn(u,u,t),Vt(u,u,a)}function vw(o,t,a,u){const d=t/o.worldSize,_=o.globeMatrix;if(a.z<=1){const tt=uh(a).getCorners();return Iy(tt,_,d),Yi.fromPoints(tt)}const x=u0(a,u),S=Mv(x,cs+fa(o._tileCoverLift));Iy(S,_,d);const R=Number.MAX_VALUE,L=[-R,-R,-R],F=[R,R,R];if(x.contains(o.center)){for(const ut of S)Ge(F,F,ut),Et(L,L,ut);L[2]=0;const tt=o.point,It=[tt.x*d,tt.y*d,0];return Ge(F,F,It),Et(L,L,It),new Yi(F,L)}if(o._tileCoverLift>0){for(const tt of S)Ge(F,F,tt),Et(L,L,tt);return new Yi(F,L)}const U=[_[12]*d,_[13]*d,_[14]*d],G=x.getCenter(),X=oe(o.center.lat,-ee,ee),Z=oe(G.lat,-ee,ee),ne=D(o.center.lng),he=O(X);let ce=ne-D(G.lng);const _e=he-O(Z);ce>.5?ce-=1:ce<-.5&&(ce+=1);let xe=0;Math.abs(ce)>Math.abs(_e)?xe=ce>=0?1:3:(xe=_e>=0?0:2,ii(U,U,[_[4]*d,_[5]*d,_[6]*d],-Math.sin(Ar(_e>=0?x.getSouth():x.getNorth()))*cs));const Ee=S[xe],ke=S[(xe+1)%4],Be=new Lu(Ee,ke,U),He=[Of(Be,0)||Ee[0],Of(Be,1)||Ee[1],Of(Be,2)||Ee[2]],Je=bc(o.zoom);if(Je>0){const tt=(function({x:ut,y:Ot,z:Zt},Yt,li,ui,ri){const si=1/(1<<Zt);let zt=ut*si,Dt=zt+si,ai=Ot*si,Ti=ai+si,pi=0;const dn=(zt+Dt)/2-ui;return dn>.5?pi=-1:dn<-.5&&(pi=1),zt=((zt+pi)*Yt-(ui*=Yt))*li+ui,Dt=((Dt+pi)*Yt-ui)*li+ui,ai=(ai*Yt-(ri*=Yt))*li+ri,Ti=(Ti*Yt-ri)*li+ri,[[zt,Ti,0],[Dt,Ti,0],[Dt,ai,0],[zt,ai,0]]})(a,t,o._pixelsPerMercatorPixel,ne,he);for(let ut=0;ut<S.length;ut++)ks(S[ut],tt[ut],Je);const It=et([],tt[xe],tt[(xe+1)%4]);Vt(It,It,.5),ks(He,It,Je)}for(const tt of S)Ge(F,F,tt),Et(L,L,tt);return F[2]=Math.min(Ee[2],ke[2]),Ge(F,F,He),Et(L,L,He),new Yi(F,L)}function u0({x:o,y:t,z:a},u=!1){const d=1/(1<<a),_=new c(H(o*d),t===(1<<a)-1&&u?-90:Q((t+1)*d)),x=new c(H((o+1)*d),t===0&&u?90:Q(t*d));return new m(_,x)}function Mv(o,t=cs){const a=Ar(o.getNorth()),u=Ar(o.getSouth()),d=Math.cos(a),_=Math.cos(u),x=Math.sin(a),S=Math.sin(u),R=o.getWest(),L=o.getEast();return[wa(_,S,R,t),wa(_,S,L,t),wa(d,x,L,t),wa(d,x,R,t)]}function h0(o,t,a,u){const d=1<<a.z,_=(o/gi+a.x)/d;return lo(Q((t/gi+a.y)/d),H(_),u)}function Dy({min:o,max:t}){return Wa/Math.max(t[0]-o[0],t[1]-o[1],t[2]-o[2])}const f0=new Float64Array(16);function nm(o){const t=Dy(o),a=je(f0,[t,t,t]);return ue(a,a,Fi([],o.min))}function d0(o){const t=(u=o.min,(a=f0)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const d=1/Dy(o);return me(t,t,[d,d,d])}function u_(o){const t=gi/(2*Math.PI);return o/(2*Math.PI)/t}function Ly(o,t){return gi/(512*Math.pow(2,o))*Dy(uh(t))}function rm(o,t,a,u,d){const _=u_(a),x=[o,t,-a/(2*Math.PI)],S=ie(new Float64Array(16));return ue(S,S,x),me(S,S,[_,_,_]),Ae(S,S,Ar(-d)),Se(S,S,Ar(-u)),S}function bc(o){return ge(go,zf,o)}function h_(o,t){const a=lo(t.lat,t.lng),u=(function(Z){const ne=lo(Z._center.lat,Z._center.lng);let he=Fn([],Re(0,1,0),ne);const ce=Ce([],-Z.angle,ne);he=xn(he,he,ce),Ce(ce,-Z._pitch,he);const _e=Ui([],ne);return Vt(_e,_e,fa(Z.cameraToCenterDistance/Z.pixelsPerMeter)),xn(_e,_e,ce),et([],ne,_e)})(o);return x=(d=Lt([],u,a))[0],S=d[1],R=d[2],L=(_=a)[0],F=_[1],U=_[2],X=(G=Math.sqrt((x*x+S*S+R*R)*(L*L+F*F+U*U)))&&rn(d,_)/G,Math.acos(Math.min(Math.max(X,-1),1));var d,_,x,S,R,L,F,U,G,X}function Ev(o,t){return h_(o,t)>Math.PI/2*1.01}const Av=Ar(85),bw=Math.cos(Av),ww=Math.sin(Av),Sw=$(),Tw=o=>{const t=[];return o.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function Py(o,t,a,u,d,_,x,S,R){if(_&&o.queryGeometry.isAboveHorizon)return!1;_&&(R*=o.pixelToTileUnitsFactor);const L=o.tileID.canonical,F=a.projection.upVectorScale(L,a.center.lat,a.worldSize).metersToTile;for(const U of t)for(const G of U){const X=G.add(S),Z=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(X.x,X.y,!0):0,ne=a.projection.projectTilePoint(X.x,X.y,L);if(Z>0){const xe=a.projection.upVector(L,X.x,X.y);ne.x+=xe[0]*F*Z,ne.y+=xe[1]*F*Z,ne.z+=xe[2]*F*Z}const he=_?X:Mw(ne.x,ne.y,ne.z,u),ce=_?o.tilespaceRays.map((xe=>Rv(xe,Z))):o.queryGeometry.screenGeometry,_e=De([],[ne.x,ne.y,ne.z,1],u);if(!x&&_?R*=_e[3]/a.cameraToCenterDistance:x&&!_&&(R*=a.cameraToCenterDistance/_e[3]),_){const xe=Q((G.y/gi+L.y)/(1<<L.z));R/=a.projection.pixelsPerMeter(xe,1)/V(1,xe)}if(qn(ce,he,R))return!0}return!1}function Mw(o,t,a,u){const d=De([],[o,t,a,1],u);return new Xt(d[0]/d[3],d[1]/d[3])}const Cv=Re(0,0,0),uE=Re(0,0,1);function Rv(o,t){const a=mt();return Cv[2]=t,o.intersectsPlane(Cv,uE,a),new Xt(a[0],a[1])}class zy extends Sr{}let Ew,Aw,f_,Cw;function Iv(o,{width:t,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*a*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(t*a*u);return o.width=t,o.height=a,o.data=d,o}function Zs(o,t,a){const{width:u,height:d}=t;u===o.width&&d===o.height||(p0(o,t,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,d)},a,null),o.width=u,o.height=d,o.data=t.data)}function p0(o,t,a,u,d,_,x,S){if(d.width===0||d.height===0)return t;if(d.width>o.width||d.height>o.height||a.x>o.width-d.width||a.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||u.x>t.width-d.width||u.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const R=o.data,L=t.data,F=_===4&&S;for(let U=0;U<d.height;U++){const G=((a.y+U)*o.width+a.x)*_,X=((u.y+U)*t.width+u.x)*_;if(F)for(let Z=0;Z<d.width;Z++){const ne=G+Z*_+3,he=X+Z*_;L[he+0]=255,L[he+1]=255,L[he+2]=255,L[he+3]=R[ne]}else if(x)for(let Z=0;Z<d.width;Z++){const ne=G+Z*_,he=X+Z*_,ce=new qr(R[ne+0]/255,R[ne+1]/255,R[ne+2]/255,R[ne+3]).toNonPremultipliedRenderColor(x).toArray();L[he+0]=ce[0],L[he+1]=ce[1],L[he+2]=ce[2],L[he+3]=ce[3]}else for(let Z=0;Z<d.width*_;Z++)L[X+Z]=R[G+Z]}return t}oi(zy,"HeatmapBucket",{omit:["layers"]});class Ld{constructor(t,a){Iv(this,t,1,a)}resize(t){Zs(this,new Ld(t),1)}clone(){return new Ld({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,d,_){p0(t,a,u,d,_,1,null)}}class Uo{constructor(t,a){Iv(this,t,4,a)}resize(t){Zs(this,new Uo(t),4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,d,_,x,S){p0(t,a,u,d,_,4,x,S)}}class Dv{constructor(t,a){this.width=t.width,this.height=t.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Rg(o){const t={},a=o.resolution||256,u=o.clips?o.clips.length:1,d=o.image||new Uo({width:a,height:u}),_=(x,S,R)=>{t[o.evaluationKey]=R;const L=o.expression.evaluate(t),F=L?L.toNonPremultipliedRenderColor(null):null;F&&(d.data[x+S+0]=Math.floor(255*F.r),d.data[x+S+1]=Math.floor(255*F.g),d.data[x+S+2]=Math.floor(255*F.b),d.data[x+S+3]=Math.floor(255*F.a))};if(o.clips)for(let x=0,S=0;x<u;++x,S+=4*a)for(let R=0,L=0;R<a;R++,L+=4){const F=R/(a-1),{start:U,end:G}=o.clips[x];_(S,L,U*(1-F)+G*F)}else for(let x=0,S=0;x<a;x++,S+=4)_(0,S,x/(a-1));return d}oi(Ld,"AlphaImage"),oi(Uo,"RGBAImage");const m0=vr([{name:"a_pos",components:2,type:"Int16"}],4),Oy=vr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),hE=vr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Rw=vr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function d_(o,t,a=2){const u=t&&t.length,d=u?t[0]*a:o.length;let _=Iw(o,0,d,a,!0);const x=[];if(!_||_.next===_.prev)return x;let S,R,L;if(u&&(_=(function(F,U,G,X){const Z=[];for(let ne=0,he=U.length;ne<he;ne++){const ce=Iw(F,U[ne]*X,ne<he-1?U[ne+1]*X:F.length,X,!1);ce===ce.next&&(ce.steiner=!0),Z.push(By(ce))}Z.sort(Dw);for(let ne=0;ne<Z.length;ne++)G=dE(Z[ne],G);return G})(o,t,_,a)),o.length>80*a){S=o[0],R=o[1];let F=S,U=R;for(let G=a;G<d;G+=a){const X=o[G],Z=o[G+1];X<S&&(S=X),Z<R&&(R=Z),X>F&&(F=X),Z>U&&(U=Z)}L=Math.max(F-S,U-R),L=L!==0?32767/L:0}return p_(_,x,a,S,R,L,0),x}function Iw(o,t,a,u,d){let _;if(d===(function(x,S,R,L){let F=0;for(let U=S,G=R-L;U<R;U+=L)F+=(x[G]-x[U])*(x[U+1]+x[G+1]),G=U;return F})(o,t,a,u)>0)for(let x=t;x<a;x+=u)_=sm(x/u|0,o[x],o[x+1],_);else for(let x=a-u;x>=t;x-=u)_=sm(x/u|0,o[x],o[x+1],_);return _&&g_(_,_.next)&&(__(_),_=_.next),_}function $m(o,t){if(!o)return o;t||(t=o);let a,u=o;do if(a=!1,u.steiner||!g_(u,u.next)&&co(u.prev,u,u.next)!==0)u=u.next;else{if(__(u),u=t=u.prev,u===u.next)break;a=!0}while(a||u!==t);return t}function p_(o,t,a,u,d,_,x){if(!o)return;!x&&_&&(function(R,L,F,U){let G=R;do G.z===0&&(G.z=g0(G.x,G.y,L,F,U)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==R);G.prevZ.nextZ=null,G.prevZ=null,(function(X){let Z,ne=1;do{let he,ce=X;X=null;let _e=null;for(Z=0;ce;){Z++;let xe=ce,Ee=0;for(let Be=0;Be<ne&&(Ee++,xe=xe.nextZ,xe);Be++);let ke=ne;for(;Ee>0||ke>0&&xe;)Ee!==0&&(ke===0||!xe||ce.z<=xe.z)?(he=ce,ce=ce.nextZ,Ee--):(he=xe,xe=xe.nextZ,ke--),_e?_e.nextZ=he:X=he,he.prevZ=_e,_e=he;ce=xe}_e.nextZ=null,ne*=2}while(Z>1)})(G)})(o,u,d,_);let S=o;for(;o.prev!==o.next;){const R=o.prev,L=o.next;if(_?Lv(o,u,d,_):za(o))t.push(R.i,o.i,L.i),__(o),o=L.next,S=L.next;else if((o=L)===S){x?x===1?p_(o=wc($m(o),t),t,a,u,d,_,2):x===2&&fE(o,t,a,u,d,_):p_($m(o),t,a,u,d,_,1);break}}}function za(o){const t=o.prev,a=o,u=o.next;if(co(t,a,u)>=0)return!1;const d=t.x,_=a.x,x=u.x,S=t.y,R=a.y,L=u.y,F=Math.min(d,_,x),U=Math.min(S,R,L),G=Math.max(d,_,x),X=Math.max(S,R,L);let Z=u.next;for(;Z!==t;){if(Z.x>=F&&Z.x<=G&&Z.y>=U&&Z.y<=X&&m_(d,S,_,R,x,L,Z.x,Z.y)&&co(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function Lv(o,t,a,u){const d=o.prev,_=o,x=o.next;if(co(d,_,x)>=0)return!1;const S=d.x,R=_.x,L=x.x,F=d.y,U=_.y,G=x.y,X=Math.min(S,R,L),Z=Math.min(F,U,G),ne=Math.max(S,R,L),he=Math.max(F,U,G),ce=g0(X,Z,t,a,u),_e=g0(ne,he,t,a,u);let xe=o.prevZ,Ee=o.nextZ;for(;xe&&xe.z>=ce&&Ee&&Ee.z<=_e;){if(xe.x>=X&&xe.x<=ne&&xe.y>=Z&&xe.y<=he&&xe!==d&&xe!==x&&m_(S,F,R,U,L,G,xe.x,xe.y)&&co(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Ee.x>=X&&Ee.x<=ne&&Ee.y>=Z&&Ee.y<=he&&Ee!==d&&Ee!==x&&m_(S,F,R,U,L,G,Ee.x,Ee.y)&&co(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;xe&&xe.z>=ce;){if(xe.x>=X&&xe.x<=ne&&xe.y>=Z&&xe.y<=he&&xe!==d&&xe!==x&&m_(S,F,R,U,L,G,xe.x,xe.y)&&co(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Ee&&Ee.z<=_e;){if(Ee.x>=X&&Ee.x<=ne&&Ee.y>=Z&&Ee.y<=he&&Ee!==d&&Ee!==x&&m_(S,F,R,U,L,G,Ee.x,Ee.y)&&co(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function wc(o,t){let a=o;do{const u=a.prev,d=a.next.next;!g_(u,d)&&Bv(u,a,a.next,d)&&y0(u,d)&&y0(d,u)&&(t.push(u.i,a.i,d.i),__(a),__(a.next),a=o=d),a=a.next}while(a!==o);return $m(a)}function fE(o,t,a,u,d,_){let x=o;do{let S=x.next.next;for(;S!==x.prev;){if(x.i!==S.i&&Ov(x,S)){let R=Lw(x,S);return x=$m(x,x.next),R=$m(R,R.next),p_(x,t,a,u,d,_,0),void p_(R,t,a,u,d,_,0)}S=S.next}x=x.next}while(x!==o)}function Dw(o,t){let a=o.x-t.x;return a===0&&(a=o.y-t.y,a===0)&&(a=(o.next.y-o.y)/(o.next.x-o.x)-(t.next.y-t.y)/(t.next.x-t.x)),a}function dE(o,t){const a=(function(d,_){let x=_;const S=d.x,R=d.y;let L,F=-1/0;if(g_(d,x))return x;do{if(g_(d,x.next))return x.next;if(R<=x.y&&R>=x.next.y&&x.next.y!==x.y){const ne=x.x+(R-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ne<=S&&ne>F&&(F=ne,L=x.x<x.next.x?x:x.next,ne===S))return L}x=x.next}while(x!==_);if(!L)return null;const U=L,G=L.x,X=L.y;let Z=1/0;x=L;do{if(S>=x.x&&x.x>=G&&S!==x.x&&zv(R<X?S:F,R,G,X,R<X?F:S,R,x.x,x.y)){const ne=Math.abs(R-x.y)/(S-x.x);y0(x,d)&&(ne<Z||ne===Z&&(x.x>L.x||x.x===L.x&&Pv(L,x)))&&(L=x,Z=ne)}x=x.next}while(x!==U);return L})(o,t);if(!a)return t;const u=Lw(a,o);return $m(u,u.next),$m(a,a.next)}function Pv(o,t){return co(o.prev,o,t.prev)<0&&co(t.next,o,o.next)<0}function g0(o,t,a,u,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*d|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function By(o){let t=o,a=o;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==o);return a}function zv(o,t,a,u,d,_,x,S){return(d-x)*(t-S)>=(o-x)*(_-S)&&(o-x)*(u-S)>=(a-x)*(t-S)&&(a-x)*(_-S)>=(d-x)*(u-S)}function m_(o,t,a,u,d,_,x,S){return!(o===x&&t===S)&&zv(o,t,a,u,d,_,x,S)}function Ov(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!(function(a,u){let d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&Bv(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1})(o,t)&&(y0(o,t)&&y0(t,o)&&(function(a,u){let d=a,_=!1;const x=(a.x+u.x)/2,S=(a.y+u.y)/2;do d.y>S!=d.next.y>S&&d.next.y!==d.y&&x<(d.next.x-d.x)*(S-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==a);return _})(o,t)&&(co(o.prev,o,t.prev)||co(o,t.prev,t))||g_(o,t)&&co(o.prev,o,o.next)>0&&co(t.prev,t,t.next)>0)}function co(o,t,a){return(t.y-o.y)*(a.x-t.x)-(t.x-o.x)*(a.y-t.y)}function g_(o,t){return o.x===t.x&&o.y===t.y}function Bv(o,t,a,u){const d=_0(co(o,t,a)),_=_0(co(o,t,u)),x=_0(co(a,u,o)),S=_0(co(a,u,t));return d!==_&&x!==S||!(d!==0||!Ny(o,a,t))||!(_!==0||!Ny(o,u,t))||!(x!==0||!Ny(a,o,u))||!(S!==0||!Ny(a,t,u))}function Ny(o,t,a){return t.x<=Math.max(o.x,a.x)&&t.x>=Math.min(o.x,a.x)&&t.y<=Math.max(o.y,a.y)&&t.y>=Math.min(o.y,a.y)}function _0(o){return o>0?1:o<0?-1:0}function y0(o,t){return co(o.prev,o,o.next)<0?co(o,t,o.next)>=0&&co(o,o.prev,t)>=0:co(o,t,o.prev)<0||co(o,o.next,t)<0}function Lw(o,t){const a=Fy(o.i,o.x,o.y),u=Fy(t.i,t.x,t.y),d=o.next,_=t.prev;return o.next=t,t.prev=o,a.next=d,d.prev=a,u.next=a,a.prev=u,_.next=u,u.prev=_,u}function sm(o,t,a,u){const d=Fy(o,t,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function __(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Fy(o,t,a){return{i:o,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ig(o,t){const a=o.length;if(a<=1)return[o];const u=[];let d,_;for(let x=0;x<a;x++){const S=mi(o[x]);S!==0&&(o[x].area=Math.abs(S),_===void 0&&(_=S<0),_===S<0?(d&&u.push(d),d=[o[x]]):d.push(o[x]))}if(d&&u.push(d),t>1)for(let x=0;x<u.length;x++)u[x].length<=t||(Eh(u[x],t,1,u[x].length-1,pE),u[x]=u[x].slice(0,t));return u}function pE(o,t){return t.area-o.area}function Pw(o,t,a=1){if(!o)return null;const u=typeof o=="string"?Fa.from(o).getPrimary():o.getPrimary(),d=typeof o=="string"?null:o.getSecondary();for(const _ of[u,d]){if(!_)continue;const x=_.id.toString();t.has(x)||t.set(x,[]),_.scaleSelf(a),t.get(x).push(_)}return{primary:u.toString(),secondary:d?d.toString():null}}function Uy(o,t,a,u){const d=u.patternDependencies;let _=!1;for(const x of t){const S=x.paint.get(`${o}-pattern`);S.isConstant()||(_=!0),Pw(S.constantOr(null),d,a)&&(_=!0)}return _}function x0(o,t,a,u,d,_){const x=_.patternDependencies;for(const S of t){const R=S.paint.get(`${o}-pattern`).value;if(R.kind!=="constant"){let L=R.evaluate({zoom:u},a,{},_.availableImages);L=L&&L.name?L.name:L;const F=Pw(L,x,d);if(!F)continue;const{primary:U,secondary:G}=F;U&&(a.patterns[S.id]=[U,G].filter(Boolean))}}return a}class ky{constructor(){this.polygons=new Map}add(t,...a){const u=this.polygons.get(t);u?u.push(...a):this.polygons.set(t,a)}merge(t){for(const[a,u]of t.polygons)this.add(a,...u)}}class am{constructor(){this.portals=[]}static isOnBorder(t,a){return t<=0&&a<=0||t>=gi&&a>=gi}static evaluate(t){if(t.length===0)return new am;let a=[];for(const R of t)a.push(...R.portals);if(a.length===0)return new am;for(const R of a){const L=R.va,F=R.vb;(am.isOnBorder(L.x,F.x)||am.isOnBorder(L.y,F.y))&&(R.type="border")}const u=a.filter((R=>R.type!=="unevaluated")),d=a.filter((R=>R.type==="unevaluated"));if(d.length===0)return new am;d.sort(((R,L)=>R.hash===L.hash?R.isTunnel===L.isTunnel?0:R.isTunnel?-1:1:R.hash<L.hash?1:-1)),a=u.concat(d);let _=u.length,x=_,S=_;do if(x++,x===a.length||a[_].hash!==a[x].hash){if(x-_==2){S<_&&(a[S]=a[_],a[_]=null);const R=a[S],L=a[x-1];R.type=R.isTunnel!==L.isTunnel?"tunnel":"polygon",R.connection={a:R.connection.a,b:L.connection.a},S++}_=x}while(_!==a.length);return a.splice(S),a.sort(((R,L)=>R.hash<L.hash?1:-1)),{portals:a}}}oi(am,"ElevationPortalGraph"),oi(ky,"ElevationPolygons");class Bf{constructor(t,a,u){this.outPositions=t,this.outNormals=a,this.outIndices=u,this.vertexLookup=new Map}addVertex(t,a,u){let d=t[2];u!=null&&(d*=u);const _=`${t[0]},${t[1]},${t[2]},${a[0]},${a[1]},${a[2]}`,x=this.vertexLookup.get(_);if(x!=null)return x;const S=this.outPositions.length;this.vertexLookup.set(_,S);const R=Math.trunc(16384*a[0]),L=Math.trunc(16384*a[1]),F=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(t[0],t[1],d),this.outNormals.emplaceBack(R,L,F),S}addTriangle(t,a,u){this.outIndices.emplaceBack(t,a,u)}addTriangles(t,a,u){if(t.length===0)return;const d=u.length===1,_=mt(),x=mt();for(let S=0;S<t.length;S+=3){const R=a[t[S+0]],L=a[t[S+1]],F=a[t[S+2]],U=d?u[0]:u[t[S+1]],G=d?u[0]:u[t[S+2]];Qe(_,R.x,R.y,d?u[0]:u[t[S+0]]);const X=this.addVertex(_,x);Qe(_,L.x,L.y,U);const Z=this.addVertex(_,x);Qe(_,F.x,F.y,G);const ne=this.addVertex(_,x);this.outIndices.emplaceBack(X,Z,ne)}}addQuad(t,a,u,d,_,x){const S=this.addVertex(t,_,x),R=this.addVertex(a,_,x),L=this.addVertex(u,_,x),F=this.addVertex(d,_,x);this.addTriangle(S,R,L),this.addTriangle(L,F,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Sc{constructor(t,a,u,d){this.unevaluatedPortals=new am,this.portalPolygons=new ky,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Qp,this.vertexNormals=new So,this.indexArray=new Aa,this.tileToMeters=de(t),this.bridgeProgramConfigurations=new na(a,{zoom:u,lut:d},(_=>_!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new na(a,{zoom:u,lut:d},(_=>_!=="fill-bridge-guard-rail-color"))}addVertices(t,a){const u=this.unevalVertices.length;for(let d=0;d<t.length;d++)this.unevalVertices.push(t[d]),this.unevalHeights.push(a[d]);return u}addTriangles(t,a,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of t)d.push(_+a)}addRenderableRing(t,a,u,d,_,x){const S=[new Xt(_.min.x,_.min.y),new Xt(_.max.x,_.min.y),new Xt(_.max.x,_.max.y),new Xt(_.min.x,_.max.y)];for(let R=0;R<u-1;R++){const L=a+R,F=L+1,U=this.unevalVertices[L],G=this.unevalVertices[F];if(!(U.x>=_.min.x&&U.x<=_.max.x&&U.y>=_.min.y&&U.y<=_.max.y||G.x>=_.min.x&&G.x<=_.max.x&&G.y>=_.min.y&&G.y<=_.max.y||We(U,G,S))||this.isOnBorder(U.x,G.x)||this.isOnBorder(U.y,G.y))continue;const X=Sc.computeEdgeHash(this.unevalVertices[L],this.unevalVertices[F]);let Z,ne=this.vertexHashLookup.get(Sc.computePosHash(U));ne!=null?Z=ne.next:(ne=this.vertexHashLookup.get(Sc.computePosHash(G)),Z=ne!=null?ne.prev:X),this.unevalEdges.push({polygonIdx:t,a:L,b:F,hash:X,portalHash:Z,isTunnel:d,type:"unevaluated",featureInfo:x})}}addPortalCandidates(t,a,u,d,_){if(a.length===0)return;this.portalPolygons.add(t,{geometry:a,zLevel:_});const x=a[0];this.vertexHashLookup.clear();let S=Sc.computeEdgeHash(x[x.length-2],x[x.length-1]);for(let R=0;R<x.length-1;R++){const L=x[R+0],F=x[R+1],U=Xn(F.x-L.x,F.y-L.y),G=wn(U);if(G===0)continue;let X="unevaluated";const Z=d.pointElevation(L),ne=d.pointElevation(F);Math.abs(Z)<.01&&Math.abs(ne)<.01?X="entrance":(this.isOnBorder(L.x,F.x)||this.isOnBorder(L.y,F.y))&&(X="border");const he=Sc.computeEdgeHash(L,F);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:L,vb:F,vab:U,length:G,hash:he,isTunnel:u,type:X});const ce=Sc.computePosHash(L);this.vertexHashLookup.set(ce,{prev:S,next:he}),S=he}}construct(t){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=G=>{G.primitiveLength=this.indexArray.length-G.primitiveOffset},d=new Bf(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const _=a(),x=a(),S=a(),R=(G,X)=>{G.sort(((ne,he)=>ne.type===X&&he.type!==X?-1:ne.type!==X&&he.type===X?1:0));const Z=G.findIndex((ne=>ne.type!==X));return Z>=0?Z:G.length};let L=0;this.unevalEdges.length>0&&(L=R(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:L},this.tileToMeters)),u(S);const F=a(),U=a();if(this.unevalEdges.length>0){const G=this.unevalEdges.splice(L),X=R(G,"tunnel")+L;this.unevalEdges.push(...G),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:L},{min:L,max:X})}u(F),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(U),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(x),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(_),this.maskSegments=Es.simpleSegment(0,U.primitiveOffset,0,U.primitiveLength),this.depthSegments=Es.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableBridgeSegments=Es.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=Es.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.shadowCasterSegments=Es.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(t,a,u,d,_,x,S,R){this.bridgeProgramConfigurations.updatePaintArrays(t,a,_,u,d,x,S,R),this.tunnelProgramConfigurations.updatePaintArrays(t,a,_,u,d,x,S,R)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,hE.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,Rw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,a,u,d,_){const x=(S,R)=>{for(let L=0;L<R.length-1;L++){const F=R[L].featureIndex,U=R[L+1].vertexStart,G=t.feature(F);S.populatePaintArrays(U,G,F,{},u,a,d,void 0,_)}};x(this.bridgeProgramConfigurations,this.bridgeFeatureSections),x(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,a,u,d,_){const x=new Map;for(let S=d;S<_;S++){const R=u[S],L=R.a,F=R.b,U=Sc.computePosHash(t[L]),G=Sc.computePosHash(t[F]);let X=x.get(U);X||(X={},x.set(U,X));let Z=x.get(G);Z||(Z={},x.set(G,Z)),a[L]<=0&&a[F]<=0||(X.to=F,Z.from=L)}return x}isTerminalVertex(t,a){const u=Sc.computePosHash(this.unevalVertices[t]),d=a.get(u);return!d||!d.from||!d.to}constructBridgeStructures(t,a,u,d,_,x){t.clearVertexLookup();const S=this.computeVertexConnections(a,u,d,_.min,_.max),R=1/x,L=.5*R,F=(li,ui)=>Qe(li,a[ui].x,a[ui].y,u[ui]*R),U=mt(),G=mt(),X=mt(),Z=mt(),ne=mt(),he=(li,ui)=>{const ri=S.get(Sc.computePosHash(a[ui])),si=ri.from,zt=ri.to;if(!si||!zt)return;F(U,si),F(G,ui),F(X,zt),Xi(Z),Ji(U,G)||(Di(ne,G,U),Ui(Z,ne)),Ji(X,G)||(Di(ne,X,G),et(Z,Z,Ui(ne,ne)));const Dt=Sn(Z);return Dt>0?Vt(li,Z,1/Dt):void 0};let ce=Number.POSITIVE_INFINITY;this.sortSubarray(d,_.min,_.max,((li,ui)=>li.featureInfo.featureIndex-ui.featureInfo.featureIndex));const _e=mt(),xe=mt(),Ee=mt(),ke=mt(),Be=mt(),He=mt(),Je=mt(),tt=mt(),It=mt(),ut=[mt(),mt(),mt(),mt()],Ot=[mt(),mt(),mt(),mt()],Zt=[{coord:new Xt(0,0),height:0},{coord:new Xt(0,0),height:0}],Yt=(li,ui)=>li>ui;for(let li=_.min;li<_.max;li++){const ui=d[li];if(!ui.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Zt,a,u,ui,Yt))continue;const[ri,si]=Zt;if(Qe(_e,ri.coord.x,ri.coord.y,R*ri.height),Qe(xe,si.coord.x,si.coord.y,R*si.height),Ji(_e,xe))continue;Di(Ee,xe,_e),Ui(Ee,Ee);const zt=he(tt,ui.a)||Ee,Dt=he(It,ui.b)||Ee;Qe(ke,zt[1],-zt[0],0),Ui(ke,ke),Qe(Be,Dt[1],-Dt[0],0),Ui(Be,Be),Fn(tt,ke,zt),Ui(He,tt),Fn(tt,Be,Dt),Ui(Je,tt),et(ut[0],_e,Vt(tt,Di(tt,ke,He),L)),et(ut[1],_e,Vt(tt,et(tt,ke,He),L)),et(ut[2],_e,Vt(tt,He,L)),ut[3]=_e,et(Ot[0],xe,Vt(tt,Di(tt,Be,Je),L)),et(Ot[1],xe,Vt(tt,et(tt,Be,Je),L)),et(Ot[2],xe,Vt(tt,Je,L)),Ot[3]=xe,ce=this.addFeatureSection(ui.featureInfo.featureIndex,ce,this.bridgeFeatureSections,t);const ai=t.addVertex(ut[0],ke,x),Ti=t.addVertex(ut[1],ke,x),pi=t.addVertex(Ot[0],Be,x),dn=t.addVertex(Ot[1],Be,x);t.addTriangle(ai,Ti,pi),t.addTriangle(Ti,dn,pi);const Gi=t.addVertex(ut[1],He,x),Ki=t.addVertex(ut[2],He,x),cn=t.addVertex(Ot[1],Je,x),yr=t.addVertex(Ot[2],Je,x);t.addTriangle(Gi,Ki,cn),t.addTriangle(Ki,yr,cn),Fi(ke,ke),Fi(Be,Be);const yi=t.addVertex(ut[2],ke,x),un=t.addVertex(ut[3],ke,x),Yn=t.addVertex(Ot[2],Be,x),Ur=t.addVertex(Ot[3],Be,x);t.addTriangle(yi,un,Yn),t.addTriangle(un,Ur,Yn);const jr=this.isTerminalVertex(ui.a,S),cr=this.isTerminalVertex(ui.b,S);ri.height<.01&&jr&&t.addQuad(ut[3],ut[2],ut[1],ut[0],Fi(zt,zt),x),si.height<.01&&cr&&t.addQuad(Ot[0],Ot[1],Ot[2],Ot[3],Dt,x)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,a,u,d,_,x){t.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const R=(ce,_e)=>ce.featureInfo.featureIndex-_e.featureInfo.featureIndex;this.sortSubarray(d,_.min,_.max,R),this.sortSubarray(d,x.min,x.max,R);const L=ce=>Ui(ce,ce),F=[{coord:new Xt(0,0),height:0},{coord:new Xt(0,0),height:0}],U=(ce,_e)=>ce<_e,G=mt(),X=mt(),Z=mt(),ne=mt(),he=mt();for(let ce=_.min;ce<_.max;ce++){if(!this.prepareEdgePoints(F,a,u,d[ce],U))continue;const[_e,xe]=F,Ee=L(Qe(he,-(xe.coord.y-_e.coord.y),xe.coord.x-_e.coord.x,0));S=this.addFeatureSection(d[ce].featureInfo.featureIndex,S,this.tunnelFeatureSections,t),t.addQuad(Qe(G,_e.coord.x,_e.coord.y,_e.height),Qe(X,xe.coord.x,xe.coord.y,xe.height),Qe(Z,xe.coord.x,xe.coord.y,d[ce].isTunnel?-.1:0),Qe(ne,_e.coord.x,_e.coord.y,d[ce].isTunnel?-.1:0),Ee)}for(let ce=x.min;ce<x.max;ce++){const _e=d[ce];_e.isTunnel&&([_e.a,_e.b]=[_e.b,_e.a]);const xe=a[_e.a],Ee=a[_e.b],ke=L(Qe(he,-(Ee.y-xe.y),Ee.x-xe.x,0));S=this.addFeatureSection(_e.featureInfo.featureIndex,S,this.tunnelFeatureSections,t),t.addQuad(Qe(G,Ee.x,Ee.y,0),Qe(X,xe.x,xe.y,0),Qe(Z,xe.x,xe.y,u[_e.a]+4),Qe(ne,Ee.x,Ee.y,u[_e.b]+4),ke),t.addQuad(Qe(G,xe.x,xe.y,0),Qe(X,Ee.x,Ee.y,0),Qe(Z,Ee.x,Ee.y,u[_e.b]+4),Qe(ne,xe.x,xe.y,u[_e.a]+4),ke)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,a,u,d){t.coord.x=a,t.coord.y=u,t.height=d}prepareEdgePoints(t,a,u,d,_){let x=a[d.a].x,S=a[d.a].y,R=a[d.b].x,L=a[d.b].y,F=u[d.a],U=u[d.b];const G=_(F,0),X=_(U,0);if(G&&X)return this.setElevatedPoint(t[0],x,S,F),this.setElevatedPoint(t[1],R,L,U),!0;if(!G&&!X)return!1;if(G){if(!X){const Z=U/(U-F);R=Rn(R,x,Z),L=Rn(L,S,Z),U=Rn(U,F,Z)}}else{const Z=F/(F-U);x=Rn(x,R,Z),S=Rn(S,L,Z),F=Rn(F,U,Z)}return this.setElevatedPoint(t[0],x,S,F),this.setElevatedPoint(t[1],R,L,U),!0}prepareEdges(t,a){if(a.length===0)return;a.sort(((S,R)=>S.hash===R.hash?R.polygonIdx-S.polygonIdx:R.hash>S.hash?1:-1));let u=0,d=0,_=0,x=a[u].polygonIdx;do d++,(d===a.length||a[u].hash!==a[d].hash)&&((d-u==1||a[d-1].polygonIdx!==x)&&(_<u&&(a[_]=a[u],a[u]=null),a[_].type="none",_++),u=d,u!==a.length&&(x=a[u].polygonIdx));while(u!==a.length);if(a.splice(_),a.length!==0&&t.length!==0){a.sort(((L,F)=>L.portalHash<F.portalHash?1:-1));let S=0,R=0;for(;S!==a.length&&R!==t.length;){const L=a[S],F=t[R];L.portalHash>F.hash?S++:F.hash>L.portalHash?R++:(L.type=F.type,S++)}}}isOnBorder(t,a){return t<=0&&a<=0||t>=gi&&a>=gi}addFeatureSection(t,a,u,d){return t!==a&&(a=t,u.push({featureIndex:t,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),a}sortSubarray(t,a,u,d){const _=t.slice(a,u);_.sort(d),t.splice(a,_.length,..._)}static computeEdgeHash(t,a){return(t.y===a.y&&t.x>a.x||t.y>a.y)&&([t,a]=[a,t]),BigInt(Sc.computePosHash(t))<<32n|BigInt(Sc.computePosHash(a))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}var Nv,Fv={exports:{}},Uv=(Nv||(Nv=1,(function(o){function t(Fe,Ve){return Fe>Ve?1:Fe<Ve?-1:0}var a=function(Fe,Ve){Fe===void 0&&(Fe=t),Ve===void 0&&(Ve=!1),this._compare=Fe,this._root=null,this._size=0,this._noDuplicates=!!Ve},u={size:{configurable:!0}};function d(Fe,Ve,Bt,ci,Bi){var Ni=Bi-ci;if(Ni>0){var mn=ci+Math.floor(Ni/2),yn={key:Ve[mn],data:Bt[mn],parent:Fe};return yn.left=d(yn,Ve,Bt,ci,mn),yn.right=d(yn,Ve,Bt,mn+1,Bi),yn}return null}function _(Fe,Ve,Bt,ci,Bi){if(!(Bt>=ci)){for(var Ni=Fe[Bt+ci>>1],mn=Bt-1,yn=ci+1;;){do mn++;while(Bi(Fe[mn],Ni)<0);do yn--;while(Bi(Fe[yn],Ni)>0);if(mn>=yn)break;var sr=Fe[mn];Fe[mn]=Fe[yn],Fe[yn]=sr,sr=Ve[mn],Ve[mn]=Ve[yn],Ve[yn]=sr}_(Fe,Ve,Bt,yn,Bi),_(Fe,Ve,yn+1,ci,Bi)}}a.prototype.rotateLeft=function(Fe){var Ve=Fe.right;Ve&&(Fe.right=Ve.left,Ve.left&&(Ve.left.parent=Fe),Ve.parent=Fe.parent),Fe.parent?Fe===Fe.parent.left?Fe.parent.left=Ve:Fe.parent.right=Ve:this._root=Ve,Ve&&(Ve.left=Fe),Fe.parent=Ve},a.prototype.rotateRight=function(Fe){var Ve=Fe.left;Ve&&(Fe.left=Ve.right,Ve.right&&(Ve.right.parent=Fe),Ve.parent=Fe.parent),Fe.parent?Fe===Fe.parent.left?Fe.parent.left=Ve:Fe.parent.right=Ve:this._root=Ve,Ve&&(Ve.right=Fe),Fe.parent=Ve},a.prototype._splay=function(Fe){for(;Fe.parent;){var Ve=Fe.parent;Ve.parent?Ve.left===Fe&&Ve.parent.left===Ve?(this.rotateRight(Ve.parent),this.rotateRight(Ve)):Ve.right===Fe&&Ve.parent.right===Ve?(this.rotateLeft(Ve.parent),this.rotateLeft(Ve)):Ve.left===Fe&&Ve.parent.right===Ve?(this.rotateRight(Ve),this.rotateLeft(Ve)):(this.rotateLeft(Ve),this.rotateRight(Ve)):Ve.left===Fe?this.rotateRight(Ve):this.rotateLeft(Ve)}},a.prototype.splay=function(Fe){for(var Ve,Bt,ci,Bi,Ni;Fe.parent;)(Bt=(Ve=Fe.parent).parent)&&Bt.parent?((ci=Bt.parent).left===Bt?ci.left=Fe:ci.right=Fe,Fe.parent=ci):(Fe.parent=null,this._root=Fe),Bi=Fe.left,Ni=Fe.right,Fe===Ve.left?(Bt&&(Bt.left===Ve?(Ve.right?(Bt.left=Ve.right,Bt.left.parent=Bt):Bt.left=null,Ve.right=Bt,Bt.parent=Ve):(Bi?(Bt.right=Bi,Bi.parent=Bt):Bt.right=null,Fe.left=Bt,Bt.parent=Fe)),Ni?(Ve.left=Ni,Ni.parent=Ve):Ve.left=null,Fe.right=Ve,Ve.parent=Fe):(Bt&&(Bt.right===Ve?(Ve.left?(Bt.right=Ve.left,Bt.right.parent=Bt):Bt.right=null,Ve.left=Bt,Bt.parent=Ve):(Ni?(Bt.left=Ni,Ni.parent=Bt):Bt.left=null,Fe.right=Bt,Bt.parent=Fe)),Bi?(Ve.right=Bi,Bi.parent=Ve):Ve.right=null,Fe.left=Ve,Ve.parent=Fe)},a.prototype.replace=function(Fe,Ve){Fe.parent?Fe===Fe.parent.left?Fe.parent.left=Ve:Fe.parent.right=Ve:this._root=Ve,Ve&&(Ve.parent=Fe.parent)},a.prototype.minNode=function(Fe){if(Fe===void 0&&(Fe=this._root),Fe)for(;Fe.left;)Fe=Fe.left;return Fe},a.prototype.maxNode=function(Fe){if(Fe===void 0&&(Fe=this._root),Fe)for(;Fe.right;)Fe=Fe.right;return Fe},a.prototype.insert=function(Fe,Ve){var Bt=this._root,ci=null,Bi=this._compare;if(this._noDuplicates)for(;Bt;){if(ci=Bt,Bi(Bt.key,Fe)===0)return;Bt=Bi(Bt.key,Fe)<0?Bt.right:Bt.left}else for(;Bt;)ci=Bt,Bt=Bi(Bt.key,Fe)<0?Bt.right:Bt.left;return Bt={key:Fe,data:Ve,left:null,right:null,parent:ci},ci?Bi(ci.key,Bt.key)<0?ci.right=Bt:ci.left=Bt:this._root=Bt,this.splay(Bt),this._size++,Bt},a.prototype.find=function(Fe){for(var Ve=this._root,Bt=this._compare;Ve;){var ci=Bt(Ve.key,Fe);if(ci<0)Ve=Ve.right;else{if(!(ci>0))return Ve;Ve=Ve.left}}return null},a.prototype.contains=function(Fe){for(var Ve=this._root,Bt=this._compare;Ve;){var ci=Bt(Fe,Ve.key);if(ci===0)return!0;Ve=ci<0?Ve.left:Ve.right}return!1},a.prototype.remove=function(Fe){var Ve=this.find(Fe);if(!Ve)return!1;if(this.splay(Ve),Ve.left)if(Ve.right){var Bt=this.minNode(Ve.right);Bt.parent!==Ve&&(this.replace(Bt,Bt.right),Bt.right=Ve.right,Bt.right.parent=Bt),this.replace(Ve,Bt),Bt.left=Ve.left,Bt.left.parent=Bt}else this.replace(Ve,Ve.left);else this.replace(Ve,Ve.right);return this._size--,!0},a.prototype.removeNode=function(Fe){if(!Fe)return!1;if(this.splay(Fe),Fe.left)if(Fe.right){var Ve=this.minNode(Fe.right);Ve.parent!==Fe&&(this.replace(Ve,Ve.right),Ve.right=Fe.right,Ve.right.parent=Ve),this.replace(Fe,Ve),Ve.left=Fe.left,Ve.left.parent=Ve}else this.replace(Fe,Fe.left);else this.replace(Fe,Fe.right);return this._size--,!0},a.prototype.erase=function(Fe){var Ve=this.find(Fe);if(Ve){this.splay(Ve);var Bt=Ve.left,ci=Ve.right,Bi=null;Bt&&(Bt.parent=null,Bi=this.maxNode(Bt),this.splay(Bi),this._root=Bi),ci&&(Bt?Bi.right=ci:this._root=ci,ci.parent=Bi),this._size--}},a.prototype.pop=function(){var Fe=this._root,Ve=null;if(Fe){for(;Fe.left;)Fe=Fe.left;Ve={key:Fe.key,data:Fe.data},this.remove(Fe.key)}return Ve},a.prototype.next=function(Fe){var Ve=Fe;if(Ve)if(Ve.right)for(Ve=Ve.right;Ve&&Ve.left;)Ve=Ve.left;else for(Ve=Fe.parent;Ve&&Ve.right===Fe;)Fe=Ve,Ve=Ve.parent;return Ve},a.prototype.prev=function(Fe){var Ve=Fe;if(Ve)if(Ve.left)for(Ve=Ve.left;Ve&&Ve.right;)Ve=Ve.right;else for(Ve=Fe.parent;Ve&&Ve.left===Fe;)Fe=Ve,Ve=Ve.parent;return Ve},a.prototype.forEach=function(Fe){for(var Ve=this._root,Bt=[],ci=!1,Bi=0;!ci;)Ve?(Bt.push(Ve),Ve=Ve.left):Bt.length>0?(Fe(Ve=Bt.pop(),Bi++),Ve=Ve.right):ci=!0;return this},a.prototype.range=function(Fe,Ve,Bt,ci){for(var Bi=[],Ni=this._compare,mn=this._root;Bi.length!==0||mn;)if(mn)Bi.push(mn),mn=mn.left;else{if(Ni((mn=Bi.pop()).key,Ve)>0)break;if(Ni(mn.key,Fe)>=0&&Bt.call(ci,mn))return this;mn=mn.right}return this},a.prototype.keys=function(){for(var Fe=this._root,Ve=[],Bt=[],ci=!1;!ci;)Fe?(Ve.push(Fe),Fe=Fe.left):Ve.length>0?(Fe=Ve.pop(),Bt.push(Fe.key),Fe=Fe.right):ci=!0;return Bt},a.prototype.values=function(){for(var Fe=this._root,Ve=[],Bt=[],ci=!1;!ci;)Fe?(Ve.push(Fe),Fe=Fe.left):Ve.length>0?(Fe=Ve.pop(),Bt.push(Fe.data),Fe=Fe.right):ci=!0;return Bt},a.prototype.at=function(Fe){for(var Ve=this._root,Bt=[],ci=!1,Bi=0;!ci;)if(Ve)Bt.push(Ve),Ve=Ve.left;else if(Bt.length>0){if(Ve=Bt.pop(),Bi===Fe)return Ve;Bi++,Ve=Ve.right}else ci=!0;return null},a.prototype.load=function(Fe,Ve,Bt){if(Fe===void 0&&(Fe=[]),Ve===void 0&&(Ve=[]),Bt===void 0&&(Bt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ci=Fe.length;return Bt&&_(Fe,Ve,0,ci-1,this._compare),this._root=d(null,Fe,Ve,0,ci),this._size=ci,this},a.prototype.min=function(){var Fe=this.minNode(this._root);return Fe?Fe.key:null},a.prototype.max=function(){var Fe=this.maxNode(this._root);return Fe?Fe.key:null},a.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},a.createTree=function(Fe,Ve,Bt,ci,Bi){return new a(Bt,Bi).load(Fe,Ve,ci)},Object.defineProperties(a.prototype,u);var x=0,S=1,R=2,L=3,F=0,U=1,G=2,X=3;function Z(Fe,Ve,Bt){Ve===null?(Fe.inOut=!1,Fe.otherInOut=!0):(Fe.isSubject===Ve.isSubject?(Fe.inOut=!Ve.inOut,Fe.otherInOut=Ve.otherInOut):(Fe.inOut=!Ve.otherInOut,Fe.otherInOut=Ve.isVertical()?!Ve.inOut:Ve.inOut),Ve&&(Fe.prevInResult=!ne(Ve,Bt)||Ve.isVertical()?Ve.prevInResult:Ve));var ci=ne(Fe,Bt);Fe.resultTransition=ci?(function(Bi,Ni){var mn,yn=!Bi.inOut,sr=!Bi.otherInOut;switch(Ni){case F:mn=yn&&sr;break;case U:mn=yn||sr;break;case X:mn=yn^sr;break;case G:mn=Bi.isSubject?yn&&!sr:sr&&!yn}return mn?1:-1})(Fe,Bt):0}function ne(Fe,Ve){switch(Fe.type){case x:switch(Ve){case F:return!Fe.otherInOut;case U:return Fe.otherInOut;case G:return Fe.isSubject&&Fe.otherInOut||!Fe.isSubject&&!Fe.otherInOut;case X:return!0}break;case R:return Ve===F||Ve===U;case L:return Ve===G;case S:return!1}return!1}var he=function(Fe,Ve,Bt,ci,Bi){this.left=Ve,this.point=Fe,this.otherEvent=Bt,this.isSubject=ci,this.type=Bi||x,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ce={inResult:{configurable:!0}};function _e(Fe,Ve){return Fe[0]===Ve[0]&&Fe[1]===Ve[1]}he.prototype.isBelow=function(Fe){var Ve=this.point,Bt=this.otherEvent.point;return this.left?(Ve[0]-Fe[0])*(Bt[1]-Fe[1])-(Bt[0]-Fe[0])*(Ve[1]-Fe[1])>0:(Bt[0]-Fe[0])*(Ve[1]-Fe[1])-(Ve[0]-Fe[0])*(Bt[1]-Fe[1])>0},he.prototype.isAbove=function(Fe){return!this.isBelow(Fe)},he.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ce.inResult.get=function(){return this.resultTransition!==0},he.prototype.clone=function(){var Fe=new he(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Fe.contourId=this.contourId,Fe.resultTransition=this.resultTransition,Fe.prevInResult=this.prevInResult,Fe.isExteriorRing=this.isExteriorRing,Fe.inOut=this.inOut,Fe.otherInOut=this.otherInOut,Fe},Object.defineProperties(he.prototype,ce);var xe=11102230246251565e-32,Ee=134217729,ke=(3+8*xe)*xe;function Be(Fe,Ve,Bt,ci,Bi){var Ni,mn,yn,sr,hr=Ve[0],gr=ci[0],Or=0,Bn=0;gr>hr==gr>-hr?(Ni=hr,hr=Ve[++Or]):(Ni=gr,gr=ci[++Bn]);var Zn=0;if(Or<Fe&&Bn<Bt)for(gr>hr==gr>-hr?(yn=Ni-((mn=hr+Ni)-hr),hr=Ve[++Or]):(yn=Ni-((mn=gr+Ni)-gr),gr=ci[++Bn]),Ni=mn,yn!==0&&(Bi[Zn++]=yn);Or<Fe&&Bn<Bt;)gr>hr==gr>-hr?(yn=Ni-((mn=Ni+hr)-(sr=mn-Ni))+(hr-sr),hr=Ve[++Or]):(yn=Ni-((mn=Ni+gr)-(sr=mn-Ni))+(gr-sr),gr=ci[++Bn]),Ni=mn,yn!==0&&(Bi[Zn++]=yn);for(;Or<Fe;)yn=Ni-((mn=Ni+hr)-(sr=mn-Ni))+(hr-sr),hr=Ve[++Or],Ni=mn,yn!==0&&(Bi[Zn++]=yn);for(;Bn<Bt;)yn=Ni-((mn=Ni+gr)-(sr=mn-Ni))+(gr-sr),gr=ci[++Bn],Ni=mn,yn!==0&&(Bi[Zn++]=yn);return Ni===0&&Zn!==0||(Bi[Zn++]=Ni),Zn}function He(Fe){return new Float64Array(Fe)}var Je=33306690738754716e-32,tt=22204460492503146e-32,It=11093356479670487e-47,ut=He(4),Ot=He(8),Zt=He(12),Yt=He(16),li=He(4);function ui(Fe,Ve,Bt){var ci=(function(Bi,Ni,mn,yn,sr,hr){var gr=(Ni-hr)*(mn-sr),Or=(Bi-sr)*(yn-hr),Bn=gr-Or;if(gr===0||Or===0||gr>0!=Or>0)return Bn;var Zn=Math.abs(gr+Or);return Math.abs(Bn)>=Je*Zn?Bn:-(function(Wr,$r,Jr,hs,Cs,bs,es){var ss,fr,Gr,ia,Ln,Br,Ss,Ls,Gs,Ra,Ns,Pn,ra,fs,Qs,_o,Vo,Za,Ya=Wr-Cs,Ro=Jr-Cs,Pu=$r-bs,Fs=hs-bs;ut[0]=(Qs=(Ls=Ya-(Ss=(Br=Ee*Ya)-(Br-Ya)))*(Ra=Fs-(Gs=(Br=Ee*Fs)-(Br-Fs)))-((fs=Ya*Fs)-Ss*Gs-Ls*Gs-Ss*Ra))-((Ns=Qs-(Vo=(Ls=Pu-(Ss=(Br=Ee*Pu)-(Br-Pu)))*(Ra=Ro-(Gs=(Br=Ee*Ro)-(Br-Ro)))-((_o=Pu*Ro)-Ss*Gs-Ls*Gs-Ss*Ra)))+(Ln=Qs-Ns))+(Ln-Vo),ut[1]=(ra=fs-((Pn=fs+Ns)-(Ln=Pn-fs))+(Ns-Ln))-((Ns=ra-_o)+(Ln=ra-Ns))+(Ln-_o),ut[2]=Pn-((Za=Pn+Ns)-(Ln=Za-Pn))+(Ns-Ln),ut[3]=Za;var Sa=(function(ig,Ol){for(var Qc=Ol[0],Gh=1;Gh<4;Gh++)Qc+=Ol[Gh];return Qc})(0,ut),Ia=tt*es;if(Sa>=Ia||-Sa>=Ia||(ss=Wr-(Ya+(Ln=Wr-Ya))+(Ln-Cs),Gr=Jr-(Ro+(Ln=Jr-Ro))+(Ln-Cs),fr=$r-(Pu+(Ln=$r-Pu))+(Ln-bs),ia=hs-(Fs+(Ln=hs-Fs))+(Ln-bs),ss===0&&fr===0&&Gr===0&&ia===0)||(Ia=It*es+ke*Math.abs(Sa),(Sa+=Ya*ia+Fs*ss-(Pu*Gr+Ro*fr))>=Ia||-Sa>=Ia))return Sa;li[0]=(Qs=(Ls=ss-(Ss=(Br=Ee*ss)-(Br-ss)))*(Ra=Fs-(Gs=(Br=Ee*Fs)-(Br-Fs)))-((fs=ss*Fs)-Ss*Gs-Ls*Gs-Ss*Ra))-((Ns=Qs-(Vo=(Ls=fr-(Ss=(Br=Ee*fr)-(Br-fr)))*(Ra=Ro-(Gs=(Br=Ee*Ro)-(Br-Ro)))-((_o=fr*Ro)-Ss*Gs-Ls*Gs-Ss*Ra)))+(Ln=Qs-Ns))+(Ln-Vo),li[1]=(ra=fs-((Pn=fs+Ns)-(Ln=Pn-fs))+(Ns-Ln))-((Ns=ra-_o)+(Ln=ra-Ns))+(Ln-_o),li[2]=Pn-((Za=Pn+Ns)-(Ln=Za-Pn))+(Ns-Ln),li[3]=Za;var hh=Be(4,ut,4,li,Ot);li[0]=(Qs=(Ls=Ya-(Ss=(Br=Ee*Ya)-(Br-Ya)))*(Ra=ia-(Gs=(Br=Ee*ia)-(Br-ia)))-((fs=Ya*ia)-Ss*Gs-Ls*Gs-Ss*Ra))-((Ns=Qs-(Vo=(Ls=Pu-(Ss=(Br=Ee*Pu)-(Br-Pu)))*(Ra=Gr-(Gs=(Br=Ee*Gr)-(Br-Gr)))-((_o=Pu*Gr)-Ss*Gs-Ls*Gs-Ss*Ra)))+(Ln=Qs-Ns))+(Ln-Vo),li[1]=(ra=fs-((Pn=fs+Ns)-(Ln=Pn-fs))+(Ns-Ln))-((Ns=ra-_o)+(Ln=ra-Ns))+(Ln-_o),li[2]=Pn-((Za=Pn+Ns)-(Ln=Za-Pn))+(Ns-Ln),li[3]=Za;var yo=Be(hh,Ot,4,li,Zt);li[0]=(Qs=(Ls=ss-(Ss=(Br=Ee*ss)-(Br-ss)))*(Ra=ia-(Gs=(Br=Ee*ia)-(Br-ia)))-((fs=ss*ia)-Ss*Gs-Ls*Gs-Ss*Ra))-((Ns=Qs-(Vo=(Ls=fr-(Ss=(Br=Ee*fr)-(Br-fr)))*(Ra=Gr-(Gs=(Br=Ee*Gr)-(Br-Gr)))-((_o=fr*Gr)-Ss*Gs-Ls*Gs-Ss*Ra)))+(Ln=Qs-Ns))+(Ln-Vo),li[1]=(ra=fs-((Pn=fs+Ns)-(Ln=Pn-fs))+(Ns-Ln))-((Ns=ra-_o)+(Ln=ra-Ns))+(Ln-_o),li[2]=Pn-((Za=Pn+Ns)-(Ln=Za-Pn))+(Ns-Ln),li[3]=Za;var wp=Be(yo,Zt,4,li,Yt);return Yt[wp-1]})(Bi,Ni,mn,yn,sr,hr,Zn)})(Fe[0],Fe[1],Ve[0],Ve[1],Bt[0],Bt[1]);return ci>0?-1:ci<0?1:0}function ri(Fe,Ve){var Bt=Fe.point,ci=Ve.point;return Bt[0]>ci[0]?1:Bt[0]<ci[0]?-1:Bt[1]!==ci[1]?Bt[1]>ci[1]?1:-1:(function(Bi,Ni,mn,yn){return Bi.left!==Ni.left?Bi.left?1:-1:ui(mn,Bi.otherEvent.point,Ni.otherEvent.point)!==0?Bi.isBelow(Ni.otherEvent.point)?-1:1:!Bi.isSubject&&Ni.isSubject?1:-1})(Fe,Ve,Bt)}function si(Fe,Ve,Bt){var ci=new he(Ve,!1,Fe,Fe.isSubject),Bi=new he(Ve,!0,Fe.otherEvent,Fe.isSubject);return _e(Fe.point,Fe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Fe),ci.contourId=Bi.contourId=Fe.contourId,ri(Bi,Fe.otherEvent)>0&&(Fe.otherEvent.left=!0,Bi.left=!1),Fe.otherEvent.otherEvent=Bi,Fe.otherEvent=ci,Bt.push(Bi),Bt.push(ci),Bt}function zt(Fe,Ve){return Fe[0]*Ve[1]-Fe[1]*Ve[0]}function Dt(Fe,Ve){return Fe[0]*Ve[0]+Fe[1]*Ve[1]}function ai(Fe,Ve,Bt){var ci=(function(sr,hr,gr,Or,Bn){var Zn=[hr[0]-sr[0],hr[1]-sr[1]],Wr=[Or[0]-gr[0],Or[1]-gr[1]];function $r(Br,Ss,Ls){return[Br[0]+Ss*Ls[0],Br[1]+Ss*Ls[1]]}var Jr=[gr[0]-sr[0],gr[1]-sr[1]],hs=zt(Zn,Wr),Cs=hs*hs,bs=Dt(Zn,Zn);if(Cs>0){var es=zt(Jr,Wr)/hs;if(es<0||es>1)return null;var ss=zt(Jr,Zn)/hs;return ss<0||ss>1?null:es===0||es===1?[$r(sr,es,Zn)]:ss===0||ss===1?[$r(gr,ss,Wr)]:[$r(sr,es,Zn)]}if((Cs=(hs=zt(Jr,Zn))*hs)>0)return null;var fr=Dt(Zn,Jr)/bs,Gr=fr+Dt(Zn,Wr)/bs,ia=Math.min(fr,Gr),Ln=Math.max(fr,Gr);return ia<=1&&Ln>=0?ia===1?[$r(sr,ia>0?ia:0,Zn)]:Ln===0?[$r(sr,Ln<1?Ln:1,Zn)]:[$r(sr,ia>0?ia:0,Zn),$r(sr,Ln<1?Ln:1,Zn)]:null})(Fe.point,Fe.otherEvent.point,Ve.point,Ve.otherEvent.point),Bi=ci?ci.length:0;if(Bi===0||Bi===1&&(_e(Fe.point,Ve.point)||_e(Fe.otherEvent.point,Ve.otherEvent.point))||Bi===2&&Fe.isSubject===Ve.isSubject)return 0;if(Bi===1)return _e(Fe.point,ci[0])||_e(Fe.otherEvent.point,ci[0])||si(Fe,ci[0],Bt),_e(Ve.point,ci[0])||_e(Ve.otherEvent.point,ci[0])||si(Ve,ci[0],Bt),1;var Ni=[],mn=!1,yn=!1;return _e(Fe.point,Ve.point)?mn=!0:ri(Fe,Ve)===1?Ni.push(Ve,Fe):Ni.push(Fe,Ve),_e(Fe.otherEvent.point,Ve.otherEvent.point)?yn=!0:ri(Fe.otherEvent,Ve.otherEvent)===1?Ni.push(Ve.otherEvent,Fe.otherEvent):Ni.push(Fe.otherEvent,Ve.otherEvent),mn&&yn||mn?(Ve.type=S,Fe.type=Ve.inOut===Fe.inOut?R:L,mn&&!yn&&si(Ni[1].otherEvent,Ni[0].point,Bt),2):yn?(si(Ni[0],Ni[1].point,Bt),3):Ni[0]!==Ni[3].otherEvent?(si(Ni[0],Ni[1].point,Bt),si(Ni[1],Ni[2].point,Bt),3):(si(Ni[0],Ni[1].point,Bt),si(Ni[3].otherEvent,Ni[2].point,Bt),3)}function Ti(Fe,Ve){if(Fe===Ve)return 0;if(ui(Fe.point,Fe.otherEvent.point,Ve.point)!==0||ui(Fe.point,Fe.otherEvent.point,Ve.otherEvent.point)!==0)return _e(Fe.point,Ve.point)?Fe.isBelow(Ve.otherEvent.point)?-1:1:Fe.point[0]===Ve.point[0]?Fe.point[1]<Ve.point[1]?-1:1:ri(Fe,Ve)===1?Ve.isAbove(Fe.point)?-1:1:Fe.isBelow(Ve.point)?-1:1;if(Fe.isSubject!==Ve.isSubject)return Fe.isSubject?-1:1;var Bt=Fe.point,ci=Ve.point;return Bt[0]===ci[0]&&Bt[1]===ci[1]?(Bt=Fe.otherEvent.point)[0]===(ci=Ve.otherEvent.point)[0]&&Bt[1]===ci[1]?0:Fe.contourId>Ve.contourId?1:-1:ri(Fe,Ve)===1?1:-1}var pi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function dn(Fe,Ve,Bt,ci){var Bi,Ni=Fe+1,mn=Ve[Fe].point,yn=Ve.length;for(Ni<yn&&(Bi=Ve[Ni].point);Ni<yn&&Bi[0]===mn[0]&&Bi[1]===mn[1];){if(!Bt[Ni])return Ni;++Ni<yn&&(Bi=Ve[Ni].point)}for(Ni=Fe-1;Bt[Ni]&&Ni>ci;)Ni--;return Ni}pi.prototype.isExterior=function(){return this.holeOf==null};var Gi=cn,Ki=cn;function cn(Fe,Ve){if(!(this instanceof cn))return new cn(Fe,Ve);if(this.data=Fe||[],this.length=this.data.length,this.compare=Ve||yr,this.length>0)for(var Bt=(this.length>>1)-1;Bt>=0;Bt--)this._down(Bt)}function yr(Fe,Ve){return Fe<Ve?-1:Fe>Ve?1:0}cn.prototype={push:function(Fe){this.data.push(Fe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Fe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Fe}},peek:function(){return this.data[0]},_up:function(Fe){for(var Ve=this.data,Bt=this.compare,ci=Ve[Fe];Fe>0;){var Bi=Fe-1>>1,Ni=Ve[Bi];if(Bt(ci,Ni)>=0)break;Ve[Fe]=Ni,Fe=Bi}Ve[Fe]=ci},_down:function(Fe){for(var Ve=this.data,Bt=this.compare,ci=this.length>>1,Bi=Ve[Fe];Fe<ci;){var Ni=1+(Fe<<1),mn=Ni+1,yn=Ve[Ni];if(mn<this.length&&Bt(Ve[mn],yn)<0&&(Ni=mn,yn=Ve[mn]),Bt(yn,Bi)>=0)break;Ve[Fe]=yn,Fe=Ni}Ve[Fe]=Bi}},Gi.default=Ki;var yi=Math.max,un=Math.min,Yn=0;function Ur(Fe,Ve,Bt,ci,Bi,Ni){var mn,yn,sr,hr,gr,Or;for(mn=0,yn=Fe.length-1;mn<yn;mn++)if(hr=Fe[mn+1],gr=new he(sr=Fe[mn],!1,void 0,Ve),Or=new he(hr,!1,gr,Ve),gr.otherEvent=Or,sr[0]!==hr[0]||sr[1]!==hr[1]){gr.contourId=Or.contourId=Bt,Ni||(gr.isExteriorRing=!1,Or.isExteriorRing=!1),ri(gr,Or)>0?Or.left=!0:gr.left=!0;var Bn=sr[0],Zn=sr[1];Bi[0]=un(Bi[0],Bn),Bi[1]=un(Bi[1],Zn),Bi[2]=yi(Bi[2],Bn),Bi[3]=yi(Bi[3],Zn),ci.push(gr),ci.push(Or)}}var jr=[];function cr(Fe,Ve,Bt){typeof Fe[0][0][0]=="number"&&(Fe=[Fe]),typeof Ve[0][0][0]=="number"&&(Ve=[Ve]);var ci=(function(Zn,Wr,$r){var Jr=null;return Zn.length*Wr.length==0&&($r===F?Jr=jr:$r===G?Jr=Zn:$r!==U&&$r!==X||(Jr=Zn.length===0?Wr:Zn)),Jr})(Fe,Ve,Bt);if(ci)return ci===jr?null:ci;var Bi=[1/0,1/0,-1/0,-1/0],Ni=[1/0,1/0,-1/0,-1/0],mn=(function(Zn,Wr,$r,Jr,hs){var Cs,bs,es,ss,fr,Gr,ia=new Gi(null,ri);for(es=0,ss=Zn.length;es<ss;es++)for(fr=0,Gr=(Cs=Zn[es]).length;fr<Gr;fr++)(bs=fr===0)&&Yn++,Ur(Cs[fr],!0,Yn,ia,$r,bs);for(es=0,ss=Wr.length;es<ss;es++)for(fr=0,Gr=(Cs=Wr[es]).length;fr<Gr;fr++)bs=fr===0,hs===G&&(bs=!1),bs&&Yn++,Ur(Cs[fr],!1,Yn,ia,Jr,bs);return ia})(Fe,Ve,Bi,Ni,Bt);if(ci=(function(Zn,Wr,$r,Jr,hs){var Cs=null;return($r[0]>Jr[2]||Jr[0]>$r[2]||$r[1]>Jr[3]||Jr[1]>$r[3])&&(hs===F?Cs=jr:hs===G?Cs=Zn:hs!==U&&hs!==X||(Cs=Zn.concat(Wr))),Cs})(Fe,Ve,Bi,Ni,Bt))return ci===jr?null:ci;for(var yn=(function(Zn){var Wr,$r,Jr=(function(es){var ss,fr,Gr,ia,Ln=[];for(fr=0,Gr=es.length;fr<Gr;fr++)((ss=es[fr]).left&&ss.inResult||!ss.left&&ss.otherEvent.inResult)&&Ln.push(ss);for(var Br=!1;!Br;)for(Br=!0,fr=0,Gr=Ln.length;fr<Gr;fr++)fr+1<Gr&&ri(Ln[fr],Ln[fr+1])===1&&(ia=Ln[fr],Ln[fr]=Ln[fr+1],Ln[fr+1]=ia,Br=!1);for(fr=0,Gr=Ln.length;fr<Gr;fr++)(ss=Ln[fr]).otherPos=fr;for(fr=0,Gr=Ln.length;fr<Gr;fr++)(ss=Ln[fr]).left||(ia=ss.otherPos,ss.otherPos=ss.otherEvent.otherPos,ss.otherEvent.otherPos=ia);return Ln})(Zn),hs={},Cs=[],bs=function(){if(!hs[Wr]){var es=Cs.length,ss=(function(Ln,Br,Ss){var Ls=new pi;if(Ln.prevInResult!=null){var Gs=Ln.prevInResult,Ra=Gs.outputContourId;if(Gs.resultTransition>0){var Ns=Br[Ra];if(Ns.holeOf!=null){var Pn=Ns.holeOf;Br[Pn].holeIds.push(Ss),Ls.holeOf=Pn,Ls.depth=Br[Ra].depth}else Br[Ra].holeIds.push(Ss),Ls.holeOf=Ra,Ls.depth=Br[Ra].depth+1}else Ls.holeOf=null,Ls.depth=Br[Ra].depth}else Ls.holeOf=null,Ls.depth=0;return Ls})(Jr[Wr],Cs,es),fr=function(Ln){hs[Ln]=!0,Ln<Jr.length&&Jr[Ln]&&(Jr[Ln].outputContourId=es)},Gr=Wr,ia=Wr;for(ss.points.push(Jr[Wr].point);fr(Gr),fr(Gr=Jr[Gr].otherPos),ss.points.push(Jr[Gr].point),!((Gr=dn(Gr,Jr,hs,ia))==ia||Gr>=Jr.length)&&Jr[Gr];);Cs.push(ss)}};for(Wr=0,$r=Jr.length;Wr<$r;Wr++)bs();return Cs})((function(Zn,Wr,$r,Jr,hs,Cs){for(var bs,es,ss,fr=new a(Ti),Gr=[],ia=Math.min(Jr[2],hs[2]);Zn.length!==0;){var Ln=Zn.pop();if(Gr.push(Ln),Cs===F&&Ln.point[0]>ia||Cs===G&&Ln.point[0]>Jr[2])break;if(Ln.left){es=bs=fr.insert(Ln),bs=bs!==(ss=fr.minNode())?fr.prev(bs):null,es=fr.next(es);var Br=bs?bs.key:null;if(Z(Ln,Br,Cs),es&&ai(Ln,es.key,Zn)===2&&(Z(Ln,Br,Cs),Z(es.key,Ln,Cs)),bs&&ai(bs.key,Ln,Zn)===2){var Ss=bs;Z(Br,(Ss=Ss!==ss?fr.prev(Ss):null)?Ss.key:null,Cs),Z(Ln,Br,Cs)}}else es=bs=fr.find(Ln=Ln.otherEvent),bs&&es&&(bs=bs!==ss?fr.prev(bs):null,es=fr.next(es),fr.remove(Ln),es&&bs&&ai(bs.key,es.key,Zn))}return Gr})(mn,0,0,Bi,Ni,Bt)),sr=[],hr=0;hr<yn.length;hr++){var gr=yn[hr];if(gr.isExterior()){for(var Or=[gr.points],Bn=0;Bn<gr.holeIds.length;Bn++)Or.push(yn[gr.holeIds[Bn]].points);sr.push(Or)}}return sr}var vs={UNION:U,DIFFERENCE:G,INTERSECTION:F,XOR:X};o.diff=function(Fe,Ve){return cr(Fe,Ve,G)},o.intersection=function(Fe,Ve){return cr(Fe,Ve,F)},o.operations=vs,o.union=function(Fe,Ve){return cr(Fe,Ve,U)},o.xor=function(Fe,Ve){return cr(Fe,Ve,X)},Object.defineProperty(o,"__esModule",{value:!0})})(Fv.exports)),Fv.exports);function Jm(o,t,a,u){const d=[],_=u===0?(x,S,R,L,F,U)=>{x.push(new Xt(U,R+(U-S)/(L-S)*(F-R)))}:(x,S,R,L,F,U)=>{x.push(new Xt(S+(U-R)/(F-R)*(L-S),U))};for(const x of o){const S=[];for(const R of x){if(R.length<=2)continue;const L=[];for(let G=0;G<R.length-1;G++){const X=R[G].x,Z=R[G].y,ne=R[G+1].x,he=R[G+1].y,ce=u===0?X:Z,_e=u===0?ne:he;ce<t?_e>t&&_(L,X,Z,ne,he,t):ce>a?_e<a&&_(L,X,Z,ne,he,a):L.push(R[G]),_e<t&&ce>=t&&_(L,X,Z,ne,he,t),_e>a&&ce<=a&&_(L,X,Z,ne,he,a)}let F=R[R.length-1];const U=u===0?F.x:F.y;U>=t&&U<=a&&L.push(F),L.length&&(F=L[L.length-1],L[0].x===F.x&&L[0].y===F.y||L.push(L[0]),S.push(L))}S.length&&d.push(S)}return d}function Nf(o,t){const a=y_(o),u=y_([t]),d=Uv.intersection(a,u);return d==null?[]:yp(d)}function zw(o,t){let u=y_(o,65536);const d=[];for(;t.valid();t.next()){const[_,x]=t.get(),S=_.x*65536,R=_.y*65536,L=x.x*65536,F=x.y*65536,U=L-S,G=F-R,X=Math.hypot(U,G);if(X===0)continue;const Z=Math.trunc(G/X*3),ne=-Math.trunc(U/X*3);d.push([[[S,R],[L,F],[L+Z,F+ne],[S+Z,R+ne],[S,R]]])}return d.length>0&&(u=Uv.diff(u,d)),yp(u,1/65536)}function y_(o,t=1){return[o.map((a=>a.map((u=>[u.x*t,u.y*t]))))]}function yp(o,t=1){return o.map((a=>a.map(((u,d)=>{const _=u.map((x=>new Xt(x[0]*t,x[1]*t).round()));return d>0&&_.reverse(),_}))))}class kv{constructor(t,a){this.layoutVertexArray=new Tf,this.indexArray=new Aa,this.lineIndexArray=new Jl,this.triangleSegments=new Es,this.lineSegments=new Es,this.programConfigurations=new na(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Cu)}update(t,a,u,d,_,x,S,R){this.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S,R)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,m0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Oy.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,a,u,d,_,x,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,d,_,x,void 0,S)}}class Vv{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new kv(t,!1),this.elevationBufferData=new kv(t,!0),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,a){}updateAppearances(t,a,u,d){}populate(t,a,u,d){this.hasPattern=Uy("fill",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:S,id:R,index:L,sourceLayerIndex:F}of t){const U=this.layers[0]._featureFilter.needGeometry,G=ct(S,U);if(!this.layers[0]._featureFilter.filter(new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),G,u))continue;const X=_?_.evaluate(G,{},u,a.availableImages):void 0,Z={id:R,properties:S.properties,type:S.type,sourceLayerIndex:F,index:L,geometry:U?G.geometry:Ye(S,u,d),patterns:{},sortKey:X};x.push(Z)}_&&x.sort(((S,R)=>S.sortKey-R.sortKey));for(const S of x){const{geometry:R,index:L,sourceLayerIndex:F}=S;if(this.hasPattern){const U=x0("fill",this.layers,S,this.zoom,this.pixelRatio,a);this.patternFeatures.push(U)}else this.addFeature(S,R,L,u,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(t[L].feature,R,L,F,this.index)}}update(t,a,u,d,_,x,S){this.bufferData.update(t,a,u,d,_,x,S,this.worldview),this.elevationBufferData.update(t,a,u,d,_,x,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,a,u,d,_,x,S,this.worldview)}addFeatures(t,a,u,d,_,x){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,u,d,x,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,a,u,d,_,x=[],S,R){const L=Ig(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,L,d,u,R):this.addGeometry(L,this.bufferData),this.bufferData.populatePaintArrays(t,u,_,x,d,S,this.worldview),this.elevationBufferData.populatePaintArrays(t,u,_,x,d,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t,a,u,d,_){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(a,u,d,_,this.worldview))}addElevatedRoadFeature(t,a,u,d,_){const x=new Array,S=er.getElevationFeature(t,_);if(!S)return void this.addGeometry(a,this.bufferData);{const L=this.clipPolygonsToTile(a,1);L.length>0&&x.push({polygons:L,elevationFeature:S,elevationTileID:u})}const R={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},u),featureIndex:d};for(const L of x)if(L.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Sc(L.elevationTileID,this.layers,this.zoom,this.lut));const U=L.elevationFeature.isTunnel();let G=0;t.properties.hasOwnProperty(pt)&&(G=+t.properties[pt]);for(const X of L.polygons)this.elevatedStructures.addPortalCandidates(L.elevationFeature.id,X,U,L.elevationFeature,G)}L.elevationFeature.constantHeight==null&&(L.polygons=this.prepareElevatedPolygons(L.polygons,L.elevationFeature,L.elevationTileID));const F=new Pr(u,L.elevationTileID);this.addElevatedGeometry(L.polygons,F,L.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,R)}}addElevatedGeometry(t,a,u,d,_,x){const S={elevation:u,elevationSampler:a,bias:d,index:_,featureInfo:x},[R,L]=this.addGeometry(t,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:R,max:L}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,R),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,L))}addGeometry(t,a,u){let d=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,x=null;u&&(x=u.elevationSampler.constantElevation(u.elevation,u.bias),x!=null&&(d=x,_=x));const S=(R,L,F)=>{if(u!=null)if(L.push(R),x!=null)a.elevatedLayoutVertexArray.emplaceBack(x),F.push(x);else{const U=u.elevationSampler.pointElevation(R,u.elevation,u.bias);a.elevatedLayoutVertexArray.emplaceBack(U),F.push(U),d=Math.min(d,U),_=Math.max(_,U)}};for(const R of t){let L=0;for(const xe of R)L+=xe.length;const F=a.triangleSegments.prepareSegment(L,a.layoutVertexArray,a.indexArray),U=F.vertexLength,G=[],X=[],Z=[],ne=[],he=[],ce=a.layoutVertexArray.length;for(const xe of R){if(xe.length===0)continue;xe!==R[0]&&X.push(G.length/2);const Ee=a.lineSegments.prepareSegment(xe.length,a.layoutVertexArray,a.lineIndexArray),ke=Ee.vertexLength;u&&he.push(a.layoutVertexArray.length-ce),S(xe[0],Z,ne),a.layoutVertexArray.emplaceBack(xe[0].x,xe[0].y),a.lineIndexArray.emplaceBack(ke+xe.length-1,ke),G.push(xe[0].x),G.push(xe[0].y);for(let Be=1;Be<xe.length;Be++)S(xe[Be],Z,ne),a.layoutVertexArray.emplaceBack(xe[Be].x,xe[Be].y),a.lineIndexArray.emplaceBack(ke+Be-1,ke+Be),G.push(xe[Be].x),G.push(xe[Be].y);Ee.vertexLength+=xe.length,Ee.primitiveLength+=xe.length}const _e=d_(G,X);for(let xe=0;xe<_e.length;xe+=3)a.indexArray.emplaceBack(U+_e[xe],U+_e[xe+1],U+_e[xe+2]);if(_e.length>0&&u&&this.elevationMode==="hd-road-base"){const xe=u.elevation.isTunnel(),Ee=u.elevation.safeArea,ke=this.elevatedStructures.addVertices(Z,ne);this.elevatedStructures.addTriangles(_e,ke,xe);const Be=he.length;if(Be>0){for(let He=0;He<Be-1;He++)this.elevatedStructures.addRenderableRing(u.index,he[He]+ke,he[He+1]-he[He],xe,Ee,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,he[Be-1]+ke,Z.length-he[Be-1],xe,Ee,u.featureInfo)}}F.vertexLength+=L,F.primitiveLength+=_e.length/3}return[d,_]}prepareElevatedPolygons(t,a,u){const d=1/de(u),_=[];for(const x of t){const S=zw(x,new Ir(a,d));_.push(...S)}return _}clipPolygonsToTile(t,a){const u=-a,d=-a,_=gi+a,x=gi+a;let S=0;const R=[],L=[];for(;S<t.length;S++){const G=t[S],X=$a(G);(X.min.x>=u&&X.max.x<=_&&X.min.y>=d&&X.max.y<=x?R:L).push(G)}if(R.length===t.length)return t;const F=[new Xt(u,d),new Xt(_,d),new Xt(_,x),new Xt(u,x),new Xt(u,d)],U=R;for(const G of L)U.push(...Nf(G,F));return U}}let Dg,Gv,Ow,Bw;oi(Vv,"FillBucket",{omit:["layers","patternFeatures"]}),oi(kv,"FillBufferData"),oi(Sc,"ElevatedStructures");class Vy{constructor(t,a,u,d){if(this.triangleCount=a.length/3,this.min=new Xt(0,0),this.max=new Xt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[_,x]=[t[0].clone(),t[0].clone()];for(let U=1;U<t.length;++U){const G=t[U];_.x=Math.min(_.x,G.x),_.y=Math.min(_.y,G.y),x.x=Math.max(x.x,G.x),x.y=Math.max(x.y,G.y)}if(d){const U=Math.ceil(Math.max(x.x-_.x,x.y-_.y)/d);u=Math.max(u,U)}if(u===0)return;this.min=_,this.max=x;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const R=Math.max(S.x,S.y)/u;this.cellsX=Math.max(1,Math.ceil(S.x/R)),this.cellsY=Math.max(1,Math.ceil(S.y/R)),this.xScale=1/R,this.yScale=1/R;const L=[];for(let U=0;U<this.triangleCount;U++){const G=t[a[3*U+0]].sub(this.min),X=t[a[3*U+1]].sub(this.min),Z=t[a[3*U+2]].sub(this.min),ne=xp(Math.floor(Math.min(G.x,X.x,Z.x)),this.xScale,this.cellsX),he=xp(Math.floor(Math.max(G.x,X.x,Z.x)),this.xScale,this.cellsX),ce=xp(Math.floor(Math.min(G.y,X.y,Z.y)),this.yScale,this.cellsY),_e=xp(Math.floor(Math.max(G.y,X.y,Z.y)),this.yScale,this.cellsY),xe=new Xt(0,0),Ee=new Xt(0,0),ke=new Xt(0,0),Be=new Xt(0,0);for(let He=ce;He<=_e;++He){xe.y=Ee.y=He*R,ke.y=Be.y=(He+1)*R;for(let Je=ne;Je<=he;++Je)xe.x=ke.x=Je*R,Ee.x=Be.x=(Je+1)*R,(Ht(G,X,Z,xe,Ee,Be)||Ht(G,X,Z,xe,Be,ke))&&L.push({cellIdx:He*this.cellsX+Je,triIdx:U})}}if(L.length===0)return;L.sort(((U,G)=>U.cellIdx-G.cellIdx||U.triIdx-G.triIdx));let F=0;for(;F<L.length;){const U=L[F].cellIdx,G={start:this.payload.length,len:0};for(;F<L.length&&L[F].cellIdx===U;)++G.len,this.payload.push(L[F++].triIdx);this.cells[U]=G}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,a){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const u=xp(t.x-this.min.x,this.xScale,this.cellsX),d=xp(t.y-this.min.y,this.yScale,this.cellsY),_=this.cells[d*this.cellsX+u];if(_){this._lazyInitLookup();for(let x=0;x<_.len;x++){const S=this.payload[_.start+x],R=Math.floor(S/8),L=1<<S%8;if(!(this.lookup[R]&L)&&(this.lookup[R]|=L,a.push(S),a.length===this.triangleCount))return}}}query(t,a,u){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>a.x||t.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const d=xp(t.x-this.min.x,this.xScale,this.cellsX),_=xp(a.x-this.min.x,this.xScale,this.cellsX),x=xp(t.y-this.min.y,this.yScale,this.cellsY),S=xp(a.y-this.min.y,this.yScale,this.cellsY);for(let R=x;R<=S;R++)for(let L=d;L<=_;L++){const F=this.cells[R*this.cellsX+L];if(F)for(let U=0;U<F.len;U++){const G=this.payload[F.start+U],X=Math.floor(G/8),Z=1<<G%8;if(!(this.lookup[X]&Z)&&(this.lookup[X]|=Z,u.push(G),u.length===this.triangleCount))return}}}}function xp(o,t,a){return Math.max(0,Math.min(a-1,Math.floor(o*t)))}oi(Vy,"TriangleGridIndex");class Nw{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.footprints=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,a){for(const u of this.footprints)a.push({footprint:u,id:t})}updateAppearances(t,a,u,d){}populate(t,a,u,d){const _=[];for(const{feature:x,id:S,index:R,sourceLayerIndex:L}of t){const F=this.layers[0]._featureFilter.needGeometry,U=ct(x,F);if(!this.layers[0]._featureFilter.filter(new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),U,u))continue;const G={id:S,properties:x.properties,type:x.type,sourceLayerIndex:L,index:R,geometry:F?U.geometry:Ye(x,u,d),patterns:{}};_.push(G)}for(const x of _){const{geometry:S,index:R,sourceLayerIndex:L}=x;this.addFeature(x,S,R,u,{},a.availableImages,a.brightness),a.featureIndex.insert(t[R].feature,S,R,L,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,a,u,d,_,x,S){}destroy(){}addFeature(t,a,u,d,_,x=[],S){for(const R of Ig(a,2)){const L=[],F=[],U=[],G=new Xt(1/0,1/0),X=new Xt(-1/0,-1/0);for(const he of R)if(he.length!==0){he!==R[0]&&U.push(F.length/2);for(let ce=0;ce<he.length;ce++)F.push(he[ce].x),F.push(he[ce].y),L.push(he[ce]),G.x=Math.min(G.x,he[ce].x),G.y=Math.min(G.y,he[ce].y),X.x=Math.max(X.x,he[ce].x),X.y=Math.max(X.y,he[ce].y)}const Z=d_(F,U),ne=new Vy(L,Z,8,256);this.footprints.push({vertices:L,indices:Z,grid:ne,min:G,max:X})}}}oi(Nw,"ClipBucket",{omit:["layers"]});const mE=vr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gE=vr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Fw=vr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),x_=vr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),v0=vr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Uw=vr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_E=vr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:v_}=mE,om=Number.MAX_SAFE_INTEGER,Hv=om-1;function b0(o,t,a,u){return o.order<t||o.order===om||!(o.clipMask&a)||(function(d,_){return _.length!==0&&_.find((x=>x===d))===void 0})(u,o.clipScope)}function b_(o,t){return o.x-t.x||o.y-t.y}function Gy(o,t){return b_(o.min,t.min)===0&&b_(o.max,t.max)===0}function w_(o,t){return!(o.min.x>t.max.x||o.max.x<t.min.x||o.min.y>t.max.y||o.max.y<t.min.y)}function w0(o,t){if(o.length!==t.length)return!1;for(let a=0;a<o.length;a++)if(o[a].sourceId!==t[a].sourceId||!Gy(o[a],t[a])||o[a].order!==t[a].order||o[a].clipMask!==t[a].clipMask||!ja(o[a].clipScope,t[a].clipScope))return!1;return!0}function jv(o,t,a){const u=1/gi,d=1/(1<<a.canonical.z),_=(t.x*u+a.canonical.x)*d+a.wrap,x=(t.y*u+a.canonical.y)*d;return{min:new Xt((o.x*u+a.canonical.x)*d+a.wrap,(o.y*u+a.canonical.y)*d),max:new Xt(_,x)}}function yE(o,t,a){const u=1<<a.canonical.z,d=((t.x-a.wrap)*u-a.canonical.x)*gi,_=(t.y*u-a.canonical.y)*gi;return{min:new Xt(((o.x-a.wrap)*u-a.canonical.x)*gi,(o.y*u-a.canonical.y)*gi),max:new Xt(d,_)}}function Hy(o,t,a,u,d,_,x){const S=o.indices,R=o.vertices,L=[];for(let F=u;F<u+d;F+=3){const U=t[a[F+0]+_],G=t[a[F+1]+_],X=t[a[F+2]+_],Z=Math.min(U.x,G.x,X.x),ne=Math.max(U.x,G.x,X.x),he=Math.min(U.y,G.y,X.y),ce=Math.max(U.y,G.y,X.y);L.length=0,o.grid.query(new Xt(Z,he),new Xt(ne,ce),L);for(let _e=0;_e<L.length;_e++){const xe=L[_e];if(Ht(R[S[3*xe+0]],R[S[3*xe+1]],R[S[3*xe+2]],U,G,X,x))return!0}}return!1}function kw(o,t,a,u){if(!o||!a)return!1;let d=o.vertices;if(!t.canonical.equals(u.canonical)||t.wrap!==u.wrap){if(a.vertices.length<o.vertices.length)return kw(a,u,o,t);const _=t.canonical,x=u.canonical,S=Math.pow(2,x.z-_.z);d=o.vertices.map((R=>new Xt((R.x+_.x*gi)*S-x.x*gi,(R.y+_.y*gi)*S-x.y*gi)))}return Hy(a,d,o.indices,0,o.indices.length,0,0)}function jy(o,t,a,u){const d=Math.pow(2,u.z-a.z);return new Xt((o+a.x*gi)*d-u.x*gi,(t+a.y*gi)*d-u.y*gi)}function Vw(o,t){const a=[];t.grid.queryPoint(o,a);const u=t.indices,d=t.vertices;for(let _=0;_<a.length;_++){const x=a[_];if(te([d[u[3*x+0]],d[u[3*x+1]],d[u[3*x+2]]],o))return!0}return!1}const S_=[new Xt(0,0),new Xt(gi,0),new Xt(gi,gi),new Xt(0,gi)];function S0(o,t){const a=[];let u=[];if(!t||o.length<2)return[o];if(o.length===2)return We(o[0],o[1],S_)?[o]:[];for(let d=0;d<o.length+2;d++){const _=o[d%o.length],x=o[(d+1)%o.length],S=We(d===0?o[o.length-1]:o[(d-1)%o.length],_,S_),R=We(_,x,S_),L=S||R;L&&u.push(_),L&&R||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}const T_=rt.types,xE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],T0=["fill-extrusion-flood-light-ground-radius"],vE=Math.pow(2,13),Gw=Math.pow(2,15)-1,qv=new Xt(0,1),vp=2147483648,Xv=7,qy=450;function M_(o,t,a,u,d,_,x,S){o.emplaceBack((t<<1)+x,(a<<1)+_,(Math.floor(u*vE)<<1)+d,Math.round(S))}function E_(o,t,a){o.emplaceBack(t.x*gi,t.y*gi,a?1:0)}function Lg(o,t,a,u,d,_){o.emplaceBack(t.x,t.y,(a.x<<1)+u,(a.y<<1)+d,_)}function M0(o,t,a){o.emplaceBack(t.x,t.y,t.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Hw{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Xy{constructor(){this.centroidXY=new Xt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Xt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Xt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Xt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Wy{constructor(){this.acc=new Xt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,a){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=a.x,t.min.y=t.max.y=a.y)}appendEdge(t,a,u){this.accCount++,this.acc._add(a);let d=!!this.borders;a.x<t.min.x?(t.min.x=a.x,d=!0):a.x>t.max.x&&(t.max.x=a.x,d=!0),a.y<t.min.y?(t.min.y=a.y,d=!0):a.y>t.max.y&&(t.max.y=a.y,d=!0),((a.x===0||a.x===gi)&&a.x===u.x)!=((a.y===0||a.y===gi)&&a.y===u.y)&&this.processBorderOverlap(a,u),d&&this.checkBorderIntersection(a,u)}checkBorderIntersection(t,a){a.x<0!=t.x<0&&this.addBorderIntersection(0,Rn(a.y,t.y,(0-a.x)/(t.x-a.x))),a.x>gi!=t.x>gi&&this.addBorderIntersection(1,Rn(a.y,t.y,(gi-a.x)/(t.x-a.x))),a.y<0!=t.y<0&&this.addBorderIntersection(2,Rn(a.x,t.x,(0-a.y)/(t.y-a.y))),a.y>gi!=t.y>gi&&this.addBorderIntersection(3,Rn(a.x,t.x,(gi-a.y)/(t.y-a.y)))}addBorderIntersection(t,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[t];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(t,a){if(t.x===a.x){if(t.y===a.y)return;const u=t.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,t.y)}else{const u=t.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,t.x)}}centroid(){return this.accCount===0?new Xt(0,0):new Xt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,a)=>t+ +(a[0]!==Number.MAX_VALUE)),0):0}}function E0(o,t){const a=o.add(t)._unit(),u=oe(o.x*a.x+o.y*a.y,-1,1);var d,_,x;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*Gw*((_=o).x*(x=t).y-_.y*x.x<0?-1:1)}const Wv=[o=>o.x<0,o=>o.x>gi,o=>o.y<0,o=>o.y>gi];function jw(o,t,a,u){const d=[4];if(u===0)return d;a._mult(u);const _=o.sub(a),x=t.sub(a),S=[o,t,_,x];for(let R=0;R<4;R++)for(const L of S)if(Wv[R](L)){d.push(R);break}return d}class A0{constructor(t){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new em,this.indexArray=new Aa,this.programConfigurations=new na(t.layers,{zoom:t.zoom,lut:t.lut},(a=>T0.includes(a))),this._segments=new Es,this.hiddenByLandmarkVertexArray=new Ca,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Es}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,a,u,d=!1){const _=t.length;if(_>2){let x=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let R;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const L=t[0],F=t[1];R=E0(L.sub(t[_-1])._perp()._unit(),F.sub(L)._perp()._unit())}for(let L=0;L<_;L++){const F=L===_-1?0:L+1,U=t[L],G=t[F],X=t[F===_-1?0:F+1],Z=G.sub(U)._perp()._unit(),ne=E0(Z,X.sub(G)._perp()._unit()),he=R,ce=ne;if(Pg(U,G,a)||d&&cm(U,a)&&cm(G,a)){R=ne;continue}const _e=S.vertexLength;Lg(this.vertexArray,U,G,1,1,he),Lg(this.vertexArray,U,G,1,0,he),Lg(this.vertexArray,U,G,0,1,ce),Lg(this.vertexArray,U,G,0,0,ce),S.vertexLength+=4;const xe=jw(U,G,Z,u);for(const Ee of xe)this._segmentToGroundQuads[x].push({id:_e,region:Ee}),this._segmentToRegionTriCounts[x][Ee]+=2,S.primitiveLength+=2;R=ne}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),a=t.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort(((d,_)=>d.region-_.region));for(let u=0;u<a;u++){const d=this._segmentToGroundQuads[u],_=t[u],x=this._segmentToRegionTriCounts[u];x.reduce(((R,L)=>R+L),0);let S=0;for(let R=0;R<=4;R++){const L=x[R];if(L!==0){let F=this.regionSegments[R];F||(F=this.regionSegments[R]=new Es);const U={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+S,vertexLength:_.vertexLength,primitiveLength:L};F.get().push(U)}S+=L}for(let R=0;R<d.length;R++){const L=d[R].id;this.indexArray.emplaceBack(L,L+1,L+3),this.indexArray.emplaceBack(L,L+3,L+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,a,u,d,_,x,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,a,u,d,_,x,void 0,S)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,gE.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=t.createVertexBuffer(this.groundRadiusArray,Fw.members)))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,a,u,d,_,x,S,R){this.hasData()&&this.programConfigurations.updatePaintArrays(t,a,u,d,_,x,S,R)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&vp))}updateHiddenByLandmarkRange(t,a,u){if(!this.hasData())return;const d=a+t;if(a!==0){for(let _=t;_<d;++_)this.hiddenByLandmarkVertexArray.emplace(_,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,Uw.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const a=this.regionSegments[t];a&&a.destroy()}}}}class Pd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Aa,this.footprintVertices=new Tf,this.footprintSegments=[],this.layoutVertexArray=new Sd,this.centroidVertexArray=new Rd,this.wallVertexArray=new ro,this.indexArray=new Aa,this.programConfigurations=new na(t.layers,{zoom:t.zoom,lut:t.lut},(a=>xE.includes(a))),this.segments=new Es,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.groundEffect=new A0(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,a){}updateAppearances(t,a,u,d){}populate(t,a,u,d){this.features=[],this.hasPattern=Uy("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=de(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:x,index:S,sourceLayerIndex:R}of t){const L=this.layers[0]._featureFilter.needGeometry,F=ct(_,L);if(!this.layers[0]._featureFilter.filter(new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),F,u))continue;const U={id:x,sourceLayerIndex:R,index:S,geometry:L?F.geometry:Ye(_,u,d),properties:_.properties,type:_.type,patterns:{}},G=this.layoutVertexArray.length,X=T_[U.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:x0("fill-extrusion",this.layers,U,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const Z of U.geometry)for(const ne of S0(Z,X))this.addFeature(_.id,U,[ne],S,u,{},a.availableImages,d,a.brightness);else this.addFeature(_.id,U,U.geometry,S,u,{},a.availableImages,d,a.brightness);a.featureIndex.insert(_,U.geometry,S,R,this.index,G)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,a,u,d,_,x){for(const{featureId:S,feature:R}of this.features){const L=T_[R.type]==="Polygon",{geometry:F}=R;if(this.wallMode)for(const U of F)for(const G of S0(U,L))this.addFeature(S,R,[G],R.index,a,u,d,_,x);else this.addFeature(S,R,F,R.index,a,u,d,_,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,a,u,d,_,x,S){this.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S,this.worldview),this.groundEffect.update(t,a,_,u,d,x,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,v0.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,_E.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,x_.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,u,d,_,x,S,R,L){const F=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,U=[new Xt(0,0),new Xt(gi,gi)],G=R.projection,X=G.name==="globe",Z=this.wallMode||T_[a.type]==="Polygon",ne=new Wy;ne.centroidDataIndex=this.centroidData.length;const he=new Xy;he.buildingId=t,a.properties&&a.properties.hasOwnProperty("building_id")&&(he.buildingId=a.properties.building_id);const ce=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},_)<=0,_e=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},_);let xe;if(he.height=_e,he.vertexArrayOffset=this.layoutVertexArray.length,he.groundVertexArrayOffset=this.groundEffect.vertexArray.length,X&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ef),this.wallMode){if(X)return void ht("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;xe=(function(ut){const Ot=ut[0].x===ut[ut.length-1].x&&ut[0].y===ut[ut.length-1].y;(function(Ki){let cn=0;const yr=Ki.length;for(let yi=0;yi<yr;yi++)cn+=(Ki[(yi+1)%yr].x-Ki[yi].x)*(Ki[(yi+1)%yr].y+Ki[yi].y);return cn>=0})(ut)||(ut=ut.reverse());const Yt={geometry:[],joinNormals:[],indices:[]},li=[],ui=[],ri=[];let si=ut.length;for(;si>=2&&ut[si-1].equals(ut[si-2]);)si--;if(si<(Ot?3:2))return Yt;let zt,Dt,ai,Ti,pi,dn=0;for(;dn<si-1&&ut[dn].equals(ut[dn+1]);)dn++;Ot&&(zt=ut[si-2],pi=ut[dn].sub(zt)._unit()._perp());for(let Ki=dn;Ki<si;Ki++){if(ai=Ki===si-1?Ot?ut[dn+1]:void 0:ut[Ki+1],ai&&ut[Ki].equals(ai))continue;pi&&(Ti=pi),zt&&(Dt=zt),zt=ut[Ki],pi=ai?ai.sub(zt)._unit()._perp():Ti,Ti=Ti||pi;let cn=Ti.add(pi);cn.x===0&&cn.y===0||cn._unit();const yr=cn.x*pi.x+cn.y*pi.y,yi=yr!==0?1/yr:1/0,un=Ti.x*pi.y-Ti.y*pi.x>0;let Yn="miter";const Ur=2;Yn==="miter"&&yi>Ur&&(Yn="bevel"),Yn==="bevel"&&(yi>100&&(Yn="flipbevel"),yi<Ur&&(Yn="miter"));const jr=(cr,vs,Fe,Ve)=>{const Bt=new Xt(cr.x,cr.y),ci=new Xt(cr.x,cr.y);Bt.x+=vs.x*Ve,Bt.y+=vs.y*Ve,ci.x-=vs.x*Math.max(Fe,1),ci.y-=vs.y*Math.max(Fe,1),ri.push(vs),li.push(Bt),ui.push(ci)};if(Yn==="miter")cn._mult(yi),jr(zt,cn,0,0);else if(Yn==="flipbevel")cn=pi.mult(-1),jr(zt,cn,0,0),jr(zt,cn.mult(-1),0,0);else{const cr=-Math.sqrt(yi*yi-1),vs=un?cr:0,Fe=un?0:cr;Dt&&jr(zt,Ti,vs,Fe),ai&&jr(zt,pi,vs,Fe)}}Yt.geometry=[...li,...ui.reverse(),li[0]],Yt.joinNormals=[...ri,...ri.reverse(),ri[ri.length-1]];const Gi=Yt.geometry.length-1;for(let Ki=0;Ki<Gi/2;Ki++)if(Ki+1<Gi/2){let cn=Ki,yr=Ki+1,yi=Gi-1-Ki,un=Gi-2-Ki;cn=cn===0?Gi-1:cn-1,yr=yr===0?Gi-1:yr-1,yi=yi===0?Gi-1:yi-1,un=un===0?Gi-1:un-1,Yt.indices.push(yi),Yt.indices.push(yr),Yt.indices.push(cn),Yt.indices.push(yi),Yt.indices.push(un),Yt.indices.push(yr)}return Yt})(u[0]),u=[xe.geometry]}const Ee=(ut,Ot)=>ut<(Ot.length-1)/2||ut===Ot.length-1,ke=this.wallMode?[u]:Ig(u,500);for(let ut=ke.length-1;ut>=0;ut--){const Ot=ke[ut];(Ot.length===0||(Be=Ot[0]).every((Zt=>Zt.x<=0))||Be.every((Zt=>Zt.x>=gi))||Be.every((Zt=>Zt.y<=0))||Be.every((Zt=>Zt.y>=gi)))&&ke.splice(ut,1)}var Be;let He;if(X)He=Xw(ke,U,_);else{He=[];for(const ut of ke)He.push({polygon:ut,bounds:U})}const Je=Z?this.edgeRadius:0,tt=Je>0&&this.zoom<17,It=(ut,Ot)=>{if(ut.length===0)return!1;const Zt=ut[ut.length-1];return Ot.x===Zt.x&&Ot.y===Zt.y};for(const{polygon:ut,bounds:Ot}of He){let Zt=0,Yt=0;for(const si of ut)Z&&!si[0].equals(si[si.length-1])&&si.push(si[0]),Yt+=Z?si.length-1:si.length;const li=this.segments.prepareSegment((Z?5:4)*Yt,this.layoutVertexArray,this.indexArray);he.footprintSegIdx<0&&(he.footprintSegIdx=this.footprintSegments.length),he.polygonSegIdx<0&&(he.polygonSegIdx=this.polygonSegments.length);const ui={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ri=new Hw;if(ri.vertexOffset=this.footprintVertices.length,ri.indexOffset=3*this.footprintIndices.length,ri.ringIndices=[],Z){const si=[],zt=[];Zt=li.vertexLength;for(let ai=0;ai<ut.length;ai++){const Ti=ut[ai];Ti.length&&ai!==0&&zt.push(si.length/2);const pi=[];let dn,Gi;dn=Ti[1].sub(Ti[0])._perp()._unit(),ri.ringIndices.push(Ti.length-1);for(let Ki=1;Ki<Ti.length;Ki++){const cn=Ti[Ki],yr=Ti[Ki===Ti.length-1?1:Ki+1],yi=cn.clone();if(Je){Gi=yr.sub(cn)._perp()._unit();const un=dn.add(Gi)._unit(),Yn=Je*Math.min(4,1/(dn.x*un.x+dn.y*un.y));yi.x+=Yn*un.x,yi.y+=Yn*un.y,yi.x=Math.round(yi.x),yi.y=Math.round(yi.y),dn=Gi}if(!ce||Je!==0&&!tt||It(pi,yi)||pi.push(yi),M_(this.layoutVertexArray,yi.x,yi.y,0,0,1,1,0),this.wallMode){const un=Ee(Ki,Ti);E_(this.wallVertexArray,xe.joinNormals[Ki],!un)}li.vertexLength++,this.footprintVertices.emplaceBack(cn.x,cn.y),si.push(cn.x,cn.y),X&&M0(this.layoutVertexExtArray,G.projectTilePoint(yi.x,yi.y,_),G.upVector(_,yi.x,yi.y))}ce&&(Je===0||tt)&&(pi.length!==0&&It(pi,pi[0])&&pi.pop(),this.groundEffect.addData(pi,Ot,F))}const Dt=this.wallMode?xe.indices:d_(si,zt);for(let ai=0;ai<Dt.length;ai+=3)this.footprintIndices.emplaceBack(ri.vertexOffset+Dt[ai+0],ri.vertexOffset+Dt[ai+1],ri.vertexOffset+Dt[ai+2]),this.indexArray.emplaceBack(Zt+Dt[ai],Zt+Dt[ai+2],Zt+Dt[ai+1]),li.primitiveLength++;ri.indexCount+=Dt.length,ri.vertexCount+=this.footprintVertices.length-ri.vertexOffset}for(let si=0;si<ut.length;si++){const zt=ut[si];ne.startRing(he,zt[0]);let Dt=zt.length>4&&qw(zt[zt.length-2],zt[0],zt[1]),ai=Je?Qm(zt[zt.length-2],zt[0],zt[1],Je):0;const Ti=[];let pi,dn,Gi;dn=zt[1].sub(zt[0])._perp()._unit();let Ki=!0;for(let cn=1,yr=0;cn<zt.length;cn++){let yi=zt[cn-1],un=zt[cn];const Yn=zt[cn===zt.length-1?1:cn+1];if(ne.appendEdge(he,un,yi),Pg(un,yi,Ot)){Je&&(dn=Yn.sub(un)._perp()._unit(),Ki=!Ki);continue}const Ur=un.sub(yi)._perp(),jr=Ur.x/(Math.abs(Ur.x)+Math.abs(Ur.y)),cr=Ur.y>0?1:0,vs=yi.dist(un);if(yr+vs>32768&&(yr=0),Je){Gi=Yn.sub(un)._perp()._unit();let ci=A_(yi,un,Yn,lm(dn,Gi),Je);isNaN(ci)&&(ci=0);const Bi=un.sub(yi)._unit();yi=yi.add(Bi.mult(ai))._round(),un=un.add(Bi.mult(-ci))._round(),ai=ci,dn=Gi,ce&&this.zoom>=17&&(It(Ti,yi)||Ti.push(yi),It(Ti,un)||Ti.push(un))}const Fe=li.vertexLength,Ve=zt.length>4&&qw(yi,un,Yn);let Bt=Zv(yr,Dt,Ki);if(M_(this.layoutVertexArray,yi.x,yi.y,jr,cr,0,0,Bt),M_(this.layoutVertexArray,yi.x,yi.y,jr,cr,0,1,Bt),this.wallMode){const ci=Ee(cn-1,zt),Bi=xe.joinNormals[cn-1];E_(this.wallVertexArray,Bi,ci),E_(this.wallVertexArray,Bi,ci)}if(yr+=vs,Bt=Zv(yr,Ve,!Ki),Dt=Ve,M_(this.layoutVertexArray,un.x,un.y,jr,cr,0,0,Bt),M_(this.layoutVertexArray,un.x,un.y,jr,cr,0,1,Bt),this.wallMode){const ci=Ee(cn,zt),Bi=xe.joinNormals[cn];E_(this.wallVertexArray,Bi,ci),E_(this.wallVertexArray,Bi,ci)}if(li.vertexLength+=4,this.indexArray.emplaceBack(Fe+0,Fe+1,Fe+2),this.indexArray.emplaceBack(Fe+1,Fe+3,Fe+2),li.primitiveLength+=2,Je){const ci=Zt+(cn===1?zt.length-2:cn-2),Bi=cn===1?Zt:ci+1;if(this.indexArray.emplaceBack(Fe+1,ci,Fe+3),this.indexArray.emplaceBack(ci,Bi,Fe+3),li.primitiveLength+=2,pi===void 0&&(pi=Fe),!Pg(Yn,zt[cn],Ot)){const Ni=cn===zt.length-1?pi:li.vertexLength;this.indexArray.emplaceBack(Fe+2,Fe+3,Ni),this.indexArray.emplaceBack(Fe+3,Ni+1,Ni),this.indexArray.emplaceBack(Fe+3,Bi,Ni+1),li.primitiveLength+=3}Ki=!Ki}if(X){const ci=this.layoutVertexExtArray,Bi=G.projectTilePoint(yi.x,yi.y,_),Ni=G.projectTilePoint(un.x,un.y,_),mn=G.upVector(_,yi.x,yi.y),yn=G.upVector(_,un.x,un.y);M0(ci,Bi,mn),M0(ci,Bi,mn),M0(ci,Ni,yn),M0(ci,Ni,yn)}}Z&&(Zt+=zt.length-1),ce&&Je&&this.zoom>=17&&(Ti.length!==0&&It(Ti,Ti[0])&&Ti.pop(),this.groundEffect.addData(Ti,Ot,F,Je>0))}this.footprintSegments.push(ri),ui.triangleCount=this.indexArray.length-ui.triangleArrayOffset,this.polygonSegments.push(ui),++he.footprintSegLen,++he.polygonSegLen}if(he.vertexCount=this.layoutVertexArray.length-he.vertexArrayOffset,he.groundVertexCount=this.groundEffect.vertexArray.length-he.groundVertexArrayOffset,he.vertexCount!==0){if(he.centroidXY=ne.borders?qv:this.encodeCentroid(ne,he),this.centroidData.push(he),ne.borders){this.featuresOnBorder.push(ne);const ut=this.featuresOnBorder.length-1;for(let Ot=0;Ot<ne.borders.length;Ot++)ne.borders[Ot][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ot].push(ut)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,x,S,_,L,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,d,x,S,_,L,this.worldview),this.maxHeight=Math.max(this.maxHeight,_e)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((a,u)=>this.featuresOnBorder[a].borders[t][0]-this.featuresOnBorder[u].borders[t][0]))}splitToSubtiles(){const t=[];for(let S=0;S<this.centroidData.length;S++){const R=this.centroidData[S],L=+(R.min.y+R.max.y>gi),F=2*L+(+(R.min.x+R.max.x>gi)^L);for(let U=0;U<R.polygonSegLen;U++){const G=R.polygonSegIdx+U;t.push({centroidIdx:S,subtile:F,polygonSegmentIdx:G,triangleSegmentIdx:this.polygonSegments[G].triangleSegIdx})}}const a=new Aa;t.sort(((S,R)=>S.triangleSegmentIdx===R.triangleSegmentIdx?S.subtile-R.subtile:S.triangleSegmentIdx-R.triangleSegmentIdx));let u=0,d=0,_=0;for(const S of t){if(S.triangleSegmentIdx!==u)break;_++}const x=t.length;for(;d!==t.length;){u=t[d].triangleSegmentIdx;let S=0,R=d,L=d;for(let F=R;F<_&&t[F].subtile===S;F++)L++;for(;R!==_;){const F=t[R];S=F.subtile;const U=this.centroidData[F.centroidIdx].min.clone(),G=this.centroidData[F.centroidIdx].max.clone(),X={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Z=R;Z<L;Z++){const ne=t[Z],he=this.polygonSegments[ne.polygonSegmentIdx],ce=this.centroidData[ne.centroidIdx].min,_e=this.centroidData[ne.centroidIdx].max,xe=this.indexArray.uint16;for(let Ee=he.triangleArrayOffset;Ee<he.triangleArrayOffset+he.triangleCount;Ee++)a.emplaceBack(xe[3*Ee],xe[3*Ee+1],xe[3*Ee+2]);X.primitiveLength+=he.triangleCount,U.x=Math.min(U.x,ce.x),U.y=Math.min(U.y,ce.y),G.x=Math.max(G.x,_e.x),G.y=Math.max(G.y,_e.y)}X.primitiveLength>0&&this.triangleSubSegments.push({segment:X,min:U,max:G}),R=L;for(let Z=R;Z<_&&t[Z].subtile===t[R].subtile;Z++)L++}d=_;for(let F=d;F<x&&t[F].triangleSegmentIdx===t[d].triangleSegmentIdx;F++)_++}a._trim(),this.indexArray=a}getVisibleSegments(t,a,u){const d=new Es;if(this.wallMode){for(const ne of this.triangleSubSegments)d.segments.push(ne.segment);return d}let _=0,x=0;const S=1<<t.canonical.z;if(a){const ne=a.getMinMaxForTile(t);ne&&(_=ne.min,x=ne.max)}x+=this.maxHeight;const R=t.toUnwrapped();let L;const F=[R.canonical.x/S+R.wrap,R.canonical.y/S],U=[(R.canonical.x+1)/S+R.wrap,(R.canonical.y+1)/S],G=(ne,he,ce)=>[ne[0]*(1-ce[0])+he[0]*ce[0],ne[1]*(1-ce[1])+he[1]*ce[1]],X=[],Z=[];for(const ne of this.triangleSubSegments){X[0]=ne.min.x/gi,X[1]=ne.min.y/gi,Z[0]=ne.max.x/gi,Z[1]=ne.max.y/gi;const he=G(F,U,X),ce=G(F,U,Z);if(new Yi([he[0],he[1],_],[ce[0],ce[1],x]).intersectsPrecise(u)===0){L&&(d.segments.push(L),L=void 0);continue}const _e=ne.segment;L&&L.vertexOffset!==_e.vertexOffset&&(d.segments.push(L),L=void 0),L?(L.vertexLength+=_e.vertexLength,L.primitiveLength+=_e.primitiveLength):L={vertexOffset:_e.vertexOffset,primitiveLength:_e.primitiveLength,vertexLength:_e.vertexLength,primitiveOffset:_e.primitiveOffset,sortKey:void 0,vaos:{}}}return L&&d.segments.push(L),d}encodeCentroid(t,a){const u=t.centroid(),d=a.span(),_=Math.min(7,Math.round(d.x*this.tileToMeter/10)),x=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Xt(oe(u.x,1,gi-1)<<3|_,oe(u.y,1,gi-1)<<3|x)}encodeBorderCentroid(t){if(!t.borders)return new Xt(0,0);const a=t.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const d=a[0][0]!==u?0:1;return new Xt(6|(a[0][0]!==u?0:65528),(a[d][0]+a[d][1])/2<<3|6)}{const d=a[2][0]!==u?2:3;return new Xt((a[d][0]+a[d][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(t){const a=this.centroidData[t.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const a=t.vertexArrayOffset,u=t.vertexCount+t.vertexArrayOffset,d=t.flags&vp?qv:t.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==d.y||_!==d.x){for(let x=a;x<u;++x)this.centroidVertexArray.emplace(x,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(t.toUnwrapped());if(w0(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const _=[];for(const x of this.activeReplacements){if(x.order<u)continue;const S=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-t.canonical.z));if(x.footprint.buildingIds)for(const R of this.centroidData)R.flags&vp||x.min.x>R.max.x||R.min.x>x.max.x||x.min.y>R.max.y||R.min.y>x.max.y||x.footprint.buildingIds.has(R.buildingId)&&(R.flags|=vp);else for(const R of this.centroidData)if(!(R.flags&vp||x.min.x>R.max.x||R.min.x>x.max.x||x.min.y>R.max.y||R.min.y>x.max.y))for(let L=0;L<R.footprintSegLen;L++){const F=this.footprintSegments[R.footprintSegIdx+L];if(_.length=0,Ww(this.footprintVertices,F.vertexOffset,F.vertexCount,x.footprintTileId.canonical,t.canonical,_),Hy(x.footprint,_,this.footprintIndices.uint16,F.indexOffset,F.indexCount,-F.vertexOffset,-S)){R.flags|=vp;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,a,u){let d=!1;for(let _=0;_<u.footprintSegLen;_++){const x=this.footprintSegments[u.footprintSegIdx+_];let S=0;for(const R of x.ringIndices){for(let L=S,F=R+S-1;L<R+S;F=L++){const U=this.footprintVertices.int16[2*(L+x.vertexOffset)+0],G=this.footprintVertices.int16[2*(L+x.vertexOffset)+1],X=this.footprintVertices.int16[2*(F+x.vertexOffset)+1];G>a!=X>a&&t<(this.footprintVertices.int16[2*(F+x.vertexOffset)+0]-U)*(a-G)/(X-G)+U&&(d=!d)}S=R}}return d}getHeightAtTileCoord(t,a){let u=Number.NEGATIVE_INFINITY,d=!0;const _=4*(t+gi)*gi+(a+gi);if(this.partLookup.hasOwnProperty(_)){const x=this.partLookup[_];return x?{height:x.height,hidden:!!(x.flags&vp)}:void 0}for(const x of this.centroidData)t>x.max.x||x.min.x>t||a>x.max.y||x.min.y>a||x.height<=u||this.footprintContainsPoint(t,a,x)&&(u=x.height,this.partLookup[_]=x,d=!!(x.flags&vp));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[_]=void 0}}function lm(o,t){const a=o.add(t)._unit();return o.x*a.x+o.y*a.y}function Qm(o,t,a,u){const d=t.sub(o)._perp()._unit(),_=a.sub(t)._perp()._unit();return A_(o,t,a,lm(d,_),u)}function A_(o,t,a,u,d){const _=Math.sqrt(1-u*u);return Math.min(o.dist(t)/3,t.dist(a)/3,d*_/u)}function Pg(o,t,a){return o.x<a[0].x&&t.x<a[0].x||o.x>a[1].x&&t.x>a[1].x||o.y<a[0].y&&t.y<a[0].y||o.y>a[1].y&&t.y>a[1].y}function cm(o,t){return o.x<t[0].x||o.x>t[1].x||o.y<t[0].y||o.y>t[1].y}function qw(o,t,a){if(o.x<0||o.x>=gi||t.x<0||t.x>=gi||a.x<0||a.x>=gi)return!1;const u=a.sub(t),d=u.perp(),_=o.sub(t);return(u.x*_.x+u.y*_.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(_.x*_.x+_.y*_.y))>-.866&&d.x*_.x+d.y*_.y<0}function Zv(o,t,a){const u=t?2|o:-3&o;return a?1|u:-2&u}function C_(){const o=Math.PI/32,t=Math.tan(o),a=p;return a*Math.sqrt(1+2*t*t)-a}function Xw(o,t,a){const u=1<<a.z,d=H(a.x/u),_=H((a.x+1)/u),x=Q(a.y/u),S=Q((a.y+1)/u);return(function(R,L,F,U,G=0,X){const Z=[];if(!R.length||!F||!U)return Z;const ne=(Be,He)=>{for(const Je of Be)Z.push({polygon:Je,bounds:He})},he=Math.ceil(Math.log2(F)),ce=Math.ceil(Math.log2(U)),_e=he-ce,xe=[];for(let Be=0;Be<Math.abs(_e);Be++)xe.push(_e>0?0:1);for(let Be=0;Be<Math.min(he,ce);Be++)xe.push(0),xe.push(1);let Ee=R;if(Ee=Jm(Ee,L[0].y-G,L[1].y+G,1),Ee=Jm(Ee,L[0].x-G,L[1].x+G,0),!Ee.length)return Z;const ke=[];for(xe.length?ke.push({polygons:Ee,bounds:L,depth:0}):ne(Ee,L);ke.length;){const Be=ke.pop(),He=Be.depth,Je=xe[He],tt=Be.bounds[0],It=Be.bounds[1],ut=Je===0?tt.x:tt.y,Ot=Je===0?It.x:It.y,Zt=X?X(Je,ut,Ot):.5*(ut+Ot),Yt=Jm(Be.polygons,ut-G,Zt+G,Je),li=Jm(Be.polygons,Zt-G,Ot+G,Je);if(Yt.length){const ui=[tt,new Xt(Je===0?Zt:It.x,Je===1?Zt:It.y)];xe.length>He+1?ke.push({polygons:Yt,bounds:ui,depth:He+1}):ne(Yt,ui)}if(li.length){const ui=[new Xt(Je===0?Zt:tt.x,Je===1?Zt:tt.y),It];xe.length>He+1?ke.push({polygons:li,bounds:ui,depth:He+1}):ne(li,ui)}}return Z})(o,t,Math.ceil((_-d)/11.25),Math.ceil((x-S)/11.25),1,((R,L,F)=>{if(R===0)return .5*(L+F);{const U=Q((a.y+L/gi)/u);return(O(.5*(Q((a.y+F/gi)/u)+U))*u-a.y)*gi}}))}function Ww(o,t,a,u,d,_){const x=Math.pow(2,u.z-d.z);for(let S=0;S<a;S++){let R=o.int16[2*(S+t)+0],L=o.int16[2*(S+t)+1];R=(R+d.x*gi)*x-u.x*gi,L=(L+d.y*gi)*x-u.y*gi,_.push(new Xt(R,L))}}let C0,Yv;oi(Pd,"FillExtrusionBucket",{omit:["layers","features"]}),oi(Xy,"PartData"),oi(Hw,"FootprintSegment"),oi(Wy,"BorderCentroidData"),oi(A0,"GroundEffect");class zg extends Xt{constructor(t,a,u){super(t,a),this.z=u}}class R0 extends zg{constructor(t,a,u,d){super(t,a,u),this.w=d}}function I0(o,t,a,u){const d=a==="x"?"y":"x",_=(u-o[a])/(t[a]-o[a]);o[d]=Math.round(o[d]+(t[d]-o[d])*_),o[a]=u,o.hasOwnProperty("z")&&(o.z=Rn(o.z,t.z,_)),o.hasOwnProperty("w")&&(o.w=Rn(o.w,t.w,_))}function Kv(o,t,a,u){const d=a,_=u;for(const x of["x","y"]){let S=o,R=t;S[x]>=R[x]&&(S=t,R=o),S[x]<d&&R[x]>d&&I0(S,R,x,d),S[x]<_&&R[x]>_&&I0(R,S,x,_)}}function um(o,t,a,u,d,_){const x=[];for(let S=0;S<o.length;S++){const R=o[S];let L;const F=x.length;let U=0;for(let G=0;G<R.length-1;G++){let X=R[G],Z=R[G+1],ne=0;const he=U;let ce,_e;_&&(ne=Math.hypot(Z.x-X.x,Z.y-X.y),U+=ne,ce=X,_e=Z),X.x<t&&Z.x<t||(X.x<t?X=new Xt(t,X.y+(t-X.x)/(Z.x-X.x)*(Z.y-X.y))._round():Z.x<t&&(Z=new Xt(t,X.y+(t-X.x)/(Z.x-X.x)*(Z.y-X.y))._round()),X.y<a&&Z.y<a||(X.y<a?X=new Xt(X.x+(a-X.y)/(Z.y-X.y)*(Z.x-X.x),a)._round():Z.y<a&&(Z=new Xt(X.x+(a-X.y)/(Z.y-X.y)*(Z.x-X.x),a)._round()),X.x>=u&&Z.x>=u||(X.x>=u?X=new Xt(u,X.y+(u-X.x)/(Z.x-X.x)*(Z.y-X.y))._round():Z.x>=u&&(Z=new Xt(u,X.y+(u-X.x)/(Z.x-X.x)*(Z.y-X.y))._round()),X.y>=d&&Z.y>=d||(X.y>=d?X=new Xt(X.x+(d-X.y)/(Z.y-X.y)*(Z.x-X.x),d)._round():Z.y>=d&&(Z=new Xt(X.x+(d-X.y)/(Z.y-X.y)*(Z.x-X.x),d)._round()),L&&X.equals(L[L.length-1])||(L=[X],x.push(L),_&&_.push({progress:{min:he+Zy(ce,_e,X)*ne,max:1},parentIndex:S,prevPoint:ce,nextPoint:_e})),L.push(Z),_&&(_[_.length-1].progress.max=he+Zy(ce,_e,Z)*ne,_[_.length-1].nextPoint=_e)))))}if(_&&U>0)for(let G=F;G<x.length;G++)_[G].progress.min/=U,_[G].progress.max/=U}return x}function Zw(o,t,a,u,d){if(o.length<2)return void u.push(o);const _=[];for(;t.valid();){const[L,F]=t.get();for(let U=0;U<o.length-1;U++){const G=o[U],X=o[U+1],Z=w(G,X,L,F);if(Z){const[ne]=Z,he=new Xt(Rn(G.x,X.x,ne),Rn(G.y,X.y,ne));_.push({t:U+ne,distance:0,point:he})}}t.next()}if(_.length===0)return void u.push(o);_.sort(((L,F)=>L.t-F.t));let x=0,S=0,R=[];for(u.push(R);x!==o.length;){if(S===_.length){for(;x!==o.length;)R.length!==0&&R[R.length-1].equals(o[x])||R.push(o[x]),x++;break}_[S].t<=x?(R.length!==0&&R[R.length-1].equals(_[S].point)||R.push(_[S].point),Math.trunc(_[S].t),S++):(R.length!==0&&R[R.length-1].equals(o[x])||R.push(o[x]),x++)}}function Zy(o,t,a){return o.x!==t.x?(a.x-o.x)/(t.x-o.x):o.y!==t.y?(a.y-o.y)/(t.y-o.y):0}function eg(o,t){return o.x*t.x+o.y*t.y}function $v(o,t){if(o.length===1){let a=0;const u=t[a++];let d;for(;!d||u.equals(d);)if(d=t[a++],!d)return 1/0;for(;a<t.length;a++){const _=t[a],x=o[0],S=d.sub(u),R=_.sub(u),L=x.sub(u),F=eg(S,S),U=eg(S,R),G=eg(R,R),X=eg(L,S),Z=eg(L,R),ne=F*G-U*U,he=(G*X-U*Z)/ne,ce=(F*Z-U*X)/ne,_e=u.z*(1-he-ce)+d.z*he+_.z*ce;if(isFinite(_e))return _e}return 1/0}{let a=1/0;for(const u of t)a=Math.min(a,u.z);return a}}function Yw(o,t,a){let u=1/0;zr(a,t)&&(u=$v(a,t[0]));for(let d=0;d<t.length;d++){const _=t[d],x=o[d];for(let S=0;S<_.length-1;S++){const R=_[S],L=[R,_[S+1],x[S+1],x[S],R];pr(a,L)&&(u=Math.min(u,$v(a,L)))}}return u!==1/0&&u}function D0(o,t,a,u,d,_,x,S,R,L,F){return o.projection.name==="globe"?(function(U,G,X,Z,ne,he,ce,_e,xe,Ee,ke){const Be=[],He=[],Je=U.projection.upVectorScale(ke,U.center.lat,U.worldSize).metersToTile,tt=[0,0,0,1],It=[0,0,0,1],ut=(Zt,Yt,li,ui)=>{Zt[0]=Yt,Zt[1]=li,Zt[2]=ui,Zt[3]=1},Ot=C_();X>0&&(X+=Ot),Z+=Ot;for(const Zt of G){const Yt=[],li=[];for(const ui of Zt){const ri=ui.x+ne.x,si=ui.y+ne.y,zt=U.projection.projectTilePoint(ri,si,ke),Dt=U.projection.upVector(ke,ui.x,ui.y);let ai=X,Ti=Z;if(ce){const pi=f(ri,si,X,Z,ce,_e,xe,Ee);ai+=pi.base,Ti+=pi.top}X!==0?ut(tt,zt.x+Dt[0]*Je*ai,zt.y+Dt[1]*Je*ai,zt.z+Dt[2]*Je*ai):ut(tt,zt.x,zt.y,zt.z),ut(It,zt.x+Dt[0]*Je*Ti,zt.y+Dt[1]*Je*Ti,zt.z+Dt[2]*Je*Ti),xn(tt,tt,he),xn(It,It,he),Yt.push(new zg(tt[0],tt[1],tt[2])),li.push(new zg(It[0],It[1],It[2]))}Be.push(Yt),He.push(li)}return[Be,He]})(o,t,a,u,d,_,x,S,R,L,F):x?(function(U,G,X,Z,ne,he,ce,_e,xe){const Ee=[],ke=[],Be=[0,0,0,1];for(const He of U){const Je=[],tt=[];for(const It of He){const ut=It.x+Z.x,Ot=It.y+Z.y,Zt=f(ut,Ot,G,X,he,ce,_e,xe);Be[0]=ut,Be[1]=Ot,Be[2]=Zt.base,Be[3]=1,De(Be,Be,ne),Be[3]=Math.max(Be[3],1e-5);const Yt=new zg(Be[0]/Be[3],Be[1]/Be[3],Be[2]/Be[3]);Be[0]=ut,Be[1]=Ot,Be[2]=Zt.top,Be[3]=1,De(Be,Be,ne),Be[3]=Math.max(Be[3],1e-5);const li=new zg(Be[0]/Be[3],Be[1]/Be[3],Be[2]/Be[3]);Je.push(Yt),tt.push(li)}Ee.push(Je),ke.push(tt)}return[Ee,ke]})(t,a,u,d,_,x,S,R,L):(function(U,G,X,Z,ne){const he=[],ce=[],_e=ne[8]*G,xe=ne[9]*G,Ee=ne[10]*G,ke=ne[11]*G,Be=ne[8]*X,He=ne[9]*X,Je=ne[10]*X,tt=ne[11]*X;for(const It of U){const ut=[],Ot=[];for(const Zt of It){const Yt=Zt.x+Z.x,li=Zt.y+Z.y,ui=ne[0]*Yt+ne[4]*li+ne[12],ri=ne[1]*Yt+ne[5]*li+ne[13],si=ne[2]*Yt+ne[6]*li+ne[14],zt=ne[3]*Yt+ne[7]*li+ne[15],Dt=ui+_e,ai=ri+xe,Ti=si+Ee,pi=Math.max(zt+ke,1e-5),dn=ui+Be,Gi=ri+He,Ki=si+Je,cn=Math.max(zt+tt,1e-5);ut.push(new zg(Dt/pi,ai/pi,Ti/pi)),Ot.push(new zg(dn/cn,Gi/cn,Ki/cn))}he.push(ut),ce.push(Ot)}return[he,ce]})(t,a,u,d,_)}function f(o,t,a,u,d,_,x,S){const R=x*d.getElevationAt(o,t,!0,!0),L=_[0]!==0,F=L?_[1]===0?x*(_[0]/Xv-qy):x*(function(U,G,X){const Z=Math.floor(G[0]/8),ne=Math.floor(G[1]/8),he=10*(G[0]-8*Z),ce=10*(G[1]-8*ne),_e=U.getElevationAt(Z,ne,!0,!0),xe=U.getMeterToDEM(X),Ee=Math.floor(.5*(he*xe-1)),ke=Math.floor(.5*(ce*xe-1)),Be=U.tileCoordToPixel(Z,ne),He=2*Ee+1,Je=2*ke+1,tt=(function(li,ui,ri,si,zt){return[li.getElevationAtPixel(ui,ri,!0),li.getElevationAtPixel(ui+zt,ri,!0),li.getElevationAtPixel(ui,ri+zt,!0),li.getElevationAtPixel(ui+si,ri+zt,!0)]})(U,Be.x-Ee,Be.y-ke,He,Je),It=Math.abs(tt[0]-tt[1]),ut=Math.abs(tt[2]-tt[3]),Ot=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),Zt=Math.min(.25,.5*xe*(It+ut)/He),Yt=Math.min(.25,.5*xe*Ot/Je);return _e+Math.max(Zt*he,Yt*ce)})(d,_,S):R;return{base:R+(a===0?-1:a),top:L?Math.max(F+u,R+a+2):R+u}}class y{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class E{constructor(){this.tasks={},this.taskQueue=[],lt(["process"],this),this.invoker=new y(this.process),this.nextId=0}add(t,a){const u=this.nextId++,d=(function({type:_,isSymbolTile:x,zoom:S}){return S=S||0,_==="message"?0:_!=="maybePrepare"||x?_!=="parseTile"||x?_==="parseTile"&&x?300-S:_==="maybePrepare"&&x?400-S:500:200-S:100-S})(a);if(d===0){try{t()}finally{}return null}return this.tasks[u]={fn:t,metadata:a,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((u=>!!this.tasks[u])),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const a=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let t=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const _=this.tasks[this.taskQueue[d]];_.priority<a&&(a=_.priority,t=d)}if(t===null)return null;const u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class P{constructor(t,a,u){this.target=t,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},lt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new E}send(t,a,u,d,_=!1,x){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=x,this.callbacks[S]=u);const R=new Set;return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:d,mustQueue:_,sourceMapId:this.mapId,data:ha(a,R)},R),{cancel:()=>{u&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(t){const a=t.data;if(!a)return;const u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(a.mustQueue||ji(self)){const d=this.callbacks[u],_=this.scheduler.add((()=>this.processTask(u,a)),d&&d.metadata||{type:"message"});_&&(this.cancelCallbacks[u]=_)}else this.processTask(u,a)}processTask(t,a){if(delete this.cancelCallbacks[t],a.type==="<response>"){const u=this.callbacks[t];delete this.callbacks[t],u&&(a.error?u(Su(a.error)):u(null,Su(a.data)))}else{const u=new Set,d=a.hasCallback?(x,S)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:x?ha(x):null,data:ha(S,u)},u)}:()=>{},_=Su(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,_,d);else if(this.parent.getWorkerSource){const x=a.type.split("."),{source:S,scope:R}=_;this.parent.getWorkerSource(a.sourceMapId,x[0],S,R)[x[1]](_,d)}else d(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var W={workerUrl:"",workerClass:null,workerParams:void 0};const J="mapboxgl_preloaded_worker_pool";class ve{constructor(t){this.active={},this.name=t}acquire(t,a=ve.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;){const d=(u=`${this.name||""}WorkerPool: ${t}-${this.workers.length}`,W.workerClass!=null?new W.workerClass:new self.Worker(W.workerUrl,Object.assign({name:u},W.workerParams)));this.workers.push(d)}var u;return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[J]}numActive(){return Object.keys(this.active).length}}ve.workerCount=2;class Xe{constructor(t,a,u="Worker",d=ve.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=at();const _=this.workerPool.acquire(this.id,d);for(let x=0;x<_.length;x++){const S=new Xe.Actor(_[x],a,this.id);S.name=`${u} ${x}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,a,u){$e(this.actors,((d,_)=>{d.send(t,a,_)}),u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Ct,_i;function Hi(){return Ct||(Ct=new ve),Ct}Xe.Actor=P;const nn=4096;class wi{constructor(t){this.module=t,this.memoryStack=this.module.malloc(nn),this.memoryStackNextFree=this.memoryStack}createIntArray(t){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>nn?-1:(new Int32Array(this.module.heap32.buffer,a,t.length).set(t),a)}createFloatArray(t){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=t.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>nn?-1:(new Float32Array(this.module.heapF32.buffer,a,t.length).set(t),a)}readStringBuffer(t){let a="";for(;this.module.heapU8[t]!==0;)a+=String.fromCharCode(this.module.heapU8[t]),++t;return a}setStyle(t){const a=t.normalScale;this.module.setStyle(a[0],a[1],a[2],t.tileToMeters)}setAOOptions(t,a){this.module.setAOOptions(t?1:0,a)}setMetricOptions(t,a){this.module.setMetricOptions(t?1:0,a)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,a){this.module.setFacadeOptions(t,a?1:0)}setFauxFacadeOptions(t,a,u){this.module.setFauxFacadeOptions(t?1:0,a?1:0,u)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,a){this.memoryStackNextFree=this.memoryStack;for(const S of t){const R=this.createIntArray(S.ringIndices),L=this.createFloatArray(S.coordinates);if(R===-1||L===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,S.roofType,L,R,S.ringIndices.length-1)}for(const S of a){let R;R=S.entrances?JSON.parse(S.entrances):[];const L=this.createFloatArray(R),F=this.createFloatArray(S.coordinates);if(L===-1||F===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,L,R.length,F,S.coordinates.length)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const u=this.module.getMeshCount(),d=new Array(u);for(let S=0;S<u;S++){const R=this.module.getPositionsPtr(S),L=this.module.getPositionsLength(S),F=new Float32Array(this.module.heapF32.buffer,R,L),U=this.module.getNormalsPtr(S),G=this.module.getNormalsLength(S),X=new Float32Array(this.module.heapF32.buffer,U,G),Z=this.module.getAOPtr(S),ne=this.module.getAOLength(S),he=new Float32Array(this.module.heapF32.buffer,Z,ne),ce=this.module.getUVPtr(S),_e=this.module.getUVLength(S),xe=new Float32Array(this.module.heapF32.buffer,ce,_e),Ee=this.module.getFauxFacadePtr(S),ke=this.module.getFauxFacadeLength(S),Be=new Uint8Array(this.module.heapU8.buffer,Ee,ke),He=this.module.getIndicesPtr(S),Je=this.module.getIndicesLength(S),tt=new Int16Array(this.module.heap16.buffer,He,Je),It=this.module.getBuildingPart(S);d[S]={positions:F,normals:X,ao:he,uv:xe,isFauxFacade:Be,indices:tt,buildingPart:It}}const _=this.module.getRingCount(),x=[];for(let S=0;S<_;S++){const R=this.module.getRingPtr(S),L=this.module.getRingLength(S),F=new Float32Array(this.module.heapF32.buffer,R,L);x.push(F)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:x}}}let Ci,mr,Cr,sa,Jt,Nt=null,di=null,en=null,Fr=null;function aa(){return ji(self)&&self.worker.dracoUrl?self.worker.dracoUrl:mr||Tn.DRACO_URL}function Tr(){if(ji(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(sa)return sa;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return sa=WebAssembly.validate(o)?Tn.MESHOPT_SIMD_URL:Tn.MESHOPT_URL,sa}function Ds(){return Fr}const Vs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},da={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ff={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Kw(o,t,a){const u=a.json.bufferViews.length,d=a.buffers.length;t.bufferView=u,a.json.bufferViews[u]={buffer:d,byteLength:o.byteLength},a.buffers[d]=o}const bE="KHR_draco_mesh_compression";function RV(o,t){const a=o.extensions&&o.extensions[bE];if(!a)return;const u=new Cr.Decoder,d=dD(t,a.bufferView),_=new Cr.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,_))throw new Error("Failed to decode Draco mesh");const x=t.json.accessors[o.indices],S=Vs[x.componentType],R=x.count*S.BYTES_PER_ELEMENT,L=Cr._malloc(R);S===Uint16Array?u.GetTrianglesUInt16Array(_,R,L):u.GetTrianglesUInt32Array(_,R,L),Kw(Cr.memory.buffer.slice(L,L+R),x,t),Cr._free(L);for(const F of Object.keys(a.attributes)){const U=u.GetAttributeByUniqueId(_,a.attributes[F]),G=t.json.accessors[o.attributes[F]],X=da[G.componentType],Z=G.count*Ff[G.type]*Vs[G.componentType].BYTES_PER_ELEMENT,ne=Cr._malloc(Z);u.GetAttributeDataArrayForAllPoints(_,U,Cr[X],Z,ne),Kw(Cr.memory.buffer.slice(ne,ne+Z),G,t),Cr._free(ne)}u.destroy(),_.destroy(),delete o.extensions[bE]}const $w="EXT_meshopt_compression";function IV(o,t){if(!o.extensions||!o.extensions[$w])return;const a=o.extensions[$w],u=new Uint8Array(t.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),d=new Uint8Array(a.count*a.byteStride);Jt.decodeGltfBuffer(d,a.count,a.byteStride,u,a.mode,a.filter),o.buffer=t.buffers.length,o.byteOffset=0,t.buffers[o.buffer]=d.buffer,delete o.extensions[$w]}const uD=1179937895,hD=new TextDecoder("utf8");function fD(o,t){return new URL(o,t).href}function DV(o,t,a,u){return fetch(fD(o.uri,u)).then((d=>d.arrayBuffer())).then((d=>{t.buffers[a]=d}))}function dD(o,t){const a=o.json.bufferViews[t];return new Uint8Array(o.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function LV(o,t,a,u){if(o.uri){const d=fD(o.uri,u);return fetch(d).then((_=>_.blob())).then((_=>createImageBitmap(_))).then((_=>{t.images[a]=_}))}if(o.bufferView!==void 0){const d=dD(t,o.bufferView),_=new Blob([d],{type:o.mimeType});return createImageBitmap(_).then((x=>{t.images[a]=x}))}}function pD(o,t=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(o,t,1)[0]===uD){const F=new Uint32Array(o,t);let U=2;const G=(F[U++]>>2)-3,X=F[U++]>>2;if(U++,u.json=JSON.parse(hD.decode(F.subarray(U,U+X))),U+=X,U<G){const Z=F[U++];U++;const ne=t+(U<<2);u.buffers[0]=o.slice(ne,ne+Z)}}else u.json=JSON.parse(hD.decode(new Uint8Array(o,t)));const{buffers:d,images:_,meshes:x,extensionsUsed:S,bufferViews:R}=u.json;let L=Promise.resolve();if(d){const F=[];for(let U=0;U<d.length;U++){const G=d[U];G.uri?F.push(DV(G,u,U,a)):u.buffers[U]||(u.buffers[U]=null)}L=Promise.all(F)}return L.then((()=>{const F=[],U=S&&S.includes(bE),G=S&&S.includes($w);if(U&&F.push((function(){if(!Cr)return Ci??(Ci=(function(X){let Z,ne=null;function he(){Z=new Uint8Array(ne.buffer)}function ce(){throw new Error("Unexpected Draco error.")}const _e={a:{a:ce,d:function(xe,Ee,ke){return Z.copyWithin(xe,Ee,Ee+ke)},c:function(xe){const Ee=Z.length,ke=Math.max(xe>>>0,Math.ceil(1.2*Ee)),Be=Math.ceil((ke-Ee)/65536);try{return ne.grow(Be),he(),!0}catch{return!1}},b:ce}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(X,_e):X.then((xe=>xe.arrayBuffer())).then((xe=>WebAssembly.instantiate(xe,_e)))).then((xe=>{const{Rb:Ee,Qb:ke,P:Be,T:He,X:Je,Ja:tt,La:It,Qa:ut,Va:Ot,Wa:Zt,eb:Yt,jb:li,f:ui,e:ri,yb:si,zb:zt,Ab:Dt,Bb:ai,Db:Ti,Gb:pi}=xe.instance.exports;ne=ri;const dn=(()=>{let Gi=0,Ki=0,cn=0,yr=0;return yi=>{cn&&(Ee(yr),Ee(Gi),Ki+=cn,cn=Gi=0),Gi||(Ki+=128,Gi=ke(Ki));const un=yi.length+7&-8;let Yn=Gi;un>=Ki&&(cn=un,Yn=yr=ke(un));for(let Ur=0;Ur<yi.length;Ur++)Z[Yn+Ur]=yi[Ur];return Yn}})();return he(),ui(),{memory:ri,_free:Ee,_malloc:ke,Mesh:class{constructor(){this.ptr=Be()}destroy(){He(this.ptr)}},Decoder:class{constructor(){this.ptr=tt()}destroy(){li(this.ptr)}DecodeArrayToMesh(Gi,Ki,cn){const yr=dn(Gi),yi=It(this.ptr,yr,Ki,cn.ptr);return!!Je(yi)}GetAttributeByUniqueId(Gi,Ki){return{ptr:ut(this.ptr,Gi.ptr,Ki)}}GetTrianglesUInt16Array(Gi,Ki,cn){Ot(this.ptr,Gi.ptr,Ki,cn)}GetTrianglesUInt32Array(Gi,Ki,cn){Zt(this.ptr,Gi.ptr,Ki,cn)}GetAttributeDataArrayForAllPoints(Gi,Ki,cn,yr,yi){Yt(this.ptr,Gi.ptr,Ki.ptr,cn,yr,yi)}},DT_INT8:si(),DT_UINT8:zt(),DT_INT16:Dt(),DT_UINT16:ai(),DT_UINT32:Ti(),DT_FLOAT32:pi()}}))})(fetch(aa())),Ci.then((X=>{Cr=X,Ci=void 0})))})()),G&&F.push((function(){if(Jt)return;const X=(function(Z){let ne;const he=WebAssembly.instantiateStreaming(Z,{}).then((xe=>{ne=xe.instance,ne.exports.__wasm_call_ctors()})),ce={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_e={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:he,supported:!0,decodeGltfBuffer(xe,Ee,ke,Be,He,Je){(function(tt,It,ut,Ot,Zt,Yt,li){const ui=tt.exports.sbrk,ri=Ot+3&-4,si=ui(ri*Zt),zt=ui(Yt.length),Dt=new Uint8Array(tt.exports.memory.buffer);Dt.set(Yt,zt);const ai=It(si,Ot,Zt,zt,Yt.length);if(ai===0&&li&&li(si,ri,Zt),ut.set(Dt.subarray(si,si+Ot*Zt)),ui(si-ui(0)),ai!==0)throw new Error(`Malformed buffer data: ${ai}`)})(ne,ne.exports[_e[He]],xe,Ee,ke,Be,ne.exports[ce[Je]])}}})(fetch(Tr()));return X.ready.then((()=>{Jt=X}))})()),_)for(let X=0;X<_.length;X++)F.push(LV(_[X],u,X,a));return(F.length?Promise.all(F):Promise.resolve()).then((()=>{if(U&&x)for(const{primitives:X}of x)for(const Z of X)RV(Z,u);if(G&&x&&R)for(const X of R)IV(X,u);return u}))}))}function mD(o){return fetch(o).then((t=>t.arrayBuffer())).then((t=>pD(t,0,o)))}function wE(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function SE(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class TE{constructor(t,a,u,d){this.context=t,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=t.gl.createTexture(),this.update(a,{premultiply:d&&d.premultiply})}update(t,a){const u=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,d=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:_}=this,{gl:x}=_,{x:S,y:R}=a&&a.position?a.position:{x:0,y:0},L=S+u,F=R+d;!this.size||this.size[0]===L&&this.size[1]===F||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!a||a.premultiply!==!1));const U=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&L>0&&F>0){const G=this.useMipmap?Math.floor(Math.log2(Math.max(L,F)))+1:1;x.texStorage2D(x.TEXTURE_2D,G,this.format,L,F),this.size=[L,F]}this.size&&(U?x.texSubImage2D(x.TEXTURE_2D,0,S,R,wE(this.format),SE(this.format),t):"data"in t&&t.data&&x.texSubImage2D(x.TEXTURE_2D,0,S,R,u,d,wE(this.format),SE(this.format),t.data)),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(t,a,u=!1){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),t!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!u?t===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(t,a,u,d,_){const{context:x}=this,{gl:S}=x;S.bindTexture(S.TEXTURE_2D,this.texture),a!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),this.magFilter=a),t!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?t===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),u!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,d),this.wrapT=d),_!==this.compareMode&&(_?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,_)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=_)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Jv{constructor(t,a){this.context=t,this.texture=a}bind(t,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,t),this.minFilter=t),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}}const PV=vr([{name:"a_pos_3f",components:3,type:"Float32"}]),zV=vr([{name:"a_color_3f",components:3,type:"Float32"}]),OV=vr([{name:"a_color_4f",components:4,type:"Float32"}]),BV=vr([{name:"a_uv_2f",components:2,type:"Float32"}]),NV=vr([{name:"a_normal_3f",components:3,type:"Float32"}]),FV=vr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),UV=vr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function gD(o,t){const a=Jw(o.projection,o.zoom,o.width,o.height),u=(function(_,x,S,R,L){const F=new c(S.lng-180*R_,S.lat),U=new c(S.lng+180*R_,S.lat),G=_.project(F.lng,F.lat),X=_.project(U.lng,U.lat),Z=-Math.atan2(X.y-G.y,X.x-G.x),ne=be.fromLngLat(S);ne.y=oe(ne.y,-1+R_,1-R_);const he=ne.toLngLat(),ce=_.project(he.lng,he.lat),_e=be.fromLngLat(he);_e.x+=R_;const xe=_e.toLngLat(),Ee=_.project(xe.lng,xe.lat),ke=yD(Ee.x-ce.x,Ee.y-ce.y,Z),Be=be.fromLngLat(he);Be.y+=R_;const He=Be.toLngLat(),Je=_.project(He.lng,He.lat),tt=yD(Je.x-ce.x,Je.y-ce.y,Z),It=Math.abs(ke.x)/Math.abs(tt.y),ut=ie([]);ze(ut,ut,-Z*(1-(L?0:R)));const Ot=ie([]);return me(Ot,Ot,[1,1-(1-It)*R,1]),Ot[4]=-tt.x/tt.y*R,ze(Ot,Ot,Z),ae(Ot,ut,Ot),Ot})(o.projection,0,o.center,a,t),d=_D(o);return me(u,u,[d,d,1]),u}function _D(o){const t=o.projection,a=Jw(o.projection,o.zoom,o.width,o.height),u=ME(t,o.center),d=ME(t,c.convert(t.center));return Math.pow(2,u*a+(1-a)*d)}function Jw(o,t,a,u,d=1/0){const _=o.range;if(!_)return 0;const x=Math.min(d,Math.max(a,u)),S=Math.log2(x/1024);return ge(_[0]+S,_[1]+S,t)}const R_=1/4e4;function ME(o,t){const a=oe(t.lat,-ee,ee),u=new c(t.lng-180*R_,a),d=new c(t.lng+180*R_,a),_=o.project(u.lng,a),x=o.project(d.lng,a),S=be.fromLngLat(u),R=be.fromLngLat(d),L=x.x-_.x,F=x.y-_.y,U=R.x-S.x,G=R.y-S.y,X=Math.sqrt((U*U+G*G)/(L*L+F*F));return Math.log2(X)}function yD(o,t,a){const u=Math.cos(a),d=Math.sin(a);return{x:o*u-t*d,y:o*d+t*u}}function xD(o,t,a){ie(o),ze(o,o,Ar(t[2])),Ae(o,o,Ar(t[0])),Se(o,o,Ar(t[1])),me(o,o,a),ae(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Qw(o,t,a,u,d,_,x,S){const R=[a[0]-t[0],a[1]-t[1],0],L=[u[0]-t[0],u[1]-t[1],0];if(kt(R)<1e-12||kt(L)<1e-12)return Li(o);const F=Fn([],R,L);Ui(F,F),Lt(L,u,t),R[2]=(_-d)*S,L[2]=(x-d)*S;const U=R;return Fn(U,R,L),Ui(U,U),Qi(o,F,U)}function eS(o,t,a=!1){const u=bc(t.zoom),d=(function(_,x,S){const R=x.worldSize,L=[_[12],_[13],_[14]],F=Q(L[1]/R),U=H(L[0]/R),G=ie([]),X=V(1,F)*R,Z=V(1,0)*R*se(F,x.zoom),ne=1/u_(R);let he=Z*ne;if(S){const Ee=Jw(x.projection,x.zoom,x.width,x.height,1024);he=ne*x.projection.pixelSpaceConversion(x.center.lat,R,Ee)}const ce=lo(F,U);et(ce,ce,Vt([],Ui([],ce),X*he*L[2]));const _e=(function(Ee){const ke=[Ee[0],Ee[1],Ee[2]];let Be=[0,1,0];const He=Fn([],Be,ke);return Fn(Be,ke,He),xi(Be)===0&&(Be=[0,1,0],Fn(He,ke,Be)),Ui(He,He),Ui(Be,Be),Ui(ke,ke),[He[0],He[1],He[2],0,Be[0],Be[1],Be[2],0,ke[0],ke[1],ke[2],0,Ee[0],Ee[1],Ee[2],1]})(ce);me(G,G,[he,he,he*X]),ue(G,G,[-L[0],-L[1],-L[2]]);const xe=ae([],x.globeMatrix,_e);return ae(xe,xe,G),ae(xe,xe,_),xe})(o,t,a);if(u>0){const _=(function(x,S){const R=S.worldSize,L=V(1,0)*R*se(S.center.lat,S.zoom)/u_(R),F=V(1,S.center.lat)*R,U=ie([]);Se(U,U,Ar(S.center.lng)),Ae(U,U,Ar(S.center.lat)),ue(U,U,[0,0,cs]),me(U,U,[L,L,L*F]);const G=S.point;return ue(U,U,[-G.x,-G.y,0]),ae(U,U,x),ae(U,S.globeMatrix,U)})(o,t);return(function(x,S,R){const L=(Z,ne,he)=>{const ce=kt(Z),_e=kt(ne),xe=ks(Z,ne,he);return Vt(xe,xe,1/kt(xe)*Rn(ce,_e,he))},F=L([x[0],x[1],x[2]],[S[0],S[1],S[2]],R),U=L([x[4],x[5],x[6]],[S[4],S[5],S[6]],R),G=L([x[8],x[9],x[10]],[S[8],S[9],S[10]],R),X=ks([x[12],x[13],x[14]],[S[12],S[13],S[14]],R);return[F[0],F[1],F[2],0,U[0],U[1],U[2],0,G[0],G[1],G[2],0,X[0],X[1],X[2],1]})(d,_,u)}return d}function EE(o,t,a,u){const d=Yi.projectAabbCorners(u,a);let _=Number.MAX_VALUE;for(let S=0;S<d.length;++S){const R=d[S];R[0]=(.5*R[0]+.5)*t.width,R[1]=(.5-.5*R[1])*t.height,R[2]<_&&(_=R[2])}const x=(function(S){const R=[];let L=0;for(let X=1;X<S.length;X++)(S[X][0]<S[L][0]||S[X][0]===S[L][0]&&S[X][1]<S[L][1])&&(L=X);let F,U=L;const G=new Uint8Array(S.length);do{if(G[U])break;R.push(new Xt(S[U][0],S[U][1])),G[U]=1,F=(U+1)%S.length;for(let X=0;X<S.length;X++){if(S[X][0]===S[F][0]&&S[X][1]===S[F][1]||S[X][0]===S[U][0]&&S[X][1]===S[U][1])continue;const Z=[S[X][0]-S[U][0],S[X][1]-S[U][1]],ne=[S[F][0]-S[U][0],S[F][1]-S[U][1]],he=Z[0]*ne[1]-Z[1]*ne[0];(he>0||he===0&&Z[0]*ne[0]+Z[1]*ne[1]>=0&&Z[0]*Z[0]+Z[1]*Z[1]>ne[0]*ne[0]+ne[1]*ne[1])&&(F=X)}U=F}while(U!==L);return R.length>0&&R.push(R[0]),R})(d);if(pr(o,x))return _}const L0=64,Yy={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function tS(o,t,a,u,d,_,x,S,R,L=!1){const F=a.zoom,U=a.project(u),G=se(u.lat,F),X=1/G;ie(o),ue(o,o,[U.x+x[0]*X,U.y+x[1]*X,x[2]]);let Z=1,ne=1;const he=a.worldSize;if(L){if(a.projection.name==="mercator"){let Ee=0;a.elevation&&(Ee=a.elevation.getAtPointOrZero(new be(U.x/he,U.y/he),0));const ke=De([],[U.x,U.y,Ee,1],a.projMatrix)[3]/a.cameraToCenterDistance;Z=ke,ne=ke*se(a.center.lat,F)}else if(a.projection.name==="globe"){const Ee=eS(o,a),ke=[0,0,0,1];De(ke,ke,ae([],a.projMatrix,Ee));const Be=ke[3]/a.cameraToCenterDistance,He=bc(F),Je=a.projection.pixelsPerMeter(u.lat,he)*se(u.lat,F),tt=a.projection.pixelsPerMeter(a.center.lat,he)*se(a.center.lat,F);Z=Be/Rn(Je,le(a.center.lat),He),ne=Be*G/Je,Z*=tt,ne*=tt}}else Z=X;me(o,o,[Z,Z,ne]);const ce=[...o],_e=t.orientation,xe=[];if(xD(xe,[_e[0]+(d?d[0]:0),_e[1]+(d?d[1]:0),_e[2]+(d?d[2]:0)],_),ae(o,ce,xe),S&&a.elevation){let Ee=0;const ke=[];if(R&&a.elevation){Ee=(function(He,Je,tt,It,ut){const Ot=Je.elevation;if(!Ot)return 0;const Zt=Yi.projectAabbCorners(tt,It),Yt=V(1,ut.lat)*Je.worldSize,li=(function(Ki,cn){const yr=[0,0,1],yi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const un of yi){const Yn=Ki[un.corners[0]],Ur=Ki[un.corners[1]],jr=Ki[un.corners[2]],cr=[Ur[0]-Yn[0],Ur[1]-Yn[1],cn*(Ur[2]-Yn[2])],vs=Fn(cr,cr,[jr[0]-Yn[0],jr[1]-Yn[1],cn*(jr[2]-Yn[2])]);Ui(vs,vs),un.dotProductWithUp=rn(vs,yr)}return yi.sort(((un,Yn)=>un.dotProductWithUp-Yn.dotProductWithUp)),yi[0].corners})(Zt,Yt),ui=Zt[li[0]],ri=Zt[li[1]],si=Zt[li[2]],zt=Zt[li[3]],Dt=Ot.getAtPointOrZero(new be(ui[0]/Je.worldSize,ui[1]/Je.worldSize),0),ai=Ot.getAtPointOrZero(new be(ri[0]/Je.worldSize,ri[1]/Je.worldSize),0),Ti=Ot.getAtPointOrZero(new be(si[0]/Je.worldSize,si[1]/Je.worldSize),0),pi=Ot.getAtPointOrZero(new be(zt[0]/Je.worldSize,zt[1]/Je.worldSize),0),dn=(Dt+pi)/2,Gi=(ai+Ti)/2;return dn>Gi?ai<Ti?Qw(He,ri,zt,ui,ai,pi,Dt,Yt):Qw(He,si,ui,zt,Ti,Dt,pi,Yt):Dt<pi?Qw(He,ui,ri,si,Dt,ai,Ti,Yt):Qw(He,zt,si,ri,pi,Ti,ai,Yt),Math.max(dn,Gi)})(ke,a,t.aabb,o,u);const Be=ae([],Ze([],ke),xe);ae(o,ce,Be)}else Ee=a.elevation.getAtPointOrZero(new be(U.x/he,U.y/he),0);Ee!==0&&(o[14]+=Ee)}}class vD{constructor(t,a,u,d,_){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=t,this.uri=a,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=d??[0,0,0],this.nodes=_,this.uploaded=!1,this.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,a){ae(t.globalMatrix,a,t.localMatrix);const u=this.nodeOverrides.get(t.name);if(u!==void 0){const x=[];_=u.orientation,ie(d=x),Se(d,d,Ar(_[1])),ze(d,d,Ar(_[2])),Ae(d,d,Ar(_[0])),ae(t.globalMatrix,t.globalMatrix,x)}var d,_;if(t.meshes)for(const x of t.meshes){const S=Yi.applyTransformFast(x.aabb,t.globalMatrix);this.aabb.encapsulate(S)}if(t.children)for(const x of t.children)this._applyTransformations(x,t.globalMatrix)}computeBoundsAndApplyParent(){const t=ie([]);this.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,t)}computeModelMatrix(t,a,u,d,_,x,S=!1){tS(this.matrix,this,t.transform,this.position,a,u,d,_,x,S)}upload(t){if(!this.uploaded){for(const a of this.nodes)AE(a,t);for(const a of this.nodes)iS(a);this.uploaded=!0}}destroy(){for(const t of this.nodes)CE(t)}}function Qv(o,t,a=!1){o.uploaded||(o.gfxTexture=new TE(t,o.image,a?t.gl.R8:t.gl.RGBA8,{useMipmap:o.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function kV(o,t,a){o.indexBuffer=t.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=t.createVertexBuffer(o.vertexArray,PV.members,!1,!0),o.normalArray&&(o.normalBuffer=t.createVertexBuffer(o.normalArray,NV.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=t.createVertexBuffer(o.texcoordArray,BV.members,!1,!0)),o.colorArray&&(o.colorBuffer=t.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?zV:OV).members,!1,!0)),o.featureArray&&(o.pbrBuffer=t.createVertexBuffer(o.featureArray,UV.members,!0)),o.segments=Es.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const u=o.material;u.pbrMetallicRoughness.baseColorTexture&&Qv(u.pbrMetallicRoughness.baseColorTexture,t),u.pbrMetallicRoughness.metallicRoughnessTexture&&Qv(u.pbrMetallicRoughness.metallicRoughnessTexture,t),u.normalTexture&&Qv(u.normalTexture,t),u.occlusionTexture&&Qv(u.occlusionTexture,t,a),u.emissionTexture&&Qv(u.emissionTexture,t)}function AE(o,t,a){if(o.meshes)for(const u of o.meshes)kV(u,t,a);if(o.children)for(const u of o.children)AE(u,t,a)}function iS(o){if(o.meshes)for(const t of o.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(o.children)for(const t of o.children)iS(t)}function CE(o){if(o.meshes)for(const a of o.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((t=a.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(o.children)for(const a of o.children)CE(a)}function P0(o,t){const a=o.json.bufferViews[t.bufferView],u=Vs[t.componentType];return new u(o.buffers[a.buffer],(t.byteOffset||0)+(a.byteOffset||0),t.count*(a.byteStride&&a.byteStride!==Ff[t.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:Ff[t.type]))}function RE(o,t,a,u){const d=Vs[t.componentType],_=(function(F){switch(F){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),x=o.json.bufferViews[t.bufferView],S=x.byteStride?x.byteStride/d.BYTES_PER_ELEMENT:Ff[t.type],R=a.float32,L=R.length/a.capacity;for(let F=0,U=0;F<t.count*S;F+=S,U+=L)for(let G=0;G<L;G++)R[U+G]=u[F+G]*_;a._trim()}function VV(o,t,a){const u=o.indices,d=o.attributes,_={};_.indexArray=new Aa;const x=t.json.accessors[u],S=x.count/3;_.indexArray.reserve(S);const R=P0(t,x);for(let G=0;G<S;G++)_.indexArray.emplaceBack(R[3*G],R[3*G+1],R[3*G+2]);_.indexArray._trim(),_.vertexArray=new _c;const L=t.json.accessors[d.POSITION];_.vertexArray.reserve(L.count);const F=P0(t,L);for(let G=0;G<L.count;G++)_.vertexArray.emplaceBack(F[3*G],F[3*G+1],F[3*G+2]);if(_.vertexArray._trim(),_.aabb=new Yi(L.min,L.max),_.centroid=(function(G,X){const Z=[0,0,0],ne=G.length;if(ne>0){for(let he=0;he<ne;he++){const ce=3*G[he];Z[0]+=X[ce],Z[1]+=X[ce+1],Z[2]+=X[ce+2]}Z[0]/=ne,Z[1]/=ne,Z[2]/=ne}return Z})(R,F),d.COLOR_0!==void 0){const G=t.json.accessors[d.COLOR_0],X=Ff[G.type],Z=P0(t,G);_.colorArray=X===3?new _c:new io,_.colorArray.resize(G.count),RE(t,G,_.colorArray,Z)}if(d.NORMAL!==void 0){_.normalArray=new _c;const G=t.json.accessors[d.NORMAL];_.normalArray.resize(G.count);const X=P0(t,G);RE(t,G,_.normalArray,X)}if(d.TEXCOORD_0!==void 0&&a.length>0){_.texcoordArray=new Xc;const G=t.json.accessors[d.TEXCOORD_0];_.texcoordArray.resize(G.count);const X=P0(t,G);RE(t,G,_.texcoordArray,X)}if(d._FEATURE_ID_RGBA4444!==void 0){const G=t.json.accessors[d._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=P0(t,G))}d._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(P0(t,t.json.accessors[d._FEATURE_RGBA4444]).buffer));const U=o.material;return _.material=(function(G,X){const{emissiveFactor:Z=[0,0,0],alphaMode:ne="OPAQUE",alphaCutoff:he=.5,normalTexture:ce,occlusionTexture:_e,emissiveTexture:xe,doubleSided:Ee,name:ke}=G,{baseColorFactor:Be=[1,1,1,1],metallicFactor:He=1,roughnessFactor:Je=1,baseColorTexture:tt,metallicRoughnessTexture:It}=G.pbrMetallicRoughness||{},ut=_e?X[_e.index]:void 0;if(_e&&_e.extensions&&_e.extensions.KHR_texture_transform&&ut){const Ot=_e.extensions.KHR_texture_transform;ut.offsetScale=[Ot.offset[0],Ot.offset[1],Ot.scale[0],Ot.scale[1]]}return{name:ke,pbrMetallicRoughness:{baseColorFactor:new qr(...Be),metallicFactor:He,roughnessFactor:Je,baseColorTexture:tt?X[tt.index]:void 0,metallicRoughnessTexture:It?X[It.index]:void 0},doubleSided:Ee,emissiveFactor:new qr(...Z),alphaMode:ne,alphaCutoff:he,normalTexture:ce?X[ce.index]:void 0,occlusionTexture:ut,emissionTexture:xe?X[xe.index]:void 0,defined:G.defined===void 0}})(U!==void 0?t.json.materials[U]:{defined:!1},a),_}function bD(o,t,a){const{matrix:u,rotation:d,translation:_,scale:x,mesh:S,extras:R,children:L,name:F}=o,U={};if(U.name=F,U.localMatrix=u||(function(G,X,Z,ne){var he=X[0],ce=X[1],_e=X[2],xe=X[3],Ee=he+he,ke=ce+ce,Be=_e+_e,He=he*Ee,Je=he*ke,tt=he*Be,It=ce*ke,ut=ce*Be,Ot=_e*Be,Zt=xe*Ee,Yt=xe*ke,li=xe*Be,ui=ne[0],ri=ne[1],si=ne[2];return G[0]=(1-(It+Ot))*ui,G[1]=(Je+li)*ui,G[2]=(tt-Yt)*ui,G[3]=0,G[4]=(Je-li)*ri,G[5]=(1-(He+Ot))*ri,G[6]=(ut+Zt)*ri,G[7]=0,G[8]=(tt+Yt)*si,G[9]=(ut-Zt)*si,G[10]=(1-(He+It))*si,G[11]=0,G[12]=Z[0],G[13]=Z[1],G[14]=Z[2],G[15]=1,G})([],d||[0,0,0,1],_||[0,0,0],x||[1,1,1]),U.globalMatrix=re(U.localMatrix),S!==void 0){U.meshes=a[S];const G=U.anchor=[0,0];for(const X of U.meshes){const{min:Z,max:ne}=X.aabb;G[0]+=Z[0]+ne[0],G[1]+=Z[1]+ne[1]}G[0]=Math.floor(G[0]/U.meshes.length/2),G[1]=Math.floor(G[1]/U.meshes.length/2)}if(R&&(R.id&&(U.id=R.id),R.lights&&(U.lights=(function(G){if(!G.length)return[];const X=(function(_e){const xe=atob(_e),Ee=new Uint8Array(xe.length);for(let ke=0;ke<xe.length;ke++)Ee[ke]=xe.codePointAt(ke);return Ee})(G),Z=[],ne=X.length/24,he=new Uint16Array(X.buffer),ce=new Float32Array(X.buffer);for(let _e=0;_e<ne;_e++){const xe=he[2*_e*6]/30,Ee=he[2*_e*6+1]/30,ke=he[2*_e*6+10]/100,Be=ce[6*_e+1],He=ce[6*_e+2],Je=ce[6*_e+3],tt=ce[6*_e+4],It=Je-Be,ut=tt-He,Ot=Math.hypot(It,ut);Z.push({pos:[Be+.5*It,He+.5*ut,Ee],normal:[ut/Ot,-It/Ot,0],width:Ot,height:xe,depth:ke,points:[Be,He,Je,tt]})}return Z})(R.lights)),R.MAPBOX_geometry_bloom&&(U.isGeometryBloom=R.MAPBOX_geometry_bloom)),L){const G=[];for(const X of L)G.push(bD(t.json.nodes[X],t,a));U.children=G}return U}function GV(o){if(o.vertices.length===0||o.indices.length===0)return null;const t=new Vy(o.vertices,o.indices,8,256),[a,u]=[t.min.clone(),t.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:t,min:a,max:u}}function HV(o){if(!o.extras||!o.extras.ground)return null;const t=o.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const a=t[0];if(!a||!Array.isArray(a)||a.length===0)return null;const u=[];for(const x of a){if(!Array.isArray(x)||x.length!==2)continue;const S=x[0],R=x[1];typeof S=="number"&&typeof R=="number"&&u.push(new Xt(S,R))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let x=0;x<u.length;x++){const S=u[x],R=u[(x+1)%u.length],L=u[(x+2)%u.length];d+=(S.x-R.x)*(L.y-R.y)-(L.x-R.x)*(S.y-R.y)}d>0&&u.reverse();const _=d_(u.flatMap((x=>[x.x,x.y])),[]);return _.length===0?null:{vertices:u,indices:_}}function jV(o,t){const a=[],u=[];let d=0;const _=[];for(const x of o){d=a.length;const S=x.vertexArray.float32,R=x.indexArray.uint16;for(let L=0;L<x.vertexArray.length;L++)_[0]=S[3*L+0],_[1]=S[3*L+1],_[2]=S[3*L+2],xn(_,_,t),a.push(new Xt(_[0],_[1]));for(let L=0;L<3*x.indexArray.length;L++)u.push(R[L]+d)}if(u.length%3!=0)return null;for(let x=0;x<u.length;x+=3){const S=a[u[x+0]],R=a[u[x+1]],L=a[u[x+2]];(S.x-R.x)*(L.y-R.y)-(L.x-R.x)*(S.y-R.y)>0&&([u[x+1],u[x+2]]=[u[x+2],u[x+1]])}return{vertices:a,indices:u}}function IE(o){const t=(function(R,L){const F=[],U=WebGL2RenderingContext;if(R.json.textures)for(const G of R.json.textures){const X={magFilter:U.LINEAR,minFilter:U.NEAREST,wrapS:U.REPEAT,wrapT:U.REPEAT};G.sampler!==void 0&&Object.assign(X,R.json.samplers[G.sampler]),F.push({image:L[G.source],sampler:X,uploaded:!1})}return F})(o,o.images),a=(function(R,L){const F=[];for(const U of R.json.meshes){const G=[];for(const X of U.primitives)G.push(VV(X,R,L));F.push(G)}return F})(o,t),{scenes:u,scene:d,nodes:_}=o.json,x=u?u[d||0].nodes:[..._.keys()],S=[];for(const R of x)S.push(bD(_[R],o,a));return(function(R,L,F){const U={},G=new Set;for(let X=0;X<R.length;X++){const Z=F[L[X]];if(!Z.extras)continue;const ne=Z.extras["mapbox:footprint:version"],he=Z.extras["mapbox:footprint:id"];(ne||he)&&G.add(X),ne==="1.0.0"&&he&&(U[he]=X)}for(let X=0;X<R.length;X++){if(G.has(X))continue;const Z=R[X],ne=F[L[X]];if(!ne.extras)continue;let he=null;Z.id in U&&(he=jV(R[U[Z.id]].meshes,Z.localMatrix)),he||(he=HV(ne)),he&&(Z.footprint=GV(he))}if(G.size>0){const X=Array.from(G.values()).sort(((Z,ne)=>Z-ne));for(let Z=X.length-1;Z>=0;Z--)R.splice(X[Z],1)}})(S,x,o.json.nodes),S}function qV(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const t=o.vertexArray.float32,a=o.aabb.min[0]-1,u=o.aabb.min[1]-1,d=L0/(o.aabb.max[0]-a+2),_=L0/(o.aabb.max[1]-u+2);for(let x=0;x<t.length;x+=3){const S=t[x+2],R=(t[x+0]-a)*d|0,L=(t[x+1]-u)*_|0;S>o.heightmap[L*L0+R]&&(o.heightmap[L*L0+R]=S)}}function wD(o,t,a,u,d){a.reserve(a.length+4*o.length),u.reserve(u.length+10*o.length),d.reserve(d.length+10*o.length);let _=u.length;for(const x of o){const S=Math.min(10,Math.max(4,1.3*x.height))*t,R=[-x.normal[1],x.normal[0],0],L=Math.min(.29,.1*x.width/x.depth),F=x.width-2*x.depth*t*(L+.01),U=ii([],x.pos,R,F/2),G=ii([],x.pos,R,-F/2),X=[U[0],U[1],U[2]+x.height],Z=[G[0],G[1],G[2]+x.height],ne=ii([],x.normal,R,L);Vt(ne,ne,S);const he=ii([],x.normal,R,-L);Vt(he,he,S),et(ne,U,ne),et(he,G,he),U[2]+=.1,G[2]+=.1,u.emplaceBack(ne[0],ne[1],ne[2]),u.emplaceBack(he[0],he[1],he[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(Z[0],Z[1],Z[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(ne[0],ne[1],ne[2]),u.emplaceBack(he[0],he[1],he[2]);const ce=F/S/2;d.emplaceBack(-ce-L,-1,ce,.8),d.emplaceBack(ce+L,-1,ce,.8),d.emplaceBack(-ce,0,ce,1.3),d.emplaceBack(ce,0,ce,1.3),d.emplaceBack(ce+L,-.8,ce,.7),d.emplaceBack(ce+L,-.8,ce,.7),d.emplaceBack(0,0,ce,1.3),d.emplaceBack(0,0,ce,1.3),d.emplaceBack(ce+L,-1.2,ce,.8),d.emplaceBack(ce+L,-1.2,ce,.8),a.emplaceBack(6+_,4+_,8+_),a.emplaceBack(7+_,9+_,5+_),a.emplaceBack(0+_,1+_,2+_),a.emplaceBack(1+_,3+_,2+_),_+=10}}function XV(o,t){const a={};a.indexArray=new Aa,a.vertexArray=new _c,a.colorArray=new io,wD(o,t,a.indexArray,a.vertexArray,a.colorArray);const u={defined:!0};u.emissiveFactor=qr.black;const d={};return d.baseColorFactor=qr.white,u.pbrMetallicRoughness=d,a.material=u,a.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const SD=vr([{name:"a_pos_3f",components:3,type:"Float32"}]),WV=vr([{name:"a_normal_3",components:3,type:"Int16"}]),ZV=vr([{name:"a_centroid_3",components:3,type:"Int16"}]),TD=vr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),YV=vr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),KV=vr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),$V=vr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),JV=vr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),QV=vr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),MD=rt.types,nS=32767;function e6(o,t){const a=gi+t;for(const u of o)for(const d of u)if(d.x<-t||d.x>a||d.y<-t||d.y>a)return!1;return!0}function t6(o){switch(o){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${o}`)}}class DE{constructor(){this.layoutVertexArray=new _c,this.layoutAttenuationArray=new io,this.layoutColorArray=new Jl,this.indexArray=new Aa,this.indexArrayForConflation=new Aa,this.segmentsBucket=new Es}}class LE{constructor(t){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Es,this.entranceBloom=new DE;const a=66560;this.layoutVertexArray=new _c,this.layoutVertexArray.reserve(a),this.layoutNormalArray=new Mf,this.layoutNormalArray.reserve(a),this.layoutCentroidArray=new Mf,this.layoutCentroidArray.reserve(a),this.layoutColorArray=new Jl,this.layoutColorArray.reserve(a),this.layoutFloodLightDataArray=new no,this.layoutFloodLightDataArray.reserve(a),this.layoutAOArray=new Ca,this.layoutAOArray.reserve(a),this.indexArray=new Aa,this.indexArray.reserve(66560),this.indexArrayForConflation=new Aa,this.segmentsBucket=new Es,this.entranceBloom=new DE,t&&(this.layoutFacadePaintArray=new Jl,this.layoutFacadeDataArray=new qc,this.layoutFacadeVerticalRangeArray=new Jl)}reserve(t,a,u){this.layoutVertexArray.reserveForAdditional(t),this.layoutCentroidArray.reserveForAdditional(t),this.layoutFloodLightDataArray.reserveForAdditional(t),this.layoutNormalArray.reserveForAdditional(t),this.layoutAOArray.reserveForAdditional(t),this.layoutColorArray.reserveForAdditional(t),this.indexArray.reserveForAdditional(a),u&&(this.layoutFacadePaintArray.reserveForAdditional(t),this.layoutFacadeDataArray.reserveForAdditional(t),this.layoutFacadeVerticalRangeArray.reserveForAdditional(t))}}class ED{constructor(t){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Xc,this.footprintsIndices=new no,this.footprintsMin=new Xt(1/0,1/0),this.footprintsMax=new Xt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new LE(!1),this.buildingWithFacade=new LE(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.lut=t.lut,this.programConfigurations=new na(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=t.projection,this.groundEffect=new A0(t),this.groundEffect.groundRadiusArray=new Cu,this.hasAppearances=null}updateFootprints(t,a){const u=new Vy([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};a.push({footprint:d,id:t})}updateAppearances(t,a,u,d){}prepare(){return(function(){if(Fr!=null||en!=null)return null;if(di!=null)return di;const t=fetch(Tn.BUILDING_GEN_URL);return di=(function(a){let u,d,_,x,S;function R(){u=new Uint8Array(S.buffer),d=new Int16Array(S.buffer),_=new Int32Array(S.buffer),x=new Float32Array(S.buffer)}function L(){throw new Error("Unexpected BuildingGen error.")}const F=()=>{},U={a:{a:L,f:function(G){const X=u.length,Z=Math.max(G>>>0,Math.ceil(1.2*X)),ne=Math.ceil((Z-X)/65536);try{return S.grow(ne),R(),!0}catch{return!1}},g:L,b:F,c:F,d:F,e:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,U):a.then((G=>G.arrayBuffer())).then((G=>WebAssembly.instantiate(G,U)))).then((G=>{const X=G.instance.exports;return(0,X.g)(),S=X.f,R(),new wi({setStyle:X.h,setAOOptions:X.i,setMetricOptions:X.j,setStructuralOptions:X.k,setFacadeOptions:X.l,setFauxFacadeOptions:X.m,setFacadeClassifierOptions:X.n,addFeature:X.o,addFacade:X.p,generateMesh:X.q,getLastError:X.r,getOuterRingLength:X.s,getMeshCount:X.t,getPositionsPtr:X.u,getPositionsLength:X.v,getNormalsPtr:X.w,getNormalsLength:X.x,getAOPtr:X.y,getAOLength:X.z,getUVPtr:X.A,getUVLength:X.B,getFauxFacadePtr:X.C,getFauxFacadeLength:X.D,getIndicesPtr:X.E,getIndicesLength:X.F,getBuildingPart:X.G,getRingCount:X.H,getRingPtr:X.I,getRingLength:X.J,malloc:X.K,free:X.L,heapU8:u,heap16:d,heap32:_,heapF32:x})}))})(t).then((a=>(di=null,Fr=a,Fr))).catch((a=>{ht("Could not load building-gen"),di=null,en=a})),di})()}populate(t,a,u,d){const _=Ds();if(!_)return;const x=de(u);this.tileToMeter=x,this.brightness=a.brightness,_.setStyle({normalScale:[1,-1,x],tileToMeters:x}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const S=new Map,R=new Map;let L=0;for(const{feature:ce}of t){if(MD[ce.type]!=="LineString"){S.set(ce.id,ce.properties.source_id);continue}const _e=this.layers[0]._featureFilter.needGeometry;if(_e&&!this.layers[0]._featureFilter.filter(new ms(this.zoom),ce,u))continue;const xe=ct(ce,_e);if(!_e&&!this.layers[0]._featureFilter.filter(new ms(this.zoom),xe,u))continue;const Ee=_e?xe.geometry:Ye(ce,u,d),ke=[];for(const tt of Ee)for(const It of tt)ke.push(It.x),ke.push(It.y);const Be={coordinates:ke,crossPerc:ce.properties.cross_perc,distanceToRoad:ce.properties.distance_to_road,entrances:ce.properties.entrances,sourceId:0},He=ce.properties.source_id;let Je=R.get(He);Je||(Je=[],R.set(He,Je)),Je.push(Be),++L}this.maxHeight=0;const F=new Array,U=new Set,G=ce=>{ce!=null&&U.add(ce)},X=(ce,_e)=>{ce!=null&&F.push({buildingId:ce,footprintIndex:_e})},Z=64*(t.length-L),ne=Z/2;this.buildingWithFacade.reserve(Z,ne,!0),this.buildingWithoutFacade.reserve(2*Z,2*ne,!1),this.footprintsIndices.reserve(16*(t.length-L)),this.footprintsVertices.reserve(8*(t.length-L));for(const{feature:ce,id:_e,index:xe,sourceLayerIndex:Ee}of t){if(MD[ce.type]==="LineString")continue;const ke=this.layers[0]._featureFilter.needGeometry;if(ke&&!this.layers[0]._featureFilter.filter(new ms(this.zoom),ce,u))continue;let Be=null;if(ce.properties&&ce.properties.hasOwnProperty("building_id")&&(Be=ce.properties.building_id,U.has(Be)))continue;const He=ct(ce,ke);if(!ke&&!this.layers[0]._featureFilter.filter(new ms(this.zoom),He,u))continue;const Je=ke?He.geometry:Ye(ce,u,d),tt=Ig(Je,500);let It=!1;for(const Pn of tt)if(Pn.length!==1){It=!0;break}if(It){G(Be);continue}if(!e6(Je,163)){G(Be);continue}const ut=this.layers[0],Ot=t6(ut.layout.get("building-roof-shape").evaluate(ce,{},u)),Zt=ut.layout.get("building-base").evaluate(ce,{},u),Yt=ut.layout.get("building-height").evaluate(ce,{},u),li=ut.layout.get("building-flood-light-ground-radius").evaluate(ce,{},u),ui=ut.paint.get("building-ambient-occlusion-intensity"),ri=li/this.tileToMeter;ce.properties["building-part"]="roof";const si=ut.paint.get("building-color").evaluate(ce,{},this.canonical).toPremultipliedRenderColor(this.lut),zt=ut.paint.get("building-emissive-strength").evaluate(ce,{},this.canonical);ce.properties["building-part"]="wall";const Dt=ut.paint.get("building-color").evaluate(ce,{},this.canonical).toPremultipliedRenderColor(this.lut),ai=ut.paint.get("building-emissive-strength").evaluate(ce,{},this.canonical);ce.properties["building-part"]="window";const Ti=ut.paint.get("building-color").evaluate(ce,{},this.canonical).toPremultipliedRenderColor(this.lut),pi=ut.paint.get("building-emissive-strength").evaluate(ce,{},this.canonical);ce.properties["building-part"]="door";const dn=ut.paint.get("building-color").evaluate(ce,{},this.canonical).toPremultipliedRenderColor(this.lut),Gi=ut.paint.get("building-emissive-strength").evaluate(ce,{},this.canonical);let Ki=ut.layout.get("building-flood-light-wall-radius").evaluate(ce,{},u);Ki=oe(Ki,0,2048);const cn=Ki/2048*nS,yr=S.get(_e),yi=R.get(yr)||[],un=yi.length!==0&&ut.layout.get("building-facade").evaluate(ce,{},u);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(un,!1,1);let Yn=0,Ur=0,jr=0,cr=0,vs=0,Fe=0,Ve=0,Bt=0,ci=0,Bi=0,Ni=0;if(un){let Pn=Math.round(ut.layout.get("building-facade-floors").evaluate(ce,{},u));if(Zt===0){Pn=Math.max(1,Pn-(yi.length>0?1:0));let fs=4;if(Yt>100){const Qs=[10,13,15];fs=Qs[ce.id?ce.id%Qs.length:0]}else Yt<=10&&(fs=3);_.setFacadeOptions(fs,!0),vs=(Yt<15?1.3:1.61803)*fs/x}else vs=Zt/x;Fe=Yt/x,vs=Math.min(vs,Fe),jr=ut.layout.get("building-facade-unit-width").evaluate(ce,{},u)/x,cr=(Fe-vs)/Pn,_.setFauxFacadeOptions(!0,!0,jr);const ra=ut.layout.get("building-facade-window").evaluate(ce,{},u);Yn=ra[0],Ur=ra[1],Ve=Math.floor(65535*Math.min(1,vs/gi)),Bt=Math.floor(65535*Math.min(1,Fe/gi)),ci=Math.floor(255*Yn)<<8|Math.floor(255*Ur),Bi=Math.floor(65535*Math.min(1,jr/gi)),Ni=Math.floor(65535*Math.min(1,cr/gi))}const mn=Array(tt.length),yn={x:1/0,y:1/0},sr={x:-1/0,y:-1/0},hr={x:0,y:0};let gr=0;for(let Pn=0;Pn<tt.length;Pn++){const ra=tt[Pn];if(ra.length>0){const fs=[],Qs=Array(ra.length+1);Qs[0]=0;for(let _o=0;_o<ra.length;_o++){const Vo=ra[_o];for(let Za=0;Za<Vo.length;Za++){const Ya=Vo[Vo.length-Za-1];yn.x=Math.min(yn.x,Ya.x),yn.y=Math.min(yn.y,Ya.y),sr.x=Math.max(sr.x,Ya.x),sr.y=Math.max(sr.y,Ya.y),hr.x+=Ya.x,hr.y+=Ya.y,gr++,fs.push(Ya.x),fs.push(Ya.y)}Qs[_o+1]=fs.length}mn[Pn]={id:ce.id?ce.id:0,height:Yt,minHeight:Zt,sourceId:0,roofType:Ot,coordinates:fs,ringIndices:Qs}}}hr.x/=gr||1,hr.y/=gr||1;const Or=_.generateMesh(mn,yi);if(typeof Or=="string"){ht(`Unable to generate building ${ce.id}: ${Or}`),G(Be);continue}if(Or.meshes.length===0||Or.modifiedPolygonRings.length===0){G(Be);continue}const Bn=un?this.buildingWithFacade:this.buildingWithoutFacade;let Zn=0;for(const Pn of Or.meshes)Zn+=Pn.positions.length/3;const Wr=Bn.segmentsBucket.prepareSegment(Zn,Bn.layoutVertexArray,Bn.indexArray),$r=[];let Jr=null,hs=0,Cs=-1;const bs=Bn.layoutVertexArray.length,es=bs+Zn;Bn.layoutVertexArray.resize(es),Bn.layoutCentroidArray.resize(es),Bn.layoutNormalArray.resize(es),Bn.layoutAOArray.resize(es),Bn.layoutColorArray.resize(es),Bn.layoutFloodLightDataArray.resize(es),un&&(Bn.layoutFacadePaintArray.resize(es),Bn.layoutFacadeDataArray.resize(es),Bn.layoutFacadeVerticalRangeArray.resize(es));const ss=Bn.indexArray.length;let fr=0,Gr=bs;for(const Pn of Or.meshes){let ra,fs;if(Pn.buildingPart===1)ra=si,fs=zt;else if(Pn.buildingPart===0)ra=Dt,fs=ai;else if(Pn.buildingPart===2)ra=Ti,fs=pi;else{if(Pn.buildingPart!==3)continue;ra=dn,fs=Gi}if(fs=oe(fs,0,1),Pn.buildingPart===3){const Fs=new Array;for(let yo=0;yo<Pn.positions.length;yo+=12){const wp=Pn.positions[yo+0],ig=Pn.positions[yo+1],Ol=Pn.positions[yo+3],Qc=Pn.positions[yo+4],Gh=Pn.positions[yo+2],P_=Pn.positions[yo+8]-Gh,lx=1,mm=Ol-wp,gm=Qc-ig,S1=Math.hypot(mm,gm);Fs.push({pos:[wp+.5*mm,ig+.5*gm,Gh],normal:[gm/S1,-mm/S1,0],width:S1,height:P_,depth:lx,points:[wp,ig,Ol,Qc]})}const Sa=Bn.entranceBloom.segmentsBucket.prepareSegment(10*Fs.length,Bn.entranceBloom.layoutVertexArray,Bn.entranceBloom.indexArray),Ia=Bn.entranceBloom.layoutVertexArray.length;hs=Bn.entranceBloom.indexArray.length,wD(Fs,.5/this.tileToMeter,Bn.entranceBloom.indexArray,Bn.entranceBloom.layoutVertexArray,Bn.entranceBloom.layoutAttenuationArray);const hh=Bn.entranceBloom.layoutVertexArray.length-Ia;Cs=Bn.entranceBloom.indexArray.length-hs;for(let yo=0;yo<hh;yo++)Bn.entranceBloom.layoutColorArray.emplaceBack(255*dn.r<<8|255*dn.g,255*dn.b<<8|51*Gi);Sa.vertexLength+=hh,Sa.primitiveLength+=Cs,Jr={part:Pn.buildingPart,vertexOffset:Ia,vertexLength:hh}}Bn.layoutVertexArray.float32.set(Pn.positions,3*Gr);const Qs=Pn.positions.length/3;for(let Fs=0;Fs<Qs;++Fs){const Sa=3*Fs;fr=Math.max(fr,Pn.positions[Sa+2]);const Ia=Pn.normals[Sa+1]*nS,hh=Pn.normals[Sa+2]*nS,yo=3*(Gr+Fs);Bn.layoutNormalArray.int16[yo]=Pn.normals[Sa]*nS,Bn.layoutNormalArray.int16[yo+1]=Ia,Bn.layoutNormalArray.int16[yo+2]=hh;const wp=Pn.ao[Fs];Bn.layoutAOArray.uint8[Gr+Fs]=255*wp;const ig=1+(wp-1)*ui,Ol=255*ra.b*ig<<8|255*fs;Bn.layoutColorArray.uint16[2*(Gr+Fs)]=255*ra.r*ig<<8|255*ra.g*ig,Bn.layoutColorArray.uint16[2*(Gr+Fs)+1]=Ol}const _o=Math.floor(hr.x),Vo=Math.floor(hr.y),Za=Math.floor(Yt);for(let Fs=0;Fs<Qs;++Fs){const Sa=3*(Gr+Fs);Bn.layoutCentroidArray.int16[Sa]=_o,Bn.layoutCentroidArray.int16[Sa+1]=Vo,Bn.layoutCentroidArray.int16[Sa+2]=Za}if(Bn.layoutFloodLightDataArray.uint16.fill(Pn.buildingPart===0?cn:0,Gr,Gr+Qs),un){const Fs=255*Ti.r<<8|255*Ti.g,Sa=255*Ti.b<<8|255*pi;for(let Ia=0;Ia<Qs;++Ia){const hh=2*(Gr+Ia);Bn.layoutFacadePaintArray.uint16[hh]=Fs,Bn.layoutFacadePaintArray.uint16[hh+1]=Sa}for(let Ia=0;Ia<Qs;++Ia)if(Pn.isFauxFacade[Ia]){const hh=Math.min(65535,Math.floor(Pn.uv[2*Ia]*Or.outerRingLength));Bn.layoutFacadeDataArray.emplace(Gr+Ia,1|hh,ci,Bi,Ni),Bn.layoutFacadeVerticalRangeArray.emplace(Gr+Ia,Ve,Bt)}else Bn.layoutFacadeDataArray.emplace(Gr+Ia,0,0,0,0),Bn.layoutFacadeVerticalRangeArray.emplace(Gr+Ia,0,0)}const Ya=Wr.vertexLength,Ro=Pn.indices.length/3,Pu=Bn.indexArray.length;Bn.indexArray.resize(Pu+Ro);for(let Fs=0;Fs<Ro;++Fs){const Sa=3*Fs,Ia=3*Pu+Sa;Bn.indexArray.uint16[Ia]=Ya+Pn.indices[Sa],Bn.indexArray.uint16[Ia+1]=Ya+Pn.indices[Sa+1],Bn.indexArray.uint16[Ia+2]=Ya+Pn.indices[Sa+2]}Pn.buildingPart!==1&&Pn.buildingPart!==0&&Pn.buildingPart!==2&&Pn.buildingPart!==3||$r.push({part:Pn.buildingPart,vertexOffset:Gr,vertexLength:Pn.positions.length/3}),Gr+=Qs,Wr.vertexLength+=Qs,Wr.primitiveLength+=Pn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,fr);const ia=Bn.indexArray.length-ss,Ln=this.footprintsIndices.length,Br=this.footprintsVertices.length,Ss=[],Ls=new Xt(1/0,1/0),Gs=new Xt(-1/0,-1/0),Ra=this.groundEffect.vertexArray.length;for(const Pn of Or.modifiedPolygonRings){const ra=[],fs=new Xt(1/0,1/0),Qs=new Xt(-1/0,-1/0);for(let _o=0;_o<Pn.length;_o+=2){const Vo=Pn.length-_o-2;fs.x=Math.min(fs.x,Pn[Vo]),fs.y=Math.min(fs.y,Pn[Vo+1]),Qs.x=Math.max(Qs.x,Pn[Vo]),Qs.y=Math.max(Qs.y,Pn[Vo+1]);const Za=new Xt(Pn[Vo],Pn[Vo+1]);ra.push(Za),Ss.push(Za.x,Za.y),this.footprintsVertices.emplaceBack(Za.x,Za.y)}Ls.x=Math.min(Ls.x,fs.x),Ls.y=Math.min(Ls.y,fs.y),Gs.x=Math.max(Gs.x,Qs.x),Gs.y=Math.max(Gs.y,Qs.y),this.groundEffect.addData(ra,[fs,Qs],ri)}const Ns=this.groundEffect.vertexArray.length-Ra;this.groundEffect.groundRadiusArray.reserveForAdditional(Ns);for(let Pn=0;Pn<Ns;Pn++)this.groundEffect.groundRadiusArray.emplaceBack(li);(yn.x<0||sr.x>gi||yn.y<0||sr.y>gi)&&this.featuresOnBorder.push({featureId:ce.id,footprintIndex:this.footprints.length});{const Pn=d_(Ss,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Pn.length),this.footprintsIndices.uint16.set(Pn,Ln),this.buildingIds.add(Be??ce.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Ls.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Ls.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Gs.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Gs.y);const ra={footprintVertexOffset:Br,footprintVertexLength:this.footprintsVertices.length-Br,footprintIndexOffset:Ln,footprintIndexLength:this.footprintsIndices.length-Ln,min:Ls,max:Gs,hiddenFlags:0,indicesOffset:ss,indicesLength:ia,bloomIndicesOffset:hs,bloomIndicesLength:Cs,groundEffectVertexOffset:Ra,groundEffectVertexLength:Ns,hasFauxFacade:un,height:fr,promoteId:_e,feature:He,parts:$r,buildingBloom:Jr},fs=this.footprints.length;ce.id!==void 0&&this.featureFootprintLookup.set(ce.id,fs),X(Be,fs),this.footprints.push(ra)}this.programConfigurations.populatePaintArrays(Bn.layoutVertexArray.length,ce,xe,{},a.availableImages,u,a.brightness),this.groundEffect.addPaintPropertiesData(ce,xe,{},a.availableImages,u,a.brightness),a.featureIndex.insert(ce,Je,xe,Ee,this.index,bs)}F.forEach((({buildingId:ce,footprintIndex:_e})=>{U.has(ce)&&(this.footprints[_e].hiddenFlags|=4)}));const he=new Set;this.buildingIds.forEach(((ce,_e,xe)=>{U.has(ce)||he.add(ce)})),this.buildingIds=he,this.groundEffect.prepareBorderSegments()}update(t,a,u,d,_,x,S){this.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S),this.groundEffect.update(t,a,_,u,d,x,S),this.evaluate(this.layers[0],t),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){const a=u=>{u.layoutVertexBuffer=t.createVertexBuffer(u.layoutVertexArray,SD.members),u.layoutNormalBuffer=t.createVertexBuffer(u.layoutNormalArray,WV.members),u.layoutCentroidBuffer=t.createVertexBuffer(u.layoutCentroidArray,ZV.members),u.layoutFloodLightDataBuffer=t.createVertexBuffer(u.layoutFloodLightDataArray,QV.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=t.createVertexBuffer(u.layoutFacadeDataArray,KV.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=t.createVertexBuffer(u.layoutFacadeVerticalRangeArray,$V.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(u.entranceBloom.layoutVertexArray,SD.members),u.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,JV.members)),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){const t=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(t,a,u=!0){let d=!1;const _=u?a:0,x=0|(u?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of t){const R=this.footprints[S],L=R.hiddenFlags&x|_;R.hiddenFlags!==L&&(R.hiddenFlags=L,d=!0,this.groundEffect.updateHiddenByLandmarkRange(R.groundEffectVertexOffset,R.groundEffectVertexLength,R.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),this.indexArrayForConflationUploaded)return;const a=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const d of this.footprints){const _=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,x=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let R=d.indicesOffset;R<x;R++)_.indexArrayForConflation.uint16[3*R+0]=0,_.indexArrayForConflation.uint16[3*R+1]=0,_.indexArrayForConflation.uint16[3*R+2]=0;const S=d.bloomIndicesOffset+d.bloomIndicesLength;for(let R=d.bloomIndicesOffset;R<S;R++)_.entranceBloom.indexArrayForConflation.uint16[3*R+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*R+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*R+2]=0}}const u=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=t.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=t.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(t){const a=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=t.createVertexBuffer(u.layoutColorArray,TD.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=t.createVertexBuffer(u.layoutFacadePaintArray,YV.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=t.createVertexBuffer(u.entranceBloom.layoutColorArray,TD.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(t,a){const u=t.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const _=a[d.promoteId],x=d.feature;x.properties["building-part"]="roof";const S=t.paint.get("building-color").evaluate(x,_,this.canonical).toPremultipliedRenderColor(this.lut),R=t.paint.get("building-emissive-strength").evaluate(x,_,this.canonical);x.properties["building-part"]="wall";const L=t.paint.get("building-color").evaluate(x,_,this.canonical).toPremultipliedRenderColor(this.lut),F=t.paint.get("building-emissive-strength").evaluate(x,_,this.canonical);x.properties["building-part"]="window";const U=t.paint.get("building-color").evaluate(x,_,this.canonical).toPremultipliedRenderColor(this.lut),G=t.paint.get("building-emissive-strength").evaluate(x,_,this.canonical);x.properties["building-part"]="door";const X=t.paint.get("building-color").evaluate(x,_,this.canonical).toPremultipliedRenderColor(this.lut),Z=t.paint.get("building-emissive-strength").evaluate(x,_,this.canonical),ne=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ce of d.parts){let _e,xe=S;ce.part===1?(xe=S,_e=R):ce.part===0?(xe=L,_e=F):ce.part===2?(xe=U,_e=G):ce.part===3&&(xe=X,_e=Z),_e=oe(_e,0,1);for(let Ee=0;Ee<ce.vertexLength;Ee++){const ke=ce.vertexOffset+Ee,Be=1+(ne.layoutAOArray.uint8[ke]/255-1)*u;ne.layoutColorArray.emplace(ke,xe.r*Be*255<<8|xe.g*Be*255,xe.b*Be*255<<8|255*_e),d.hasFauxFacade&&ne.layoutFacadePaintArray.emplace(ke,255*U.r<<8|255*U.g,255*U.b<<8|255*G)}}const he=d.buildingBloom;if(he)for(let ce=0;ce<he.vertexLength;ce++)ne.entranceBloom.layoutColorArray.emplace(he.vertexOffset+ce,255*X.r<<8|255*X.g,255*X.b<<8|51*Z)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(t,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(t.toUnwrapped());if(w0(this.activeReplacements,d))return;this.activeReplacements=d;for(const x of this.footprints)x.hiddenFlags&=-2;const _=[];for(const x of this.activeReplacements){if(x.order<=Hv)continue;const S=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-t.canonical.z));for(const R of this.footprints)R.min.x>x.max.x||R.max.x<x.min.x||R.min.y>x.max.y||R.max.y<x.min.y||(_.length=0,n6(this.footprintsVertices,R.footprintVertexOffset,R.footprintVertexLength,x.footprintTileId.canonical,t.canonical,_),Hy(x.footprint,_,this.footprintsIndices.uint16,R.footprintIndexOffset,R.footprintIndexLength,0,-S)&&(R.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(x.groundEffectVertexOffset,x.groundEffectVertexLength,x.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(t){if(t.id!==void 0){const a=this.featureFootprintLookup.get(t.id);return this.footprints[a]}return null}getHeightAtTileCoord(t,a){let u=Number.NEGATIVE_INFINITY,d=!0;const _=4*(t+gi)*gi+(a+gi);if(this.footprintLookup.hasOwnProperty(_)){const S=this.footprintLookup[_];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const x=new Xt(t,a);for(const S of this.footprints)t>S.max.x||S.min.x>t||a>S.max.y||S.min.y>a||S.height<=u||i6(x,this.footprintsVertices.float32.subarray(2*S.footprintVertexOffset,2*(S.footprintVertexOffset+S.footprintVertexLength)),this.footprintsIndices.uint16.subarray(S.footprintIndexOffset,S.footprintIndexOffset+S.footprintIndexLength))&&(u=S.height,this.footprintLookup[_]=S,d=S.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[_]=void 0}}function i6(o,t,a){for(let u=0;u<a.length;u+=3){const d=a[u],_=a[u+1],x=a[u+2],S=t[2*d+0],R=t[2*d+1],L=t[2*_+0],F=t[2*_+1],U=t[2*x+0],G=t[2*x+1],X=(S-U)*(o.y-G)-(R-G)*(o.x-U),Z=(L-S)*(o.y-R)-(F-R)*(o.x-S);if(X<0!=Z<0&&X!==0&&Z!==0)continue;const ne=(U-L)*(o.y-F)-(G-F)*(o.x-L);if(ne===0||ne<0==X+Z<=0)return!0}return!1}function n6(o,t,a,u,d,_){const x=Math.pow(2,u.z-d.z);for(let S=0;S<a;S++){let R=o.float32[2*(S+t)+0],L=o.float32[2*(S+t)+1];R=(R+d.x*gi)*x-u.x*gi,L=(L+d.y*gi)*x-u.y*gi,_.push(new Xt(R,L))}}let AD,CD;oi(ED,"BuildingBucket",{omit:["layers"]}),oi(LE,"BuildingGeometry"),oi(DE,"BuildingBloomGeometry");const r6=vr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),s6=vr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:a6}=r6,o6=vr([{name:"a_packed",components:3,type:"Float32"}]),{members:l6}=o6,c6=vr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:u6}=c6;class RD{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.image=new Ld({width:t,height:a}),this.positions={},this.uploaded=!1}getDash(t,a){const u=this.getKey(t,a);return this.positions[u]}trim(){const t=this.width,a=this.height=At(this.nextRow);this.image.resize({width:t,height:a})}getKey(t,a){return t.join(",")+a}getDashRanges(t,a,u){const d=[];let _=t.length%2==1?-t[t.length-1]*u:0,x=t[0]*u,S=!0;d.push({left:_,right:x,isDash:S,zeroLength:t[0]===0});let R=t[0];for(let L=1;L<t.length;L++){S=!S;const F=t[L];_=R*u,R+=F,x=R*u,d.push({left:_,right:x,isDash:S,zeroLength:F===0})}return d}addRoundDash(t,a,u){const d=a/2;for(let _=-u;_<=u;_++){const x=this.width*(this.nextRow+u+_);let S=0,R=t[S];for(let L=0;L<this.width;L++){L/R.right>1&&(R=t[++S]);const F=Math.abs(L-R.left),U=Math.abs(L-R.right),G=Math.min(F,U);let X;const Z=_/u*(d+1);if(R.isDash){const ne=d-Math.abs(Z);X=Math.sqrt(G*G+ne*ne)}else X=d-Math.sqrt(G*G+Z*Z);this.image.data[x+L]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t,a){for(let R=t.length-1;R>=0;--R){const L=t[R],F=t[R+1];L.zeroLength?t.splice(R,1):F&&F.isDash===L.isDash&&(F.left=L.left,t.splice(R,1))}const u=t[0],d=t[t.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const _=this.width*this.nextRow;let x=0,S=t[x];for(let R=0;R<this.width;R++){R/S.right>1&&(S=t[++x]);const L=Math.abs(R-S.left),F=Math.abs(R-S.right),U=Math.min(L,F);this.image.data[_+R]=Math.max(0,Math.min(255,(S.isDash?U:-U)+a+128))}}addDash(t,a){const u=this.getKey(t,a);if(this.positions[u])return this.positions[u];const d=a==="round",_=d?7:0,x=2*_+1;if(this.nextRow+x>this.height)return ht("LineAtlas out of space"),null;t.length===0&&t.push(1);let S=0;for(let F=0;F<t.length;F++)t[F]<0&&(ht("Negative value is found in line dasharray, replacing values with 0"),t[F]=0),S+=t[F];if(S!==0){const F=this.width/S,U=this.getDashRanges(t,this.width,F);d?this.addRoundDash(U,F,_):this.addRegularDash(U,a==="square"?.5*F:0)}const R=this.nextRow+_;this.nextRow+=x;const L={tl:[R,_],br:[S,0]};return this.positions[u]=L,L}}oi(RD,"LineAtlas");const h6=rt.types,f6=Math.cos(Math.PI/180*37.5),d6=Math.cos(Math.PI/180*5);class PE{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((a=>{this.gradients[a.id]={}})),this.layoutVertexArray=new Zm,this.layoutVertexArray2=new _c,this.patternVertexArray=new _c,this.indexArray=new Aa,this.programConfigurations=new na(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Es,this.maxLineLength=0,this.zOffsetVertexArray=new _c,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.tessellationStep=t.tessellationStep?t.tessellationStep:gi/64,this.worldview=t.worldview,this.hasAppearances=null}updateFootprints(t,a){}updateAppearances(t,a,u,d){}populate(t,a,u,d){this.hasPattern=Uy("line",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=de(u);const x=this.layers[0].layout.get("line-elevation-reference");if(x==="hd-road-markup")this.elevationType="road";else{const G=this.layers[0].layout.get("line-z-offset"),X=G.isConstant()&&!G.constantOr(0);this.elevationType=x!=="sea"&&x!=="ground"&&X?"none":"offset",this.elevationType==="offset"&&x==="none"&&ht(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const R=[];for(const{feature:G,id:X,index:Z,sourceLayerIndex:ne}of t){const he=this.layers[0]._featureFilter.needGeometry,ce=ct(G,he);if(!this.layers[0]._featureFilter.filter(new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),ce,u))continue;const _e=_?_.evaluate(ce,{},u):void 0,xe={id:X,properties:G.properties,type:G.type,sourceLayerIndex:ne,index:Z,geometry:he?ce.geometry:Ye(G,u,d),patterns:{},sortKey:_e};R.push(xe)}_&&R.sort(((G,X)=>G.sortKey-X.sortKey));const{lineAtlas:L,featureIndex:F}=a,U=this.addConstantDashes(L);for(const G of R){const{geometry:X,index:Z,sourceLayerIndex:ne}=G;if(U&&this.addFeatureDashes(G,L),this.hasPattern){const he=x0("line",this.layers,G,this.zoom,this.pixelRatio,a);this.patternFeatures.push(he)}else this.addFeature(G,X,Z,u,L.positions,a.availableImages,a.brightness,a.elevationFeatures);F.insert(t[Z].feature,X,Z,ne,this.index)}}addConstantDashes(t){let a=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if(d.kind!=="constant"||_.kind!=="constant")a=!0;else{const x=_.value,S=d.value;if(!S)continue;t.addDash(S,x)}}return a}addFeatureDashes(t,a){const u=this.zoom;for(const d of this.layers){const _=d.paint.get("line-dasharray").value,x=d.layout.get("line-cap").value;if(_.kind==="constant"&&x.kind==="constant")continue;let S,R;if(_.kind==="constant"){if(S=_.value,!S)continue}else S=_.evaluate({zoom:u},t);R=x.kind==="constant"?x.value:x.evaluate({zoom:u},t),a.addDash(S,R),t.patterns[d.id]=[a.getKey(S,R)]}}update(t,a,u,d,_,x,S,R){this.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S,R)}addFeatures(t,a,u,d,_,x){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,u,d,x,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,l6)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,u6)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,s6.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,a6),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t,a){let u,d;if(a&&a>0?(u=`mapbox_clip_start_${a}`,d=`mapbox_clip_end_${a}`):(u="mapbox_clip_start",d="mapbox_clip_end"),t.properties&&t.properties.hasOwnProperty(u)&&t.properties.hasOwnProperty(d))return{start:+t.properties[u],end:+t.properties[d]}}addFeature(t,a,u,d,_,x,S,R){const L=this.layers[0].layout,F=L.get("line-join").evaluate(t,{}),U=L.get("line-cap").evaluate(t,{}),G=L.get("line-miter-limit"),X=L.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t;const Z=!(!t.properties||!t.properties.hasOwnProperty("mapbox_line_metrics"))&&t.properties.mapbox_line_metrics;this.zOffsetValue=L.get("line-z-offset").value;const ne=this.layers[0].paint.get("line-width").value;if(ne.kind!=="constant"&&ne.isLineProgressConstant===!1&&(this.variableWidthValue=ne),this.elevationType==="road"){const he=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,a,d,R,F,U,G,X)){const[ce,_e]=this.clipRuntimeLinesToTile(a,1);for(let xe=0;xe<ce.length;xe++){const Ee=ce[xe],ke=_e[xe],Be={progress:{min:ke.progress.min,max:ke.progress.max},nextDir:this.computeSegNextDir(ke,Ee),prevDir:this.computeSegPrevDir(ke,Ee)};this.addLine(Ee,t,d,F,U,G,X,Be,Z&&ke.parentIndex>0?ke.parentIndex:null)}this.fillNonElevatedRoadSegment(he)}}else for(let he=0;he<a.length;he++)this.addLine(a[he],t,d,F,U,G,X,void 0,Z&&he>0?he:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,_,x,d,S,void 0,this.worldview)}computeSegNextDir(t,a){return t.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(t,a){return a[1].sub(t.prevPoint).unit()}clipLinesToTile(t,a){return um(t,-a,-a,gi+a,gi+a)}clipRuntimeLinesToTile(t,a){const u=[];return[um(t,-a,-a,gi+a,gi+a,u),u]}addElevatedRoadFeature(t,a,u,d,_,x,S,R){const L=[],F=er.getElevationFeature(t,d);if(F){const U=this.clipLinesToTile(a,1),G=this.prepareElevatedLines(U,F,u);for(const X of G)L.push({geometry:X,elevation:F,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(L.length===0)return!1;for(const U of L){const G=this.layoutVertexArray.length;this.addLine(U.geometry,t,u,_,x,S,R);const X=new Pr(u,U.elevationTileID);if(U.elevation)for(let Z=G;Z<this.layoutVertexArray.length;Z++){const ne=new Xt(this.layoutVertexArray.int16[6*Z]>>1,this.layoutVertexArray.int16[6*Z+1]>>1),he=X.pointElevation(ne,U.elevation,.05);this.updateHeightRange(he),this.zOffsetVertexArray.emplaceBack(he,0,0)}else this.fillNonElevatedRoadSegment(G)}return!0}prepareElevatedLines(t,a,u){if(a.constantHeight!=null)return t;const d=[],_=1/de(u);for(const x of t)Zw(x,new Ir(a,_),0,d);return d}fillNonElevatedRoadSegment(t){for(let a=t;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,a,u,d,_,x,S,R,L){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=L?this.lineFeatureClips(a,L):this.lineClips;const F=d==="none";this.patternJoinNone=this.hasPattern&&F,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const U=R&&R.progress.min>0,G=R&&R.progress.max<1;if(this.lineClips){let tt={min:this.lineClips.start,max:this.lineClips.end},It=1;if(R){const Zt=this.lineClips.end-this.lineClips.start;tt=(function(Yt,li,ui){return{min:jn(Yt.min,li,ui),max:jn(Yt.max,li,ui)}})(R.progress,{min:0,max:1},tt),Zt>0&&(It=(tt.max-tt.min)/Zt)}const ut=+a.properties.mapbox_clip_feature_len,Ot=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(ut)||Number.isNaN(Ot)){for(let Yt=0;Yt<t.length-1;Yt++)this.totalDistance+=t[Yt].dist(t[Yt+1]);const Zt=this.totalDistance/(tt.max-tt.min);this.totalFeatureLength=Number.isFinite(Zt)?Zt:0,this.lineClips.start=tt.min,this.lineClips.end=tt.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ut,this.distance=Ot*It,this.lineClips.start=tt.min,this.lineClips.end=tt.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const X=h6[a.type]==="Polygon";let Z=t.length;for(;Z>=2&&t[Z-1].equals(t[Z-2]);)Z--;let ne=0;for(;ne<Z-1&&t[ne].equals(t[ne+1]);)ne++;if(Z<(X?3:2))return;d==="bevel"&&(x=1.05);const he=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let ce,_e,xe,Ee,ke,Be,He,Je;R&&R.prevDir&&(Be=R.prevDir.perp()),R&&R.nextDir&&(He=R.nextDir.perp()),this.e1=this.e2=-1,X&&(ce=t[Z-2],ke=t[ne].sub(ce)._unit()._perp());for(let tt=ne;tt<Z;tt++){if(xe=tt===Z-1?X?t[ne+1]:void 0:t[tt+1],xe&&t[tt].equals(xe))continue;ke&&(Ee=ke),ce&&(_e=ce),ce=t[tt],Je=this.evaluateLineProgressFeatures(_e?_e.dist(ce):0),ke=xe?xe.sub(ce)._unit()._perp():Ee,Ee=Ee||ke;const It=_e&&xe;let ut=It?d:X||F?"butt":_;const Ot=Ee.x*ke.x+Ee.y*ke.y;if(F){const Dt=function(ai){if(ai.patternJoinNone){const Ti=ai.segmentPoints.length/2,pi=ai.lineSoFar-ai.segmentStart;for(let dn=0;dn<Ti;++dn){const Gi=ai.segmentPoints[2*dn+1],Ki=Math.round(ai.segmentPoints[2*dn])+.5+.25*Gi;ai.patternVertexArray.emplaceBack(Ki,pi,ai.segmentStart),ai.patternVertexArray.emplaceBack(Ki,pi,ai.segmentStart)}ai.segmentPoints.length=0}ai.e1=ai.e2=-1};if(It&&Ot<d6){this.updateDistance(_e,ce),this.addCurrentVertex(ce,Ee,1,1,he,Je),Dt(this),this.addCurrentVertex(ce,ke,-1,-1,he,Je);continue}if(_e){if(!xe){this.updateDistance(_e,ce),this.addCurrentVertex(ce,Ee,1,1,he,Je),Dt(this);continue}ut="miter"}}let Zt=Ee.add(ke);Zt.x===0&&Zt.y===0||Zt._unit();const Yt=Zt.x*ke.x+Zt.y*ke.y,li=Yt!==0?1/Yt:1/0,ui=2*Math.sqrt(2-2*Yt),ri=Yt<f6&&_e&&xe,si=Ee.x*ke.y-Ee.y*ke.x>0,zt=this.overscaling<=16?15*gi/(512*this.overscaling):0;if(It&&ut==="round"){if(li<S)ut="miter";else if(li<=2){const Dt=zE(ce,-10,gi+10);ut=this.elevationType==="offset"&&(Dt||this.hasCrossSlope)?"miter":"fakeround"}}if(ut==="miter"&&li>x&&(ut="bevel"),ut==="bevel"&&(li>2&&(ut="flipbevel"),li<x&&(ut="miter")),_e&&!(ut==="miter"&&ri)&&this.updateDistance(_e,ce),ut==="miter")if(ri){const Dt=ce.dist(_e);if(Dt>2*zt){const Ti=ce.sub(ce.sub(_e)._mult(zt/Dt)._round());this.updateDistance(_e,Ti),this.addCurrentVertex(Ti,Ee,0,0,he,Je),_e=Ti}this.updateDistance(_e,ce),Zt._mult(li),this.addCurrentVertex(ce,Zt,0,0,he,Je);const ai=ce.dist(xe);if(ai>2*zt){const Ti=ce.add(xe.sub(ce)._mult(zt/ai)._round());this.updateDistance(ce,Ti),this.addCurrentVertex(Ti,ke,0,0,he,Je),ce=Ti}}else Zt._mult(li),this.addCurrentVertex(ce,Zt,0,0,he,Je);else if(ut==="flipbevel"){if(li>100)Zt=ke.mult(-1);else{const Dt=li*Ee.add(ke).mag()/Ee.sub(ke).mag();Zt._perp()._mult(Dt*(si?-1:1))}this.addCurrentVertex(ce,Zt,0,0,he,Je),this.addCurrentVertex(ce,Zt.mult(-1),0,0,he,Je)}else if(ut==="bevel"||ut==="fakeround"){Je!=null&&_e&&this.addCurrentVertex(ce,He||Ee,-1,-1,he,Je);const Dt=ce.dist(_e)<=2*zt&&ut!=="bevel",ai=Zt.mult(si?1:-1);ai._mult(li);const Ti=ke.mult(si?-1:1),pi=Ee.mult(si?-1:1),dn=this.evaluateLineProgressFeatures(this.distance);if(Je==null&&(this.addHalfVertex(ce,ai.x,ai.y,!1,!si,0,he,dn),Dt||this.addHalfVertex(ce,ai.x+2*pi.x,ai.y+2*pi.y,!1,si,0,he,dn)),ut==="fakeround"){const Gi=Math.round(180*ui/Math.PI/20);this.addHalfVertex(ce,pi.x,pi.y,!1,si,0,he,dn);for(let Ki=0;Ki<Gi;Ki++){let cn=Ki/Gi;if(cn!==.5){const yi=cn-.5;cn+=cn*yi*(cn-1)*((1.0904+Ot*(Ot*(3.55645-1.43519*Ot)-3.2452))*yi*yi+(.848013+Ot*(.215638*Ot-1.06021)))}const yr=Ti.sub(pi)._mult(cn)._add(pi)._unit();this.addHalfVertex(ce,yr.x,yr.y,!1,si,0,he,dn)}this.addHalfVertex(ce,Ti.x,Ti.y,!1,si,0,he,dn)}Dt||Je!=null||this.addHalfVertex(ce,ai.x+2*Ti.x,ai.y+2*Ti.y,!1,si,0,he,dn),Je!=null&&xe&&this.addCurrentVertex(ce,Be||ke,1,1,he,Je)}else if(ut==="butt")this.addCurrentVertex(ce,Zt,0,0,he,Je);else if(ut==="square"){if(!_e){const Dt=U?0:-1;this.addCurrentVertex(ce,Zt,Dt,Dt,he,Je)}if(this.addCurrentVertex(ce,Zt,0,0,he,Je),_e){const Dt=G?0:1;this.addCurrentVertex(ce,Zt,Dt,Dt,he,Je)}}else if(ut==="round"){if(_e){const Dt=!It&&He?He:Ee;this.addCurrentVertex(ce,Dt,0,0,he,Je),!It&&G||this.addCurrentVertex(ce,Dt,1,1,he,Je,!0)}if(xe){const Dt=!It&&Be?Be:ke;!It&&U||this.addCurrentVertex(ce,Dt,-1,-1,he,Je,!0),this.addCurrentVertex(ce,Dt,0,0,he,Je)}}}}addVerticesTo(t,a,u,d,_,x,S,R,L,F){const U=(a.w-t.w)/this.tessellationStep|0;let G=0;const X=this.scaledDistance;if(U>1){this.lineSoFar=t.w;const ne=(a.x-t.x)/U,he=(a.y-t.y)/U,ce=(a.z-t.z)/U,_e=(a.w-t.w)/U;for(let xe=1;xe<U;++xe){t.x+=ne,t.y+=he,t.z+=ce,this.lineSoFar+=_e,G+=_e;const Ee=this.evaluateLineProgressFeatures(this.prevDistance+G);this.scaledDistance=(this.prevDistance+G)/this.totalDistance,this.addHalfVertex(t,u,d,F,!1,S,L,Ee),this.addHalfVertex(t,_,x,F,!0,-R,L,Ee)}}this.lineSoFar=a.w,this.scaledDistance=X;const Z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,d,F,!1,S,L,Z),this.addHalfVertex(a,_,x,F,!0,-R,L,Z)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):ht(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(t,a,u,d,_,x,S=!1){const R=a.x+a.y*u,L=a.y-a.x*u,F=a.y*d-a.x,U=-a.y-a.x*d;if(x!=null){const G=this.elevationType==="offset",X=-10,Z=gi+10,ne=x.zOffset,he=new R0(t.x,t.y,ne,this.lineSoFar),ce=!!G&&zE(t,X,Z),_e=this.lineSoFar,xe=this.distance;if(this.currentVertex)if(ce){const Ee=this.currentVertexIsOutside,ke=this.currentVertex,Be=new R0(t.x,t.y,ne,this.lineSoFar);if(Kv(ke,Be,X,Z),!zE(Be,X,Z)){if(Ee){this.e1=this.e2=-1,this.distance-=ke.dist(he),this.lineSoFar=ke.w;const He=this.evaluateLineProgressFeatures(ke.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ke,R,L,S,!1,u,_,He),this.addHalfVertex(ke,F,U,S,!0,-d,_,He),this.prevDistance=this.distance}this.distance=this.prevDistance+ke.dist(Be),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ke,Be,R,L,F,U,u,d,_,S),this.distance=xe,this.scaledDistance=this.distance/this.totalDistance}}else{const Ee=this.currentVertex;if(this.currentVertexIsOutside){Kv(Ee,he,X,Z),this.e1=this.e2=-1,this.distance-=Ee.dist(he),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Ee.w;const ke=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,R,L,S,!1,u,_,ke),this.addHalfVertex(Ee,F,U,S,!0,-d,_,ke),this.prevDistance=this.distance,this.distance=xe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Ee,he,R,L,F,U,u,d,_,S)}else ce||(this.addHalfVertex(t,R,L,S,!1,u,_,x),this.addHalfVertex(t,F,U,S,!0,-d,_,x));this.currentVertex=he,this.currentVertexIsOutside=ce,this.lineSoFar=_e}else this.addHalfVertex(t,R,L,S,!1,u,_,x),this.addHalfVertex(t,F,U,S,!0,-d,_,x)}addHalfVertex({x:t,y:a},u,d,_,x,S,R,L){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(a<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const U=Rn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,U)}const F=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),R.primitiveLength++),x?this.e2=F:this.e1=F,L!=null&&this.zOffsetVertexArray.emplaceBack(L.zOffset,L.variableWidth,L.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,a){this.prevDistance=this.distance,this.distance+=t.dist(a),this.updateScaledDistance()}}function zE(o,t,a){return o.x<t||o.x>a||o.y<t||o.y>a}let ID,DD;function LD(o,t,a){return t*(gi/(o.tileSize*Math.pow(2,a-o.tileID.overscaledZ)))}oi(PE,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const PD=(o,t,a)=>(1-a)*o+a*t;function zD(o,t){return 1/LD(o,1,t.tileZoom)}function OD(o,t,a,u){return o.translatePosMatrix(u||t.tileID.projMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const BD=o=>{const t=[];ND(o)&&t.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const a=o.paint.get("line-trim-offset");a[0]===0&&a[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const u=o.layout.get("line-join").constantOr("miter")==="none",d=!!o.paint.get("line-pattern").constantOr(1);return u&&d&&t.push("LINE_JOIN_NONE"),t};function ND(o){const t=o.paint.get("line-dasharray").value;return t.kind!=="constant"||t.value}let OE;const FD=()=>OE||(OE={layout:ID||(ID=new Ys({"line-cap":new Mi(dt.layout_line["line-cap"]),"line-join":new Mi(dt.layout_line["line-join"]),"line-miter-limit":new fi(dt.layout_line["line-miter-limit"]),"line-round-limit":new fi(dt.layout_line["line-round-limit"]),"line-sort-key":new Mi(dt.layout_line["line-sort-key"]),"line-z-offset":new Mi(dt.layout_line["line-z-offset"]),"line-elevation-reference":new fi(dt.layout_line["line-elevation-reference"]),"line-cross-slope":new fi(dt.layout_line["line-cross-slope"]),visibility:new fi(dt.layout_line.visibility),"line-width-unit":new fi(dt.layout_line["line-width-unit"])})),paint:DD||(DD=new Ys({"line-opacity":new Mi(dt.paint_line["line-opacity"]),"line-color":new Mi(dt.paint_line["line-color"]),"line-translate":new fi(dt.paint_line["line-translate"]),"line-translate-anchor":new fi(dt.paint_line["line-translate-anchor"]),"line-width":new Mi(dt.paint_line["line-width"]),"line-gap-width":new Mi(dt.paint_line["line-gap-width"]),"line-offset":new Mi(dt.paint_line["line-offset"]),"line-blur":new Mi(dt.paint_line["line-blur"]),"line-dasharray":new Mi(dt.paint_line["line-dasharray"]),"line-pattern":new Mi(dt.paint_line["line-pattern"]),"line-pattern-cross-fade":new fi(dt.paint_line["line-pattern-cross-fade"]),"line-gradient":new Au(dt.paint_line["line-gradient"]),"line-trim-offset":new fi(dt.paint_line["line-trim-offset"]),"line-trim-fade-range":new fi(dt.paint_line["line-trim-fade-range"]),"line-trim-color":new fi(dt.paint_line["line-trim-color"]),"line-emissive-strength":new Mi(dt.paint_line["line-emissive-strength"]),"line-border-width":new Mi(dt.paint_line["line-border-width"]),"line-border-color":new Mi(dt.paint_line["line-border-color"]),"line-occlusion-opacity":new fi(dt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},OE);class p6 extends Mi{possiblyEvaluate(t,a){return a=new ms(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(t,a)}evaluate(t,a,u,d){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,u,d)}}let e1;function UD(o,t){return t>0?t+2*o:o}const m6=vr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),g6=vr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_6=vr([{name:"a_projected_pos",components:4,type:"Float32"}],4);vr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const y6=vr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),x6=vr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),v6=vr([{name:"a_texb",components:2,type:"Uint16"}]),b6=vr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),w6=vr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);vr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kD=vr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),S6=vr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);vr([{name:"triangle",components:3,type:"Uint16"}]),vr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),vr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),vr([{type:"Float32",name:"offsetX"}]),vr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ko=24;function T6(o,t,a){return o.sections.forEach((u=>{u.text=(function(d,_,x){const S=_.layout.get("text-transform").evaluate(x,{});return S==="uppercase"?d=d.toLocaleUpperCase():S==="lowercase"&&(d=d.toLocaleLowerCase()),Vc.applyArabicShaping&&(d=Vc.applyArabicShaping(d)),d})(u.text,t,a)})),o}const t1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function M6(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function E6(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const BE=4294967296,VD=1/BE,GD=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let rS=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,t,a=this.length){for(;this.pos<a;){const u=this.readVarint(),d=u>>3,_=this.pos;this.type=7&u,o(d,t,this),this.pos===_&&this.skip(u)}return t}readMessage(o,t){return this.readFields(o,t,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*BE;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*BE;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const t=this.buf;let a,u;return u=t[this.pos++],a=127&u,u<128?a:(u=t[this.pos++],a|=(127&u)<<7,u<128?a:(u=t[this.pos++],a|=(127&u)<<14,u<128?a:(u=t[this.pos++],a|=(127&u)<<21,u<128?a:(u=t[this.pos],a|=(15&u)<<28,(function(d,_,x){const S=x.buf;let R,L;if(L=S[x.pos++],R=(112&L)>>4,L<128||(L=S[x.pos++],R|=(127&L)<<3,L<128)||(L=S[x.pos++],R|=(127&L)<<10,L<128)||(L=S[x.pos++],R|=(127&L)<<17,L<128)||(L=S[x.pos++],R|=(127&L)<<24,L<128)||(L=S[x.pos++],R|=(1&L)<<31,L<128))return Ky(d,R,_);throw new Error("Expected varint not more than 10 bytes")})(a,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,t=this.pos;return this.pos=o,o-t>=12&&GD?GD.decode(this.buf.subarray(t,o)):(function(a,u,d){let _="",x=u;for(;x<d;){const S=a[x];let R,L,F,U=null,G=S>239?4:S>223?3:S>191?2:1;if(x+G>d)break;G===1?S<128&&(U=S):G===2?(R=a[x+1],(192&R)==128&&(U=(31&S)<<6|63&R,U<=127&&(U=null))):G===3?(R=a[x+1],L=a[x+2],(192&R)==128&&(192&L)==128&&(U=(15&S)<<12|(63&R)<<6|63&L,(U<=2047||U>=55296&&U<=57343)&&(U=null))):G===4&&(R=a[x+1],L=a[x+2],F=a[x+3],(192&R)==128&&(192&L)==128&&(192&F)==128&&(U=(15&S)<<18|(63&R)<<12|(63&L)<<6|63&F,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,G=1):U>65535&&(U-=65536,_+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),_+=String.fromCharCode(U),x+=G}return _})(this.buf,t,o)}readBytes(){const o=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,o);return this.pos=o,t}readPackedVarint(o=[],t){const a=this.readPackedEnd();for(;this.pos<a;)o.push(this.readVarint(t));return o}readPackedSVarint(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const t=this.readPackedEnd();for(;this.pos<t;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const t=7&o;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(o,t){this.writeVarint(o<<3|t)}realloc(o){let t=this.length||16;for(;t<this.pos+o;)t*=2;if(t!==this.length){const a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*VD),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*VD),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(t,a){let u,d;if(t>=0?(u=t%4294967296|0,d=t/4294967296|0):(u=~(-t%4294967296),d=~(-t/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(_,x,S){S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,S.buf[S.pos]=127&(_>>>=7)})(u,0,a),(function(_,x){const S=(7&_)<<4;x.buf[x.pos++]|=S|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))})(d,a)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const t=this.pos;this.pos=(function(u,d,_){for(let x,S,R=0;R<d.length;R++){if(x=d.charCodeAt(R),x>55295&&x<57344){if(!S){x>56319||R+1===d.length?(u[_++]=239,u[_++]=191,u[_++]=189):S=x;continue}if(x<56320){u[_++]=239,u[_++]=191,u[_++]=189,S=x;continue}x=S-55296<<10|x-56320|65536,S=null}else S&&(u[_++]=239,u[_++]=191,u[_++]=189,S=null);x<128?u[_++]=x:(x<2048?u[_++]=x>>6|192:(x<65536?u[_++]=x>>12|224:(u[_++]=x>>18|240,u[_++]=x>>12&63|128),u[_++]=x>>6&63|128),u[_++]=63&x|128)}return _})(this.buf,o,this.pos);const a=this.pos-t;a>=128&&HD(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const t=o.length;this.writeVarint(t),this.realloc(t);for(let a=0;a<t;a++)this.buf[this.pos++]=o[a]}writeRawMessage(o,t){this.pos++;const a=this.pos;o(t,this);const u=this.pos-a;u>=128&&HD(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u}writeMessage(o,t,a){this.writeTag(o,2),this.writeRawMessage(t,a)}writePackedVarint(o,t){t.length&&this.writeMessage(o,A6,t)}writePackedSVarint(o,t){t.length&&this.writeMessage(o,C6,t)}writePackedBoolean(o,t){t.length&&this.writeMessage(o,D6,t)}writePackedFloat(o,t){t.length&&this.writeMessage(o,R6,t)}writePackedDouble(o,t){t.length&&this.writeMessage(o,I6,t)}writePackedFixed32(o,t){t.length&&this.writeMessage(o,L6,t)}writePackedSFixed32(o,t){t.length&&this.writeMessage(o,P6,t)}writePackedFixed64(o,t){t.length&&this.writeMessage(o,z6,t)}writePackedSFixed64(o,t){t.length&&this.writeMessage(o,O6,t)}writeBytesField(o,t){this.writeTag(o,2),this.writeBytes(t)}writeFixed32Field(o,t){this.writeTag(o,5),this.writeFixed32(t)}writeSFixed32Field(o,t){this.writeTag(o,5),this.writeSFixed32(t)}writeFixed64Field(o,t){this.writeTag(o,1),this.writeFixed64(t)}writeSFixed64Field(o,t){this.writeTag(o,1),this.writeSFixed64(t)}writeVarintField(o,t){this.writeTag(o,0),this.writeVarint(t)}writeSVarintField(o,t){this.writeTag(o,0),this.writeSVarint(t)}writeStringField(o,t){this.writeTag(o,2),this.writeString(t)}writeFloatField(o,t){this.writeTag(o,5),this.writeFloat(t)}writeDoubleField(o,t){this.writeTag(o,1),this.writeDouble(t)}writeBooleanField(o,t){this.writeVarintField(o,+t)}};function Ky(o,t,a){return a?4294967296*t+(o>>>0):4294967296*(t>>>0)+(o>>>0)}function HD(o,t,a){const u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(u);for(let d=a.pos-1;d>=o;d--)a.buf[d+u]=a.buf[d]}function A6(o,t){for(let a=0;a<o.length;a++)t.writeVarint(o[a])}function C6(o,t){for(let a=0;a<o.length;a++)t.writeSVarint(o[a])}function R6(o,t){for(let a=0;a<o.length;a++)t.writeFloat(o[a])}function I6(o,t){for(let a=0;a<o.length;a++)t.writeDouble(o[a])}function D6(o,t){for(let a=0;a<o.length;a++)t.writeBoolean(o[a])}function L6(o,t){for(let a=0;a<o.length;a++)t.writeFixed32(o[a])}function P6(o,t){for(let a=0;a<o.length;a++)t.writeSFixed32(o[a])}function z6(o,t){for(let a=0;a<o.length;a++)t.writeFixed64(o[a])}function O6(o,t){for(let a=0;a<o.length;a++)t.writeSFixed64(o[a])}const NE=3;function B6(o,t,a){t.glyphs=[],o===1&&a.readMessage(N6,t)}function N6(o,t,a){if(o===3){const{id:u,bitmap:d,width:_,height:x,left:S,top:R,advance:L}=a.readMessage(F6,{});t.glyphs.push({id:u,bitmap:new Ld({width:_+2*NE,height:x+2*NE},d),metrics:{width:_,height:x,left:S,top:R,advance:L}})}else o===4?t.ascender=a.readSVarint():o===5&&(t.descender=a.readSVarint())}function F6(o,t,a){o===1?t.id=a.readVarint():o===2?t.bitmap=a.readBytes():o===3?t.width=a.readVarint():o===4?t.height=a.readVarint():o===5?t.left=a.readSVarint():o===6?t.top=a.readSVarint():o===7&&(t.advance=a.readVarint())}const jD=NE,Vh={horizontal:1,vertical:2,horizontalOnly:3};class i1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,a){const u=new i1;return u.scale=t||1,u.fontStack=a,u}static forImage(t){const a=new i1;return a.image=t,a}}class $y{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a,u){const d=new $y;for(let _=0;_<t.sections.length;_++){const x=t.sections[_];x.image?d.addImageSection(x,u):d.addTextSection(x,a)}return d}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=(function(a,u){let d="";for(let _=0;_<a.length;_++){const x=a.charCodeAt(_+1)||null,S=a.charCodeAt(_-1)||null;d+=!u&&(x&&jm(x)&&!t1[a[_+1]]||S&&jm(S)&&!t1[a[_-1]])||!t1[a[_]]?a[_]:t1[a[_]]}return d})(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&sS[this.text.charCodeAt(u)];u++)t++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&sS[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const u=new $y;return u.text=this.text.substring(t,a),u.sectionIndex=this.sectionIndex.slice(t,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,a)=>Math.max(t,this.sections[a].scale)),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(i1.forText(t.scale,t.fontStack||a));const u=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(u)}addImageSection(t,a){const u=t.image?t.image.getPrimary():null;if(!u)return void ht("Can't add FormattedSection with an empty image.");u.scaleSelf(a);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(i1.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ht("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function FE(o,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne=1){const he=$y.fromFeature(o,d,ne);U===Vh.vertical&&he.verticalizePunctuation(G);let ce=[];const _e=(function(He,Je,tt,It,ut,Ot){if(!He)return[];const Zt=[],Yt=(function(si,zt,Dt,ai,Ti,pi){let dn=0;for(let Gi=0;Gi<si.length();Gi++){const Ki=si.getSection(Gi);dn+=qD(si.getCodePoint(Gi),Ki,ai,Ti,zt,pi)}return dn/Math.max(1,Math.ceil(dn/Dt))})(He,Je,tt,It,ut,Ot),li=He.text.indexOf("")>=0;let ui=0;for(let si=0;si<He.length();si++){const zt=He.getSection(si),Dt=He.getCodePoint(si);if(sS[Dt]||(ui+=qD(Dt,zt,It,ut,Je,Ot)),si<He.length()-1){const ai=!((ri=Dt)<11904||!(gn["Bopomofo Extended"](ri)||gn.Bopomofo(ri)||gn["CJK Compatibility Forms"](ri)||gn["CJK Compatibility Ideographs"](ri)||gn["CJK Compatibility"](ri)||gn["CJK Radicals Supplement"](ri)||gn["CJK Strokes"](ri)||gn["CJK Symbols and Punctuation"](ri)||gn["CJK Unified Ideographs Extension A"](ri)||gn["CJK Unified Ideographs"](ri)||gn["Enclosed CJK Letters and Months"](ri)||gn["Halfwidth and Fullwidth Forms"](ri)||gn.Hiragana(ri)||gn["Ideographic Description Characters"](ri)||gn["Kangxi Radicals"](ri)||gn["Katakana Phonetic Extensions"](ri)||gn.Katakana(ri)||gn["Vertical Forms"](ri)||gn["Yi Radicals"](ri)||gn["Yi Syllables"](ri)));(U6[Dt]||ai||zt.image)&&Zt.push(WD(si+1,ui,Yt,Zt,k6(Dt,He.getCodePoint(si+1),ai&&li),!1))}}var ri;return ZD(WD(He.length(),ui,Yt,Zt,0,!0))})(he,L,_,t,u,X),{processBidirectionalText:xe,processStyledBidirectionalText:Ee}=Vc;if(xe&&he.sections.length===1){const He=xe(he.toString(),_e);for(const Je of He){const tt=new $y;tt.text=Je,tt.sections=he.sections;for(let It=0;It<Je.length;It++)tt.sectionIndex.push(0);ce.push(tt)}}else if(Ee){const He=Ee(he.text,he.sectionIndex,_e);for(const Je of He){const tt=new $y;tt.text=Je[0],tt.sectionIndex=Je[1],tt.sections=he.sections,ce.push(tt)}}else ce=(function(He,Je){const tt=[],It=He.text;let ut=0;for(const Ot of Je)tt.push(He.substring(ut,Ot)),ut=Ot;return ut<It.length&&tt.push(He.substring(ut,It.length)),tt})(he,_e);const ke=[],Be={positionedLines:ke,text:he.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(He,Je,tt,It,ut,Ot,Zt,Yt,li,ui,ri,si){let zt=0,Dt=0,ai=0;const Ti=Yt==="right"?1:Yt==="left"?0:.5;let pi=!1;for(const yi of ut){const un=yi.getSections();for(const Yn of un){if(Yn.image)continue;const Ur=Je[Yn.fontStack];if(Ur&&(pi=Ur.ascender!==void 0&&Ur.descender!==void 0,!pi))break}if(!pi)break}let dn=0;for(const yi of ut){yi.trim();const un=yi.getMaxScale(),Yn=(un-1)*ko,Ur={positionedGlyphs:[],lineOffset:0};He.positionedLines[dn]=Ur;const jr=Ur.positionedGlyphs;let cr=0;if(!yi.length()){Dt+=Ot,++dn;continue}let vs=0,Fe=0;for(let Bt=0;Bt<yi.length();Bt++){const ci=yi.getSection(Bt),Bi=yi.getSectionIndex(Bt),Ni=yi.getCodePoint(Bt);let mn=ci.scale,yn=null,sr=null,hr=null,gr=ko,Or=0,Bn=li;Bn===Vh.vertical&&((Gi=Ni)===12312||Gi===12313||Gi===12316||Gi===12540||Gi===12448)&&(Bn=Vh.horizontal);const Zn=!(Bn===Vh.horizontal||!ri&&!mc(Ni)||ri&&(sS[Ni]||Ea(Ni)));if(ci.image){const Wr=It.get(ci.image.toString());if(!Wr)continue;hr=ci.image,He.iconsInText=He.iconsInText||!0,sr=Wr.paddedRect;const $r=Wr.displaySize;mn=mn*ko/si,yn={width:$r[0],height:$r[1],left:0,top:-jD,advance:Zn?$r[1]:$r[0],localGlyph:!1},Or=pi?-yn.height*mn:un*ko-17-$r[1]*mn,gr=yn.advance;const Jr=(Zn?$r[0]:$r[1])*mn-ko*un;Jr>0&&Jr>cr&&(cr=Jr)}else{const Wr=tt[ci.fontStack];if(!Wr)continue;Wr[Ni]&&(sr=Wr[Ni]);const $r=Je[ci.fontStack];if(!$r)continue;const Jr=$r.glyphs[Ni];if(!Jr)continue;if(yn=Jr.metrics,gr=Ni!==8203?ko:0,pi){const hs=$r.ascender!==void 0?Math.abs($r.ascender):0,Cs=$r.descender!==void 0?Math.abs($r.descender):0,bs=(hs+Cs)*mn;vs<bs&&(vs=bs,Fe=(hs-Cs)/2*mn),Or=-hs*mn}else Or=(un-mn)*ko-17}Zn?(He.verticalizable=!0,jr.push({glyph:Ni,image:hr,x:zt,y:Dt+Or,vertical:Zn,scale:mn,localGlyph:yn.localGlyph,fontStack:ci.fontStack,sectionIndex:Bi,metrics:yn,rect:sr}),zt+=gr*mn+ui):(jr.push({glyph:Ni,image:hr,x:zt,y:Dt+Or,vertical:Zn,scale:mn,localGlyph:yn.localGlyph,fontStack:ci.fontStack,sectionIndex:Bi,metrics:yn,rect:sr}),zt+=yn.advance*mn+ui)}jr.length!==0&&(ai=Math.max(zt-ui,ai),pi?YD(jr,Ti,cr,Fe,Ot*un/2):YD(jr,Ti,cr,0,Ot/2)),zt=0;const Ve=Ot*un+cr;Ur.lineOffset=Math.max(cr,Yn),Dt+=Ve,++dn}var Gi;const Ki=Dt,{horizontalAlign:cn,verticalAlign:yr}=UE(Zt);(function(yi,un,Yn,Ur,jr,cr){const vs=(un-Yn)*jr,Fe=-cr*Ur;for(const Ve of yi)for(const Bt of Ve.positionedGlyphs)Bt.x+=vs,Bt.y+=Fe})(He.positionedLines,Ti,cn,yr,ai,Ki),He.top+=-yr*Ki,He.bottom=He.top+Ki,He.left+=-cn*ai,He.right=He.left+ai,He.hasBaseline=pi})(Be,t,a,u,ce,x,S,R,U,L,G,Z),!(function(He){for(const Je of He)if(Je.positionedGlyphs.length!==0)return!1;return!0})(ke))return Be}const sS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},U6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qD(o,t,a,u,d,_){if(t.image){const x=u.get(t.image.toString());return x?x.displaySize[0]*t.scale*ko/_+d:0}{const x=a[t.fontStack],S=x&&x.glyphs[o];return S?S.metrics.advance*t.scale+d:0}}function XD(o,t,a,u){const d=Math.pow(o-t,2);return u?o<t?d/2:2*d:d+Math.abs(a)*a}function k6(o,t,a){let u=0;return o===10&&(u-=1e4),a&&(u+=150),o!==40&&o!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function WD(o,t,a,u,d,_){let x=null,S=XD(t,a,d,_);for(const R of u){const L=XD(t-R.x,a,d,_)+R.badness;L<=S&&(x=R,S=L)}return{index:o,x:t,priorBreak:x,badness:S}}function ZD(o){return o?ZD(o.priorBreak).concat(o.index):[]}function UE(o){let t=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function YD(o,t,a,u,d){if(!(t||a||u||d))return;const _=o.length-1,x=o[_],S=(x.x+x.metrics.advance*x.scale)*t;for(let R=0;R<=_;R++)o[R].x-=S,o[R].y+=a+u+d}function kE(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function aS(o,t,a,u){const{horizontalAlign:d,verticalAlign:_}=UE(u),x=a[0]-o.displaySize[0]*d,S=a[1]-o.displaySize[1]*_;return{imagePrimary:o,imageSecondary:t,top:S,bottom:S+o.displaySize[1],left:x,right:x+o.displaySize[0]}}function VE(o,t,a,u,d,_){const x=o.imagePrimary;let S;if(x.content){const he=x.content,ce=x.pixelRatio||1;S=[he[0]/ce,he[1]/ce,x.displaySize[0]-he[2]/ce,x.displaySize[1]-he[3]/ce]}const R=t.left*_,L=t.right*_;let F,U,G,X;a==="width"||a==="both"?(X=d[0]+R-u[3],U=d[0]+L+u[1]):(X=d[0]+(R+L-x.displaySize[0])/2,U=X+x.displaySize[0]);const Z=t.top*_,ne=t.bottom*_;return a==="height"||a==="both"?(F=d[1]+Z-u[0],G=d[1]+ne+u[2]):(F=d[1]+(Z+ne-x.displaySize[1])/2,G=F+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:F,right:U,bottom:G,left:X,collisionPadding:S}}function KD(o){return!o.imagePrimary.stretchX}function $D(o){return!o.imagePrimary.stretchY}function JD(o){return{width:o.right-o.left,height:o.bottom-o.top}}const hm=128;function Jy(o,t,a){const{expression:u}=t;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new ms(o+1,{worldview:a}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:_}=u;let x=0;for(;x<d.length&&d[x]<=o;)x++;x=Math.max(0,x-1);let S=x;for(;S<d.length&&d[S]<o+1;)S++;S=Math.min(d.length-1,S);const R=d[x],L=d[S];return u.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:L,interpolationType:_}:{kind:"camera",minZoom:R,maxZoom:L,minSize:u.evaluate(new ms(R,{worldview:a})),maxSize:u.evaluate(new ms(L,{worldview:a})),interpolationType:_}}}function GE(o,{uSize:t,uSizeT:a},{lowerSize:u,upperSize:d}){return o.kind==="source"?u/hm:o.kind==="composite"?Rn(u/hm,d/hm,a):t}function Qy(o,t,a=1){let u=0,d=0;if(o.kind==="constant")d=o.layoutSize*a;else if(o.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:S}=o,R=_?oe(nr.interpolationFactor(_,t,x,S),0,1):0;o.kind==="camera"?d=Rn(o.minSize,o.maxSize,R)*a:u=R*a}return{uSizeT:u,uSize:d}}class Og extends Xt{constructor(t,a,u,d,_){super(t,a),this.angle=d,this.z=u,_!==void 0&&(this.segment=_)}clone(){return new Og(this.x,this.y,this.z,this.angle,this.segment)}}function QD(o,t,a,u,d){if(t.segment===void 0)return!0;let _=t,x=t.segment+1,S=0;for(;S>-a/2;){if(x--,x<0)return!1;S-=o[x].dist(_),_=o[x]}S+=o[x].dist(o[x+1]),x++;const R=[];let L=0;for(;S<a/2;){const F=o[x],U=o[x+1];if(!U)return!1;let G=o[x-1].angleTo(F)-F.angleTo(U);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:S,angleDelta:G}),L+=G;S-R[0].distance>u;)L-=R.shift().angleDelta;if(L>d)return!1;x++,S+=F.dist(U)}return!0}function eL(o){let t=0;for(let a=0;a<o.length-1;a++)t+=o[a].dist(o[a+1]);return t}function tL(o,t,a){return o?.6*t*a:0}function iL(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function V6(o,t,a,u,d,_){const x=tL(a,d,_),S=iL(a,u)*_;let R=0;const L=eL(o)/2;for(let F=0;F<o.length-1;F++){const U=o[F],G=o[F+1],X=U.dist(G);if(R+X>L){const Z=(L-R)/X,ne=Rn(U.x,G.x,Z),he=Rn(U.y,G.y,Z),ce=new Og(ne,he,0,G.angleTo(U),F);return!x||QD(o,ce,S,x,t)?ce:void 0}R+=X}}function G6(o,t,a,u,d,_,x,S,R){const L=tL(u,_,x),F=iL(u,d),U=F*x,G=o[0].x===0||o[0].x===R||o[0].y===0||o[0].y===R;return t-U<t/4&&(t=U+t/4),nL(o,G?t/2*S%t:(F/2+2*_)*x*S%t,t,L,a,U,G,!1,R)}function nL(o,t,a,u,d,_,x,S,R){const L=_/2,F=eL(o);let U=0,G=t-a,X=[];for(let Z=0;Z<o.length-1;Z++){const ne=o[Z],he=o[Z+1],ce=ne.dist(he),_e=he.angleTo(ne);for(;G+a<U+ce;){G+=a;const xe=(G-U)/ce,Ee=Rn(ne.x,he.x,xe),ke=Rn(ne.y,he.y,xe);if(Ee>=0&&Ee<R&&ke>=0&&ke<R&&G-L>=0&&G+L<=F){const Be=new Og(Ee,ke,0,_e,Z);u&&!QD(o,Be,_,u,d)||X.push(Be)}}U+=ce}return S||X.length||x||(X=nL(o,U/2,a,u,d,_,x,!0,R)),X}function rL(o){let t=0,a=0;for(const x of o)t+=x.w*x.h,a=Math.max(a,x.w);o.sort(((x,S)=>S.h-x.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let d=0,_=0;for(const x of o)for(let S=u.length-1;S>=0;S--){const R=u[S];if(!(x.w>R.w||x.h>R.h)){if(x.x=R.x,x.y=R.y,_=Math.max(_,x.y+x.h),d=Math.max(d,x.x+x.w),x.w===R.w&&x.h===R.h){const L=u.pop();L&&S<u.length&&(u[S]=L)}else x.h===R.h?(R.x+=x.w,R.w-=x.w):x.w===R.w?(R.y+=x.h,R.h-=x.h):(u.push({x:R.x+x.w,y:R.y,w:R.w-x.w,h:x.h}),R.y+=x.h,R.h-=x.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}oi(Og,"Anchor");const z0=1;class n1{static getImagePositionScale(t,a,u){if(a&&t){const{sx:d,sy:_}=t;return{x:d,y:_}}return{x:u,y:u}}constructor(t,a,u,d){this.paddedRect=t;const{pixelRatio:_,version:x,stretchX:S,stretchY:R,content:L,sdf:F,usvg:U}=a;this.pixelRatio=_,this.stretchX=S,this.stretchY=R,this.content=L,this.version=x,this.padding=u,this.sdf=F,this.usvg=U,this.scale=n1.getImagePositionScale(d,U,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function HE(o,t,a){const u=Hl.parse(o),d=(function(_,x,S=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*S[0])+2*x,h:(_.data?_.data.height:_.height*S[1])+2*x}})(t,a,[u.sx,u.sy]);return{bin:d,imagePosition:new n1(d,t,a,u),imageVariant:u}}class sL{constructor(t,a,u){const d=new Map,_=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(t,d,z0,x),this.addImages(a,_,2,x);const{w:S,h:R}=rL(x),L=new Uo({width:S||1,height:R||1});for(const[F,U]of t.entries()){const G=d.get(F).paddedRect;Uo.copy(U.data,L,{x:0,y:0},{x:G.x+z0,y:G.y+z0},U.data,null,U.sdf)}for(const[F,U]of a.entries()){const G=_.get(F),X=G.paddedRect;let Z=G.padding;const ne=X.x+Z,he=X.y+Z,ce=U.data.width,_e=U.data.height;Z=Z>1?Z-1:Z,Uo.copy(U.data,L,{x:0,y:0},{x:ne,y:he},U.data,u),Uo.copy(U.data,L,{x:0,y:_e-Z},{x:ne,y:he-Z},{width:ce,height:Z},u),Uo.copy(U.data,L,{x:0,y:0},{x:ne,y:he+_e},{width:ce,height:Z},u),Uo.copy(U.data,L,{x:ce-Z,y:0},{x:ne-Z,y:he},{width:Z,height:_e},u),Uo.copy(U.data,L,{x:0,y:0},{x:ne+ce,y:he},{width:Z,height:_e},u),Uo.copy(U.data,L,{x:ce-Z,y:_e-Z},{x:ne-Z,y:he-Z},{width:Z,height:Z},u),Uo.copy(U.data,L,{x:0,y:_e-Z},{x:ne+ce,y:he-Z},{width:Z,height:Z},u),Uo.copy(U.data,L,{x:0,y:0},{x:ne+ce,y:he+_e},{width:Z,height:Z},u),Uo.copy(U.data,L,{x:ce-Z,y:0},{x:ne-Z,y:he+_e},{width:Z,height:Z},u)}this.lut=u,this.image=L,this.iconPositions=d,this.patternPositions=_}addImages(t,a,u,d){for(const[_,x]of t.entries()){const{bin:S,imagePosition:R,imageVariant:L}=HE(_,x,u);a.set(_,R),d.push(S),x.hasRenderCallback&&this.haveRenderCallbacks.push(L.id)}}patchUpdatedImages(t,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((d=>t.hasImage(d,u))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of t.getUpdatedImages(u)){for(const _ of this.iconPositions.keys()){const x=Hl.parse(_);if(Po.isEqual(x.id,d)){const S=t.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(_),S,a,null)}}for(const _ of this.patternPositions.keys()){const x=Hl.parse(_);if(Po.isEqual(x.id,d)){const S=t.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(_),S,a,this.lut)}}}}patchUpdatedImage(t,a,u,d=null){if(!t||!a||t.version===a.version)return;t.version=a.version;const[_,x]=t.tl,S=t.sdf;if(this.lut||S){const R={width:a.data.width,height:a.data.height},L=new Uo(R);Uo.copy(a.data,L,{x:0,y:0},{x:0,y:0},R,d,S),u.update(L,{position:{x:_,y:x}})}else u.update(a.data,{position:{x:_,y:x}})}}oi(n1,"ImagePosition"),oi(sL,"ImageAtlas");const r1=1e20;function aL(o,t,a,u,d,_,x,S,R){for(let L=t;L<t+u;L++)oL(o,a*_+L,_,d,x,S,R);for(let L=a;L<a+d;L++)oL(o,L*_+t,1,u,x,S,R)}function oL(o,t,a,u,d,_,x){_[0]=0,x[0]=-r1,x[1]=r1,d[0]=o[t];for(let S=1,R=0,L=0;S<u;S++){d[S]=o[t+S*a];const F=S*S;do{const U=_[R];L=(d[S]-d[U]+F-U*U)/(S-U)/2}while(L<=x[R]&&--R>-1);R++,_[R]=S,x[R]=L,x[R+1]=r1}for(let S=0,R=0;S<u;S++){for(;x[R+1]<S;)R++;const L=_[R],F=S-L;o[t+S*a]=d[L]+F*F}}const fm=2,jE={none:0,ideographs:1,all:2};class ex{constructor(t,a,u){this.requestManager=t,this.localGlyphMode=a,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,a){const u=[],d=this.url||Tn.GLYPHS_URL;for(const _ in t)for(const x of t[_])u.push({stack:_,id:x});$e(u,(({stack:_,id:x},S)=>{let R=this.entries[_];R||(R=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let L=R.glyphs[x];if(L!==void 0)return void S(null,{stack:_,id:x,glyph:L});if(L=this._tinySDF(R,_,x),L)return R.glyphs[x]=L,void S(null,{stack:_,id:x,glyph:L});const F=Math.floor(x/256);if(256*F>65535)return ht("glyphs > 65535 not supported"),void S(null,{stack:_,id:x,glyph:L});if(R.ranges[F])return void S(null,{stack:_,id:x,glyph:L});let U=R.requests[F];U||(U=R.requests[F]=[],ex.loadGlyphRange(_,F,d,this.requestManager,((G,X)=>{if(X){R.ascender=X.ascender,R.descender=X.descender;for(const Z in X.glyphs)this._doesCharSupportLocalGlyph(+Z)||(R.glyphs[+Z]=X.glyphs[+Z]);R.ranges[F]=!0}for(const Z of U)Z(G,X);delete R.requests[F]}))),U.push(((G,X)=>{G?S(G):X&&S(null,{stack:_,id:x,glyph:X.glyphs[x]||null})}))}),((_,x)=>{if(_)a(_);else if(x){const S={};for(const{stack:R,id:L,glyph:F}of x)S[R]===void 0&&(S[R]={}),S[R].glyphs===void 0&&(S[R].glyphs={}),S[R].glyphs[L]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},S[R].ascender=this.entries[R].ascender,S[R].descender=this.entries[R].descender;a(null,S)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==jE.none&&(this.localGlyphMode===jE.all?!!this.localFontFamily:!!this.localFontFamily&&(gn["CJK Unified Ideographs"](t)||gn["Hangul Syllables"](t)||gn.Hiragana(t)||gn.Katakana(t)||gn["CJK Symbols and Punctuation"](t)||gn["CJK Unified Ideographs Extension A"](t)||gn["CJK Unified Ideographs Extension B"](t)||gn.Osage(t)))}_tinySDF(t,a,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let _=t.tinySDF;if(!_){let ne="400";/bold/i.test(a)?ne="900":/medium/i.test(a)?ne="500":/light/i.test(a)&&(ne="200"),_=t.tinySDF=new ex.TinySDF({fontFamily:d,fontWeight:ne,fontSize:24*fm,buffer:3*fm,radius:8*fm}),_.fontWeight=ne}if(this.localGlyphs[_.fontWeight][u])return this.localGlyphs[_.fontWeight][u];const x=String.fromCodePoint(u),{data:S,width:R,height:L,glyphWidth:F,glyphHeight:U,glyphLeft:G,glyphTop:X,glyphAdvance:Z}=_.draw(x);return this.localGlyphs[_.fontWeight][u]={id:u,bitmap:new Ld({width:R,height:L},S),metrics:{width:F/fm,height:U/fm,left:G/fm,top:X/fm-27,advance:Z/fm,localGlyph:!0}}}}ex.loadGlyphRange=function(o,t,a,u,d){const _=256*t,x=_+255,S=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${_}-${x}`),ru.Glyphs);il(S,((R,L)=>{if(R)d(R);else if(L){const F={},U=(function(G){return new rS(G).readFields(B6,{})})(L);for(const G of U.glyphs)F[G.id]=G;d(null,{glyphs:F,ascender:U.ascender,descender:U.descender})}}))},ex.TinySDF=class{constructor({fontSize:o=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:x="normal",lang:S=null}={}){this.buffer=t,this.cutoff=u,this.radius=a,this.lang=S;const R=this.size=o+4*t,L=this._createCanvas(R),F=this.ctx=L.getContext("2d",{willReadFrequently:!0});F.font=`${x} ${_} ${o}px ${d}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(o){const t=document.createElement("canvas");return t.width=t.height=o,t}draw(o){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(o),x=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),R=Math.min(this.size-this.buffer,x+Math.ceil(u)),L=S+2*this.buffer,F=R+2*this.buffer,U=Math.max(L*F,0),G=new Uint8ClampedArray(U),X={data:G,width:L,height:F,glyphWidth:S,glyphHeight:R,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(S===0||R===0)return X;const{ctx:Z,buffer:ne,gridInner:he,gridOuter:ce}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(ne,ne,S,R),Z.fillText(o,ne,ne+x);const _e=Z.getImageData(ne,ne,S,R);ce.fill(r1,0,U),he.fill(0,0,U);for(let xe=0;xe<R;xe++)for(let Ee=0;Ee<S;Ee++){const ke=_e.data[4*(xe*S+Ee)+3]/255;if(ke===0)continue;const Be=(xe+ne)*L+Ee+ne;if(ke===1)ce[Be]=0,he[Be]=r1;else{const He=.5-ke;ce[Be]=He>0?He*He:0,he[Be]=He<0?He*He:0}}aL(ce,0,0,L,F,L,this.f,this.v,this.z),aL(he,ne,ne,S,R,L,this.f,this.v,this.z);for(let xe=0;xe<U;xe++){const Ee=Math.sqrt(ce[xe])-Math.sqrt(he[xe]);G[xe]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return X}};const tg=z0;function lL(o,t){return o+t[1]-t[0]}function qE(o,t,a,u,d=1){const _=[],x=o.imagePrimary,S=x.pixelRatio,R=x.paddedRect.w-2*tg,L=x.paddedRect.h-2*tg,F=(o.right-o.left)*d,U=(o.bottom-o.top)*d,G=x.stretchX||[[0,R]],X=x.stretchY||[[0,L]],Z=G.reduce(lL,0),ne=X.reduce(lL,0),he=R-Z,ce=L-ne;let _e=0,xe=Z,Ee=0,ke=ne,Be=0,He=he,Je=0,tt=ce;if(x.content&&u){const ut=x.content;_e=oS(G,0,ut[0]),Ee=oS(X,0,ut[1]),xe=oS(G,ut[0],ut[2]),ke=oS(X,ut[1],ut[3]),Be=ut[0]-_e,Je=ut[1]-Ee,He=ut[2]-ut[0]-xe,tt=ut[3]-ut[1]-ke}const It=(ut,Ot,Zt,Yt)=>{const li=lS(ut.stretch-_e,xe,F,o.left*d),ui=cS(ut.fixed-Be,He,ut.stretch,Z),ri=lS(Ot.stretch-Ee,ke,U,o.top*d),si=cS(Ot.fixed-Je,tt,Ot.stretch,ne),zt=lS(Zt.stretch-_e,xe,F,o.left*d),Dt=cS(Zt.fixed-Be,He,Zt.stretch,Z),ai=lS(Yt.stretch-Ee,ke,U,o.top*d),Ti=cS(Yt.fixed-Je,tt,Yt.stretch,ne),pi=new Xt(li,ri),dn=new Xt(zt,ri),Gi=new Xt(zt,ai),Ki=new Xt(li,ai),cn=new Xt(ui/S,si/S),yr=new Xt(Dt/S,Ti/S),yi=t*Math.PI/180;if(yi){const vs=Math.sin(yi),Fe=Math.cos(yi),Ve=[Fe,-vs,vs,Fe];pi._matMult(Ve),dn._matMult(Ve),Ki._matMult(Ve),Gi._matMult(Ve)}const un=ut.stretch+ut.fixed,Yn=Zt.stretch+Zt.fixed,Ur=Ot.stretch+Ot.fixed,jr=Yt.stretch+Yt.fixed,cr=o.imageSecondary;return{tl:pi,tr:dn,bl:Ki,br:Gi,texPrimary:{x:x.paddedRect.x+tg+un,y:x.paddedRect.y+tg+Ur,w:Yn-un,h:jr-Ur},texSecondary:cr?{x:cr.paddedRect.x+tg+un,y:cr.paddedRect.y+tg+Ur,w:Yn-un,h:jr-Ur}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cn,pixelOffsetBR:yr,minFontScaleX:He/S/F,minFontScaleY:tt/S/U,isSDF:a}};if(u&&(x.stretchX||x.stretchY)){const ut=cL(G,he,Z),Ot=cL(X,ce,ne);for(let Zt=0;Zt<ut.length-1;Zt++){const Yt=ut[Zt],li=ut[Zt+1];for(let ui=0;ui<Ot.length-1;ui++)_.push(It(Yt,Ot[ui],li,Ot[ui+1]))}}else _.push(It({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:L+1}));return _}function H6(o,t){const a=o.stretchY||[[0,o.paddedRect.h-2*tg]];return t&&(o.stretchX||o.stretchY)?uL(o.stretchX||[[0,o.paddedRect.w-2*tg]])*uL(a):1}function oS(o,t,a){let u=0;for(const d of o)u+=Math.max(t,Math.min(a,d[1]))-Math.max(t,Math.min(a,d[0]));return u}function cL(o,t,a){const u=[{fixed:-tg,stretch:0}];for(const[d,_]of o){const x=u[u.length-1];u.push({fixed:d-x.stretch,stretch:x.stretch}),u.push({fixed:d-x.stretch,stretch:x.stretch+(_-d)})}return u.push({fixed:t+tg,stretch:a}),u}function uL(o){return 2*o.length+1}function lS(o,t,a,u){return o/t*a+u}function cS(o,t,a,u){return o-t*a/u}function j6(o,t,a,u){const d=t+o.positionedLines[u].lineOffset;return u===0?a+d/2:a+(d+(t+o.positionedLines[u-1].lineOffset))/2}function q6(o,t=1,a=!1){let u=1/0,d=1/0,_=-1/0,x=-1/0;const S=o[0];for(let X=0;X<S.length;X++){const Z=S[X];(!X||Z.x<u)&&(u=Z.x),(!X||Z.y<d)&&(d=Z.y),(!X||Z.x>_)&&(_=Z.x),(!X||Z.y>x)&&(x=Z.y)}const R=Math.min(_-u,x-d);let L=R/2;const F=new fu([],X6);if(R===0)return new Xt(u,d);for(let X=u;X<_;X+=R)for(let Z=d;Z<x;Z+=R)F.push(new tx(X+L,Z+L,L,o));let U=(function(X){let Z=0,ne=0,he=0;const ce=X[0];for(let _e=0,xe=ce.length,Ee=xe-1;_e<xe;Ee=_e++){const ke=ce[_e],Be=ce[Ee],He=ke.x*Be.y-Be.x*ke.y;ne+=(ke.x+Be.x)*He,he+=(ke.y+Be.y)*He,Z+=3*He}return new tx(ne/Z,he/Z,0,X)})(o),G=F.length;for(;F.length;){const X=F.pop();(X.d>U.d||!U.d)&&(U=X,a&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,G)),X.max-U.d<=t||(L=X.h/2,F.push(new tx(X.p.x-L,X.p.y-L,L,o)),F.push(new tx(X.p.x+L,X.p.y-L,L,o)),F.push(new tx(X.p.x-L,X.p.y+L,L,o)),F.push(new tx(X.p.x+L,X.p.y+L,L,o)),G+=4)}return a&&(console.log(`num probes: ${G}`),console.log(`best distance: ${U.d}`)),U.p}function X6(o,t){return t.max-o.max}class tx{constructor(t,a,u,d){this.p=new Xt(t,a),this.h=u,this.d=(function(_,x){let S=!1,R=1/0;for(let L=0;L<x.length;L++){const F=x[L];for(let U=0,G=F.length,X=G-1;U<G;X=U++){const Z=F[U],ne=F[X];Z.y>_.y!=ne.y>_.y&&_.x<(ne.x-Z.x)*(_.y-Z.y)/(ne.y-Z.y)+Z.x&&(S=!S),R=Math.min(R,B(_,Z,ne))}}return(S?1:-1)*Math.sqrt(R)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const W6=Object.keys,XE=Number.POSITIVE_INFINITY,Z6=Math.sqrt(2);function I_(o,t,a,u,d){const _=kE(o)&&o.collisionPadding?o.collisionPadding:[0,0,0,0],x={top:o.top-_[1],bottom:o.bottom+_[3],left:o.left-_[0],right:o.right+_[2],scaled:!1};return u!==void 0&&(function(S,R){S.top*=R,S.bottom*=R,S.left*=R,S.right*=R,S.scaled=!0})(x,u),a&&(function(S,R){if(!R)return;const L=Ar(R),F=new Xt(S.left,S.top),U=new Xt(S.right,S.top),G=new Xt(S.left,S.bottom),X=new Xt(S.right,S.bottom),Z=new Xt(0,0);F._rotateAround(L,Z),U._rotateAround(L,Z),G._rotateAround(L,Z),X._rotateAround(L,Z),S.left=Math.min(F.x,U.x,G.x,X.x),S.right=Math.max(F.x,U.x,G.x,X.x),S.top=Math.min(F.y,U.y,G.y,X.y),S.bottom=Math.max(F.y,U.y,G.y,X.y)})(x,a),d&&(x.left+=d[0],x.right+=d[0],x.top+=d[1],x.bottom+=d[1]),t?{top:Math.min(t.top,x.top),bottom:Math.max(t.bottom,x.bottom),left:Math.min(t.left,x.left),right:Math.max(t.right,x.right),scaled:t.scaled||x.scaled}:x}function hL(o,[t,a]){let u=0,d=0;if(a===XE){t<0&&(t=0);const _=t/Z6;switch(o){case"top-right":case"top-left":d=_-7;break;case"bottom-right":case"bottom-left":d=7-_;break;case"bottom":d=7-t;break;case"top":d=t-7}switch(o){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),a=Math.abs(a),o){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(o){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,d]}function Y6(o,t,a,u,d,_,x,S,R,L,F,U,G,X){const Z=o.layers[0],ne=Z.appearances;if(ne.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const he={iconBBox:null,iconVerticalBBox:null},ce={textBBox:null,textVerticalBBox:null},{baseIconRotate:_e,baseTextRotate:xe,iconScaleFactor:Ee}=(function(Be,He,Je){const tt=Be.get("icon-rotate").evaluate(He,{},Je),It=Be.get("text-rotate").evaluate(He,{},Je),[ut,Ot]=Be.get("icon-size-scale-range");return{baseIconRotate:tt,baseTextRotate:It,iconScaleFactor:oe(1,ut,Ot)}})(u,d,_);t&&(he.iconBBox=I_(t,he.iconBBox,_e,x),a)&&(he.iconVerticalBBox=I_(a,he.iconVerticalBBox,_e+90,x));const ke=hS(U.horizontal);ke&&(ce.textBBox=I_(ke,ce.textBBox,xe,1,X)),U.vertical&&(ce.textVerticalBBox=I_(U.vertical,ce.textVerticalBBox,xe+90,1,X));for(const Be of ne)Be.hasIconProperties()&&K6(he,o,Z,Be,d,_,S,_e,x,R,t,L,Ee,F),Be.hasTextProperties()&&$6(ce,Z,Be,d,_,X,xe,G,ke,U.vertical);return{iconBBox:he.iconBBox,iconVerticalBBox:he.iconVerticalBBox,textBBox:ce.textBBox,textVerticalBBox:ce.textVerticalBBox}}function K6(o,t,a,u,d,_,x,S,R,L,F,U,G,X){const{appearanceIconOffset:Z,appearanceIconRotate:ne,appearanceIconSize:he}=(function(Ee,ke,Be,He,Je,tt,It,ut){const Ot=Ee.hasProperty("icon-offset")?ke.getAppearanceValueAndResolveTokens(Ee,"icon-offset",Be,He,[]):null,Zt=Ot&&Array.isArray(Ot)?Ot:Je,Yt=Ee.hasProperty("icon-rotate")?ke.getAppearanceValueAndResolveTokens(Ee,"icon-rotate",Be,He,[]):null,li=typeof Yt=="number"?Yt:tt,ui=Ee.hasProperty("icon-size")?ke.getAppearanceValueAndResolveTokens(Ee,"icon-size",Be,He,[]):null;return{appearanceIconOffset:Zt,appearanceIconRotate:li,appearanceIconSize:typeof ui=="number"?ui*ut.iconScaleFactor:It}})(u,a,d,_,x,S,R,L);let ce=null,_e=null,xe=null;u.hasProperty("icon-image")?xe=(function(Ee,ke,Be,He,Je,tt,It){let ut=null;const Ot=ke.getAppearanceValueAndResolveTokens(Be,"icon-image",He,Je,[]);if(Ot){const Zt=Ee.getResolvedImageFromTokens(Ot),Yt=Be.getUnevaluatedProperty("icon-size"),li=s1(Zt,Jy(Ee.zoom,Yt,Ee.worldview),Yt,Je,Ee.zoom,He,Ee.pixelRatio,It,Ee.worldview);ut=tt.get(li.iconPrimary.toString())}return ut})(t,a,u,d,_,U,G):F&&(xe=F.imagePrimary),xe&&(ce=aS(xe,null,Z,X),t.allowVerticalPlacement&&(_e=aS(xe,null,Z,X))),ce&&(o.iconBBox=I_(ce,o.iconBBox,ne,he)),_e&&(o.iconVerticalBBox=I_(_e,o.iconVerticalBBox,ne+90,he))}function $6(o,t,a,u,d,_,x,S,R,L){const{appearanceTextOffset:F,appearanceTextRotate:U,appearanceTextSize:G}=(function(Z,ne,he,ce,_e,xe,Ee){const ke=Z.hasProperty("text-offset")?ne.getAppearanceValueAndResolveTokens(Z,"text-offset",he,ce,[]):null,Be=ke&&Array.isArray(ke)?[ke[0]*ko,ke[1]*ko]:_e,He=Z.hasProperty("text-rotate")?ne.getAppearanceValueAndResolveTokens(Z,"text-rotate",he,ce,[]):null,Je=typeof He=="number"?He:xe,tt=Z.hasProperty("text-size")?ne.getAppearanceValueAndResolveTokens(Z,"text-size",he,ce,[]):null;return{appearanceTextOffset:Be,appearanceTextRotate:Je,appearanceTextSize:typeof tt=="number"?tt:Ee}})(a,t,u,d,_,x,S),X=G/S;R&&(o.textBBox=I_(R,o.textBBox,U,X,F)),L&&(o.textVerticalBBox=I_(L,o.textVerticalBBox,U+90,X,F))}function uS(o,t,a,u,d,_,x,S,R){if(!t||!t.usvg)return;const L=JD(u),F=JD(d),U=_!=="both"&&_!=="width"||!KD(u)?1:F.width/L.width,G=_!=="both"&&_!=="height"||!$D(u)?1:F.height/L.height;a.scaleSelf(U,G);const X=a.toString();x.set(X,a),S.set(X,t);const{imagePosition:Z}=HE(X,t,z0);R.set(X,Z)}function fL(o,t,a,u,d,_,x,S,R){if(!o)return;const L=(function(F,U,G,X,Z,ne){if(F.kind==="camera")return F.maxSize;if(F.kind==="composite"){const he=U.possiblyEvaluate(new ms(F.maxZoom,{worldview:ne}),G).evaluate(Z,{},G),ce=U.possiblyEvaluate(new ms(F.minZoom,{worldview:ne}),G).evaluate(Z,{},G);return Math.max(he,ce)}return U.possiblyEvaluate(new ms(X,{worldview:ne})).evaluate(Z,{},G)})(t,a,u,d,_,R);return o.scaleSelf(L*S*x)}function s1(o,t,a,u,d,_,x,S,R){return{iconPrimary:fL(o.getPrimary(),t,a,u,d,_,x,S,R),iconSecondary:fL(o.getSecondary(),t,a,u,d,_,x,S,R)}}function J6(o,t,a){if(!t)return;const u=a.get(o.toString()),d=a.get(t.toString());u&&d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||ht(`Mismatch in icon variant sizes: ${o.toString()} and ${t.toString()}`),u.usvg!==d.usvg&&ht(`Mismatch in icon variant image types: ${o.id} and ${t.id}`))}function dL(o,t,a,u){if(!o)return;const d=t.get(a.toString());if(o.imagePrimary=d,u){const _=t.get(u.toString());o.imageSecondary=_}}function Q6(o,t){for(const a in o.horizontal)pL(o.horizontal[a],t);pL(o.vertical,t)}function pL(o,t){if(o){for(const a of o.positionedLines)for(const u of a.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=t.get(d).paddedRect}}}function WE(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e8(o,t,a,u,d,_,x,S,R){const L=hS(_.horizontal)||_.vertical,F=a.get("icon-text-fit-padding").evaluate(u,{},d);let U,G=t;return t&&R!=="none"&&(o.allowVerticalPlacement&&_.vertical&&(U=VE(t,_.vertical,R,F,S,x)),L&&(G=VE(t,L,R,F,S,x))),{defaultShapedIcon:G,verticallyShapedIcon:U}}function t8(o,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e,xe,Ee,ke,Be,He){let Je=x.textMaxSize.evaluate(t,{},G);Je===void 0?Je=S*x.textScaleFactor:Je*=x.textScaleFactor;const tt=o.layers[0].layout,It=ko,ut=S*x.textScaleFactor/It,Ot=hS(a.horizontal)||a.vertical;if(he!=="none"&&o.appearanceFeatureData&&t.index<o.appearanceFeatureData.length){const Gi=o.appearanceFeatureData[t.index];Gi&&(Gi.textShaping=Ot,Gi.iconTextFitPadding=tt.get("icon-text-fit-padding").evaluate(t,{},G),Gi.fontScale=ut)}const Zt=X.name==="globe",Yt=o.tilePixelRatio*Je/It,li=(ai=o.overscaling,o.zoom>18&&ai>2&&(ai>>=1),Math.max(gi/(512*ai),1)*tt.get("symbol-spacing")),ui=tt.get("text-padding")*o.tilePixelRatio,ri=tt.get("icon-padding")*o.tilePixelRatio,si=Ar(tt.get("text-max-angle")),zt=tt.get("icon-rotation-alignment")==="map"&&xe!=="point",Dt=li/2;var ai;o.hasAnyIconTextFit===!1&&he!=="none"&&(o.hasAnyIconTextFit=!0);const Ti=t.properties?+t.properties[yt]:null,pi=Ti&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(Ti):65535,dn=(Gi,Ki,cn)=>{if(Ki.x<0||Ki.x>=gi||Ki.y<0||Ki.y>=gi)return;let yr=null;if(Zt){const{x:yi,y:un,z:Yn}=X.projectTilePoint(Ki.x,Ki.y,cn);yr={anchor:new Og(yi,un,Yn,0,void 0),up:X.upVector(cn,Ki.x,Ki.y)}}(function(yi,un,Yn,Ur,jr,cr,vs,Fe,Ve,Bt,ci,Bi,Ni,mn,yn,sr,hr,gr,Or,Bn,Zn,Wr,$r,Jr,hs,Cs,bs,es,ss,fr,Gr,ia,Ln){const Br=yi.addToLineVertexArray(un,Ur);let Ss,Ls,Gs,Ra,Ns,Pn,ra,fs=0,Qs=0,_o=0,Vo=0,Za=-1,Ya=-1;const Ro={};let Pu=af("");const Fs=Yn?Yn.anchor:un,Sa=es!=="none";let Ia=0,hh=0;if(Ve._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ol=Ve.layout.get("text-offset").evaluate(Zn,{},hs);Ia=Ol[0]*ko,hh=Ol[1]*ko}else Ia=Ve.layout.get("text-radial-offset").evaluate(Zn,{},hs)*ko,hh=XE;if(yi.allowVerticalPlacement&&jr.vertical){const Ol=jr.vertical;if(yn)Pn=ZE(Ol),Fe&&(ra=ZE(Fe));else{const Qc=Ve.layout.get("text-rotate").evaluate(Zn,{},hs)+90;Gs=fS(Bt,Fs,un,ci,Bi,Ni,Ol,mn,Qc,sr,ia),Fe&&(Ra=fS(Bt,Fs,un,ci,Bi,Ni,Fe,gr,Qc,null,Gr))}}if(cr){const Ol=yi.iconSizeData,Qc=Ve.layout.get("icon-rotate").evaluate(Zn,{},hs),Gh=qE(cr,Qc,$r,Sa,Wr.iconScaleFactor),P_=Fe?qE(Fe,Qc,$r,Sa,Wr.iconScaleFactor):void 0;Ls=fS(Bt,Fs,un,ci,Bi,Ni,cr,gr,Qc,null,fr);const lx=(function(gm,S1,PP,dG,zP,OP,pG,mG){const BP=gm.layers[0],NP=BP.appearances;let cx=S1.length;if(PP&&(cx=Math.max(cx,PP.length)),NP.length===0)return cx;const[gG,_G]=dG.get("icon-size-scale-range"),yG=oe(1,gG,_G);for(const FP of NP){const UP=FP.getUnevaluatedProperties();if(UP._values["icon-image"].value!==void 0){const kP=BP.getAppearanceValueAndResolveTokens(FP,"icon-image",zP,OP,[]);if(kP){const VP=gm.getResolvedImageFromTokens(kP);if(VP){const GP=UP._values["icon-size"],xG=s1(VP,Jy(gm.zoom,GP,gm.worldview),GP,OP,gm.zoom,zP,gm.pixelRatio,yG,gm.worldview),vG=pG.get(xG.iconPrimary.toString());cx=Math.max(cx,H6(vG,mG))}}}}return cx})(yi,Gh,P_,Ve.layout,Zn,hs,yi.iconAtlasPositions,Sa);fs=4*lx;let mm=null;Ol.kind==="source"?(mm=[hm*Ve.layout.get("icon-size").evaluate(Zn,{},hs)*Wr.iconScaleFactor],mm[0]>Bg&&ht(`${yi.layerIds[0]}: Value for "icon-size" is >= ${a1}. Reduce your "icon-size".`)):Ol.kind==="composite"&&(mm=[hm*Wr.compositeIconSizes[0].evaluate(Zn,{},hs)*Wr.iconScaleFactor,hm*Wr.compositeIconSizes[1].evaluate(Zn,{},hs)*Wr.iconScaleFactor],(mm[0]>Bg||mm[1]>Bg)&&ht(`${yi.layerIds[0]}: Value for "icon-size" is >= ${a1}. Reduce your "icon-size".`)),yi.addSymbols(yi.icon,Gh,mm,Bn,Or,Zn,void 0,Yn,un,Br.lineStartIndex,Br.lineLength,-1,Jr,hs,Cs,bs,yi.symbolInstances.length,lx),Za=yi.icon.placedSymbolArray.length-1,P_&&(Qs=4*lx,yi.addSymbols(yi.icon,P_,mm,Bn,Or,Zn,Vh.vertical,Yn,un,Br.lineStartIndex,Br.lineLength,-1,Jr,hs,Cs,bs,yi.symbolInstances.length,lx),Ya=yi.icon.placedSymbolArray.length-1)}for(const Ol in jr.horizontal){const Qc=Ol,Gh=jr.horizontal[Qc];Ss||(Pu=af(Gh.text),yn?Ns=ZE(Gh):Ss=fS(Bt,Fs,un,ci,Bi,Ni,Gh,mn,Ve.layout.get("text-rotate").evaluate(Zn,{},hs),sr,ia));const P_=Gh.positionedLines.length===1;if(_o+=mL(yi,Yn,un,Gh,vs,Ve,yn,Zn,sr,Br,jr.vertical?Vh.horizontal:Vh.horizontalOnly,P_?W6(jr.horizontal):[Qc],Ro,Za,Wr,Jr,hs,yi.symbolInstances.length,Cs),P_)break}jr.vertical&&(Vo+=mL(yi,Yn,un,jr.vertical,vs,Ve,yn,Zn,sr,Br,Vh.vertical,["vertical"],Ro,Ya,Wr,Jr,hs,yi.symbolInstances.length,Cs));let yo=-1;const wp=(Ol,Qc)=>Ol?Math.max(Ol,Qc):Qc;yo=wp(Ns,yo),yo=wp(Pn,yo),yo=wp(ra,yo);const ig=yo>-1?1:0;yi.glyphOffsetArray.length>=65535&&ht("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&yi.addToSortKeyRanges(yi.symbolInstances.length,Zn.sortKey),yi.symbolInstances.emplaceBack(un.x,un.y,Fs.x,Fs.y,Fs.z,Ro.right>=0?Ro.right:-1,Ro.center>=0?Ro.center:-1,Ro.left>=0?Ro.left:-1,Ro.vertical>=0?Ro.vertical:-1,Za,Ya,Pu,Ss!==void 0?Ss:yi.collisionBoxArray.length,Ss!==void 0?Ss+1:yi.collisionBoxArray.length,Gs!==void 0?Gs:yi.collisionBoxArray.length,Gs!==void 0?Gs+1:yi.collisionBoxArray.length,Ls!==void 0?Ls:yi.collisionBoxArray.length,Ls!==void 0?Ls+1:yi.collisionBoxArray.length,Ra||yi.collisionBoxArray.length,Ra?Ra+1:yi.collisionBoxArray.length,ci,_o,Vo,fs,Qs,ig,0,Ia,hh,yo,0,Sa?1:0,ss)})(o,Ki,yr,Gi,a,u,_,d,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,ui,_e,L,0,ri,zt,ce,t,x,F,U,G,Z,ne,he,pi,Ee,ke,Be)};if(xe==="line")for(const Gi of um(t.geometry,0,0,gi,gi)){const Ki=G6(Gi,li,si,a.vertical||Ot,u,It,Yt,o.overscaling,gi);for(const cn of Ki)Ot&&i8(o,Ot.text,Dt,cn)||dn(Gi,cn,G)}else if(xe==="line-center"){for(const Gi of t.geometry)if(Gi.length>1){const Ki=V6(Gi,si,a.vertical||Ot,u,It,Yt);Ki&&dn(Gi,Ki,G)}}else if(t.type==="Polygon")for(const Gi of Ig(t.geometry,0)){const Ki=q6(Gi,16);dn(Gi[0],new Og(Ki.x,Ki.y,0,0,void 0),G)}else if(t.type==="LineString")for(const Gi of t.geometry)dn(Gi,new Og(Gi[0].x,Gi[0].y,0,0,void 0),G);else if(t.type==="Point")for(const Gi of t.geometry)for(const Ki of Gi)dn([Ki],new Og(Ki.x,Ki.y,0,0,void 0),G)}const a1=255,Bg=a1*hm;function mL(o,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e){const xe=(function(Be,He,Je,tt,It,ut,Ot,Zt){const Yt=[];if(He.positionedLines.length===0)return Yt;const li=tt.layout.get("text-rotate").evaluate(ut,{})*Math.PI/180,ui=(function(ai){const Ti=ai[0],pi=ai[1],dn=Ti*pi;return dn>0?[Ti,-pi]:dn<0?[-Ti,pi]:Ti===0?[pi,Ti]:[pi,-Ti]})(Je);let ri=Math.abs(He.top-He.bottom);for(const ai of He.positionedLines)ri-=ai.lineOffset;const si=He.positionedLines.length,zt=ri/si;let Dt=He.top-Je[1];for(let ai=0;ai<si;++ai){const Ti=He.positionedLines[ai];Dt=j6(He,zt,Dt,ai);for(const pi of Ti.positionedGlyphs){if(!pi.rect)continue;const dn=pi.rect||{};let Gi=jD+1,Ki=!0,cn=1,yr=0;if(pi.image){const hr=Ot.get(pi.image.toString());if(!hr)continue;if(hr.sdf){ht("SDF images are not supported in formatted text and will be ignored.");continue}Ki=!1,cn=hr.pixelRatio,Gi=z0/cn}const yi=(It||Zt)&&pi.vertical,un=pi.metrics.advance*pi.scale/2,Yn=pi.metrics,Ur=pi.rect;if(Ur===null)continue;Zt&&He.verticalizable&&(yr=pi.image?un-pi.metrics.width*pi.scale/2:0);const jr=It?[pi.x+un,pi.y]:[0,0];let cr=[0,0],vs=[0,0],Fe=!1;It||(yi?(vs=[pi.x+un+ui[0],pi.y+ui[1]-yr],Fe=!0):cr=[pi.x+un+Je[0],pi.y+Je[1]-yr]);const Ve=Ur.w*pi.scale/(cn*(pi.localGlyph?fm:1)),Bt=Ur.h*pi.scale/(cn*(pi.localGlyph?fm:1));let ci,Bi,Ni,mn;if(yi){const hr=pi.y-Dt,gr=new Xt(-un,un-hr),Or=-Math.PI/2,Bn=new Xt(...vs);ci=new Xt(-un+cr[0],cr[1]),ci._rotateAround(Or,gr)._add(Bn),ci.x+=-hr+un,ci.y-=(Yn.left-Gi)*pi.scale;const Zn=pi.image?Yn.advance*pi.scale:ko*pi.scale,Wr=String.fromCodePoint(pi.glyph);M6(Wr)?ci.x+=(1-Gi)*pi.scale:E6(Wr)?ci.x+=Zn-Yn.height*pi.scale+(-Gi-1)*pi.scale:ci.x+=pi.image||Yn.width+2*Gi===Ur.w&&Yn.height+2*Gi===Ur.h?(Zn-Bt)/2:(Zn-(Yn.height+2*Gi)*pi.scale)/2,Bi=new Xt(ci.x,ci.y-Ve),Ni=new Xt(ci.x+Bt,ci.y),mn=new Xt(ci.x+Bt,ci.y-Ve)}else{const hr=(Yn.left-Gi)*pi.scale-un+cr[0],gr=(-Yn.top-Gi)*pi.scale+cr[1],Or=hr+Ve,Bn=gr+Bt;ci=new Xt(hr,gr),Bi=new Xt(Or,gr),Ni=new Xt(hr,Bn),mn=new Xt(Or,Bn)}if(li){let hr;hr=It?new Xt(0,0):Fe?new Xt(ui[0],ui[1]):new Xt(Je[0],Je[1]),ci._rotateAround(li,hr),Bi._rotateAround(li,hr),Ni._rotateAround(li,hr),mn._rotateAround(li,hr)}const yn=new Xt(0,0),sr=new Xt(0,0);Yt.push({tl:ci,tr:Bi,bl:Ni,br:mn,texPrimary:dn,texSecondary:void 0,writingMode:He.writingMode,glyphOffset:jr,sectionIndex:pi.sectionIndex,isSDF:Ki,pixelOffsetTL:yn,pixelOffsetBR:sr,minFontScaleX:0,minFontScaleY:0})}}return Yt})(0,u,R,_,x,S,d,o.allowVerticalPlacement),Ee=o.textSizeData;let ke=null;Ee.kind==="source"?(ke=[hm*_.layout.get("text-size").evaluate(S,{},he)*Z.textScaleFactor],ke[0]>Bg&&ht(`${o.layerIds[0]}: Value for "text-size" is >= ${a1}. Reduce your "text-size".`)):Ee.kind==="composite"&&(ke=[hm*Z.compositeTextSizes[0].evaluate(S,{},he)*Z.textScaleFactor,hm*Z.compositeTextSizes[1].evaluate(S,{},he)*Z.textScaleFactor],(ke[0]>Bg||ke[1]>Bg)&&ht(`${o.layerIds[0]}: Value for "text-size" is >= ${a1}. Reduce your "text-size".`)),o.addSymbols(o.text,xe,ke,R,x,S,F,t,a,L.lineStartIndex,L.lineLength,X,ne,he,_e,!1,ce,xe.length);for(const Be of U)G[Be]=o.text.placedSymbolArray.length-1;return 4*xe.length}function hS(o){for(const t in o)return o[t];return null}function fS(o,t,a,u,d,_,x,S,R,L,F){let U,G,X,Z;if(U=F?F.top:x.top,G=F?F.bottom:x.bottom,X=F?F.left:x.left,Z=F?F.right:x.right,kE(x)&&x.collisionPadding){const ne=x.collisionPadding;X-=ne[0],U-=ne[1],Z+=ne[2],G+=ne[3]}if(R){const ne=new Xt(X,U),he=new Xt(Z,U),ce=new Xt(X,G),_e=new Xt(Z,G),xe=Ar(R);let Ee=new Xt(0,0);L&&(Ee=new Xt(L[0],L[1])),ne._rotateAround(xe,Ee),he._rotateAround(xe,Ee),ce._rotateAround(xe,Ee),_e._rotateAround(xe,Ee),X=Math.min(ne.x,he.x,ce.x,_e.x),Z=Math.max(ne.x,he.x,ce.x,_e.x),U=Math.min(ne.y,he.y,ce.y,_e.y),G=Math.max(ne.y,he.y,ce.y,_e.y)}return o.emplaceBack(t.x,t.y,t.z,a.x,a.y,X,U,Z,G,S,u,d,_),o.length-1}function ZE(o){kE(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const t=o.bottom-o.top;return t>0?Math.max(10,t):null}function i8(o,t,a,u){const d=o.compareText;if(t in d){const _=d[t];for(let x=_.length-1;x>=0;x--)if(u.dist(_[x])<a)return!0}else d[t]=[];return d[t].push(u),!1}function gL(o,t){const a=o.fovAboveCenter,u=o.elevation?o.elevation.getMinElevationBelowMSL()*t:0,d=(o._camera.position[2]*o.worldSize-u)/Math.cos(o._pitch),_=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01));let x=Math.sin(o._pitch)*_+d;const S=d*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let R=Math.max(o.zoom-17,0);o.isOrthographic&&(R/=10),x*=1+R}return Math.min(1.01*x,S)}function o1(o,t){if(!t.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:t};const a=Math.pow(2,-o.z),u=o.x*a,d=(o.x+1)*a,_=o.y*a,x=(o.y+1)*a,S=H(u),R=H(d),L=Q(_),F=Q(x),U=t.project(S,L),G=t.project(R,L),X=t.project(R,F),Z=t.project(S,F);let ne=Math.min(U.x,G.x,X.x,Z.x),he=Math.min(U.y,G.y,X.y,Z.y),ce=Math.max(U.x,G.x,X.x,Z.x),_e=Math.max(U.y,G.y,X.y,Z.y);const xe=a/16;function Ee(Be,He,Je,tt,It,ut){const Ot=(Je+It)/2,Zt=(tt+ut)/2,Yt=t.project(H(Ot),Q(Zt)),li=Math.max(0,ne-Yt.x,he-Yt.y,Yt.x-ce,Yt.y-_e);ne=Math.min(ne,Yt.x),ce=Math.max(ce,Yt.x),he=Math.min(he,Yt.y),_e=Math.max(_e,Yt.y),li>xe&&(Ee(Be,Yt,Je,tt,Ot,Zt),Ee(Yt,He,Ot,Zt,It,ut))}Ee(U,G,u,_,d,_),Ee(G,X,d,_,d,x),Ee(X,Z,d,x,u,x),Ee(Z,U,u,x,u,_),ne-=xe,he-=xe,ce+=xe,_e+=xe;const ke=1/Math.max(ce-ne,_e-he);return{scale:ke,x:ne*ke,y:he*ke,x2:ce*ke,y2:_e*ke,projection:t}}function _L(o,{x:t,y:a},u=0){return new Xt(((t-u)*o.scale-o.x)*gi,(a*o.scale-o.y)*gi)}const n8=ie(new Float32Array(16));class D_{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,a){return{x:0,y:0,z:0}}unproject(t,a){return new c(0,0)}projectTilePoint(t,a,u){return{x:t,y:a,z:0}}locationPoint(t,a,u,d=!0){return t._coordinatePoint(t.locationCoordinate(a,u),d)}pixelsPerMeter(t,a){return V(1,t)*a}pixelSpaceConversion(t,a,u){return 1}farthestPixelDistance(t){return gL(t,t.pixelsPerMeter)}pointCoordinate(t,a,u,d){const _=t.horizonLineFromTop(!1),x=new Xt(a,Math.max(_,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(x,d))}pointCoordinate3D(t,a,u){const d=new Xt(a,u);if(t.elevation)return t.elevation.pointCoordinate(d);{const _=this.pointCoordinate(t,d.x,d.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(t,a){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,a.x,a.y);const u=t.horizonLineFromTop();return a.y<u}createInversionMatrix(t,a){return n8}createTileMatrix(t,a,u){let d,_,x;const S=u.canonical,R=ie(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=o1(S,this);d=1,_=L.x+u.wrap*L.scale,x=L.y,me(R,R,[d/L.scale,d/L.scale,t.pixelsPerMeter/a])}else d=a/t.zoomScale(S.z),_=(S.x+Math.pow(2,S.z)*u.wrap)*d,x=S.y*d;return ue(R,R,[_,x,0]),me(R,R,[d/gi,d/gi,1]),R}upVector(t,a,u){return[0,0,1]}upVectorScale(t,a,u){return{metersToTile:1}}}class r8 extends D_{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[a,u]=this.parallels=t.parallels||[29.5,45.5],d=Math.sin(Ar(a));this.n=(d+Math.sin(Ar(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(t,a){const{n:u,c:d,r0:_}=this,x=Ar(t-this.center[0]),S=Ar(a),R=Math.sqrt(d-2*u*Math.sin(S))/u;return{x:R*Math.sin(x*u),y:R*Math.cos(x*u)-_,z:0}}unproject(t,a){const{n:u,c:d,r0:_}=this,x=_+a;let S=Math.atan2(t,Math.abs(x))*Math.sign(x);x*u<0&&(S-=Math.PI*Math.sign(t)*Math.sign(x));const R=Ar(this.center[0])*u;S=Ie(S,-Math.PI-R,Math.PI-R);const L=oe(js(S/u)+this.center[0],-180,180),F=Math.asin(oe((d-(t*t+x*x)*u*u)/(2*u),-1,1)),U=oe(js(F),-ee,ee);return new c(L,U)}}const l1=1.340264,c1=-.081106,u1=893e-6,h1=.003796,dS=Math.sqrt(3)/2;class s8 extends D_{project(t,a){a=a/180*Math.PI,t=t/180*Math.PI;const u=Math.asin(dS*Math.sin(a)),d=u*u,_=d*d*d;return{x:.5*(t*Math.cos(u)/(dS*(l1+3*c1*d+_*(7*u1+9*h1*d)))/Math.PI+.5),y:1-.5*(u*(l1+c1*d+_*(u1+h1*d))/Math.PI+1),z:0}}unproject(t,a){t=(2*t-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=u*u,_=d*d*d;for(let F,U,G,X=0;X<12&&(U=u*(l1+c1*d+_*(u1+h1*d))-a,G=l1+3*c1*d+_*(7*u1+9*h1*d),F=U/G,u=oe(u-F,-Math.PI/3,Math.PI/3),d=u*u,_=d*d*d,!(Math.abs(F)<1e-12));++X);const x=dS*t*(l1+3*c1*d+_*(7*u1+9*h1*d))/Math.cos(u),S=Math.asin(Math.sin(u)/dS),R=oe(180*x/Math.PI,-180,180),L=oe(180*S/Math.PI,-ee,ee);return new c(R,L)}}class a8 extends D_{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,a){return{x:.5+t/360,y:.5-a/360,z:0}}unproject(t,a){const u=360*(t-.5),d=oe(360*(.5-a),-ee,ee);return new c(u,d)}}const ix=Math.PI/2;function pS(o){return Math.tan((ix+o)/2)}class o8 extends D_{constructor(t){super(t),this.center=t.center||[0,30];const[a,u]=this.parallels=t.parallels||[30,30];let d=Ar(a),_=Ar(u);this.southernCenter=d+_<0,this.southernCenter&&(d=-d,_=-_);const x=Math.cos(d),S=pS(d);this.n=d===_?Math.sin(d):Math.log(x/Math.cos(_))/Math.log(pS(_)/S),this.f=x*Math.pow(pS(d),this.n)/this.n}project(t,a){a=Ar(a),this.southernCenter&&(a=-a),t=Ar(t-this.center[0]);const u=1e-6,{n:d,f:_}=this;_>0?a<-ix+u&&(a=-ix+u):a>ix-u&&(a=ix-u);const x=_/Math.pow(pS(a),d);let S=x*Math.sin(d*t),R=_-x*Math.cos(d*t);return S=.5*(S/Math.PI+.5),R=.5*(R/Math.PI+.5),{x:S,y:this.southernCenter?R:1-R,z:0}}unproject(t,a){t=(2*t-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:d}=this,_=d-a,x=Math.sign(_),S=Math.sign(u)*Math.sqrt(t*t+_*_);let R=Math.atan2(t,Math.abs(_))*x;_*u<0&&(R-=Math.PI*Math.sign(t)*x);const L=oe(js(R/u)+this.center[0],-180,180),F=oe(js(2*Math.atan(Math.pow(d/S,1/u))-ix),-ee,ee);return new c(L,this.southernCenter?-F:F)}}class yL extends D_{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,a){return{x:D(t),y:O(a),z:0}}unproject(t,a){const u=H(t),d=Q(a);return new c(u,d)}}const xL=Ar(ee);class l8 extends D_{project(t,a){const u=(a=Ar(a))*a,d=u*u;return{x:.5*((t=Ar(t))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(t,a){t=(2*t-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=25,_=0,x=u*u;do{x=u*u;const L=x*x;_=(u*(1.007226+x*(.015085+L*(.028874*x-.044475-.005916*L)))-a)/(1.007226+x*(.045255+L*(.259866*x-.311325-.005916*11*L))),u=oe(u-_,-xL,xL)}while(Math.abs(_)>1e-6&&--d>0);x=u*u;const S=oe(js(t/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),R=js(u);return new c(S,R)}}const vL=Ar(ee);class c8 extends D_{project(t,a){a=Ar(a),t=Ar(t);const u=Math.cos(a),d=2/Math.PI,_=Math.acos(u*Math.cos(t/2)),x=Math.sin(_)/_,S=.5*(t*d+2*u*Math.sin(t/2)/x)||0,R=.5*(a+Math.sin(a)/x)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(R/Math.PI+1),z:0}}unproject(t,a){let u=t=(2*t-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,_=25;const x=1e-6;let S=0,R=0;do{const L=Math.cos(d),F=Math.sin(d),U=2*F*L,G=F*F,X=L*L,Z=Math.cos(u/2),ne=Math.sin(u/2),he=2*Z*ne,ce=ne*ne,_e=1-X*Z*Z,xe=_e?1/_e:0,Ee=_e?Math.acos(L*Z)*Math.sqrt(1/_e):0,ke=.5*(2*Ee*L*ne+2*u/Math.PI)-t,Be=.5*(Ee*F+d)-a,He=.5*xe*(X*ce+Ee*L*Z*G)+1/Math.PI,Je=xe*(he*U/4-Ee*F*ne),tt=.125*xe*(U*ne-Ee*F*X*he),It=.5*xe*(G*Z+Ee*ce*L)+.5,ut=Je*tt-It*He;S=(Be*Je-ke*It)/ut,R=(ke*tt-Be*He)/ut,u=oe(u-S,-Math.PI,Math.PI),d=oe(d-R,-vL,vL)}while((Math.abs(S)>x||Math.abs(R)>x)&&--_>0);return new c(js(u),js(d))}}class bL extends D_{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ar(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,a){const{scale:u,cosPhi:d}=this;return{x:Ar(t)*d*u+.5,y:-Math.sin(Ar(a))/d*u+.5,z:0}}unproject(t,a){const{scale:u,cosPhi:d}=this,_=-(a-.5)/u,x=oe(js((t-.5)/u)/d,-180,180),S=Math.asin(oe(_*d,-1,1)),R=oe(js(S),-ee,ee);return new c(x,R)}}class u8 extends yL{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,a,u){const d=h0(t,a,u);return xn(d,d,nm(uh(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(t,a,u){const d=lo(a.lat,a.lng),_=Ui([],d),x=u?t._centerAltitude+u:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(a),t._centerAltitude):t._centerAltitude;ii(d,d,_,V(1,0)*gi*x);const S=ie(new Float64Array(16));return ae(S,t.pixelMatrix,t.globeMatrix),xn(d,d,S),new Xt(d[0],d[1])}pixelsPerMeter(t,a){return V(1,0)*a}pixelSpaceConversion(t,a,u){const d=V(1,t)*a,_=Rn(V(1,45)*a,d,u);return this.pixelsPerMeter(t,a)/_}createTileMatrix(t,a,u){const d=d0(uh(u.canonical));return ae(new Float64Array(16),t.globeMatrix,d)}createInversionMatrix(t,a){const{center:u}=t,d=nm(uh(a));return Se(d,d,Ar(u.lng)),Ae(d,d,Ar(u.lat)),me(d,d,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(t,a,u,d){return ic(t,a,u,!0)||new be(0,0)}pointCoordinate3D(t,a,u){const d=this.pointCoordinate(t,a,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(t,a){return!ic(t,a.x,a.y,!1)}farthestPixelDistance(t){const a=(function(d,_){const x=d.cameraToCenterDistance,S=d._centerAltitude*_,R=d._camera,L=d._camera.forward(),F=et([],Vt([],L,-x),[0,0,S]),U=d.worldSize/(2*Math.PI),G=[0,0,-U],X=d.width/d.height,Z=Math.tan(d.fovAboveCenter),ne=Vt([],R.up(),Z),he=Vt([],R.right(),Z*X),ce=Ui([],et([],et([],L,ne),he)),_e=[];let xe;if(new Si(F,ce).closestPointOnSphere(G,U,_e)){const Ee=et([],_e,G),ke=Di([],Ee,F);xe=Math.cos(d.fovAboveCenter)*kt(ke)}else{const Ee=Di([],F,G),ke=Di([],G,F);Ui(ke,ke);const Be=kt(Ee)-U;xe=Math.sqrt(Be*(Be+2*U));const He=Math.acos(xe/(U+Be))-Math.acos(rn(L,ke));xe*=Math.cos(He)}return 1.01*xe})(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=bc(t.zoom);if(u>0){const d=gL(t,V(1,t.center.lat)*t.worldSize),_=t.worldSize/(2*Math.PI),x=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Rn(a,d+_*(1-Math.cos(x)),Math.pow(u,10))}return a}upVector(t,a,u){return h0(a,u,t,1)}upVectorScale(t){return{metersToTile:fa(Dy(uh(t)))}}}function wL(o){const t=o.parallels,a=!!t&&Math.abs(t[0]+t[1])<.01;switch(o.name){case"mercator":return new yL(o);case"equirectangular":return new a8(o);case"naturalEarth":return new l8(o);case"equalEarth":return new s8(o);case"winkelTripel":return new c8(o);case"albers":return a?new bL(o):new r8(o);case"lambertConformalConic":return a?new bL(o):new o8(o);case"globe":return new u8(o)}throw new Error(`Invalid projection name: ${o.name}`)}const h8=rt.types,f8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function f1(o,t,a,u,d,_,x,S,R,L,F,U,G){const X=S?Math.min(Bg,Math.round(S[0])):0,Z=S?Math.min(Bg,Math.round(S[1])):0;o.emplaceBack(t,a,Math.round(32*u),Math.round(32*d),_,x,(X<<1)+(R?1:0),0+(Z<<1),16*L,16*F,256*U,256*G)}function d1(o,t,a){o.emplaceBack(t,a)}function p1(o,t,a,u,d,_,x){o.emplaceBack(t,a,u,d,_,x)}const mS=(o,t,a,u)=>{for(let d=0;d<t;d++)o.emplaceBack(a[0],a[1],a[2],u[0],u[1],u[2])};function nx(o,t,a,u,d){o.emplaceBack(t,a,u,d),o.emplaceBack(t,a,u,d),o.emplaceBack(t,a,u,d),o.emplaceBack(t,a,u,d)}function d8(o){for(const t of o.sections)if(a_(t.text))return!0;return!1}class YE{constructor(t){this.layoutVertexArray=new Ru,this.indexArray=new Aa,this.programConfigurations=t,this.segments=new Es,this.dynamicLayoutVertexArray=new io,this.opacityVertexArray=new Af,this.placedSymbolArray=new Ql,this.iconTransitioningVertexArray=new Jl,this.globeExtVertexArray=new Fh,this.zOffsetVertexArray=new Cu,this.orientationVertexArray=new tm,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(t,a){const u=[],d=this.layoutVertexArray.uint16;for(let _=0;_<a;++_){const x=12*(t+_);u.push(...d.slice(x,x+12))}return u}updateIconVertexData(t,a,u,d,_,x,S,R,L,F,U,G,X){const Z=this.layoutVertexArray.uint16,ne=12*t;Z[ne]=a,Z[ne+1]=u,Z[ne+2]=d,Z[ne+3]=_,Z[ne+4]=x,Z[ne+5]=S,Z[ne+6]=R,Z[ne+7]=L,Z[ne+8]=F,Z[ne+9]=U,Z[ne+10]=G,Z[ne+11]=X}upload(t,a,u,d,_,x){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,m6.members,!!x),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,_6.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,f8,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,v6.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,g6.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,y6.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,x6.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}oi(YE,"SymbolBuffers");class KE{constructor(t,a,u){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new u,this.segments=new Es,this.collisionVertexArray=new Td,this.collisionVertexArrayExt=new io}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,b6.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,w6.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}oi(KE,"CollisionBuffers");class gS{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((x=>x.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ie([]),this.placementViewportMatrix=ie([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.localizable=t.localizable,this.textSizeData=Jy(this.zoom,a["text-size"],this.worldview),this.iconSizeData=Jy(this.zoom,a["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),_=u.get("symbol-z-order");this.lut=t.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map((x=>Vh[x])),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(t){const a=this.layers[0].getAppearances();return!(!a||a.length===0)&&a.some((u=>u.getProperty(t)!=null))}createArrays(){this.text=new YE(new na(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("text")||t.startsWith("symbol")))),this.icon=new YE(new na(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("icon")||t.startsWith("symbol")))),this.glyphOffsetArray=new Pl,this.lineVertexArray=new Mo,this.symbolInstances=new Zc}calculateGlyphDependencies(t,a,u,d,_){for(const x of t){const S=x.codePointAt(0);if(S===void 0)break;if(a[S]=!0,d&&_&&S<=65535){const R=t1[x];R&&(a[R.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(t,a,u,d,_,x){let S=1;const R=t.getUnevaluatedProperties()._values["icon-size"],L=Jy(this.zoom,R,this.worldview),F=Qy(L,a);if(L.kind!=="constant"&&L.kind!=="camera"||(S=F.uSize),L.kind==="composite"){const{minZoom:U,maxZoom:G}=L,X=R.possiblyEvaluate(new ms(U,{worldview:this.worldview}),d),Z=R.possiblyEvaluate(new ms(G,{worldview:this.worldview}),d),ne=X.evaluate(u,{},d,_);S=ne+(Z.evaluate(u,{},d,_)-ne)*F.uSizeT}return L.kind==="source"&&(S=R.possiblyEvaluate(new ms(this.zoom,{worldview:this.worldview}),d).evaluate(u,{},d,_)),S*x}updateFootprints(t,a){}updateReplacement(t,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!w0(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(t){return typeof t=="string"?Fa.build(t):t}populate(t,a,u,d){const _=this.layers[0],x=_.layout,S=this.projection.name==="globe",R=x.get("text-font"),L=x.get("text-field"),F=x.get("icon-image"),[U,G]=x.get("icon-size-scale-range"),X=oe(a.scaleFactor||1,U,G),Z=(L.value.kind!=="constant"||L.value.value instanceof xo&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(R.value.kind!=="constant"||R.value.value.length>0),ne=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,he=this.hasAnyAppearanceProperty("icon-image"),ce=x.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Z&&!ne&&!he)return;const _e=a.iconDependencies,xe=a.glyphDependencies,Ee=a.availableImages,ke=new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Be=He=>{const Je=He.id.toString();_e.has(Je)?_e.get(Je).push(He):_e.set(Je,[He])};for(const He of t){const{feature:Je,id:tt,index:It,sourceLayerIndex:ut}=He,Ot=_._featureFilter.needGeometry,Zt=ct(Je,Ot);if(!_._featureFilter.filter(ke,Zt,u))continue;if(Ot||(Zt.geometry=Ye(Je,u,d)),S&&Je.type!==1&&u.z<=5){const ai=Zt.geometry,Ti=.98078528056,pi=(dn,Gi)=>rn(h0(dn.x,dn.y,u,1),h0(Gi.x,Gi.y,u,1))<Ti;for(let dn=0;dn<ai.length;dn++)ai[dn]=Pe(ai[dn],pi)}let Yt,li;if(Z){const ai=_.getValueAndResolveTokens("text-field",Zt,u,Ee),Ti=xo.factory(ai);d8(Ti)&&(this.hasRTLText=!0),(!this.hasRTLText||zh()==="unavailable"||this.hasRTLText&&Vc.isParsed())&&(Yt=T6(Ti,_,Zt))}if(ne){const ai=_.getValueAndResolveTokens("icon-image",Zt,u,Ee);li=this.getResolvedImageFromTokens(ai)}const ui=this.layers[0];let ri=!1;if(!li&&he){const ai=ui.getAppearances();for(const Ti of ai)if(Ti.getProperty("icon-image")){const pi=ui.getAppearanceValueAndResolveTokens(Ti,"icon-image",Zt,u,Ee);if(pi){li=this.getResolvedImageFromTokens(pi),ri=!0;break}}}if(!Yt&&!li)continue;const si=this.sortFeaturesByKey?ce.evaluate(Zt,{},u):void 0,zt={id:tt,text:Yt,icon:li,index:It,sourceLayerIndex:ut,geometry:Zt.geometry,properties:Je.properties,type:h8[Je.type],sortKey:si};if(this.features.push(zt),this.featureToAppearanceIndex[It]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:tt,properties:Je.properties,usesAppearanceIconAsPlaceholder:ri,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),li){const ai=ui._unevaluatedLayout._values,{iconPrimary:Ti,iconSecondary:pi}=s1(li,this.iconSizeData,ai["icon-size"],u,this.zoom,zt,this.pixelRatio,X,this.worldview);Be(Ti),pi&&(this.hasAnySecondaryIcon=!0,Be(pi))}const Dt=ui.getAppearances();if(Dt.length!==0&&Dt.forEach((ai=>{if(!ai.getProperty("icon-image"))return;const Ti=this.getCombinedIconPrimary(ai,ui,Zt,u,Ee,zt,X);Ti&&Be(Ti)})),Yt){const ai=R.evaluate(Zt,{},u).join(","),Ti=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vh.vertical)>=0;for(const pi of Yt.sections)if(pi.image){const dn=pi.image.getPrimary().scaleSelf(this.pixelRatio),Gi=dn.id.toString(),Ki=_e.get(Gi)||[];Ki.push(dn),_e.set(Gi,Ki)}else{const dn=Tu(Yt.toString()),Gi=pi.fontStack||ai,Ki=xe[Gi]=xe[Gi]||{};this.calculateGlyphDependencies(pi.text,Ki,Ti,this.allowVerticalPlacement,dn)}}}if(x.get("symbol-placement")==="line"&&(this.features=(function(He){const Je={},tt={},It=[];let ut=0;function Ot(ui){It.push(He[ui]),ut++}function Zt(ui,ri,si){const zt=tt[ui];return delete tt[ui],tt[ri]=zt,It[zt].geometry[0].pop(),It[zt].geometry[0]=It[zt].geometry[0].concat(si[0]),zt}function Yt(ui,ri,si){const zt=Je[ri];return delete Je[ri],Je[ui]=zt,It[zt].geometry[0].shift(),It[zt].geometry[0]=si[0].concat(It[zt].geometry[0]),zt}function li(ui,ri,si){const zt=si?ri[0][ri[0].length-1]:ri[0][0];return`${ui}:${zt.x}:${zt.y}`}for(let ui=0;ui<He.length;ui++){const ri=He[ui],si=ri.geometry,zt=ri.text?ri.text.toString():null;if(!zt){Ot(ui);continue}const Dt=li(zt,si),ai=li(zt,si,!0);if(Dt in tt&&ai in Je&&tt[Dt]!==Je[ai]){const Ti=Yt(Dt,ai,si),pi=Zt(Dt,ai,It[Ti].geometry);delete Je[Dt],delete tt[ai],tt[li(zt,It[pi].geometry,!0)]=pi,It[Ti].geometry=null}else Dt in tt?Zt(Dt,ai,si):ai in Je?Yt(Dt,ai,si):(Ot(ui),Je[Dt]=ut-1,tt[ai]=ut-1)}return It.filter((ui=>ui.geometry))})(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const He of a.elevationFeatures)this.elevationFeatureIdToIndex.set(He.id,this.elevationFeatures.length),this.elevationFeatures.push(He)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((He,Je)=>He.sortKey-Je.sortKey))}getCombinedIconPrimary(t,a,u,d,_,x,S){let R,L;const F=t.getUnevaluatedProperties();if(F._values["icon-image"].value!==void 0){const U=a.getAppearanceValueAndResolveTokens(t,"icon-image",u,d,_);R=this.getResolvedImageFromTokens(U)}else{const U=a.getValueAndResolveTokens("icon-image",u,d,_);R=this.getResolvedImageFromTokens(U)}if(R){const U=F._values["icon-size"]||a._unevaluatedLayout._values["icon-size"];L=s1(R,Jy(this.zoom,U,this.worldview),U,d,this.zoom,x,this.pixelRatio,S,this.worldview).iconPrimary}return L}updateAppearanceBasedIconTextures(t,a,u,d){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const _=this.layers[0];let x=!1,S=0;const R=_.layout,[L,F]=R.get("icon-size-scale-range"),U=oe(1,L,F);for(let G=0;G<this.symbolInstances.length;G++){const X=this.symbolInstances.get(G),Z=this.featureToAppearanceIndex[X.featureIndex],ne=Z!==void 0?this.appearanceFeatureData[Z]:void 0;if(ne&&X.placedIconSymbolIndex>=0){const he=ne.id,ce=a&&he!==void 0?a[String(he)]:void 0,_e={type:"Point",id:ne.id,properties:ne.properties,geometry:[]},xe=this.layers[0].appearances&&this.layers[0].appearances.find((Ee=>Ee.isActive({globals:d,feature:_e,canonical:t,featureState:ce})));if(ne.activeAppearance===xe){S+=X.numIconVertices;continue}if(xe){ne.activeAppearance=xe;const Ee=this.getCombinedIconPrimary(xe,_,_e,t,u,{sortKey:void 0,text:void 0,icon:null,index:X.featureIndex,sourceLayerIndex:X.featureIndex,geometry:[],properties:ne.properties,type:"Point",id:ne.id},U);if(!Ee)continue;const ke=Ee.toString(),Be=this.iconAtlasPositions&&this.iconAtlasPositions.get(ke);if(Be){const He=_.getAppearanceValueAndResolveTokens(xe,"icon-offset",_e,t,u),Je=He&&Array.isArray(He)?He:[0,0];let tt=aS(Be,void 0,Je,_.layout.get("icon-anchor").evaluate(_e,{},t));const It=_.getAppearanceValueAndResolveTokens(xe,"icon-rotate",_e,t,u),ut=typeof It=="number"?It:0,Ot=Be.sdf,Zt=_.layout.get("icon-text-fit").constantOr("none");Zt!=="none"&&ne.textShaping&&ne.iconTextFitPadding&&ne.fontScale&&(tt=VE(tt,ne.textShaping,Zt,ne.iconTextFitPadding,Je,ne.fontScale));const Yt=this.calculateEffectiveAppearanceIconSize(xe,d.zoom,_e,t,u,U),li=0,ui=1+(Math.min(Bg,Math.round(Yt*hm))<<1),ri=qE(tt,ut,Ot,Zt!=="none",U);ne.isUsingAppearanceVertexData||(ne.isUsingAppearanceVertexData=!0,ne.layoutBasedVertexData=this.icon.getIconVertexData(S,X.numIconVertices));for(let zt=0;zt<ri.length;++zt){const Dt=ri[zt],ai=ne.layoutBasedVertexData[0]||X.tileAnchorX,Ti=ne.layoutBasedVertexData[1]||X.tileAnchorY,pi=16*Dt.pixelOffsetTL.x,dn=16*Dt.pixelOffsetTL.y,Gi=16*Dt.pixelOffsetBR.x,Ki=16*Dt.pixelOffsetBR.y,cn=16*Dt.minFontScaleX,yr=16*Dt.minFontScaleY;this.icon.updateIconVertexData(S,ai,Ti,Math.round(32*Dt.tl.x),Math.round(32*Dt.tl.y),Dt.texPrimary.x,Dt.texPrimary.y,li,ui,pi,dn,cn,yr),this.icon.updateIconVertexData(S+1,ai,Ti,Math.round(32*Dt.tr.x),Math.round(32*Dt.tr.y),Dt.texPrimary.x+Dt.texPrimary.w,Dt.texPrimary.y,li,ui,Gi,dn,cn,yr),this.icon.updateIconVertexData(S+2,ai,Ti,Math.round(32*Dt.bl.x),Math.round(32*Dt.bl.y),Dt.texPrimary.x,Dt.texPrimary.y+Dt.texPrimary.h,li,ui,pi,Ki,cn,yr),this.icon.updateIconVertexData(S+3,ai,Ti,Math.round(32*Dt.br.x),Math.round(32*Dt.br.y),Dt.texPrimary.x+Dt.texPrimary.w,Dt.texPrimary.y+Dt.texPrimary.h,li,ui,Gi,Ki,cn,yr),S+=4}const si=X.numIconVertices-4*ri.length;for(let zt=0;zt<si;++zt)this.icon.updateIconVertexData(S+zt,0,0,0,0,0,0,0,0,0,0,0,0);x=!0}else S+=X.numIconVertices}else if(ne.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(S,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(S+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(S+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(S+3,0,0,0,0,0,0,0,0,0,0,0,0),x=!0),S+=X.numIconVertices,ne.activeAppearance=null;else if(ne.isUsingAppearanceVertexData){const ke=ne.layoutBasedVertexData.length/12;for(let Be=0;Be<ke;++Be){const He=Be*12;this.icon.updateIconVertexData(S+Be,ne.layoutBasedVertexData[He+0],ne.layoutBasedVertexData[He+1],ne.layoutBasedVertexData[He+2],ne.layoutBasedVertexData[He+3],ne.layoutBasedVertexData[He+4],ne.layoutBasedVertexData[He+5],ne.layoutBasedVertexData[He+6],ne.layoutBasedVertexData[He+7],ne.layoutBasedVertexData[He+8],ne.layoutBasedVertexData[He+9],ne.layoutBasedVertexData[He+10],ne.layoutBasedVertexData[He+11])}S+=ke,ne.isUsingAppearanceVertexData=!1,ne.activeAppearance=null,x=!0}else S+=X.numIconVertices,ne.activeAppearance=null}}return x}update(t,a,u,d,_,x,S){this.text.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,a,_,u,d,x,S,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const u=de(t),d=1/u;let _=!1,x=!1;for(let S=0;S<this.symbolInstances.length;S++){const R=this.symbolInstances.get(S),L=Re(1,0,0),F=Re(0,1,0),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:G,numIconVertices:X,numVerticalIconVertices:Z}=R,ne=U>0||G>0,he=X>0,ce=this.elevationFeatures[R.elevationFeatureIndex];if(ce){const _e=new Xt(R.tileAnchorX,R.tileAnchorY),xe=.075+ce.pointElevation(_e);R.zOffset!==xe&&(a=!0,R.zOffset=xe),xe!==0&&(this.hasAnyZOffset=!0);const Ee=ce.computeSlopeNormal(_e,d),ke=Qi(Qt(),Re(0,0,1),Ee);st(L,L,ke),st(F,F,ke),L[2]*=u,F[2]*=u,L[0]===1&&L[1]===0&&L[2]===0&&F[0]===0&&F[1]===1&&F[2]===0||(_=_||ne,x=x||he)}if(ne&&(mS(this.text.orientationVertexArray,U,L,F),mS(this.text.orientationVertexArray,G,L,F)),he){const{placedIconSymbolIndex:_e,verticalPlacedIconSymbolIndex:xe}=R;_e>=0&&mS(this.icon.orientationVertexArray,X,L,F),xe>=0&&mS(this.icon.orientationVertexArray,Z,L,F)}}_||(this.text.orientationVertexArray=void 0),x||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(_,x,S)=>{u+=x,u>_.length&&_.resize(u);for(let R=-x;R<0;R++)_.emplace(R+u,S)},a=(_,x,S)=>{d+=x,d>_.length&&_.resize(d);for(let R=-x;R<0;R++)_.emplace(R+d,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:R,numIconVertices:L}=x,F=x.zOffset,U=L>0;if((S>0||R>0)&&(t(this.text.zOffsetVertexArray,S,F),t(this.text.zOffsetVertexArray,R,F)),U){const{placedIconSymbolIndex:G,verticalPlacedIconSymbolIndex:X}=x;G>=0&&a(this.icon.zOffsetVertexArray,L,F),X>=0&&a(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,F)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t,a,u,d,_){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((x=>x.appearances&&x.appearances.length>0))),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(t,a,u,d){return!!(t&&a&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(t,a,u,d)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wL(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const u=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:d,y:_}of a)this.lineVertexArray.emplaceBack(d,_);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne,he,ce,_e){const xe=t.indexArray,Ee=t.layoutVertexArray,ke=t.globeExtVertexArray,Be=t.segments.prepareSegment(4*_e,Ee,xe,this.canOverlap?x.sortKey:void 0),He=this.glyphOffsetArray.length,Je=Be.vertexLength,tt=this.allowVerticalPlacement&&S===Vh.vertical?Math.PI/2:0,It=x.text&&x.text.sections;for(let Zt=0;Zt<a.length;Zt++){const{tl:Yt,tr:li,bl:ui,br:ri,texPrimary:si,texSecondary:zt,pixelOffsetTL:Dt,pixelOffsetBR:ai,minFontScaleX:Ti,minFontScaleY:pi,glyphOffset:dn,isSDF:Gi,sectionIndex:Ki}=a[Zt],cn=Be.vertexLength,yr=dn[1];if(f1(Ee,L.x,L.y,Yt.x,yr+Yt.y,si.x,si.y,u,Gi,Dt.x,Dt.y,Ti,pi),f1(Ee,L.x,L.y,li.x,yr+li.y,si.x+si.w,si.y,u,Gi,ai.x,Dt.y,Ti,pi),f1(Ee,L.x,L.y,ui.x,yr+ui.y,si.x,si.y+si.h,u,Gi,Dt.x,ai.y,Ti,pi),f1(Ee,L.x,L.y,ri.x,yr+ri.y,si.x+si.w,si.y+si.h,u,Gi,ai.x,ai.y,Ti,pi),R){const{x:yi,y:un,z:Yn}=R.anchor,[Ur,jr,cr]=R.up;p1(ke,yi,un,Yn,Ur,jr,cr),p1(ke,yi,un,Yn,Ur,jr,cr),p1(ke,yi,un,Yn,Ur,jr,cr),p1(ke,yi,un,Yn,Ur,jr,cr),nx(t.dynamicLayoutVertexArray,yi,un,Yn,tt)}else nx(t.dynamicLayoutVertexArray,L.x,L.y,L.z,tt);if(he){const yi=zt||si;d1(t.iconTransitioningVertexArray,yi.x,yi.y),d1(t.iconTransitioningVertexArray,yi.x+yi.w,yi.y),d1(t.iconTransitioningVertexArray,yi.x,yi.y+yi.h),d1(t.iconTransitioningVertexArray,yi.x+yi.w,yi.y+yi.h)}xe.emplaceBack(cn,cn+1,cn+2),xe.emplaceBack(cn+1,cn+2,cn+3),Be.vertexLength+=4,Be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dn[0]),Zt!==a.length-1&&Ki===a[Zt+1].sectionIndex||t.programConfigurations.populatePaintArrays(Ee.length,x,x.index,{},X,Z,ne,It&&It[Ki],this.worldview)}const ut=_e-a.length;ut!==0&&this._addNullVertices(ut,Ee,u,R,ke,t,he,Be,xe);const Ot=R?R.anchor:L;t.placedSymbolArray.emplaceBack(Ot.x,Ot.y,Ot.z,L.x,L.y,He,this.glyphOffsetArray.length-He,Je,F,U,L.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],S,0,0,0,G,0),t.symbolInstanceIndices.push(ce)}_addNullVertices(t,a,u,d,_,x,S,R,L){for(let F=0;F<t;F++){for(let G=0;G<4;G++)f1(a,0,0,0,0,0,0,u,!1,0,0,0,0),d&&p1(_,0,0,0,0,0,0),nx(x.dynamicLayoutVertexArray,0,0,0,0),S&&d1(x.iconTransitioningVertexArray,0,0);const U=R.vertexLength;L.emplaceBack(U,U+1,U+2),L.emplaceBack(U+1,U+2,U+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(t,a,u,d,_,x,S){t.emplaceBack(a,u,d,_,x,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(t,a,u,d,_,x,S){const R=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),L=R.vertexLength,F=S.tileAnchorX,U=S.tileAnchorY;for(let X=0;X<4;X++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,t.padding,S.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,_,x,F,U,new Xt(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,_,x,F,U,new Xt(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,_,x,F,U,new Xt(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,_,x,F,U,new Xt(t.x1,t.y2)),R.vertexLength+=4;const G=u.indexArray;G.emplaceBack(L,L+1),G.emplaceBack(L+1,L+2),G.emplaceBack(L+2,L+3),G.emplaceBack(L+3,L),R.primitiveLength+=4}_addTextDebugCollisionBoxes(t,a,u,d,_,x){for(let S=d;S<_;S++){const R=u.get(S),L=this.getSymbolInstanceTextSize(t,x,a,S);this._addCollisionDebugVertices(R,L,this.textCollisionBox,R.projectedAnchorX,R.projectedAnchorY,R.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(t,a,u,d,_,x){for(let S=d;S<_;S++){const R=u.get(S),L=this.getSymbolInstanceIconSize(t,a,x.placedIconSymbolIndex);this._addCollisionDebugVertices(R,L,this.iconCollisionBox,R.projectedAnchorX,R.projectedAnchorY,R.projectedAnchorZ,x)}}generateCollisionDebugBuffers(t,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new KE(Cf,kD.members,Jl),this.iconCollisionBox=new KE(Cf,kD.members,Jl);const d=Qy(this.iconSizeData,t),_=Qy(this.textSizeData,t,u);for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(_,t,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(_,t,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,t,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,t,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(t,a,u,d){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),x=GE(this.textSizeData,t,_)/ko;return this.tilePixelRatio*x}getSymbolInstanceIconSize(t,a,u){const d=this.icon.placedSymbolArray.get(u),_=GE(this.iconSizeData,t,d);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(t,a,u,d){t.emplaceBack(a,-u,-u,d),t.emplaceBack(a,u,-u,d),t.emplaceBack(a,u,u,d),t.emplaceBack(a,-u,u,d)}_updateTextDebugCollisionBoxes(t,a,u,d,_,x,S){for(let R=d;R<_;R++){const L=u.get(R),F=this.getSymbolInstanceTextSize(t,x,a,R);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,L.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(t,a,u,d,_,x,S){for(let R=d;R<_;R++){const L=u.get(R),F=this.getSymbolInstanceIconSize(t,a,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,F,L.padding,x.zOffset)}}updateCollisionDebugBuffers(t,a,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=Qy(this.iconSizeData,t,d),x=Qy(this.textSizeData,t,u);for(let S=0;S<this.symbolInstances.length;S++){const R=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(x,t,a,R.textBoxStartIndex,R.textBoxEndIndex,R,u),this._updateTextDebugCollisionBoxes(x,t,a,R.verticalTextBoxStartIndex,R.verticalTextBoxEndIndex,R,u),this._updateIconDebugCollisionBoxes(_,t,a,R.iconBoxStartIndex,R.iconBoxEndIndex,R,d),this._updateIconDebugCollisionBoxes(_,t,a,R.verticalIconBoxStartIndex,R.verticalIconBoxEndIndex,R,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,a,u,d,_,x,S,R,L){const F={};if(a<u){const{x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee,featureIndex:ke}=t.get(a);F.textBox={x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee},F.textFeatureIndex=ke}if(d<_){const{x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee,featureIndex:ke}=t.get(d);F.verticalTextBox={x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee},F.verticalTextFeatureIndex=ke}if(x<S){const{x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee,featureIndex:ke}=t.get(x);F.iconBox={x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee},F.iconFeatureIndex=ke}if(R<L){const{x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee,featureIndex:ke}=t.get(R);F.verticalIconBox={x1:U,y1:G,x2:X,y2:Z,padding:ne,projectedAnchorX:he,projectedAnchorY:ce,projectedAnchorZ:_e,tileAnchorX:xe,tileAnchorY:Ee},F.verticalIconFeatureIndex=ke}return F}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,a){const u=t.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let _=u.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),u=Math.cos(t),d=[],_=[],x=[];for(let S=0;S<this.symbolInstances.length;++S){x.push(S);const R=this.symbolInstances.get(S);d.push(0|Math.round(a*R.tileAnchorX+u*R.tileAnchorY)),_.push(R.featureIndex)}return x.sort(((S,R)=>d[S]-d[R]||_[R]-_[S])),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:L}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&x!==_&&x!==d&&this.addIndicesForPlacedSymbol(this.text,x),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(t){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[t]).elevationFeatureIndex;let u;return this.elevationFeatures&&a<this.elevationFeatures.length&&(u=this.elevationFeatures[a]),u}}function SL(o,t){return t.replace(/{([^{}]+)}/g,((a,u)=>u in o?String(o[u]):""))}let TL,ML,$E;oi(gS,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),gS.addDynamicAttributes=nx;class EL{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:uc,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}oi(EL,"FormatSectionOverride",{omit:["defaultValue"]});const JE=()=>$E||($E={layout:TL||(TL=new Ys({"symbol-placement":new fi(dt.layout_symbol["symbol-placement"]),"symbol-spacing":new fi(dt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new fi(dt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mi(dt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new fi(dt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new fi(dt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new fi(dt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new fi(dt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new fi(dt.layout_symbol["icon-ignore-placement"]),"icon-optional":new fi(dt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new fi(dt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mi(dt.layout_symbol["icon-size"]),"icon-size-scale-range":new fi(dt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Mi(dt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mi(dt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mi(dt.layout_symbol["icon-image"]),"icon-image-use-theme":new fi({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Mi(dt.layout_symbol["icon-rotate"]),"icon-padding":new fi(dt.layout_symbol["icon-padding"]),"icon-keep-upright":new fi(dt.layout_symbol["icon-keep-upright"]),"icon-offset":new Mi(dt.layout_symbol["icon-offset"]),"icon-anchor":new Mi(dt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new fi(dt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new fi(dt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new fi(dt.layout_symbol["text-rotation-alignment"]),"text-field":new Mi(dt.layout_symbol["text-field"]),"text-font":new Mi(dt.layout_symbol["text-font"]),"text-size":new Mi(dt.layout_symbol["text-size"]),"text-size-scale-range":new fi(dt.layout_symbol["text-size-scale-range"]),"text-max-width":new Mi(dt.layout_symbol["text-max-width"]),"text-line-height":new Mi(dt.layout_symbol["text-line-height"]),"text-letter-spacing":new Mi(dt.layout_symbol["text-letter-spacing"]),"text-justify":new Mi(dt.layout_symbol["text-justify"]),"text-radial-offset":new Mi(dt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new fi(dt.layout_symbol["text-variable-anchor"]),"text-anchor":new Mi(dt.layout_symbol["text-anchor"]),"text-max-angle":new fi(dt.layout_symbol["text-max-angle"]),"text-writing-mode":new fi(dt.layout_symbol["text-writing-mode"]),"text-rotate":new Mi(dt.layout_symbol["text-rotate"]),"text-padding":new fi(dt.layout_symbol["text-padding"]),"text-keep-upright":new fi(dt.layout_symbol["text-keep-upright"]),"text-transform":new Mi(dt.layout_symbol["text-transform"]),"text-offset":new Mi(dt.layout_symbol["text-offset"]),"text-allow-overlap":new fi(dt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new fi(dt.layout_symbol["text-ignore-placement"]),"text-optional":new fi(dt.layout_symbol["text-optional"]),visibility:new fi(dt.layout_symbol.visibility)})),paint:ML||(ML=new Ys({"icon-opacity":new Mi(dt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Mi(dt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Mi(dt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Mi(dt.paint_symbol["text-emissive-strength"]),"icon-color":new Mi(dt.paint_symbol["icon-color"]),"icon-halo-color":new Mi(dt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mi(dt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mi(dt.paint_symbol["icon-halo-blur"]),"icon-translate":new fi(dt.paint_symbol["icon-translate"]),"icon-translate-anchor":new fi(dt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new fi(dt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Mi(dt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Mi(dt.paint_symbol["text-occlusion-opacity"]),"text-color":new Mi(dt.paint_symbol["text-color"],{runtimeType:nl,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Mi(dt.paint_symbol["text-halo-color"]),"text-halo-width":new Mi(dt.paint_symbol["text-halo-width"]),"text-halo-blur":new Mi(dt.paint_symbol["text-halo-blur"]),"text-translate":new fi(dt.paint_symbol["text-translate"]),"text-translate-anchor":new fi(dt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new fi(dt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new fi(dt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new fi(dt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new fi(dt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Mi(dt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},$E);class _S extends wo{constructor(t,a,u,d){super(t,JE(),a,u,d,t.layout?t.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=ie([]),this.hasOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}_handleSpecialPaintPropertyUpdate(t){t!=="icon-occlusion-opacity"&&t!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(t,a){super.recalculate(t,a),this.appearances&&this.appearances.forEach((d=>{d.recalculate(t,a,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const _ of u)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,a,u,d){return this._saturation===t&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(_,x,S,R){_=or(_),x=Cn(x);const L=$(),F=_/3,U=1-2*F,G=[U,F,F,0,F,U,F,0,F,F,U,0,0,0,0,1],X=.5-.5*x,Z=R-S;return ae(L,[Z,0,0,0,0,Z,0,0,0,0,Z,0,S,S,S,1],[x,0,0,0,0,x,0,0,0,0,x,0,X,X,X,1]),ae(L,L,G),L})(t,a,u,d),this._saturation=t,this._contrast=a,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,a,u,d){const _=this.layout.get(t).evaluate(a,{},u,d),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||_d(x.value)||!_?_:SL(a.properties,_)}getAppearanceValueAndResolveTokens(t,a,u,d,_){const x=t.getProperty(a);if(!x)return;const S=x.evaluate(u,{},d,_),R=t.getUnevaluatedProperties()._values[a];return R.isDataDriven()||_d(R.value)||!S||typeof S!="string"?S:SL(u.properties,S)}createBucket(t){return new gS(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of JE().paint.overridableProperties){if(!_S.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),u=new EL(a),d=new ap(u,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new La("source",d):new Oo("composite",d,a.value.zoomStops,a.value.interpolationType),this.paint._values[t]=new Oh(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&_S.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const u=t.get("text-field"),d=JE().paint.properties[a];let _=!1;const x=S=>{for(const R of S)if(d.overrides&&d.overrides.hasOverride(R))return void(_=!0)};if(u.value.kind==="constant"&&u.value.value instanceof xo)x(u.value.value.sections);else if(u.value.kind==="source"){const S=L=>{_||(L instanceof Dc&&Xs(L.value)===Wd?x(L.value.sections):L instanceof El?x(L.sections):L.eachChild(S))},R=u.value;R._styleExpression&&S(R._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,a,u){return{config:new Ao(this,{zoom:a,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let AL,CL,RL,IL;var QE=vr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function yS(o,t,a,u,d,_,x,S){const R=[o,t,1,a,u,1,d,_,1],L=[x,S,1],F=k([],R),[U,G,X]=Vi(L,L,F);return j(R,R,[U,0,0,0,G,0,0,0,X])}function DL(o,t,a,u,d,_,x,S){const R=(function(L,F,U,G,X,Z,ne,he){const ce=yS(0,0,1,0,1,1,0,1),_e=yS(L,F,U,G,X,Z,ne,he);return j(_e,_e,k([],ce))})(o,t,a,u,d,_,x,S);return[R[2]/R[8]/gi,R[5]/R[8]/gi]}function xS(o){return[o[0],Math.min(Math.max(o[1],-ee),ee)]}class LL extends of{constructor(t,a,u,d){super(),this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=a,this._dirty=!1}load(t,a){if(this._loaded=a||!1,this.fire(new Ml("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=rf(this.map._requestManager.transformRequest(this.url,ru.Image),((u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Mh(u)):d&&(this.image=d instanceof HTMLImageElement?xs.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Jv(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ml("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Jv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=t[0][1],u=t[0][1];for(const _ of t)_[1]>u&&(u=_[1]),_[1]<a&&(a=_[1]);const d=(u+a)/2;if(d>ee?this.onNorthPole=!0:d<-ee&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=t.map(be.fromLngLat);this.tileID=(function(x){let S=1/0,R=1/0,L=-1/0,F=-1/0;for(const ne of x)S=Math.min(S,ne.x),R=Math.min(R,ne.y),L=Math.max(L,ne.x),F=Math.max(F,ne.y);const U=Math.max(L-S,F-R),G=Math.max(0,Math.floor(-Math.log2(U))),X=Math.pow(2,G);let Z=Math.floor((S+L)/2*X);return Z>1&&(Z-=1),new Yr(G,Z,Math.floor((R+F)/2*X))})(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ml("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Jv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const ce in this.tiles){const _e=this.tiles[ce];_e.state!=="loaded"&&(_e.state="loaded",_e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=o1(new Yr(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(ce){const _e=ce[1].x-ce[0].x,xe=ce[1].y-ce[0].y,Ee=ce[2].x-ce[1].x,ke=ce[2].y-ce[1].y,Be=ce[3].x-ce[2].x,He=ce[3].y-ce[2].y,Je=ce[0].x-ce[3].x,tt=ce[0].y-ce[3].y,It=_e*ke-Ee*xe,ut=Ee*He-Be*ke,Ot=Be*tt-Je*He,Zt=Je*xe-_e*tt;return It>0&&ut>0&&Ot>0&&Zt>0||It<0&&ut<0&&Ot<0&&Zt<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=o1(this.tileID,this.map.transform.projection),[_,x,S,R]=this.coordinates.map((ce=>{const _e=d.projection.project(ce[0],ce[1]);return _L(d,_e)._round()}));this.perspectiveTransform=DL(_.x,_.y,x.x,x.y,S.x,S.y,R.x,R.y);const L=this._boundsArray=new Sd;L.emplaceBack(_.x,_.y,0,0),L.emplaceBack(x.x,x.y,gi,0),L.emplaceBack(R.x,R.y,0,gi),L.emplaceBack(S.x,S.y,gi,gi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(L,QE.members),this.boundsSegments=Es.simpleSegment(0,0,4,2);const F=[],U=[xS((G=this.coordinates)[0]),xS(G[1]),xS(G[2]),xS(G[3])];var G;const[X,Z,ne,he]=(function(ce){let _e=ce[0][0],xe=_e,Ee=ce[0][1],ke=Ee;for(let Be=1;Be<ce.length;Be++)ce[Be][0]<_e?_e=ce[Be][0]:ce[Be][0]>xe&&(xe=ce[Be][0]),ce[Be][1]<Ee?Ee=ce[Be][1]:ce[Be][1]>ke&&(ke=ce[Be][1]);return[_e,Ee,xe-_e,ke-Ee]})(U);{const ce=new Sd,[_e,xe,Ee,ke]=(function(ri){let si=ri[0].x,zt=si,Dt=ri[0].y,ai=Dt;for(let Ti=1;Ti<ri.length;Ti++)ri[Ti].x<si?si=ri[Ti].x:ri[Ti].x>zt&&(zt=ri[Ti].x),ri[Ti].y<Dt?Dt=ri[Ti].y:ri[Ti].y>ai&&(ai=ri[Ti].y);return[si,Dt,zt-si,ai-Dt]})(u),Be=ri=>[(ri.x-_e)/Ee,(ri.y-xe)/ke],[He,Je,tt,It]=u.map(Be),ut=(function(ri,si,zt,Dt,ai,Ti,pi,dn){const Gi=yS(0,0,1,0,1,1,0,1);return j(Gi,Gi,k([],yS(ri,si,zt,Dt,ai,Ti,pi,dn)))})(He[0],He[1],Je[0],Je[1],tt[0],tt[1],It[0],It[1]);this.elevatedGlobePerspectiveTransform=DL(He[0],He[1],Je[0],Je[1],tt[0],tt[1],It[0],It[1]);const Ot=(ri,si)=>{F.push(ri.lng);const zt=Math.round((ri.lng-X)/ne*gi),Dt=Math.round((ri.lat-Z)/he*gi),ai=Be(si),Ti=Vi([],[ai[0],ai[1],1],ut),pi=Math.round(Ti[0]/Ti[2]*gi),dn=Math.round(Ti[1]/Ti[2]*gi);ce.emplaceBack(zt,Dt,pi,dn)},Zt=u[3].x-u[0].x,Yt=u[3].y-u[0].y,li=u[2].x-u[1].x,ui=u[2].y-u[1].y;for(let ri=0;ri<65;ri++){const si=ri/64,zt=[u[0].x+si*Zt,u[0].y+si*Yt],Dt=[u[1].x+si*li,u[1].y+si*ui],ai=Dt[0]-zt[0],Ti=Dt[1]-zt[1];for(let pi=0;pi<65;pi++){const dn=pi/64,Gi={x:zt[0]+ai*dn,y:zt[1]+Ti*dn};Ot(a.projection.unproject(Gi.x,Gi.y),Gi)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(ce,QE.members)}{this.maxLongitudeTriangleSize=0;let ce=[],_e=new Aa;const xe=(Ee,ke,Be)=>{_e.emplaceBack(Ee,ke,Be);const He=F[Ee],Je=F[ke],tt=F[Be],It=Math.min(Math.min(He,Je),tt),ut=Math.max(Math.max(He,Je),tt)-It;ut>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ut),ce.push(It+ut/2)};for(let Ee=0;Ee<64;Ee++)for(let ke=0;ke<64;ke++){const Be=65*Ee+ke,He=Be+1,Je=Be+65,tt=Je+1;xe(Be,Je,He),xe(He,Je,tt)}[ce,_e]=(function(Ee,ke){const Be=Array.from({length:Ee.length},((tt,It)=>It));Be.sort(((tt,It)=>Ee[tt]-Ee[It]));const He=[],Je=new Aa;for(let tt=0;tt<Be.length;tt++){const It=Be[tt];He.push(Ee[It]);const ut=3*It,Ot=ut+1;Je.emplaceBack(ke.uint16[ut],ke.uint16[Ot],ke.uint16[Ot+1])}return[He,Je]})(ce,_e),this.elevatedGlobeTrianglesCenterLongitudes=ce,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(_e)}this.elevatedGlobeSegments=Es.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ne/gi,0,he/gi,0,0,Z,X,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof Jv||(this.texture?this.texture.update(this.image):(this.texture=new TE(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(a)}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(_=t+180)+360*Math.round((u[0]-_)/360);var _;const x=new Es,S=(U,G)=>{x.segments.push({vertexOffset:0,primitiveOffset:U,vertexLength:a.segments[0].vertexLength,primitiveLength:G,sortKey:void 0,vaos:{}})},R=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=R){const U=Wn(u,0,u.length,d+R);return U===u.length||S(U,kn(u,U+1,u.length,d+360-R)-U),x}d<u[0]&&(d+=360);const L=kn(u,0,u.length,d-R);if(L===u.length)return S(0,u.length),x;S(0,L-0);const F=Wn(u,L+1,u.length,d+R);return F!==u.length&&S(F,u.length-F),x}}const p8=(Math.pow(256,2)-1)/16907520;class PL extends wo{constructor(t,a,u,d){super(t,{layout:RL||(RL=new Ys({visibility:new fi(dt.layout_raster.visibility)})),paint:IL||(IL=new Ys({"raster-opacity":new fi(dt.paint_raster["raster-opacity"]),"raster-color":new Au(dt.paint_raster["raster-color"]),"raster-color-mix":new fi(dt.paint_raster["raster-color-mix"]),"raster-color-range":new fi(dt.paint_raster["raster-color-range"]),"raster-hue-rotate":new fi(dt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new fi(dt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new fi(dt.paint_raster["raster-brightness-max"]),"raster-saturation":new fi(dt.paint_raster["raster-saturation"]),"raster-contrast":new fi(dt.paint_raster["raster-contrast"]),"raster-resampling":new fi(dt.paint_raster["raster-resampling"]),"raster-fade-duration":new fi(dt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new fi(dt.paint_raster["raster-emissive-strength"]),"raster-array-band":new fi(dt.paint_raster["raster-array-band"]),"raster-elevation":new fi(dt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},a,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof LL&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Rg({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let zL,OL,BL,NL,FL;class UL extends wo{constructor(t,a,u,d){super(t,{layout:zL||(zL=new Ys({visibility:new fi(dt["layout_raster-particle"].visibility)})),paint:OL||(OL=new Ys({"raster-particle-array-band":new fi(dt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new fi(dt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Au(dt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new fi(dt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new fi(dt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new fi(dt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new fi(dt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new fi(dt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},a,u,d),this._updateColorRamp(),this.lastInvalidatedAt=xs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Rg({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=xs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class m8 extends wo{constructor(t,a){super(t,{},a,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function eA(o,t,a){const u=[0,0,1],d=Li([]);return Ei(d,d,a?-Ar(o)+Math.PI:Ar(o)),Wi(d,d,-Ar(t)),st(u,u,d),Ui(u,u)}const kL={None:0,Model:1,Symbol:2,FillExtrusion:4};class vS{constructor(t,a,u,d){this.message=(t?`${t}: `:"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function tA(o,t){const a=o.indexOf("://")===-1;try{return new URL(o,a&&t?"http://example.com":void 0),!0}catch{return!1}}class VL{constructor(t,a){this.feature=t,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class GL{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Ll,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(t){const a=16*t,u=this.instancedDataArray.float32;let d=Math.floor(u[a+2]);const _=1.05*(u[a+2]-d);return d/=100,[u[a]%1*1.05,u[a+1]%1*1.05,_,d]}tileCoordinatesForInstance(t){const a=16*t,u=this.instancedDataArray.float32;let d=u[a+0];return d=d>gi?d-gi:d,new Xt(Math.trunc(d),Math.trunc(u[a+1]))}translationForInstance(t){const a=16*t,u=this.instancedDataArray.float32;return[u[a+4],u[a+5],u[a+6]]}rotationScaleForInstance(t){const a=16*t,u=this.instancedDataArray.float32;return[u[a+7],u[a+8],u[a+9],u[a+10],u[a+11],u[a+12],u[a+13],u[a+14],u[a+15]]}transformForInstance(t){const a=16*t,u=this.instancedDataArray.float32;return[u[a+7],u[a+8],u[a+9],u[a+4],u[a+10],u[a+11],u[a+12],u[a+5],u[a+13],u[a+14],u[a+15],u[a+6],0,0,0,1]}}class iA{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaledZ=this.canonical.z+Math.log2(t.overscaling),this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(t,a){}updateAppearances(t,a,u,d){}populate(t,a,u,d){this.tileToMeter=de(u);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:S,index:R,sourceLayerIndex:L}of t){const F=S??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),U=ct(x,_);if(!this.layers[0]._featureFilter.filter(new ms(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),U,u))continue;const G={id:F,sourceLayerIndex:L,index:R,geometry:_?U.geometry:Ye(x,u,d),properties:x.properties,type:x.type,patterns:{}},X=this.addFeature(G,G.geometry,U);X&&a.featureIndex.insert(x,G.geometry,R,L,this.index,this.instancesPerModel[X].instancedDataArray.length,gi/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const t=this.layers[0].modelManager,a=this.layers[0].scope;let u=0;for(const d of this.modelUris){const _=t.getModel(d,a);if(!_)continue;const x=this.instancesPerModel[d];if(x){const S=.5*ki(_.aabb.max,_.aabb.min)*x.maxScale+x.maxXYTranslationDistance,R=Math.min(gi,Math.max(S/this.tileToMeter,gi/32));u=Math.max(R,u)}}return u}update(t,a,u,d){for(const _ in this.instancesPerModel){const x=this.instancesPerModel[_];for(const S in t)x.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(x.features[x.idToFeaturesIndex[S]],t[S],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const d of u.features){const _=this.layers[0],x=d.feature,S=this.canonical,R=_.paint.get("model-rotation").evaluate(x,{},S),L=_.paint.get("model-scale").evaluate(x,{},S),F=_.paint.get("model-translation").evaluate(x,{},S);Ji(d.rotation,R)&&Ji(d.scale,L)&&Ji(d.translation,F)||(this.evaluate(d,d.featureStates,u,!0),t=!0)}}return t}updateReplacement(t,a,u,d){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(w0(this.activeReplacements,_))return!1;this.activeReplacements=_;let x=!1;for(const S in this.instancesPerModel){const R=this.instancesPerModel[S],L=R.instancedDataArray;for(const F of R.features){const U=F.instancedDataOffset,G=F.instancedDataCount;for(let X=0;X<G;X++){const Z=16*(X+U);let ne=L.float32[Z+0];const he=ne>gi;ne=he?ne-gi:ne;const ce=Math.floor(ne),_e=Math.floor(L.float32[Z+1]);let xe=!1;for(const Ee of this.activeReplacements)if(!b0(Ee,u,kL.Model,d)&&!(Ee.min.x>ce||ce>Ee.max.x||Ee.min.y>_e||_e>Ee.max.y)&&(xe=Vw(jy(ce,_e,t.canonical,Ee.footprintTileId.canonical),Ee.footprint),xe))break;L.float32[Z]=xe?ne+gi:ne,x=x||xe!==he}}}return x}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=t.createVertexBuffer(u.instancedDataArray,FV.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(t){for(const u in this.instancesPerModel){const d=this.instancesPerModel[u];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(t&&a&&this.modelUris&&this.modelsRequested)for(const u of this.modelUris)a.removeModel(u,"",!0)}addFeature(t,a,u){const d=this.layers[0],_=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!_)return ht(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),_;(tA(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new GL);const x=this.instancesPerModel[_],S=x.instancedDataArray,R=new VL(u,S.length);for(const L of a)for(const F of L){if(F.x<0||F.x>=gi||F.y<0||F.y>=gi)continue;if(this.lookupDim!==0){const G=(this.lookupDim-1)/gi,X=this.lookupDim*(F.y*G|0)+F.x*G|0;if(this.lookup){if(this.lookup[X]!==0)continue;this.lookup[X]=1}}this.instanceCount++;const U=S.length;S.resize(U+1),x.instancesEvaluatedElevation.push(0),S.float32[16*U]=F.x,S.float32[16*U+1]=F.y}return R.instancedDataCount=x.instancedDataArray.length-R.instancedDataOffset,R.instancedDataCount>0&&(t.id&&(x.idToFeaturesIndex[t.id]=x.features.length),x.features.push(R),this.evaluate(R,{},x,!1)),_}getModelUris(){return this.modelUris}evaluate(t,a,u,d){const _=this.layers[0],x=t.feature,S=this.canonical,R=t.rotation=_.paint.get("model-rotation").evaluate(x,a,S),L=t.scale=_.paint.get("model-scale").evaluate(x,a,S),F=t.translation=_.paint.get("model-translation").evaluate(x,a,S),U=Object.assign({},_.paint.get("model-color").evaluate(x,a,S));U.a=_.paint.get("model-color-mix-intensity").evaluate(x,a,S);const G=[];this.maxVerticalOffset<F[2]&&(this.maxVerticalOffset=F[2]);const X=F[0]*F[0]+F[1]*F[1],Z=X>0?Math.sqrt(X):0;u.maxScale=Math.max(Math.max(u.maxScale,L[0]),Math.max(L[1],L[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,Z),this.maxScale=Math.max(Math.max(this.maxScale,L[0]),Math.max(L[1],L[2])),xD(G,R,L);const ne=Math.round(100*U.a)+U.b/1.05;for(let he=0;he<t.instancedDataCount;++he){const ce=t.instancedDataOffset+he,_e=16*ce,xe=u.instancedDataArray.float32;let Ee=0;d&&(Ee=xe[_e+6]-u.instancesEvaluatedElevation[ce]);const ke=0|xe[_e+1];xe[_e]=(0|xe[_e])+U.r/1.05,xe[_e+1]=ke+U.g/1.05,xe[_e+2]=ne,xe[_e+3]=1/(S.z>10?this.tileToMeter:de(S,ke)),xe[_e+4]=F[0],xe[_e+5]=F[1],xe[_e+6]=F[2]+Ee,xe[_e+7]=G[0],xe[_e+8]=G[1],xe[_e+9]=G[2],xe[_e+10]=G[4],xe[_e+11]=G[5],xe[_e+12]=G[6],xe[_e+13]=G[8],xe[_e+14]=G[9],xe[_e+15]=G[10],u.instancesEvaluatedElevation[ce]=F[2]}}}let HL,jL;oi(iA,"ModelBucket",{omit:["layers"]}),oi(GL,"PerModelAttributes"),oi(VL,"ModelFeature");class rx{constructor(t,a,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(t,a,u){const d=u||t.findDEMTileFor(a);if(!d||!d.dem)return;const _=d.dem,x=d.tileID,S=1<<a.canonical.z-x.canonical.z;return new rx(d,_.dim/gi/S,[(a.canonical.x/S-x.canonical.x)*_.dim,(a.canonical.y/S-x.canonical.y)*_.dim])}tileCoordToPixel(t,a){const u=a*this._scale+this._offset[1];return new Xt(Math.floor(t*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(t,a,u,d){const _=t*this._scale+this._offset[0],x=a*this._scale+this._offset[1],S=Math.floor(_),R=Math.floor(x),L=this._dem;return d=!!d,u?Rn(Rn(L.get(S,R,d),L.get(S,R+1,d),x-R),Rn(L.get(S+1,R,d),L.get(S+1,R+1,d),x-R),_-S):L.get(S,R,d)}getElevationAtPixel(t,a,u){return this._dem.get(t,a,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*V(1,t)*this._dem.stride}}const nA=new Float32Array(262144),O0=new Uint8Array(262144);function qL(o){let t=0;if(o.meshes)for(const a of o.meshes)t=Math.max(t,a.aabb.max[2]);if(o.children)for(const a of o.children)t=Math.max(t,qL(a));return t}function XL(o,t,a){if(o.meshes)for(const u of o.meshes){if(u.aabb.min[0]===1/0)continue;const d=Yi.applyTransform(u.aabb,o.globalMatrix);a.insert(t,d.min[0],d.min[1],d.max[0],d.max[1])}if(o.children)for(const u of o.children)XL(u,t,a)}const WL=["","wall","door","roof","window","lamp","logo"];class ZL{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:qL(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const a=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==t&&(u.transformedAabb=Yi.applyTransformFast(u.aabb,this.node.globalMatrix),a.encapsulate(u.transformedAabb)),t++;this.aabb=a}return this.aabb}}class bS{constructor(t,a,u,d,_,x,S,R){this.id=u,this.layers=t,this.layerIds=this.layers.map((L=>L.fqid)),this.stateDependentLayerIds=this.layers.filter((L=>L.isStateDependent())).map((L=>L.id)),this.modelTraits|=Yy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Yy.HasMapboxMeshFeatures),_&&(this.modelTraits|=Yy.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.worldview=R,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const L of a)this.nodesInfo.push(new ZL(L)),XL(L,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(t,a){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&a.push({footprint:d.footprint,id:t})}}updateAppearances(t,a,u,d){}update(t){const a=Object.keys(t).length!==0;if(a&&!this.stateDependentLayers.length)return;const u=a?this.stateDependentLayers:this.layers;if(!ja(t,this.states))for(const d of u)this.evaluate(d,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const d=u.node;this.uploaded?this.updatePbrBuffer(d):AE(d,t,!0)}for(const u of a)iS(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let a=!1;if(!t.meshes)return a;for(const u of t.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(t,a,u){const d=t.transform.projectionOptions,_=t.style.getBrightness(),x=this.brightness!==_;if(!this.uploaded||this.dirty||d.name!==this.projection.name||m1(u.paint.get("model-color").value,x)||m1(u.paint.get("model-color-mix-intensity").value,x)||m1(u.paint.get("model-roughness").value,x)||m1(u.paint.get("model-emissive-strength").value,x)||m1(u.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=d,this.brightness=_;const S=this.getNodesInfo();for(const R of S)R.state=null;return!0}return!1}evaluateTransform(t,a){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const _ of u){const x=_.feature;_.evaluatedTranslation=a.paint.get("model-translation").evaluate(x,{},d),_.evaluatedScale=a.paint.get("model-scale").evaluate(x,{},d)}}evaluate(t,a){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const _=d.feature,x=a&&a[_.id];if(ja(x,d.state))continue;d.state=structuredClone(x);const S=d.node.meshes&&d.node.meshes[0].featureData,R=d.evaluatedColor[2],L=d.evaluatedRMEA[2],F=this.id.canonical;if(d.hasTranslucentParts=!1,S){for(let U=0;U<WL.length;U++){const G=WL[U];G.length&&(_.properties.part=G);const X=t.paint.get("model-color").evaluate(_,x,F).toPremultipliedRenderColor(null),Z=t.paint.get("model-color-mix-intensity").evaluate(_,x,F);d.evaluatedColor[U]=[X.r,X.g,X.b,Z],d.evaluatedRMEA[U][0]=t.paint.get("model-roughness").evaluate(_,x,F),d.evaluatedRMEA[U][2]=t.paint.get("model-emissive-strength").evaluate(_,x,F),d.evaluatedRMEA[U][3]=X.a,d.emissionHeightBasedParams[U]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,x,F),!d.hasTranslucentParts&&X.a<1&&(d.hasTranslucentParts=!0)}delete _.properties.part,_8(d,R!==d.evaluatedColor[2]||L!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(_,x,F);d.evaluatedTranslation=t.paint.get("model-translation").evaluate(_,x,F),d.evaluatedScale=t.paint.get("model-scale").evaluate(_,x,F),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,a,u,d){const _=t.findDEMTileFor(u);if(_&&(_.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const x=rx.create(t,u,_);if(!x)return;this.modelTraits&Yy.HasMapboxMeshFeatures&&this.updateDEM(t,x,u,d);for(const S of this.getNodesInfo()){const R=S.node;if(!R.footprint||!R.footprint.vertices||!R.footprint.vertices.length)continue;const L=R.footprint.vertices;let F=x.getElevationAt(L[0].x,L[0].y,!0,!0);for(let U=1;U<L.length;U++)F=Math.min(F,x.getElevationAt(L[U].x,L[U].y,!0,!0));R.elevation=F}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=a}}updateDEM(t,a,u,d){let _=a._dem._modifiedForSources[d];if(_===void 0&&(a._dem._modifiedForSources[d]=[],_=a._dem._modifiedForSources[d]),_.includes(u.canonical))return;const x=a._dem.dim;_.push(u.canonical);let S=!1;for(const R of this.getNodesInfo()){const L=R.node;if(!L.footprint||!L.footprint.grid)continue;const F=L.footprint.grid,U=a.tileCoordToPixel(F.min.x,F.min.y),G=a.tileCoordToPixel(F.max.x,F.max.y),X=Math.min(Math.min(x-G.y,U.x),Math.min(U.y,x-G.x));if(X<0)continue;const Z=oe(X,2,5);let ne=Math.max(0,U.x-Z),he=Math.max(0,U.y-Z),ce=Math.min(G.x+Z,x-1),_e=Math.min(G.y+Z,x-1);for(let Be=he;Be<=_e;++Be)for(let He=ne;He<=ce;++He)O0[Be*x+He]=255;let xe=0,Ee=0;for(let Be=0;Be<F.cellsY;++Be)for(let He=0;He<F.cellsX;++He){if(!F.cells[Be*F.cellsX+He])continue;const Je=a.tileCoordToPixel(F.min.x+He/F.xScale,F.min.y+Be/F.yScale),tt=a.tileCoordToPixel(F.min.x+(He+1)/F.xScale,F.min.y+(Be+1)/F.yScale);for(let It=Je.y;It<=Math.min(tt.y+1,x-1);++It)for(let ut=Je.x;ut<=Math.min(tt.x+1,x-1);++ut)O0[It*x+ut]===255&&(O0[It*x+ut]=0,xe+=a.getElevationAtPixel(ut,It),Ee++)}const ke=xe/Ee;ne=Math.max(1,U.x-Z),he=Math.max(1,U.y-Z),ce=Math.min(G.x+Z,x-2),_e=Math.min(G.y+Z,x-2),S=!0;for(let Be=he;Be<=_e;++Be)for(let He=ne;He<=ce;++He)O0[Be*x+He]===0&&(nA[Be*x+He]=a._dem.set(He,Be,ke));for(let Be=1;Be<Z;++Be){ne=Math.max(1,U.x-Be),he=Math.max(1,U.y-Be),ce=Math.min(G.x+Be,x-2),_e=Math.min(G.y+Be,x-2);for(let He=he;He<=_e;++He)for(let Je=ne;Je<=ce;++Je){const tt=He*x+Je;if(O0[tt]===255){let It=0,ut=0,Ot=-1,Zt=-1;for(let Yt=-1;Yt<=1;++Yt)for(let li=-1;li<=1;++li){const ui=(He+Yt)*x+Je+li;if(O0[ui]>=Be)continue;const ri=nA[ui],si=Math.abs(ri);si>ut&&(It=ri,ut=si,Ot=li,Zt=Yt)}if(ut>.1){const Yt=1-(Be+.5*Math.abs(Ot*Zt))/Z;let li=a._dem.get(Je,He)+It*Yt;const ui=a._dem.get(Je+Ot,He+Zt),ri=a._dem.get(Je-Ot,He-Zt,!0);(li-ui)*(li-ri)>0&&(li=(ui+ri)/2),nA[tt]=a._dem.set(Je,He,li),O0[tt]=Be}}}}}S&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=xs.now())}setFilter(t){this.filter=t?xd(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((t=>this.filter.filter(new ms(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical))):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const a of t)iS(a.node),CE(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(t.toUnwrapped());for(const d of this.getNodesInfo()){const _=d.node.footprint;d.hiddenByReplacement=!!_&&!u.find((x=>x.footprint===_))}}getHeightAtTileCoord(t,a){const u=[],d=[0,0,0],_=ie([]);for(const x of this.getNodesInfo()){const S=x.node.meshes[0],R=S.transformedAabb;if(t<R.min[0]||a<R.min[1]||t>R.max[0]||a>R.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};Y(_,x.node.globalMatrix),d[0]=t,d[1]=a,xn(d,d,_);const L=(d[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*L0|0,F=Math.min(63,(d[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*L0|0)*L0+Math.min(63,L),U=S.heightmap[F];if(!(U<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:U,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new Xt(t,a),new Xt(t,a),u),u.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function m1(o,t){return o instanceof La&&!o.isLightConstant&&t}function g8(o,t,a,u,d,_,x,S){let R=(61440&t|(61440&t)>>4)>>8,L=(3840&t|(3840&t)>>4)>>4,F=240&t|(240&t)>>4;a[3]>0&&(R=Rn(R,255*a[0],a[3]),L=Rn(L,255*a[1],a[3]),F=Rn(F,255*a[2],a[3]));const U=R<<8|L,G=F<<8|Math.floor(255*u[3]),X=(function(Be){const He=oe(Be,0,2);return Math.min(Math.round(.5*He*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],Z=oe(d[0],0,1),ne=oe(d[1],0,1),he=oe(d[2],0,1),ce=oe(d[3],0,1);let _e,xe,Ee,ke;if(Z!==ne&&x!==_&&ne!==Z){const Be=x-_;xe=1/(Be*(ne-Z)),Ee=-(_+Be*Z)/(Be*(ne-Z));const He=oe(d[4],-1,1);ke=Math.pow(10,He),_e=255*he<<8|255*ce}else _e=65535,xe=0,Ee=1,ke=1;if(o.emplaceBack(U,G,X,_e,xe,Ee,ke),S){const Be=S.length;S.clear();for(let He=0;He<Be;He++)S.emplaceBack(U,G,X,_e,xe,Ee,ke)}}function _8(o,t,a){const u=o.node;let d=0;const _=a&Yy.HasMeshoptCompression;for(const x of u.meshes){if(u.lights&&u.lightMeshIndex===d||!x.featureData)continue;x.featureArray=new Ad,x.featureArray.reserve(x.featureData.length);let S=t;for(const R of x.featureData){const L=_?65535&R:R>>16&65535,F=_?R>>16&65535:65535&R,U=(15&F)<8?15&F:0,G=o.evaluatedRMEA[U],X=o.evaluatedColor[U],Z=o.emissionHeightBasedParams[U];let ne;if(S&&U===2&&u.lights&&(ne=new Ad,ne.resize(10*u.lights.length)),g8(x.featureArray,L,X,G,Z,x.aabb.min[2],x.aabb.max[2],ne),ne&&S){S=!1;const he=u.meshes[u.lightMeshIndex];he.featureArray=ne,he.featureArray._trim()}}x.featureArray._trim(),d++}}oi(bS,"Tiled3dModelBucket",{omit:["layers"]}),oi(ZL,"Tiled3dModelFeature");const y8=["id","tile","layer","source","sourceLayer","state"];class B0{constructor(t,a,u,d,_){this.type="Feature",this._vectorTileFeature=t,this._z=a,this._x=u,this._y=d,this.properties=t?t.properties:{},this.id=_}clone(){const t=new B0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of y8)this[a]!==void 0&&(t[a]=this[a]);return t}}class N0 extends of{constructor(t,a,u,d){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=a,this._modelsInfo=new Map}load(){const t=[];for(const a in this._options.models){const u=this._options.models[a],d=this._modelsInfo.get(a);if(d){const _=d.model;_.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),_.orientation=u.orientation!=null?u.orientation:[0,0,0],d.modelSpec=u,N0.applyModelSpecification(_,u),_.computeBoundsAndApplyParent(),this.models.push(_)}else{const _=mD(this.map._requestManager.transformRequest(u.uri,ru.Model).url).then((x=>{if(!x)return;const S=IE(x),R=new vD(a,u.uri,u.position,u.orientation,S);N0.applyModelSpecification(R,u),R.computeBoundsAndApplyParent(),this.models.push(R),this._modelsInfo.set(a,{modelSpec:u,model:R})})).catch((x=>{this.fire(new Mh(new Error(`Could not load model ${a} from ${u.uri}: ${x.message}`)))}));t.push(_)}}Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new Ml("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((a=>{this._loaded=!0,this.fire(new Mh(new Error(`Could not load models: ${a.message}`)))}))}static applyModelSpecification(t,a){a.nodeOverrides&&N0.convertNodeOverrides(t,a.nodeOverrides),a.materialOverrides&&N0.convertMaterialOverrides(t,a.materialOverrides),a.nodeOverrideNames&&(t.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(t.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(t.featureProperties=a.featureProperties)}static convertNodeOverrides(t,a){if(Array.isArray(a)&&a.every((u=>typeof u=="string"))){t.nodeOverrideNames=[];for(const u of a)t.nodeOverrideNames.push(u)}else Object.entries(a).forEach((([u,d])=>{const _={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const x=d.orientation;x&&(_.orientation=x)}t.nodeOverrides.set(u,_)}))}static convertMaterialOverrides(t,a){if(Array.isArray(a)&&a.every((u=>typeof u=="string"))){t.materialOverrideNames=[];for(const u of a)t.materialOverrideNames.push(u)}else Object.entries(a).forEach((([u,d])=>{const _={color:new qr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},x=d["model-color"];x!==void 0&&(_.color.r=x[0],_.color.g=x[1],_.color.b=x[2]);const S=d["model-color-mix-intensity"];S!==void 0&&(_.colorMix=S);const R=d["model-emissive-strength"];R!==void 0&&(_.emissionStrength=R);const L=d["model-opacity"];L!==void 0&&(_.opacity=L),t.materialOverrides.set(u,_)}))}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,a){}serialize(){return this._options}setProperty(t,a){return!1}reload(){const t=gc(this.id,this.scope);this.map.style.clearSource(t),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(t){this.models=[];const a=new Map;for(const u in t){const d=t[u];if(this._modelsInfo.has(u)){const _=this._modelsInfo.get(u);_&&_.modelSpec.uri===d.uri&&a.set(u,_)}}this._modelsInfo=a,this._options.models=t,this._loaded=!1,this.load()}}function rA(o,t,a,u){const d=1<<o.z;t.lat=Q((u/gi+o.y)/d),t.lng=H((a/gi+o.x)/d)}function x8(o,t,a,u){const d=o.getNodesInfo()[t];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let _=Number.MAX_VALUE;const x=d.node,S=a.tile,R=u.calculatePosMatrix(S.tileID.toUnwrapped(),u.worldSize),L=d.evaluatedScale;let F=0;u.elevation&&x.elevation&&(F=x.elevation*u.elevation.exaggeration()),ue(R,R,[(x.anchor?x.anchor[0]:0)*(L[0]-1),(x.anchor?x.anchor[1]:0)*(L[1]-1),F]),me(R,R,L);const U=a.queryGeometry,G=U.isPointQuery()?U.screenBounds:U.screenGeometry,X=function(ne){const he=ae([],R,ne.globalMatrix);ae(he,u.expandedFarZProjMatrix,he);for(let ce=0;ce<ne.meshes.length;++ce){const _e=ne.meshes[ce];if(ce===ne.lightMeshIndex)continue;const xe=EE(G,u,he,_e.aabb);xe!=null&&(_=Math.min(xe,_))}if(ne.children)for(const ce of ne.children)X(ce)};if(X(x),_===Number.MAX_VALUE)return;const Z=new c(0,0);return rA(S.tileID.canonical,Z,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:_,position:Z,feature:d.feature}}const v8={circle:class extends wo{constructor(o,t,a,u){super(o,{layout:br||(br=new Ys({"circle-sort-key":new Mi(dt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new fi(dt.layout_circle["circle-elevation-reference"]),visibility:new fi(dt.layout_circle.visibility)})),paint:is||(is=new Ys({"circle-radius":new Mi(dt.paint_circle["circle-radius"]),"circle-color":new Mi(dt.paint_circle["circle-color"]),"circle-blur":new Mi(dt.paint_circle["circle-blur"]),"circle-opacity":new Mi(dt.paint_circle["circle-opacity"]),"circle-translate":new fi(dt.paint_circle["circle-translate"]),"circle-translate-anchor":new fi(dt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new fi(dt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new fi(dt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mi(dt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mi(dt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mi(dt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new fi(dt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}createBucket(o){return new Sr(o)}queryRadius(o){const t=o;return Ri("circle-radius",this,t)+Ri("circle-stroke-width",this,t)+on(this.paint.get("circle-translate"))}queryIntersectsFeature(o,t,a,u,d,_,x,S){const R=On(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(t,a)+this.paint.get("circle-stroke-width").evaluate(t,a);return Py(o,u,_,x,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",R,L)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,t,a){const u=Tw(this);return{config:new Ao(this,{zoom:t,lut:a}),defines:u,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends wo{createBucket(o){return new zy(o)}constructor(o,t,a,u){super(o,{layout:Ew||(Ew=new Ys({visibility:new fi(dt.layout_heatmap.visibility)})),paint:Aw||(Aw=new Ys({"heatmap-radius":new Mi(dt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mi(dt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new fi(dt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Au(dt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new fi(dt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return Ri("heatmap-radius",this,o)}queryIntersectsFeature(o,t,a,u,d,_,x,S){const R=this.paint.get("heatmap-radius").evaluate(t,a);return Py(o,u,_,x,S,!0,!0,new Xt(0,0),R)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,t,a){return o==="heatmap"?{config:new Ao(this,{zoom:t,lut:a}),overrideFog:!1}:{}}},hillshade:class extends wo{constructor(o,t,a,u){super(o,{layout:f_||(f_=new Ys({visibility:new fi(dt.layout_hillshade.visibility)})),paint:Cw||(Cw=new Ys({"hillshade-illumination-direction":new fi(dt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new fi(dt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new fi(dt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new fi(dt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new fi(dt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new fi(dt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new fi(dt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,t,a){return{overrideFog:!1}}},fill:class extends wo{constructor(o,t,a,u){super(o,{layout:Dg||(Dg=new Ys({"fill-sort-key":new Mi(dt.layout_fill["fill-sort-key"]),visibility:new fi(dt.layout_fill.visibility),"fill-elevation-reference":new fi(dt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Mi(dt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Gv||(Gv=new Ys({"fill-antialias":new fi(dt.paint_fill["fill-antialias"]),"fill-opacity":new Mi(dt.paint_fill["fill-opacity"]),"fill-color":new Mi(dt.paint_fill["fill-color"]),"fill-outline-color":new Mi(dt.paint_fill["fill-outline-color"]),"fill-translate":new fi(dt.paint_fill["fill-translate"]),"fill-translate-anchor":new fi(dt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mi(dt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new fi(dt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new fi(dt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Mi(dt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Mi(dt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Mi(dt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}getProgramIds(){const o=this.paint.get("fill-pattern"),t=o&&o.constantOr(1),a=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(o,t,a){return{config:new Ao(this,{zoom:t,lut:a}),overrideFog:!1}}recalculate(o,t){super.recalculate(o,t);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Vv(o)}queryRadius(){return on(this.paint.get("fill-translate"))}queryIntersectsFeature(o,t,a,u,d,_){return!o.queryGeometry.isAboveHorizon&&zr(En(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?t&&!o:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends wo{constructor(o,t,a,u){super(o,{layout:C0||(C0=new Ys({visibility:new fi(dt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new fi(dt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Yv||(Yv=new Ys({"fill-extrusion-opacity":new fi(dt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new fi(dt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new fi(dt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new fi(dt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new fi(dt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new fi(dt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new fi(dt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new fi(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new fi(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new fi(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new fi(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new fi(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new fi(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new fi(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new fi(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new fi(dt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new fi(dt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new fi(dt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Mi(dt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new fi(dt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Pd(o)}queryRadius(){return on(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,t,a,u,d,_,x,S,R){const L=On(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(t,a),U=this.paint.get("fill-extrusion-base").evaluate(t,a),G=[0,0],X=S&&_.elevation,Z=_.elevation?_.elevation.exaggeration():1,ne=o.tile.getBucket(this);if(X&&ne instanceof Pd){const Ee=ne.centroidVertexArray,ke=R+1;ke<Ee.length&&(G[0]=Ee.geta_centroid_pos0(ke),G[1]=Ee.geta_centroid_pos1(ke))}if(G[0]===0&&G[1]===1)return!1;_.projection.name==="globe"&&(u=Xw([u],[new Xt(0,0),new Xt(gi,gi)],o.tileID.canonical).map((Ee=>Ee.polygon)).flat());const he=X?S:null,[ce,_e]=D0(_,u,U,F,L,x,he,G,Z,_.center.lat,o.tileID.canonical),xe=o.queryGeometry;return Yw(ce,_e,xe.isPointQuery()?xe.screenBounds:xe.screenGeometry)}},building:class extends wo{constructor(o,t,a,u){super(o,{layout:AD||(AD=new Ys({visibility:new fi(dt.layout_building.visibility),"building-facade":new Mi(dt.layout_building["building-facade"]),"building-facade-floors":new Mi(dt.layout_building["building-facade-floors"]),"building-facade-unit-width":new Mi(dt.layout_building["building-facade-unit-width"]),"building-facade-window":new Mi(dt.layout_building["building-facade-window"]),"building-roof-shape":new Mi(dt.layout_building["building-roof-shape"]),"building-height":new Mi(dt.layout_building["building-height"]),"building-base":new Mi(dt.layout_building["building-base"]),"building-flood-light-wall-radius":new Mi(dt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Mi(dt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Mi(dt.layout_building["building-flip-roof-orientation"])})),paint:CD||(CD=new Ys({"building-opacity":new fi(dt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new fi(dt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new fi(dt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new fi(dt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new fi(dt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new fi(dt.paint_building["building-vertical-scale"]),"building-cast-shadows":new fi(dt.paint_building["building-cast-shadows"]),"building-color":new Mi(dt.paint_building["building-color"]),"building-emissive-strength":new Mi(dt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new fi(dt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new fi(dt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new fi(dt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new fi(dt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new fi(dt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new ED(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}queryRadius(o){return 0}queryIntersectsFeature(o,t,a,u,d,_,x,S,R){let L=this.layout.get("building-height").evaluate(t,a);const F=this.layout.get("building-base").evaluate(t,a),U=o.tile.getBucket(this).getFootprint(t);if(U){if(U.hiddenFlags!==0)return!1;L=U.height}const[G,X]=D0(_,u,F,L,new Xt(0,0),x,null,[0,0],1,_.center.lat,o.tileID.canonical),Z=o.queryGeometry;return Yw(G,X,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends wo{constructor(o,t,a,u){const d=FD();super(o,d,t,a,u),d.layout&&(this.layout=new Bh(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof yu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(o,t){super.recalculate(o,t),this.paint._values["line-floorwidth"]=(()=>{if(e1)return e1;const a=FD();return e1=new p6(a.paint.properties["line-width"].specification),e1.useIntegerZoom=!0,e1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new PE(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,t,a){const u=BD(this);return{config:new Ao(this,{zoom:t,lut:a}),defines:u,overrideFog:!1}}queryRadius(o){const t=o,a=UD(Ri("line-width",this,t),Ri("line-gap-width",this,t)),u=Ri("line-offset",this,t);return a/2+Math.abs(u)+on(this.paint.get("line-translate"))}queryIntersectsFeature(o,t,a,u,d,_){if(o.queryGeometry.isAboveHorizon)return!1;const x=En(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),S=o.pixelToTileUnitsFactor/2*UD(this.paint.get("line-width").evaluate(t,a),this.paint.get("line-gap-width").evaluate(t,a)),R=this.paint.get("line-offset").evaluate(t,a);return R&&(u=(function(L,F){const U=[],G=new Xt(0,0);for(let X=0;X<L.length;X++){const Z=L[X],ne=[];for(let he=0;he<Z.length;he++){const ce=Z[he],_e=Z[he+1],xe=he===0?G:ce.sub(Z[he-1])._unit()._perp(),Ee=he===Z.length-1?G:_e.sub(ce)._unit()._perp(),ke=xe._add(Ee)._unit();ke._mult(1/(ke.x*Ee.x+ke.y*Ee.y)),ne.push(ke._mult(F)._add(ce))}U.push(ne)}return U})(u,R*o.pixelToTileUnitsFactor)),(function(L,F,U){for(let G=0;G<F.length;G++){const X=F[G];if(L.length>=3){for(let Z=0;Z<X.length;Z++)if(te(L,X[Z]))return!0}if(Os(L,X,U))return!0}return!1})(x,u,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:_S,background:class extends wo{constructor(o,t,a,u){super(o,{layout:AL||(AL=new Ys({visibility:new fi(dt.layout_background.visibility)})),paint:CL||(CL=new Ys({"background-pitch-alignment":new fi(dt.paint_background["background-pitch-alignment"]),"background-color":new fi(dt.paint_background["background-color"]),"background-pattern":new fi(dt.paint_background["background-pattern"]),"background-opacity":new fi(dt.paint_background["background-opacity"]),"background-emissive-strength":new fi(dt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,t,a){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:PL,"raster-particle":UL,sky:class extends wo{constructor(o,t,a,u){super(o,{layout:BL||(BL=new Ys({visibility:new fi(dt.layout_sky.visibility)})),paint:NL||(NL=new Ys({"sky-type":new fi(dt.paint_sky["sky-type"]),"sky-atmosphere-sun":new fi(dt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new fi(dt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new fi(dt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new fi(dt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Au(dt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new fi(dt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new fi(dt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new fi(dt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Rg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(o,t){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,_=o.style.light,x=_.properties.get("position");return d&&_.properties.get("anchor")==="viewport"&&ht("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?eA(x.azimuthal,90-x.polar,t):eA(u[0],90-u[1],t)}const a=this.paint.get("sky-gradient-center");return eA(a[0],90-a[1],t)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends wo{constructor(o,t,a,u){super(o,{paint:FL||(FL=new Ys({}))},t,null)}},model:class extends wo{constructor(o,t,a,u){super(o,{layout:HL||(HL=new Ys({visibility:new fi(dt.layout_model.visibility),"model-id":new Mi(dt.layout_model["model-id"])})),paint:jL||(jL=new Ys({"model-opacity":new Mi(dt.paint_model["model-opacity"]),"model-rotation":new Mi(dt.paint_model["model-rotation"]),"model-scale":new Mi(dt.paint_model["model-scale"]),"model-translation":new Mi(dt.paint_model["model-translation"]),"model-color":new Mi(dt.paint_model["model-color"]),"model-color-mix-intensity":new Mi(dt.paint_model["model-color-mix-intensity"]),"model-type":new fi(dt.paint_model["model-type"]),"model-cast-shadows":new fi(dt.paint_model["model-cast-shadows"]),"model-receive-shadows":new fi(dt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new fi(dt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Mi(dt.paint_model["model-emissive-strength"]),"model-roughness":new Mi(dt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Mi(dt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new fi(dt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new fi(dt.paint_model["model-front-cutoff"]),"model-elevation-reference":new fi(dt.paint_model["model-elevation-reference"]),"model-color-use-theme":new Mi({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this.layer=o,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new iA(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof bS?gi-1:0}queryRenderedFeatures(o,t,a){const u=t.getSource();if(!(u&&u instanceof N0))return{};const d=u,_={};_[this.id]=[];const x=_[this.id];let S=0;for(const R of d.models){const L=t.getFeatureState(this.sourceLayer,R.id),F={type:"Unknown",id:R.id,properties:R.featureProperties},U=this.paint.get("model-rotation").evaluate(F,L),G=this.paint.get("model-scale").evaluate(F,L),X=this.paint.get("model-translation").evaluate(F,L),Z=this.paint.get("model-elevation-reference");let ne=[];tS(ne,R,a,R.position,U,G,X,Z==="ground",Z==="ground",!1),a.projection.name==="globe"&&(ne=eS(ne,a));const he=ae([],a.projMatrix,ne),ce=EE(o.isPointQuery()?o.screenBounds:o.screenGeometry,a,he,R.aabb);if(ce!=null){const _e=new B0(void 0,0,0,0,R.id);_e.layer=this.layer,_e.properties=structuredClone(R.featureProperties),_e.properties.layer=this.id,_e.properties.uri=R.uri,_e.properties.orientation=R.orientation,_e.sourceLayer=this.sourceLayer,_e.geometry={type:"Point",coordinates:[R.position.lng,R.position.lat]},_e.state=L,_e.source=this.source,x.push({featureIndex:S,feature:_e,intersectionZ:ce})}++S}return _}queryIntersectsFeature(o,t,a,u,d,_){if(!this.modelManager)return!1;const x=this.modelManager,S=o.tile.getBucket(this);if(!(S&&S instanceof iA))return!1;for(const R in S.instancesPerModel){const L=S.instancesPerModel[R],F=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(L.idToFeaturesIndex.hasOwnProperty(F)){const U=L.features[L.idToFeaturesIndex[F]],G=x.getModel(R,this.scope);if(!G)return!1;let X=[];const Z=new c(0,0),ne=S.canonical;let he=Number.MAX_VALUE;for(let ce=0;ce<U.instancedDataCount;++ce){const _e=16*(U.instancedDataOffset+ce),xe=L.instancedDataArray.float32,Ee=[xe[_e+4],xe[_e+5],xe[_e+6]];rA(ne,Z,Math.floor(xe[_e]),Math.floor(xe[_e+1])),tS(X,G,_,Z,U.rotation,U.scale,Ee,!1,!1,!1),_.projection.name==="globe"&&(X=eS(X,_));const ke=ae([],_.projMatrix,X),Be=o.queryGeometry,He=EE(Be.isPointQuery()?Be.screenBounds:Be.screenGeometry,_,ke,G.aabb);He!=null&&(he=Math.min(He,he))}return he!==Number.MAX_VALUE&&he}}return!1}_handleOverridablePaintPropertyUpdate(o,t,a){return!(!this.layout||t.isDataDriven()||a.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const t=this._transitionablePaint._values[o];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Oo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends wo{constructor(o,t,a,u){super(o,{layout:Ow||(Ow=new Ys({"clip-layer-types":new fi(dt.layout_clip["clip-layer-types"]),"clip-layer-scope":new fi(dt.layout_clip["clip-layer-scope"])})),paint:Bw||(Bw=new Ys({}))},t,a,u)}recalculate(o,t){super.recalculate(o,t)}createBucket(o){return new Nw(o)}is3D(o){return!0}}},sA=new qr(0,0,0),aA={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},oA={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},wS={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},b8={PAINT_ORDER_FILL_AND_STROKE:1},g1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},YL={MASK_TYPE_LUMINANCE:1};function w8(o,t,a){o===1&&t.icons.push((function(u,d){return(function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:x}=_;if(x.content_area){const{content_area:S}=x;S.left==null&&(S.left=0),S.top==null&&(S.top=S.left),S.width==null&&(S.width=_.usvg_tree.width),S.height==null&&(S.height=S.width)}if(x.text_placeholder){const{text_placeholder:S}=x;S.top==null&&(S.top=S.left),S.height==null&&(S.height=S.width)}return x.stretch_x&&x.stretch_x.length&&KL(x,"x"),x.stretch_y&&x.stretch_y.length&&KL(x,"y"),_})(u.readFields(S8,{name:void 0},d))})(a,a.readVarint()+a.pos))}function KL(o,t){const a=[],u=o[`stretch_${t}`];let d=null;for(let _=0;_<u.length;_++)d===null?d=a.length===0?u[0]:a[a.length-1][1]+u[_]:(a.push([d,d+u[_]]),d=null);o[`stretch_${t}_areas`]=a}function S8(o,t,a){o===1?t.name=a.readString():o===2?t.metadata=(function(u,d){return u.readFields(T8,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(a,a.readVarint()+a.pos):o===3&&(t.usvg_tree=(function(u,d){return u.readFields(A8,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(a,a.readVarint()+a.pos),t.data="usvg_tree")}function T8(o,t,a){o===1?t.stretch_x=a.readPackedVarint():o===2?t.stretch_y=a.readPackedVarint():o===3?t.content_area=$L(a,a.readVarint()+a.pos):o===4?t.variables.push((function(u,d){return u.readFields(E8,{name:void 0},d)})(a,a.readVarint()+a.pos)):o===5&&(t.text_placeholder=$L(a,a.readVarint()+a.pos))}function $L(o,t){return o.readFields(M8,{},t)}function M8(o,t,a){o===1?t.left=a.readVarint():o===2?t.width=a.readVarint():o===3?t.top=a.readVarint():o===4&&(t.height=a.readVarint())}function E8(o,t,a){o===1?t.name=a.readString():o===2&&(t.rgb_color=MS(a.readVarint()),t.value="rgb_color")}function A8(o,t,a){o===1?t.width=t.height=a.readVarint():o===2?t.height=a.readVarint():o===3?t.children.push(SS(a,a.readVarint()+a.pos)):o===4?t.linear_gradients.push((function(u,d){return u.readFields(z8,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(a,a.readVarint()+a.pos)):o===5?t.radial_gradients.push((function(u,d){return u.readFields(B8,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(a,a.readVarint()+a.pos)):o===7?t.clip_paths.push((function(u,d){return u.readFields(N8,{children:[]},d)})(a,a.readVarint()+a.pos)):o===8&&t.masks.push((function(u,d){const _=u.readFields(F8,{left:0,width:20,mask_type:YL.MASK_TYPE_LUMINANCE,children:[]},d);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_})(a,a.readVarint()+a.pos))}function SS(o,t){return o.readFields(C8,{},t)}function C8(o,t,a){o===1?(t.group=(function(u,d){return u.readFields(R8,{opacity:255,children:[]},d)})(a,a.readVarint()+a.pos),t.node="group"):o===2&&(t.path=(function(u,d){return u.readFields(D8,{paint_order:1,commands:[],step:1,diffs:[],rule:aA.PATH_RULE_NON_ZERO},d)})(a,a.readVarint()+a.pos),t.node="path")}function R8(o,t,a){o===1?t.transform=TS(a,a.readVarint()+a.pos):o===2?t.opacity=a.readVarint():o===5?t.clip_path_idx=a.readVarint():o===6?t.mask_idx=a.readVarint():o===7&&t.children.push(SS(a,a.readVarint()+a.pos))}function TS(o,t){return o.readFields(I8,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function I8(o,t,a){o===1?t.sx=a.readFloat():o===2?t.ky=a.readFloat():o===3?t.kx=a.readFloat():o===4?t.sy=a.readFloat():o===5?t.tx=a.readFloat():o===6&&(t.ty=a.readFloat())}function D8(o,t,a){o===1?t.fill=(function(u,d){return u.readFields(L8,{rgb_color:sA,paint:"rgb_color",opacity:255},d)})(a,a.readVarint()+a.pos):o===2?t.stroke=(function(u,d){return u.readFields(P8,{rgb_color:sA,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(a,a.readVarint()+a.pos):o===3?t.paint_order=a.readVarint():o===5?a.readPackedVarint(t.commands):o===6?t.step=a.readFloat():o===7?a.readPackedSVarint(t.diffs):o===8&&(t.rule=a.readVarint())}function L8(o,t,a){o===1?(t.rgb_color=MS(a.readVarint()),t.paint="rgb_color"):o===2?(t.linear_gradient_idx=a.readVarint(),t.paint="linear_gradient_idx"):o===3?(t.radial_gradient_idx=a.readVarint(),t.paint="radial_gradient_idx"):o===5&&(t.opacity=a.readVarint())}function MS(o){return new qr((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function P8(o,t,a){o===1?(t.rgb_color=MS(a.readVarint()),t.paint="rgb_color"):o===2?(t.linear_gradient_idx=a.readVarint(),t.paint="linear_gradient_idx"):o===3?(t.radial_gradient_idx=a.readVarint(),t.paint="radial_gradient_idx"):o===5?a.readPackedFloat(t.dasharray):o===6?t.dashoffset=a.readFloat():o===7?t.miterlimit=a.readFloat():o===8?t.opacity=a.readVarint():o===9?t.width=a.readFloat():o===10?t.linecap=a.readVarint():o===11&&(t.linejoin=a.readVarint())}function z8(o,t,a){o===1?t.transform=TS(a,a.readVarint()+a.pos):o===2?t.spread_method=a.readVarint():o===3?t.stops.push(JL(a,a.readVarint()+a.pos)):o===4?t.x1=a.readFloat():o===5?t.y1=a.readFloat():o===6?t.x2=a.readFloat():o===7&&(t.y2=a.readFloat())}function JL(o,t){return o.readFields(O8,{offset:0,opacity:255,rgb_color:sA},t)}function O8(o,t,a){o===1?t.offset=a.readFloat():o===2?t.opacity=a.readVarint():o===3&&(t.rgb_color=MS(a.readVarint()))}function B8(o,t,a){o===1?t.transform=TS(a,a.readVarint()+a.pos):o===2?t.spread_method=a.readVarint():o===3?t.stops.push(JL(a,a.readVarint()+a.pos)):o===4?t.cx=a.readFloat():o===5?t.cy=a.readFloat():o===6?t.r=a.readFloat():o===7?t.fx=a.readFloat():o===8?t.fy=a.readFloat():o===9&&(t.fr=a.readFloat())}function N8(o,t,a){o===1?t.transform=TS(a,a.readVarint()+a.pos):o===2?t.clip_path_idx=a.readVarint():o===3&&t.children.push(SS(a,a.readVarint()+a.pos))}function F8(o,t,a){o===1?t.left=t.top=a.readFloat():o===2?t.width=t.height=a.readFloat():o===3?t.top=a.readFloat():o===4?t.height=a.readFloat():o===5?t.mask_type=a.readVarint():o===6?t.mask_idx=a.readVarint():o===7&&t.children.push(SS(a,a.readVarint()+a.pos))}class U8{static calculate(t={},a=[]){const u=new Map,d=new Map;if(Object.keys(t).length===0)return u;a.forEach((_=>{d.set(_.name,_.rgb_color||new qr(0,0,0))}));for(const[_,x]of Object.entries(t))d.has(_)?u.set(d.get(_).toString(),x):console.warn(`Ignoring unknown image variable "${_}"`);return u}}function sx(o,t=255,a){const u=t/255,d=o.toString(),_=a.has(d)?a.get(d).clone():o.clone();return _.a*=u,_.toString()}function _1(o,t){if(!la()){const a=document.createElement("canvas");return a.width=o,a.height=t,a}return new OffscreenCanvas(o,t)}let lA,y1=null;function cA(o,t,a,u,d){for(const _ of u.children)QL(o,t,a,_,d)}function QL(o,t,a,u,d){u.group?(o.save(),(function(_,x,S,R,L){const F=R.mask_idx!=null?S.masks[R.mask_idx]:null,U=R.clip_path_idx!=null?S.clip_paths[R.clip_path_idx]:null;if(R.transform&&(x=ax(R.transform).preMultiplySelf(x)),!(function(Z,ne,he){return Z.opacity!==255||ne||he})(R,U!=null,F!=null))return void cA(_,x,S,R,L);const G=_1(_.canvas.width,_.canvas.height),X=G.getContext("2d");cA(X,x,S,R,L),U&&aP(X,x,S,U),F&&oP(X,x,S,F,L),_.globalAlpha=R.opacity/255,_.drawImage(G,0,0)})(o,t,a,u.group,d),o.restore()):u.path&&(o.save(),(function(_,x,S,R,L){_.setTransform(x),R.paint_order===b8.PAINT_ORDER_FILL_AND_STROKE?(eP(_,S,R,L),iP(_,S,R,L)):(iP(_,S,R,L),eP(_,S,R,L))})(o,t,a,u.path,d),o.restore())}function eP(o,t,a,u){const d=a.fill;if(!d)return;const _=d.opacity/255;switch(o.save(),o.beginPath(),lP(a,o),d.paint){case"rgb_color":o.fillStyle=sx(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const x=t.linear_gradients[d.linear_gradient_idx];x.transform&&o.setTransform(ax(x.transform).preMultiplySelf(o.getTransform())),o.fillStyle=nP(o,x,_,u);break}case"radial_gradient_idx":{const x=t.radial_gradients[d.radial_gradient_idx];x.transform&&o.setTransform(ax(x.transform).preMultiplySelf(o.getTransform())),o.fillStyle=rP(o,x,_,u)}}o.fill(tP(a)),o.restore()}function tP(o){return o.rule===aA.PATH_RULE_NON_ZERO?"nonzero":o.rule===aA.PATH_RULE_EVEN_ODD?"evenodd":void 0}function iP(o,t,a,u){const d=a.stroke;if(!d)return;const _=cP(a);o.lineWidth=d.width,o.miterLimit=d.miterlimit,o.setLineDash(d.dasharray),o.lineDashOffset=d.dashoffset;const x=d.opacity/255;switch(d.paint){case"rgb_color":o.strokeStyle=sx(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":o.strokeStyle=nP(o,t.linear_gradients[d.linear_gradient_idx],x,u,!0);break;case"radial_gradient_idx":o.strokeStyle=rP(o,t.radial_gradients[d.radial_gradient_idx],x,u,!0)}switch(d.linejoin){case wS.LINE_JOIN_MITER_CLIP:case wS.LINE_JOIN_MITER:o.lineJoin="miter";break;case wS.LINE_JOIN_ROUND:o.lineJoin="round";break;case wS.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(d.linecap){case oA.LINE_CAP_BUTT:o.lineCap="butt";break;case oA.LINE_CAP_ROUND:o.lineCap="round";break;case oA.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(_)}function nP(o,t,a,u,d=!1){if(t.stops.length===1){const G=t.stops[0];return sx(G.rgb_color,G.opacity*a,u)}const{x1:_,y1:x,x2:S,y2:R}=t;let L=new DOMPoint(_,x),F=new DOMPoint(S,R);if(d){const G=ax(t.transform);L=G.transformPoint(L),F=G.transformPoint(F)}const U=o.createLinearGradient(L.x,L.y,F.x,F.y);for(const G of t.stops)U.addColorStop(G.offset,sx(G.rgb_color,G.opacity*a,u));return U}function rP(o,t,a,u,d=!1){if(t.stops.length===1){const ce=t.stops[0];return sx(ce.rgb_color,ce.opacity*a,u)}const _=ax(t.transform),{fx:x,fy:S,fr:R,cx:L,cy:F,r:U}=t;let G=new DOMPoint(x,S),X=new DOMPoint(L,F),Z=R,ne=U;if(d){G=_.transformPoint(G),X=_.transformPoint(X);const ce=(_.a+_.d)/2;Z=R*ce,ne=t.r*ce}const he=o.createRadialGradient(G.x,G.y,Z,X.x,X.y,ne);for(const ce of t.stops)he.addColorStop(ce.offset,sx(ce.rgb_color,ce.opacity*a,u));return he}function sP(o,t,a,u){const d=u.transform?ax(u.transform).preMultiplySelf(t):t,_=_1(o.canvas.width,o.canvas.height),x=_.getContext("2d");for(const R of u.children)if(R.group)sP(x,d,a,R.group);else if(R.path){const L=R.path,F=new Path2D;F.addPath(cP(L),d),x.fill(F,tP(L))}const S=u.clip_path_idx!=null?a.clip_paths[u.clip_path_idx]:null;S&&aP(x,d,a,S),o.globalCompositeOperation="source-over",o.drawImage(_,0,0)}function aP(o,t,a,u){const d=_1(o.canvas.width,o.canvas.height);sP(d.getContext("2d"),t,a,u),o.globalCompositeOperation="destination-in",o.drawImage(d,0,0)}function oP(o,t,a,u,d){if(u.children.length===0)return;const _=u.mask_idx!=null?a.masks[u.mask_idx]:null;_&&oP(o,t,a,_,d);const x=o.canvas.width,S=o.canvas.height,R=_1(x,S),L=R.getContext("2d"),F=u.width,U=u.height,G=u.left,X=u.top,Z=new Path2D,ne=new Path2D;ne.rect(G,X,F,U),Z.addPath(ne,t),L.clip(Z);for(const _e of u.children)QL(L,t,a,_e,d);const he=L.getImageData(0,0,x,S),ce=he.data;if(u.mask_type===YL.MASK_TYPE_LUMINANCE)for(let _e=0;_e<ce.length;_e+=4)ce[_e+3]=ce[_e+3]/255*(.2126*ce[_e]+.7152*ce[_e+1]+.0722*ce[_e+2]);L.putImageData(he,0,0),o.globalCompositeOperation="destination-in",o.drawImage(R,0,0)}function ax(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function lP(o,t){const a=o.step;let u=o.diffs[0]*a,d=o.diffs[1]*a;t.moveTo(u,d);for(let _=0,x=2;_<o.commands.length;_++)switch(o.commands[_]){case g1.PATH_COMMAND_MOVE:u+=o.diffs[x++]*a,d+=o.diffs[x++]*a,t.moveTo(u,d);break;case g1.PATH_COMMAND_LINE:u+=o.diffs[x++]*a,d+=o.diffs[x++]*a,t.lineTo(u,d);break;case g1.PATH_COMMAND_QUAD:{const S=u+o.diffs[x++]*a,R=d+o.diffs[x++]*a;u=S+o.diffs[x++]*a,d=R+o.diffs[x++]*a,t.quadraticCurveTo(S,R,u,d);break}case g1.PATH_COMMAND_CUBIC:{const S=u+o.diffs[x++]*a,R=d+o.diffs[x++]*a,L=S+o.diffs[x++]*a,F=R+o.diffs[x++]*a;u=L+o.diffs[x++]*a,d=F+o.diffs[x++]*a,t.bezierCurveTo(S,R,L,F,u,d);break}case g1.PATH_COMMAND_CLOSE:t.closePath()}return t}function cP(o){return lP(o,new Path2D)}class ES{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const a=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,a),a}put(t,a){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,a)}delete(t){this.cache.delete(t)}}oi(ES,"LRUCache");class uA{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Uo(t,t.data)}getFromCache(t,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new ES(150)),this.cacheMap.get(u).get(gc(t.toString(),a))}setInCache(t,a,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new ES(150));const _=this.cacheDependenciesMap.get(d),x=gc(t.id.toString(),u);_.get(x)||_.set(x,new Set);const S=this.cacheMap.get(d),R=t.toString();_.get(x).add(R),S.put(gc(t.toString(),u),a)}removeImagesFromCacheByIds(t,a,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),_=this.cacheDependenciesMap.get(u);for(const x of t){const S=gc(x.toString(),a);if(_.has(S)){for(const R of _.get(S))d.delete(R);_.delete(S)}}}rasterize(t,a,u,d){const _=this.getFromCache(t,u,d);if(_)return _.clone();const x=(function(R,L){const F=U8.calculate(L.params,R.metadata?R.metadata.variables:[]),U=R.usvg_tree,G=U.width,X=U.height,Z=Math.max(1,Math.round(G*L.sx)),ne=Math.max(1,Math.round(X*L.sy)),he=new DOMMatrix([Z/G,0,0,ne/X,0,0]);return y1===null&&(y1=_1(10,10),lA=y1.getContext("2d",{willReadFrequently:!0})),y1.width=Z,y1.height=ne,cA(lA,he,U,U,F),lA.getImageData(0,0,Z,ne)})(a.icon,t),S=uA._getImage(x);return this.setInCache(t,S,u,d),S.clone()}}class uP{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,a){const u=this.toIdx(t,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,a){return this.leaves[this.toIdx(t,a)]}toIdx(t,a){return a*this.size+t}}function hP(o,t,a,u){let d=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(u[x])<1e-15){if(a[x]<o[x]||a[x]>t[x])return null}else{const S=1/u[x];let R=(o[x]-a[x])*S,L=(t[x]-a[x])*S;if(R>L){const F=R;R=L,L=F}if(R>d&&(d=R),L<_&&(_=L),d>_)return null}return d}function fP(o,t,a,u,d,_,x,S,R,L,F){const U=u-o,G=d-t,X=_-a,Z=x-o,ne=S-t,he=R-a,ce=F[1]*he-F[2]*ne,_e=F[2]*Z-F[0]*he,xe=F[0]*ne-F[1]*Z,Ee=U*ce+G*_e+X*xe;if(Math.abs(Ee)<1e-15)return null;const ke=1/Ee,Be=L[0]-o,He=L[1]-t,Je=L[2]-a,tt=(Be*ce+He*_e+Je*xe)*ke;if(tt<0||tt>1)return null;const It=He*X-Je*G,ut=Je*U-Be*X,Ot=Be*G-He*U,Zt=(F[0]*It+F[1]*ut+F[2]*Ot)*ke;return Zt<0||tt+Zt>1?null:(Z*It+ne*ut+he*Ot)*ke}function dP(o,t,a){return(o-t)/(a-t)}function pP(o,t,a,u,d,_,x,S,R){const L=1<<a,F=_-u,U=x-d,G=(o+1)/L*F+u,X=(t+0)/L*U+d,Z=(t+1)/L*U+d;S[0]=(o+0)/L*F+u,S[1]=X,R[0]=G,R[1]=Z}class mP{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=(function(_){const x=Math.ceil(Math.log2(_.dim/8)),S=[];let R=Math.ceil(Math.pow(2,x));const L=1/R,F=(X,Z,ne,he,ce)=>{const _e=he?1:0,xe=(X+1)*ne-_e,Ee=Z*ne,ke=(Z+1)*ne-_e;ce[0]=X*ne,ce[1]=Ee,ce[2]=xe,ce[3]=ke};let U=new uP(R);const G=[];for(let X=0;X<R*R;X++){F(X%R,Math.floor(X/R),L,!1,G);const Z=L_(G[0],G[1],_),ne=L_(G[2],G[1],_),he=L_(G[2],G[3],_),ce=L_(G[0],G[3],_);U.minimums.push(Math.min(Z,ne,he,ce)),U.maximums.push(Math.max(Z,ne,he,ce)),U.leaves.push(1)}for(S.push(U),R/=2;R>=1;R/=2){const X=S[S.length-1];U=new uP(R);for(let Z=0;Z<R*R;Z++){F(Z%R,Math.floor(Z/R),2,!0,G);const ne=X.getElevation(G[0],G[1]),he=X.getElevation(G[2],G[1]),ce=X.getElevation(G[2],G[3]),_e=X.getElevation(G[0],G[3]),xe=X.isLeaf(G[0],G[1]),Ee=X.isLeaf(G[2],G[1]),ke=X.isLeaf(G[2],G[3]),Be=X.isLeaf(G[0],G[3]),He=Math.min(ne.min,he.min,ce.min,_e.min),Je=Math.max(ne.max,he.max,ce.max,_e.max),tt=xe&&Ee&&ke&&Be;U.maximums.push(Je),U.minimums.push(He),U.leaves.push(Je-He<=5&&tt?1:0)}S.push(U)}return S})(this.dem),u=a.length-1,d=a[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(t,a,u,d,_,x,S=1){return hP([t,a,-100],[u,d,this.maximums[0]*S],_,x)}raycast(t,a,u,d,_,x,S=1){if(!this.nodeCount)return null;const R=this.raycastRoot(t,a,u,d,_,x,S);if(R==null)return null;const L=[],F=[],U=[],G=[],X=[{idx:0,t:R,nodex:0,nodey:0,depth:0}];for(;X.length>0;){const{idx:Z,t:ne,nodex:he,nodey:ce,depth:_e}=X.pop();if(this.leaves[Z]){pP(he,ce,_e,t,a,u,d,U,G);const Ee=1<<_e,ke=(he+0)/Ee,Be=(he+1)/Ee,He=(ce+0)/Ee,Je=(ce+1)/Ee,tt=L_(ke,He,this.dem)*S,It=L_(Be,He,this.dem)*S,ut=L_(Be,Je,this.dem)*S,Ot=L_(ke,Je,this.dem)*S,Zt=fP(U[0],U[1],tt,G[0],U[1],It,G[0],G[1],ut,_,x),Yt=fP(G[0],G[1],ut,U[0],G[1],Ot,U[0],U[1],tt,_,x),li=Math.min(Zt!==null?Zt:Number.MAX_VALUE,Yt!==null?Yt:Number.MAX_VALUE);if(li!==Number.MAX_VALUE)return li;{const ui=ii([],_,x,ne);if(gP(tt,It,Ot,ut,dP(ui[0],U[0],G[0]),dP(ui[1],U[1],G[1]))>=ui[2])return ne}continue}let xe=0;for(let Ee=0;Ee<this._siblingOffset.length;Ee++){pP((he<<1)+this._siblingOffset[Ee][0],(ce<<1)+this._siblingOffset[Ee][1],_e+1,t,a,u,d,U,G),U[2]=-100,G[2]=this.maximums[this.childOffsets[Z]+Ee]*S;const ke=hP(U,G,_,x);if(ke!=null){const Be=ke;L[Ee]=Be;let He=!1;for(let Je=0;Je<xe&&!He;Je++)Be>=L[F[Je]]&&(F.splice(Je,0,Ee),He=!0);He||(F[xe]=Ee),xe++}}for(let Ee=0;Ee<xe;Ee++){const ke=F[Ee];X.push({idx:this.childOffsets[Z]+ke,t:L[ke],nodex:(he<<1)+this._siblingOffset[ke][0],nodey:(ce<<1)+this._siblingOffset[ke][1],depth:_e+1})}}return null}_addNode(t,a,u){return this.minimums.push(t),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,a,u,d,_){if(t[d].isLeaf(a,u)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=d-1,S=t[x];let R=0,L=0;for(let F=0;F<this._siblingOffset.length;F++){const U=2*a+this._siblingOffset[F][0],G=2*u+this._siblingOffset[F][1],X=S.getElevation(U,G),Z=S.isLeaf(U,G),ne=this._addNode(X.min,X.max,Z);Z&&(R|=1<<F),L||(L=ne)}for(let F=0;F<this._siblingOffset.length;F++)R&1<<F||this._construct(t,2*a+this._siblingOffset[F][0],2*u+this._siblingOffset[F][1],x,L+F)}}function gP(o,t,a,u,d,_){return Rn(Rn(o,a,_),Rn(t,u,_),d)}function L_(o,t,a){const u=a.dim,d=oe(o*u-.5,0,u-1),_=oe(t*u-.5,0,u-1),x=Math.floor(d),S=Math.floor(_),R=Math.min(x+1,u-1),L=Math.min(S+1,u-1);return gP(a.get(x,S),a.get(R,S),a.get(x,L),a.get(R,L),d-x,_-S)}const k8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function V8(o,t,a){return(256*o*256+256*t+a)/10-1e4}function G8(o,t,a){return 256*o+t+a/256-32768}class AS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,a,u,d=!1){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void ht(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,x=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let R=0;R<_;R++)x[this._idx(-1,R)]=x[this._idx(0,R)],x[this._idx(_,R)]=x[this._idx(_-1,R)],x[this._idx(R,-1)]=x[this._idx(R,0)],x[this._idx(R,_)]=x[this._idx(R,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)]}const S=u==="terrarium"?G8:V8;for(let R=0;R<x.length;++R){const L=4*R;this.floatView[R]=S(this.pixels[L],this.pixels[L+1],this.pixels[L+2])}this._timestamp=xs.now()}_buildQuadTree(){this._tree=new mP(this)}get(t,a,u=!1){u&&(t=oe(t,-1,this.dim),a=oe(a,-1,this.dim));const d=this._idx(t,a);return this.floatView[d]}set(t,a,u){const d=this._idx(t,a),_=this.floatView[d];return this.floatView[d]=u,u-_}static getUnpackVector(t){return k8[t]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}static pack(t,a){const u=[0,0,0,0],d=AS.getUnpackVector(a);let _=Math.floor((t+d[3])/d[2]);return u[2]=_%256,_=Math.floor(_/256),u[1]=_%256,_=Math.floor(_/256),u[0]=_,u}getPixels(){return new Dv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,a,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,_=a*this.dim+this.dim,x=u*this.dim,S=u*this.dim+this.dim;switch(a){case-1:d=_-1;break;case 1:_=d+1}switch(u){case-1:x=S-1;break;case 1:S=x+1}const R=-a*this.dim,L=-u*this.dim;for(let F=x;F<S;F++)for(let U=d;U<_;U++){const G=4*this._idx(U,F),X=4*this._idx(U+R,F+L);this.pixels[G+0]=t.pixels[X+0],this.pixels[G+1]=t.pixels[X+1],this.pixels[G+2]=t.pixels[X+2],this.pixels[G+3]=t.pixels[X+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function H8(o,t,a){o===1?t.headerLength=a.readFixed32():o===2?t.x=a.readVarint():o===3?t.y=a.readVarint():o===4?t.z=a.readVarint():o===5&&t.layers.push((function(u,d){return u.readFields(Z8,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(a,a.readVarint()+a.pos))}function j8(o,t,a){o===1?(t.delta_filter=(function(u,d){return u.readFields(q8,{blockSize:0},d)})(a,a.readVarint()+a.pos),t.filter="delta_filter"):o===2?(a.readVarint(),t.filter="zigzag_filter"):o===3?(a.readVarint(),t.filter="bitshuffle_filter"):o===4&&(a.readVarint(),t.filter="byteshuffle_filter")}function q8(o,t,a){o===1&&(t.blockSize=a.readVarint())}function X8(o,t,a){o===1?(a.readVarint(),t.codec="gzip_data"):o===2?(a.readVarint(),t.codec="jpeg_image"):o===3?(a.readVarint(),t.codec="webp_image"):o===4&&(a.readVarint(),t.codec="png_image")}function W8(o,t,a){let u=0,d=0;o===1?t.firstByte=a.readFixed64():o===2?t.lastByte=a.readFixed64():o===3?t.filters.push((function(_,x){return _.readFields(j8,{},x)})(a,a.readVarint()+a.pos)):o===4?t.codec=(function(_,x){return _.readFields(X8,{},x)})(a,a.readVarint()+a.pos):o===5?d=a.readFloat():o===6?u=a.readFloat():o===7?t.bands.push(a.readString()):o===8?t.offset=a.readDouble():o===9&&(t.scale=a.readDouble()),t.offset===0&&(t.offset=d),t.scale===0&&(t.scale=u)}function Z8(o,t,a){o===1?t.version=a.readVarint():o===2?t.name=a.readString():o===3?t.units=a.readString():o===4?t.tileSize=a.readVarint():o===5?t.buffer=a.readVarint():o===6?t.pixelFormat=a.readVarint():o===7&&t.dataIndex.push((function(u,d){return u.readFields(W8,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(a,a.readVarint()+a.pos))}function Y8(o,t,a){if(o===2)(function(u,d,_){u.readFields(K8,_,d)})(a,a.readVarint()+a.pos,t);else if(o===3)throw new Error("Not implemented")}function K8(o,t,a){if(o===1){let u=0;const d=a.readVarint()+a.pos;for(;a.pos<d;)t[u++]=a.readVarint()}}function $8(o,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let a=t[3];for(let u=2;u>=1;u--){const d=u===1?1:0,_=u===2?1:0;for(let x=0;x<t[0];x++){const S=t[1]*x;for(let R=d;R<t[1];R++){const L=t[2]*(R+S);for(let F=_;F<t[2];F++){const U=t[3]*(F+L);for(let G=0;G<t[3];G++){const X=U+G;o[X]+=o[X-a]}}}}a*=t[u]}return o}function J8(o){for(let t=0,a=o.length;t<a;t++)o[t]=o[t]>>>1^-(1&o[t]);return o}function Q8(o,t){switch(t){case"uint32":return o;case"uint16":for(let a=0;a<o.length;a+=2){const u=o[a],d=o[a+1];o[a]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,o[a+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return o;case"uint8":for(let a=0;a<o.length;a+=4){const u=o[a],d=o[a+1],_=o[a+2],x=o[a+3];o[a+0]=(192&u)>>6|(192&d)>>4|(192&_)>>2|192&x,o[a+1]=(48&u)>>4|(48&d)>>2|48&_|(48&x)<<2,o[a+2]=(12&u)>>2|12&d|(12&_)<<2|(12&x)<<4,o[a+3]=3&u|(3&d)<<2|(3&_)<<4|(3&x)<<6}return o;default:throw new Error(`Invalid pixel format, "${t}"`)}}oi(AS,"DEMData"),oi(mP,"DemMinMaxQuadTree",{omit:["dem"]});var zd=Uint8Array,x1=Uint16Array,eG=Int32Array,_P=new zd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yP=new zd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tG=new zd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xP=function(o,t){for(var a=new x1(31),u=0;u<31;++u)a[u]=t+=1<<o[u-1];var d=new eG(a[30]);for(u=1;u<30;++u)for(var _=a[u];_<a[u+1];++_)d[_]=_-a[u]<<5|u;return{b:a,r:d}},vP=xP(_P,2),bP=vP.b,iG=vP.r;bP[28]=258,iG[258]=28;for(var nG=xP(yP,0).b,wP=new x1(32768),Co=0;Co<32768;++Co){var ox=(43690&Co)>>1|(21845&Co)<<1;wP[Co]=((65280&(ox=(61680&(ox=(52428&ox)>>2|(13107&ox)<<2))>>4|(3855&ox)<<4))>>8|(255&ox)<<8)>>1}var v1=function(o,t,a){for(var u=o.length,d=0,_=new x1(t);d<u;++d)o[d]&&++_[o[d]-1];var x,S=new x1(t);for(d=1;d<t;++d)S[d]=S[d-1]+_[d-1]<<1;x=new x1(1<<t);var R=15-t;for(d=0;d<u;++d)if(o[d])for(var L=d<<4|o[d],F=t-o[d],U=S[o[d]-1]++<<F,G=U|(1<<F)-1;U<=G;++U)x[wP[U]>>R]=L;return x},b1=new zd(288);for(Co=0;Co<144;++Co)b1[Co]=8;for(Co=144;Co<256;++Co)b1[Co]=9;for(Co=256;Co<280;++Co)b1[Co]=7;for(Co=280;Co<288;++Co)b1[Co]=8;var SP=new zd(32);for(Co=0;Co<32;++Co)SP[Co]=5;var rG=v1(b1,9),sG=v1(SP,5),hA=function(o){for(var t=o[0],a=1;a<o.length;++a)o[a]>t&&(t=o[a]);return t},dm=function(o,t,a){var u=t/8|0;return(o[u]|o[u+1]<<8)>>(7&t)&a},fA=function(o,t){var a=t/8|0;return(o[a]|o[a+1]<<8|o[a+2]<<16)>>(7&t)},aG=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pm=function(o,t,a){var u=new Error(t||aG[o]);if(u.code=o,Error.captureStackTrace&&Error.captureStackTrace(u,pm),!a)throw u;return u},oG=new zd(0),lG=typeof TextDecoder<"u"&&new TextDecoder;try{lG.decode(oG,{stream:!0})}catch{}const cG={gzip_data:"gzip"};class bp extends Error{constructor(t){super(t),this.name="MRTError"}}const uG={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},TP={uint32:1,uint16:2,uint8:4},hG={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let dA;class CS{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const a=this.layers[t];if(!a)throw new bp(`Layer '${t}' not found`);return a}getHeaderLength(t){const a=new Uint8Array(t),u=new DataView(t);if(a[0]!==13)throw new bp("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(t){const a=new Uint8Array(t),u=this.getHeaderLength(t);if(a.length<u)throw new bp(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const d=new dA(a.subarray(0,u)).readFields(H8,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new bp(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const _ of d.layers)this.layers[_.name]=new MP(_,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const a=[],u=this.getLayer(t.layerName);for(let d of t.blockIndices){const _=u.dataIndex[d],x=_.firstByte-t.firstByte,S=_.lastByte-t.firstByte;if(u._blocksInProgress.has(d))continue;const R={layerName:u.name,firstByte:x,lastByte:S,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[_.bands.length].concat(u.bandShape),buffer:u.buffer,codec:_.codec.codec,filters:_.filters.map((L=>L.filter))};u._blocksInProgress.add(d),a.push(R)}return new EP(a,(()=>{a.forEach((d=>u._blocksInProgress.delete(d.blockIndex)))}),((d,_)=>{if(a.forEach((x=>u._blocksInProgress.delete(x.blockIndex))),d)throw d;_.forEach((x=>{this.getLayer(x.layerName).processDecodedData(x)}))}))}}class MP{constructor({version:t,name:a,units:u,tileSize:d,pixelFormat:_,buffer:x,dataIndex:S},R){if(this.version=t,this.version!==1)throw new bp(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=a,this.units=u,this.tileSize=d,this.buffer=x,this.pixelFormat=uG[_],this.dataIndex=S,this.bandShape=[d+2*x,d+2*x,TP[this.pixelFormat]],this._decodedBlocks=new ES(R?R.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return TP[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:t})=>t)).flat()}processDecodedData(t){const a=t.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,t.data)}getBlockForBand(t){let a=0;switch(typeof t){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[_,x]of d.bands.entries())if(x===t)return{bandIndex:a+_,blockIndex:u,blockBandIndex:_};a+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(t>=a&&t<a+d.bands.length)return{bandIndex:t,blockIndex:u,blockBandIndex:t-a};a+=d.bands.length}break;default:throw new bp(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let a=1/0,u=-1/0;const d=[],_=new Set;for(const x of t){const{blockIndex:S}=this.getBlockForBand(x);if(S<0)throw new bp(`Invalid band: ${JSON.stringify(x)}`);const R=this.dataIndex[S];d.includes(S)||d.push(S),_.add(S),a=Math.min(a,R.firstByte),u=Math.max(u,R.lastByte)}if(_.size>this.cacheSize)throw new bp(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:d}}hasBand(t){const{blockIndex:a}=this.getBlockForBand(t);return a>=0}hasDataForBand(t){const{blockIndex:a}=this.getBlockForBand(t);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(t){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(t);if(a<0)throw new bp(`Band not found: ${JSON.stringify(t)}`);const d=this._decodedBlocks.get(a.toString());if(!d)throw new bp(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[a],x=this.bandShape.reduce(((L,F)=>L*F),1),S=u*x,R=d.subarray(S,S+x);return{data:R,bytes:new Uint8Array(R.buffer).subarray(R.byteOffset,R.byteOffset+R.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}CS.setPbf=function(o){dA=o};class EP{constructor(t,a,u){this.tasks=t,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,a){this._finalized||(this._onComplete(t,a),this._finalized=!0)}}CS.performDecoding=function(o,t){const a=new Uint8Array(o);return Promise.all(t.tasks.map((u=>{const{layerName:d,firstByte:_,lastByte:x,pixelFormat:S,blockShape:R,blockIndex:L,filters:F,codec:U}=u,G=a.subarray(_,x+1),X=new Uint32Array(R[0]*R[1]*R[2]);let Z;if(U!=="gzip_data")throw new bp(`Unhandled codec: ${U}`);return Z=(function(ne,he){if(!globalThis.DecompressionStream&&he==="gzip_data")return Promise.resolve(((Ee=(function(He){He[0]==31&&He[1]==139&&He[2]==8||pm(6,"invalid gzip data");var Je=He[3],tt=10;4&Je&&(tt+=2+(He[10]|He[11]<<8));for(var It=(Je>>3&1)+(Je>>4&1);It>0;It-=!He[tt++]);return tt+(2&Je)})(xe=ne))+8>xe.length&&pm(6,"invalid gzip data"),(function(He,Je,tt,It){var ut=He.length;if(!ut||Je.f&&!Je.l)return tt||new zd(0);var Ot=!tt,Zt=Ot||Je.i!=2,Yt=Je.i;Ot&&(tt=new zd(3*ut));var li,ui,ri=function(bs){var es=tt.length;if(bs>es){var ss=new zd(Math.max(2*es,bs));ss.set(tt),tt=ss}},si=Je.f||0,zt=Je.p||0,Dt=Je.b||0,ai=Je.l,Ti=Je.d,pi=Je.m,dn=Je.n,Gi=8*ut;do{if(!ai){si=dm(He,zt,1);var Ki=dm(He,zt+1,3);if(zt+=3,!Ki){var cn=He[(Bt=4+((zt+7)/8|0))-4]|He[Bt-3]<<8,yr=Bt+cn;if(yr>ut){Yt&&pm(0);break}Zt&&ri(Dt+cn),tt.set(He.subarray(Bt,yr),Dt),Je.b=Dt+=cn,Je.p=zt=8*yr,Je.f=si;continue}if(Ki==1)ai=rG,Ti=sG,pi=9,dn=5;else if(Ki==2){var yi=dm(He,zt,31)+257,un=dm(He,zt+10,15)+4,Yn=yi+dm(He,zt+5,31)+1;zt+=14;for(var Ur=new zd(Yn),jr=new zd(19),cr=0;cr<un;++cr)jr[tG[cr]]=dm(He,zt+3*cr,7);zt+=3*un;var vs=hA(jr),Fe=(1<<vs)-1,Ve=v1(jr,vs);for(cr=0;cr<Yn;){var Bt,ci=Ve[dm(He,zt,Fe)];if(zt+=15&ci,(Bt=ci>>4)<16)Ur[cr++]=Bt;else{var Bi=0,Ni=0;for(Bt==16?(Ni=3+dm(He,zt,3),zt+=2,Bi=Ur[cr-1]):Bt==17?(Ni=3+dm(He,zt,7),zt+=3):Bt==18&&(Ni=11+dm(He,zt,127),zt+=7);Ni--;)Ur[cr++]=Bi}}var mn=Ur.subarray(0,yi),yn=Ur.subarray(yi);pi=hA(mn),dn=hA(yn),ai=v1(mn,pi),Ti=v1(yn,dn)}else pm(1);if(zt>Gi){Yt&&pm(0);break}}Zt&&ri(Dt+131072);for(var sr=(1<<pi)-1,hr=(1<<dn)-1,gr=zt;;gr=zt){var Or=(Bi=ai[fA(He,zt)&sr])>>4;if((zt+=15&Bi)>Gi){Yt&&pm(0);break}if(Bi||pm(2),Or<256)tt[Dt++]=Or;else{if(Or==256){gr=zt,ai=null;break}var Bn=Or-254;Or>264&&(Bn=dm(He,zt,(1<<($r=_P[cr=Or-257]))-1)+bP[cr],zt+=$r);var Zn=Ti[fA(He,zt)&hr],Wr=Zn>>4;if(Zn||pm(3),zt+=15&Zn,yn=nG[Wr],Wr>3){var $r=yP[Wr];yn+=fA(He,zt)&(1<<$r)-1,zt+=$r}if(zt>Gi){Yt&&pm(0);break}Zt&&ri(Dt+131072);var Jr=Dt+Bn;if(Dt<yn){var hs=0-yn,Cs=Math.min(yn,Jr);for(hs+Dt<0&&pm(3);Dt<Cs;++Dt)tt[Dt]=(void 0)[hs+Dt]}for(;Dt<Jr;++Dt)tt[Dt]=tt[Dt-yn]}}Je.l=ai,Je.p=gr,Je.b=Dt,Je.f=si,ai&&(si=1,Je.m=pi,Je.d=Ti,Je.n=dn)}while(!si);return Dt!=tt.length&&Ot?(li=tt,((ui=Dt)==null||ui>li.length)&&(ui=li.length),new zd(li.subarray(0,ui))):tt.subarray(0,Dt)})(xe.subarray(Ee,-8),{i:2},new zd(((ce=xe)[(_e=ce.length)-4]|ce[_e-3]<<8|ce[_e-2]<<16|ce[_e-1]<<24)>>>0))));var ce,_e,xe,Ee;const ke=cG[he];if(!ke)throw new Error(`Unhandled codec: ${he}`);const Be=new globalThis.DecompressionStream(ke);return new Response(new Blob([ne]).stream().pipeThrough(Be)).arrayBuffer().then((He=>new Uint8Array(He)))})(G,U).then((ne=>((function(he,ce){he.readFields(Y8,ce)})(new dA(ne),X),new hG[S](X.buffer)))),Z.then((ne=>{for(let he=F.length-1;he>=0;he--)switch(F[he]){case"delta_filter":$8(ne,R);break;case"zigzag_filter":J8(ne);break;case"bitshuffle_filter":Q8(ne,S);break;default:throw new bp(`Unhandled filter "${F[he]}"`)}return{layerName:d,blockIndex:L,data:ne}})).catch((ne=>{throw ne}))})))},oi(EP,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),oi(CS,"MapboxRasterTile"),oi(MP,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class AP{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const u=t[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class CP{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ph(gi,16,0),this.featureIndexArray=new yc,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,a,u,d,_,x=0,S=0){const R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,_,x);const L=this.grid;for(let F=0;F<a.length;F++){const U=a[F],G=[1/0,1/0,-1/0,-1/0];for(let X=0;X<U.length;X++){const Z=U[X];G[0]=Math.min(G[0],Z.x),G[1]=Math.min(G[1],Z.y),G[2]=Math.max(G[2],Z.x),G[3]=Math.max(G[3],Z.y)}S!==0&&(G[0]-=S,G[1]-=S,G[2]+=S,G[3]+=S),G[0]<gi&&G[1]<gi&&G[2]>=0&&G[3]>=0&&L.insert(R,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new nt(new rS(this.rawTileData)).layers,this.sourceLayerCoder=new AP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,a){const{tilespaceGeometry:u,transform:d,tileTransform:_,pixelPosMatrix:x,availableImages:S,worldview:R}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const L=a.queryRadius?a.queryRadius:0,F=u.bufferedTilespaceBounds,U=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,((ne,he,ce,_e)=>fe(u.bufferedTilespaceGeometry,ne-L,he-L,ce+L,_e+L)));U.sort(fG);let G=null;d.elevation&&U.length>0&&(G=rx.create(d.elevation,this.tileID));const X={};let Z;for(let ne=0;ne<U.length;ne++){const he=U[ne];if(he===Z)continue;Z=he;const ce=this.featureIndexArray.get(he);let _e=null;this.is3DTile?this.loadMatchingModelFeature(X,ce,t,u,d,R):this.loadMatchingFeature(X,ce,t,S,R,((xe,Ee,ke,Be=0)=>(_e||(_e=Ye(xe,this.tileID.canonical,_)),Ee.queryIntersectsFeature(u,xe,ke,_e,this.z,d,x,G,Be))))}return X}loadMatchingFeature(t,a,u,d,_,x){const{featureIndex:S,bucketIndex:R,sourceLayerIndex:L,layoutVertexArrayOffset:F}=a,U=this.bucketLayerIDs[R],G=u.layers,X=Object.keys(G);if(X.length&&!it(X,U))return;const Z=u.sourceCache,ne=this.sourceLayerCoder.decode(L),he=this.vtLayers[ne].feature(S),ce=this.getId(he,ne);for(let _e=0;_e<U.length;_e++){const xe=U[_e];if(!G[xe])continue;const{styleLayer:Ee,targets:ke}=G[xe];let Be={};ce!==void 0&&(Be=Z.getFeatureState(Ee.sourceLayer,ce));const He=!x||x(he,Ee,Be,F);if(!He)continue;const Je=new B0(he,this.z,this.x,this.y,ce);Je.tile=this.tileID.canonical,Je.state=Be;let tt=this.serializedLayersCache.get(xe);tt||(tt=Ee.serialize(),tt.id=xe,this.serializedLayersCache.set(xe,tt)),Je.source=tt.source,Je.sourceLayer=tt["source-layer"],Je.layer=Object.assign({},tt),Je.layer.paint=RP(tt.paint,Ee.paint,he,Be,d),Je.layer.layout=RP(tt.layout,Ee.layout,he,Be,d);let It=!1;for(const ut of ke){this.updateFeatureProperties(Je,ut);const{filter:Ot}=ut;if(Ot){if(he.properties=Je.properties,Ot.needGeometry){const Zt=ct(he,!0);if(!Ot.filter(new ms(this.tileID.overscaledZ,{worldview:_}),Zt,this.tileID.canonical))continue}else if(!Ot.filter(new ms(this.tileID.overscaledZ,{worldview:_}),he))continue}It=!0,ut.targetId&&this.addFeatureVariant(Je,ut)}It&&this.appendToResult(t,xe,S,Je,He)}}loadMatchingModelFeature(t,a,u,d,_,x){const{featureIndex:S,bucketIndex:R}=a,L=this.bucketLayerIDs[R],F=u.layers,U=Object.keys(F);if(!U.length||it(U,L))for(let G=0;G<L.length;G++){const X=L[G],{styleLayer:Z,targets:ne}=F[X];if(Z.type!=="model")continue;const he=d.tile,ce=he.getBucket(Z);if(!(ce&&ce instanceof bS))continue;const _e=x8(ce,S,d,_);if(!_e)continue;const{z:xe,x:Ee,y:ke}=he.tileID.canonical,{feature:Be,intersectionZ:He,position:Je}=_e;let tt={};Be.id!==void 0&&(tt=u.sourceCache.getFeatureState(Z.sourceLayer,Be.id));const It=new B0({},xe,Ee,ke,Be.id);It.tile=this.tileID.canonical,It.state=tt,It.properties=Be.properties,It.geometry={type:"Point",coordinates:[Je.lng,Je.lat]};let ut=this.serializedLayersCache.get(X);ut||(ut=Z.serialize(),ut.id=X,this.serializedLayersCache.set(X,ut)),It.source=ut.source,It.sourceLayer=ut["source-layer"],It.layer=Object.assign({},ut);let Ot=!1;for(const Zt of ne){this.updateFeatureProperties(It,Zt);const{filter:Yt}=Zt;if(Yt){if(Be.properties=It.properties,Yt.needGeometry){if(!Yt.filter(new ms(this.tileID.overscaledZ,{worldview:x}),Be,this.tileID.canonical))continue}else if(!Yt.filter(new ms(this.tileID.overscaledZ,{worldview:x}),Be))continue}Ot=!0,Zt.targetId&&this.addFeatureVariant(It,Zt)}Ot&&this.appendToResult(t,X,S,It,He)}}updateFeatureProperties(t,a,u){if(a.properties){const d={};for(const _ in a.properties){const x=a.properties[_].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,u);x!=null&&(d[_]=x)}t.properties=d}}addFeatureVariant(t,a,u){const d={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(d.properties=t.properties),t.variants=t.variants||{},t.variants[a.targetId]=t.variants[a.targetId]||[],t.variants[a.targetId].push(d)}appendToResult(t,a,u,d,_){let x=t[a];x===void 0&&(x=t[a]=[]),x.push({featureIndex:u,feature:d,intersectionZ:_})}lookupSymbolFeatures(t,a,u,d,_,x){const S={};this.loadVTLayers();for(const R of t)this.loadMatchingFeature(S,{bucketIndex:a,sourceLayerIndex:u,featureIndex:R,layoutVertexArrayOffset:0},d,_,x);return S}loadFeature(t){const{featureIndex:a,sourceLayerIndex:u}=t;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),_=this.vtFeatures[d];if(_[a])return _[a];const x=this.vtLayers[d].feature(a);return _[a]=x,x}hasLayer(t){for(const a of this.bucketLayerIDs)for(const u of a)if(t===u)return!0;return!1}getId(t,a){let u=t.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const _=ka(d);if(_.result!=="success"){const x=_.value.map((S=>`${S.key}: ${S.message}`)).join(", ");return void ht(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=_.value}u=this.promoteIdExpression.evaluate({zoom:0},t)}else u=t.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function RP(o,t,a,u,d){return Tt(o,((_,x)=>{const S=t instanceof Bh?t.get(x):null;return S&&S.evaluate?S.evaluate(a,u,void 0,d):S}))}function fG(o,t){return t-o}oi(CP,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const IP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pA{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=IP[15&u];if(!_)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[S]=new Uint32Array(t,4,1);return new pA(S,x,_,t)}constructor(t,a=64,u=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=IP.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,S=t*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-S%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+R,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+S+R),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+R,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=a,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return mA(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:S}=this,R=[0,_.length-1,0],L=[];for(;R.length;){const F=R.pop()||0,U=R.pop()||0,G=R.pop()||0;if(U-G<=S){for(let he=G;he<=U;he++){const ce=x[2*he],_e=x[2*he+1];ce>=t&&ce<=u&&_e>=a&&_e<=d&&L.push(_[he])}continue}const X=G+U>>1,Z=x[2*X],ne=x[2*X+1];Z>=t&&Z<=u&&ne>=a&&ne<=d&&L.push(_[X]),(F===0?t<=Z:a<=ne)&&(R.push(G),R.push(X-1),R.push(1-F)),(F===0?u>=Z:d>=ne)&&(R.push(X+1),R.push(U),R.push(1-F))}return L}within(t,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:x}=this,S=[0,d.length-1,0],R=[],L=u*u;for(;S.length;){const F=S.pop()||0,U=S.pop()||0,G=S.pop()||0;if(U-G<=x){for(let he=G;he<=U;he++)LP(_[2*he],_[2*he+1],t,a)<=L&&R.push(d[he]);continue}const X=G+U>>1,Z=_[2*X],ne=_[2*X+1];LP(Z,ne,t,a)<=L&&R.push(d[X]),(F===0?t-u<=Z:a-u<=ne)&&(S.push(G),S.push(X-1),S.push(1-F)),(F===0?t+u>=Z:a+u>=ne)&&(S.push(X+1),S.push(U),S.push(1-F))}return R}}function mA(o,t,a,u,d,_){if(d-u<=a)return;const x=u+d>>1;DP(o,t,x,u,d,_),mA(o,t,a,u,x-1,1-_),mA(o,t,a,x+1,d,1-_)}function DP(o,t,a,u,d,_){for(;d>u;){if(d-u>600){const L=d-u+1,F=a-u+1,U=Math.log(L),G=.5*Math.exp(2*U/3),X=.5*Math.sqrt(U*G*(L-G)/L)*(F-L/2<0?-1:1);DP(o,t,a,Math.max(u,Math.floor(a-F*G/L+X)),Math.min(d,Math.floor(a+(L-F)*G/L+X)),_)}const x=t[2*a+_];let S=u,R=d;for(w1(o,t,u,a),t[2*d+_]>x&&w1(o,t,u,d);S<R;){for(w1(o,t,S,R),S++,R--;t[2*S+_]<x;)S++;for(;t[2*R+_]>x;)R--}t[2*u+_]===x?w1(o,t,u,R):(R++,w1(o,t,R,d)),R<=a&&(u=R+1),a<=R&&(d=R-1)}}function w1(o,t,a,u){gA(o,a,u),gA(t,2*a,2*u),gA(t,2*a+1,2*u+1)}function gA(o,t,a){const u=o[t];o[t]=o[a],o[a]=u}function LP(o,t,a,u){const d=o-a,_=t-u;return d*d+_*_}r.$=zp,r.A=Hl,r.B=gc,r.C=2,r.D=Xe,r.E=of,r.F=n1,r.G=rL,r.H=ku,r.I=Po,r.J=Sg,r.K=sn,r.L=sd,r.M=bu,r.N=md,r.O=rh,r.P=Xt,r.Q=_d,r.R=ru,r.S=Yp,r.T=TE,r.U=ka,r.V=vS,r.W=ah,r.X=ea,r.Y=Ku,r.Z=Xa,r._=Xo,r.a=function(o){return Tn.API_CDN_URL_REGEX.test(o)},r.a$=Q,r.a0=fn,r.a1=lc,r.a2=Hc,r.a3=class extends vS{},r.a4=gd,r.a5=vu,r.a6=dt,r.a7=function(o){const t=o.value;return t?fn(t)?tA(t,!0)?[]:[new vS(o.key,t,`invalid url "${t}"`)]:[new vS(o.key,t,`string expected, "${sn(t)}" found`)]:[]},r.a8=qm,r.a9=Ys,r.aA=oe,r.aB=ae,r.aC=De,r.aD=cs,r.aE=te,r.aF=D,r.aG=we,r.aH=function(o,t){const a={};for(let u=0;u<t.length;u++){const d=t[u];d in o&&(a[d]=o[d])}return a},r.aI=m,r.aJ=O,r.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,t,a,u){const d=this.entries[o]=this.entries[o]||{callbacks:[]};if(d.result){const[_,x]=d.result;return this.scheduler?this.scheduler.add((()=>{u(_,x)}),t):u(_,x),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a(((_,x)=>{d.result=[_,x];for(const S of d.callbacks)this.scheduler?this.scheduler.add((()=>{S(_,x)}),t):S(_,x);setTimeout((()=>delete this.entries[o]),3e3)}))),()=>{d.result||(d.callbacks=d.callbacks.filter((_=>_!==u)),d.callbacks.length||(d.cancel(),delete this.entries[o]))}}},r.aL=function(o,t,a){const u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},(d=>{const _=il(o.request,((x,S,R)=>{x?d(x):S&&d(null,{rawData:S,vectorTile:a?void 0:new nt(new rS(S)),responseHeaders:new Map(R.entries())})}));return()=>{_.cancel(),d()}}),t)},r.aM=function(o){return o?{cacheControl:o.get("Cache-Control"),expires:o.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=Na,r.aO=function(o){Ka++,Ka>tf&&(o.getActor().send("enforceCacheSizeLimit",wl),Ka=0)},r.aP=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},r.aQ=Pt,r.aR=PL,r.aS=UL,r.aT=c,r.aU=LL,r.aV=function(o,t){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){t(null,a)};for(let u=0;u<o.length;u++){const d=document.createElement("source");zm(o[u])||(a.crossOrigin="Anonymous"),d.src=o[u],a.appendChild(d)}return{cancel:()=>{}}},r.aW=Jv,r.aX=N0,r.aY=lt,r.aZ=o1,r.a_=H,r.aa=fi,r.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,t){return bi(o.expression.evaluate(t))}interpolate(o,t,a){return{x:Rn(o.x,t.x,a),y:Rn(o.y,t.y,a),z:Rn(o.z,t.z,a),azimuthal:Rn(o.azimuthal,t.azimuthal,a),polar:Rn(o.polar,t.polar,a)}}},r.ac=ms,r.ad=Oo,r.ae=be,r.af=xn,r.ag=kt,r.ah=ge,r.ai=Bh,r.aj=bc,r.ak=Rn,r.al=gi,r.am=Pp,r.an=Ar,r.ao=qr,r.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,t){return(function([a,u]){const d=bi([1,a,u]);return{x:d.x,y:d.y,z:d.z}})(o.expression.evaluate(t))}interpolate(o,t,a){return{x:Rn(o.x,t.x,a),y:Rn(o.y,t.y,a),z:Rn(o.z,t.z,a)}}},r.aq=function(o,t,a=0,u=!0){const d=new Xt(a,a),_=o.sub(d),x=t.add(d),S=[_,new Xt(x.x,_.y),x,new Xt(_.x,x.y)];return u&&S.push(_.clone()),S},r.ar=function(o,t){const a=[];for(let u=0;u<o.length;u++){const d=Ie(u-1,-1,o.length-1),_=Ie(u+1,-1,o.length-1),x=o[u],S=o[_],R=o[d].sub(x).unit(),L=S.sub(x).unit(),F=L.angleWithSep(R.x,R.y),U=R.add(L).unit().mult(-1*t/Math.sin(F/2));a.push(x.add(U))}return a},r.as=_L,r.at=fe,r.au=function(o,t,a=0){return Re(((t.x-a)*o.scale-o.x)*gi,(t.y*o.scale-o.y)*gi,K(t.z,t.y))},r.av=Di,r.aw=Ui,r.ax=Si,r.ay=LD,r.az=function(o){let t=1/0,a=1/0,u=-1/0,d=-1/0;for(const _ of o)t=Math.min(t,_.x),a=Math.min(a,_.y),u=Math.max(u,_.x),d=Math.max(d,_.y);return{min:new Xt(t,a),max:new Xt(u,d)}},r.b=function(o){return Tn.API_FONTS_REGEX.test(o)},r.b$=jy,r.b0=Aa,r.b1=Sd,r.b2=at,r.b3=pp,r.b4=gS,r.b5=function(){Vc.isLoading()||Vc.isLoaded()||zh()!=="deferred"||up()},r.b6=xd,r.b7=ct,r.b8=B0,r.b9=pn,r.bA=ie,r.bB=ze,r.bC=$,r.bD=function(o,t){const{x:a,y:u}=o.point,d=rm(a,u,o.worldSize/o._pixelsPerMercatorPixel,0,0);return ae(d,d,d0(uh(t)))},r.bE=z,r.bF=Xi,r.bG=ki,r.bH=ii,r.bI=Fn,r.bJ=rn,r.bK=Qy,r.bL=Vh,r.bM=GE,r.bN=function(o,t,a,u,d){const _=5*t+2;o.float32[_+0]=a,o.float32[_+1]=u,o.float32[_+2]=d},r.bO=nx,r.bP=Xn,r.bQ=Rt,r.bR=Nn,r.bS=Kn,r.bT=Ie,r.bU=function(o,t,a,u){var d=new I(4);return d[0]=o,d[1]=t,d[2]=a,d[3]=u,d},r.bV=class{isDataAvailableAtPoint(o){const t=this._source();if(this.isUsingMockSource()||!t||o.y<0||o.y>1)return!1;const a=t.getSource().maxzoom,u=1<<a,d=Math.floor(o.x),_=Math.floor((o.x-d)*u),x=Math.floor(o.y*u),S=this.findDEMTileFor(new Pt(a,d,a,_,x));return!(!S||!S.dem)}getAtPointOrZero(o,t=0){return this.getAtPoint(o,t)||0}getAtPoint(o,t,a=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const u=this._source();if(!u||o.y<0||o.y>1)return t;const d=u.getSource().maxzoom,_=1<<d,x=Math.floor(o.x),S=o.x-x,R=new Pt(d,x,d,Math.floor(S*_),Math.floor(o.y*_)),L=this.findDEMTileFor(R);if(!L||!L.dem)return t;const F=L.dem,U=1<<L.tileID.canonical.z,G=(S*U-L.tileID.canonical.x)*F.dim,X=(o.y*U-L.tileID.canonical.y)*F.dim,Z=Math.floor(G),ne=Math.floor(X);return(a?this.exaggeration():1)*Rn(Rn(F.get(Z,ne),F.get(Z,ne+1),X-ne),Rn(F.get(Z+1,ne),F.get(Z+1,ne+1),X-ne),G-Z)}static getAtTileOffset(o,t,a,u){const d=1<<o.canonical.z;return u?u.pointElevation(t):a?a.getAtPointOrZero(new be(o.wrap+(o.canonical.x+t.x/gi)/d,(o.canonical.y+t.y/gi)/d)):0}static getAtTileOffsetFunc(o,t,a,u){return(d,_,x)=>{const S=this.getAtTileOffset(o,d,_,x),R=u.upVector(o.canonical,d.x,d.y);return Vt(R,R,S*u.upVectorScale(o.canonical,t,a).metersToTile),R}}getForTilePoints(o,t,a,u){if(this.isUsingMockSource())return!1;const d=rx.create(this,o,u);return!!d&&(t.forEach((_=>{_[2]=this.exaggeration()*d.getElevationAt(_[0],_[1],a)})),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(o);if(!t||!t.dem)return null;const a=t.dem.tree,u=t.tileID,d=1<<o.canonical.z-u.canonical.z;let _=o.canonical.x/d-u.canonical.x,x=o.canonical.y/d-u.canonical.y,S=0;for(let R=0;R<o.canonical.z-u.canonical.z&&!a.leaves[S];R++){_*=2,x*=2;const L=2*Math.floor(x)+Math.floor(_);S=a.childOffsets[S]+L,_%=1,x%=1}return{min:this.exaggeration()*a.minimums[S],max:this.exaggeration()*a.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,t,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let t=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of o){const _=this.getMinMaxForTile(d.tileID);_&&(a=Math.min(a,_.min),u=Math.max(u,_.max),t=!0)}return t?{min:a,max:u}:null}},r.bW=um,r.bX=pr,r.bY=ko,r.bZ=b0,r.b_=kL,r.ba=PE,r.bb=Vv,r.bc=Ye,r.bd=Tf,r.be=no,r.bf=As,r.bg=Es,r.bh=d_,r.bi=QE,r.bj=function(o,t){const a=bc(t.zoom);if(a===0)return uh(o);const u=u0(o),d=Mv(u),_=D(u.getWest())*t.worldSize,x=D(u.getEast())*t.worldSize,S=O(u.getNorth())*t.worldSize,R=O(u.getSouth())*t.worldSize,L=[_,S,0],F=[x,S,0],U=[_,R,0],G=[x,R,0],X=Y([],t.globeMatrix);return xn(L,L,X),xn(F,F,X),xn(U,U,X),xn(G,G,X),d[0]=ks(d[0],U,a),d[1]=ks(d[1],G,a),d[2]=ks(d[2],F,a),d[3]=ks(d[3],L,a),Yi.fromPoints(d)},r.bk=nm,r.bl=Y,r.bm=h0,r.bn=ks,r.bo=Mf,r.bp=Hr,r.bq=je,r.br=ue,r.bs=CS,r.bt=rS,r.bu=il,r.bv=function(o,t){const a=[];for(const u in o)u in t||a.push(u);return a},r.bw=$e,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=ja,r.bz=re,r.c=Qr,r.c$=function(o,t,a){let u=0;for(let d=0;d<2;++d)o[d]>0&&(u+=(o[d]-0)*(o[d]-0)),t[d]<0&&(u+=(0-t[d])*(0-t[d]));return u},r.c0=Vw,r.c1=UE,r.c2=hL,r.c3=WE,r.c4=pA,r.c5=Vt,r.c6=Sn,r.c7=Li,r.c8=function(o,t,a){a*=.5;var u=t[0],d=t[1],_=t[2],x=t[3],S=Math.sin(a),R=Math.cos(a);return o[0]=u*R+d*S,o[1]=d*R-u*S,o[2]=_*R+x*S,o[3]=x*R-_*S,o},r.c9=Wi,r.cA=mt,r.cB=Lr,r.cC=_D,r.cD=Yr,r.cE=vw,r.cF=function(o,t,a,u,d,_,x,S,R){if(R.name==="globe")return vw(o,t,new Yr(a,u,d),!1);const L=o1({z:a,x:u,y:d},R);return new Yi([(_+L.x/L.scale)*t,t*(L.y/L.scale),x],[(_+L.x2/L.scale)*t,t*(L.y2/L.scale),S])},r.cG=function(o,t,a){return o[0]=Math.min(t[0],a[0]),o[1]=Math.min(t[1],a[1]),o[2]=Math.min(t[2],a[2]),o[3]=Math.min(t[3],a[3]),o},r.cH=function(o,t,a){return o[0]=Math.max(t[0],a[0]),o[1]=Math.max(t[1],a[1]),o[2]=Math.max(t[2],a[2]),o[3]=Math.max(t[3],a[3]),o},r.cI=function(o){const t=Math.round((o+45+360)%360/90)%4;return Bu[t]},r.cJ=ee,r.cK=Gn,r.cL=zf,r.cM=function(o){const t=ie(new Float64Array(16));ae(t,o.pixelMatrix,o.globeMatrix);const a=[0,zl,0],u=[0,rs,0];return xn(a,a,t),xn(u,u,t),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!Ev(o,new c(o.center.lat,90)),u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!Ev(o,new c(o.center.lat,-90))]},r.cN=function(o,t){const{scale:a}=o.tileTransform,u=a*gi/(o.tileSize*Math.pow(2,t.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(d,_,x){var S=_[1],R=_[2],L=_[3],F=x[0],U=x[1];return d[0]=_[0]*F,d[1]=S*F,d[2]=R*U,d[3]=L*U,d})(new Float32Array(4),t.inverseAdjustmentMatrix,[u,u])},r.cO=Jw,r.cP=Mt,r.cQ=gD,r.cR=function(o){const t=gD(o,!0);return z([],[t[0],t[1],t[4],t[5]])},r.cS=me,r.cT=Ai,r.cU=Ae,r.cV=function(o){const{x:t,y:a}=o.point,{lng:u,lat:d}=o._center;return rm(t,a,o.worldSize,u,d)},r.cW=jt,r.cX=js,r.cY=$t,r.cZ=We,r.c_=go,r.ca=Un,r.cb=function(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o[3]=t[3],o},r.cc=Ze,r.cd=function(o,t,a,u,d){var _=1/Math.tan(t/2);if(o[0]=_/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,d!=null&&d!==1/0){var x=1/(u-d);o[10]=(d+u)*x,o[14]=2*d*u*x}else o[10]=-1,o[14]=-2*u;return o},r.ce=function(o,t,a,u,d,_,x){var S=1/(t-a),R=1/(u-d),L=1/(_-x);return o[0]=-2*S,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*R,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*L,o[11]=0,o[12]=(t+a)*S,o[13]=(d+u)*R,o[14]=(x+_)*L,o[15]=1,o},r.cf=V,r.cg=function(o,t,a){o[4*t+0]=a[0],o[4*t+1]=a[1],o[4*t+2]=a[2],o[4*t+3]=a[3]},r.ch=Lf,r.ci=Yc,r.cj=_a,r.ck=Ga,r.cl=Ks,r.cm=wL,r.cn=function(){var o=new I(4);return I!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},r.co=function(o,t,a){var u=t[0],d=t[1],_=t[2],x=t[3],S=Math.sin(a),R=Math.cos(a);return o[0]=u*R+_*S,o[1]=d*R+x*S,o[2]=u*-S+_*R,o[3]=d*-S+x*R,o},r.cp=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]},r.cq=Ji,r.cr=function(o){var t=o[0],a=o[1],u=o[2],d=o[3];return Math.sqrt(t*t+a*a+u*u+d*d)},r.cs=Jn,r.ct=st,r.cu=Kt,r.cv=3,r.cw=2,r.cx=7,r.cy=6,r.cz=Er,r.d=function(o){return Tn.API_TILEJSON_REGEX.test(o)},r.d$=class{constructor(o,t,a,u){this.context=o,this.format=u,this.size=a,this.texture=o.gl.createTexture();const[d,_,x]=this.size,{gl:S}=o;S.bindTexture(S.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&S.texImage3D(S.TEXTURE_3D,0,this.format,d,_,x,0,wE(this.format),SE(this.format),t.data)}bind(o,t){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),o!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,o),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,o),this.minFilter=o),t!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},r.d0=function(o){return o*o*o*o*o},r.d1=A,r.d2=45,r.d3=Kc,r.d4=function(o,t,a){const u=Math.sqrt(o*o+t*t+a*a),d=u>0?Math.acos(a/u)*ac:0;let _=o!==0||t!==0?Math.atan2(-t,-o)*ac+90:0;return _<0&&(_+=360),[u,_,d]},r.d5=Re,r.d6=bi,r.d7=de,r.d8=et,r.d9=Yi,r.dA=function(o){return o({pluginStatus:Bo,pluginURL:Eu}),Pa.on("pluginStateChange",o),o},r.dB=oh,r.dC=class extends dl{constructor(o){super(o),this.current=_p}set(o,t,a){if(this.fetchUniformLocation(o,t)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},r.dD=Lo,r.dE=function(o,t,a){const u=bc(a.zoom),d=o.style.map._antialias,_=o.terrain&&o.terrain.exaggeration()>0;return u===0&&!d&&!_},r.dF=function(o){const t=o.pixelsPerMeter,a=t/V(1,o.center.lat),u=ie(new Float64Array(16));return ue(u,u,[o.point.x,o.point.y,0]),me(u,u,[a,a,t]),Float32Array.from(u)},r.dG=u0,r.dH=function(o){const t=ee-5;o=oe(o,-t,t)/t*90;const a=Math.pow(Math.abs(Math.sin(Ar(o))),3);return Math.round(a*(Km.length-1))},r.dI=function(o,t,a,u){const d=t.getNorth(),_=t.getSouth(),x=t.getWest(),S=t.getEast(),R=1<<o.z,L=S-x,F=d-_,U=L/Du,G=-F/Km[a],X=[0,U,0,G,0,0,d,x,0];if(o.z>0){const Z=180/u;j(X,X,[Z/L+1,0,0,0,Z/F+1,0,-.5*Z/U,.5*Z/G,1])}return X[2]=R,X[5]=o.x,X[8]=o.y,X},r.dJ=uh,r.dK=function(o,t,a){const u=ie(new Float64Array(16)),d=(t/(1<<o)-.5)*Math.PI*2;return Se(u,a.globeMatrix,d),Float32Array.from(u)},r.dL=Dv,r.dM=fa,r.dN=function(o,t){return[Math.pow(o[0],2.2)*t,Math.pow(o[1],2.2)*t,Math.pow(o[2],2.2)*t]},r.dO=N,r.dP=function(o,t){var a=Math.sin(t),u=Math.cos(t);return o[0]=u,o[1]=a,o[2]=0,o[3]=-a,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},r.dQ=Vi,r.dR=Ly,r.dS=Cn,r.dT=or,r.dU=256,r.dV=function(o,t){const a=[0,0,0];return xn(a,a,nm(uh(t.canonical))),xn(a,a,o),a},r.dW=o=>({u_matrix:new Ks(o),u_texsize:new Ga(o),u_pixels_to_tile_units:new lh(o),u_device_pixel_ratio:new _a(o),u_width_scale:new _a(o),u_floor_width_scale:new _a(o),u_image:new Lf(o),u_units_to_pixels:new Ga(o),u_tile_units_to_pixels:new _a(o),u_alpha_discard_threshold:new _a(o),u_trim_offset:new Ga(o),u_trim_fade_range:new Ga(o),u_trim_color:new Kc(o),u_zbias_factor:new _a(o),u_tile_to_meter:new _a(o),u_ground_shadow_factor:new Yc(o),u_pattern_transition:new _a(o)}),r.dX=o=>({u_matrix:new Ks(o),u_pixels_to_tile_units:new lh(o),u_device_pixel_ratio:new _a(o),u_width_scale:new _a(o),u_floor_width_scale:new _a(o),u_units_to_pixels:new Ga(o),u_dash_image:new Lf(o),u_gradient_image:new Lf(o),u_image_height:new _a(o),u_texsize:new Ga(o),u_tile_units_to_pixels:new _a(o),u_alpha_discard_threshold:new _a(o),u_trim_offset:new Ga(o),u_trim_fade_range:new Ga(o),u_trim_color:new Kc(o),u_zbias_factor:new _a(o),u_tile_to_meter:new _a(o),u_ground_shadow_factor:new Yc(o)}),r.dY=o=>({u_camera_to_center_distance:new _a(o),u_extrude_scale:new lh(o),u_device_pixel_ratio:new _a(o),u_matrix:new Ks(o),u_inv_rot_matrix:new Ks(o),u_merc_center:new Ga(o),u_tile_id:new Yc(o),u_zoom_transition:new _a(o),u_up_dir:new Yc(o),u_emissive_strength:new _a(o)}),r.dZ=kh,r.d_=S6,r.da=Lt,r.db=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},r.dc=mD,r.dd=IE,r.de=vD,r.df=tA,r.dg=function(o,t){return o.readFields(w8,{icons:[]},t)},r.dh=Hi,r.di=ex,r.dj=jE,r.dk=ed,r.dl=yd,r.dm=ma,r.dn=af,r.dp=ye,r.dq=function(o){const t=o.indexOf(Sf);return t>=0?o.slice(0,t):o},r.dr=function(o){return o.indexOf(Sf)>=0},r.ds=function(o){const t=o.lastIndexOf(Sf);return t>=0?o.slice(t+1):""},r.dt=function(o){const t=[],a=o.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),o.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},r.du=function(o,t,a,u){return o.type==="custom"?new m8(o,t):new v8[o.type](o,t,a,u)},r.dv=Wt,r.dw=function(o){const t=o.indexOf(Sf);return t>=0?o.slice(t+1):""},r.dx=class extends B0{constructor(o,t){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},r.dy=Pa,r.dz=su,r.e=Tn,r.e$=Qe,r.e0=Tw,r.e1=(o,t,a,u,d,_)=>{const x=o.transform,S=x.projection.name==="globe";let R;if(_.paint.get("circle-pitch-alignment")==="map")if(S){const F=Ly(x.zoom,t.canonical)*x._pixelsPerMercatorPixel;R=Float32Array.from([F,0,0,F])}else R=x.calculatePixelsToTileUnitsMatrix(a);else R=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const L={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(x.projection),u_matrix:o.translatePosMatrix(t.projMatrix,a,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:xs.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Sw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(S){L.u_inv_rot_matrix=u,L.u_merc_center=d,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=bc(x.zoom);const F=d[0]*gi,U=d[1]*gi;L.u_up_dir=x.projection.upVector(new Yr(0,0,0),F,U)}return L},r.e2=BD,r.e3=Fa,r.e4=(o,t,a,u,d,_,x,S,R,L)=>{const F=o.transform,U=F.pitch<15?PD(.07,.7,oe((14-F.zoom)/5,0,1)):.07,G=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:OD(o,t,a,u),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:F.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:d,u_width_scale:_,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:zD(t,F),u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(G?null:a.lut).toArray01(),u_zbias_factor:U,u_tile_to_meter:de(t.tileID.canonical,0),u_ground_shadow_factor:R,u_pattern_transition:L}},r.e5=(o,t,a,u,d,_,x,S,R,L)=>{const F=o.transform,U=F.calculatePixelsToTileUnitsMatrix(t),G=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",X=F.pitch<15?PD(.07,.7,oe((14-F.zoom)/5,0,1)):.07;return{u_matrix:OD(o,t,a,u),u_pixels_to_tile_units:U,u_device_pixel_ratio:_,u_width_scale:x,u_floor_width_scale:S,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:ND(a)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zD(t,o.transform),u_alpha_discard_threshold:0,u_trim_offset:R,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(G?null:a.lut).toArray01(),u_zbias_factor:X,u_tile_to_meter:de(t.tileID.canonical,0),u_ground_shadow_factor:L}},r.e6=At,r.e7=Rg,r.e8=K,r.e9=ln,r.eA=function(o,t){var a=2*Math.acos(t[3]),u=Math.sin(a/2);return u>C?(o[0]=t[0]/u,o[1]=t[1]/u,o[2]=t[2]/u):(o[0]=1,o[1]=0,o[2]=0),a},r.eB=rA,r.eC=tS,r.eD=eS,r.eE=[1,1,1],r.eF=rx,r.eG=_n,r.eH=function(o,t,a,u){var d=t[0],_=t[1],x=t[2],S=t[3];return o[0]=d+u*(a[0]-d),o[1]=_+u*(a[1]-_),o[2]=x+u*(a[2]-x),o[3]=S+u*(a[3]-S),o},r.eI=Yy,r.eJ=Jl,r.eK=Xc,r.eL=function(o,t,a,u,d,_,x,S,R,L,F,U,G,X,Z,ne){var he=new I(16);return he[0]=o,he[1]=t,he[2]=a,he[3]=u,he[4]=d,he[5]=_,he[6]=x,he[7]=S,he[8]=R,he[9]=L,he[10]=F,he[11]=U,he[12]=G,he[13]=X,he[14]=Z,he[15]=ne,he},r.eM=p,r.eN=Ed,r.eO=dp,r.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Xt(1/0,1/0),max:new Xt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,t=!1){const a=jv(new Xt(0,0),new Xt(gi,gi),o),u=[];if(t&&!w_(a,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!w_(a,d))continue;const _=yE(d.min,d.max,o);u.push({min:_.min,max:_.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(o){this._setSources(o.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const a=[];for(const u of t.cache.getVisibleCoordinates()){const d=t.cache.getTile(u).buckets[t.layer];d&&d.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope}))))}_addSource(o){const t=o.getFootprints();if(t.length===0)return;const a=o.getOrder(),u=o.getClipMask(),d=o.getClipScope();for(const _ of t){if(!_.footprint)continue;const x=jv(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:a,clipMask:u,clipScope:d})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort(((t,a)=>t.priority-a.priority||b_(t.min,a.min)||b_(t.max,a.max)||t.order-a.order||t.clipMask-a.clipMask||(function(u,d){const _=(x,S)=>x+S;return u.length-d.length||u.reduce(_,"").localeCompare(d.reduce(_,""))})(t.clipScope,a.clipScope)));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let t=0;for(;!o&&t!==this._activeRegions.length;){const a=this._activeRegions[t],u=this._prevRegions[t];o=a.priority!==u.priority||!Gy(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!ja(a.clipScope,u.clipScope),this._activeRegions[t].hiddenByOverlap=u.hiddenByOverlap,++t}}if(o){++this._updateTime;for(const a of this._activeRegions)a.order!==om&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const t=a=>{const u=this._activeRegions;if(a>=u.length)return a;const d=u[a].priority;for(;a<u.length&&u[a].priority===d;)++a;return a};if(this._sourceIds.length>1){let a=0,u=t(a);for(;a!==u;){let d=a;const _=a;for(;d!==u;){const x=this._activeRegions[d];x.hiddenByOverlap=!1;for(let S=0;S<_;S++){const R=this._activeRegions[S];if(!R.hiddenByOverlap&&x.order===om&&w_(x,R)&&(x.hiddenByOverlap=kw(x.footprint,x.tileId,R.footprint,R.tileId),x.hiddenByOverlap))break}++d}a=u,u=t(a)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=o.length-1;t>=0;t--)this._addSource(o[t]);this._computeReplacement()}},r.eQ=om,r.eR=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,t){const a=new Tf,u=new Aa,d=[],_=o+1+2,x=t[0]+1,S=t[0]+1+(1+t.length),R=(L,F,U)=>{let G=L===_-1?L-2:L===0?L:L-1;return G+=U?24575:0,[G,F]};for(let L=0;L<_;++L)a.emplaceBack(...R(L,0,!0));for(let L=0;L<x;++L)for(let F=0;F<_;++F)a.emplaceBack(...R(F,L,(F===0||F===_-1)&&!0));for(let L=0;L<t.length;++L){const F=t[L];for(let U=0;U<_;++U)a.emplaceBack(...R(U,F,!0))}for(let L=0;L<t.length;++L){const F=u.length,U=t[L]+1+2,G=new Aa;for(let ne=0;ne<U-1;ne++){const he=ne===U-2,ce=he?_*(S-t.length+L-ne):_;for(let _e=0;_e<_-1;_e++){const xe=ne*_+_e;ne===0||he||_e===0||_e===_-2?(G.emplaceBack(xe+1,xe,xe+ce),G.emplaceBack(xe+ce,xe+ce+1,xe+1)):(u.emplaceBack(xe+1,xe,xe+ce),u.emplaceBack(xe+ce,xe+ce+1,xe+1))}}const X=Es.simpleSegment(0,F,a.length,u.length-F);for(let ne=0;ne<G.uint16.length;ne+=3)u.emplaceBack(G.uint16[ne],G.uint16[ne+1],G.uint16[ne+2]);const Z=Es.simpleSegment(0,F,a.length,u.length-F);d.push({withoutSkirts:X,withSkirts:Z})}return{vertices:a,indices:u,segments:d}}_createGrid(o){const t=this._fillGridMeshWithLods(Du,Km);this._gridSegments=t.segments,this._gridBuffer=o.createVertexBuffer(t.vertices,As.members),this._gridIndexBuffer=o.createIndexBuffer(t.indices,!0)}_createPoles(o){const t=new Aa;for(let x=0;x<=Du;x++)t.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=o.createIndexBuffer(t,!0);const a=new Rf,u=new Rf,d=new Rf,_=new Rf;this._poleSegments=[];for(let x=0,S=0;x<go;x++){const R=360/(1<<x);a.emplaceBack(0,-cs,0,.5,0),u.emplaceBack(0,-cs,0,.5,1),d.emplaceBack(0,-cs,0,.5,.5),_.emplaceBack(0,-cs,0,.5,.5);for(let L=0;L<=Du;L++){let F=L/Du,U=0;const G=Rn(0,R,F),[X,Z,ne]=wa(bw,ww,G,cs);a.emplaceBack(X,Z,ne,F,U),u.emplaceBack(X,Z,ne,F,1-U);const he=Ar(G);F=.5+.5*Math.sin(he),U=.5+.5*Math.cos(he),d.emplaceBack(X,Z,ne,F,U),_.emplaceBack(X,Z,ne,F,1-U)}this._poleSegments.push(Es.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,Bs,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,Bs,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(d,Bs,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(_,Bs,!1)}getGridBuffers(o,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},r.eS=Hv,r.eT=jo,r.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eV=ft,r.eW=pe,r.eX=function(o,t,a){return o[0]=t[0]/a[0],o[1]=t[1]/a[1],o[2]=t[2]/a[2],o},r.eY=tn,r.eZ=lo,r.e_=xi,r.ea=Pd,r.eb=C_,r.ec=vp,r.ed=qy,r.ee=Xv,r.ef=se,r.eg=function(o,t){if(o===t){var a=t[1],u=t[2],d=t[3],_=t[6],x=t[7],S=t[11];o[1]=t[4],o[2]=t[8],o[3]=t[12],o[4]=a,o[6]=t[9],o[7]=t[13],o[8]=u,o[9]=_,o[11]=t[14],o[12]=d,o[13]=x,o[14]=S}else o[0]=t[0],o[1]=t[4],o[2]=t[8],o[3]=t[12],o[4]=t[1],o[5]=t[5],o[6]=t[9],o[7]=t[13],o[8]=t[2],o[9]=t[6],o[10]=t[10],o[11]=t[14],o[12]=t[3],o[13]=t[7],o[14]=t[11],o[15]=t[15];return o},r.eh=p8,r.ei=vr,r.ej=ga,r.ek=256,r.el=d0,r.em=_c,r.en=Se,r.eo=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[4],o[4]=t[5],o[5]=t[6],o[6]=t[8],o[7]=t[9],o[8]=t[10],o},r.ep=Rf,r.eq=jp,r.er=fp,r.es=function(o,t,a,u,d){return oe((o-t)/(a-t)*(d-u)+u,u,d)},r.et=Ei,r.eu=function(o,t){var a=t[0],u=t[1],d=t[2],_=t[3],x=t[4],S=t[5],R=t[6],L=t[7],F=t[8],U=F*x-S*L,G=-F*_+S*R,X=L*_-x*R,Z=a*U+u*G+d*X;return Z?(o[0]=U*(Z=1/Z),o[1]=(-F*u+d*L)*Z,o[2]=(S*u-d*x)*Z,o[3]=G*Z,o[4]=(F*a-d*R)*Z,o[5]=(-S*a+d*_)*Z,o[6]=X*Z,o[7]=(-L*a+u*R)*Z,o[8]=(x*a-u*_)*Z,o):null},r.ev=2,r.ew=Fi,r.ex=Qt,r.ey=Te,r.ez=function(o,t){var a=new I(3);Te(a,t);var u=1/a[0],d=1/a[1],_=1/a[2],x=t[0]*u,S=t[1]*d,R=t[2]*_,L=t[4]*u,F=t[5]*d,U=t[6]*_,G=t[8]*u,X=t[9]*d,Z=t[10]*_,ne=x+F+Z,he=0;return ne>0?(he=2*Math.sqrt(ne+1),o[3]=.25*he,o[0]=(U-X)/he,o[1]=(G-R)/he,o[2]=(S-L)/he):x>F&&x>Z?(he=2*Math.sqrt(1+x-F-Z),o[3]=(U-X)/he,o[0]=.25*he,o[1]=(S+L)/he,o[2]=(G+R)/he):F>Z?(he=2*Math.sqrt(1+F-x-Z),o[3]=(G-R)/he,o[0]=(S+L)/he,o[1]=.25*he,o[2]=(U+X)/he):(he=2*Math.sqrt(1+Z-x-F),o[3]=(S-L)/he,o[0]=(G+R)/he,o[1]=(U+X)/he,o[2]=.25*he),o},r.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,((t,a)=>String.fromCharCode(+("0x"+a)))))},r.f0=function([o,t,a]){const u=Math.hypot(o,t,a),d=Math.atan2(o,a),_=.5*Math.PI-Math.acos(-t/u);return new c(js(d),js(_))},r.f1=ot,r.f2=ME,r.f3=function(o){const t=o.navigator?o.navigator.userAgent:null;return!!(function(a){if(Vn==null){const u=a.navigator?a.navigator.userAgent:null;Vn=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Vn})(o)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f4=function(o,t){wl=o,tf=t},r.f5=Ev,r.f6=h_,r.f7=function(o){const t=[0,0,0],a=ie(new Float64Array(16));return ae(a,o.pixelMatrix,o.globeMatrix),xn(t,t,a),new Xt(t[0],t[1])},r.f8=function(){const o=Ct;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(J),Ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f9=function(){Hi().acquire(J)},r.fA=AS,r.fB=rt,r.fC=function(o){let t=0;if(new Uint32Array(o,0,1)[0]!==uD){const a=new Uint32Array(o,0,7),[,,u,d,_,x]=a;t=a.byteLength+d+_+x+_,(u!==o.byteLength||t>=o.byteLength)&&ht("Invalid b3dm header information.")}return pD(o,t)},r.fD=function(o,t){const a=IE(o);for(const u of a){for(const d of u.meshes)qV(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(XV(u.lights,t)))}return a},r.fE=bS,r.fF=ji,r.fG=P,r.fH=Vc,r.fI=Dl,r.fJ=function(o){Sl(),kl?.then((t=>{t.keys().then((a=>{for(let u=0;u<a.length-o;u++)t.delete(a[u]).catch((d=>ht(d.message)))})).catch((a=>ht(a.message)))})).catch((t=>ht(t.message)))},r.fa=zh,r.fb=function(o,t,a=!1){if(Bo===Dl.deferred||Bo===Dl.loading||Bo===Dl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Eu=xs.resolveURL(o),Bo=Dl.deferred,bg=t,No(),a||up()},r.fc=function(o){sa=xs.resolveURL(o),Nt||(Nt=new Xe(Hi(),new of)),Nt.broadcast("setMeshoptUrl",sa)},r.fd=Tr,r.fe=function(o){mr=xs.resolveURL(o),Nt||(Nt=new Xe(Hi(),new of)),Nt.broadcast("setDracoUrl",mr)},r.ff=aa,r.fg=W,r.fh=function(o){const t=Cc();if(!t)return;const a=t.delete(Ul);o&&a.then((()=>o())).catch(o)},r.fi=ve,r.fj=oi,r.fk=Ld,r.fl=fm,r.fm=AP,r.fn=CP,r.fo=RD,r.fp=yt,r.fq="hd_road_elevation",r.fr=er,r.fs=Tt,r.ft=am,r.fu=HE,r.fv=z0,r.fw=function(o,t,a,u,d,_,x,S=1,R,L,F){o.createArrays(),o.tilePixelRatio=gi/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const U=o.layers[0].layout,G=o.layers[0]._unevaluatedLayout._values,X={};X.scaleFactor=S,X.textSizeScaleRange=U.get("text-size-scale-range"),X.iconSizeScaleRange=U.get("icon-size-scale-range");const[Z,ne]=X.textSizeScaleRange,[he,ce]=X.iconSizeScaleRange;X.textScaleFactor=oe(X.scaleFactor,Z,ne),X.iconScaleFactor=oe(X.scaleFactor,he,ce);const _e=G["text-size"],xe=G["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:tt,maxZoom:It}=o.textSizeData;X.compositeTextSizes=[_e.possiblyEvaluate(new ms(tt,{worldview:F}),_),_e.possiblyEvaluate(new ms(It,{worldview:F}),_)]}if(o.iconSizeData.kind==="composite"){const{minZoom:tt,maxZoom:It}=o.iconSizeData;X.compositeIconSizes=[xe.possiblyEvaluate(new ms(tt,{worldview:F}),_),xe.possiblyEvaluate(new ms(It,{worldview:F}),_)]}X.layoutTextSize=_e.possiblyEvaluate(new ms(x+1,{worldview:F}),_),X.layoutIconSize=xe.possiblyEvaluate(new ms(x+1,{worldview:F}),_),X.textMaxSize=_e.possiblyEvaluate(new ms(18,{worldview:F}),_);const Ee=U.get("symbol-placement"),ke=U.get("text-rotation-alignment")==="map"&&Ee!=="point",Be=U.get("text-size");let He=!1;const Je=[];for(const tt of o.features){const It=U.get("text-font").evaluate(tt,{},_).join(","),ut=Be.evaluate(tt,{},_)*X.textScaleFactor,Ot=X.layoutTextSize.evaluate(tt,{},_)*X.textScaleFactor,Zt=X.layoutIconSize.evaluate(tt,{},_)*X.iconScaleFactor,Yt={horizontal:{},vertical:void 0},li=tt.text;let ui,ri=[0,0];if(li){const cr=li.toString(),vs=U.get("text-letter-spacing").evaluate(tt,{},_)*ko,Fe=U.get("text-line-height").evaluate(tt,{},_)*ko,Ve=lp(cr)?vs:0,Bt=U.get("text-anchor").evaluate(tt,{},_),ci=U.get("text-variable-anchor");if(!ci){const sr=U.get("text-radial-offset").evaluate(tt,{},_);if(sr)ri=hL(Bt,[sr*ko,XE]);else{const hr=U.get("text-offset").evaluate(tt,{},_);ri=[hr[0]*ko,hr[1]*ko]}}let Bi=ke?"center":U.get("text-justify").evaluate(tt,{},_);const Ni=Ee==="point",mn=Ni?U.get("text-max-width").evaluate(tt,{},_)*ko:1/0,yn=sr=>{o.allowVerticalPlacement&&Tu(cr)&&(Yt.vertical=FE(li,t,a,d,It,mn,Fe,Bt,sr,Ve,ri,Vh.vertical,!0,Ot,ut,R))};if(!ke&&ci){const sr=Bi==="auto"?ci.map((gr=>WE(gr))):[Bi];let hr=!1;for(let gr=0;gr<sr.length;gr++){const Or=sr[gr];if(!Yt.horizontal[Or])if(hr)Yt.horizontal[Or]=Yt.horizontal[0];else{const Bn=FE(li,t,a,d,It,mn,Fe,"center",Or,Ve,ri,Vh.horizontal,!1,Ot,ut,R);Bn&&(Yt.horizontal[Or]=Bn,hr=Bn.positionedLines.length===1)}}yn("left")}else{if(Bi==="auto"&&(Bi=WE(Bt)),Ni||U.get("text-writing-mode").indexOf("horizontal")>=0||!Tu(cr)){const sr=FE(li,t,a,d,It,mn,Fe,Bt,Bi,Ve,ri,Vh.horizontal,!1,Ot,ut,R);sr&&(Yt.horizontal[Bi]=sr)}yn(Ni?"left":Bi)}}let si,zt,Dt,ai,Ti,pi,dn=!1;const Gi=U.get("icon-text-fit").evaluate(tt,{},_);if(tt.icon&&tt.icon.hasPrimary()){const cr=s1(tt.icon,o.iconSizeData,G["icon-size"],_,o.zoom,tt,R,X.iconScaleFactor,F);si=cr.iconPrimary,Dt=cr.iconSecondary;const vs=si.toString();if(zt=u.get(vs),zt&&(Ti=U.get("icon-offset").evaluate(tt,{},_),pi=U.get("icon-anchor").evaluate(tt,{},_),ui=aS(d.get(vs),Dt?d.get(Dt.toString()):void 0,Ti,pi),dn=zt.sdf,o.sdfIcons===void 0?o.sdfIcons=zt.sdf:o.sdfIcons!==zt.sdf&&ht("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(zt.pixelRatio!==o.pixelRatio||U.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),Dt){const Fe=Dt.toString();ai=u.get(Fe)}}He=He||!(!tt.icon||!tt.icon.hasSecondary());const Ki=hS(Yt.horizontal)||Yt.vertical;o.iconsInText||(o.iconsInText=!!Ki&&Ki.iconsInText);const cn=Ot*X.textScaleFactor/ko,{defaultShapedIcon:yr,verticallyShapedIcon:yi}=e8(o,ui,U,tt,_,Yt,cn,Ti,Gi);Gi!=="none"&&ui&&(KD(ui)||$D(ui))&&(uS(0,zt,si,ui,yr,Gi,L,u,d),uS(0,ai,Dt,ui,yr,Gi,L,u,d),yi&&(uS(0,zt,si,ui,yi,Gi,L,u,d),uS(0,ai,Dt,ui,yi,Gi,L,u,d))),ui=yr;const{iconBBox:un,iconVerticalBBox:Yn,textBBox:Ur,textVerticalBBox:jr}=Y6(o,ui,yi,U,tt,_,Zt,Ti,X,d,pi,Yt,Ot,ri);Je.push({feature:tt,shapedTextOrientations:Yt,shapedText:Ki,shapedIcon:ui,iconPrimary:si,iconSecondary:Dt,iconOffset:Ti,iconAnchor:pi,verticallyShapedIcon:yi,layoutTextSize:Ot,layoutIconSize:Zt,textOffset:ri,isSDFIcon:dn,iconTextFit:Gi,iconCollisionBounds:un,iconVerticalCollisionBounds:Yn,textCollisionBounds:Ur,textVerticalCollisionBounds:jr})}return{featureData:Je,sizes:X,hasAnySecondaryIcon:He,textAlongLine:ke,symbolPlacement:Ee}},r.fx=sL,r.fy=function(o,t,a,u,d,_,x,S,R,L){o.iconAtlasPositions=L.iconPositions;const{featureData:F,hasAnySecondaryIcon:U,sizes:G,textAlongLine:X,symbolPlacement:Z}=t;for(const ne of F){const{shapedIcon:he,verticallyShapedIcon:ce,feature:_e,shapedTextOrientations:xe,shapedText:Ee,layoutTextSize:ke,textOffset:Be,isSDFIcon:He,iconPrimary:Je,iconSecondary:tt,iconTextFit:It,iconOffset:ut,iconCollisionBounds:Ot,iconVerticalCollisionBounds:Zt,textCollisionBounds:Yt}=ne;dL(he,L.iconPositions,Je,tt),dL(ce,L.iconPositions,Je,tt),Q6(xe,L.iconPositions),J6(Je,tt,L.iconPositions),(Ee||he)&&t8(o,_e,xe,he,ce,R,G,ke,0,Be,He,u,d,x,S,U,It,ut,X,Z,Ot,Zt,Yt)}a&&o.generateCollisionDebugBuffers(_,o.collisionBoxArray,G.textScaleFactor)},r.fz=nt,r.g=function(o,t){return su(Object.assign(o,{method:"GET"}),t)},r.h=function(o){return o.indexOf("mapbox:")===0},r.i=function(o){return Tn.API_STYLE_REGEX.test(o)&&!Qr(o)},r.j=In,r.k=Vl,r.l=function(o){return decodeURIComponent(atob(o).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join(""))},r.m=function(o,t){return su(Object.assign(o,{type:"json"}),t)},r.n=rf,r.o=xs,r.p=function(o,t){return su(Object.assign(o,{method:"POST"}),t)},r.q=Uo,r.r=la,r.s=function(o){try{const t=self[o];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return _i||(_i=new ve("ImageRasterizer")),_i},r.u=function(){return(function o(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},r.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},r.w=ht,r.x=uA,r.y=Mh,r.z=Ml})),g(["./shared"],(function(r){function C(ft){const oe=ft?ft.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function I(ft){if(typeof ft=="number"||typeof ft=="boolean"||typeof ft=="string"||ft==null)return JSON.stringify(ft);if(Array.isArray(ft)){let ge="[";for(const Ie of ft)ge+=`${I(Ie)},`;return`${ge}]`}let oe="{";for(const ge of Object.keys(ft).sort())oe+=`${ge}:${I(ft[ge])},`;return`${oe}}`}function z(ft){let oe="";for(const ge of r.bx)oe+=`/${I(ft[ge])}`;return oe}class N{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,ge){this._layerConfigs={},this._layers={},this.update(oe,[],ge)}update(oe,ge,Ie){this._options=Ie;for(const Ke of oe)this._layerConfigs[Ke.id]=Ke,(this._layers[Ke.id]=r.du(Ke,this.scope,null,this._options)).compileFilter(Ie),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id];for(const Ke of ge)delete this.keyCache[Ke],delete this._layerConfigs[Ke],delete this._layers[Ke];this.familiesBySource={};const $e=(function(Ke,at){const At={};for(let Tt=0;Tt<Ke.length;Tt++){const Wt=Ke[Tt];let ye=at&&at[Wt.id];ye||(Wt.type==="symbol"?ye=Wt.id:(ye=z(Wt),Wt.type==="line"&&Wt.paint&&(function wt(ht){return typeof ht=="string"&&ht==="line-progress"||(Array.isArray(ht)?ht.some(wt):!(!ht||typeof ht!="object")&&Object.values(ht).some(wt))})(Wt.paint["line-width"])&&(ye+=`/${I(Wt.paint["line-width"])}`))),at&&(at[Wt.id]=ye);let it=At[ye];it||(it=At[ye]=[]),it.push(Wt)}const lt=[];for(const Tt in At)lt.push(At[Tt]);return lt})(Object.values(this._layerConfigs),this.keyCache);for(const Ke of $e){const at=Ke.map((it=>this._layers[it.id])),At=at[0];if(At.visibility==="none")continue;const lt=At.source||"";let Tt=this.familiesBySource[lt];Tt||(Tt=this.familiesBySource[lt]={});const Wt=At.sourceLayer||"_geojsonTileLayer";let ye=Tt[Wt];ye||(ye=Tt[Wt]=[]),ye.push(at)}}}const k=1*r.fl;class j{constructor(oe){const ge={},Ie=[];for(const At in oe){const lt=oe[At],Tt=ge[At]={};for(const Wt in lt.glyphs){const ye=lt.glyphs[+Wt];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const it=ye.metrics.localGlyph?k:1,wt={x:0,y:0,w:ye.bitmap.width+2*it,h:ye.bitmap.height+2*it};Ie.push(wt),Tt[Wt]=wt}}const{w:$e,h:Ke}=r.G(Ie),at=new r.fk({width:$e||1,height:Ke||1});for(const At in oe){const lt=oe[At];for(const Tt in lt.glyphs){const Wt=lt.glyphs[+Tt];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const ye=ge[At][Tt],it=Wt.metrics.localGlyph?k:1;r.fk.copy(Wt.bitmap,at,{x:0,y:0},{x:ye.x+it,y:ye.y+it},Wt.bitmap)}}this.image=at,this.positions=ge}}function $(ft,oe,ge){ft[oe]?ge&&(ft[oe].center=ge):ft[oe]={floorIds:new Set,center:ge||[0,0],floors:{}}}function re(ft,oe,ge,Ie){for(const $e of oe)$(ft,$e),ft[$e].floors[ge]=Ie,ft[$e].floorIds.add(ge)}function ie(ft){return{id:ft.properties.id.toString(),center:ft.properties.center.toString().split(";").map(Number)}}function Y(ft){return{id:ft.properties.id.toString(),isDefault:!!ft.properties.is_default&&ft.properties.is_default,connections:ft.properties.connected_floor_ids?new Set(ft.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ft.properties.conflicted_floor_ids?new Set(ft.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ft.properties.building_ids?new Set(ft.properties.building_ids.toString().split(";")):new Set,name:ft.properties.name.toString(),zIndex:ft.properties.z_index}}function ae(ft,oe){return oe.every((ge=>ft.properties&&ft.properties[ge]!=null))}function ue(ft){return ae(ft,["type","id","name"])&&ft.properties.type==="building"}function me(ft){return ae(ft,["type","id","name","z_index"])&&ft.properties.type==="floor"}r.fj(j,"GlyphAtlas");class Ae{constructor(oe){this.tileID=new r.aQ(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=r.aZ(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor,this.worldview=oe.worldview,this.indoor=oe.indoor}parse(oe,ge,Ie,$e,Ke,at){this.status="parsing",this.data=oe,this.collisionBoxArray=new r.b3;const At=new r.fm(Object.keys(oe.layers).sort()),lt=new r.fn(this.tileID,this.promoteId);lt.bucketLayerIDs=[];const Tt={},Wt=new r.fo(256,256),ye={featureIndex:lt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Wt,availableImages:Ie,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const bt=this.indoor.indoorState.activeFloorsVisible,mi=(function(bi,ji,pn){const Vn=(function(Wn,Cn){if(!Wn)return r.w("No source layers defined in indoor specification"),Cn;if(Wn.size===0)return Cn;const or=Wn.difference(Cn);for(const jn of or)r.w(`Missing source layer required in indoor specification: ${jn}`);return Cn.intersection(Cn)})(ji.sourceLayers,new Set(Object.keys(bi.layers))),Un=ji.indoorState,kn=(function(Wn,Cn,or,jn){const Tn=new Set,In=new Set,Qr=new Set,kr=new Map,qs={},bl=Kr=>{const qa=kr.get(Kr)||new Set;for(const as of Tn)if((kr.get(as)||new Set).has(Kr)||qa.has(as))return!0;return!1};for(const Kr of Cn){const qa=Wn.layers[Kr];if(qa)for(let as=0;as<qa.length;as++){const la=qa.feature(as);if(ue(la)){const{id:xs,center:Ma}=ie(la);$(qs,xs,Ma),Tn.add(xs)}else if(me(la)){const{id:xs,isDefault:Ma,connections:ma,conflicts:Ul,buildings:wl,name:tf,zIndex:Jf}=Y(la);re(qs,wl,xs,{name:tf,zIndex:Jf}),kr.set(xs,Ul),(xs===jn||ma.has(jn))&&Tn.add(xs),In.add(xs),Ma&&Qr.add(xs)}}else r.w(`indoor source layer not found: ${Kr}`)}if(or)for(const Kr of or)In.has(Kr)&&(bl(Kr)||Tn.add(Kr));for(const Kr of Qr)Tn.has(Kr)||bl(Kr)||Tn.add(Kr);return{buildings:qs,activeFloors:Tn}})(bi,Vn,Un.lastActiveFloors,Un.selectedFloorId);return pn.send("setIndoorData",kn),kn})(oe,this.indoor,Ke);ye.activeFloors=bt?mi.activeFloors:void 0}const it=[],wt=ge.familiesBySource[this.source];for(const bt in wt){const mi=oe.layers[bt];if(!mi)continue;let bi=!1,ji=!1,pn=!1;for(const Cn of wt[bt])Cn[0].type==="symbol"?bi=!0:ji=!0,Cn[0].is3D()&&Cn[0].type!=="model"&&(pn=!0);if(this.extraShadowCaster&&!pn||this.isSymbolTile===!0&&!bi||this.isSymbolTile===!1&&!ji)continue;mi.version===1&&r.w(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vn=At.encode(bt),Un=[],kn=this.localizableLayerIds&&this.localizableLayerIds.has(bt);let Wn=!1;for(let Cn=0,or=0;Cn<mi.length;Cn++){const jn=mi.feature(Cn),Tn=lt.getId(jn,bt),In=jn.properties?jn.properties.worldview:null;if(kn&&this.worldview&&typeof In=="string")if(In==="all")jn.properties.$localized=!0;else{if(!In.split(",").includes(this.worldview))continue;jn.properties.$localized=!0,jn.properties.worldview=this.worldview}!Wn&&jn.properties&&jn.properties.hasOwnProperty(r.fp)&&(Wn=!0),Un.push({feature:jn,id:Tn,index:or,sourceLayerIndex:Vn}),or++}Wn&&!ye.elevationFeatures&&oe.layers.hasOwnProperty(r.fq)&&(ye.elevationFeatures=r.fr.parseFrom(oe.layers[r.fq],this.canonical));for(const Cn of wt[bt]){const or=Cn[0];if(this.extraShadowCaster&&(!or.is3D()||or.type==="model")||this.isSymbolTile!==void 0&&or.type==="symbol"!==this.isSymbolTile||or.minzoom&&this.zoom<Math.floor(or.minzoom)||or.maxzoom&&this.zoom>=or.maxzoom||or.visibility==="none")continue;Se(Cn,this.zoom,ye.brightness,Ie,this.worldview);const jn=Tt[or.id]=or.createBucket({index:lt.bucketLayerIDs.length,layers:Cn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:$e,worldview:this.worldview,localizable:kn});lt.bucketLayerIDs.push(Cn.map((In=>r.B(In.id,In.scope))));let Tn=jn.prepare?jn.prepare():null;Tn!=null?(Tn=Tn.then((()=>jn.populate(Un,ye,this.tileID.canonical,this.tileTransform))),it.push(Tn)):jn.populate(Un,ye,this.tileID.canonical,this.tileTransform)}}const ht=()=>{let bt,mi,bi,ji,pn,Vn;Wt.trim();const Un={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},kn=()=>{if(bt)return this.status="done",at(bt);if(this.extraShadowCaster)this.status="done",at(null,{buckets:Object.values(Tt).filter((Cn=>!Cn.isEmpty())),featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ye.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(mi&&bi&&ji){const Cn=new j(mi),or=new Map;for(const[In,Qr]of bi.entries()){const{imagePosition:kr}=r.fu(In,Qr,r.fv);or.set(In,kr)}const jn={};for(const In in Tt){const Qr=Tt[In];Qr instanceof r.b4&&(Se(Qr.layers,this.zoom,ye.brightness,Ie,this.worldview),jn[In]=r.fw(Qr,mi,Cn.positions,bi,or,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,pn,this.worldview))}const Tn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ke,bi,pn,(()=>{Tn.iconsPending=!1,Wn(jn,Cn,Tn)})),this.rasterizeIfNeeded(Ke,ji,Vn,(()=>{Tn.patternsPending=!1,Wn(jn,Cn,Tn)}))}},Wn=(Cn,or,jn,Tn)=>{if(jn.iconsPending||jn.patternsPending)return;const In=new r.fx(bi,ji,this.lut);for(const Qr in Tt){const kr=Tt[Qr];if(Qr in Cn)r.fy(kr,Cn[Qr],this.showCollisionBoxes,Ie,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,bi,In);else if(kr.hasPattern&&(kr instanceof r.ba||kr instanceof r.bb||kr instanceof r.ea)){Se(kr.layers,this.zoom,ye.brightness,Ie,this.worldview);const qs=Object.fromEntries(In.patternPositions);kr.addFeatures(ye,this.tileID.canonical,qs,Ie,this.tileTransform,this.brightness)}}this.status="done",at(null,{buckets:Object.values(Tt).filter((Qr=>!Qr.isEmpty())),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:or.image,lineAtlas:Wt,imageAtlas:In,brightness:ye.brightness})};if(!this.extraShadowCaster){const Cn=r.fs(ye.glyphDependencies,(Tn=>Object.keys(Tn).map(Number)));Object.keys(Cn).length?Ke.send("getGlyphs",{uid:this.uid,stacks:Cn},((Tn,In)=>{bt||(bt=Tn,mi=In,kn())}),void 0,!1,Un):mi={};const or=Array.from(ye.iconDependencies.keys()).map((Tn=>r.I.parse(Tn)));or.length?Ke.send("getImages",{images:or,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Tn,In)=>{bt||(bt=Tn,bi=new Map,pn=this.updateImageMapAndGetImageTaskQueue(bi,In,ye.iconDependencies),kn())}),void 0,!1,Un):(bi=new Map,pn=new Map);const jn=Array.from(ye.patternDependencies.keys()).map((Tn=>r.I.parse(Tn)));jn.length?Ke.send("getImages",{images:jn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Tn,In)=>{bt||(bt=Tn,ji=new Map,Vn=this.updateImageMapAndGetImageTaskQueue(ji,In,ye.patternDependencies),kn())}),void 0,!1,Un):(ji=new Map,Vn=new Map)}if(ye.elevationFeatures&&ye.elevationFeatures.length>0){const Cn=[];for(const jn of Object.values(Tt))if(jn instanceof r.bb){const Tn=jn.getUnevaluatedPortalGraph();Tn&&Cn.push(Tn)}const or=r.ft.evaluate(Cn);for(const jn of Object.values(Tt))if(jn instanceof r.bb){const Tn=oe.layers[At.decode(jn.sourceLayerIndex)];jn.setEvaluatedPortalGraph(or,Tn,this.tileID.canonical,ye.availableImages,ye.brightness)}}kn()};it.length>0?Promise.allSettled(it).then(ht).catch(at):ht()}updateParameters(oe){this.scaleFactor=oe.scaleFactor,this.showCollisionBoxes=oe.showCollisionBoxes,this.projection=oe.projection,this.brightness=oe.brightness,this.tileTransform=r.aZ(oe.tileID.canonical,oe.projection),this.extraShadowCaster=oe.extraShadowCaster,this.lut=oe.lut,this.worldview=oe.worldview,this.indoor=oe.indoor}rasterizeIfNeeded(oe,ge,Ie,$e){Array.from(ge.values()).some((Ke=>Ke.usvg))?this.rasterize(oe,ge,Ie,$e):$e()}updateImageMapAndGetImageTaskQueue(oe,ge,Ie){const $e=new Map;for(const Ke of ge.keys()){const at=Ie.get(Ke)||[];for(const At of at){const lt=At.toString(),Tt=ge.get(At.id.toString());Tt.usvg?$e.has(lt)||($e.set(lt,At),oe.set(lt,Object.assign({},Tt))):oe.set(lt,Tt)}}return $e}rasterize(oe,ge,Ie,$e){this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,tasks:Ie},((Ke,at)=>{if(!Ke)for(const[At,lt]of at.entries()){const Tt=Object.assign(ge.get(At),{data:lt});ge.set(At,Tt)}$e()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Se(ft,oe,ge,Ie,$e){const Ke=new r.ac(oe,{brightness:ge,worldview:$e});for(const at of ft)at.recalculate(Ke,Ie)}class ze extends r.E{constructor(oe,ge,Ie,$e,Ke,at,At){super(),this.actor=oe,this.layerIndex=ge,this.availableImages=Ie,this.availableModels=$e,this.loadVectorData=at||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(oe.scheduler),this.isSpriteLoaded=Ke,this.scheduler=oe.scheduler,this.brightness=At}loadTile(oe,ge){const Ie=oe.uid,$e=oe&&oe.request,Ke=$e&&$e.collectResourceTiming,at=this.loading[Ie]=new Ae(oe);at.abort=this.loadVectorData(oe,((At,lt)=>{const Tt=!this.loading[Ie];if(delete this.loading[Ie],at.cancelRasterize(),Tt||At||!lt)return at.status="done",Tt||(this.loaded[Ie]=at),ge(At);const Wt=lt.rawData,ye={},it=r.aM(lt.responseHeaders);it&&it.expires&&(ye.expires=it.expires),it&&it.cacheControl&&(ye.cacheControl=it.cacheControl),at.vectorTile=lt.vectorTile||new r.fz(new r.bt(Wt));const wt=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((ht,bt)=>{if(ht||!bt)return ge(ht);const mi={};if(Ke){const bi=C($e);bi.length>0&&(mi.resourceTiming=JSON.parse(JSON.stringify(bi)))}ge(null,Object.assign({rawTileData:Wt.slice(0),responseHeaders:lt.responseHeaders},bt,ye,mi))}))};this.isSpriteLoaded?wt():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(wt,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):wt()})),this.loaded=this.loaded||{},this.loaded[Ie]=at}))}reloadTile(oe,ge){const Ie=this.loaded,$e=oe.uid;if(Ie&&Ie[$e]){const Ke=Ie[$e];Ke.updateParameters(oe);const at=(At,lt)=>{const Tt=Ke.reloadCallback;Tt&&(delete Ke.reloadCallback,Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Tt)),ge(At,lt)};Ke.status==="parsing"?Ke.reloadCallback=at:Ke.status==="done"&&(Ke.vectorTile?Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at):at())}else ge(null,void 0)}abortTile(oe,ge){const Ie=oe.uid,$e=this.loading[Ie];$e&&($e.abort&&$e.abort(),delete this.loading[Ie]),ge()}removeTile(oe,ge){const Ie=this.loaded,$e=oe.uid;Ie&&Ie[$e]&&delete Ie[$e],ge()}}class je{loadTile(oe,ge){const{uid:Ie,encoding:$e,rawImageData:Ke,padding:at}=oe,At=ImageBitmap&&Ke instanceof ImageBitmap?this.getImageData(Ke,at):Ke;ge(null,new r.fA(Ie,At,$e,at<1))}reloadTile(oe,ge){ge(null,null)}abortTile(oe,ge){ge()}removeTile(oe,ge){ge()}getImageData(oe,ge){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const Ie=this.offscreenCanvasContext.getImageData(-ge,-ge,oe.width+2*ge,oe.height+2*ge);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ie}}r.bs.setPbf(r.bt);class Ce{constructor(oe){this._mrt=new r.bs(oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=oe.uid,this.tileID=oe.tileID,this.source=oe.source}parse(oe,ge){const Ie=this._mrt;this.status="parsing",this._entireBuffer=oe;try{Ie.parseHeader(oe),this._isHeaderLoaded=!0;const $e=[];for(const Ke in Ie.layers){const at=Ie.getLayer(Ke),At=at.getDataRange(at.getBandList()),lt=Ie.createDecodingTask(At),Tt=oe.slice(At.firstByte,At.lastByte+1),Wt=r.bs.performDecoding(Tt,lt).then((ye=>lt.complete(null,ye))).catch((ye=>lt.complete(ye,null)));$e.push(Wt)}Promise.allSettled($e).then((()=>ge(null,Ie))).catch((Ke=>ge(Ke)))}catch($e){ge($e)}}}class Te{constructor(oe){this.actor=oe,this.loading={},this.loaded={}}loadTile(oe,ge){const Ie=oe.uid,$e=oe.request,Ke=this.loading[Ie]=new Ce(oe),{cancel:at}=r.bu($e,((At,lt,Tt)=>{const Wt=!this.loading[Ie];if(delete this.loading[Ie],Wt||At||!lt)return Ke.status="done",Wt||(this.loaded[Ie]=Ke),ge(At);Ke.parse(lt,((ye,it)=>{if(ye||!it)return ge(ye);ge(null,it,Tt)})),this.loaded[Ie]=Ke}));Ke.abort=at}reloadTile(oe,ge){ge(null,void 0)}abortTile(oe,ge){const Ie=oe.uid,$e=this.loading[Ie];$e&&($e.abort&&$e.abort(),delete this.loading[Ie]),ge()}removeTile(oe,ge){const Ie=oe.uid;this.loaded[Ie]&&delete this.loaded[Ie],ge()}decodeRasterArray(oe,ge){r.bs.performDecoding(oe.buffer,oe.task).then((Ie=>ge(null,Ie))).catch((Ie=>ge(Ie)))}}const Ze=r.fB.prototype.toGeoJSON;class Mt{constructor(oe){this._feature=oe,this.extent=r.al,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const ge of this._feature.geometry)oe.push([new r.P(ge[0],ge[1])]);return oe}{const oe=[];for(const ge of this._feature.geometry){const Ie=[];for(const $e of ge)Ie.push(new r.P($e[0],$e[1]));oe.push(Ie)}return oe}}toGeoJSON(oe,ge,Ie){return Ze.call(this,oe,ge,Ie)}}class mt{constructor(oe,ge){this.name=oe,this.extent=r.al,this.length=ge.length,this._jsonFeatures=ge}feature(oe){return new Mt(this._jsonFeatures[oe])}}class Gt{constructor(oe){this.layers={},this.extent=r.al;for(const ge of Object.keys(oe))this.layers[ge]=new mt(ge,oe[ge])}}const kt=64/4096,Re=128;class Qe{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],ge){for(const Ie of oe){const $e=Ie.id;if($e==null)continue;let Ke=this.features.get($e);Ke&&this.updateCache(Ke,ge),Ie.geometry?(Ke=Lt(Ie),this.updateCache(Ke,ge),this.features.set($e,Ke)):this.features.delete($e),this.updateCache(Ke,ge)}}updateCache(oe,ge){for(const{canonical:Ie,uid:$e}of Object.values(ge)){const{z:Ke,x:at,y:At}=Ie;et(oe,Math.pow(2,Ke),at,At)&&delete ge[$e]}}getTile(oe,ge,Ie){const $e=Math.pow(2,oe),Ke=[];for(const at of this.features.values())et(at,$e,ge,Ie)&&Ke.push(Vt(at,$e,ge,Ie));return{features:Ke}}getFeatures(){return[...this.features.values()]}}function et({minX:ft,minY:oe,maxX:ge,maxY:Ie},$e,Ke,at){return ft<(Ke+1+kt)/$e&&oe<(at+1+kt)/$e&&ge>(Ke-kt)/$e&&Ie>(at-kt)/$e}function Lt(ft){const{id:oe,geometry:ge,properties:Ie}=ft;if(!ge)return;if(ge.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:$e,coordinates:Ke}=ge,at={id:oe,type:1,geometry:[],tags:Ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},At=at.geometry;if($e==="Point")jt(Ke,At,at);else if($e==="MultiPoint")for(const lt of Ke)jt(lt,At,at);else if($e==="LineString")at.type=2,Ge(Ke,At,at);else if($e==="MultiLineString")at.type=2,Et(Ke,At,at);else if($e==="Polygon")at.type=3,Et(Ke,At,at,!0);else{if($e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const lt of Ke)Et(lt,At,at,!0)}return at}function jt([ft,oe],ge,Ie){const $e=r.aF(ft);let Ke=r.aJ(oe);Ke=Ke<0?0:Ke>1?1:Ke,ge.push($e,Ke),Ie.minX=Math.min(Ie.minX,$e),Ie.minY=Math.min(Ie.minY,Ke),Ie.maxX=Math.max(Ie.maxX,$e),Ie.maxY=Math.max(Ie.maxY,Ke)}function Ge(ft,oe,ge,Ie=!1,$e=!1){const Ke=[];for(const at of ft)jt(at,Ke,ge);oe.push(Ke),Ie&&(function(at,At){let lt=0;for(let Tt=0,Wt=at.length,ye=Wt-2;Tt<Wt;ye=Tt,Tt+=2)lt+=(at[Tt]-at[ye])*(at[Tt+1]+at[ye+1]);if(lt>0===At)for(let Tt=0,Wt=at.length;Tt<Wt/2;Tt+=2){const ye=at[Tt],it=at[Tt+1];at[Tt]=at[Wt-2-Tt],at[Tt+1]=at[Wt-1-Tt],at[Wt-2-Tt]=ye,at[Wt-1-Tt]=it}})(Ke,$e)}function Et(ft,oe,ge,Ie=!1){for(let $e=0;$e<ft.length;$e++)Ge(ft[$e],oe,ge,Ie,$e===0)}function Vt(ft,oe,ge,Ie){const{id:$e,type:Ke,geometry:at,tags:At}=ft,lt=[];if(Ke===1)(function(Tt,Wt,ye,it,wt){for(let ht=0;ht<Tt.length;ht+=2){const bt=Math.round(r.al*(Tt[ht+0]*Wt-ye)),mi=Math.round(r.al*(Tt[ht+1]*Wt-it));wt.push([bt,mi])}})(at,oe,ge,Ie,lt);else if(Ke===2)for(const Tt of at)ii(Tt,oe,ge,Ie,lt);else if(Ke===3)for(const Tt of at)ki(Tt,oe,ge,Ie,lt);return{id:$e,type:Ke,geometry:lt,tags:At}}function ii(ft,oe,ge,Ie,$e){const Ke=-Re,at=r.al+Re;let At;for(let lt=0;lt<ft.length-2;lt+=2){let Tt=Math.round(r.al*(ft[lt+0]*oe-ge)),Wt=Math.round(r.al*(ft[lt+1]*oe-Ie)),ye=Math.round(r.al*(ft[lt+2]*oe-ge)),it=Math.round(r.al*(ft[lt+3]*oe-Ie));const wt=ye-Tt,ht=it-Wt;Tt<Ke&&ye<Ke||(Tt<Ke?(Wt+=Math.round(ht*((Ke-Tt)/wt)),Tt=Ke):ye<Ke&&(it=Wt+Math.round(ht*((Ke-Tt)/wt)),ye=Ke),Wt<Ke&&it<Ke||(Wt<Ke?(Tt+=Math.round(wt*((Ke-Wt)/ht)),Wt=Ke):it<Ke&&(ye=Tt+Math.round(wt*((Ke-Wt)/ht)),it=Ke),Tt>=at&&ye>=at||(Tt>=at?(Wt+=Math.round(ht*((at-Tt)/wt)),Tt=at):ye>=at&&(it=Wt+Math.round(ht*((at-Tt)/wt)),ye=at),Wt>=at&&it>=at||(Wt>=at?(Tt+=Math.round(wt*((at-Wt)/ht)),Wt=at):it>=at&&(ye=Tt+Math.round(wt*((at-Wt)/ht)),it=at),At&&Tt===At[At.length-1][0]&&Wt===At[At.length-1][1]||(At=[[Tt,Wt]],$e.push(At)),At.push([ye,it])))))}}function ki(ft,oe,ge,Ie,$e){const Ke=(ge-kt)/oe,at=(Ie-kt)/oe,At=(ge+1+kt)/oe,lt=(Ie+1+kt)/oe;function Tt(it,wt){let ht=0;return it<Ke?ht|=1:it>At&&(ht|=2),wt<at?ht|=4:wt>lt&&(ht|=8),ht}let Wt=[];for(let it=1;it<=8;it*=2){let wt=ft[ft.length-2],ht=ft[ft.length-1],bt=!(Tt(wt,ht)&it);for(let mi=0;mi<ft.length;mi+=2){const bi=ft[mi],ji=ft[mi+1],pn=!(Tt(bi,ji)&it);pn!==bt&&(8&it?Wt.push(wt+(bi-wt)*(lt-ht)/(ji-ht),lt):4&it?Wt.push(wt+(bi-wt)*(at-ht)/(ji-ht),at):2&it?Wt.push(At,ht+(ji-ht)*(At-wt)/(bi-wt)):1&it&&Wt.push(Ke,ht+(ji-ht)*(Ke-wt)/(bi-wt))),pn&&Wt.push(bi,ji),wt=bi,ht=ji,bt=pn}if(!(ft=Wt).length||it===8)break;Wt=[]}const ye=[];for(let it=0;it<Wt.length;it+=2)ye.push([Math.round(r.al*(Wt[it]*oe-ge)),Math.round(r.al*(Wt[it+1]*oe-Ie))]);$e.push(ye)}function qt({name:ft,features:oe},ge){ge.writeStringField(1,ft),ge.writeVarintField(5,r.al);const Ie=new Map,$e=new Map,Ke={keys:Ie,values:$e,feature:null};for(const at of oe)Ke.feature=at,ge.writeMessage(2,xi,Ke);for(const at of Ie.keys())ge.writeStringField(3,at);for(const at of $e.keys())ge.writeMessage(4,Er,at)}function xi(ft,oe){const ge=ft.feature;ge.id!==void 0&&Number.isSafeInteger(+ge.id)&&oe.writeVarintField(1,+ge.id),ge.tags&&oe.writeMessage(2,Fi,ft),oe.writeVarintField(3,ge.type),oe.writeMessage(4,Fn,ge)}function Fi({keys:ft,values:oe,feature:ge},Ie){for(const $e of Object.keys(ge.tags)){let Ke=ge.tags[$e];if(Ke===null)continue;let at=ft.get($e);at===void 0&&(at=ft.size,ft.set($e,at)),Ie.writeVarint(at);const At=typeof Ke;At!=="string"&&At!=="boolean"&&At!=="number"&&(Ke=JSON.stringify(Ke));let lt=oe.get(Ke);lt===void 0&&(lt=oe.size,oe.set(Ke,lt)),Ie.writeVarint(lt)}}function Ui(ft,oe){return(oe<<3)+(7&ft)}function rn(ft){return ft<<1^ft>>31}function Fn(ft,oe){const{geometry:ge,type:Ie}=ft;let $e=0,Ke=0;if(Ie===1){oe.writeVarint(Ui(1,ge.length));for(const at of ge){const At=at[0]-$e,lt=at[1]-Ke;oe.writeVarint(rn(At)),oe.writeVarint(rn(lt)),$e+=At,Ke+=lt}}else for(const at of ge){oe.writeVarint(Ui(1,1));const At=at.length-(Ie===3?1:0);for(let lt=0;lt<At;lt++){lt===1&&oe.writeVarint(Ui(2,At-1));const Tt=at[lt][0]-$e,Wt=at[lt][1]-Ke;oe.writeVarint(rn(Tt)),oe.writeVarint(rn(Wt)),$e+=Tt,Ke+=Wt}Ie===3&&oe.writeVarint(Ui(7,1))}}function Er(ft,oe){const ge=typeof ft;ge==="string"?oe.writeStringField(1,ft):ge==="boolean"?oe.writeBooleanField(7,ft):ge==="number"&&(ft%1!=0?oe.writeDoubleField(3,ft):ft<0?oe.writeSVarintField(6,ft):oe.writeVarintField(5,ft))}const xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ft=>ft},Vi=Math.fround||(st=new Float32Array(1),ft=>(st[0]=+ft,st[0]));var st;const Xi=3,Ji=5,Di=6;class tn{constructor(oe){this.options=Object.assign(Object.create(xn),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:ge,minZoom:Ie,maxZoom:$e}=this.options;ge&&console.time("total time");const Ke=`prepare ${oe.length} points`;ge&&console.time(Ke),this.points=oe;const at=[];for(let lt=0;lt<oe.length;lt++){const Tt=oe[lt];if(!Tt.geometry)continue;const[Wt,ye]=Tt.geometry.coordinates,it=Vi(Gn(Wt)),wt=Vi(ot(ye));at.push(it,wt,1/0,lt,-1,1),this.options.reduce&&at.push(0)}let At=this.trees[$e+1]=this._createTree(at);ge&&console.timeEnd(Ke);for(let lt=$e;lt>=Ie;lt--){const Tt=+Date.now();At=this.trees[lt]=this._createTree(this._cluster(At,lt)),ge&&console.log("z%d: %d clusters in %dms",lt,At.numItems,+Date.now()-Tt)}return ge&&console.timeEnd("total time"),this}getClusters(oe,ge){let Ie=((oe[0]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,oe[1]));let Ke=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)Ie=-180,Ke=180;else if(Ie>Ke){const ye=this.getClusters([Ie,$e,180,at],ge),it=this.getClusters([-180,$e,Ke,at],ge);return ye.concat(it)}const At=this.trees[this._limitZoom(ge)],lt=At.range(Gn(Ie),ot(at),Gn(Ke),ot($e)),Tt=At.data,Wt=[];for(const ye of lt){const it=this.stride*ye;Wt.push(Tt[it+Ji]>1?Sn(Tt,it,this.clusterProps):this.points[Tt[it+Xi]])}return Wt}getChildren(oe){const ge=this._getOriginId(oe),Ie=this._getOriginZoom(oe),$e="No cluster with the specified id.",Ke=this.trees[Ie];if(!Ke)throw new Error($e);const at=Ke.data;if(ge*this.stride>=at.length)throw new Error($e);const At=this.options.radius/(this.options.extent*Math.pow(2,Ie-1)),lt=Ke.within(at[ge*this.stride],at[ge*this.stride+1],At),Tt=[];for(const Wt of lt){const ye=Wt*this.stride;at[ye+4]===oe&&Tt.push(at[ye+Ji]>1?Sn(at,ye,this.clusterProps):this.points[at[ye+Xi]])}if(Tt.length===0)throw new Error($e);return Tt}getLeaves(oe,ge,Ie){const $e=[];return this._appendLeaves($e,oe,ge=ge||10,Ie=Ie||0,0),$e}getTile(oe,ge,Ie){const $e=this.trees[this._limitZoom(oe)],Ke=Math.pow(2,oe),{extent:at,radius:At}=this.options,lt=At/at,Tt=(Ie-lt)/Ke,Wt=(Ie+1+lt)/Ke,ye={features:[]};return this._addTileFeatures($e.range((ge-lt)/Ke,Tt,(ge+1+lt)/Ke,Wt),$e.data,ge,Ie,Ke,ye),ge===0&&this._addTileFeatures($e.range(1-lt/Ke,Tt,1,Wt),$e.data,Ke,Ie,Ke,ye),ge===Ke-1&&this._addTileFeatures($e.range(0,Tt,lt/Ke,Wt),$e.data,-1,Ie,Ke,ye),ye.features.length?ye:null}getClusterExpansionZoom(oe){let ge=this._getOriginZoom(oe)-1;for(;ge<=this.options.maxZoom;){const Ie=this.getChildren(oe);if(ge++,Ie.length!==1)break;oe=Ie[0].properties.cluster_id}return ge}_appendLeaves(oe,ge,Ie,$e,Ke){const at=this.getChildren(ge);for(const At of at){const lt=At.properties;if(lt&&lt.cluster?Ke+lt.point_count<=$e?Ke+=lt.point_count:Ke=this._appendLeaves(oe,lt.cluster_id,Ie,$e,Ke):Ke<$e?Ke++:oe.push(At),oe.length===Ie)break}return Ke}_createTree(oe){const ge=new r.c4(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ie=0;Ie<oe.length;Ie+=this.stride)ge.add(oe[Ie],oe[Ie+1]);return ge.finish(),ge.data=oe,ge}_addTileFeatures(oe,ge,Ie,$e,Ke,at){for(const At of oe){const lt=At*this.stride,Tt=ge[lt+Ji]>1;let Wt,ye,it;if(Tt)Wt=_n(ge,lt,this.clusterProps),ye=ge[lt],it=ge[lt+1];else{const bt=this.points[ge[lt+Xi]];Wt=bt.properties;const[mi,bi]=bt.geometry.coordinates;ye=Gn(mi),it=ot(bi)}const wt={type:1,geometry:[[Math.round(this.options.extent*(ye*Ke-Ie)),Math.round(this.options.extent*(it*Ke-$e))]],tags:Wt};let ht;ht=Tt||this.options.generateId?ge[lt+Xi]:this.points[ge[lt+Xi]].id,ht!==void 0&&(wt.id=ht),at.features.push(wt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,ge){const{radius:Ie,extent:$e,reduce:Ke,minPoints:at}=this.options,At=Ie/($e*Math.pow(2,ge)),lt=oe.data,Tt=[],Wt=this.stride;for(let ye=0;ye<lt.length;ye+=Wt){if(lt[ye+2]<=ge)continue;lt[ye+2]=ge;const it=lt[ye],wt=lt[ye+1],ht=oe.within(lt[ye],lt[ye+1],At),bt=lt[ye+Ji];let mi=bt;for(const bi of ht){const ji=bi*Wt;lt[ji+2]>ge&&(mi+=lt[ji+Ji])}if(mi>bt&&mi>=at){let bi,ji=it*bt,pn=wt*bt,Vn=-1;const Un=(ye/Wt<<5)+(ge+1)+this.points.length;for(const kn of ht){const Wn=kn*Wt;if(lt[Wn+2]<=ge)continue;lt[Wn+2]=ge;const Cn=lt[Wn+Ji];ji+=lt[Wn]*Cn,pn+=lt[Wn+1]*Cn,lt[Wn+4]=Un,Ke&&(bi||(bi=this._map(lt,ye,!0),Vn=this.clusterProps.length,this.clusterProps.push(bi)),Ke(bi,this._map(lt,Wn)))}lt[ye+4]=Un,Tt.push(ji/mi,pn/mi,1/0,Un,-1,mi),Ke&&Tt.push(Vn)}else{for(let bi=0;bi<Wt;bi++)Tt.push(lt[ye+bi]);if(mi>1)for(const bi of ht){const ji=bi*Wt;if(!(lt[ji+2]<=ge)){lt[ji+2]=ge;for(let pn=0;pn<Wt;pn++)Tt.push(lt[ji+pn])}}}}return Tt}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,ge,Ie){if(oe[ge+Ji]>1){const at=this.clusterProps[oe[ge+Di]];return Ie?Object.assign({},at):at}const $e=this.points[oe[ge+Xi]].properties,Ke=this.options.map($e);return Ie&&Ke===$e?Object.assign({},Ke):Ke}}function Sn(ft,oe,ge){return{type:"Feature",id:ft[oe+Xi],properties:_n(ft,oe,ge),geometry:{type:"Point",coordinates:[(Ie=ft[oe],360*(Ie-.5)),De(ft[oe+1])]}};var Ie}function _n(ft,oe,ge){const Ie=ft[oe+Ji],$e=Ie>=1e4?`${Math.round(Ie/1e3)}k`:Ie>=1e3?Math.round(Ie/100)/10+"k":Ie,Ke=ft[oe+Di],at=Ke===-1?{}:Object.assign({},ge[Ke]);return Object.assign(at,{cluster:!0,cluster_id:ft[oe+Xi],point_count:Ie,point_count_abbreviated:$e})}function Gn(ft){return ft/360+.5}function ot(ft){const oe=Math.sin(ft*Math.PI/180),ge=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ge<0?0:ge>1?1:ge}function De(ft){const oe=(180-360*ft)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Qt(ft,oe,ge,Ie){let $e=Ie;const Ke=oe+(ge-oe>>1);let at,At=ge-oe;const lt=ft[oe],Tt=ft[oe+1],Wt=ft[ge],ye=ft[ge+1];for(let it=oe+3;it<ge;it+=3){const wt=Li(ft[it],ft[it+1],lt,Tt,Wt,ye);if(wt>$e)at=it,$e=wt;else if(wt===$e){const ht=Math.abs(it-Ke);ht<At&&(at=it,At=ht)}}$e>Ie&&(at-oe>3&&Qt(ft,oe,at,Ie),ft[at+2]=$e,ge-at>3&&Qt(ft,at,ge,Ie))}function Li(ft,oe,ge,Ie,$e,Ke){let at=$e-ge,At=Ke-Ie;if(at!==0||At!==0){const lt=((ft-ge)*at+(oe-Ie)*At)/(at*at+At*At);lt>1?(ge=$e,Ie=Ke):lt>0&&(ge+=at*lt,Ie+=At*lt)}return at=ft-ge,At=oe-Ie,at*at+At*At}function Wi(ft,oe,ge,Ie){const $e={id:ft??null,type:oe,geometry:ge,tags:Ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Ei($e,ge);else if(oe==="Polygon")Ei($e,ge[0]);else if(oe==="MultiLineString")for(const Ke of ge)Ei($e,Ke);else if(oe==="MultiPolygon")for(const Ke of ge)Ei($e,Ke[0]);return $e}function Ei(ft,oe){for(let ge=0;ge<oe.length;ge+=3)ft.minX=Math.min(ft.minX,oe[ge]),ft.minY=Math.min(ft.minY,oe[ge+1]),ft.maxX=Math.max(ft.maxX,oe[ge]),ft.maxY=Math.max(ft.maxY,oe[ge+1])}function Hn(ft,oe,ge,Ie){if(!oe.geometry)return;const $e=oe.geometry.coordinates;if($e&&$e.length===0)return;const Ke=oe.geometry.type,at=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2);let At=[],lt=oe.id;if(ge.promoteId?lt=oe.properties[ge.promoteId]:ge.generateId&&(lt=Ie||0),Ke==="Point")An($e,At);else if(Ke==="MultiPoint")for(const Tt of $e)An(Tt,At);else if(Ke==="LineString")dr($e,At,at,!1);else if(Ke==="MultiLineString"){if(ge.lineMetrics){for(const Tt of $e)At=[],dr(Tt,At,at,!1),ft.push(Wi(lt,"LineString",At,oe.properties));return}Jn($e,At,at,!1)}else if(Ke==="Polygon")Jn($e,At,at,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(const Tt of oe.geometry.geometries)Hn(ft,{id:lt,geometry:Tt,properties:oe.properties},ge,Ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Tt of $e){const Wt=[];Jn(Tt,Wt,at,!0),At.push(Wt)}}ft.push(Wi(lt,Ke,At,oe.properties))}function An(ft,oe){oe.push(Qi(ft[0]),qi(ft[1]),0)}function dr(ft,oe,ge,Ie){let $e,Ke,at=0;for(let lt=0;lt<ft.length;lt++){const Tt=Qi(ft[lt][0]),Wt=qi(ft[lt][1]);oe.push(Tt,Wt,0),lt>0&&(at+=Ie?($e*Wt-Tt*Ke)/2:Math.sqrt(Math.pow(Tt-$e,2)+Math.pow(Wt-Ke,2))),$e=Tt,Ke=Wt}const At=oe.length-3;oe[2]=1,Qt(oe,0,At,ge),oe[At+2]=1,oe.size=Math.abs(at),oe.start=0,oe.end=oe.size}function Jn(ft,oe,ge,Ie){for(let $e=0;$e<ft.length;$e++){const Ke=[];dr(ft[$e],Ke,ge,Ie),oe.push(Ke)}}function Qi(ft){return ft/360+.5}function qi(ft){const oe=Math.sin(ft*Math.PI/180),ge=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ge<0?0:ge>1?1:ge}function Xn(ft,oe,ge,Ie,$e,Ke,at,At){if(Ie/=oe,Ke>=(ge/=oe)&&at<Ie)return ft;if(at<ge||Ke>=Ie)return null;const lt=[];for(const Tt of ft){const Wt=Tt.geometry;let ye=Tt.type;const it=$e===0?Tt.minX:Tt.minY,wt=$e===0?Tt.maxX:Tt.maxY;if(it>=ge&&wt<Ie){lt.push(Tt);continue}if(wt<ge||it>=Ie)continue;let ht=[];if(ye==="Point"||ye==="MultiPoint")Qn(Wt,ht,ge,Ie,$e);else if(ye==="LineString")Nn(Wt,ht,ge,Ie,$e,!1,At.lineMetrics);else if(ye==="MultiLineString")Rt(Wt,ht,ge,Ie,$e,!1);else if(ye==="Polygon")Rt(Wt,ht,ge,Ie,$e,!0);else if(ye==="MultiPolygon")for(const bt of Wt){const mi=[];Rt(bt,mi,ge,Ie,$e,!0),mi.length&&ht.push(mi)}if(ht.length){if(At.lineMetrics&&ye==="LineString"){for(const bt of ht)lt.push(Wi(Tt.id,ye,bt,Tt.tags));continue}ye!=="LineString"&&ye!=="MultiLineString"||(ht.length===1?(ye="LineString",ht=ht[0]):ye="MultiLineString"),ye!=="Point"&&ye!=="MultiPoint"||(ye=ht.length===3?"Point":"MultiPoint"),lt.push(Wi(Tt.id,ye,ht,Tt.tags))}}return lt.length?lt:null}function Qn(ft,oe,ge,Ie,$e){for(let Ke=0;Ke<ft.length;Ke+=3){const at=ft[Ke+$e];at>=ge&&at<=Ie&&wn(oe,ft[Ke],ft[Ke+1],ft[Ke+2])}}function Nn(ft,oe,ge,Ie,$e,Ke,at){let At=xr(ft);const lt=$e===0?vn:bn;let Tt,Wt,ye=ft.start;for(let mi=0;mi<ft.length-3;mi+=3){const bi=ft[mi],ji=ft[mi+1],pn=ft[mi+2],Vn=ft[mi+3],Un=ft[mi+4],kn=$e===0?bi:ji,Wn=$e===0?Vn:Un;let Cn=!1;at&&(Tt=Math.sqrt(Math.pow(bi-Vn,2)+Math.pow(ji-Un,2))),kn<ge?Wn>ge&&(Wt=lt(At,bi,ji,Vn,Un,ge),at&&(At.start=ye+Tt*Wt)):kn>Ie?Wn<Ie&&(Wt=lt(At,bi,ji,Vn,Un,Ie),at&&(At.start=ye+Tt*Wt)):wn(At,bi,ji,pn),Wn<ge&&kn>=ge&&(Wt=lt(At,bi,ji,Vn,Un,ge),Cn=!0),Wn>Ie&&kn<=Ie&&(Wt=lt(At,bi,ji,Vn,Un,Ie),Cn=!0),!Ke&&Cn&&(at&&(At.end=ye+Tt*Wt),oe.push(At),At=xr(ft)),at&&(ye+=Tt)}let it=ft.length-3;const wt=ft[it],ht=ft[it+1],bt=$e===0?wt:ht;bt>=ge&&bt<=Ie&&wn(At,wt,ht,ft[it+2]),it=At.length-3,Ke&&it>=3&&(At[it]!==At[0]||At[it+1]!==At[1])&&wn(At,At[0],At[1],At[2]),At.length&&oe.push(At)}function xr(ft){const oe=[];return oe.size=ft.size,oe.start=ft.start,oe.end=ft.end,oe}function Rt(ft,oe,ge,Ie,$e,Ke){for(const at of ft)Nn(at,oe,ge,Ie,$e,Ke,!1)}function wn(ft,oe,ge,Ie){ft.push(oe,ge,Ie)}function vn(ft,oe,ge,Ie,$e,Ke){const at=(Ke-oe)/(Ie-oe);return wn(ft,Ke,ge+($e-ge)*at,1),at}function bn(ft,oe,ge,Ie,$e,Ke){const at=(Ke-ge)/($e-ge);return wn(ft,oe+(Ie-oe)*at,Ke,1),at}function Pi(ft,oe){const ge=[];for(let Ie=0;Ie<ft.length;Ie++){const $e=ft[Ie],Ke=$e.type;let at;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")at=zi($e.geometry,oe);else if(Ke==="MultiLineString"||Ke==="Polygon"){at=[];for(const At of $e.geometry)at.push(zi(At,oe))}else if(Ke==="MultiPolygon"){at=[];for(const At of $e.geometry){const lt=[];for(const Tt of At)lt.push(zi(Tt,oe));at.push(lt)}}ge.push(Wi($e.id,Ke,at,$e.tags))}return ge}function zi(ft,oe){const ge=[];ge.size=ft.size,ft.start!==void 0&&(ge.start=ft.start,ge.end=ft.end);for(let Ie=0;Ie<ft.length;Ie+=3)ge.push(ft[Ie]+oe,ft[Ie+1],ft[Ie+2]);return ge}function Kn(ft,oe){if(ft.transformed)return ft;const ge=1<<ft.z,Ie=ft.x,$e=ft.y;for(const Ke of ft.features){const at=Ke.geometry,At=Ke.type;if(Ke.geometry=[],At===1)for(let lt=0;lt<at.length;lt+=2)Ke.geometry.push(Dr(at[lt],at[lt+1],oe,ge,Ie,$e));else for(let lt=0;lt<at.length;lt++){const Tt=[];for(let Wt=0;Wt<at[lt].length;Wt+=2)Tt.push(Dr(at[lt][Wt],at[lt][Wt+1],oe,ge,Ie,$e));Ke.geometry.push(Tt)}}return ft.transformed=!0,ft}function Dr(ft,oe,ge,Ie,$e,Ke){return[Math.round(ge*(ft*Ie-$e)),Math.round(ge*(oe*Ie-Ke))]}function ls(ft,oe,ge,Ie,$e){const Ke=oe===$e.maxZoom?0:$e.tolerance/((1<<oe)*$e.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:ft.length,source:null,x:ge,y:Ie,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const At of ft)Ts(at,At,Ke,$e);return at}function Ts(ft,oe,ge,Ie){const $e=oe.geometry,Ke=oe.type,at=[];if(ft.minX=Math.min(ft.minX,oe.minX),ft.minY=Math.min(ft.minY,oe.minY),ft.maxX=Math.max(ft.maxX,oe.maxX),ft.maxY=Math.max(ft.maxY,oe.maxY),Ke==="Point"||Ke==="MultiPoint")for(let At=0;At<$e.length;At+=3)at.push($e[At],$e[At+1]),ft.numPoints++,ft.numSimplified++;else if(Ke==="LineString")Xt(at,$e,ft,ge,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(let At=0;At<$e.length;At++)Xt(at,$e[At],ft,ge,Ke==="Polygon",At===0);else if(Ke==="MultiPolygon")for(let At=0;At<$e.length;At++){const lt=$e[At];for(let Tt=0;Tt<lt.length;Tt++)Xt(at,lt[Tt],ft,ge,!0,Tt===0)}if(at.length){let At=oe.tags||null;if(Ke==="LineString"&&Ie.lineMetrics){At={};for(const Tt in oe.tags)At[Tt]=oe.tags[Tt];At.mapbox_clip_start=$e.start/$e.size,At.mapbox_clip_end=$e.end/$e.size}const lt={geometry:at,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:At};oe.id!==null&&(lt.id=oe.id),ft.features.push(lt)}}function Xt(ft,oe,ge,Ie,$e,Ke){const at=Ie*Ie;if(Ie>0&&oe.size<($e?at:Ie))return void(ge.numPoints+=oe.length/3);const At=[];for(let lt=0;lt<oe.length;lt+=3)(Ie===0||oe[lt+2]>at)&&(ge.numSimplified++,At.push(oe[lt],oe[lt+1])),ge.numPoints++;$e&&(function(lt,Tt){let Wt=0;for(let ye=0,it=lt.length,wt=it-2;ye<it;wt=ye,ye+=2)Wt+=(lt[ye]-lt[wt])*(lt[ye+1]+lt[wt+1]);if(Wt>0===Tt)for(let ye=0,it=lt.length;ye<it/2;ye+=2){const wt=lt[ye],ht=lt[ye+1];lt[ye]=lt[it-2-ye],lt[ye+1]=lt[it-1-ye],lt[it-2-ye]=wt,lt[it-1-ye]=ht}})(At,Ke),ft.push(At)}const ja={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $f{constructor(oe,ge){const Ie=(ge=this.options=(function(Ke,at){for(const At in at)Ke[At]=at[At];return Ke})(Object.create(ja),ge)).debug;if(Ie&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let $e=(function(Ke,at){const At=[];if(Ke.type==="FeatureCollection")for(let lt=0;lt<Ke.features.length;lt++)Hn(At,Ke.features[lt],at,lt);else Hn(At,Ke.type==="Feature"?Ke:{geometry:Ke},at);return At})(oe,ge);this.tiles={},this.tileCoords=[],Ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$e=(function(Ke,at){const At=at.buffer/at.extent;let lt=Ke;const Tt=Xn(Ke,1,-1-At,At,0,-1,2,at),Wt=Xn(Ke,1,1-At,2+At,0,-1,2,at);return(Tt||Wt)&&(lt=Xn(Ke,1,-At,1+At,0,-1,2,at)||[],Tt&&(lt=Pi(Tt,1).concat(lt)),Wt&&(lt=lt.concat(Pi(Wt,-1)))),lt})($e,ge),$e.length&&this.splitTile($e,0,0,0),Ie&&($e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,ge,Ie,$e,Ke,at,At){const lt=[oe,ge,Ie,$e],Tt=this.options,Wt=Tt.debug;for(;lt.length;){$e=lt.pop(),Ie=lt.pop(),ge=lt.pop(),oe=lt.pop();const ye=1<<ge,it=ac(ge,Ie,$e);let wt=this.tiles[it];if(!wt&&(Wt>1&&console.time("creation"),wt=this.tiles[it]=ls(oe,ge,Ie,$e,Tt),this.tileCoords.push({z:ge,x:Ie,y:$e}),Wt)){Wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,Ie,$e,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));const Cn=`z${ge}`;this.stats[Cn]=(this.stats[Cn]||0)+1,this.total++}if(wt.source=oe,Ke==null){if(ge===Tt.indexMaxZoom||wt.numPoints<=Tt.indexMaxPoints)continue}else{if(ge===Tt.maxZoom||ge===Ke)continue;if(Ke!=null){const Cn=Ke-ge;if(Ie!==at>>Cn||$e!==At>>Cn)continue}}if(wt.source=null,oe.length===0)continue;Wt>1&&console.time("clipping");const ht=.5*Tt.buffer/Tt.extent,bt=.5-ht,mi=.5+ht,bi=1+ht;let ji=null,pn=null,Vn=null,Un=null,kn=Xn(oe,ye,Ie-ht,Ie+mi,0,wt.minX,wt.maxX,Tt),Wn=Xn(oe,ye,Ie+bt,Ie+bi,0,wt.minX,wt.maxX,Tt);oe=null,kn&&(ji=Xn(kn,ye,$e-ht,$e+mi,1,wt.minY,wt.maxY,Tt),pn=Xn(kn,ye,$e+bt,$e+bi,1,wt.minY,wt.maxY,Tt),kn=null),Wn&&(Vn=Xn(Wn,ye,$e-ht,$e+mi,1,wt.minY,wt.maxY,Tt),Un=Xn(Wn,ye,$e+bt,$e+bi,1,wt.minY,wt.maxY,Tt),Wn=null),Wt>1&&console.timeEnd("clipping"),lt.push(ji||[],ge+1,2*Ie,2*$e),lt.push(pn||[],ge+1,2*Ie,2*$e+1),lt.push(Vn||[],ge+1,2*Ie+1,2*$e),lt.push(Un||[],ge+1,2*Ie+1,2*$e+1)}}getTile(oe,ge,Ie){oe=+oe,ge=+ge,Ie=+Ie;const $e=this.options,{extent:Ke,debug:at}=$e;if(oe<0||oe>24)return null;const At=1<<oe,lt=ac(oe,ge=ge+At&At-1,Ie);if(this.tiles[lt])return Kn(this.tiles[lt],Ke);at>1&&console.log("drilling down to z%d-%d-%d",oe,ge,Ie);let Tt,Wt=oe,ye=ge,it=Ie;for(;!Tt&&Wt>0;)Wt--,ye>>=1,it>>=1,Tt=this.tiles[ac(Wt,ye,it)];return Tt&&Tt.source?(at>1&&(console.log("found parent tile z%d-%d-%d",Wt,ye,it),console.time("drilling down")),this.splitTile(Tt.source,Wt,ye,it,oe,ge,Ie),at>1&&console.timeEnd("drilling down"),this.tiles[lt]?Kn(this.tiles[lt],Ke):null):null}}function ac(ft,oe,ge){return 32*((1<<ft)*ge+oe)+ft}function Ar(ft,oe){const ge=ft.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const Ie=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!Ie)return void oe(null,null);const $e=Tt=>Tt.tags&&"3d_elevation_id"in Tt.tags&&"source"in Tt.tags&&Tt.tags.source==="elevation",Ke=Ie.features.filter((Tt=>$e(Tt)));let at={_geojsonTileLayer:Ie.features};Ke.length>0&&(at={_geojsonTileLayer:Ie.features.filter((Tt=>!$e(Tt))),hd_road_elevation:Ke});const At=new Gt(at),lt=(function(Tt){const Wt=new r.bt;for(const ye of Object.keys(Tt))Wt.writeMessage(3,qt,{name:ye,features:Tt[ye]});return Wt.finish()})(at).buffer;oe(null,{vectorTile:At,rawData:lt})}class js extends ze{constructor(oe,ge,Ie,$e,Ke,at,At){super(oe,ge,Ie,$e,Ke,Ar,At),at&&(this.loadGeoJSON=at),this._dynamicIndex=new Qe}loadData(oe,ge){const Ie=oe&&oe.request,$e=Ie&&Ie.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(oe,((Ke,at)=>{if(Ke||!at)return ge(Ke);if(typeof at!="object")return ge(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const lt=r.U(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(lt.result==="error")throw new Error(lt.value.map((Tt=>`${Tt.key}: ${Tt.message}`)).join(", "));at.features=at.features.filter((Tt=>lt.value.evaluate({zoom:0},Tt)))}oe.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),oe.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new tn((function({superclusterOptions:lt,clusterProperties:Tt}){if(!Tt||!lt)return lt;const Wt={},ye={},it={accumulated:null,zoom:0},wt={properties:null},ht=Object.keys(Tt);for(const bt of ht){const[mi,bi]=Tt[bt],ji=r.U(bi),pn=r.U(typeof mi=="string"?[mi,["accumulated"],["get",bt]]:mi);Wt[bt]=ji.value,ye[bt]=pn.value}return lt.map=bt=>{wt.properties=bt;const mi={};for(const bi of ht)mi[bi]=Wt[bi].evaluate(it,wt);return mi},lt.reduce=(bt,mi)=>{wt.properties=mi;for(const bi of ht)it.accumulated=bt[bi],bt[bi]=ye[bi].evaluate(it,wt)},lt})(oe)).load(at.features):oe.dynamic?this._dynamicIndex:(function(lt,Tt){return new $f(lt,Tt)})(at,oe.geojsonVtOptions)}catch(lt){return ge(lt)}const At={};if($e){const lt=C(Ie);lt&&(At.resourceTiming={},At.resourceTiming[oe.source]=JSON.parse(JSON.stringify(lt)))}ge(null,At)}}))}reloadTile(oe,ge){const Ie=this.loaded;return Ie&&Ie[oe.uid]?oe.partial?ge(null,void 0):super.reloadTile(oe,ge):this.loadTile(oe,ge)}loadGeoJSON(oe,ge){if(oe.request)r.m(oe.request,ge);else{if(typeof oe.data!="string")return ge(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return ge(null,JSON.parse(oe.data))}catch{return ge(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(oe,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Ie){ge(Ie)}}getClusterChildren(oe,ge){try{ge(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Ie){ge(Ie)}}getClusterLeaves(oe,ge){try{ge(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Ie){ge(Ie)}}}class Bu{constructor(oe,ge,Ie){this.tileID=new r.aQ(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=ge,this.worldview=Ie}parse(oe,ge,Ie,$e){this.status="parsing";const Ke=new r.aQ(Ie.tileID.overscaledZ,Ie.tileID.wrap,Ie.tileID.canonical.z,Ie.tileID.canonical.x,Ie.tileID.canonical.y),at=[],At=ge.familiesBySource[Ie.source],lt=new r.fn(Ke,Ie.promoteId);lt.bucketLayerIDs=[],lt.is3DTile=!0,r.fC(oe).then((Tt=>{if(!Tt)return $e(new Error("Could not parse tile"));const Wt=Tt.json.extensionsUsed&&Tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Tt.json.asset.extras&&Tt.json.asset.extras.MAPBOX_mesh_features,ye=Tt.json.extensionsUsed&&Tt.json.extensionsUsed.includes("EXT_meshopt_compression"),it=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const wt in At)for(const ht of At[wt]){const bt=ht[0];lt.bucketLayerIDs.push(ht.map((ji=>r.B(ji.id,ji.scope)))),bt.recalculate(it,[]);const mi=r.fD(Tt,1/r.d7(Ie.tileID.canonical)),bi=new r.fE(ht,mi,Ke,Wt,ye,this.brightness,lt,this.worldview);Wt||(bi.needsUpload=!0),at.push(bi),bi.evaluate(bt)}this.status="done",$e(null,{buckets:at,featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Tt=>$e(new Error(Tt.message))))}}class Lo{constructor(oe,ge,Ie,$e,Ke,at,At,lt){this.actor=oe,this.layerIndex=ge,this.availableImages=Ie,this.availableModels=$e,this.brightness=At,this.loading={},this.loaded={},this.worldview=lt}loadTile(oe,ge){const Ie=oe.uid,$e=this.loading[Ie]=new Bu(oe,this.brightness,this.worldview);r.bu(oe.request,((Ke,at)=>{const At=!this.loading[Ie];return delete this.loading[Ie],At||Ke?($e.status="done",At||(this.loaded[Ie]=$e),ge(Ke)):at&&at.byteLength!==0?void $e.parse(at,this.layerIndex,oe,((lt,Tt)=>{$e.status="done",this.loaded=this.loaded||{},this.loaded[Ie]=$e,lt||!Tt?ge(lt):ge(null,Tt)})):($e.status="done",this.loaded[Ie]=$e,ge())}))}reloadTile(oe,ge){const Ie=this.loaded,$e=oe.uid;if(Ie&&Ie[$e]){const Ke=Ie[$e];Ke.projection=oe.projection,Ke.brightness=oe.brightness;const at=(At,lt)=>{Ke.reloadCallback&&(delete Ke.reloadCallback,this.loadTile(oe,ge)),ge(At,lt)};Ke.status==="parsing"?Ke.reloadCallback=at:Ke.status==="done"&&this.loadTile(oe,ge)}}abortTile(oe,ge){const Ie=oe.uid;this.loading[Ie]&&delete this.loading[Ie],ge()}removeTile(oe,ge){const Ie=this.loaded,$e=oe.uid;Ie&&Ie[$e]&&delete Ie[$e],ge()}}class jo{constructor(oe){this.self=oe,this.actor=new r.fG(oe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cm({name:"mercator"}),this.workerSourceTypes={vector:ze,geojson:js,"raster-dem":je,"raster-array":Te,"batched-model":Lo},this.workerSources={},this.self.registerWorkerSource=(ge,Ie)=>{if(this.workerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.workerSourceTypes[ge]=Ie},this.self.registerRTLTextPlugin=ge=>{if(r.fH.isParsed())throw new Error("RTL text plugin already registered.");r.fH.setState({pluginStatus:r.fI.parsed,pluginURL:r.fH.getPluginURL()}),r.fH.applyArabicShaping=ge.applyArabicShaping,r.fH.processBidirectionalText=ge.processBidirectionalText,r.fH.processStyledBidirectionalText=ge.processStyledBidirectionalText;for(const Ie of this.rtlPluginParsingListeners)Ie(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(oe,ge,Ie){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.availableModels[oe],delete this.workerSources[oe],Ie()}checkIfReady(oe,ge,Ie){Ie()}setReferrer(oe,ge){this.referrer=ge}spriteLoaded(oe,ge){this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={});const{scope:Ie,isLoaded:$e}=ge;if(this.isSpriteLoaded[oe][Ie]=$e,this.workerSources[oe]&&this.workerSources[oe][Ie])for(const Ke in this.workerSources[oe][Ie]){const at=this.workerSources[oe][Ie][Ke];for(const At in at){const lt=at[At];lt instanceof ze&&(lt.isSpriteLoaded=$e,lt.fire(new r.z("isSpriteLoaded")))}}}setImages(oe,ge,Ie){this.availableImages[oe]||(this.availableImages[oe]={});const{scope:$e,images:Ke}=ge;if(this.availableImages[oe][$e]=Ke,this.workerSources[oe]&&this.workerSources[oe][$e]){for(const at in this.workerSources[oe][$e]){const At=this.workerSources[oe][$e][at];for(const lt in At)At[lt].availableImages=Ke}Ie()}else Ie()}setModels(oe,{scope:ge,models:Ie},$e){if(this.availableModels[oe]||(this.availableModels[oe]={}),this.availableModels[oe][ge]=Ie,this.workerSources[oe]&&this.workerSources[oe][ge]){for(const Ke in this.workerSources[oe][ge]){const at=this.workerSources[oe][ge][Ke];for(const At in at)at[At].availableModels=Ie}$e()}else $e()}setProjection(oe,ge){this.projections[oe]=r.cm(ge)}setBrightness(oe,ge,Ie){this.brightness=ge,Ie()}setWorldview(oe,ge,Ie){this.worldview=ge,Ie()}setLayers(oe,ge,Ie){this.getLayerIndex(oe,ge.scope).replace(ge.layers,ge.options),Ie()}updateLayers(oe,ge,Ie){this.getLayerIndex(oe,ge.scope).update(ge.layers,ge.removedIds,ge.options),Ie()}loadTile(oe,ge,Ie){ge.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ge.type,ge.source,ge.scope).loadTile(ge,Ie)}decodeRasterArray(oe,ge,Ie){this.getWorkerSource(oe,ge.type,ge.source,ge.scope).decodeRasterArray(ge,Ie)}reloadTile(oe,ge,Ie){ge.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ge.type,ge.source,ge.scope).reloadTile(ge,Ie)}abortTile(oe,ge,Ie){this.getWorkerSource(oe,ge.type,ge.source,ge.scope).abortTile(ge,Ie)}removeTile(oe,ge,Ie){this.getWorkerSource(oe,ge.type,ge.source,ge.scope).removeTile(ge,Ie)}removeSource(oe,ge,Ie){if(!(this.workerSources[oe]&&this.workerSources[oe][ge.scope]&&this.workerSources[oe][ge.scope][ge.type]&&this.workerSources[oe][ge.scope][ge.type][ge.source]))return;const $e=this.workerSources[oe][ge.scope][ge.type][ge.source];delete this.workerSources[oe][ge.scope][ge.type][ge.source],$e.removeSource!==void 0?$e.removeSource(ge,Ie):Ie()}loadWorkerSource(oe,ge,Ie){try{this.self.importScripts(ge.url),Ie()}catch($e){Ie($e)}}syncRTLPluginState(oe,ge,Ie){if(r.fH.isParsed())Ie(null,!0);else if(r.fH.isParsing())this.rtlPluginParsingListeners.push(Ie);else try{r.fH.setState(ge);const $e=r.fH.getPluginURL();!r.fH.isLoaded()||r.fH.isParsed()||r.fH.isParsing()||$e==null||(r.fH.setState({pluginStatus:r.fI.parsing,pluginURL:r.fH.getPluginURL()}),this.self.importScripts($e),r.fH.isParsed()?Ie(null,!0):this.rtlPluginParsingListeners.push(Ie))}catch($e){Ie($e)}}setDracoUrl(oe,ge){this.dracoUrl=ge}getAvailableImages(oe,ge){this.availableImages[oe]||(this.availableImages[oe]={});let Ie=this.availableImages[oe][ge];return Ie||(Ie=[]),Ie}getAvailableModels(oe,ge){this.availableModels[oe]||(this.availableModels[oe]={});let Ie=this.availableModels[oe][ge];return Ie||(Ie={}),Ie}getLayerIndex(oe,ge){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let Ie=this.layerIndexes[oe][ge];return Ie||(Ie=this.layerIndexes[oe][ge]=new N,Ie.scope=ge),Ie}getWorkerSource(oe,ge,Ie,$e){const Ke=this.workerSources;return Ke[oe]||(Ke[oe]={}),Ke[oe][$e]||(Ke[oe][$e]={}),Ke[oe][$e][ge]||(Ke[oe][$e][ge]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),Ke[oe][$e][ge][Ie]||(Ke[oe][$e][ge][Ie]=new this.workerSourceTypes[ge]({send:(at,At,lt,Tt,Wt,ye)=>this.actor.send(at,At,lt,oe,Wt,ye),scheduler:this.actor.scheduler},this.getLayerIndex(oe,$e),this.getAvailableImages(oe,$e),this.getAvailableModels(oe,$e),this.isSpriteLoaded[oe][$e],void 0,this.brightness,this.worldview)),Ke[oe][$e][ge][Ie]}rasterizeImagesWorker(oe,ge,Ie){const $e=new Map;for(const[Ke,{image:at,imageVariant:At}]of ge.tasks.entries()){const lt=this.imageRasterizer.rasterize(At,at,ge.scope,oe);$e.set(Ke,lt)}Ie(void 0,$e)}removeRasterizedImages(oe,ge,Ie){this.imageRasterizer.removeImagesFromCacheByIds(ge.imageIds,ge.scope,oe),Ie()}enforceCacheSizeLimit(oe,ge){r.fJ(ge)}getWorkerPerformanceMetrics(oe,ge,Ie){Ie(void 0,void 0)}}return r.fF(self)&&(self.worker=new jo(self)),jo})),g(["./shared"],(function(r){var C="3.17.0";const I={create:"create",load:"load",fullLoad:"fullLoad"},z={mark(p){performance.mark(p)},measure(p,s,c){performance.measure(p,s,c)}};function N(p){const s=p.name.split("?")[0];return r.a(s)&&s.includes("mapbox-gl.js")?"javascript":r.a(s)&&s.includes("mapbox-gl.css")?"css":r.b(s)?"fontRange":r.c(s)?"sprite":r.i(s)?"style":r.d(s)?"tilejson":"other"}var k,j={},$=(function(){if(k)return j;function p(m){return!s(m)}function s(m){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,A,D=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(D);try{A=new Worker(O),M=!0}catch{M=!1}return A&&A.terminate(),URL.revokeObjectURL(O),M})()?(function(){var M=document.createElement("canvas");M.width=M.height=1;var A=M.getContext("2d");if(!A)return!1;var D=A.getImageData(0,0,1,1);return D&&D.width===M.width})()?(c[b=m&&m.failIfMajorPerformanceCaveat]===void 0&&(c[b]=(function(M){var A,D=(function(O){var V=document.createElement("canvas"),H=Object.create(p.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=O,V.getContext("webgl2",H)})(M);if(!D)return!1;try{A=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!A||D.isContextLost())&&(D.shaderSource(A,"void main() {}"),D.compileShader(A),D.getShaderParameter(A,D.COMPILE_STATUS)===!0)})(b)),c[b]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var b}k=1,j.supported=p,j.notSupportedReason=s;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},j})();function re(p,s,c){const m=document.createElement(p);return s!=null&&(m.className=s),c&&c.appendChild(m),m}function ie(p,s,c){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(s))m.setAttributeNS(null,b,String(s[b]));return c&&c.appendChild(m),m}const Y=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ae=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function me(){Y&&ae&&(ue=Y[ae],Y[ae]="none")}function Ae(){Y&&ae&&(Y[ae]=ue)}function Se(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",Se,!0)}function ze(){window.addEventListener("click",Se,!0),window.setTimeout((()=>{window.removeEventListener("click",Se,!0)}),0)}function je(p,s){const c=p.getBoundingClientRect();return Ze(p,c,s)}function Ce(p,s){const c=p.getBoundingClientRect(),m=[];for(let b=0;b<s.length;b++)m.push(Ze(p,c,s[b]));return m}function Te(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function Ze(p,s,c){const m=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new r.P((c.clientX-s.left)*m,(c.clientY-s.top)*m)}const Mt="01",mt="NO_ACCESS_TOKEN";class Gt{constructor(s,c,m){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const s=(function(){let c="";for(let m=0;m<10;m++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Mt,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!r.h(s))return s;const m=Re(s);return m.params.push(`sdk=js-${C}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!r.h(s))return s;const m=Re(s);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeModelURL(s,c){if(!r.h(s))return s;const m=Re(s);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeSourceURL(s,c,m,b){if(!r.h(s))return s;const M=Re(s);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),m&&M.params.push(`language=${m}`),b&&M.params.push(`worldview=${b}`),this._makeAPIURL(M,this._customAccessToken||c)}normalizeIconsetURL(s,c){const m=Re(s);return r.h(s)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||c)):Qe(m)}normalizeSpriteURL(s,c,m,b){const M=Re(s);return r.h(s)?(M.path=`/styles/v1${M.path}/sprite${c}${m}`,this._makeAPIURL(M,this._customAccessToken||b)):(M.path+=`${c}${m}`,Qe(M))}normalizeTileURL(s,c,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!r.h(s))return s;const b=Re(s);b.path=b.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||m&&b.authority!=="raster"&&m===512?"@2x":""}${r.k.supported?".webp":"$1"}`),b.authority==="raster"?b.path=`/${r.e.RASTER_URL_PREFIX}${b.path}`:b.authority==="rasterarrays"?b.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${b.path}`:b.authority==="3dtiles"?b.path=`/${r.e.TILES3D_URL_PREFIX}${b.path}`:(b.path=b.path.replace(/^.+\/v4\//,"/"),b.path=`/${r.e.TILE_URL_VERSION}${b.path}`);const M=this._customAccessToken||(function(A){for(const D of A){const O=D.match(/^access_token=(.*)$/);if(O)return O[1]}return null})(b.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&b.params.push(`sku=${this._skuToken}`),this._makeAPIURL(b,M)}canonicalizeTileURL(s,c){const m=Re(s);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return s;let b="mapbox://";m.path.match(/^\/raster\/v1\//)?b+=`raster/${m.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?b+=`rasterarrays/${m.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:b+=`tiles/${m.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let M=m.params;return c&&(M=M.filter((A=>!A.match(/^access_token=/)))),M.length&&(b+=`?${M.join("&")}`),b}canonicalizeTileset(s,c){const m=!!c&&r.h(c),b=[];for(const M of s.tiles||[])r.j(M)?b.push(this.canonicalizeTileURL(M,m)):b.push(M);return b}_makeAPIURL(s,c){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",b=Re(r.e.API_URL);if(s.protocol=b.protocol,s.authority=b.authority,s.protocol==="http"){const M=s.params.indexOf("secure");M>=0&&s.params.splice(M,1)}if(b.path!=="/"&&(s.path=`${b.path}${s.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Qe(s);if(c=c||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return s.params=s.params.filter((M=>M.indexOf("access_token")===-1)),s.params.push(`access_token=${c||""}`),Qe(s)}}const kt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Re(p){const s=p.match(kt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Qe(p){const s=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${s}`}const et="mapbox.eventData";function Lt(p){if(!p)return null;const s=p.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(r.l(s[1]))}catch{return null}}class jt{constructor(s){this.type=s,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=Lt(r.e.ACCESS_TOKEN);let m="";return m=c&&c.u?r.f(c.u):r.e.ACCESS_TOKEN||"",s?`${et}.${s}:${m}`:`${et}:${m}`}fetchEventData(){const s=r.s("localStorage"),c=this.getStorageKey(),m=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp");if(s)try{const M=localStorage.getItem(c);M&&(this.eventData=JSON.parse(M));const A=localStorage.getItem(m);A&&(this.anonId=A);const D=localStorage.getItem(b);D&&(this.anonIdTimestamp=Number(D));const O=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<O)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const s=r.s("localStorage"),c=this.getStorageKey(),m=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp"),M=this.anonId,A=this.anonIdTimestamp;if(s&&M)try{localStorage.setItem(m,M),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),A&&localStorage.setItem(b,A.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,m,b){if(!r.e.EVENTS_URL)return;const M=Re(r.e.EVENTS_URL);M.params.push(`access_token=${b||r.e.ACCESS_TOKEN||""}`);const A={event:this.type,created:new Date(s).toISOString()},D=c?Object.assign(A,c):A,O={url:Qe(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=r.p(O,(V=>{this.pendingRequest=null,m(V),this.saveEventData(),this.processRequests(b)}))}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}class Ge extends jt{constructor(s){super("metrics"),s&&(this.data=s)}postMetricsEvent(s){if(!r.e.EVENTS_URL||!s&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:m}=this.queue.shift();this.postEvent(c,m,(()=>{}),s)}}const Et=new class extends jt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,s){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some((c=>r.h(c)||r.j(c)))&&this.queueRequest(Date.now(),s)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=Lt(r.e.ACCESS_TOKEN),c=s?s.u:r.e.ACCESS_TOKEN;let m=c!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),m=!0);const b=this.queue.shift();if(this.eventData.lastSuccess){const M=new Date(this.eventData.lastSuccess),A=new Date(b),D=(b-this.eventData.lastSuccess)/864e5;m=m||D>=1||D<-1||M.getDate()!==A.getDate()}else m=!0;m?this.postEvent(b,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Mt,"enabled.telemetry":!1,userId:this.anonId},(M=>{M||(this.eventData.lastSuccess=b,this.eventData.tokenU=c)}),p):this.processRequests()}},Vt=Et.postTurnstileEvent.bind(Et),ii=new class extends jt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,s,c,m){this.skuToken=s,this.errorCb=m,r.e.EVENTS_URL&&(c||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(mt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Mt,skuToken:this.skuToken,userId:this.anonId},(m=>{m?this.errorCb(m):s&&(this.success[s]=!0)}),p))}remove(){this.errorCb=null}},ki=ii.postMapLoadEvent.bind(ii),qt=new class extends jt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let s=this.mapInstanceIdMap.get(p);return s||(s=r.u(),this.mapInstanceIdMap.set(p,s)),s}getEventId(p){const s=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,s+1),s}postStyleLoadEvent(p,s){const{map:c,style:m,importedStyles:b}=s;if(!r.e.EVENTS_URL||!p&&!r.e.ACCESS_TOKEN)return;const M=this.getMapInstanceId(c),A={mapInstanceId:M,eventId:this.getEventId(M),style:m};b.length&&(A.importedStyles=b),this.queueRequest({timestamp:Date.now(),payload:A},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,(()=>{}),p)}},xi=qt.postStyleLoadEvent.bind(qt),Fi=new Ge({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Ui=Fi.postMetricsEvent.bind(Fi),rn=new Ge({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Fn=rn.postMetricsEvent.bind(rn),Er=new class extends jt{constructor(){super("gljs.performance")}postPerformanceEvent(p,s){r.e.EVENTS_URL&&(p||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:c}=this.queue.shift(),m=(function(b){const M=performance.getEntriesByType("resource"),A=performance.getEntriesByType("mark"),D=(function(ee){const le={};if(ee){for(const se in ee)if(se!=="other")for(const pe of ee[se]){const de=`${se}ResolveRangeMin`,be=`${se}ResolveRangeMax`,Me=`${se}RequestCount`,we=`${se}RequestCachedCount`;le[de]=Math.min(le[de]||1/0,pe.startTime),le[be]=Math.max(le[be]||-1/0,pe.responseEnd);const Ue=Pe=>{le[Pe]===void 0&&(le[Pe]=0),++le[Pe]};pe.transferSize!==void 0&&pe.transferSize===0&&Ue(we),Ue(Me)}}return le})((function(ee,le){const se={};if(ee)for(const pe of ee){const de=le(pe);se[de]===void 0&&(se[de]=[]),se[de].push(pe)}return se})(M,N)),O=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,H=V?V.effectiveType:void 0,Q={counters:[],metadata:[],attributes:[]},K=(ee,le,se)=>{se!=null&&ee.push({name:le,value:se.toString()})};for(const ee in D)K(Q.counters,ee,D[ee]);if(b.interactionRange[0]!==1/0&&b.interactionRange[1]!==-1/0&&(K(Q.counters,"interactionRangeMin",b.interactionRange[0]),K(Q.counters,"interactionRangeMax",b.interactionRange[1])),A)for(const ee of Object.values(I)){const le=A.find((se=>se.name===ee));le&&K(Q.counters,ee,le.startTime)}return K(Q.counters,"visibilityHidden",b.visibilityHidden),K(Q.attributes,"style",(function(ee){if(ee)for(const le of ee){const se=le.name.split("?")[0];if(r.i(se)){const pe=se.split("/").slice(-2);if(pe.length===2)return`mapbox://styles/${pe[0]}/${pe[1]}`}}})(M)),K(Q.attributes,"terrainEnabled",b.terrainEnabled?"true":"false"),K(Q.attributes,"fogEnabled",b.fogEnabled?"true":"false"),K(Q.attributes,"projection",b.projection),K(Q.attributes,"zoom",b.zoom),K(Q.metadata,"devicePixelRatio",O),K(Q.metadata,"connectionEffectiveType",H),K(Q.metadata,"navigatorUserAgent",navigator.userAgent),K(Q.metadata,"screenWidth",window.screen.width),K(Q.metadata,"screenHeight",window.screen.height),K(Q.metadata,"windowWidth",window.innerWidth),K(Q.metadata,"windowHeight",window.innerHeight),K(Q.metadata,"mapWidth",b.width/O),K(Q.metadata,"mapHeight",b.height/O),K(Q.metadata,"webglRenderer",b.renderer),K(Q.metadata,"webglVendor",b.vendor),K(Q.metadata,"sdkVersion",C),K(Q.metadata,"sdkIdentifier","mapbox-gl-js"),Q})(c);for(const b of m.metadata);for(const b of m.counters);for(const b of m.attributes);this.postEvent(s,m,(()=>{}),p)}},xn=Er.postPerformanceEvent.bind(Er),Vi=new class extends jt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,s,c,m){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const b=Re(r.e.API_URL+r.e.SESSION_PATH);b.params.push(`sku=${s||""}`),b.params.push(`access_token=${m||r.e.ACCESS_TOKEN||""}`);const M={url:Qe(b),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(M,(A=>{this.pendingRequest=null,c(A),this.saveEventData(),this.processRequests(m)}))}getSessionAPI(p,s,c,m){this.skuToken=s,this.errorCb=m,r.e.SESSION_PATH&&r.e.API_URL&&(c||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(mt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,(m=>{m?this.errorCb(m):s&&(this.success[s]=!0)}),p)}remove(){this.errorCb=null}},st=Vi.getSessionAPI.bind(Vi),Xi=new Set;function Ji(p,s){s?Xi.add(p):Xi.delete(p)}class Di{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(r.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function tn(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Sn extends r.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new r.q({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const c=this.atlasTexture.get(s);c&&(c.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(s.id,s)}removeImageProvider(s,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(s)}getPendingImageProviders(){const s=[];for(const c of this.imageProviders.values())for(const m of c.values())m.hasPendingRequests()&&s.push(m);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,c){if(this.loaded.get(c)!==s&&(this.loaded.set(c,s),s)){for(const{ids:m,callback:b}of this.requestors)this._notify(m,c,b);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images.get(c).get(s.toString())}addImage(s,c,m){this._validate(s,m)&&this.images.get(c).set(s.toString(),m)}_validate(s,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.y(new Error(`Image "${s.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.y(new Error(`Image "${s.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new r.y(new Error(`Image "${s.name}" has invalid "content" value`))),m=!1),m}_validateStretch(s,c){if(!s)return!0;let m=0;for(const b of s){if(b[0]<m||b[1]<b[0]||c<b[1])return!1;m=b[1]}return!0}_validateContent(s,c){return s?s.length!==4||!c.usvg&&(s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,c,m){const b=this.images.get(c).get(s.toString());m.version=b.version+1,this.images.get(c).set(s.toString(),m),this.updatedImages.get(c).add(s),this.removeFromImageRasterizerCache(s,c)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,c){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([s],c))}removeImage(s,c){const m=this.images.get(c),b=m.get(s.toString());m.delete(s.toString()),this.patterns.get(c).delete(s.toString()),this.removeFromImageRasterizerCache(s,c),b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map((c=>r.I.from(c)))}getImages(s,c,m){const b=[],M=[],A=this.imageProviders.get(c);for(const H of s){if(!H.iconsetId){b.push(H);continue}const Q=A.get(H.iconsetId);Q&&(this.getImage(H,c)?M.push(H):Q.addPendingRequest(H))}if(b.length===0)return void this._notify(M,c,m);let D=!0;const O=!!this.loaded.get(c),V=this.images.get(c);if(!O)for(const H of b)V.has(H.toString())||(D=!1);O||D?this._notify(b,c,m):this.requestors.push({ids:b,scope:c,callback:m})}rasterizeImages(s,c){const m=new Map,{tasks:b,scope:M}=s;for(const[A,D]of b.entries()){const O=this.getImage(D.id,M);O&&m.set(A,{image:O,imageVariant:D})}this._rasterizeImages(M,m,c)}_rasterizeImages(s,c,m){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:s},m);else{const b=new Map;for(const[M,{image:A,imageVariant:D}]of c.entries())b.set(M,this.imageRasterizer.rasterize(D,A,s,0));m(void 0,b)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,c,m){const b=this.images.get(c),M=new Map;for(const A of s){if(!b.get(A.toString())){if(A.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:A.name}))}const D=b.get(A.toString());if(!D){r.w(`Image "${A.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:D.usvg?null:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,usvg:D.usvg,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)};D.usvg&&Object.assign(O,{width:D.icon.usvg_tree.width,height:D.icon.usvg_tree.height}),M.set(r.I.toString(A),O)}m(null,M)}getPixelSize(s){const{width:c,height:m}=this.atlasImage.get(s);return{width:c,height:m}}getPattern(s,c,m){const b=s.toString(),M=this.patterns.get(c),A=M.get(b),D=this.getImage(s,c);if(!D)return null;if(A){if(A.position.version===D.version)return A.position;A.position.version=D.version}else{if(D.usvg&&!D.data){const O=this.getPatternInFlightId(b,c);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const V=new r.A(s).scaleSelf(r.o.devicePixelRatio),H=new Map([[V.toString(),{image:D,imageVariant:V}]]);return this._rasterizeImages(c,H,((Q,K)=>this.storePatternImage(V,c,D,m,K))),null}this.storePattern(s,c,D)}return this._updatePatternAtlas(c,m),M.get(b).position}getPatternInFlightId(s,c){return r.B(s,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,c,m,b,M){const A=s.toString(),D=M?M.get(A):void 0;D&&(m.data=D,this.storePattern(s.id,c,m),this._updatePatternAtlas(c,b),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),c)))}storePattern(s,c,m){const b={w:m.data.width+2*r.C,h:m.data.height+2*r.C,x:0,y:0},M=new r.F(b,m,r.C);this.patterns.get(c).set(s.toString(),{bin:b,position:M})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,c){const m=s.gl;let b=this.atlasTexture.get(c);b?this.dirty&&(b.update(this.atlasImage.get(c)),this.dirty=!1):(b=new r.T(s,this.atlasImage.get(c),m.RGBA8),this.atlasTexture.set(c,b)),b.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const m=this.patterns.get(s),b=Array.from(m.values()).map((({bin:V})=>V)),{w:M,h:A}=r.G(b),D=this.atlasImage.get(s);D.resize({width:M||1,height:A||1});const O=this.images.get(s);for(const[V,{bin:H,position:Q}]of m.entries()){let K=Q.padding;const ee=H.x+K,le=H.y+K,se=O.get(V).data,pe=se.width,de=se.height;K=K>1?K-1:K,r.q.copy(se,D,{x:0,y:0},{x:ee,y:le},{width:pe,height:de},c),r.q.copy(se,D,{x:0,y:de-K},{x:ee,y:le-K},{width:pe,height:K},c),r.q.copy(se,D,{x:0,y:0},{x:ee,y:le+de},{width:pe,height:K},c),r.q.copy(se,D,{x:pe-K,y:0},{x:ee-K,y:le},{width:K,height:de},c),r.q.copy(se,D,{x:0,y:0},{x:ee+pe,y:le},{width:K,height:de},c),r.q.copy(se,D,{x:pe-K,y:de-K},{x:ee-K,y:le-K},{width:K,height:K},c),r.q.copy(se,D,{x:0,y:de-K},{x:ee+pe,y:le-K},{width:K,height:K},c),r.q.copy(se,D,{x:0,y:0},{x:ee+pe,y:le+de},{width:K,height:K},c),r.q.copy(se,D,{x:pe-K,y:0},{x:ee-K,y:le+de},{width:K,height:K},c)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,c){const m=this.images.get(c);for(const b of s){if(this.callbackDispatchedThisFrame.get(c).has(b.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(b.toString());const M=m.get(b.toString());tn(M)&&this.updateImage(b,c,M)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function _n(p){const s=p.value,c=p.valueSpec,m=p.style,b=p.styleSpec,M=p.key,A=p.arrayElementValidator||Pi;if(!Array.isArray(s))return[new r.V(M,s,`array expected, ${r.K(s)} found`)];if(c.length&&s.length!==c.length)return[new r.V(M,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new r.V(M,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let D={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};b.$version<7&&(D.function=c.function),r.H(c.value)&&(D=c.value);let O=[];for(let V=0;V<s.length;V++)O=O.concat(A({array:s,arrayIndex:V,value:s[V],valueSpec:D,style:m,styleSpec:b,key:`${M}[${V}]`},!0));return O}function Gn(p){const s=p.key,c=p.value,m=p.valueSpec;if(!r.L(c))return[new r.V(s,c,`number expected, ${r.K(c)} found`)];if(c!=c)return[new r.V(s,c,"number expected, NaN found")];if("minimum"in m){let b=m.minimum;if(Array.isArray(m.minimum)&&(b=m.minimum[p.arrayIndex]),c<b)return[new r.V(s,c,`${c} is less than the minimum value ${b}`)]}if("maximum"in m){let b=m.maximum;if(Array.isArray(m.maximum)&&(b=m.maximum[p.arrayIndex]),c>b)return[new r.V(s,c,`${c} is greater than the maximum value ${b}`)]}return[]}function ot(p){const s=p.key,c=p.value;if(!r.H(c))return[new r.V(s,c,`object expected, ${r.K(c)} found`)];const m=p.valueSpec,b=r.J(c.type);let M,A,D,O={};const V=b!=="categorical"&&c.property===void 0,H=!V,Q=(function(se){const pe=se.stops;return Array.isArray(pe)&&Array.isArray(pe[0])&&r.H(pe[0][0])})(c),K=zi({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(se){if(b==="identity")return[new r.V(se.key,se.value,'identity function may not have a "stops" property')];let pe=[];const de=se.value;return pe=pe.concat(_n({key:se.key,value:de,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:ee})),Array.isArray(de)&&de.length===0&&pe.push(new r.V(se.key,de,"array must have at least one stop")),pe},default:function(se){return Pi({key:se.key,value:se.value,valueSpec:m,style:se.style,styleSpec:se.styleSpec})}}});return b==="identity"&&V&&K.push(new r.V(p.key,p.value,'missing required property "property"')),b==="identity"||c.stops||K.push(new r.V(p.key,p.value,'missing required property "stops"')),b==="exponential"&&m.expression&&!r.M(m)&&K.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(H&&!r.N(m)?K.push(new r.V(p.key,p.value,"property functions not supported")):V&&!r.O(m)&&K.push(new r.V(p.key,p.value,"zoom functions not supported"))),b!=="categorical"&&!Q||c.property!==void 0||K.push(new r.V(p.key,p.value,'"property" property is required')),K;function ee(se){let pe=[];const de=se.value,be=se.key;if(!Array.isArray(de))return[new r.V(be,de,`array expected, ${r.K(de)} found`)];if(de.length!==2)return[new r.V(be,de,`array length 2 expected, length ${de.length} found`)];if(Q){if(!r.H(de[0]))return[new r.V(be,de,`object expected, ${r.K(de[0])} found`)];const Me=de[0];if(Me.zoom===void 0)return[new r.V(be,de,"object stop key must have zoom")];if(Me.value===void 0)return[new r.V(be,de,"object stop key must have value")];const we=r.J(Me.zoom);if(typeof we!="number")return[new r.V(be,Me.zoom,"stop zoom values must be numbers")];if(D&&D>we)return[new r.V(be,Me.zoom,"stop zoom values must appear in ascending order")];we!==D&&(D=we,A=void 0,O={}),pe=pe.concat(zi({key:`${be}[0]`,value:de[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:Gn,value:le}}))}else pe=pe.concat(le({key:`${be}[0]`,value:de[0],style:se.style,styleSpec:se.styleSpec},de));return r.Q(r.S(de[1]))?pe.concat([new r.V(`${be}[1]`,de[1],"expressions are not allowed in function stops.")]):pe.concat(Pi({key:`${be}[1]`,value:de[1],valueSpec:m,style:se.style,styleSpec:se.styleSpec}))}function le(se,pe){const de=r.K(se.value),be=r.J(se.value),Me=se.value!==null?se.value:pe;if(M){if(de!==M)return[new r.V(se.key,Me,`${de} stop domain type must match previous stop domain type ${M}`)]}else M=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof be!="number"&&typeof be!="string"&&typeof be!="boolean")return[new r.V(se.key,Me,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&b!=="categorical"){let we=`number expected, ${de} found`;return r.N(m)&&b===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(se.key,Me,we)]}return b!=="categorical"||de!=="number"||typeof be=="number"&&isFinite(be)&&Math.floor(be)===be?b!=="categorical"&&de==="number"&&typeof be=="number"&&typeof A=="number"&&A!==void 0&&be<A?[new r.V(se.key,Me,"stop domain values must appear in ascending order")]:(A=be,b==="categorical"&&be in O?[new r.V(se.key,Me,"stop domain values must be unique")]:(O[be]=!0,[])):[new r.V(se.key,Me,`integer expected, found ${String(be)}`)]}}function De(p){const s=(p.expressionContext==="property"?r.W:r.U)(r.S(p.value),p.valueSpec);if(s.result==="error")return s.value.map((m=>new r.V(`${p.key}${m.key}`,p.value,m.message)));const c=s.value.expression||s.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.Z(c))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Qt(c,p);if(p.expressionContext==="appearance")return Li(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.X(c,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.Y(c))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qt(p,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const b of s.valueSpec.expression.parameters)c.delete(b);if(c.size===0)return[];const m=[];return p instanceof r._&&c.has(p.name)?[new r.V(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild((b=>{m.push(...Qt(b,s))})),m)}function Li(p,s){const c=new Set;if(s.valueSpec&&s.valueSpec.expression)for(const b of s.valueSpec.expression.parameters)c.add(b);if(c.size===0)return[];const m=[];return p instanceof r._&&!c.has(p.name)?[new r.V(s.key,s.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild((b=>{m.push(...Li(b,s))})),m)}function Wi(p){const s=p.key,c=p.value,m=p.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(r.J(c))===-1&&b.push(new r.V(s,c,`expected one of [${m.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(m.values).indexOf(r.J(c))===-1&&b.push(new r.V(s,c,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(c)} found`)),b}function Ei(p){return r.a2(r.S(p.value))?De(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Hn(p)}function Hn(p){const s=p.value,c=p.key;if(!Array.isArray(s))return[new r.V(c,s,`array expected, ${r.K(s)} found`)];if(s.length<1)return[new r.V(c,s,"filter array must have at least 1 element")];const m=p.styleSpec;let b=Wi({key:`${c}[0]`,value:s[0],valueSpec:m.filter_operator});const M=()=>{s.length>=2&&(r.a0(s[1])||b.push(new r.V(`${c}[1]`,s[1],`string expected, ${r.K(s[1])} found`)));for(let A=2;A<s.length;A++)r.J(s[1])==="$type"?b=b.concat(Wi({key:`${c}[${A}]`,value:s[A],valueSpec:m.geometry_type})):r.a0(s[A])||r.L(s[A])||r.$(s[A])||b.push(new r.V(`${c}[${A}]`,s[A],`string, number, or boolean expected, ${r.K(s[A])} found.`))};switch(r.J(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&r.J(s[1])==="$type"&&b.push(new r.V(c,s,`"$type" cannot be use with operator "${s[0]}"`)),s.length!==3&&b.push(new r.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`)),M();break;case"==":case"!=":s.length!==3&&b.push(new r.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`)),M();break;case"in":case"!in":M();break;case"any":case"all":case"none":for(let A=1;A<s.length;A++)b=b.concat(Hn({key:`${c}[${A}]`,value:s[A],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":s.length!==2?b.push(new r.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):r.a0(s[1])||b.push(new r.V(`${c}[1]`,s[1],`string expected, ${r.K(s[1])} found`))}return b}function An(p,s){const c=p.key,m=p.style,b=p.layer,M=p.styleSpec,A=p.value,D=p.objectKey,O=M[`${s}_${p.layerType}`];if(!O)return[];const V=D.match(/^(.*)-use-theme$/);if(V&&O[V[1]])return r.Q(r.S(A))?[].concat(Pi({key:c,value:A,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:M,expressionContext:"property",propertyType:s,propertyKey:D})):Pi({key:c,value:A,valueSpec:{type:"string"},style:m,styleSpec:M});const H=D.match(/^(.*)-transition$/);if(s==="paint"&&H&&O[H[1]]&&O[H[1]].transition)return Pi({key:c,value:A,valueSpec:M.transition,style:m,styleSpec:M});const Q=p.valueSpec||O[D];if(!Q)return[new r.a3(c,A,`unknown property "${D}"`)];let K;if(r.a0(A)&&r.N(Q)&&!Q.tokens&&(K=/^{([^}]+)}$/.exec(A))){const le=`\`{ "type": "identity", "property": ${K?JSON.stringify(K[1]):'"_"'} }\``;return[new r.V(c,A,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const ee=[];if(p.layerType==="symbol")D!=="text-field"||!m||m.glyphs||m.imports||ee.push(new r.V(c,A,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&r.a4(r.S(A))&&r.J(A.type)==="identity"&&ee.push(new r.V(c,A,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&s==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&r.N(Q)&&(r.a5(Q)||r.O(Q))){const le=r.W(r.S(A),Q).value,se="expression"in le&&le.expression||"_styleExpression"in le&&le._styleExpression&&le._styleExpression.expression;se&&!r.X(se,["measure-light"])&&(D==="model-emissive-strength"&&r.Y(se)&&r.Z(se)||ee.push(new r.V(c,A,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ee.concat(Pi({key:p.key,value:A,valueSpec:Q,style:m,styleSpec:M,expressionContext:"property",propertyType:s,propertyKey:D}))}function dr(p){return An(p,"paint")}function Jn(p){return An(p,"layout")}function Qi(p){let s=[];const c=p.value,m=p.key,b=p.style,M=p.styleSpec;if(!r.H(c))return[new r.V(m,c,"object expected")];c.type||c.ref||s.push(new r.V(m,c,'either "type" or "ref" is required'));let A=r.J(c.type);const D=r.J(c.ref);if(c.id){const O=r.J(c.id);for(let V=0;V<p.arrayIndex;V++){const H=b.layers[V];r.J(H.id)===O&&s.push(new r.V(m,c.id,`duplicate layer id "${O}", previously used at line ${H.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach((V=>{V in c&&s.push(new r.V(m,c[V],`"${V}" is prohibited for ref layers`))})),b.layers.forEach((V=>{r.J(V.id)===D&&(O=V)})),O?O.ref?s.push(new r.V(m,c.ref,"ref cannot reference another ref layer")):A=r.J(O.type):typeof D=="string"&&s.push(new r.V(m,c.ref,`ref layer "${D}" not found`))}else if(A!=="background"&&A!=="sky"&&A!=="slot")if(c.source)if(r.a0(c.source)){const O=b.sources&&b.sources[c.source],V=O&&r.J(O.type);O?V==="vector"&&A==="raster"?s.push(new r.V(m,c.source,`layer "${c.id}" requires a raster source`)):V==="raster"&&A!=="raster"?s.push(new r.V(m,c.source,`layer "${c.id}" requires a vector source`)):V!=="vector"||c["source-layer"]?V==="raster-dem"&&A!=="hillshade"?s.push(new r.V(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(A)?A==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&V==="geojson"&&!O.lineMetrics?s.push(new r.V(m,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):A==="raster-particle"&&V!=="raster-array"&&s.push(new r.V(m,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new r.V(m,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new r.V(m,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new r.V(m,c.source,`source "${c.source}" not found`))}else s.push(new r.V(`${m}.source`,c.source,'"source" must be a string'));else s.push(new r.V(m,c,'missing required property "source"'));return s=s.concat(zi({key:m,value:c,valueSpec:M.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pi({key:`${m}.type`,value:c.type,valueSpec:M.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:O=>Ei(Object.assign({layerType:A},O)),layout:O=>zi({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":V=>Jn(Object.assign({layerType:A},V))}}),paint:O=>zi({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":V=>dr(Object.assign({layerType:A,layer:c},V))}}),appearances(O){const V=_n({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:K=>(function(ee){const{key:le,layer:se,layerType:pe}=ee,de=r.J(ee.value),be=r.J(de.name),Me=r.J(de.condition),we=zi({key:le,value:de,valueSpec:ee.styleSpec.appearance,style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{condition:Ue=>(function(Pe){const Ne=[];return Ne.push(...De({key:Pe.key,value:Pe.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Ne})(Object.assign({layer:se,layerType:pe},Ue)),properties:Ue=>(function(Pe){const Ne=[],{styleSpec:Oe,layer:Le,layerType:Ye}=Pe,ct=Oe[`paint_${Ye}`],rt=Oe[`layout_${Ye}`],_t=Pe.object[Pe.objectKey];for(const xt in _t){const St=xt in ct?"paint":xt in rt?"layout":void 0;if(!St){Ne.push(new r.V(Pe.key,xt,`unknown property "${xt}" for layer type "${Ye}"`));continue}const Ft=Object.assign({},Pe,{key:`${Pe.key}.${xt}`,object:_t,objectKey:xt,layer:Le,layerType:Ye,value:_t[xt],valueSpec:St==="paint"?ct[xt]:rt[xt]});Ne.push(...An(Ft,St))}return Ne})(Object.assign({layer:se,layerType:pe},Ue))}});return be!=="hidden"&&Me===void 0&&we.push(new r.V(ee.key,"name",'Appearance with name different than "hidden" must have a condition')),we})(Object.assign({layerType:A,layer:c},K))}),H=Array.isArray(O.value)?O.value:[],Q=new Set;return H.forEach(((K,ee)=>{const le=r.J(K.name);if(le)if(Q.has(le)){const se=r.J(c.id);V.push(new r.V(O.key,le,`Duplicated appearance name "${le}" for layer "${se}"`))}else Q.add(le)})),V}}})),s}function qi({key:p,value:s}){return r.a0(s)?[]:[new r.V(p,s,`string expected, ${r.K(s)} found`)]}const Xn={promoteId:function p({key:s,value:c}){if(r.a0(c))return qi({key:s,value:c});if(Array.isArray(c)){const b=[],M=r.S(c),A=r.U(M);return A.result==="error"&&A.value.forEach((D=>{b.push(new r.V(`${s}${D.key}`,null,`${D.message}`))})),r.X(A.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||b.push(new r.V(`${s}`,null,"promoteId expression should be only feature dependent")),b}if(!r.H(c))return[new r.V(s,c,`string, expression or object expected, "${r.K(c)}" found`)];const m=[];for(const b in c)m.push(...p({key:`${s}.${b}`,value:c[b]}));return m}};function Qn(p){const s=p.value,c=p.key,m=p.styleSpec,b=p.style;if(!r.H(s))return[new r.V(c,s,`object expected, ${r.K(s)} found`)];if(!("type"in s))return[new r.V(c,s,'"type" is required')];const M=r.J(s.type);let A=[];switch(["vector","raster","raster-dem","raster-array"].includes(M)&&("url"in s||"tiles"in s||A.push(new r.a3(c,s,'Either "url" or "tiles" is required.'))),M){case"vector":case"raster":case"raster-dem":case"raster-array":return A=A.concat(zi({key:c,value:s,valueSpec:m[`source_${M.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:Xn})),A;case"geojson":if(A=zi({key:c,value:s,valueSpec:m.source_geojson,style:b,styleSpec:m,objectElementValidators:Xn}),"cluster"in s&&"clusterProperties"in s){if(!r.H(s.clusterProperties))return[new r.V(`${c}.clusterProperties`,s,`object expected, ${r.K(s)} found`)];for(const D in s.clusterProperties){const O=s.clusterProperties[D];if(!Array.isArray(O))return[new r.V(`${c}.clusterProperties.${D}`,O,"array expected")];const[V,H]=O,Q=typeof V=="string"?[V,["accumulated"],["get",D]]:V;A.push(...De({key:`${c}.${D}.map`,value:H,expressionContext:"cluster-map"})),A.push(...De({key:`${c}.${D}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}}return A;case"video":return zi({key:c,value:s,valueSpec:m.source_video,style:b,styleSpec:m});case"image":return zi({key:c,value:s,valueSpec:m.source_image,style:b,styleSpec:m});case"canvas":return[new r.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wi({key:`${c}.type`,value:s.type,valueSpec:{values:Nn(m)}})}}function Nn(p){return p.source.reduce(((s,c)=>{const m=p[c];return m.type.type==="enum"&&(s=s.concat(Object.keys(m.type.values||{}))),s}),[])}function xr(p){const s=p.value,c=p.styleSpec,m=c.light,b=p.style;if(s===void 0)return[];if(!r.H(s))return[new r.V("light",s,`object expected, ${r.K(s)} found`)];let M=[];for(const A in s){const D=A.match(/^(.*)-transition$/),O=A.match(/^(.*)-use-theme$/);M=M.concat(O&&m[O[1]]?Pi({key:A,value:s[A],valueSpec:{type:"string"},style:b,styleSpec:c}):D&&m[D[1]]&&m[D[1]].transition?Pi({key:A,value:s[A],valueSpec:c.transition,style:b,styleSpec:c}):m[A]?Pi({key:A,value:s[A],valueSpec:m[A],style:b,styleSpec:c}):[new r.V(A,s[A],`unknown property "${A}"`)])}return M}function Rt(p){const s=p.value;if(!s)return[];const c=p.key;if(!r.H(s))return[new r.V(c,s,`object expected, ${r.K(s)} found`)];let m=[];const b=p.styleSpec,M=b["light-3d"],A=p.style,D=p.style.lights;for(const H of["type","id"])if(!(H in s))return m=m.concat([new r.V(c,s,`missing property "${H}"`)]),m;if(!r.a0(s.type))return m=m.concat([new r.V(`${c}.type`,s.type,"string expected")]),m;if(D)for(let H=0;H<p.arrayIndex;H++){const Q=r.J(s.type),K=D[H];r.J(K.type)===Q&&m.push(new r.V(c,s.id,`duplicate light type "${s.type}", previously defined at line ${K.id.__line__}`))}const O=`properties_light_${s.type}`;if(!(O in b))return m=m.concat([new r.V(`${c}.type`,s,`Invalid light type ${s.type}`)]),m;const V=b[O];for(const H in s)if(H==="properties"){const Q=s[H];if(!r.H(Q))return m=m.concat([new r.V("properties",Q,`object expected, ${r.K(Q)} found`)]),m;for(const K in Q){const ee=K.match(/^(.*)-transition$/),le=K.match(/^(.*)-use-theme$/);m=m.concat(le&&V[le[1]]?Pi({key:H,value:Q[K],valueSpec:{type:"string"},style:A,styleSpec:b}):ee&&V[ee[1]]&&V[ee[1]].transition?Pi({key:H,value:s[H],valueSpec:b.transition,style:A,styleSpec:b}):V[K]?Pi({key:K,value:Q[K],valueSpec:V[K],style:A,styleSpec:b}):[new r.a3(p.key,Q[K],`unknown property "${K}"`)])}}else m=m.concat(M[H]?Pi({key:H,value:s[H],valueSpec:M[H],style:A,styleSpec:b}):[new r.a3(H,s[H],`unknown property "${H}"`)]);return m}function wn(p){const s=p.value,c=p.key,m=p.style,b=p.styleSpec,M=b.terrain;if(s==null)return[];if(!r.H(s))return[new r.V("terrain",s,`object expected, ${r.K(s)} found`)];let A=[];for(const D in s){const O=D.match(/^(.*)-transition$/),V=D.match(/^(.*)-use-theme$/);A=A.concat(V&&M[V[1]]?Pi({key:D,value:s[D],valueSpec:{type:"string"},style:m,styleSpec:b}):O&&M[O[1]]&&M[O[1]].transition?Pi({key:D,value:s[D],valueSpec:b.transition,style:m,styleSpec:b}):M[D]?Pi({key:D,value:s[D],valueSpec:M[D],style:m,styleSpec:b}):[new r.a3(D,s[D],`unknown property "${D}"`)])}if(s.source)if(r.a0(s.source)){const D=m.sources&&m.sources[s.source],O=D&&r.J(D.type);D?O!=="raster-dem"&&A.push(new r.V(`${c}.source`,s.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):A.push(new r.V(`${c}.source`,s.source,`source "${s.source}" not found`))}else A.push(new r.V(`${c}.source`,s.source,"source must be a string"));else A.push(new r.V(c,s,'terrain is missing required property "source"'));return A}function vn(p){const s=p.value,c=p.style,m=p.styleSpec,b=m.fog;if(s===void 0)return[];if(!r.H(s))return[new r.V("fog",s,`object expected, ${r.K(s)} found`)];let M=[];for(const A in s){const D=A.match(/^(.*)-transition$/),O=A.match(/^(.*)-use-theme$/);M=M.concat(O&&b[O[1]]?Pi({key:A,value:s[A],valueSpec:{type:"string"},style:c,styleSpec:m}):D&&b[D[1]]&&b[D[1]].transition?Pi({key:A,value:s[A],valueSpec:m.transition,style:c,styleSpec:m}):b[A]?Pi({key:A,value:s[A],valueSpec:b[A],style:c,styleSpec:m}):[new r.a3(A,s[A],`unknown property "${A}"`)])}return M}const bn={"*":()=>[],array:_n,boolean:function(p){const s=p.value,c=p.key;return r.$(s)?[]:[new r.V(c,s,`boolean expected, ${r.K(s)} found`)]},number:Gn,color:function({key:p,value:s}){return r.a0(s)?r.a1.parseCSSColor(s)===null?[new r.V(p,s,`color expected, "${s}" found`)]:[]:[new r.V(p,s,`color expected, ${r.K(s)} found`)]},enum:Wi,filter:Ei,function:ot,layer:Qi,object:zi,source:Qn,model:r.a7,light:xr,"light-3d":Rt,terrain:wn,fog:vn,string:qi,formatted:function(p){return qi(p).length===0?[]:De(p)},resolvedImage:function(p){return qi(p).length===0?[]:De(p)},projection:function(p){const s=p.value,c=p.styleSpec,m=c.projection,b=p.style;if(r.H(s)){let M=[];for(const A in s)M=M.concat(Pi({key:A,value:s[A],valueSpec:m[A],style:b,styleSpec:c}));return M}return r.a0(s)?[]:[new r.V("projection",s,`object or string expected, ${r.K(s)} found`)]},import:function(p){const s=p.key,{value:c,styleSpec:m}=p;if(!r.H(c))return[new r.V(s,c,"import must be an object")];const{data:b,...M}=c;Object.defineProperty(M,"__line__",{value:c.__line__,enumerable:!1});let A=zi(Object.assign({},p,{value:M,valueSpec:m.import}));return r.J(M.id)===""&&A.push(new r.V(`${p.key}.id`,M,"import id can't be an empty string")),b&&(A=A.concat(Dr(b,m,{key:`${p.key}.data`}))),A},iconset:function(p){const s=p.value,c=p.key,m=p.styleSpec,b=p.style;if(!r.H(s))return[new r.V(c,s,"object expected")];if(!s.type)return[new r.V(c,s,'"type" is required')];const M=r.J(s.type);let A=[];if(A=A.concat(zi({key:c,value:s,valueSpec:m[`iconset_${M}`],style:b,styleSpec:m})),(function(D,O){return!(D!=="source"||!O.source)})(M,s)){const D=b.sources&&b.sources[s.source],O=D&&r.J(D.type);D?O!=="raster-array"&&A.push(new r.V(c,s.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):A.push(new r.V(c,s.source,`source "${s.source}" not found`))}return A}};function Pi(p,s=!1){const c=p.value,m=p.valueSpec,b=p.styleSpec;if(m.expression){if(r.a4(r.J(c)))return ot(p);if(r.Q(r.S(c)))return De(p)}if(m.type&&bn[m.type]){const M=bn[m.type](p);return s===!0&&M.length>0&&Array.isArray(p.value)?De(p):M}return zi(Object.assign({},p,{valueSpec:m.type?b[m.type]:m}))}function zi(p){const s=p.key,c=p.value,m=p.valueSpec||{},b=p.objectElementValidators||{},M=p.style,A=p.styleSpec;if(!r.H(c))return[new r.V(s,c,`object expected, ${r.K(c)} found`)];let D=[];for(const O in c){const V=O.split(".")[0];let H;b[V]?H=b[V]:m[V]?H=Pi:b["*"]?H=b["*"]:m["*"]&&(H=Pi),H?D=D.concat(H({key:(s&&`${s}.`)+O,value:c[O],valueSpec:m[V]||m["*"],style:M,styleSpec:A,object:c,objectKey:O},c)):D.push(new r.a3(s,c[O],`unknown property "${O}"`))}for(const O in m){if(b[O])continue;const V=m[O];V.required&&V.default===void 0&&c[O]===void 0&&D.push(new r.V(s,c,`missing required property "${O}"`))}return D}function Kn({key:p,value:s}){const c=qi({key:p,value:s});if(c.length)return c;const m=s;return m.indexOf("{fontstack}")===-1&&c.push(new r.V(p,s,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&c.push(new r.V(p,s,'"glyphs" url must include a "{range}" token')),c}function Dr(p,s=r.a6,c={}){return zi({key:c.key||"",value:p,valueSpec:Object.assign(s.$root,{"*":{type:"*"}}),styleSpec:s,style:p,objectElementValidators:{glyphs:Kn}})}function ls(p,s=r.a6){return ge(Dr(p,s))}const Ts=p=>ge(Qn(p)),Xt=p=>ge(xr(p)),ja=p=>ge(Rt(p)),$f=p=>ge(wn(p)),ac=p=>ge(vn(p)),Ar=p=>ge((function(s){const c=s.value,m=s.style,b=s.styleSpec,M=b.snow;if(c===void 0)return[];if(!r.H(c))return[new r.V("snow",c,`object expected, ${r.K(c)} found`)];let A=[];for(const D in c){const O=D.match(/^(.*)-transition$/);A=A.concat(O&&M[O[1]]&&M[O[1]].transition?Pi({key:D,value:c[D],valueSpec:b.transition,style:m,styleSpec:b}):M[D]?Pi({key:D,value:c[D],valueSpec:M[D],style:m,styleSpec:b}):[new r.a3(D,c[D],`unknown property "${D}"`)])}return A})(p)),js=p=>ge((function(s){const c=s.value,m=s.style,b=s.styleSpec,M=b.rain;if(c===void 0)return[];if(!r.H(c))return[new r.V("rain",c,`object expected, ${r.K(c)} found`)];let A=[];for(const D in c){const O=D.match(/^(.*)-transition$/);A=A.concat(O&&M[O[1]]&&M[O[1]].transition?Pi({key:D,value:c[D],valueSpec:b.transition,style:m,styleSpec:b}):M[D]?Pi({key:D,value:c[D],valueSpec:M[D],style:m,styleSpec:b}):[new r.a3(D,c[D],`unknown property "${D}"`)])}return A})(p)),Bu=p=>ge(Qi(p)),Lo=p=>ge(Ei(p)),jo=p=>ge(dr(p)),ft=p=>ge(Jn(p)),oe=p=>ge(r.a7(p));function ge(p){return p.slice().sort(((s,c)=>s.line&&c.line?s.line-c.line:0))}function Ie(p,s){let c=!1;if(s&&s.length)for(const m of s)m instanceof r.a3?r.w(m.message):(p.fire(new r.y(new Error(m.message))),c=!0);return c}const $e=r.a6.light;let Ke;class at extends r.E{constructor(s,c="flat"){super(),this._transitionable=new r.a8(Ke||(Ke=new r.a9({anchor:new r.aa($e.anchor),position:new r.ab($e.position),color:new r.aa($e.color),intensity:new r.aa($e.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,m={}){this._validate(Xt,s,m)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&Ie(this,s.call(ls,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}const At=r.a6.terrain;let lt=class extends r.E{constructor(p,s,c,m,b){super(),this.scope=c,this._transitionable=new r.a8(new r.a9({source:new r.aa(At.source),exaggeration:new r.aa(At.exaggeration)}),c,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=b}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const s=p.value.expression;if(!s)return null;let c=-1,m=-1,b=1;for(const M of s.zoomStops)b=s.evaluate(new r.ac(M,{worldview:this.worldview})),b>.01?(c=M,m=-1):m=M;return b<.01&&c>0&&m>c?[c,m]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.ad}};const Tt=45,Wt=65,ye=.05;function it(p,s,c,m){const b=r.ah(Tt,Wt,c),[M,A]=wt(p,m);let D=1-Math.min(1,Math.exp((s-M)/(A-M)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*b*p.alpha}function wt(p,s){const c=.5/Math.tan(.5*s);return[p.range[0]+c,p.range[1]+c]}function ht(p,s,c,m,b){const M=r.af([],[s,c,m],b.mercatorFogMatrix);return it(p,r.ag(M),b.pitch,b._fov)}function bt(p,s,c,m,b,M,A){const D=[[c,m,0],[b,m,0],[b,M,0],[c,M,0]];let O=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const H of D){const Q=r.af([],H,s),K=r.ag(Q);O=Math.min(O,K),V=Math.max(V,K)}return[it(p,O,A.pitch,A._fov),it(p,V,A.pitch,A._fov)]}const mi=r.a6.fog;class bi extends r.E{constructor(s,c,m,b){super();const M=new r.a9({range:new r.aa(mi.range),color:new r.aa(mi.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(mi["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(mi["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(mi["horizon-blend"]),"star-intensity":new r.aa(mi["star-intensity"]),"vertical-range":new r.aa(mi["vertical-range"])});this._transitionable=new r.a8(M,m,new Map(b)),this.set(s,b),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new r.ai(M),this.scope=m}get state(){const s=this._transform,c=s.projection.name==="globe",m=r.aj(s.zoom),b=this.properties.get("range"),M=[.5,3];return{range:c?[r.ak(M[0],b[0],m),r.ak(M[1],b[1],m)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,m={}){if(this._validate(ac,s,m))return;const b=Object.assign({},s);for(const M of Object.keys(mi))b[M]===void 0&&(b[M]=mi[M].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Tt,Wt,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?(function(m,b,M){const A=r.ae.fromLngLat(b),D=M.elevation?M.elevation.getAtPointOrZero(A):0;return ht(m,A.x,A.y,D,M)})(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return bt(this.state,c,0,0,r.al,r.al,this._transform)}getOpacityForBounds(s,c,m,b,M){return this._transform.projection.supportsFog?bt(this.state,s,c,m,b,M,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?wt(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const m of c){const b=s.points[m];let M;if(b[2]>=0)M=b;else{const A=s.points[m-4];M=r.am(A,b,A[2]/(A[2]-b[2]))}if(ht(this.state,M[0],M[1],0,this._transform)>=ye)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&Ie(this,s.call(ls,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let ji,pn,Vn,Un,kn=class extends r.E{constructor(p,s,c,m){super();const b=ji||(ji=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(b,c,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(b),this.scope=c}get state(){const p=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),m=r.an(c[0]),b=-Math.max(r.an(c[1]),.01),M=[Math.cos(m)*Math.cos(b),Math.sin(m)*Math.cos(b),Math.sin(b)],A=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=A,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(s.r,s.g,s.b,s.a*p),direction:M,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(p,s,c={}){if(this._validate(Ar,p,c))return;const m=Object.assign({},p),b=r.a6.snow;for(const M of Object.keys(b))m[M]===void 0&&(m[M]=b[M].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,s,c){return(!c||c.validate!==!1)&&Ie(this,p.call(ls,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},Wn=class extends r.E{constructor(p,s,c,m){super();const b=pn||(pn=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(b,c,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(b),this.scope=c}get state(){const p=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),m=r.an(c[0]),b=-Math.max(r.an(c[1]),.01),M=[Math.cos(m)*Math.cos(b),Math.sin(m)*Math.cos(b),Math.sin(b)],A=this.properties.get("vignette-color");return A.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(s.r,s.g,s.b,s.a*p),direction:M,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(p,s,c={}){if(this._validate(js,p,c))return;const m=Object.assign({},p),b=r.a6.rain;for(const M of Object.keys(b))m[M]===void 0&&(m[M]=b[M].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,s,c){return(!c||c.validate!==!1)&&Ie(this,p.call(ls,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Cn extends r.E{constructor(s,c,m,b){super(),this.scope=m,this._options=s,this.properties=new r.ai(c),this._transitionable=new r.a8(c,m,new Map(b)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class or{constructor(s,c,m){this.screenBounds=s,this.cameraPoint=m.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(s,c){let m,b;if(s instanceof r.P||typeof s[0]=="number"){const M=r.P.convert(s);m=[M],b=c.isPointAboveHorizon(M)}else{const M=r.P.convert(s[0]),A=r.P.convert(s[1]),D=M.add(A)._div(2);m=[M,A],b=r.aq(M,A).every((O=>c.isPointAboveHorizon(O)))&&c.isPointAboveHorizon(D)}return new or(m,b,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],b=r.aq(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?b[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(b[3]=this.cameraPoint)),r.ar(b,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],b=r.aq(c,m,s),M=this.cameraPoint.clone();switch(3*((M.y>c.y)+(M.y>m.y))+((M.x>c.x)+(M.x>m.x))){case 0:b[0]=M,b[4]=M.clone();break;case 1:b.splice(1,0,M);break;case 2:b[1]=M;break;case 3:b.splice(4,0,M);break;case 5:b.splice(2,0,M);break;case 6:b[3]=M;break;case 7:b.splice(3,0,M);break;case 8:b[2]=M}return b}containsTile(s,c,m,b=0){const M=Math.max(s.queryPadding,s.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,A=m?this._bufferedCameraMercator(M,c):this._bufferedScreenMercator(M,c);let D=s.tileID.wrap+(A.unwrapped?b:0);const O=A.polygon.map((pe=>r.as(s.tileTransform,pe,D)));if(!r.at(O,0,0,r.al,r.al))return;D=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const V=this.screenGeometryMercator.polygon.map((pe=>r.au(s.tileTransform,pe,D))),H=V.map((pe=>new r.P(pe[0],pe[1]))),Q=c.getFreeCameraOptions().position||new r.ae(0,0,0),K=r.au(s.tileTransform,Q,D),ee=V.map((pe=>{const de=r.av(pe,pe,K);return r.aw(de,de),new r.ax(K,de)})),le=r.ay(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:ee,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(se=r.az(O),se.min.x=r.aA(se.min.x,0,r.al),se.min.y=r.aA(se.min.y,0,r.al),se.max.x=r.aA(se.max.x,0,r.al),se.max.y=r.aA(se.max.y,0,r.al),se),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:le};var se}_bufferedScreenMercator(s,c){const m=In(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let b;return b=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map((M=>c.pointCoordinate3D(M))),unwrapped:!0},this._screenRaycastCache[m]=b,b}}_bufferedCameraMercator(s,c){const m=In(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let b;return b=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map((M=>c.pointCoordinate3D(M))),unwrapped:!0},this._cameraRaycastCache[m]=b,b}}_projectAndResample(s,c){const m=(function(M,A){const D=r.aB([],A.pixelMatrix,A.globeMatrix),O=[0,-r.aD,0,1],V=[0,r.aD,0,1],H=[0,0,0,1];r.aC(O,O,D),r.aC(V,V,D),r.aC(H,H,D);const Q=new r.P(O[0]/O[3],O[1]/O[3]),K=new r.P(V[0]/V[3],V[1]/V[3]),ee=r.aE(M,Q)&&O[3]<H[3],le=r.aE(M,K)&&V[3]<H[3];if(!ee&&!le)return null;const se=(function(Ne,Oe,Le){for(let Ye=1;Ye<Ne.length;Ye++){const ct=Tn(Oe.pointCoordinate3D(Ne[Ye-1]).x),rt=Tn(Oe.pointCoordinate3D(Ne[Ye]).x);if(Le<0){if(ct<rt)return{idx:Ye,t:-ct/(rt-1-ct)}}else if(rt<ct)return{idx:Ye,t:(1-ct)/(rt+1-ct)}}return null})(M,A,ee?-1:1);if(!se)return null;const{idx:pe,t:de}=se;let be=pe>1?jn(M.slice(0,pe),A):[],Me=pe<M.length?jn(M.slice(pe),A):[];be=be.map((Ne=>new r.P(Tn(Ne.x),Ne.y))),Me=Me.map((Ne=>new r.P(Tn(Ne.x),Ne.y)));const we=[...be];we.length===0&&we.push(Me[Me.length-1]);const Ue=r.ak(we[we.length-1].y,(Me.length===0?be[0]:Me[0]).y,de);let Pe;return Pe=ee?[new r.P(0,Ue),new r.P(0,0),new r.P(1,0),new r.P(1,Ue)]:[new r.P(1,Ue),new r.P(1,1),new r.P(0,1),new r.P(0,Ue)],we.push(...Pe),Me.length===0?we.push(be[0]):we.push(...Me),{polygon:we.map((Ne=>new r.ae(Ne.x,Ne.y))),unwrapped:!1}})(s,c);if(m)return m;const b=(function(M,A){let D=!1,O=-1/0,V=0;for(let Q=0;Q<M.length-1;Q++)M[Q].x>O&&(O=M[Q].x,V=Q);for(let Q=0;Q<M.length-1;Q++){const K=(V+Q)%(M.length-1),ee=M[K],le=M[K+1];Math.abs(ee.x-le.x)>.5&&(ee.x<le.x?(ee.x+=1,K===0&&(M[M.length-1].x+=1)):(le.x+=1,K+1===M.length-1&&(M[0].x+=1)),D=!0)}const H=r.aF(A.center.lng);return D&&H<Math.abs(H-1)&&M.forEach((Q=>{Q.x-=1})),{polygon:M,unwrapped:D}})(jn(s,c).map((M=>new r.P(Tn(M.x),M.y))),c);return{polygon:b.polygon.map((M=>new r.ae(M.x,M.y))),unwrapped:b.unwrapped}}}function jn(p,s){return r.aG(p,(c=>{const m=s.pointCoordinate3D(c);c.x=m.x,c.y=m.y}),1/256)}function Tn(p){return p<0?1+p%1:p%1}function In(p){return 100*p|0}function Qr(p,s,c,m,b){const M=function(D,O){if(D)return b(D);if(O){if(p.url&&O.tiles&&p.tiles&&delete p.tiles,O.variants){if(!Array.isArray(O.variants))return b(new Error("variants must be an array"));for(const H of O.variants){if(H==null||typeof H!="object"||H.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(H.capabilities))return b(new Error("capabilities must be an array"));if(H.capabilities.length===1&&H.capabilities[0]==="meshopt"){O=Object.assign(O,H);break}}}const V=r.aH(Object.assign({},O,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=s.canonicalizeTileset(V,p.url),b(null,V)}},A=(function(D,O,V){if(!D)return null;if(!O&&!V)return D;V=V||D.worldview_default;const H=Object.values(D.language||{});if(H.length===0)return null;const Q=Object.values(D.worldview||{});if(Q.length===0)return null;const K=H.every((le=>le===O)),ee=Q.every((le=>le===V));return K&&ee?D:O in(D.language_options||{})||V in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null})(p.data,c,m);return A?r.o.frame((()=>M(null,A))):p.url?r.m(s.transformRequest(s.normalizeSourceURL(p.url,null,c,m),r.R.Source),M):r.o.frame((()=>{const{data:D,...O}=p;M(null,O)}))}function kr(p,s){const c=Math.pow(2,s.z),m=Math.floor(r.aF(p.getWest())*c),b=Math.floor(r.aJ(p.getNorth())*c),M=Math.ceil(r.aF(p.getEast())*c),A=Math.ceil(r.aJ(p.getSouth())*c);return s.x>=m&&s.x<M&&s.y>=b&&s.y<A}class qs{constructor(s,c,m){this.bounds=s?r.aI.convert(this.validateBounds(s)):null,this.minzoom=c||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const c of s)this.extraBounds.push(r.aI.convert(this.validateBounds(c)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!kr(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(kr(c,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const c=new qs(s.bounds,s.minzoom,s.maxzoom);return c.addExtraBounds(s.extra_bounds),c}}class bl extends r.E{constructor(s,c,m,b){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new r.aK}load(s){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=Qr(this._options,this.map._requestManager,c,m,((b,M)=>{if(this._tileJSONRequest=null,this._loaded=!0,b)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new r.y(b));else if(M){if(Object.assign(this,M),this.hasWorldviews=!!M.worldview_options,M.worldview_default&&(this.worldviewDefault=M.worldview_default),M.vector_layers){this.vectorLayers=M.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const A of M.vector_layers)this.vectorLayerIds.push(A.id),M.worldview&&M.worldview[A.source]&&this.localizableLayerIds.add(A.id)}this.tileBounds=qs.fromTileJSON(M),Vt(M.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}s&&s(b)}))}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(s)))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(s,c){const m=s.tileID.canonical.url(this.tiles,this.scheme),b=this.map._requestManager.normalizeTileURL(m),M=this.map._requestManager.transformRequest(b,r.R.Tile),A=this.map.style?this.map.style.getLut(this.scope):null,D=A?{image:A.image.clone()}:null,O={request:M,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&r.h(m)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",O,V.bind(this));else if(s.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",O,V.bind(this),void 0,!0);else{const H=r.aL.call({deduped:this._deduped},O,((Q,K)=>{if(Q||!K)V.call(this,Q);else{const ee=r.aM(K.responseHeaders);O.data={rawData:K.rawData.slice(0),expires:ee.expires,cacheControl:ee.cacheControl},s.actor&&s.actor.send("loadTile",O,V.bind(this),void 0,!0)}}),!0);s.request={cancel:H}}function V(H,Q){return delete s.request,s.aborted?c(null):H&&H instanceof r.aN&&H.status!==404?c(H):(Q&&Q.resourceTiming&&(s.resourceTiming=Q.resourceTiming),this.map._refreshExpiredTiles&&Q&&s.setExpiryData(Q),s.loadVectorData(Q,this.map.painter),r.aO(this.dispatcher),c(null,Q),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Kr extends r.E{constructor(s,c,m,b){super(),this.id=s,this.dispatcher=m,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,r.aH(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=Qr(this._options,this.map._requestManager,null,c,((m,b)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new r.y(m)):b&&(Object.assign(this,b),b.raster_layers&&(this.rasterLayers=b.raster_layers,this.rasterLayerIds=this.rasterLayers.map((M=>M.id))),this.tileBounds=qs.fromTileJSON(b),Vt(b.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),s&&s(m)}))}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(s)))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const m=r.o.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=r.n(this.map._requestManager.transformRequest(b,r.R.Tile),((M,A,D)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(M)return s.state="errored",c(M);if(!A)return c(null);const O=r.aM(D);this.map._refreshExpiredTiles&&s.setExpiryData(O),s.setTexture(A,this.map.painter),s.state="loaded",r.aO(this.dispatcher),c(null)}))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof r.T?(s.destroy(!1),s.texture&&s.texture instanceof r.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function qa([p,s],c,m,{scaled:b=!0}={}){const{tileSize:M,buffer:A}=m,{x:D,y:O,z:V}=c;if(!isFinite(D)||!isFinite(O)||!isFinite(V))throw new Error("Invalid MRT header");const H=2**V,Q=H*r.aF(p),K=H*r.aJ(s);return(function([ee,le],se,{scaled:pe=!0}={}){if(!se)throw new Error("bandView is undefined");const{data:de,tileSize:be,buffer:Me,offset:we,scale:Ue,dimension:Pe}=se;if(ee<-Me||ee>be+Me||le<-Me||le>be+Me)throw new Error(`Point (${ee}, ${le}) out of bounds for tileSize=${be}, buffer=${Me}`);const Ne=(le+Me)*(be+2*Me)+(ee+Me);if(new Uint32Array(de.buffer)[Ne]===4294967295)return null;let Oe=[];Oe=pe?[]:new se.data.constructor(Pe);for(let Le=0;Le<Pe;Le++)Oe[Le]=Math.round(1e12*(de[Pe*Ne+Le]*Ue+we))/1e12;return Oe})([Math.min(Math.max(-A,Math.floor((Q-D)*M)),M-1+A),Math.min(Math.max(-A,Math.floor((K-O)*M)),M-1+A)],m,{scaled:b})}class as extends Kr{constructor(s,c,m,b){super(s,c,m,b),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);c&&c.enabled&&m&&c._clearRenderCacheForTile(m.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(m,r.R.Tile),M={request:b,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=b,s.actor||(s.actor=this.dispatcher.getActor());const A=(D,O,V)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(D)return D.name==="AbortError"?void 0:(s.state="errored",c(D));if(this.map._refreshExpiredTiles&&O){const H=r.aM(V);s.setExpiryData(H)}if(this.partial&&s.state!=="expired")s.state="empty";else if(!this.partial){if(!O)return c(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=O}c(null)};s.request=this.partial?s.fetchHeader(void 0,A.bind(this)):s.actor.send("loadTile",M,A.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){const m=s.texturePerLayer;if(s.flushAllQueues(),m.size){s.destroy(!1);for(const b of m.values())this.map.painter.saveTileTexture(b)}else s.destroy()}prepareTile(s,c,m,b){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBandForRender(c,m,b,((M,A)=>{if(M)return s.state="errored",this.fire(new r.y(M)),void this.triggerRepaint(s);A&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(m,A,this.map.painter),s.state="loaded",this.triggerRepaint(s))})))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find((({id:M})=>M===s)),m=c&&c.fields,b=m&&m.bands&&m.bands;return b?b[0]:0}getTextureDescriptor(s,c,m){if(!s)return;const b=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let M=null;c instanceof r.aR?M=c.paint.get("raster-array-band"):c instanceof r.aS&&(M=c.paint.get("raster-particle-array-band"));const A=M||this.getInitialBand(b);if(A==null)return;if(!s.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(s,b,c.id,A);if(s.updateNeeded(c.id,A)&&!m)return;const D=s.textureDescriptorPerLayer.get(c.id);return Object.assign({},D,{texture:s.texturePerLayer.get(c.id)})}getImages(s,c){const m=new Map;for(const b of s)for(const M of c){const[A,D]=M.split("/"),O=b.getLayer(A);if(!O||!O.hasBand(D)||!O.hasDataForBand(D))continue;const{bytes:V,tileSize:H,buffer:Q}=O.getBandView(D),K=H+2*Q,ee={data:new r.q({width:K,height:K},V),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(M,ee)}return m}queryRasterArrayValueByBandId(s,c,m){const b=c._mrt;return new Promise((M=>{const A={},D=new Set;for(const[O,V]of Object.entries(b.layers)){if(m.layerName&&O!==m.layerName)continue;const H={};A[O]=H;for(const{bands:Q}of V.dataIndex)for(const K of Q)m.bands&&!m.bands.includes(K)||(D.add(r.B(O,K)),c.fetchBand(O,null,K,(ee=>{r.o.frame((()=>{H[K]=ee?null:qa([s.lng,s.lat],b,V.getBandView(K)),D.delete(r.B(O,K)),D.size===0&&M(A)}))}),!1))}D.size===0&&M(A)}))}_loadTileForQuery(s,c){if(this._loadTileLoaded[s.uid])return void c(null,s._mrt);if(this._loadTilePending[s.uid])return void this._loadTilePending[s.uid].push(c);this._loadTilePending[s.uid]=[c];const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(m,r.R.Tile);s.actor.send("loadTile",{request:b,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((M,A,D)=>{if(M)return this._loadTilePending[s.uid].forEach((O=>O(M,null))),void delete this._loadTilePending[s.uid];if(!A)return this._loadTilePending[s.uid].forEach((O=>O(null,null))),void delete this._loadTilePending[s.uid];if(this.map._refreshExpiredTiles&&A){const O=r.aM(D);s.setExpiryData(O)}s._mrt=A,s._isHeaderLoaded=!0,s.state="loaded",this._loadTilePending[s.uid].forEach((O=>O(null,A))),this._loadTileLoaded[s.uid]=!0,delete this._loadTilePending[s.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(s,c,m){return new Promise(((b,M)=>{this._loadTileForQuery(c,((A,D)=>{A?M(A):b(D?this.queryRasterArrayValueByBandId(s,c,m):null)}))}))}queryRasterArrayValue(s,c){const m=r.aT.convert(s),b=this.findLoadedParent(m);return b&&b._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(m,b,c):this.queryRasterArrayValueByAllBands(m,b,c):Promise.resolve(null)}findLoadedParent(s){const c=r.ae.fromLngLat(s,this.map.transform.tileSize),m=this.maxzoom+1,b=1<<m,M=Math.floor(c.x),A=Math.floor((c.x-M)*b),D=Math.floor(c.y*b),O=this.map.style.getSourceCache(this.id),V=new r.aQ(m,M,m,A,D);return O.findLoadedParent(V,this.minzoom)}}const la={vector:bl,raster:Kr,"raster-dem":class extends Kr{constructor(p,s,c,m){super(p,s,c,m),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(b,M){b&&(p.state="errored",s(b)),M&&(p.dem=M,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=r.n(this.map._requestManager.transformRequest(c,r.R.Tile),(function(b,M,A){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(b)p.state="errored",s(b);else if(M){const D=r.aM(A);this.map._refreshExpiredTiles&&p.setExpiryData(D);const O=ImageBitmap&&M instanceof ImageBitmap&&r.r(),V=1-(M.width-r.aP(M.width))/2;V<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const H=O?M:r.o.getImageData(M,V),Q={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:H,encoding:this.encoding,padding:V};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",Q,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const s=p.canonical,c=Math.pow(2,s.z),m=(s.x-1+c)%c,b=s.x===0?p.wrap-1:p.wrap,M=(s.x+1+c)%c,A=s.x+1===c?p.wrap+1:p.wrap,D={};return D[new r.aQ(p.overscaledZ,b,s.z,m,s.y).key]={backfilled:!1},D[new r.aQ(p.overscaledZ,A,s.z,M,s.y).key]={backfilled:!1},s.y>0&&(D[new r.aQ(p.overscaledZ,b,s.z,m,s.y-1).key]={backfilled:!1},D[new r.aQ(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},D[new r.aQ(p.overscaledZ,A,s.z,M,s.y-1).key]={backfilled:!1}),s.y+1<c&&(D[new r.aQ(p.overscaledZ,b,s.z,m,s.y+1).key]={backfilled:!1},D[new r.aQ(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},D[new r.aQ(p.overscaledZ,A,s.z,M,s.y+1).key]={backfilled:!1}),D}},"raster-array":as,geojson:class extends r.E{constructor(p,s,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=s.data,this._options=Object.assign({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const b=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*b,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*b,extent:r.al,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:r.al,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*b,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of p.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:c},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const s=Object.assign({append:p},this.workerOptions);s.scope=this.scope;const c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(r.o.resolveURL(c),r.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,((m,b)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new r.y(m));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(M.resourceTiming=b.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.z("data",M)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const p=r.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,s){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,b=m?{image:m.image.clone()}:null,M=this._partialReload,A={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:b,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:M,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(c,A,((D,O)=>M&&!O?(p.state="loaded",s(null)):(delete p.request,p.destroy(!1),p.aborted?s(null):D?s(D):(p.loadVectorData(O,this.map.painter,c==="reloadTile"),s(null)))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,s){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aU{constructor(p,s,c,m){super(p,s,c,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,r.R.Source).url);r.aV(this.urls,((s,c)=>{this._loaded=!0,s?this.fire(new r.y(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aU,model:r.aX,"batched-model":class extends r.E{constructor(p,s,c,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(p)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Qr(this._options,this.map._requestManager,s,c,((m,b)=>{this._tileJSONRequest=null,this._loaded=!0,m?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new r.y(m))):b&&(Object.assign(this,b),b.bounds&&(this.tileBounds=new qs(b.bounds,this.minzoom,this.maxzoom)),Vt(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)}))}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=s;else{if(p.buckets){const M=Object.values(p.buckets);for(const A of M)A.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,b.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,b.bind(this),void 0,!0);function b(M,A){return p.aborted?s(null):M&&M.status!==404?s(M):(this.map._refreshExpiredTiles&&A&&p.setExpiryData(A),p.loadModelData(A,this.map.painter),p.state="loaded",void s(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aU{constructor(p,s,c,m){super(p,s,c,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((b=>!Array.isArray(b)||b.length!==2||b.some((M=>typeof M!="number"))))||this.fire(new r.y(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,s,c,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qs(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:c,z:m}=p.canonical;return this._implementation.hasTile({x:s,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:c,y:m,z:b}=p.tileID.canonical,M=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:b},{signal:M.signal})).then((function(A){return delete p.request,p.aborted?(p.state="unloaded",s(null)):A===void 0?(p.state="errored",s(null)):A===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):(function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement})(A)?(this.loadTileData(p,A),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((A=>{A.name!=="AbortError"&&(p.state="errored",s(A))})),p.request.cancel=()=>M.abort()}loadTileData(p,s){p.setTexture(s,this.map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof r.T?(p.destroy(!1),p.texture&&p.texture instanceof r.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:m,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:b})}s&&s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z})))}_clearTiles(){const p=r.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},xs=function(p,s,c,m){const b=new la[s.type](p,s,c,m);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return r.aY(["load","abort","unload","serialize","prepare"],b),b};function Ma(p,s,c=""){return`${c}:${s.id||""}:${s.layer.id}:${(function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:b,importId:M}=m;return`featureset:${b}${M?`:import:${M}`:""}`}})(p.target)}`}function ma(p,s,c,m=""){if(p.uniqueFeatureID){const b=Ma(p,s,m);if(c.has(b))return!0;c.add(b)}return!1}function Ul(p,s,c,m,b=!1){const M=s.sourceCache.transform,A=s.sourceCache.tilesIn(p,s.has3DLayers,b);A.sort(Jf);const D=[];for(const O of A){const V=O.tile.queryRenderedFeatures(s,O,c,m,M,b);Object.keys(V).length&&D.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:V})}for(const O in s.layers){const V=s.layers[O];if(V.styleLayer){const H=V.styleLayer.queryRenderedFeatures(p,s.sourceCache,m);Object.keys(H).length&&D.push({wrappedTileID:0,queryResults:H})}}return D.length===0?{}:(function(O){const V={},H={};for(const Q of O){const K=Q.queryResults,ee=Q.wrappedTileID,le=H[ee]=H[ee]||{};for(const se in K){const pe=K[se],de=le[se]=le[se]||{},be=V[se]=V[se]||[];for(const Me of pe)de[Me.featureIndex]||(de[Me.featureIndex]=!0,be.push(Me))}}return V})(D)}function wl(p,s,c,m,b,M){const A={},D=m.queryRenderedSymbols(p),O=[];for(const V of Object.keys(D).map(Number))O.push(b[V]);O.sort(Jf);for(const V of O){const H=V.featureIndex.lookupSymbolFeatures(D[V.bucketInstanceId],V.bucketIndex,V.sourceLayerIndex,s,c,M);for(const Q in H){const K=A[Q]=A[Q]||[],ee=H[Q];ee.sort(((le,se)=>{const pe=V.featureSortOrder;if(pe){const de=pe.indexOf(le.featureIndex);return pe.indexOf(se.featureIndex)-de}return se.featureIndex-le.featureIndex}));for(const le of ee)K.push(le)}}return A}function tf(p,s){const c=p.getRenderableIds().map((M=>p.getTileByID(M))),m=[],b={};for(let M=0;M<c.length;M++){const A=c[M],D=A.tileID.canonical.key;b[D]||(b[D]=!0,A.querySourceFeatures(m,s))}return m}function Jf(p,s){const c=p.tileID,m=s.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function kl(p,s){const c={};if(!s)return c;for(const m of p){const b=m.layerIds.map((M=>s.getLayer(M))).filter(Boolean);if(b.length!==0){m.layers=b,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map((M=>b.filter((A=>A.id===M))[0])));for(const M of b)c[M.fqid]=m}}return c}const tl=32,Cc=33,Sl=new Uint16Array(8184);for(let p=0;p<2046;p++){let s=p+2,c=0,m=0,b=0,M=0,A=0,D=0;for(1&s?b=M=A=tl:c=m=D=tl;(s>>=1)>1;){const V=c+b>>1,H=m+M>>1;1&s?(b=c,M=m,c=A,m=D):(c=b,m=M,b=A,M=D),A=V,D=H}const O=4*p;Sl[O+0]=c,Sl[O+1]=m,Sl[O+2]=b,Sl[O+3]=M}const Ka=new Uint16Array(2178),Vl=new Uint8Array(1089),iu=new Uint16Array(1089);function oc(p){return p===0?-.03125:p===32?.03125:0}const nu={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class wh{constructor(s,c,m,b,M,A){this.tileID=s,this.uid=r.b2(),this.uses=0,this.tileSize=c,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=M,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection),this.worldview=A,this._hasAppearances=null}registerFadeDuration(s){const c=s+this.timeAdded;c<r.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,m){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=kl(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const M=this.buckets[b];if(M instanceof r.b4){if(this.hasSymbolBuckets=!0,!m)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const M=this.buckets[b];if(M instanceof r.b4&&M.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(const b in this.buckets){const M=this.buckets[b],A=c.style.getOwnLayer(b);if(!A)continue;const D=A.queryRadius(M);this.queryPadding=Math.max(this.queryPadding,D)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,m){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,kl(s.buckets,c.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s,c){for(const M in this.buckets){const A=this.buckets[M];if(A.uploadPending()){let D={},O=[],V={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){O=c.style.listImages();const H=A.layers[0],Q=H.sourceLayer||"_geojsonTileLayer",K=c.style.getLayerSourceCache(H);K&&(D=K._state.getState(Q,void 0))}V={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}A.upload(s,this.tileID.canonical,D,O,V)}}const m=s.gl,b=this.imageAtlas;b&&!b.uploaded&&(this.imageAtlasTexture=new r.T(s,b.image,m.RGBA8,{useMipmap:!!b.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(s,this.glyphAtlasImage,m.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(s,this.lineAtlas.image,m.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,m),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const b=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||b||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==b),this._lastUpdatedBrightness=b))}evaluateQueryRenderedFeaturePadding(){let s=0;for(const c in this.buckets){const m=this.buckets[c];m.evaluateQueryRenderedFeaturePadding&&(s=Math.max(s,m.evaluateQueryRenderedFeaturePadding()))}return s}queryRenderedFeatures(s,c,m,b,M,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const D=this.evaluateQueryRenderedFeaturePadding(),O=(function(V,H){const Q=r.bq([],[.5*V.width,.5*-V.height,1]);return r.br(Q,Q,[1,-1,0]),r.aB(Q,Q,V.calculateProjMatrix(H.toUnwrapped())),Float32Array.from(Q)})(M,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:c,pixelPosMatrix:O,transform:b,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:D})}querySourceFeatures(s,c){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const b=m.loadVTLayers(),M=c?c.sourceLayer:"",A=b._geojsonTileLayer||b[M];if(!A)return;const D=r.b6(c&&c.filter),{z:O,x:V,y:H}=this.tileID.canonical,Q={z:O,x:V,y:H};for(let K=0;K<A.length;K++){const ee=A.feature(K);if(D.needGeometry){const pe=r.b7(ee,!0);if(!D.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),pe,this.tileID.canonical))continue}else if(!D.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ee))continue;const le=m.getId(ee,M),se=new r.b8(ee,O,V,H,le);se.tile=Q,s.push(se)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const m=r.b9(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let b=!1;if(this.expirationTime>m)b=!1;else if(c)if(this.expirationTime<c)b=!0;else{const M=this.expirationTime-c;M?this.expirationTime=m+Math.max(M,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}hasAppearances(s){for(const c in this.buckets)if(s.style.hasLayer(c)&&this.buckets[c].layers.some((m=>m.appearances&&m.appearances.length>0)))return!0;return!1}updateBuckets(s,c){if(!this.latestFeatureIndex||!s.style)return;const m=s.style.listImages(),b=s.style.getBrightness();for(const M in this.buckets){if(!s.style.hasLayer(M))continue;const A=this.buckets[M],D=A.layers[0],O=D.sourceLayer||"_geojsonTileLayer",V=s.style.getLayerSourceCache(D);let H={};V&&(H=V._state.getState(O,void 0));const Q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},K=Object.keys(H).length>0&&!c;A.hasAppearances=A.layers.some((se=>se.appearances&&se.appearances.length>0));const ee=K?A.stateDependentLayers:A.layers;if(K&&A.stateDependentLayers.length!==0||c){const se=this.latestFeatureIndex.loadVTLayers();A.update(H,se[O],m,Q,ee,c,b)}if(K&&A.stateDependentLayers.length!==0||c||A.hasAppearances){const se={zoom:s.transform.zoom,pitch:s.transform.pitch,brightness:s.style.getBrightness()||0,worldview:s.worldview};A.updateAppearances(this.tileID.canonical,H,m,se)}(A instanceof r.ba||A instanceof r.bb)&&s._terrain&&s._terrain.enabled&&V&&A.uploadPending()&&s._terrain._clearRenderCacheForTile(V.id,this.tileID);const le=s&&s.style&&s.style.getOwnLayer(M);le&&(this.queryPadding=Math.max(this.queryPadding,le.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=r.o.now()+s}setTexture(s,c){const m=c.context,b=m.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof r.T?this.texture.update(s):(this.texture=new r.T(m,s,b.RGBA8,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(s,c){const m={};for(const b of c)m[b]=!0;this.dependencies[s]=m}hasDependency(s,c){for(const m of s){const b=this.dependencies[m];if(b){for(const M of c)if(b[M])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const m=r.bc(nu,this.tileID.canonical,this.tileTransform)[0],b=new r.bd,M=new r.be;for(let A=0;A<m.length;A++){const{x:D,y:O}=m[A];b.emplaceBack(D,O),M.emplaceBack(A)}M.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(M),this._tileDebugBuffer=s.createVertexBuffer(b,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,b.length,M.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const m=r.bc(nu,this.tileID.canonical,this.tileTransform)[0];let b,M;if(this.isRaster){const A=(function(D,O){const V=r.aZ(D,O),H=Math.pow(2,D.z);for(let pe=0;pe<Cc;pe++)for(let de=0;de<Cc;de++){const be=r.a_((D.x+(de+oc(de))/tl)/H),Me=r.a$((D.y+(pe+oc(pe))/tl)/H),we=O.project(be,Me),Ue=pe*Cc+de;Ka[2*Ue+0]=Math.round((we.x*V.scale-V.x)*r.al),Ka[2*Ue+1]=Math.round((we.y*V.scale-V.y)*r.al)}Vl.fill(0),iu.fill(0);for(let pe=2045;pe>=0;pe--){const de=4*pe,be=Sl[de+0],Me=Sl[de+1],we=Sl[de+2],Ue=Sl[de+3],Pe=be+we>>1,Ne=Me+Ue>>1,Oe=Pe+Ne-Me,Le=Ne+be-Pe,Ye=Me*Cc+be,ct=Ue*Cc+we,rt=Ne*Cc+Pe,_t=Math.hypot((Ka[2*Ye+0]+Ka[2*ct+0])/2-Ka[2*rt+0],(Ka[2*Ye+1]+Ka[2*ct+1])/2-Ka[2*rt+1])>=16;Vl[rt]=Vl[rt]||(_t?1:0),pe<1022&&(Vl[rt]=Vl[rt]||Vl[(Me+Le>>1)*Cc+(be+Oe>>1)]||Vl[(Ue+Le>>1)*Cc+(we+Oe>>1)])}const Q=new r.b1,K=new r.b0;let ee=0;function le(pe,de){const be=de*Cc+pe;return iu[be]===0&&(Q.emplaceBack(Ka[2*be+0],Ka[2*be+1],pe*r.al/tl,de*r.al/tl),iu[be]=++ee),iu[be]-1}function se(pe,de,be,Me,we,Ue){const Pe=pe+be>>1,Ne=de+Me>>1;if(Math.abs(pe-we)+Math.abs(de-Ue)>1&&Vl[Ne*Cc+Pe])se(we,Ue,pe,de,Pe,Ne),se(be,Me,we,Ue,Pe,Ne);else{const Oe=le(pe,de),Le=le(be,Me),Ye=le(we,Ue);K.emplaceBack(Oe,Le,Ye)}}return se(0,0,tl,tl,tl,0),se(tl,tl,0,0,0,tl),{vertices:Q,indices:K}})(this.tileID.canonical,c);b=A.vertices,M=A.indices}else{b=new r.b1,M=new r.b0;for(const{x:D,y:O}of m)b.emplaceBack(D,O,0,0);const A=r.bh(b.int16.subarray(0,4*b.length),void 0,4);for(let D=0;D<A.length;D+=3)M.emplaceBack(A[D],A[D+1],A[D+2])}this._tileBoundsBuffer=s.createVertexBuffer(b,r.bi.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(M),this._tileBoundsSegments=r.bg.simpleSegment(0,0,b.length,M.length)}_makeGlobeTileDebugBuffers(s,c){const m=c.projection;if(!m||m.name!=="globe"||c.freezeTileCoverage)return;const b=this.tileID.canonical,M=r.bj(b,c),A=r.bk(M),D=r.aj(c.zoom);let O;D>0&&(O=r.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,b,c,A,O,D),this._makeGlobeTileDebugTextBuffer(s,b,c,A,O,D)}_globePoint(s,c,m,b,M,A,D){let O=r.bm(s,c,m);if(A){const V=1<<m.z,H=r.aF(b.center.lng),Q=r.aJ(b.center.lat),K=(m.x+.5)/V-H;let ee=0;K>.5?ee=-1:K<-.5&&(ee=1);let le=(s/r.al+m.x)/V+ee,se=(c/r.al+m.y)/V;le=(le-H)*b._pixelsPerMercatorPixel+H,se=(se-Q)*b._pixelsPerMercatorPixel+Q;const pe=[le*b.worldSize,se*b.worldSize,0];r.af(pe,pe,A),O=r.bn(O,pe,D)}return r.af(O,O,M)}_makeGlobeTileDebugBorderBuffer(s,c,m,b,M,A){const D=new r.bd,O=new r.be,V=new r.bo,H=(K,ee,le,se,pe)=>{const de=(le-K)/(pe-1),be=(se-ee)/(pe-1),Me=D.length;for(let we=0;we<pe;we++){const Ue=K+we*de,Pe=ee+we*be;D.emplaceBack(Ue,Pe);const Ne=this._globePoint(Ue,Pe,c,m,b,M,A);V.emplaceBack(Ne[0],Ne[1],Ne[2]),O.emplaceBack(Me+we)}},Q=r.al;H(0,0,Q,0,16),H(Q,0,Q,Q,16),H(Q,Q,0,Q,16),H(0,Q,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(O),this._tileDebugBuffer=s.createVertexBuffer(D,r.bf.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(V,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,D.length,O.length)}_makeGlobeTileDebugTextBuffer(s,c,m,b,M,A){const D=r.al/4,O=new r.bd,V=new r.b0,H=new r.bo,Q=25;V.reserve(32),O.reserve(Q),H.reserve(Q);const K=(ee,le)=>Q*ee+le;for(let ee=0;ee<Q;ee++){const le=ee*D;for(let se=0;se<Q;se++){const pe=se*D;O.emplaceBack(pe,le);const de=this._globePoint(pe,le,c,m,b,M,A);H.emplaceBack(de[0],de[1],de[2])}}for(let ee=0;ee<4;ee++)for(let le=0;le<4;le++){const se=K(ee,le),pe=K(ee,le+1),de=K(ee+1,le),be=K(ee+1,le+1);V.emplaceBack(se,pe,de),V.emplaceBack(de,pe,be)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(V),this._tileDebugTextBuffer=s.createVertexBuffer(O,r.bf.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(H,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,Q,32)}destroy(s=!0){for(const c in this.buckets)this.buckets[c].destroy(s);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),s&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof r.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class Qf extends wh{constructor(s,c,m,b,M){super(s,c,m,b,M),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,c,m){const b=m.context,M=b.gl;let A=this.texturePerLayer.get(s)||m.getTileTexture(c.width);A&&A instanceof r.T?A.update(c,{premultiply:!1}):A=new r.T(b,c,M.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,A)}flushQueues(s){const c=this._workQueuePerLayer.get(s)||[],m=this._fetchQueuePerLayer.get(s)||[];for(;c.length;)c.pop()();for(;m.length;)m.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(s)||[];for(;c.length;)c.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(s)||[];for(;c.length;)c.pop()()}}fetchHeader(s=16384,c){const m=this._mrt=new r.bs(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=r.bu(b,((M,A,D)=>{if(M)c(M);else try{const O=m.getHeaderLength(A);if(O>s)return void(this.request=this.fetchHeader(O,c));m.parseHeader(A),this._isHeaderLoaded=!0;let V=0;for(const H of Object.values(m.layers))V=Math.max(V,H.dataIndex[H.dataIndex.length-1].lastByte);A.byteLength>=V&&(this.entireBuffer=A),c(null,this.entireBuffer||A,D)}catch(O){c(O)}})),this.request}fetchBandForRender(s,c,m,b){this.fetchBand(s,c,m,(M=>{if(M)return void b(M);this.updateTextureDescriptor(s,c,m);const A=this.textureDescriptorPerLayer.get(c);b(null,A?A.img:null)}))}fetchBand(s,c,m,b,M=!0){const A=this._mrt;if(!this._isHeaderLoaded||!A)return void b(new Error("Tile header is not ready"));const D=this.actor;if(!D)return void b(new Error("Can't fetch tile band without an actor"));let O;const V=r.B(String(m),r.B(this.tileID.key,s));let H=this._taskQueue.get(V);H?H.add(b):(H=new Set,H.add(b),this._taskQueue.set(V,H));const Q=(se,pe)=>{O.complete(se,pe),se?b(se):(H.forEach((de=>de(null,pe))),this._taskQueue.delete(V))},K=(se,pe)=>{if(se)return b(se);const de=D.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:pe,task:O},Q,void 0,!0);if(c!==null){const be=this._workQueuePerLayer.get(c)||[];be.push((()=>{de&&de.cancel(),O.cancel()})),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,be)}};let ee;try{ee=A.getLayer(s)}catch(se){if(this.state==="reloading")return;throw se}if(!ee)return void b(new Error(`Unknown sourceLayer "${s}"`));if(ee.hasDataForBand(m))return H.forEach((se=>se(null,null))),void this._taskQueue.delete(V);const le=ee.getDataRange([m]);if(O=A.createDecodingTask(le),!O||O.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)K(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const se=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),pe=r.bu(se,K);if(c!==null){const de=this._fetchQueuePerLayer.get(c)||[];de.push((()=>{pe.cancel(),O.cancel()})),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,de)}}}updateNeeded(s,c){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(s,c,m){if(!this._mrt)return;const b=this._mrt.getLayer(s);if(!b||!b.hasBand(m)||!b.hasDataForBand(m))return;const{bytes:M,tileSize:A,buffer:D,offset:O,scale:V}=b.getBandView(m),H=A+2*D,Q=new r.q({width:H,height:H},M),K=this.texturePerLayer.get(c);K&&K instanceof r.T&&K.update(Q,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:s,band:m,img:Q,buffer:D,offset:O,tileSize:A,format:b.pixelFormat,mix:[V,256*V,65536*V,16777216*V]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const c of this.texturePerLayer.values())c&&c instanceof r.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Pm{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,m){const b=s.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const M={value:c,timeout:void 0};if(m!==void 0&&(M.timeout=setTimeout((()=>{this.remove(s,M)}),m)),this.data[b].push(M),this.order.push(b),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const m=s.wrapped().key,b=c===void 0?0:this.data[m].indexOf(c),M=this.data[m][b];return this.data[m].splice(b,1),M.timeout&&clearTimeout(M.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(M.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const m in this.data)for(const b of this.data[m])s(b.value)||c.push(b);for(const m of c)this.remove(m.value.tileID,m)}}class ru{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,m){const b=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][b]=this.stateChanges[s][b]||{},Object.assign(this.stateChanges[s][b],m),this.deletedStates[s]===null){this.deletedStates[s]={};for(const M in this.state[s])M!==b&&(this.deletedStates[s][M]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][b]===null){this.deletedStates[s][b]={};for(const M in this.state[s][b])m[M]||(this.deletedStates[s][b][M]=null)}else for(const M in m)this.deletedStates[s]&&this.deletedStates[s][b]&&this.deletedStates[s][b][M]===null&&delete this.deletedStates[s][b][M]}removeFeatureState(s,c,m){if(this.deletedStates[s]===null)return;const b=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&c!==void 0)this.deletedStates[s][b]!==null&&(this.deletedStates[s][b]=this.deletedStates[s][b]||{},this.deletedStates[s][b][m]=null);else if(c!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][b])for(m in this.deletedStates[s][b]={},this.stateChanges[s][b])this.deletedStates[s][b][m]=null;else this.deletedStates[s][b]=null;else this.deletedStates[s]=null}getState(s,c){const m=this.state[s]||{},b=this.stateChanges[s]||{},M=this.deletedStates[s];if(M===null)return{};if(c!==void 0){const D=String(c),O=Object.assign({},m[D],b[D]);if(M){const V=M[c];if(V===null)return{};for(const H in V)delete O[H]}return O}const A=Object.assign({},m,b);if(M)for(const D in M)delete A[D];return A}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const m={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const M={};for(const A in this.stateChanges[b])this.state[b][A]||(this.state[b][A]={}),Object.assign(this.state[b][A],this.stateChanges[b][A]),M[A]=this.state[b][A];m[b]=M}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const M={};if(this.deletedStates[b]===null)for(const A in this.state[b])M[A]={},this.state[b][A]={};else for(const A in this.deletedStates[b]){if(this.deletedStates[b][A]===null)this.state[b][A]={};else if(this.state[b][A])for(const D of Object.keys(this.deletedStates[b][A]))delete this.state[b][A][D];M[A]=this.state[b][A]}m[b]=m[b]||{},Object.assign(m[b],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const b in s)s[b].refreshFeatureState(c)}}class Na extends r.E{constructor(s,c,m){super(),this.id=s,this._onlySymbols=m,c.on("data",(b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),c.on("error",(()=>{this._sourceErrored=!0})),this._source=c,this._tiles={},this._cache=new Pm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ru,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const m=this._tiles[c];m.upload(s,this.map?this.map.painter:void 0),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((s=>s.tileID)).sort(ed).map((s=>s.key))}getRenderableIds(s,c){const m=[];for(const b in this._tiles)this._isIdRenderable(+b,s,c)&&m.push(this._tiles[b]);return s?m.sort(((b,M)=>{const A=b.tileID,D=M.tileID,O=new r.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),V=new r.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-D.overscaledZ||V.y-O.y||V.x-O.x})).map((b=>b.tileID.key)):m.map((b=>b.tileID)).sort(ed).map((b=>b.key))}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,m){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(m||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const m=this._tiles[s];m&&(m.state!=="loading"&&(m.state=c),this._loadTile(m,this._tileLoaded.bind(this,m,s,c)))}_tileLoaded(s,c,m,b,M){if(b){if(s.state="errored",b.status!==404)this._source.fire(new r.y(b,{tile:s}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const D=this.map.painter.terrain;this.update(this.transform,D.getScaledDemTileSize(),!0),D.resetTileLookupCache(this.id)}else this.update(this.transform)}return}s.timeAdded=r.o.now(),m==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null);let A=new Map;M&&M.responseHeaders&&(A=M.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id,responseHeaders:A}))}_backfillDEM(s){const c=this.getRenderableIds();for(let b=0;b<c.length;b++){const M=c[b];if(s.neighboringTiles&&s.neighboringTiles[M]){const A=this.getTileByID(M);m(s,A),m(A,s)}}function m(b,M){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let A=M.tileID.canonical.x-b.tileID.canonical.x;const D=M.tileID.canonical.y-b.tileID.canonical.y,O=Math.pow(2,b.tileID.canonical.z),V=M.tileID.key;A===0&&D===0||Math.abs(D)>1||(Math.abs(A)>1&&(Math.abs(A+O)===1?A+=O:Math.abs(A-O)===1&&(A-=O)),M.dem&&b.dem&&(b.dem.backfillBorder(M.dem,A,D),b.neighboringTiles&&b.neighboringTiles[V]&&(b.neighboringTiles[V].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,m,b){for(const M in this._tiles){let A=this._tiles[M];if(b[M]||!A.hasData()||A.tileID.overscaledZ<=c||A.tileID.overscaledZ>m)continue;let D=A.tileID;for(;A&&A.tileID.overscaledZ>c+1;){const V=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[V.key],A&&A.hasData()&&(D=V)}let O=D;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),s[O.key]){b[D.key]=D;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=c?m:null}for(let m=s.overscaledZ-1;m>=c;m--){const b=s.scaledTo(m),M=this._getLoadedTile(b);if(M)return M}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const m=Math.ceil(s.width/c)+1,b=Math.ceil(s.height/c)+1,M=Math.floor(m*b*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,M):M,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(D)}handleWrapJump(s){const c=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,c){const m={};for(const b in this._tiles){const M=this._tiles[b];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),m[M.tileID.key]=M}this._tiles=m;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(s,c,m,b,M){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(s,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const A=this._source.type==="batched-model";let D,O=this._source.maxzoom;const V=this.map&&this.map.painter?this.map.painter._terrain:null;if(V&&V.sourceCache===this&&V.attenuationRange()){const K=V.attenuationRange()[0],ee=Math.floor(K)-Math.log2(V.getDemUpscale());O>ee&&(O=ee)}if(this.used||this.usedForTerrain){if(this._source.tileID)D=s.getVisibleUnwrappedCoordinates(this._source.tileID).map((K=>new r.aQ(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)));else if(this.tileCoverLift!==0){const K=s.clone();K.tileCoverLift=this.tileCoverLift,D=K.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:A}),this._source.minzoom<=1&&s.projection.name==="globe"&&(D.push(new r.aQ(1,0,1,0,0)),D.push(new r.aQ(1,0,1,1,0)),D.push(new r.aQ(1,0,1,0,1)),D.push(new r.aQ(1,0,1,1,1)))}else if(D=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:A}),this._source.hasTile){const K=this._source.hasTile.bind(this._source);D=D.filter((ee=>K(ee)))}}else D=[];if(D.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!su(this._source.type)){const K=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),ee=Math.min(K,this._source.maxzoom);if(A){const le=s.extendTileCover(D,ee);for(const se of le)D.push(se)}else if(M){const le=s.extendTileCoverToNearPlane(D,this.transform.getFrustum(ee),ee);for(const se of le)D.push(se)}else if(this.castsShadows&&b){const le=s.extendTileCover(D,ee,b,16);for(const se of le)this._shadowCasterTiles[se.key]=!0,D.push(se)}}const H=this._updateRetainedTiles(D);if(su(this._source.type)&&D.length!==0){const K={},ee={},le=Object.keys(H);for(const pe of le){const de=H[pe],be=this._tiles[pe];if(!be||be.fadeEndTime&&be.fadeEndTime<=r.o.now())continue;const Me=this.findLoadedParent(de,Math.max(de.overscaledZ-Na.maxOverzooming,this._source.minzoom));Me&&(this._addTile(Me.tileID),K[Me.tileID.key]=Me.tileID),ee[pe]=de}const se=D[D.length-1].overscaledZ;for(const pe in this._tiles){const de=this._tiles[pe];if(H[pe]||!de.hasData())continue;let be=de.tileID;for(;be.overscaledZ>se;){be=be.scaledTo(be.overscaledZ-1);const Me=this._tiles[be.key];if(Me&&Me.hasData()&&ee[be.key]){H[pe]=de.tileID;break}}}for(const pe in K)H[pe]||(this._coveredTiles[pe]=!0,H[pe]=K[pe])}for(const K in H)this._tiles[K].clearFadeHold();const Q=r.bv(this._tiles,H);for(const K of Q){const ee=this._tiles[K];ee.hasSymbolBuckets&&!ee.holdingForFade()?ee.setHoldDuration(this.map._fadeDuration):ee.hasSymbolBuckets&&!ee.symbolFadeFinished()||this._removeTile(+K)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(s.length===0)return c;const m={},b=s.reduce(((V,H)=>Math.min(V,H.overscaledZ)),1/0),M=s[0].overscaledZ,A=Math.max(M-Na.maxOverzooming,this._source.minzoom),D=Math.max(M+Na.maxUnderzooming,this._source.minzoom),O={};for(const V of s){const H=this._addTile(V);c[V.key]=V,H.hasData()||b<this._source.maxzoom&&(O[V.key]=V)}this._retainLoadedChildren(O,b,D,c);for(const V of s){let H=this._tiles[V.key];if(H.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const K=V.children(this._source.maxzoom)[0],ee=this.getTile(K);if(ee&&ee.hasData()){c[K.key]=K;continue}}else{const K=V.children(this._source.maxzoom);if(c[K[0].key]&&c[K[1].key]&&c[K[2].key]&&c[K[3].key])continue}let Q=H.wasRequested();for(let K=V.overscaledZ-1;K>=A;--K){const ee=V.scaledTo(K);if(m[ee.key]||(m[ee.key]=!0,H=this.getTile(ee),!H&&Q&&(H=this._addTile(ee)),H&&(c[ee.key]=ee,Q=H.wasRequested(),H.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let m,b=this._tiles[s].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){m=this._loadedParentTiles[b.key];break}c.push(b.key);const M=b.scaledTo(b.overscaledZ-1);if(m=this._getLoadedTile(M),m)break;b=M}for(const M of c)this._loadedParentTiles[M]=m}}_addTile(s){let c=this._tiles[s.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const m=!!c;if(!m){const b=this.map?this.map.painter:null,M=this._source.tileSize*s.overscaleFactor();c=this._source.type==="raster-array"?new Qf(s,M,this.transform.tileZoom,b,this._isRaster):new wh(s,M,this.transform.tileZoom,b,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c.uses++,this._tiles[s.key]=c,m||this._source.fire(new r.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=c.getExpiryTimeout();m&&(this._timers[s]=setTimeout((()=>{this._reloadTile(s,"expired"),delete this._timers[s]}),m))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,m){const b=[],M=this.transform;if(!M)return b;const A=M.projection.name==="globe",D=r.aF(M.center.lng);for(const O in this._tiles){const V=this._tiles[O];if(m&&V.clearQueryDebugViz(),V.holdingForFade())continue;let H;if(A){const Q=V.tileID.canonical;if(Q.z===0){const K=[Math.abs(r.aA(D,...il(Q,-1))-D),Math.abs(r.aA(D,...il(Q,1))-D)];H=[0,2*K.indexOf(Math.min(...K))-1]}else{const K=[Math.abs(r.aA(D,...il(Q,-1))-D),Math.abs(r.aA(D,...il(Q,0))-D),Math.abs(r.aA(D,...il(Q,1))-D)];H=[K.indexOf(Math.min(...K))-1]}}else H=[0];for(const Q of H){const K=s.containsTile(V,M,c,Q);K&&b.push(K)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const m=this.getRenderableIds(s,c).map((M=>this._tiles[M].tileID)),b=this.transform.projection.name==="globe";for(const M of m)M.projMatrix=this.transform.calculateProjMatrix(M.toUnwrapped()),M.expandedProjMatrix=b?this.transform.calculateProjMatrix(M.toUnwrapped(),!1,!0):M.projMatrix;return m}sortCoordinatesByDistance(s){const c=s.slice(),m=this.transform._camera.position,b=this.transform._camera.forward(),M={};for(const A of c){const D=1/(1<<A.canonical.z);M[A.key]=((A.canonical.x+.5)*D+A.wrap-m[0])*b[0]+((A.canonical.y+.5)*D-m[1])*b[1]-m[2]*b[2]}return c.sort(((A,D)=>M[A.key]-M[D.key])),c}hasTransition(){if(this._source.hasTransition())return!0;if(su(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(s,c,m){this._state.updateState(s=s||"_geojsonTileLayer",c,m)}removeFeatureState(s,c,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,m)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,m){const b=this._tiles[s];b&&b.setDependencies(c,m)}reloadTilesForDependencies(s,c){for(const m in this._tiles)this._tiles[m].hasDependency(s,c)&&this._reloadTile(+m,"reloading");this._cache.filter((m=>!m.hasDependency(s,c)))}_preloadTiles(s,c){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(s,c))};return void this._source.on("data",O)}const m=new Map,b=Array.isArray(s)?s:[s],M=this.map.painter.terrain,A=this.usedForTerrain&&M?M.getScaledDemTileSize():this._source.tileSize;for(const O of b){const V=O.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const H of V)m.set(H.key,H);this.usedForTerrain&&O.updateElevation(!1)}const D=Array.from(m.values());r.bw(D,((O,V)=>{const H=new wh(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(H,(Q=>{this._source.type==="raster-dem"&&H.dem&&this._backfillDEM(H),V(Q,H)}))}),c)}}function ed(p,s){const c=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return p.overscaledZ-s.overscaledZ||m-c||s.canonical.y-p.canonical.y||s.canonical.x-p.canonical.x}function su(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function il(p,s){const c=1<<p.z;return[p.x/c+s,(p.x+1)/c+s]}Na.maxOverzooming=10,Na.maxUnderzooming=3;class zm{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,c=!1;for(const m in this.style._mergedLayers){const b=this.style._mergedLayers[m];if(b.type==="fill-extrusion"||b.type==="building")this.layers.push({layer:b,visible:s,visibilityChanged:c});else if(b.type==="model"){const M=this.style.getLayerSource(b);M&&M.type==="batched-model"&&this.layers.push({layer:b,visible:s,visibilityChanged:c})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const m=c.layer;let b=!1;m.type==="fill-extrusion"?b=!m.isHidden(s)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?b=!m.isHidden(s)&&m.paint.get("building-opacity")>0:m.type==="model"&&(b=!m.isHidden(s)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!b&&c.visible,c.visible=b}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const b of this.layers){const M=b.layer,A=this.style.getLayerSourceCache(M);let D=1;M.type==="fill-extrusion"?D=b.visible?M.paint.get("fill-extrusion-vertical-scale"):0:M.type==="building"&&(D=b.visible?M.paint.get("building-vertical-scale"):0);let O=A?A.getTile(c):null;if(!O&&A)for(const V in A._tiles){const H=A._tiles[V];if(c.canonical.isChildOf(H.tileID.canonical)){O=H;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(M):null,tileID:O?O.tileID:c,verticalScale:D})}s.hasAnyZOffset=!1;let m=!1;for(let b=0;b<s.symbolInstances.length;b++){const M=s.symbolInstances.get(b),A=M.zOffset,D=this._getHeightAtTileOffset(c,M.tileAnchorX,M.tileAnchorY);M.zOffset=D!==Number.NEGATIVE_INFINITY?D:A,m||A===M.zOffset||(m=!0),s.hasAnyZOffset||M.zOffset===0||(s.hasAnyZOffset=!0)}m&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,m,b){let M=c,A=m;if(s.canonical.z!==b.canonical.z){const D=b.canonical,O=1/(1<<s.canonical.z-D.z);M=(c+s.canonical.x*r.al)*O-D.x*r.al|0,A=(m+s.canonical.y*r.al)*O-D.y*r.al|0}return{tileX:M,tileY:A}}_getHeightAtTileOffset(s,c,m){let b,M;for(let A=0;A<this.layers.length;++A){const D=this.layers[A].layer;if(D.type!=="fill-extrusion"&&D.type!=="building")continue;const{bucket:O,tileID:V,verticalScale:H}=this.currentBuildingBuckets[A];if(!O)continue;const{tileX:Q,tileY:K}=this._mapCoordToOverlappingTile(s,c,m,V),ee=O.getHeightAtTileCoord(Q,K);ee&&ee.height!==void 0&&(ee.hidden?b=ee.height:M=Math.max(ee.height*H,M||0))}if(M!==void 0)return M;for(let A=0;A<this.layers.length;++A){const D=this.layers[A];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:O,tileID:V}=this.currentBuildingBuckets[A];if(!O)continue;const{tileX:H,tileY:Q}=this._mapCoordToOverlappingTile(s,c,m,V),K=O.getHeightAtTileCoord(H,Q);if(K&&!K.hidden)return K.height===void 0&&b!==void 0?Math.min(K.maxHeight,b)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Sh(p,s){const c={};for(const m in p)m!=="ref"&&(c[m]=p[m]);return r.bx.forEach((m=>{m in s&&(c[m]=s[m])})),c}function nf(p){p=p.slice();const s=Object.create(null);for(let c=0;c<p.length;c++)s[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Sh(p[c],s[p[c].ref]));return p}const wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function rf(p,s,c){c.push({command:wr.addSource,args:[p,s[p]]})}function Lp(p,s,c){s.push({command:wr.removeSource,args:[p]}),c[p]=!0}function qo(p,s,c,m){Lp(p,c,m),rf(p,s,c)}function Th(p,s,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&m!=="data"&&!r.by(p[c][m],s[c][m]))return!1;for(m in s[c])if(s[c].hasOwnProperty(m)&&m!=="data"&&!r.by(p[c][m],s[c][m]))return!1;return!0}function Rc(p,s,c,m,b,M){let A;for(A in s=s||{},p=p||{})p.hasOwnProperty(A)&&(r.by(p[A],s[A])||c.push({command:M,args:[m,A,s[A],b]}));for(A in s)s.hasOwnProperty(A)&&!p.hasOwnProperty(A)&&(r.by(p[A],s[A])||c.push({command:M,args:[m,A,s[A],b]}))}function Tl(p){return p.id}function sf(p,s){return p[s.id]=s,p}function qd(p,s,c){const m=s.createTileMatrix(p,p.worldSize,c.toUnwrapped());return r.aB(new Float32Array(16),p.projMatrix,m)}function af(p,s,c){if(s.projection.name===c.projection.name)return p.projMatrix;const m=c.clone();return m.setProjection(s.projection),qd(m,s.getProjection(),p)}function Ml(p,s,c){return s.name===c.projection.name?p.projMatrix:qd(c,s,p)}class Mh{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=r.aA(s,0,1);let c=1,m=this._distances[c];const b=s*this.paddedLength+this.padding;for(;m<b&&c<this._distances.length;)m=this._distances[++c];const M=c-1,A=this._distances[M],D=m-A,O=D>0?(b-A)/D:0;return this.points[M].mult(1-O).add(this.points[c].mult(O))}}class Om{constructor(s,c,m){const b=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(c/m);for(let A=0;A<this.xCellCount*this.yCellCount;A++)b.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,m,b,M){this._forEachCell(c,m,b,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(M)}insertCircle(s,c,m,b){this._forEachCell(c-b,m-b,c+b,m+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(m),this.circles.push(b)}_insertBoxCell(s,c,m,b,M,A){this.boxCells[M].push(A)}_insertCircleCell(s,c,m,b,M,A){this.circleCells[M].push(A)}_query(s,c,m,b,M,A){if(m<0||s>this.width||b<0||c>this.height)return!M&&[];const D=[];if(s<=0&&c<=0&&this.width<=m&&this.height<=b){if(M)return!0;for(let O=0;O<this.boxKeys.length;O++)D.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const V=this.circles[3*O],H=this.circles[3*O+1],Q=this.circles[3*O+2];D.push({key:this.circleKeys[O],x1:V-Q,y1:H-Q,x2:V+Q,y2:H+Q})}return A?D.filter(A):D}return this._forEachCell(s,c,m,b,this._queryCell,D,{hitTest:M,seenUids:{box:{},circle:{}}},A),M?D.length>0:D}_queryCircle(s,c,m,b,M){const A=s-m,D=s+m,O=c-m,V=c+m;if(D<0||A>this.width||V<0||O>this.height)return!b&&[];const H=[];return this._forEachCell(A,O,D,V,this._queryCellCircle,H,{hitTest:b,circle:{x:s,y:c,radius:m},seenUids:{box:{},circle:{}}},M),b?H.length>0:H}query(s,c,m,b,M){return this._query(s,c,m,b,!1,M)}hitTest(s,c,m,b,M){return this._query(s,c,m,b,!0,M)}hitTestCircle(s,c,m,b){return this._queryCircle(s,c,m,!0,b)}_queryCell(s,c,m,b,M,A,D,O){const V=D.seenUids,H=this.boxCells[M];if(H!==null){const K=this.bboxes;for(const ee of H)if(!V.box[ee]){V.box[ee]=!0;const le=4*ee;if(s<=K[le+2]&&c<=K[le+3]&&m>=K[le+0]&&b>=K[le+1]&&(!O||O(this.boxKeys[ee]))){if(D.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[ee],x1:K[le],y1:K[le+1],x2:K[le+2],y2:K[le+3]})}}}const Q=this.circleCells[M];if(Q!==null){const K=this.circles;for(const ee of Q)if(!V.circle[ee]){V.circle[ee]=!0;const le=3*ee;if(this._circleAndRectCollide(K[le],K[le+1],K[le+2],s,c,m,b)&&(!O||O(this.circleKeys[ee]))){if(D.hitTest)return A.push(!0),!0;{const se=K[le],pe=K[le+1],de=K[le+2];A.push({key:this.circleKeys[ee],x1:se-de,y1:pe-de,x2:se+de,y2:pe+de})}}}}}_queryCellCircle(s,c,m,b,M,A,D,O){const V=D.circle,H=D.seenUids,Q=this.boxCells[M];if(Q!==null){const ee=this.bboxes;for(const le of Q)if(!H.box[le]){H.box[le]=!0;const se=4*le;if(this._circleAndRectCollide(V.x,V.y,V.radius,ee[se+0],ee[se+1],ee[se+2],ee[se+3])&&(!O||O(this.boxKeys[le])))return A.push(!0),!0}}const K=this.circleCells[M];if(K!==null){const ee=this.circles;for(const le of K)if(!H.circle[le]){H.circle[le]=!0;const se=3*le;if(this._circlesCollide(ee[se],ee[se+1],ee[se+2],V.x,V.y,V.radius)&&(!O||O(this.circleKeys[le])))return A.push(!0),!0}}}_forEachCell(s,c,m,b,M,A,D,O){const V=this._convertToXCellCoord(s),H=this._convertToYCellCoord(c),Q=this._convertToXCellCoord(m),K=this._convertToYCellCoord(b);for(let ee=V;ee<=Q;ee++)for(let le=H;le<=K;le++)if(M.call(this,s,c,m,b,this.xCellCount*le+ee,A,D,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,m,b,M,A){const D=b-s,O=M-c,V=m+A;return V*V>D*D+O*O}_circleAndRectCollide(s,c,m,b,M,A,D){const O=(A-b)/2,V=Math.abs(s-(b+O));if(V>O+m)return!1;const H=(D-M)/2,Q=Math.abs(c-(M+H));if(Q>H+m)return!1;if(V<=O||Q<=H)return!0;const K=V-O,ee=Q-H;return K*K+ee*ee<=m*m}}const Da={unknown:0,flipRequired:1,flipNotRequired:2},of=Math.tan(85*Math.PI/180);function Po(p,s,c,m,b,M,A){const D=r.bC();if(c)if(M.name==="globe"){const O=r.bD(b,s);r.aB(D,D,O)}else{const O=r.bE([],A);D[0]=O[0],D[1]=O[1],D[4]=O[2],D[5]=O[3],m||r.bB(D,D,b.angle)}else r.aB(D,b.labelPlaneMatrix,p);return D}function td(p,s,c,m,b,M,A){const D=Po(p,s,c,m,b,M,A);return M.name==="globe"&&c||(D[2]=D[6]=D[10]=D[14]=0),D}function Xd(p,s,c,m,b,M,A){if(c){if(M.name==="globe"){const D=Po(p,s,c,m,b,M,A);return r.bl(D,D),r.aB(D,p,D),D}{const D=r.bz(p),O=r.bA([]);return O[0]=A[0],O[1]=A[1],O[4]=A[2],O[5]=A[3],r.aB(D,D,O),m||r.bB(D,D,-b.angle),D}}return b.glCoordMatrix}function lc(p,s,c,m){const b=[p,s,c,1];c?r.aC(b,b,m):hn(b,b,m);const M=b[3];return b[0]/=M,b[1]/=M,b[2]/=M,b}function qr(p,s){return Math.min(.5+p/s*.5,1.5)}function Bm(p,s){const c=p[0]/p[3],m=p[1]/p[3];return c>=-s[0]&&c<=s[0]&&m>=-s[1]&&m<=s[1]}function _g(p,s,c,m,b,M,A,D,O,V,H=1){const Q=c.transform,K=m?p.textSizeData:p.iconSizeData,ee=r.bK(K,c.transform.zoom,H),le=Q.projection.name==="globe",se=[256/c.width*2+1,256/c.height*2+1],pe=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;pe.clear();let de=null;le&&(de=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const be=p.lineVertexArray,Me=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,we=c.transform.width/c.transform.height;let Ue,Pe=!1;for(let Ne=0;Ne<Me.length;Ne++){const Oe=Me.get(Ne),{numGlyphs:Le,writingMode:Ye}=Oe;if(Ye!==r.bL.vertical||Pe||Ue===r.bL.horizontal||(Pe=!0),Ue=Ye,(Oe.hidden||Ye===r.bL.vertical)&&!Pe){uc(Le,pe);continue}Pe=!1;const ct=new r.P(Oe.tileAnchorX,Oe.tileAnchorY),rt=p.elevationType==="road",_t=!!Q.elevation||rt;let{x:xt,y:St,z:Ft}=Q.projection.projectTilePoint(ct.x,ct.y,V.canonical),nt=null;if(_t){const Oi=rt?p.getElevationFeatureForText(Ne):null;nt={getElevation:O,elevation:Q.elevation,elevationFeature:Oi};const[an,Mn,lr]=O(ct,Q.elevation,Oi);xt+=an,St+=Mn,Ft+=lr}const qe=[xt,St,Ft,1];if(r.aC(qe,qe,s),!Bm(qe,se)){uc(Le,pe);continue}const yt=qe[3],pt=qr(c.transform.getCameraToCenterDistance(Q.projection),yt),Ut=r.bM(K,ee,Oe),ei=A?Ut/pt:Ut*pt,vi=lc(xt,St,Ft,b);if(vi[3]<=0){uc(Le,pe);continue}let ni={};const ti=r.an(p.layers[0].layout.get("text-max-angle")),Zi=Math.cos(ti),Si=A?null:nt,Ai=Pp(Oe,ei,!1,D,s,b,M,p.glyphOffsetArray,be,pe,de,vi,ct,ni,we,Si,Q.projection,V,A,Zi);Pe=Ai.useVertical,Si&&Ai.needsFlipping&&(ni={}),(Ai.notEnoughRoom||Pe||Ai.needsFlipping&&Pp(Oe,ei,!0,D,s,b,M,p.glyphOffsetArray,be,pe,de,vi,ct,ni,we,Si,Q.projection,V,A,Zi).notEnoughRoom)&&uc(Le,pe)}m?(p.text.dynamicLayoutVertexBuffer.updateData(pe),de&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(de)):(p.icon.dynamicLayoutVertexBuffer.updateData(pe),de&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(de))}function Nm(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe){const{lineStartIndex:de,glyphStartIndex:be,segment:Me}=D,we=be+D.numGlyphs,Ue=de+D.lineLength,Pe=s.getoffsetX(be),Ne=s.getoffsetX(we-1),Oe=Nu(p*Pe,c,m,b,M,A,Me,de,Ue,O,V,H,Q,K,!0,ee,le,se,pe);if(!Oe)return null;const Le=Nu(p*Ne,c,m,b,M,A,Me,de,Ue,O,V,H,Q,K,!0,ee,le,se,pe);return Le?{first:Oe,last:Le}:null}function Rn(p,s,c,m){return p===r.bL.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:p===r.bL.vertical?m>0?{needsFlipping:!0}:null:s!==Da.unknown&&(function(b,M){return b===0||Math.abs(M/b)>of})(c,m)?s===Da.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Pp(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de,be,Me){const we=s/24,Ue=p.lineOffsetX*we,Pe=p.lineOffsetY*we,{lineStartIndex:Ne,glyphStartIndex:Oe,numGlyphs:Le,segment:Ye,writingMode:ct,flipState:rt}=p,_t=Ne+p.lineLength,xt=St=>{if(H){const[yt,pt,Ut]=St.up,ei=V.length;r.bN(H,ei+0,yt,pt,Ut),r.bN(H,ei+1,yt,pt,Ut),r.bN(H,ei+2,yt,pt,Ut),r.bN(H,ei+3,yt,pt,Ut)}const[Ft,nt,qe]=St.point;r.bO(V,Ft,nt,qe,St.angle)};if(Le>1){const St=Nm(we,D,Ue,Pe,c,Q,K,p,O,M,ee,se,!1,pe,de,be,Me);if(!St)return{notEnoughRoom:!0};if(m&&!c){let[Ft,nt,qe]=St.first.point,[yt,pt,Ut]=St.last.point;[Ft,nt]=lc(Ft,nt,qe,A),[yt,pt]=lc(yt,pt,Ut,A);const ei=Rn(ct,rt,(yt-Ft)*le,pt-nt);if(p.flipState=ei&&ei.needsFlipping?Da.flipRequired:Da.flipNotRequired,ei)return ei}xt(St.first);for(let Ft=Oe+1;Ft<Oe+Le-1;Ft++){const nt=Nu(we*D.getoffsetX(Ft),Ue,Pe,c,Q,K,Ye,Ne,_t,O,M,ee,se,!1,!1,pe,de,be,Me);if(!nt)return V.length-=4*(Ft-Oe),{notEnoughRoom:!0};xt(nt)}xt(St.last)}else{if(m&&!c){const Ft=lc(K.x,K.y,0,b),nt=Ne+Ye+1,qe=new r.P(O.getx(nt),O.gety(nt)),yt=lc(qe.x,qe.y,0,b),pt=yt[3]>0?yt:cc(K,qe,Ft,1,b,void 0,pe,de.canonical),Ut=Rn(ct,rt,(pt[0]-Ft[0])*le,pt[1]-Ft[1]);if(p.flipState=Ut&&Ut.needsFlipping?Da.flipRequired:Da.flipNotRequired,Ut)return Ut}const St=Nu(we*D.getoffsetX(Oe),Ue,Pe,c,Q,K,Ye,Ne,_t,O,M,ee,se,!1,!1,pe,de,be,Me);if(!St)return{notEnoughRoom:!0};xt(St)}return{}}function id(p,s,c,m,b){const{x:M,y:A,z:D}=m.projectTilePoint(p.x,p.y,s);if(!b)return lc(M,A,D,c);const[O,V,H]=b.getElevation(p,b.elevation,b.elevationFeature);return lc(M+O,A+V,D+H,c)}function cc(p,s,c,m,b,M,A,D){const O=id(p.sub(s)._unit()._add(p),D,b,A,M);return r.av(O,c,O),r.aw(O,O),r.bH(O,c,O,m)}function Nu(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de,be){const Me=m?p-s:p+s;let we=Me>0?1:-1,Ue=0;m&&(we*=-1,Ue=Math.PI),we<0&&(Ue+=Math.PI);let Pe=D+A+(we>0?0:1)|0,Ne=b,Oe=b,Le=0,Ye=0;const ct=Math.abs(Me),rt=[],_t=[];let xt=M,St=xt,Ft=r.bF([]);const nt=()=>cc(St,xt,Oe,ct-Le+1,H,K,se,pe.canonical);for(;Le+Ye<=ct;){if(Pe+=we,Pe<D||Pe>=O)return null;if(Oe=Ne,St=xt,rt.push(Oe),ee&&_t.push(St),xt=new r.P(V.getx(Pe),V.gety(Pe)),Ne=Q[Pe],!Ne){const Si=id(xt,pe.canonical,H,se,K);Ne=Si[3]>0?Q[Pe]=Si:nt()}Le+=Ye;const ti=r.av([],Ne,Oe),Zi=r.bG(Oe,Ne);if(c&&Zi>0&&Ye>0&&r.bJ(Ft,ti)/(Ye*Zi)<be)return null;Ye=Zi,Ft=ti}le&&K&&(Q[Pe]&&(Ne=nt(),Ye=r.bG(Oe,Ne),Ft=r.av([],Ne,Oe)),Q[Pe]=Ne);const qe=(ct-Le)/Ye,yt=xt.sub(St)._mult(qe)._add(St),pt=r.bH([],Oe,Ft,qe);let Ut=[0,0,1],ei=Ft[0],vi=Ft[1];if(de&&(Ut=se.upVector(pe.canonical,yt.x,yt.y),Ut[0]!==0||Ut[1]!==0||Ut[2]!==1)){const ti=[Ut[2],0,-Ut[0]],Zi=r.bI([],Ut,ti);r.aw(ti,ti),r.aw(Zi,Zi),ei=r.bJ(Ft,ti),vi=r.bJ(Ft,Zi)}if(c){const ti=r.bI([],Ut,Ft);r.aw(ti,ti),r.bH(pt,pt,ti,c*we)}const ni=Ue+Math.atan2(vi,ei);return rt.push(pt),ee&&_t.push(yt),{point:pt,angle:ni,path:rt,tilePath:_t,up:Ut}}function uc(p,s){const c=s.length,m=c+4*p;s.resize(m),s.float32.fill(-1/0,4*c,4*m)}function hn(p,s,c){const m=s[0],b=s[1];return p[0]=c[0]*m+c[4]*b+c[12],p[1]=c[1]*m+c[5]*b+c[13],p[3]=c[3]*m+c[7]*b+c[15],p}const Rr=100;class Zr{constructor(s,c,m=new Om(s.width+200,s.height+200,25),b=new Om(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=b,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Rr,this.screenBottomBoundary=s.height+Rr,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,m,b,M,A,D,O,V,H,Q){let K=m.projectedAnchorX,ee=m.projectedAnchorY,le=m.projectedAnchorZ;const se=m.tileAnchorX,pe=m.tileAnchorY,de=m.elevation,be=m.tileID,Me=s.getProjection();if(de&&be){const[_t,xt,St]=Me.upVector(be.canonical,m.tileAnchorX,m.tileAnchorY),Ft=Me.upVectorScale(be.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;K+=_t*de*Ft,ee+=xt*de*Ft,le+=St*de*Ft}const we=s.projection.name==="globe",Ue=s.projection.name==="globe"?r.aj(this.transform.zoom):0;if(be&&we&&Ue<1&&!A){const _t=1<<be.canonical.z,xt=r.bP(se,pe);r.bQ(xt,xt,1/r.al),r.bR(xt,xt,r.bP(be.canonical.x,be.canonical.y)),r.bQ(xt,xt,1/_t),r.bS(xt,xt,r.bP(b[0],b[1])),xt[0]=r.bT(xt[0],-.5,.5),r.bQ(xt,xt,r.al);const St=r.bU(xt[0],xt[1],r.al/(2*Math.PI),1);r.aC(St,St,M),K=r.ak(K,St[0],Ue),ee=r.ak(ee,St[1],Ue),le=r.ak(le,St[2],Ue)}const Pe=this.projectAndGetPerspectiveRatio(H,K,ee,le,m.tileID,Me.name==="globe"||!!de||this.transform.pitch>0,Me),Ne=V*Pe.perspectiveRatio,Oe=(m.x1*c+D.x-m.padding)*Ne+Pe.point.x,Le=(m.y1*c+D.y-m.padding)*Ne+Pe.point.y,Ye=(m.x2*c+D.x+m.padding)*Ne+Pe.point.x,ct=(m.y2*c+D.y+m.padding)*Ne+Pe.point.y,rt=Pe.perspectiveRatio<=.55||Pe.occluded;return!this.isInsideGrid(Oe,Le,Ye,ct)||!O&&this.grid.hitTest(Oe,Le,Ye,ct,Q)||rt?{box:[],offscreen:!1,occluded:Pe.occluded}:{box:[Oe,Le,Ye,ct],offscreen:this.isOffscreen(Oe,Le,Ye,ct),occluded:!1}}placeCollisionCircles(s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe){const de=[],be=this.transform.elevation,Me=s.getProjection(),we=s.elevationType==="road",Ue=!!be||we,Pe=r.bV.getAtTileOffsetFunc(pe,this.transform.center.lat,this.transform.worldSize,Me),Ne=new r.P(m.tileAnchorX,m.tileAnchorY),Oe=new r.P(m.tileAnchorX,m.tileAnchorY);let{x:Le,y:Ye,z:ct}=Me.projectTilePoint(Oe.x,Oe.y,pe.canonical),rt=null;if(Ue){const Zi=we?s.getElevationFeatureForText(b):null;rt={getElevation:Pe,elevation:be,elevationFeature:Zi};const[Si,Ai,Oi]=Pe(Ne,be,Zi);Le+=Si,Ye+=Ai,ct+=Oi}const _t=Me.name==="globe",xt=this.projectAndGetPerspectiveRatio(O,Le,Ye,ct,pe,_t||!!be||this.transform.pitch>0,Me),{perspectiveRatio:St}=xt,Ft=(K?D/St:D*St)/r.bY,nt=lc(Le,Ye,ct,V),qe=m.lineOffsetX*Ft,yt=m.lineOffsetY*Ft,pt=r.an(s.layers[0].layout.get("text-max-angle")),Ut=Math.cos(pt),ei=xt.signedDistanceFromCamera>0?Nm(Ft,A,qe,yt,we&&m.flipState===1,nt,Oe,m,M,V,{},Ue&&!K?rt:null,K&&Ue,Me,pe,K,Ut):null;let vi=!1,ni=!1,ti=!0;if(ei&&!xt.occluded){const Zi=.5*le*St+se,Si=new r.P(-100,-100),Ai=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Oi=new Mh,{first:an,last:Mn}=ei,lr=an.path.length;let Lr=[];for(let Dn=lr-1;Dn>=1;Dn--)Lr.push(an.path[Dn]);for(let Dn=1;Dn<Mn.path.length;Dn++)Lr.push(Mn.path[Dn]);const Yi=2.5*Zi;H&&(Lr=Lr.map((([Dn,er,Pr],Sr)=>(Ue&&!_t&&(Pr=Pe(Sr<lr-1?an.tilePath[lr-1-Sr]:Mn.tilePath[Sr-lr+2],be,rt.elevationFeature)[2]),lc(Dn,er,Pr,H)))),Lr.some((Dn=>Dn[3]<=0))&&(Lr=[]));let Ir=[];if(Lr.length>0){let Dn=1/0,er=-1/0,Pr=1/0,Sr=-1/0;for(const pr of Lr)Dn=Math.min(Dn,pr[0]),Pr=Math.min(Pr,pr[1]),er=Math.max(er,pr[0]),Sr=Math.max(Sr,pr[1]);er>=Si.x&&Dn<=Ai.x&&Sr>=Si.y&&Pr<=Ai.y&&(Ir=[Lr.map((pr=>new r.P(pr[0],pr[1])))],(Dn<Si.x||er>Ai.x||Pr<Si.y||Sr>Ai.y)&&(Ir=r.bW(Ir,Si.x,Si.y,Ai.x,Ai.y)))}for(const Dn of Ir){Oi.reset(Dn,.25*Zi);let er=0;er=Oi.length<=.5*Zi?1:Math.ceil(Oi.paddedLength/Yi)+1;for(let Pr=0;Pr<er;Pr++){const Sr=Pr/Math.max(er-1,1),pr=Oi.lerp(Sr),qn=pr.x+Rr,zr=pr.y+Rr;de.push(qn,zr,Zi,0);const Os=qn-Zi,us=zr-Zi,Nr=qn+Zi,rr=zr+Zi;if(ti=ti&&this.isOffscreen(Os,us,Nr,rr),ni=ni||this.isInsideGrid(Os,us,Nr,rr),!c&&this.grid.hitTestCircle(qn,zr,Zi,ee)&&(vi=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:vi,occluded:!1}}}}return{circles:!Q&&vi||!ni?[]:de,offscreen:ti,collisionDetected:vi,occluded:xt.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let m=1/0,b=1/0,M=-1/0,A=-1/0;for(const H of s){const Q=new r.P(H.x+Rr,H.y+Rr);m=Math.min(m,Q.x),b=Math.min(b,Q.y),M=Math.max(M,Q.x),A=Math.max(A,Q.y),c.push(Q)}const D=this.grid.query(m,b,M,A).concat(this.ignoredGrid.query(m,b,M,A)),O={},V={};for(const H of D){const Q=H.key;if(O[Q.bucketInstanceId]===void 0&&(O[Q.bucketInstanceId]={}),O[Q.bucketInstanceId][Q.featureIndex])continue;const K=[new r.P(H.x1,H.y1),new r.P(H.x2,H.y1),new r.P(H.x2,H.y2),new r.P(H.x1,H.y2)];r.bX(c,K)&&(O[Q.bucketInstanceId][Q.featureIndex]=!0,V[Q.bucketInstanceId]===void 0&&(V[Q.bucketInstanceId]=[]),V[Q.bucketInstanceId].push(Q.featureIndex))}return V}insertCollisionBox(s,c,m,b,M){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:M},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,m,b,M){const A=c?this.ignoredGrid:this.grid,D={bucketInstanceId:m,featureIndex:b,collisionGroupID:M};for(let O=0;O<s.length;O+=4)A.insertCircle(D,s[O],s[O+1],s[O+2])}projectAndGetPerspectiveRatio(s,c,m,b,M,A,D){const O=[c,m,b,1];let V=!1;b||this.transform.pitch>0?(r.aC(O,O,s),this.fogState&&M&&D.name!=="globe"&&(V=(function(K,ee,le,se,pe,de){const be=de.calculateFogTileMatrix(pe),Me=[ee,le,se];return r.af(Me,Me,be),it(K,r.ag(Me),de.pitch,de._fov)})(this.fogState,c,m,b,M.toUnwrapped(),this.transform)>.9)):hn(O,O,s);const H=O[3];return{point:new r.P((O[0]/H+1)/2*this.transform.width+Rr,(-O[1]/H+1)/2*this.transform.height+Rr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/H*.5,1.5),signedDistanceFromCamera:H,occluded:A&&O[2]>H||V}}isOffscreen(s,c,m,b){return m<Rr||s>=this.screenRightBoundary||b<Rr||c>this.screenBottomBoundary}isInsideGrid(s,c,m,b){return m>=0&&s<this.gridRightBoundary&&b>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=r.bA([]);return r.br(s,s,[-100,-100,0]),s}}class nl{constructor(s,c,m,b){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):b&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class zo{constructor(s,c,m,b,M,A=!1){this.text=new nl(s?s.text:null,c,m,M),this.icon=new nl(s?s.icon:null,c,b,M),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xr{constructor(s,c,m,b=!1){this.text=s,this.icon=c,this.skipFade=m,this.clipped=b}}class Fm{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class Wd{constructor(s,c,m,b,M){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=b,this.tileID=M}}class Ic{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[s]}}function ba(p,s,c,m,b){const{horizontalAlign:M,verticalAlign:A}=r.c1(p),D=-(M-.5)*s,O=-(A-.5)*c,V=r.c2(p,m);return new r.P(D+V[0]*b,O+V[1]*b)}function ca(p,s,c,m,b){const M=new r.P(p,s);return c&&M._rotate(m?b:-b),M}class yg{constructor(s,c,m,b,M,A){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Zr(this.transform,M),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ic(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(s,c,m,b,M=1){const A=m.getBucket(c),D=m.latestFeatureIndex;if(!A||!D||c.fqid!==A.layerIds[0])return;const O=A.layers[0].layout,V=A.layers[0].paint,H=m.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),K=m.tileSize/r.al,ee=m.tileID.toUnwrapped();this.transform.setProjection(A.projection);const le=(se=m.tileID,pe=A.getProjection(),de=this.transform,pe.name===this.projection?de.calculateProjMatrix(se.toUnwrapped()):qd(de,pe,se));var se,pe,de;const be=O.get("text-pitch-alignment")==="map",Me=O.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const we=c.dynamicFilter(),Ue=c.dynamicFilterNeedsFeature(),Pe=this.transform.calculatePixelsToTileUnitsMatrix(m),Ne=td(le,m.tileID.canonical,be,Me,this.transform,A.getProjection(),Pe);let Oe=null;const Le=A.getProjection().createInversionMatrix(this.transform,m.tileID.canonical);if(be){const qe=Xd(le,m.tileID.canonical,be,Me,this.transform,A.getProjection(),Pe);Oe=r.aB([],this.transform.labelPlaneMatrix,qe)}let Ye=null;we&&m.latestFeatureIndex&&(Ye={unwrappedTileID:ee,dynamicFilter:we,dynamicFilterNeedsFeature:Ue}),this.retainedQueryData[A.bucketInstanceId]=new Wd(A.bucketInstanceId,D,A.sourceLayerIndex,A.index,m.tileID);const[ct,rt]=A.layers[0].layout.get("text-size-scale-range"),_t=r.aA(M,ct,rt),[xt,St]=O.get("icon-size-scale-range"),Ft=r.aA(M,xt,St),nt={bucket:A,layout:O,paint:V,posMatrix:le,invMatrix:Le,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ne,labelToScreenMatrix:Oe,clippingData:Ye,scale:Q,textPixelRatio:K,holdingForFade:m.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:r.bK(A.textSizeData,this.transform.zoom,_t),partiallyEvaluatedIconSize:r.bK(A.iconSizeData,this.transform.zoom,Ft),collisionGroup:this.collisionGroups.get(A.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(b)for(const qe of A.sortKeyRanges){const{sortKey:yt,symbolInstanceStart:pt,symbolInstanceEnd:Ut}=qe;s.push({sortKey:yt,symbolInstanceStart:pt,symbolInstanceEnd:Ut,parameters:nt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:nt})}attemptAnchorPlacement(s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de,be,Me,we,Ue){const{textOffset0:Pe,textOffset1:Ne,crossTileID:Oe}=se,Le=[Pe,Ne],Ye=ba(s,A,D,Le,O),ct=this.collisionIndex.placeCollisionBox(de,O,c,m,b,M,ca(Ye.x,Ye.y,V,H,this.transform.angle),le,Q,K,ee.predicate);if(Me){const rt=de.getSymbolInstanceIconSize(Ue,this.transform.zoom,se.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(de,rt,Me,m,b,M,ca(Ye.x,Ye.y,V,H,this.transform.angle),le,Q,K,ee.predicate).box.length===0)return}if(ct.box.length>0){let rt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Oe]&&this.prevPlacement.placements[Oe]&&this.prevPlacement.placements[Oe].text&&(rt=this.prevPlacement.variableOffsets[Oe].anchor),this.variableOffsets[Oe]={textOffset:Le,width:A,height:D,anchor:s,textScale:O,prevAnchor:rt},this.markUsedJustification(de,s,se,be),de.allowVerticalPlacement&&(this.markUsedOrientation(de,be,se),this.placedOrientations[Oe]=be),{shift:Ye,placedGlyphBoxes:ct}}}placeLayerBucketPart(s,c,m,b,M=1){const{bucket:A,layout:D,paint:O,posMatrix:V,textLabelPlaneMatrix:H,labelToScreenMatrix:Q,clippingData:K,textPixelRatio:ee,mercatorCenter:le,invMatrix:se,holdingForFade:pe,collisionBoxArray:de,partiallyEvaluatedTextSize:be,partiallyEvaluatedIconSize:Me,collisionGroup:we,latestFeatureIndex:Ue}=s.parameters,Pe=D.get("text-optional"),Ne=D.get("icon-optional"),Oe=D.get("text-allow-overlap"),Le=D.get("icon-allow-overlap"),Ye=D.get("text-rotation-alignment")==="map",ct=D.get("icon-rotation-alignment")==="map",rt=D.get("text-pitch-alignment")==="map",_t=O.get("symbol-z-offset"),xt=D.get("symbol-elevation-reference")==="sea",St=D.get("symbol-placement"),[Ft,nt]=D.get("text-size-scale-range"),[qe,yt]=D.get("icon-size-scale-range"),pt=r.aA(M,Ft,nt),Ut=r.aA(M,qe,yt),ei=D.get("text-variable-anchor"),vi=Ye&&St!=="point",ni=ct&&St!=="point",ti=ei&&A.hasTextData(),Zi=A.hasIconTextFit()&&ti&&A.hasIconData();this.transform.setProjection(A.projection);const Si=ti||vi,Ai=ni||Zi;let Oi=Oe&&(Le||!A.hasIconData()||Ne),an=Le&&(Oe||!A.hasTextData()||Pe);const Mn=!_t.isConstant();!A.collisionArrays&&de&&A.deserializeCollisionBoxes(de),m&&b&&A.updateCollisionDebugBuffers(this.transform.zoom,de,pt,Ut);const lr=(Yi,Ir,Dn)=>{const{crossTileID:er,numVerticalGlyphVertices:Pr}=Yi;let Sr=null;if(K&&K.dynamicFilterNeedsFeature||Mn){const is=this.retainedQueryData[A.bucketInstanceId];Sr=Ue.loadFeature({featureIndex:Yi.featureIndex,bucketIndex:is.bucketIndex,sourceLayerIndex:is.sourceLayerIndex,layoutVertexArrayOffset:0});const $s=Sr.properties?Sr.properties.worldview:null;if(A.localizable&&A.worldview&&typeof $s=="string")if($s==="all")Sr.properties.$localized=!0;else{if(!$s.split(",").includes(A.worldview))return;Sr.properties.$localized=!0,Sr.properties.worldview=A.worldview}}if(K&&!(0,K.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:A.worldview},Sr,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new r.P(Yi.tileAnchorX,Yi.tileAnchorY),this.transform.calculateDistanceTileData(K.unwrappedTileID)))return this.placements[er]=new Xr(!1,!1,!1,!0),void c.add(er);const pr=_t.evaluate(Sr,{});if(c.has(er))return;if(pe)return void(this.placements[er]=new Xr(!1,!1,!1));let qn=!1,zr=!1,Os=!0,us=!1,Nr=!1,rr=null,w={box:null,offscreen:null,occluded:null},T={box:null},B=null,q=null,te=null,fe=0,We=0,vt=0;Dn.textFeatureIndex?fe=Dn.textFeatureIndex:Yi.useRuntimeCollisionCircles&&(fe=Yi.featureIndex),Dn.verticalTextFeatureIndex&&(We=Dn.verticalTextFeatureIndex);const Ht=A.elevationFeatures?A.elevationFeatures[Yi.elevationFeatureIndex]:void 0,Ri=is=>{is.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const $s=this.transform.elevation;is.elevation=xt?pr:pr+r.bV.getAtTileOffset(is.tileID,new r.P(is.tileAnchorX,is.tileAnchorY),$s,Ht),is.elevation+=Yi.zOffset},on=Dn.textBox;if(on){Ri(on);const is=Yr=>{let Kt=r.bL.horizontal;if(A.allowVerticalPlacement&&!Yr&&this.prevPlacement){const Pt=this.prevPlacement.placedOrientations[er];Pt&&(this.placedOrientations[er]=Pt,Kt=Pt,this.markUsedOrientation(A,Kt,Yi))}return Kt},$s=(Yr,Kt)=>{if(A.allowVerticalPlacement&&Pr>0&&Dn.verticalTextBox){for(const Pt of A.writingModes)if(Pt===r.bL.vertical?(w=Kt(),T=w):w=Yr(),w&&w.box&&w.box.length)break}else w=Yr()};if(ei){let Yr=ei;if(this.prevPlacement&&this.prevPlacement.variableOffsets[er]){const $t=this.prevPlacement.variableOffsets[er];Yr.indexOf($t.anchor)>0&&(Yr=Yr.filter((ln=>ln!==$t.anchor)),Yr.unshift($t.anchor))}const Kt=($t,ln,_r)=>{const Bs=A.getSymbolInstanceTextSize(be,Yi,this.transform.zoom,Ir),Hr=($t.x2-$t.x1)*Bs+2*$t.padding,As=($t.y2-$t.y1)*Bs+2*$t.padding,fa=Yi.hasIconTextFit&&!Le?ln:null;fa&&Ri(fa);let _s={box:[],offscreen:!1,occluded:!1};const ic=Oe?2*Yr.length:Yr.length;for(let Lu=0;Lu<ic;++Lu){const Of=this.attemptAnchorPlacement(Yr[Lu%Yr.length],$t,le,se,Si,Hr,As,Bs,Ye,rt,ee,V,we,Lu>=Yr.length,Yi,Ir,A,_r,fa,be,Me);if(Of&&(_s=Of.placedGlyphBoxes,_s&&_s.box&&_s.box.length)){qn=!0,rr=Of.shift;break}}return _s};$s((()=>Kt(on,Dn.iconBox,r.bL.horizontal)),(()=>{const $t=Dn.verticalTextBox;return $t&&Ri($t),A.allowVerticalPlacement&&!(w&&w.box&&w.box.length)&&Pr>0&&$t?Kt($t,Dn.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}})),w&&(qn=w.box,Os=w.offscreen,us=w.occluded);const Pt=is(!(!w||!w.box));if(!qn&&this.prevPlacement){const $t=this.prevPlacement.variableOffsets[er];$t&&(this.variableOffsets[er]=$t,this.markUsedJustification(A,$t.anchor,Yi,Pt))}}else{const Yr=(Kt,Pt)=>{const $t=A.getSymbolInstanceTextSize(be,Yi,this.transform.zoom,Ir),ln=this.collisionIndex.placeCollisionBox(A,$t,Kt,le,se,Si,new r.P(0,0),Oe,ee,V,we.predicate);return ln&&ln.box&&ln.box.length&&(this.markUsedOrientation(A,Pt,Yi),this.placedOrientations[er]=Pt),ln};$s((()=>Yr(on,r.bL.horizontal)),(()=>{const Kt=Dn.verticalTextBox;return A.allowVerticalPlacement&&Pr>0&&Kt?(Ri(Kt),Yr(Kt,r.bL.vertical)):{box:null,offscreen:null,occluded:null}})),is(!!(w&&w.box&&w.box.length))}}if(B=w,qn=B&&B.box&&B.box.length>0,Os=B&&B.offscreen,us=B&&B.occluded,Yi.useRuntimeCollisionCircles){const is=Yi.centerJustifiedTextSymbolIndex>=0?Yi.centerJustifiedTextSymbolIndex:Yi.verticalPlacedTextSymbolIndex,$s=A.text.placedSymbolArray.get(is),Yr=r.bM(A.textSizeData,be,$s),Kt=D.get("text-padding");q=this.collisionIndex.placeCollisionCircles(A,Oe,$s,is,A.lineVertexArray,A.glyphOffsetArray,Yr,V,H,Q,m,rt,we.predicate,Yi.collisionCircleDiameter*Yr/r.bY,Kt,this.retainedQueryData[A.bucketInstanceId].tileID),qn=Oe||q.circles.length>0&&!q.collisionDetected,Os=Os&&q.offscreen,us=q.occluded}if(Dn.iconFeatureIndex&&(vt=Dn.iconFeatureIndex),Dn.iconBox){const is=$s=>{Ri($s);const Yr=Yi.hasIconTextFit&&rr?ca(rr.x,rr.y,Ye,rt,this.transform.angle):new r.P(0,0),Kt=A.getSymbolInstanceIconSize(Me,this.transform.zoom,Yi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,Kt,$s,le,se,Ai,Yr,Le,ee,V,we.predicate)};T&&T.box&&T.box.length&&Dn.verticalIconBox?(te=is(Dn.verticalIconBox),zr=te.box.length>0):(te=is(Dn.iconBox),zr=te.box.length>0),Os=Os&&te.offscreen,Nr=te.occluded}const En=Pe||Yi.numHorizontalGlyphVertices===0&&Pr===0,On=Ne||Yi.numIconVertices===0;if(En||On?On?En||(zr=zr&&qn):qn=zr&&qn:zr=qn=zr&&qn,qn&&B&&B.box&&this.collisionIndex.insertCollisionBox(B.box,D.get("text-ignore-placement"),A.bucketInstanceId,T&&T.box&&We?We:fe,we.ID),zr&&te&&this.collisionIndex.insertCollisionBox(te.box,D.get("icon-ignore-placement"),A.bucketInstanceId,vt,we.ID),q&&(qn&&this.collisionIndex.insertCollisionCircles(q.circles,D.get("text-ignore-placement"),A.bucketInstanceId,fe,we.ID),m)){const is=A.bucketInstanceId;let $s=this.collisionCircleArrays[is];$s===void 0&&($s=this.collisionCircleArrays[is]=new Fm);for(let Yr=0;Yr<q.circles.length;Yr+=4)$s.circles.push(q.circles[Yr+0]),$s.circles.push(q.circles[Yr+1]),$s.circles.push(q.circles[Yr+2]),$s.circles.push(q.collisionDetected?1:0)}const br=A.projection.name!=="globe";Oi=Oi&&(br||!us),an=an&&(br||!Nr),this.placements[er]=new Xr(qn||Oi,zr||an,Os||A.justReloaded),c.add(er)},Lr=this.retainedQueryData[A.bucketInstanceId].tileID;if(A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,Lr),A.elevationType==="road"&&A.updateRoadElevation(Lr.canonical),A.updateZOffset(),A.sortFeaturesByY){const Yi=A.getSortedSymbolIndexes(this.transform.angle);for(let Ir=Yi.length-1;Ir>=0;--Ir){const Dn=Yi[Ir];lr(A.symbolInstances.get(Dn),Dn,A.collisionArrays[Dn])}A.hasAnyZOffset&&r.w(`${A.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(A.hasAnyZOffset){const Yi=A.getSortedIndexesByZOffset();for(let Ir=0;Ir<Yi.length;++Ir){const Dn=Yi[Ir];lr(A.symbolInstances.get(Dn),Dn,A.collisionArrays[Dn])}}else for(let Yi=s.symbolInstanceStart;Yi<s.symbolInstanceEnd;Yi++)lr(A.symbolInstances.get(Yi),Yi,A.collisionArrays[Yi]);if(m&&A.bucketInstanceId in this.collisionCircleArrays){const Yi=this.collisionCircleArrays[A.bucketInstanceId];r.bl(Yi.invProjMatrix,V),Yi.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(s,c,m,b){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:O,crossTileID:V}=m,H=r.c3(c),Q=b===r.bL.vertical?O:H==="left"?M:H==="center"?A:H==="right"?D:-1;M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=Q>=0&&M!==Q?0:V),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=Q>=0&&A!==Q?0:V),D>=0&&(s.text.placedSymbolArray.get(D).crossTileID=Q>=0&&D!==Q?0:V),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=Q>=0&&O!==Q?0:V)}markUsedOrientation(s,c,m){const b=c===r.bL.horizontal||c===r.bL.horizontalOnly?c:0,M=c===r.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:V}=m,H=s.text.placedSymbolArray;A>=0&&(H.get(A).placedOrientation=b),D>=0&&(H.get(D).placedOrientation=b),O>=0&&(H.get(O).placedOrientation=b),V>=0&&(H.get(V).placedOrientation=M)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const b=c?c.symbolFadeChange(s):1,M=c?c.opacities:{},A=c?c.variableOffsets:{},D=c?c.placedOrientations:{};for(const O in this.placements){const V=this.placements[O],H=M[O];H?(this.opacities[O]=new zo(H,b,V.text,V.icon,null,V.clipped),m=m||V.text!==H.text.placed||V.icon!==H.icon.placed):(this.opacities[O]=new zo(null,b,V.text,V.icon,V.skipFade,V.clipped),m=m||V.text||V.icon)}for(const O in M){const V=M[O];if(!this.opacities[O]){const H=new zo(V,b,!1,!1);H.isHidden()||(this.opacities[O]=H,m=m||V.text.placed||V.icon.placed)}}for(const O in A)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=A[O]);for(const O in D)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=D[O]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,m,b){b&&(this.lastReplacementSourceUpdateTime=b.updateTime);const M=new Set;for(const A of c){const D=A.getBucket(s);D&&A.latestFeatureIndex&&s.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,M,A,A.collisionBoxArray,m,b,A.tileID,s.scope),D.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(D,A.tileID),D.elevationType==="road"&&D.updateRoadElevation(A.tileID.canonical),D.updateZOffset())}}updateBucketOpacities(s,c,m,b,M,A,D,O){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const V=s.layers[0].layout,H=s.layers[0].paint,Q=!!s.layers[0].dynamicFilter(),K=new zo(null,0,!1,!1,!0),ee=V.get("text-allow-overlap"),le=V.get("icon-allow-overlap"),se=V.get("text-variable-anchor"),pe=V.get("text-rotation-alignment")==="map",de=V.get("text-pitch-alignment")==="map",be=H.get("symbol-z-offset"),Me=V.get("symbol-elevation-reference")==="sea",we=!be.isConstant(),Ue=new zo(null,0,ee&&(le||!s.hasIconData()||V.get("icon-optional")),le&&(ee||!s.hasTextData()||V.get("text-optional")),!0);!s.collisionArrays&&b&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(b);const Pe=(Oe,Le,Ye)=>{for(let ct=0;ct<Le/4;ct++)Oe.opacityVertexArray.emplaceBack(Ye)};let Ne=0;A&&s.updateReplacement(D,A);for(let Oe=0;Oe<s.symbolInstances.length;Oe++){const Le=s.symbolInstances.get(Oe),{numHorizontalGlyphVertices:Ye,numVerticalGlyphVertices:ct,crossTileID:rt,numIconVertices:_t,tileAnchorX:xt,tileAnchorY:St}=Le;let Ft=null;const nt=this.retainedQueryData[s.bucketInstanceId];we&&Le&&nt&&(Ft=m.latestFeatureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:nt.bucketIndex,sourceLayerIndex:nt.sourceLayerIndex,layoutVertexArrayOffset:0}));const qe=be.evaluate(Ft,{}),yt=c.has(rt);let pt=this.opacities[rt];yt?pt=K:pt||(pt=Ue,this.opacities[rt]=pt),c.add(rt);const Ut=Ye>0||ct>0,ei=_t>0,vi=this.placedOrientations[rt],ni=vi===r.bL.vertical,ti=vi===r.bL.horizontal||vi===r.bL.horizontalOnly;!Ut&&!ei||pt.isHidden()||Ne++;let Zi=!1;if((Ut||ei)&&A)for(const Si of s.activeReplacements){if(r.bZ(Si,M,r.b_.Symbol,O)||Si.min.x>xt||xt>Si.max.x||Si.min.y>St||St>Si.max.y)continue;const Ai=r.b$(xt,St,D.canonical,Si.footprintTileId.canonical);if(Zi=r.c0(Ai,Si.footprint),Zi)break}if(Ut){const Si=Zi?Uu:Fa(pt.text);Pe(s.text,Ye,ni?Uu:Si),Pe(s.text,ct,ti?Uu:Si);const Ai=pt.text.isHidden(),{leftJustifiedTextSymbolIndex:Oi,centerJustifiedTextSymbolIndex:an,rightJustifiedTextSymbolIndex:Mn,verticalPlacedTextSymbolIndex:lr}=Le,Lr=s.text.placedSymbolArray,Yi=Ai||ni?1:0;Oi>=0&&(Lr.get(Oi).hidden=Yi),an>=0&&(Lr.get(an).hidden=Yi),Mn>=0&&(Lr.get(Mn).hidden=Yi),lr>=0&&(Lr.get(lr).hidden=Ai||ti?1:0);const Ir=this.variableOffsets[rt];Ir&&this.markUsedJustification(s,Ir.anchor,Le,vi);const Dn=this.placedOrientations[rt];Dn&&(this.markUsedJustification(s,"left",Le,Dn),this.markUsedOrientation(s,Dn,Le))}if(ei){const Si=Zi?Uu:Fa(pt.icon),{placedIconSymbolIndex:Ai,verticalPlacedIconSymbolIndex:Oi}=Le,an=s.icon.placedSymbolArray,Mn=pt.icon.isHidden()?1:0;Ai>=0&&(Pe(s.icon,_t,ni?Uu:Si),an.get(Ai).hidden=Mn),Oi>=0&&(Pe(s.icon,Le.numVerticalIconVertices,ti?Uu:Si),an.get(Oi).hidden=Mn)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Si=s.collisionArrays[Oe];if(Si){let Ai=new r.P(0,0),Oi=!0;if(Si.textBox||Si.verticalTextBox){if(se){const Mn=this.variableOffsets[rt];Mn?(Ai=ba(Mn.anchor,Mn.width,Mn.height,Mn.textOffset,Mn.textScale),pe&&Ai._rotate(de?this.transform.angle:-this.transform.angle)):Oi=!1}Q&&(Oi=!pt.clipped),Si.textBox&&Gl(s.textCollisionBox.collisionVertexArray,pt.text.placed,!Oi||ni,qe,Me,Ai.x,Ai.y),Si.verticalTextBox&&Gl(s.textCollisionBox.collisionVertexArray,pt.text.placed,!Oi||ti,qe,Me,Ai.x,Ai.y)}const an=Oi&&!!(!ti&&Si.verticalIconBox);Si.iconBox&&Gl(s.iconCollisionBox.collisionVertexArray,pt.icon.placed,an,qe,Me,Le.hasIconTextFit?Ai.x:0,Le.hasIconTextFit?Ai.y:0),Si.verticalIconBox&&Gl(s.iconCollisionBox.collisionVertexArray,pt.icon.placed,!an,qe,Me,Le.hasIconTextFit?Ai.x:0,Le.hasIconTextFit?Ai.y:0)}}}if(s.fullyClipped=Ne===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Oe.invProjMatrix,s.placementViewportMatrix=Oe.viewportMatrix,s.collisionCircleArray=Oe.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>s}isStale(){return this.stale}setStale(){this.stale=!0}}function Gl(p,s,c,m,b,M,A){p.emplaceBack(s?1:0,c?1:0,M||0,A||0,m,b?1:0),p.emplaceBack(s?1:0,c?1:0,M||0,A||0,m,b?1:0),p.emplaceBack(s?1:0,c?1:0,M||0,A||0,m,b?1:0),p.emplaceBack(s?1:0,c?1:0,M||0,A||0,m,b?1:0)}const Fu=Math.pow(2,25),au=Math.pow(2,24),uo=Math.pow(2,17),nd=Math.pow(2,16),Zd=Math.pow(2,9),xo=Math.pow(2,8),Hl=Math.pow(2,1);function Fa(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Fu+s*au+c*uo+s*nd+c*Zd+s*xo+c*Hl+s}const Uu=0;class rd{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,m,b,M,A){const D=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(D,b,s[this._currentTileIndex],this._sortAcrossTiles,A),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort(((O,V)=>O.sortKey-V.sortKey)));this._currentPartIndex<D.length;){const O=D[this._currentPartIndex];if(c.placeLayerBucketPart(O,this._seenCrossTileIDs,m,O.symbolInstanceStart===0,A),this._currentPartIndex++,M())return!0}return!1}}class Xs{constructor(s,c,m,b,M,A,D,O,V){this.placement=new yg(s,M,A,D,O,V),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,c,m,b,M){const A=r.o.now(),D=()=>{const O=r.o.now()-A;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=c[s[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&O.visibility!=="none"&&(!O.minzoom||O.minzoom<=V)&&(!O.maxzoom||O.maxzoom>V)){const H=O,Q=H.layout.get("symbol-z-elevate"),K=H.layout.get("symbol-sort-key").constantOr(1)!==void 0,ee=H.layout.get("symbol-z-order"),le=ee==="viewport-y"||ee==="auto"&&!(ee!=="viewport-y"&&K),se=H.layout.get("text-allow-overlap")||H.layout.get("icon-allow-overlap")||H.layout.get("text-ignore-placement")||H.layout.get("icon-ignore-placement"),pe=le&&se,de=this._inProgressLayer=this._inProgressLayer||new rd(H),be=r.B(O.source,O.scope);if(de.continuePlacement(Q||pe?b[be]:m[be],this.placement,this._showCollisionBoxes,O,D,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const jl=512/r.al/2;class Dc{constructor(s,c,m){this.tileID=s,this.bucketInstanceId=m,this.index=new r.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=s.canonical.x*r.al,M=s.canonical.y*r.al;for(let A=0;A<c.length;A++){const{key:D,crossTileID:O,tileAnchorX:V,tileAnchorY:H}=c.get(A),Q=Math.floor((b+V)*jl),K=Math.floor((M+H)*jl);this.index.add(Q,K),this.keys.push(D),this.crossTileIDs.push(O)}this.index.finish()}findMatches(s,c,m){const b=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),M=jl/Math.pow(2,c.canonical.z-this.tileID.canonical.z),A=c.canonical.x*r.al,D=c.canonical.y*r.al;for(let O=0;O<s.length;O++){const V=s.get(O);if(V.crossTileID)continue;const{key:H,tileAnchorX:Q,tileAnchorY:K}=V,ee=Math.floor((A+Q)*M),le=Math.floor((D+K)*M),se=this.index.range(ee-b,le-b,ee+b,le+b).sort(((pe,de)=>pe-de));for(const pe of se){const de=this.crossTileIDs[pe];if(this.keys[pe]===H&&!m.has(de)){m.add(de),V.crossTileID=de;break}}}}}class ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class lf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const m in this.indexes){const b=this.indexes[m],M={};for(const A in b){const D=b[A];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+c),M[D.tileID.key]=D}this.indexes[m]=M}this.lng=s}addBucket(s,c,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let M=0;M<c.symbolInstances.length;M++)c.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const b=this.usedCrossTileIDs[s.overscaledZ];for(const M in this.indexes){const A=this.indexes[M];if(Number(M)>s.overscaledZ)for(const D in A){const O=A[D];O.tileID.isChildOf(s)&&O.findMatches(c.symbolInstances,s,b)}else{const D=A[s.scaledTo(Number(M)).key];D&&D.findMatches(c.symbolInstances,s,b)}}for(let M=0;M<c.symbolInstances.length;M++){const A=c.symbolInstances.get(M);A.crossTileID||(A.crossTileID=m.generate(),b.add(A.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Dc(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let c=!1;for(const m in this.indexes){const b=this.indexes[m];for(const M in b)s[b[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,b[M]),delete b[M],c=!0)}return c}}class hc{constructor(){this.layerIndexes={},this.crossTileIDs=new ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,m,b){let M=this.layerIndexes[s.fqid];M===void 0&&(M=this.layerIndexes[s.fqid]=new lf);let A=!1;const D={};b.name!=="globe"&&M.handleWrapJump(m);for(const O of c){const V=O.getBucket(s);V&&s.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(O.tileID,V,this.crossTileIDs)&&(A=!0),D[V.bucketInstanceId]=!0)}return M.removeStaleBuckets(D)&&(A=!0),A}pruneUnusedLayers(s){const c={};s.forEach((m=>{c[m]=!0}));for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const El=771;class $n{constructor(s,c,m,b){this.blendFunction=s,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=b}}$n.Replace=[1,0,1,0],$n.disabled=new $n($n.Replace,r.ao.transparent,[!1,!1,!1,!1]),$n.unblended=new $n($n.Replace,r.ao.transparent,[!0,!0,!0,!0]),$n.alphaBlended=new $n([1,El,1,El],r.ao.transparent,[!0,!0,!0,!0]),$n.alphaBlendedNonPremultiplied=new $n([770,El,770,El],r.ao.transparent,[!0,!0,!0,!0]),$n.multiply=new $n([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),$n.additive=new $n([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class sn{constructor(s,c,m){this.func=s,this.mask=c,this.range=m}}sn.ReadOnly=!1,sn.ReadWrite=!0,sn.disabled=new sn(519,sn.ReadOnly,[0,1]);const ku=7680;class fn{constructor(s,c,m,b,M,A){this.test=s,this.ref=c,this.mask=m,this.fail=b,this.depthFail=M,this.pass=A}}fn.disabled=new fn({func:519,mask:0},0,0,ku,ku,ku);const sd=1029,zp=2305;class zn{constructor(s,c,m){this.enable=s,this.mode=c,this.frontFace=m}}function ql(p,s){const c=r.ca(p,3);r.cc(p,s),r.cg(p,3,c)}function Vu(p,s){const c=r.c7([]);return r.c8(c,c,-s),r.c9(c,c,-p),c}function Op(p,s){const c=[p[0],p[1],0],m=[s[0],s[1],0];if(r.ag(c)>=1e-15){const A=r.aw([],c);r.c5(m,A,r.bJ(m,A)),s[0]=m[0],s[1]=m[1]}const b=r.bI([],s,p);if(r.c6(b)<1e-15)return null;const M=Math.atan2(-b[1],b[0]);return Vu(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),M)}zn.disabled=new zn(!1,sd,zp),zn.backCCW=new zn(!0,sd,zp),zn.backCW=new zn(!0,sd,2304),zn.frontCW=new zn(!0,1028,2304),zn.frontCCW=new zn(!0,1028,zp);class Xo{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof r.ae?s:new r.ae(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=r.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c,m){if(this.orientation=null,!this.position)return;const b=this.position,M=m||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(s)):0),A=r.ae.fromLngLat(s,M),D=[A.x-b.x,A.y-b.y,A.z-b.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Op(D,c)}setPitchBearing(s,c){this.orientation=Vu(r.an(s),r.an(-c))}}class Gu{constructor(s,c){this._transform=r.bA([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new r.ae(s[0],s[1],s[2])}get position(){const s=r.ca(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&r.cg(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||r.c7([]),s&&ql(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=Vu(s,c),ql(this._transform,this._orientation)}forward(){const s=r.ca(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=r.ca(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=r.ca(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const m=new Float64Array(16);return r.bl(m,this.getWorldToCamera(s,c)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,m){const b=this.position;r.c5(b,b,-s);const M=new Float64Array(16);return r.bq(M,[m,m,m]),r.br(M,M,b),M[10]*=c,M}getWorldToCamera(s,c){const m=new Float64Array(16),b=new Float64Array(4),M=this.position;return r.cb(b,this._orientation),r.c5(M,M,-s),r.cc(m,b),r.br(m,m,M),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(s,c,m,b){const M=new Float64Array(16);return r.cd(M,s,c,m,b),M}getCameraToClipOrthographic(s,c,m,b,M,A){const D=new Float64Array(16);return r.ce(D,s,c,m,b,M,A),D}getDistanceToElevation(s,c=!1){const m=s===0?0:r.cf(s,c?r.a$(this.position[1]):this.position[1]),b=this.forward();return(m-this.position[2])/b[2]}clone(){return new Gu([...this.position],[...this.orientation])}}const ts={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Eh{constructor(s=0,c=0,m=0,b=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=m,this.right=b}interpolate(s,c,m){return c.top!=null&&s.top!=null&&(this.top=r.ak(s.top,c.top,m)),c.bottom!=null&&s.bottom!=null&&(this.bottom=r.ak(s.bottom,c.bottom,m)),c.left!=null&&s.left!=null&&(this.left=r.ak(s.left,c.left,m)),c.right!=null&&s.right!=null&&(this.right=r.ak(s.right,c.right,m)),this}getCenter(s,c){const m=r.aA((this.left+s-this.right)/2,0,s),b=r.aA((this.top+c-this.bottom)/2,0,c);return new r.P(m,b)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Eh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const fc=15;class Bp{constructor(s,c,m,b,M,A,D){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=b??60,this.setProjection(A),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new r.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Eh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Gu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new Bp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<fc}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=r.cm(this.projectionOptions);const m=this.getProjection(),b=!r.by(c,m);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cm({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=r.cn(),r.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=r.aA(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=r.an(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let b=0,M=0;for(let A=0;A<c.length;A++){const D=new r.P(c[A][0]*this.width,m+c[A][1]*(this.height-m)),O=s.pointCoordinate(D);if(!O)continue;const V=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);b+=O[3]*V,M+=V}return M===0?NaN:b/M}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,b=this._mercatorZfromZoom(s),M=this._mercatorZfromZoom(this._maxZoom),A=Math.max(b-m,M);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}equals(s){const c=this.elevation,m=s.elevation,b=c!=null!=(m!=null)||c&&m&&c.exaggeration()!==m.exaggeration();return this.width===s.width&&this.height===s.height&&this.center.lng===s.center.lng&&this.center.lat===s.center.lat&&this.zoom===s.zoom&&this.bearing===s.bearing&&this.pitch===s.pitch&&this.fov===s.fov&&this.projection.name===s.projection.name&&this._edgeInsets.equals(s.padding)&&!b}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const b=r.ag(r.av([],this._camera.position,m));return r.aA(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!r.cp(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];r.cq(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new Xo;return c.position=new r.ae(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!r.cr(s))return!1;r.cs(s,s);const c=r.ct([],[0,0,-1],s),m=r.ct([],[0,-1,0],s);if(m[2]<0)return!1;const b=Op(c,m);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;s[2]=r.aA(s[2],b/m,b/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,m){this._unmodified=!1,this._edgeInsets.interpolate(s,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new r.cu(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new r.P(0,0)),b=this.pointCoordinate(new r.P(this.width,0)),M=this.pointCoordinate(new r.P(this.width,this.height)),A=this.pointCoordinate(new r.P(0,this.height)),D=Math.floor(Math.min(m.x,b.x,M.x,A.x)),O=Math.floor(Math.max(m.x,b.x,M.x,A.x)),V=1;for(let H=D-V;H<=O+V;H++)H!==0&&c.push(new r.cu(H,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,m,b){let M=[];const A=m!=null,D=!A;if(D&&this.zoom<c||A&&m[0]===0&&m[1]===0)return M;const O=new Set,V=(Q,K,ee,le,se)=>{const pe=r.cY(K,Q,ee,le,se);O.has(pe)||(M.push(new r.aQ(Q,K,ee,le,se)),O.add(pe))};for(let Q=0;Q<s.length;Q++){const K=s[Q];if(D&&K.canonical.z!==c||A&&b!==void 0&&b>K.canonical.z)continue;const ee=K.canonical,le=K.overscaledZ,se=K.wrap,pe=1<<ee.z,de=ee.x+1<pe,be=ee.x>0,Me=ee.y+1<pe,we=ee.y>0,Ue=K.wrap-(be?0:1),Pe=K.wrap+(de?0:1),Ne=be?ee.x-1:pe-1,Oe=de?ee.x+1:0;if(A)m[0]<0?(V(le,Pe,ee.z,Oe,ee.y),m[1]<0&&Me&&(V(le,se,ee.z,ee.x,ee.y+1),V(le,Pe,ee.z,Oe,ee.y+1)),m[1]>0&&we&&(V(le,se,ee.z,ee.x,ee.y-1),V(le,Pe,ee.z,Oe,ee.y-1))):m[0]>0?(V(le,Ue,ee.z,Ne,ee.y),m[1]<0&&Me&&(V(le,se,ee.z,ee.x,ee.y+1),V(le,Ue,ee.z,Ne,ee.y+1)),m[1]>0&&we&&(V(le,se,ee.z,ee.x,ee.y-1),V(le,Ue,ee.z,Ne,ee.y-1))):m[1]<0&&Me?V(le,se,ee.z,ee.x,ee.y+1):we&&V(le,se,ee.z,ee.x,ee.y-1);else{const Le=K.visibleQuadrants;1&Le&&(V(le,Ue,ee.z,Ne,ee.y),we&&(V(le,se,ee.z,ee.x,ee.y-1),V(le,Ue,ee.z,Ne,ee.y-1))),2&Le&&(V(le,Pe,ee.z,Oe,ee.y),we&&(V(le,se,ee.z,ee.x,ee.y-1),V(le,Pe,ee.z,Oe,ee.y-1))),4&Le&&(V(le,Ue,ee.z,Ne,ee.y),Me&&(V(le,se,ee.z,ee.x,ee.y+1),V(le,Ue,ee.z,Ne,ee.y+1))),8&Le&&(V(le,Pe,ee.z,Oe,ee.y),Me&&(V(le,se,ee.z,ee.x,ee.y+1),V(le,Pe,ee.z,Oe,ee.y+1)))}}const H=[];for(const Q of M)M.some((K=>Q.isChildOf(K)))||H.push(Q);if(M=H.filter((Q=>!s.some((K=>!!(Q.overscaledZ<c&&K.isChildOf(Q))||Q.equals(K)||Q.isChildOf(K))))),D){const Q=1<<c,K=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=[Q*K.x,Q*K.y],le=4,se=le*le;M=M.filter((pe=>{const de=pe.canonical.x+.5-ee[0],be=pe.canonical.y+.5-ee[1];return de*de+be*be<se}))}return M}extendTileCoverToNearPlane(s,c,m){const b=[],M=new Set;for(const be of s)M.add(be.key);const A=(be,Me,we,Ue,Pe)=>{const Ne=r.cY(Me,be,we,Ue,Pe);M.has(Ne)||(b.push(new r.aQ(be,Me,we,Ue,Pe)),M.add(Ne))},D=s.reduce(((be,Me)=>Math.max(be,Me.overscaledZ)),m),O=1<<m,V=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],H=new r.P(0,0),Q=new r.P(0,0),K=(be,Me)=>{const we=Math.floor(be[0]),Ue=Math.floor(be[1]),Pe=(be[0]-we)*r.al,Ne=(be[1]-Ue)*r.al,Oe=Math.floor(Me[0]),Le=Math.floor(Me[1]),Ye=(Me[0]-Oe)*r.al,ct=(Me[1]-Le)*r.al;for(let rt=-1;rt<=1;rt++){const _t=we+rt;if(!(_t<0||_t>=O)){H.x=Pe-rt*r.al,Q.x=Ye-(_t-Oe)*r.al;for(let xt=-1;xt<=1;xt++){const St=Ue+xt;H.y=Ne-xt*r.al,Q.y=ct-(St-Le)*r.al,r.cZ(H,Q,V)&&A(D,0,m,_t,St)}}}},ee=c.points,le=ee[r.cv],se=ee[r.cw],pe=this._projectToGround(le,ee[r.cx]),de=this._projectToGround(se,ee[r.cy]);return K(le,pe),K(se,de),b}_projectToGround(s,c){return r.cz(r.cA(),s,c,s[2]/(s[2]-c[2]))}coveringTiles(s){let c=this.coveringZoomLevel(s);const m=c,b=this.elevation&&this.elevation.exaggeration(),M=b&&!s.isTerrainDEM,A=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const D=this.locationCoordinate(this.center),O=this.center.lat,V=1<<c,H=[V*D.x,V*D.y,0],Q=this.projection.name==="globe",K=!Q,ee=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,K),le=Q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),se=V*r.cf(1,this.center.lat),pe=this._camera.position[2]/r.cf(1,this.center.lat),de=[V*le.x,V*le.y,pe*(K?1:se)],be=Q||b,Me=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),we=this.isLODDisabled(!0)?c:0;let Ue;if(this._elevation&&s.isTerrainDEM)Ue=1e4*this._elevation.exaggeration();else if(this._elevation){const qe=this._elevation.getMinMaxForVisibleTiles();Ue=qe?qe.max:this._centerAltitude}else Ue=this._centerAltitude;const Pe=s.isTerrainDEM?-Ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ne=this.projection.isReprojectedInTileSpace?r.cC(this):1,Oe=qe=>{const pt=new r.ae(qe.x+25e-6,qe.y,qe.z),Ut=new r.ae(qe.x,qe.y+25e-6,qe.z),ei=qe.toLngLat(),vi=pt.toLngLat(),ni=Ut.toLngLat(),ti=this.locationCoordinate(ei),Zi=this.locationCoordinate(vi),Si=this.locationCoordinate(ni),Ai=Math.hypot(Zi.x-ti.x,Zi.y-ti.y),Oi=Math.hypot(Si.x-ti.x,Si.y-ti.y);return Math.sqrt(Ai*Oi)*Ne/25e-6},Le=qe=>{const yt=Ue,pt=Pe;return{aabb:r.cF(this,V,0,0,0,qe,pt,yt,this.projection),zoom:0,x:0,y:0,minZ:pt,maxZ:yt,wrap:qe,fullyVisible:!1}},Ye=[];let ct=[];const rt=c,_t=s.reparseOverscaled?m:c,xt=(pe-this._centerAltitude)*se,St=qe=>{if(!this._elevation||!qe.tileID||!A)return;const yt=this._elevation.getMinMaxForTile(qe.tileID),pt=qe.aabb;yt?(pt.min[2]=yt.min,pt.max[2]=yt.max,pt.center[2]=(pt.min[2]+pt.max[2])/2):(qe.shouldSplit=nt(qe),qe.shouldSplit||(pt.min[2]=pt.max[2]=pt.center[2]=this._centerAltitude))},Ft=(qe,yt)=>{if(.707*yt<qe)return 1;const pt=yt/qe;return pt/(1.4144271570014144+(Math.pow(1.1,pt-1.4144271570014144+1)-1)/(1.1-1)-1)},nt=qe=>{if(qe.zoom<we)return!0;if(qe.zoom===rt)return!1;if(qe.shouldSplit!=null)return qe.shouldSplit;const yt=qe.aabb.distanceX(de),pt=qe.aabb.distanceY(de);let Ut=xt,ei=1;if(Q){Ut=qe.aabb.distanceZ(de);const Oi=Math.pow(2,qe.zoom),an=r.a$((qe.y+1)/Oi),Mn=r.a$(qe.y/Oi),lr=Math.min(Math.max(O,an),Mn),Lr=r.d1(lr)/r.d1(O);if(ei=lr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Lr/this._mercatorScaleRatio),this.zoom<=r.c_&&qe.zoom===rt-1&&Lr>=.9)return!0}else if(M&&(Ut=qe.aabb.distanceZ(de)*se),this.projection.isReprojectedInTileSpace&&m<=5){const Oi=Math.pow(2,qe.zoom),an=Oe(new r.ae((qe.x+.5)/Oi,(qe.y+.5)/Oi));ei=an>.85?1:an}if(!A&&!Q){const Oi=Math.sqrt(yt*yt+pt*pt+Ut*Ut);let an=(1<<rt-qe.zoom)*Me*ei;return an*=Ft(Math.max(Ut,xt),Oi),Oi<an}let vi=Number.MAX_VALUE,ni=0;const ti=qe.aabb.getCorners(),Zi=[];for(const Oi of ti){r.av(Zi,Oi,de),Q||(M?Zi[2]*=se:Zi[2]=xt);const an=r.bJ(Zi,this._camera.forward());an<vi&&(vi=an,ni=Math.abs(Zi[2]))}let Si=(1<<rt-qe.zoom)*Me*ei;if(Si*=Ft(Math.max(ni,xt),vi),vi<Si)return!0;const Ai=qe.aabb.closestPoint(H);return Ai[0]===H[0]&&Ai[1]===H[1]};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)Ye.push(Le(-qe)),Ye.push(Le(qe));for(Ye.push(Le(0));Ye.length>0;){const qe=Ye.pop(),yt=qe.x,pt=qe.y;let Ut=qe.fullyVisible;const ei=()=>this.projection.name==="globe"&&(qe.y===0||qe.y===(1<<qe.zoom)-1);if(!Ut){let vi=be?qe.aabb.intersects(ee):qe.aabb.intersectsFlat(ee);if(vi===0&&ei()){const ni=new r.cD(qe.zoom,yt,pt);vi=r.cE(this,V,ni,!0).intersects(ee)}if(vi===0)continue;Ut=vi===2}if(qe.zoom!==rt&&nt(qe))for(let vi=0;vi<4;vi++){const ni=(yt<<1)+vi%2,ti=(pt<<1)+(vi>>1),Zi={aabb:A?qe.aabb.quadrant(vi):r.cF(this,V,qe.zoom+1,ni,ti,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:ni,y:ti,wrap:qe.wrap,fullyVisible:Ut,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};M&&!Q&&(Zi.tileID=new r.aQ(qe.zoom+1===rt?_t:qe.zoom+1,qe.wrap,qe.zoom+1,ni,ti),St(Zi)),Ye.push(Zi)}else{const vi=qe.zoom===rt?_t:qe.zoom;if(s.minzoom&&s.minzoom>vi)continue;let ni=0;if(!Ut){let Ai=be?qe.aabb.intersectsPrecise(ee):qe.aabb.intersectsPreciseFlat(ee);if(Ai===0&&ei()){const Oi=new r.cD(qe.zoom,yt,pt);Ai=r.cE(this,V,Oi,!0).intersectsPrecise(ee)}if(Ai===0)continue;if(s.calculateQuadrantVisibility)if(ee.containsPoint(qe.aabb.center))ni=15;else for(let Oi=0;Oi<4;Oi++)qe.aabb.quadrant(Oi).intersects(ee)!==0&&(ni|=1<<Oi)}const ti=H[0]-(.5+yt+(qe.wrap<<qe.zoom))*(1<<c-qe.zoom),Zi=H[1]-.5-pt,Si=qe.tileID?qe.tileID:new r.aQ(vi,qe.wrap,qe.zoom,yt,pt);s.calculateQuadrantVisibility&&(Si.visibleQuadrants=ni),ct.push({tileID:Si,distanceSq:ti*ti+Zi*Zi})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,yt=this.horizonLineFromTop();ct=ct.filter((pt=>{const Ut=[0,0,0,1],ei=[r.al,r.al,0,1],vi=this.calculateFogTileMatrix(pt.tileID.toUnwrapped());r.aC(Ut,Ut,vi),r.aC(ei,ei,vi);const ni=r.cG([],Ut,ei),ti=r.cH([],Ut,ei),Zi=r.c$(ni,ti);if(Zi===0)return!0;let Si=!1;const Ai=this._elevation;if(Ai&&Zi>qe&&yt!==0){const Oi=this.calculateProjMatrix(pt.tileID.toUnwrapped());let an;s.isTerrainDEM||(an=Ai.getMinMaxForTile(pt.tileID)),an||(an={min:Pe,max:Ue});const Mn=r.cI(this.rotation),lr=[Mn[0]*r.al,Mn[1]*r.al,an.max];r.af(lr,lr,Oi),Si=(1-lr[1])*this.height*.5<yt}return Zi<qe||Si}))}return ct.sort(((qe,yt)=>qe.distanceSq-yt.distanceSq)).map((qe=>qe.tileID))}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log2(s)}project(s){const c=r.aA(s.lat,-r.cJ,r.cJ),m=this.projection.project(s.lng,c);return new r.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let m,b;const M=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;m=(c.x-M.x)/D,b=(c.y-M.y)/D}else{const D=this.pointCoordinate(c),O=this.pointCoordinate(M);m=D.x-O.x,b=D.y-O.y}const A=this.locationCoordinate(s);this.setLocation(new r.ae(A.x-m,A.y-b))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,c){return this.projection.locationPoint(this,s,c)}locationPoint3D(s,c){return this.projection.locationPoint(this,s,c,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,c){return this.coordinateLocation(this.pointCoordinate3D(s,c))}locationCoordinate(s,c){const m=c?r.cf(c,s.lat):void 0,b=this.projection.project(s.lng,s.lat);return new r.ae(b.x,b.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const m=c??this._centerAltitude,b=[s.x,s.y,0,1],M=[s.x,s.y,1,1];r.aC(b,b,this.pixelMatrixInverse),r.aC(M,M,this.pixelMatrixInverse);const A=M[3];r.cK(b,b,1/b[3]),r.cK(M,M,1/A);const D=b[2],O=M[2];return{p0:b,p1:M,t:D===O?0:(m-D)/(O-D)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return r.aC(c,c,this.pixelMatrixInverse),r.aC(m,m,this.pixelMatrixInverse),r.cK(c,c,1/c[3]),r.cK(m,m,1/m[3]),c[2]=r.cf(c[2],this._center.lat)*this.worldSize,m[2]=r.cf(m[2],this._center.lat)*this.worldSize,r.cK(c,c,1/this.worldSize),r.cK(m,m,1/this.worldSize),new r.ax([c[0],c[1],c[2]],r.aw([],r.av([],m,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:m,t:b}=s,M=r.cf(c[2],this._center.lat),A=r.cf(m[2],this._center.lat);return new r.ae(r.ak(c[0],m[0],b)/this.worldSize,r.ak(c[1],m[1],b)/this.worldSize,r.ak(M,A,b))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s,c){if(!this.elevation)return this.pointCoordinate(s,c);let m=this.projection.pointCoordinate3D(this,s.x,s.y);if(m)return new r.ae(m[0],m[1],m[2]);let b=0,M=this.horizonLineFromTop();if(s.y>M)return this.pointCoordinate(s,c);const A=.02*M,D=s.clone();for(let O=0;O<10&&M-b>A;O++){D.y=r.ak(b,M,.66);const V=this.projection.pointCoordinate3D(this,D.x,D.y);V?(M=D.y,m=V):b=D.y}return m?new r.ae(m[0],m[1],m[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=r.cL)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,b=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return r.aC(b,b,this.pixelMatrix),b[3]>0?new r.P(b[0]/b[3],b[1]/b[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,M=this.pointLocation3D(new r.P(c,s)),A=this.pointLocation3D(new r.P(b,s)),D=this.pointLocation3D(new r.P(b,m)),O=this.pointLocation3D(new r.P(c,m));let V=Math.min(M.lng,A.lng,D.lng,O.lng),H=Math.max(M.lng,A.lng,D.lng,O.lng),Q=Math.min(M.lat,A.lat,D.lat,O.lat),K=Math.max(M.lat,A.lat,D.lat,O.lat);const ee=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,se=(pe,de,be,Me,we)=>{const Ue=(pe+be)/2,Pe=(de+Me)/2,Ne=new r.P(Ue,Pe),{lng:Oe,lat:Le}=this.pointLocation3D(Ne),Ye=Math.max(0,V-Oe,Q-Le,Oe-H,Le-K);V=Math.min(V,Oe),H=Math.max(H,Oe),Q=Math.min(Q,Le),K=Math.max(K,Le),(we<le||Ye>ee)&&(se(pe,de,Ue,Pe,we+1),se(Ue,Pe,be,Me,we+1))};if(se(c,s,b,s,1),se(b,s,b,m,1),se(b,m,c,m,1),se(c,m,c,s,1),this.projection.name==="globe"){const[pe,de]=r.cM(this);pe?(K=90,H=180,V=-180):de&&(Q=-90,H=180,V=-180)}return new r.aI(new r.aT(V,Q),new r.aT(H,K))}_getBoundsRectangular(s,c){const{top:m,left:b}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,D=new r.P(b,m),O=new r.P(A,m),V=new r.P(A,M),H=new r.P(b,M);let Q=this.pointCoordinate(D,s),K=this.pointCoordinate(O,s);const ee=this.pointCoordinate(V,c),le=this.pointCoordinate(H,c),se=(pe,de)=>(de.y-pe.y)/(de.x-pe.x);return Q.y>1&&K.y>=0?Q=new r.ae((1-le.y)/se(le,Q)+le.x,1):Q.y<0&&K.y<=1&&(Q=new r.ae(-le.y/se(le,Q)+le.x,0)),K.y>1&&Q.y>=0?K=new r.ae((1-ee.y)/se(ee,K)+ee.x,1):K.y<0&&Q.y<=1&&(K=new r.ae(-ee.y/se(ee,K)+ee.x,0)),new r.aI().extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce(((m,b)=>{if(b.dem){const M=b.dem.tree;m.min=Math.min(m.min,M.minimums[0]),m.max=Math.max(m.max,M.maximums[0])}return m}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-r.cJ,this.maxLat=r.cJ,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,m=this._distanceTileDataCache;if(m[c])return m[c];const b=s.canonical,M=1/this.height,A=this.cameraWorldSize,D=A/this.zoomScale(b.z),O=(b.x+Math.pow(2,b.z)*s.wrap)*D,V=b.y*D,H=this.point;H.x*=A/this.worldSize,H.y*=A/this.worldSize;const Q=this.angle,K=Math.sin(-Q),ee=-Math.cos(-Q);return m[c]={bearing:[K,ee],center:[(H.x-O)*M,(H.y-V)*M],scale:D/r.al*M},m[c]}calculateFogTileMatrix(s){const c=s.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return r.aB(b,this.worldToFogMatrix,b),m[c]=new Float32Array(b),m[c]}calculateProjMatrix(s,c=!1,m=!1){const b=s.key;let M;if(M=m?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,M[b])return M[b];const A=this.calculatePosMatrix(s,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,r.aB(A,D,A),M[b]=new Float32Array(A),M[b]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const b=r.cN(s,this);return m[c]=b,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=r.bq([],[s,s,s]);return r.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=r.cf(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),b=this._camera.forward(),M=r.cf(1,this._center.lat);m[2]/=M,b[2]/=M,r.aw(b,b);const A=s.raycast(m,b,s.exaggeration());if(A){const D=r.bH([],m,b,A),O=new r.ae(D[0],D[1],r.cf(D[2],r.a$(D[1]))),V=(O.z+r.ag([O.x-m[0],O.y-m[1],O.z-m[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,m=r.cf(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(m),M=c.getAtPointOrZero(new r.ae(...b)),A=this.pixelsPerMeter/this.worldSize*M,D=this._minimumHeightOverTerrain(),O=b[2]-A;if(O<=D)if(O<0||s){const V=this.locationCoordinate(this._center,this._centerAltitude),H=[b[0],b[1],V.z-b[2]],Q=r.ag(H);H[2]-=(D-O)/this._pixelsPerMercatorPixel;const K=r.ag(H);if(K===0)return;r.c5(H,H,Q/K*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],V.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const K=this.center;return K.lat=r.aA(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(K.lng=r.aA(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:b}=this.point;let M=0,A=m,D=b;const O=this.width/2,V=this.height/2,H=this.worldMinY*this.scale,Q=this.worldMaxY*this.scale;if(b-V<H&&(D=H+V),b+V>Q&&(D=Q-V),Q-H<this.height&&(M=Math.max(M,this.height/(Q-H)),D=(Q+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,le=this.worldSize/2-(K+ee)/2;A=(m+le+this.worldSize)%this.worldSize-le,A-O<K&&(A=K+O),A+O>ee&&(A=ee-O),ee-K<this.width&&(M=Math.max(M,this.width/(ee-K)),A=(ee+K)/2)}A===m&&D===b||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(A,D))),M&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.cf(1,this.center.lat)/r.cf(1,r.d2));const b=r.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this.projection.zAxisUnit==="meters"?m:1,A=this._camera.getWorldToCamera(this.worldSize,M);let D;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-s.x/this.width,O[9]=2*s.y/this.height,this.isOrthographic){let Le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ye=Le*this.aspect,ct=-Ye,rt=-Le;Ye-=s.x,ct-=s.x,Le+=s.y,rt+=s.y,D=this._camera.getCameraToClipOrthographic(ct,Ye,rt,Le,this._nearZ,this._farZ),((_t,xt,St,Ft)=>{for(let nt=0;nt<16;nt++)_t[nt]=r.ak(xt[nt],St[nt],Ft)})(D,D,O,r.d0(this.pitch>=fc?1:this.pitch/fc))}else D=O;const V=r.cP([],O,A);let H=r.cP([],D,A);if(this.projection.isReprojectedInTileSpace){const Le=this.locationCoordinate(this.center),Ye=r.bA([]);r.br(Ye,Ye,[Le.x*this.worldSize,Le.y*this.worldSize,0]),r.aB(Ye,Ye,r.cQ(this)),r.br(Ye,Ye,[-Le.x*this.worldSize,-Le.y*this.worldSize,0]),r.aB(H,H,Ye),r.aB(V,V,Ye),this.inverseAdjustmentMatrix=r.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cS([],H,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=H,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),c){const Le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Le[8]=2*-s.x/this.width,Le[9]=2*s.y/this.height,this.expandedFarZProjMatrix=r.cP([],Le,A)}else this.expandedFarZProjMatrix=this.projMatrix;const Q=r.bl([],D);this.frustumCorners=r.cT.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const K=new Float32Array(16);r.bA(K),r.cS(K,K,[1,-1,1]),r.cU(K,K,this._pitch),r.bB(K,K,this.angle);const ee=r.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(ee);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ee[8]=2*-s.x/this.width,ee[9]=2*(s.y+le)/this.height,this.skyboxMatrix=r.aB(K,ee,K);const se=this.point,pe=se.x,de=se.y,be=this.width%2/2,Me=this.height%2/2,we=Math.cos(this.angle),Ue=Math.sin(this.angle),Pe=pe-Math.round(pe)+we*be+Ue*Me,Ne=de-Math.round(de)+we*Me+Ue*be,Oe=new Float64Array(H);if(r.br(Oe,Oe,[Pe>.5?Pe-1:Pe,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=Oe,H=r.bC(),r.cS(H,H,[this.width/2,-this.height/2,1]),r.br(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=r.bC(),r.cS(H,H,[1,-1,1]),r.br(H,H,[-1,-1,0]),r.cS(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},H=r.bl(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cV(this);const Le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(Le,Le,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,M=[s,s,c];r.c5(M,M,b),r.c5(m,m,-1),r.cW(m,m,M);const A=r.bC();r.br(A,A,m),r.cS(A,A,M),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,b)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),b=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-m[0]*M,b.y/this.worldSize-m[1]*M,s/this.worldSize*this._centerAltitude-m[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],b=s[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(M=Math.min((c-m)/b,1)),this._camera.position=r.bH([],this._camera.position,s,M),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:b}=this._camera.getPitchBearing(),M=r.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),D=Math.max((s[2]-M)/Math.cos(m),A),O=this._zoomFromMercatorZ(D);r.bH(s,s,c,D),this._pitch=r.aA(m,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(b,-Math.PI,Math.PI),this._setZoom(r.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,m=r.cL,b=0,M=1/0;for(;m-c>1e-6&&m>c;){const A=c+.5*(m-c),D=this.tileSize*Math.pow(2,A),O=this.getCameraToCenterDistance(this.projection,A,D),V=this.scaleZoom(O/(Math.max(0,s)*this.tileSize)),H=Math.abs(A-V);H<M&&(M=H,b=A),A<V?c=A:m=A}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const m=Math.min(s.x,c.x),b=Math.max(s.x,c.x),M=Math.min(s.y,c.y),A=Math.max(s.y,c.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new r.P(m,M),new r.P(b,A),new r.P(m,A),new r.P(b,M)],O=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const H of D){const Q=this.pointRayIntersection(H);if(Q.t<0)return!0;const K=this.rayIntersectionCoordinate(Q);if(K.x<O||K.y<0||K.x>V||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(s,c){const m=r.ag(r.av([],this._camera.position,s)),b=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const s=(function([c,m,b],M){const A=[c,m,b,1];r.aC(A,A,M);const D=A[3]=Math.max(A[3],1e-6);return A[0]/=D,A[1]/=D,A[2]/=D,A})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,m=this.worldSize){const b=r.cO(s,c,this.width,this.height,1024),M=s.pixelSpaceConversion(this.center.lat,m,b);let A=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(A=r.ak(1,A,r.d0(this.pitch>=fc?1:this.pitch/fc))),A}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(s,s,this.globeMatrix),s}getFrustum(s){return r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const ou=(p,s)=>{if(s>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,m=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),b=c.isLODDisabled(!1)?r.ah(60,45,c.pitch):r.ah(30,15,c.pitch),M=c._farZ-c._nearZ,A=s*c.height,D=((1-(O=b))*c.cameraToCenterDistance+O*(c._farZ+A))*m;var O;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(D-c._nearZ)/M,(D-A-c._nearZ)/M]}}},Al=2048;class Hu{constructor(s,c){this.aabb=s,this.lastCascade=c}}class r_{add(s,c){const m=this.receivers[s.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],c.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],c.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],c.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],c.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],c.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],c.max[2])):this.receivers[s.key]=new Hu(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,m){const b=r.d9.fromPoints(s.points);let M=0;for(const A in this.receivers){const D=this.receivers[A];if(!D||!b.intersectsAabb(D.aabb))continue;D.aabb.min=b.closestPoint(D.aabb.min),D.aabb.max=b.closestPoint(D.aabb.max);const O=D.aabb.getCorners();for(let V=0;V<m.length;V++){let H=!0;for(const Q of O){const K=[Q[0]*c,Q[1]*c,Q[2]];if(r.af(K,K,m[V].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){H=!1;break}}if(D.lastCascade=V,M=Math.max(M,V),H)break}}return M+1}}class lu{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new r_,this._depthMode=new sn(s.context.gl.LEQUAL,sn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const b=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||b<=0||(this._shadowLayerCount=m.style.order.reduce(((le,se)=>{const pe=m.style._mergedLayers[se];return le+(pe.hasShadowPass()&&!pe.isHidden(s.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const M=m.context,A=Al,D=Al;if(this._cascades.length===0||Al!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<2;++le){const se=m._shadowMapDebug,pe=M.gl,de=M.createFramebuffer(A,D,se?1:0,"texture"),be=new r.T(M,{width:A,height:D,data:null},pe.DEPTH_COMPONENT16);if(de.depthAttachment.set(be.texture),se){const Me=new r.T(M,{width:A,height:D,data:null},pe.RGBA8);de.colorAttachment0.set(Me.texture)}this._cascades.push({framebuffer:de,texture:be,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cB,scale:0})}}this.shadowDirection=ju(c);let O=0;if(s.elevation){const le=s.elevation,se=[1e4,-1e4];le.visibleDemTiles.filter((pe=>pe.dem)).forEach((pe=>{const de=pe.dem.tree;se[0]=Math.min(se[0],de.minimums[0]),se[1]=Math.max(se[1],de.maximums[0])})),se[0]!==1e4&&(O=(se[1]-se[0])*le.exaggeration())}const V=1.5*s.cameraToCenterDistance,H=3*V,Q=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const se=this._cascades[le];let pe=s.height/50,de=1;le===0?de=V:(pe=V,de=H);const[be,Me]=cu(s,this.shadowDirection,pe,de,Al,O);se.scale=s.scale,se.matrix=be,se.boundingSphereRadius=Me,r.bl(Q,se.matrix),se.frustum=r.cB.fromInvProjectionMatrix(Q,1,0,!0),se.far=de}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Al,this._uniformValues.u_shadowmap_0=ts.ShadowMap0,this._uniformValues.u_shadowmap_1=ts.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ee=m.transform.elevation;for(const le of this._groundShadowTiles){let se={min:0,max:0};if(ee){const pe=ee.getMinMaxForTile(le);pe&&(se=pe)}this.addShadowReceiver(le.toUnwrapped(),se.min,se.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const m=this.painter,b=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),b.viewport.set([0,0,Al,Al]);for(let M=0;M<this._numCascadesToRender;++M){m.currentShadowCascade=M,b.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),b.clear({color:r.ao.white,depth:1});for(const A of s.order){const D=s._mergedLayers[A];if(!D.hasShadowPass()||D.isHidden(m.transform.zoom))continue;const O=s.getLayerSourceCache(D),V=O?c[O.id]:void 0;(D.type==="model"||V&&V.length)&&m.renderLayer(m,O,D,V)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,m=s.context,b=m.gl,M=c.directionalLight,A=c.ambientLight;if(!M||!A)return;const D=[],O=ou(s,s.longestCutoffRange);O.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),D.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&D.push("NORMAL_OFFSET");const V=$a(c,M,A),H=new sn(b.LEQUAL,sn.ReadOnly,s.depthRangeFor3D),Q=new fn({func:b.EQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.KEEP);for(const K of this._groundShadowTiles){const ee=K.toUnwrapped(),le=s.isTileAffectedByFog(K),se=s.getOrCreateProgram("groundShadow",{defines:D,overrideFog:le});this.setupShadows(ee,se),s.uploadCommonUniforms(m,se,ee,null,O);const pe={u_matrix:s.transform.calculateProjMatrix(ee),u_ground_shadow_factor:V};se.draw(s,b.TRIANGLES,H,Q,$n.multiply,zn.disabled,pe,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?$n.unblended:$n.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,m=c.calculatePosMatrix(s,c.worldSize);return r.aB(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(s){const c=r.bz(s);return r.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,s),c}setupShadows(s,c,m){if(!this.enabled)return;const b=this.painter.transform,M=this.painter.context,A=M.gl,D=this._uniformValues,O=new Float64Array(16),V=b.calculatePosMatrix(s,b.worldSize);for(let H=0;H<this._cascades.length;H++)r.aB(O,this._cascades[H].matrix,V),D[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),M.activeTexture.set(A.TEXTURE0+ts.ShadowMap0+H),this._cascades[H].texture.bindExtraParam(A.LINEAR,A.LINEAR,A.CLAMP_TO_EDGE,A.CLAMP_TO_EDGE,A.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const H=r.d7(s.canonical),Q=2/b.tileSize*r.al/Al,K=Q*this._cascades[0].boundingSphereRadius,ee=Q*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(m==="vector-tile"?1:3)*(function(se,pe,de,be,Me){const we=r.aA((se-22)/-22,0,1);return .125*(1-we)+4*we})(b.zoom);D.u_shadow_normal_offset=[H,K*le,ee*le],D.u_shadow_bias=[1e-4,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(M,D)}setupShadowsFromMatrix(s,c,m=!1){if(!this.enabled)return;const b=this.painter.context,M=b.gl,A=this._uniformValues,D=new Float64Array(16);for(let O=0;O<2;O++)r.aB(D,this._cascades[O].matrix,s),A[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(M.TEXTURE0+ts.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(M.LINEAR,M.LINEAR,M.CLAMP_TO_EDGE,M.CLAMP_TO_EDGE,M.GREATER);this.useNormalOffset=m,m?(A.u_shadow_normal_offset=[1,3,3],A.u_shadow_bias=[6e-5,.0012,.012]):A.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(b,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,m,b){if(b[2]>=0)return{};const M=(function(O,V,H){const Q=H/(1<<O.canonical.z);return new r.d9([O.canonical.x*Q+O.wrap*H,O.canonical.y*Q+O.wrap*H,0],[(O.canonical.x+1)*Q+O.wrap*H,(O.canonical.y+1)*Q+O.wrap*H,V])})(s,c,m).getCorners(),A=c/-b[2];b[0]<0?(r.d8(M[0],M[0],[b[0]*A,0,0]),r.d8(M[3],M[3],[b[0]*A,0,0])):b[0]>0&&(r.d8(M[1],M[1],[b[0]*A,0,0]),r.d8(M[2],M[2],[b[0]*A,0,0])),b[1]<0?(r.d8(M[0],M[0],[0,b[1]*A,0]),r.d8(M[1],M[1],[0,b[1]*A,0])):b[1]>0&&(r.d8(M[2],M[2],[0,b[1]*A,0]),r.d8(M[3],M[3],[0,b[1]*A,0]));const D={};return D.vertices=M,D.planes=[cf(M[1],M[0],M[4]),cf(M[2],M[1],M[5]),cf(M[3],M[2],M[6]),cf(M[0],M[3],M[7])],D}addShadowReceiver(s,c,m){this._receivers.add(s,r.d9.fromTileIdAndHeight(s,c,m))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function cf(p,s,c){const m=r.av([],c,s),b=r.av([],p,s),M=r.bI([],m,b),A=r.ag(M);return A===0?[0,0,1,0]:(r.c5(M,M,1/A),[M[0],M[1],M[2],-r.bJ(M,s)])}function ju(p){const s=p.properties.get("direction"),c=r.d4(s.x,s.y,s.z);c[2]=r.aA(c[2],0,75);const m=r.d6([c[0],c[1],c[2]]);return r.d5(m.x,m.y,m.z)}function $a(p,s,c){const m=s.properties.get("color-use-theme")==="none",b=s.properties.get("color"),M=s.properties.get("intensity"),A=s.properties.get("direction"),D=[A.x,A.y,A.z],O=c.properties.get("color-use-theme")==="none",V=c.properties.get("color"),H=c.properties.get("intensity"),Q=Math.max(r.bJ([0,0,1],D),0),K=[0,0,0];r.c5(K,V.toPremultipliedRenderColor(O?null:p.getLut(s.scope)).toArray01Linear().slice(0,3),H);const ee=[0,0,0];return r.c5(ee,b.toPremultipliedRenderColor(m?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),Q*M),r.db([K[0]>0?K[0]/(K[0]+ee[0]):0,K[1]>0?K[1]/(K[1]+ee[1]):0,K[2]>0?K[2]/(K[2]+ee[2]):0])}function cu(p,s,c,m,b,M){const A=p.zoom,D=p.scale,O=p.worldSize,V=1/O,H=p.aspect,Q=Math.sqrt(1+H*H)*Math.tan(.5*p.fovX),K=Q*Q,ee=m-c,le=m+c;let se,pe;K>ee/le?(se=m,pe=m*Q):(se=.5*le*(1+K),pe=.5*Math.sqrt(ee*ee+2*(m*m+c*c)*K+le*le*K*K));const de=p.projection.pixelsPerMeter(p.center.lat,O),be=p._camera.getCameraToWorldMercator(),Me=[0,0,-se*V];r.af(Me,Me,be);let we=pe*V;const Ue=p._edgeInsets;if(!(Ue.left===0&&Ue.top===0&&Ue.right===0&&Ue.bottom===0||Ue.left===Ue.right&&Ue.top===Ue.bottom)){const Ut=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?de:1),ei=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,m);ei[8]=2*-p.centerOffset.x/p.width,ei[9]=2*p.centerOffset.y/p.height;const vi=new Float64Array(16);r.cP(vi,ei,Ut);const ni=new Float64Array(16);r.bl(ni,vi);const ti=r.cB.fromInvProjectionMatrix(ni,O,A,!0);for(const Zi of ti.points){const Si=((Pe=Zi)[0]/=D,Pe[1]/=D,Pe[2]=r.cf(Pe[2],p._center.lat),Pe);we=Math.max(we,r.c6(r.da([],Me,Si)))}}var Pe;we*=b/(b-1);const Ne=Math.acos(s[2]),Oe=Math.atan2(-s[0],-s[1]),Le=new Gu;Le.position=Me,Le.setPitchBearing(Ne,Oe);const Ye=Le.getWorldToCamera(O,de),ct=we*O,rt=Math.min(p._mercatorZfromZoom(17)*O*-2,-2*ct),_t=Le.getCameraToClipOrthographic(-ct,ct,-ct,ct,rt,(ct+M*de)/s[2]),xt=new Float64Array(16);r.aB(xt,_t,Ye);const St=r.d5(Math.floor(1e6*Me[0])/1e6*O,Math.floor(1e6*Me[1])/1e6*O,0),Ft=.5*b,nt=[0,0,0];r.af(nt,St,xt),r.c5(nt,nt,Ft);const qe=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],yt=[0,0,0];r.av(yt,nt,qe),r.c5(yt,yt,-1/Ft);const pt=new Float64Array(16);return r.bA(pt),r.br(pt,pt,yt),r.aB(xt,pt,xt),[xt,ct]}class uf extends r.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,c){return r.dc(this.requestManager.transformRequest(c,r.R.Model).url).then((m=>{if(!m)return;const b=r.dd(m),M=new r.de(s,c,void 0,void 0,b);return M.computeBoundsAndApplyParent(),M})).catch((m=>{if(m&&m.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${s} from ${c}: ${m.message}`)))}))}load(s,c,m={forceReload:!1}){this.models[c]||(this.models[c]={});const b=Object.keys(s),M=[],A=[];for(const D of b){const O=s[D];this.hasURLBeenRequested(O)&&!m.forceReload||(this.modelByURL[O]={modelId:D,scope:c},M.push(this.loadModel(D,O)),A.push(D)),this.models[c][D]||(this.models[c][D]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+A.length,Promise.allSettled(M).then((D=>{for(let O=0;O<D.length;O++){const{status:V}=D[O];if(V==="rejected")continue;const{value:H}=D[O];this.models[c][A[O]]||(this.models[c][A[O]]={model:null,numReferences:1}),this.models[c][A[O]].model=H}this.numModelsLoading[c]-=A.length,this.fire(new r.z("data",{dataType:"style"}))})).catch((D=>{this.fire(new r.y(new Error(`Could not load models: ${D.message}`)))}))}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(s,c):this.getModelByURL(this.modelUris[c][s]))}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}getModelByURL(s){if(!s)return null;const c=this.modelByURL[s];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(s,c){return this.models[c]&&this.models[c][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,c,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const b=this.requestManager.normalizeModelURL(c);if((this.hasModel(s,m,{exactIdMatch:!0})||this.hasModelBeenAdded(s,m))&&this.modelUris[m][s]===b)this.models[m][s].numReferences++;else if(this.hasURLBeenRequested(b)){const{scope:M,modelId:A}=this.modelByURL[b];this.models[M][A].numReferences++}else this.modelUris[m][s]=b,this.load({[s]:this.modelUris[m][s]},m)}addModelURLs(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m=this.modelUris[c];for(const b in s)m[b]=this.requestManager.normalizeModelURL(s[b])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m={};for(const b of s)this.hasModel(b,c,{exactIdMatch:!0})||this.hasURLBeenRequested(b)?this.models[c][b].numReferences++:this.modelUris[c][b]&&!this.hasURLBeenRequested(b)?m[b]=this.modelUris[c][b]:!this.hasURLBeenRequested(b)&&r.df(b,!1)&&(this.modelUris[c][b]=this.requestManager.normalizeModelURL(b),m[b]=this.modelUris[c][b]);this.load(m,c)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,c,m=!1,b=!1){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,this.models[c][s].numReferences===0||b)){const M=this.modelUris[c][s];m||delete this.modelUris[c][s],delete this.modelByURL[M];const A=this.models[c][s].model;if(!A)return;delete this.models[c][s],A.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const c of Object.keys(this.models[s])){const m=this.models[s][c].model;delete this.models[s][c],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const m in this.models[c])this.models[c][m].model&&this.models[c][m].model.upload(s.context)}}const hf=r.a6.colorTheme,Np=new r.a9({data:new r.aa(hf.data)});function rl(p){if(!p.metadata||!p.metadata.content_area)return;const s=r.o.devicePixelRatio,{left:c,top:m,width:b,height:M}=p.metadata.content_area,A=c*s,D=m*s;return[A,D,A+b*s,D+M*s]}function Ah(p){if(p)return p.map((([s,c])=>[s*r.o.devicePixelRatio,c*r.o.devicePixelRatio]))}class sl{constructor(s,c,m){this.id=s,this.scope=c,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return s;const m=this.sourceCache.getSource();if(!(m instanceof as))return s;const b=c.map((A=>this.sourceCache.getTile(A))),M=m.getImages(b,Array.from(this.pendingRequests));for(const[A,D]of M)s.set(r.I.from({name:A,iconsetId:this.id}),D),this.pendingRequests.delete(A);for(const A of this.pendingRequests)this.missingRequests.add(A);return this.pendingRequests.clear(),s}}const qu=(p,s)=>Ie(p,s&&s.filter((c=>c.identifier!=="source.canvas"))),uu=r.aH(wr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),ad=r.aH(wr,["setCenter","setZoom","setBearing","setPitch"]),hu=new Set(["background","sky","slot","custom"]),Xu={version:8,layers:[],sources:{}},ff={duration:300,delay:0};class ho extends r.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},ff),this._buildingIndex=new zm(this),this.crossTileSymbolIndex=new hc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Di,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new r.D(r.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Sn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new r.di(s._requestManager,c.localFontFamily?r.dj.all:c.localIdeographFontFamily?r.dj.ideographs:r.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new uf(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",r.dk());const m=this;this._rtlTextPluginCallback=ho.registerForPluginStateChange((b=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},((M,A)=>{if(r.dl(M),A&&A.every((D=>D)))for(const D in m._sourceCaches){const O=m._sourceCaches[D],V=O.getSource().type;V!=="vector"&&V!=="geojson"||O.reload()}}))})),this.on("data",(b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const M=this.getOwnSource(b.sourceId);if(M&&M.vectorLayerIds)for(const A in this._layers){const D=this._layers[A];D.source===M.id&&this._validateLayer(D)}}))}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(r.h(s))return s;const c=r.dm(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${r.dn(JSON.stringify(s))}`}_diffStyle(s,c,m){this.globalId=this._getGlobalId(s);const b=(M,A)=>{try{A(null,this.setState(M,m))}catch(D){A(D,!1)}};if(typeof s=="string"){const M=this.map._requestManager.normalizeStyleURL(s),A=this.map._requestManager.transformRequest(M,r.R.Style);r.m(A,((D,O)=>{D?this.fire(new r.y(D)):O&&b(O,c)}))}else typeof s=="object"&&b(s,c)}loadURL(s,c={}){this.fire(new r.z("dataloading",{dataType:"style"}));const m=typeof c.validate=="boolean"?c.validate:!r.h(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const b=this.importsCache.get(s);if(b)return this._load(b,m);const M=this.map._requestManager.transformRequest(s,r.R.Style);this._request=r.m(M,((A,D)=>{if(this._request=null,A)this.fire(new r.y(A));else if(D)return this.importsCache.set(s,D),this._load(D,m)}))}loadJSON(s,c={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=r.o.frame((()=>{this._request=null,this._load(s,c.validate!==!1)}))}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Xu,!1)}_loadImports(s,c,m){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const M of s){const A=this._createFragmentStyle(M),D=new Promise((H=>{A.once("style.import.load",H),A.once("error",H)})).then((()=>this.mergeAll()));if(b.push(D),this.resolvedImports.has(M.url)){A.loadEmpty();continue}const O=M.data||this.importsCache.get(M.url);O?(A.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(A.globalId=null)):M.url?A.loadURL(M.url,{validate:c}):A.loadEmpty();const V={style:A,id:M.id,config:M.config};if(m){const H=this.fragments.findIndex((({id:Q})=>Q===m));this.fragments=this.fragments.slice(0,H).concat(V).concat(this.fragments.slice(H))}else this.fragments.push(V)}return Promise.allSettled(b)}getImportGlobalIds(s=this,c=new Set){for(const m of s.fragments)m.style.globalId&&c.add(m.style.globalId),this.getImportGlobalIds(m.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?r.B(s.id,this.scope):s.id;let m;const b=this._initialConfig&&this._initialConfig[c];(s.config||b)&&(m=Object.assign({},s.config,b));const M=new ho(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return M.setEventedParent(this.map,{style:M}),M}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,c){if(this._isInternalStyle(s)){const M=Object.assign({},Xu,{imports:[{id:"basemap",data:s,url:""}]},s.center?{center:s.center}:{},s.bearing?{bearing:s.bearing}:{},s.pitch?{pitch:s.pitch}:{},s.zoom?{zoom:s.zoom}:{},s.light?{light:s.light}:{});return this._importedAsBasemap=!0,void this._load(M,c)}if(this.updateConfig(this._config,s.schema),c&&qu(this,ls(s)))return;this._loaded=!0,this.stylesheet=r.dp(s);const m=()=>{for(const O in s.sources)this.addSource(O,s.sources[O],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const O in s.iconsets)this.addIconset(O,s.iconsets[O]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const M=nf(this.stylesheet.layers);if(this._order=M.map((O=>O.id)),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new at(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={};for(const O of M){const V=r.du(O,this.scope,this._styleColorTheme.lut,this.options);V.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(V.fqid),V.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(V.fqid),this._hasAppearances=this._hasAppearances||V.getAppearances().length!==0,V.setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V;const H=this.getOwnLayerSourceCache(V),Q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&V.canCastShadows()&&Q&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const D=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then((()=>{this._reloadImports(),this.fire(new r.z(D?"style.load":"style.import.load"))})).catch((O=>{this.fire(new r.y(new Error("Failed to load imports",O))),this.fire(new r.z(D?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new r.z(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const M=this._evaluateColorThemeData(b);this._loadColorTheme(M).then((()=>{m()})).catch((A=>{r.w(`Couldn't load color theme from the stylesheet: ${A}`),m()}))}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((s=>s.style.hasAppearances()))}mergeAll(){let s,c,m,b,M,A,D,O,V,H;const Q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((K=>{if(K.stylesheet){if(K.light!=null&&(s=K.light),K.stylesheet.lights)for(const ee of K.stylesheet.lights)ee.type==="ambient"&&K.ambientLight!=null&&(c=K.ambientLight),ee.type==="directional"&&K.directionalLight!=null&&(m=K.directionalLight);b=this._prioritizeTerrain(b,K.terrain,K.stylesheet.terrain),K.stylesheet.fog&&K.fog!=null&&(M=K.fog),K.stylesheet.snow&&K.snow!=null&&(A=K.snow),K.stylesheet.rain&&K.rain!=null&&(D=K.rain),K.stylesheet.camera!=null&&(H=K.stylesheet.camera),K.stylesheet.projection!=null&&(O=K.stylesheet.projection),K.stylesheet.transition!=null&&(V=K.stylesheet.transition),Q[K.scope]=K._styleColorTheme}})),this.light=s,this.ambientLight=c,this.directionalLight=m,this.fog=M,this.snow=A,this.rain=D,this._styleColorThemeForScope=Q,b===null?delete this.terrain:this.terrain=b,this.camera=H||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},ff,V),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(s){const c=m=>{for(const b of m.fragments)c(b.style);s(m)};c(this)}_prioritizeTerrain(s,c,m){const b=s&&s.drapeRenderMode===0;return m===null?c&&c.drapeRenderMode===0?c:b?s:null:c!=null&&(!s||b||c&&c.drapeRenderMode===1)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)})),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle((c=>{c.stylesheet.projection!=null&&(s=c.stylesheet.projection)})),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},m={};this.forEachFragmentStyle((b=>{for(const M in b._sourceCaches){const A=r.B(M,b.scope);s[A]=b._sourceCaches[M]}for(const M in b._otherSourceCaches){const A=r.B(M,b.scope);c[A]=b._otherSourceCaches[M]}for(const M in b._symbolSourceCaches){const A=r.B(M,b.scope);m[A]=b._symbolSourceCaches[M]}})),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=m}mergeIndoor(){this.forEachFragmentStyle((s=>{if(s.stylesheet&&s.stylesheet.indoor)for(const c of Object.values(s.stylesheet.indoor)){const m=c,b=r.B(m.sourceId,s.scope);this._mergedIndoor[b]=new Set(m.sourceLayers||[])}}))}mergeLayers(){const s={},c=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((A=>{for(const D of A._order){const O=A._layers[D];if(O.type==="slot"){const V=r.dq(D);if(s[V])continue;s[V]=[]}O.slot&&s[O.slot]?s[O.slot].push(O):c.push(O)}})),this._mergedOrder=[];let b=-1;const M=(A=[])=>{for(const D of A)if(D.type==="slot"){const O=r.dq(D.id);s[O]&&M(s[O]),this._mergedSlots.push(O)}else{const O=r.B(D.id,D.scope);this._mergedOrder.push(O),m[O]=D,D.is3D(!!this.terrain)&&(this._has3DLayers=!0,b=this._mergedOrder.length-1),D.type==="circle"&&(this._hasCircleLayers=!0),D.type==="symbol"&&(this._hasSymbolLayers=!0),D.type==="clip"&&(this._clipLayerPresent=!0)}};if(M(c),this._has3DLayers){const A={};for(let D=0;D<this._mergedOrder.length;++D){const O=this._mergedOrder[D];A[O]=D===b?1:D<b?m[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((D,O)=>A[D]-A[O]))}this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?(function(c,m,b,M){const A=Object.assign({},m);for(const O of Object.keys(hf))A[O]===void 0&&(A[O]=hf[O].default);const D=new r.a8(Np,c,new Map(b));return D.setTransitionOrValue(A,b),D.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((m,b)=>{const M="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let A=s;A.startsWith(M)||(A=M+A);const D=r.I.from("mapbox-reserved-lut"),O=new Image;O.src=A,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void m();this._styleColorTheme.lutLoading=!1;const{width:V,height:H,data:Q}=r.o.getImageData(O);if(H>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==H*H)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new r.q({width:V,height:H},Q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const K=this.imageManager.getImage(D,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:s},m()):b(new Error("Missing LUT image."))}}))}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=(function(c,m,b){let M,A,D;const O=r.o.devicePixelRatio>1?"@2x":"";let V=r.m(m.transformRequest(m.normalizeSpriteURL(c,O,".json"),r.R.SpriteJSON),((K,ee)=>{V=null,D||(D=K,M=ee,Q())})),H=r.n(m.transformRequest(m.normalizeSpriteURL(c,O,".png"),r.R.SpriteImage),((K,ee)=>{H=null,D||(D=K,A=ee,Q())}));function Q(){if(D)b(D);else if(M&&A){const K=r.o.getImageData(A),ee={};for(const le in M){const{width:se,height:pe,x:de,y:be,sdf:Me,pixelRatio:we,stretchX:Ue,stretchY:Pe,content:Ne}=M[le],Oe=new r.q({width:se,height:pe});r.q.copy(K,Oe,{x:de,y:be},{x:0,y:0},{width:se,height:pe},null),ee[le]={data:Oe,pixelRatio:we!==void 0?we:1,sdf:Me!==void 0&&Me,stretchX:Ue,stretchY:Pe,content:Ne,usvg:!1,version:0}}b(null,ee)}}return{cancel(){V&&(V.cancel(),V=null),H&&(H.cancel(),H=null)}}})(s,this.map._requestManager,((c,m)=>{if(this._spriteRequest=null,c)this.fire(new r.y(c));else if(m){const b=new Map;for(const M in m)b.set(r.I.from(M),m[M]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))}))}addIconset(s,c){if(c.type==="sprite")return void this._loadSprite(c.url);const m=this.getOwnSourceCache(c.source);if(!m)return void this.fire(new r.y(new Error(`Source "${c.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const b=m.getSource();if(b.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${c.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));b.partial=!1;const M=new sl(s,this.scope,m);this.imageManager.addImageProvider(M,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!r.h(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const c=this.map._spriteFormat==="auto";var m,b;this._spriteRequest=(b=(M,A)=>{if(this._spriteRequest=null,M)c?this._loadSprite(s):this.fire(new r.y(M));else if(A){const D=new Map;for(const O in A)D.set(r.I.from(O),A[O]);this.addImages(D)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(s),r.R.Iconset),((M,A)=>{if(M)return void b(M);const D={},O=r.dg(new r.bt(A));for(const V of O.icons){const H={version:1,pixelRatio:r.o.devicePixelRatio,content:rl(V),stretchX:V.metadata?Ah(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?Ah(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};D[V.name]=H}b(null,D)})))}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const m=s.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new r.y(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((s,c)=>{const m=this.fragments[c];return m&&m.style&&(s.data=m.style.serialize()),s}))}_serializeSources(){const s={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();s[m.id]||(s[m.id]=m.serialize())}return s}_serializeLayers(s){const c=[];for(const m of s){const b=this._layers[m];b&&b.type!=="custom"&&c.push(b.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const s in this._mergedLayers){const c=this._mergedLayers[s];if(c._transitionablePaint&&c._transitionablePaint._values){const m=c._transitionablePaint._values["line-emissive-strength"];if(m&&m.value&&m.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new r.y(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new r.y(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const m=this.map.painter;if(m)for(let b=s.minzoom||0;b<(s.maxzoom||25.5);b++){const M=s.getProgramIds();if(M)for(const A of M){const D=s.getDefaultProgramParams(A,c.zoom,this._styleColorTheme.lut);D&&(m.style=this,this.fog&&(m._fogVisible=!0,D.overrideFog=!0,m.getOrCreateProgram(A,D)),m._fogVisible=!1,D.overrideFog=!1,m.getOrCreateProgram(A,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,m.getOrCreateProgram(A,D)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const D=this._changes.getLayerUpdatesByScope();for(const O in D){const{updatedIds:V,removedIds:H}=D[O];(V||H)&&(this._updateWorkerLayers(O,V,H),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const M={};for(const D in this._mergedSourceCaches){const O=this._mergedSourceCaches[D];M[D]=O.used,O.used=!1,O.tileCoverLift=0}for(const D of this._mergedOrder){const O=this._mergedLayers[D];if(O.visibility!=="none"&&O.recalculate(s,this._availableImages),!O.isHidden(s.zoom)){const V=this.getLayerSourceCache(O);V&&(V.used=!0,V.tileCoverLift=Math.max(V.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(O,s)})):this.precompilePrograms(O,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();const A=this.imageManager.getPendingImageProviders();for(const D of A)D.sourceCache.used=!0;for(const D in M){const O=this._mergedSourceCaches[D];M[D]!==O.used&&O.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const c of s){const m=c.resolvePendingRequests(),b=this.getFragmentStyle(c.scope);b&&b.addImages(m)}}_updateTilesForChangedImages(){const s={};for(const c in this._mergedSourceCaches){const m=this._mergedSourceCaches[c].getSource().scope;s[m]=s[m]||this._changes.getUpdatedImages(m),s[m].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s[m])}for(const c in s)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(s,c,m){const b=this.getFragmentStyle(s);b&&this.dispatcher.broadcast("updateLayers",{layers:c?b._serializeLayers(c):[],scope:s,removedIds:m||[],options:b.options})}setState(s,c){if(this._checkLoaded(),qu(this,ls(s)))return!1;(s=r.dp(s)).layers=nf(s.layers);const m=(function(A,D){if(!A)return[{command:wr.setStyle,args:[D]}];let O=[];try{if(!r.by(A.version,D.version))return[{command:wr.setStyle,args:[D]}];if(r.by(A.center,D.center)||O.push({command:wr.setCenter,args:[D.center]}),r.by(A.zoom,D.zoom)||O.push({command:wr.setZoom,args:[D.zoom]}),r.by(A.bearing,D.bearing)||O.push({command:wr.setBearing,args:[D.bearing]}),r.by(A.pitch,D.pitch)||O.push({command:wr.setPitch,args:[D.pitch]}),r.by(A.sprite,D.sprite)||O.push({command:wr.setSprite,args:[D.sprite]}),r.by(A.glyphs,D.glyphs)||O.push({command:wr.setGlyphs,args:[D.glyphs]}),r.by(A.imports,D.imports)||(function(ee=[],le=[],se){le=le||[];const pe=(ee=ee||[]).map(Tl),de=le.map(Tl),be=ee.reduce(sf,{}),Me=le.reduce(sf,{}),we=pe.slice();let Ue,Pe,Ne,Oe;for(Ue=0,Pe=0;Ue<pe.length;Ue++)Ne=pe[Ue],Me.hasOwnProperty(Ne)?Pe++:(se.push({command:wr.removeImport,args:[Ne]}),we.splice(we.indexOf(Ne,Pe),1));for(Ue=0,Pe=0;Ue<de.length;Ue++)Ne=de[de.length-1-Ue],we[we.length-1-Ue]!==Ne&&(be.hasOwnProperty(Ne)?(se.push({command:wr.removeImport,args:[Ne]}),we.splice(we.lastIndexOf(Ne,we.length-Pe),1)):Pe++,Oe=we[we.length-Ue],se.push({command:wr.addImport,args:[Me[Ne],Oe]}),we.splice(we.length-Ue,0,Ne));for(const Le of le){const Ye=be[Le.id];Ye&&(delete Ye.data,r.by(Ye,Le)||se.push({command:wr.updateImport,args:[Le.id,Le]}))}})(A.imports,D.imports,O),r.by(A.transition,D.transition)||O.push({command:wr.setTransition,args:[D.transition]}),r.by(A.light,D.light)||O.push({command:wr.setLight,args:[D.light]}),r.by(A.fog,D.fog)||O.push({command:wr.setFog,args:[D.fog]}),r.by(A.snow,D.snow)||O.push({command:wr.setSnow,args:[D.snow]}),r.by(A.rain,D.rain)||O.push({command:wr.setRain,args:[D.rain]}),r.by(A.projection,D.projection)||O.push({command:wr.setProjection,args:[D.projection]}),r.by(A.lights,D.lights)||O.push({command:wr.setLights,args:[D.lights]}),r.by(A.camera,D.camera)||O.push({command:wr.setCamera,args:[D.camera]}),r.by(A.iconsets,D.iconsets)||(function(ee,le,se){let pe;for(pe in le=le||{},ee=ee||{})ee.hasOwnProperty(pe)&&(le.hasOwnProperty(pe)||se.push({command:wr.removeIconset,args:[pe]}));for(pe in le){if(!le.hasOwnProperty(pe))continue;const de=le[pe];ee.hasOwnProperty(pe)?r.by(ee[pe],de)||(se.push({command:wr.removeIconset,args:[pe]}),se.push({command:wr.addIconset,args:[pe,de]})):se.push({command:wr.addIconset,args:[pe,de]})}})(A.iconsets,D.iconsets,O),!r.by(A["color-theme"],D["color-theme"]))return[{command:wr.setStyle,args:[D]}];const V={},H=[];(function(ee,le,se,pe){let de;for(de in le=le||{},ee=ee||{})ee.hasOwnProperty(de)&&(le.hasOwnProperty(de)||Lp(de,se,pe));for(de in le){if(!le.hasOwnProperty(de))continue;const be=le[de];ee.hasOwnProperty(de)?r.by(ee[de],be)||(ee[de].type==="geojson"&&be.type==="geojson"&&Th(ee,le,de)?se.push({command:wr.setGeoJSONSourceData,args:[de,be.data]}):qo(de,le,se,pe)):rf(de,le,se)}})(A.sources,D.sources,H,V);const Q=[];A.layers&&A.layers.forEach((ee=>{ee.source&&V[ee.source]?O.push({command:wr.removeLayer,args:[ee.id]}):Q.push(ee)}));let K=A.terrain;K&&V[K.source]&&(O.push({command:wr.setTerrain,args:[void 0]}),K=void 0),O=O.concat(H),r.by(K,D.terrain)||O.push({command:wr.setTerrain,args:[D.terrain]}),(function(ee,le,se){le=le||[];const pe=(ee=ee||[]).map(Tl),de=le.map(Tl),be=ee.reduce(sf,{}),Me=le.reduce(sf,{}),we=pe.slice(),Ue=Object.create(null);let Pe,Ne,Oe,Le,Ye,ct,rt;for(Pe=0,Ne=0;Pe<pe.length;Pe++)Oe=pe[Pe],Me.hasOwnProperty(Oe)?Ne++:(se.push({command:wr.removeLayer,args:[Oe]}),we.splice(we.indexOf(Oe,Ne),1));for(Pe=0,Ne=0;Pe<de.length;Pe++)Oe=de[de.length-1-Pe],we[we.length-1-Pe]!==Oe&&(be.hasOwnProperty(Oe)?(se.push({command:wr.removeLayer,args:[Oe]}),we.splice(we.lastIndexOf(Oe,we.length-Ne),1)):Ne++,ct=we[we.length-Pe],se.push({command:wr.addLayer,args:[Me[Oe],ct]}),we.splice(we.length-Pe,0,Oe),Ue[Oe]=!0);for(Pe=0;Pe<de.length;Pe++)if(Oe=de[Pe],Le=be[Oe],Ye=Me[Oe],!Ue[Oe]&&!r.by(Le,Ye))if(r.by(Le.source,Ye.source)&&r.by(Le["source-layer"],Ye["source-layer"])&&r.by(Le.type,Ye.type)){for(rt in Rc(Le.layout,Ye.layout,se,Oe,null,wr.setLayoutProperty),Rc(Le.paint,Ye.paint,se,Oe,null,wr.setPaintProperty),r.by(Le.slot,Ye.slot)||se.push({command:wr.setSlot,args:[Oe,Ye.slot]}),r.by(Le.filter,Ye.filter)||se.push({command:wr.setFilter,args:[Oe,Ye.filter]}),r.by(Le.minzoom,Ye.minzoom)&&r.by(Le.maxzoom,Ye.maxzoom)||se.push({command:wr.setLayerZoomRange,args:[Oe,Ye.minzoom,Ye.maxzoom]}),Le)Le.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?Rc(Le[rt],Ye[rt],se,Oe,rt.slice(6),wr.setPaintProperty):r.by(Le[rt],Ye[rt])||se.push({command:wr.setLayerProperty,args:[Oe,rt,Ye[rt]]}));for(rt in Ye)Ye.hasOwnProperty(rt)&&!Le.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?Rc(Le[rt],Ye[rt],se,Oe,rt.slice(6),wr.setPaintProperty):r.by(Le[rt],Ye[rt])||se.push({command:wr.setLayerProperty,args:[Oe,rt,Ye[rt]]}))}else se.push({command:wr.removeLayer,args:[Oe]}),ct=we[we.lastIndexOf(Oe)+1],se.push({command:wr.addLayer,args:[Ye,ct]})})(Q,D.layers,O)}catch(V){console.warn("Unable to compute style diff:",V),O=[{command:wr.setStyle,args:[D]}]}return O})(this.serialize(),s).filter((A=>!(A.command in ad)));if(m.length===0)return!1;const b=m.filter((A=>!(A.command in uu)));if(b.length>0)throw new Error(`Unimplemented: ${b.map((A=>A.command)).join(", ")}.`);const M=[];return m.forEach((A=>{M.push(this[A.command](...A.args))})),c&&Promise.all(M).then(c).catch(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[c,m]of s.entries()){if(this.getImage(c))return this.fire(new r.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,m),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(s,c){return this.getImage(s)?this.fire(new r.y(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,c),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(s,c,m=!1){this.imageManager.updateImage(s,this.scope,c),m&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(s){return this.modelManager.addModelURLs(s,this.getActualScope()),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(s,c,m={}){return this._checkLoaded(),this._validate(oe,`models.${s}`,c,null,m)||(this.modelManager.addModel(s,c,this.getActualScope()),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.getActualScope())}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.getActualScope(),!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(s,c,m={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Ts,`sources.${s}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const b=xs(s,c,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id})));const M=A=>{const D=(A?"symbol:":"other:")+b.id,O=r.B(D,this.scope),V=this._sourceCaches[D]=new Na(O,b,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=V,V.onAdd(this.map)};M(!1),c.type!=="vector"&&c.type!=="geojson"||M(!0),b.onAdd&&b.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===s)return this.fire(new r.y(new Error(`Source "${s}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new r.y(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const b=Object.entries(this.stylesheet.iconsets).find((([M,A])=>A.type==="source"&&A.source===s));if(b)return this.fire(new r.y(new Error(`Source "${s}" cannot be removed while iconset "${b[0]}" is using it.`)))}const m=this.getOwnSourceCaches(s);for(const b of m){const M=r.dq(b.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(b.id),b.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const m=this.getOwnSourceCache(c);m&&s.push(m.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const m=s[c]._tiles;for(const b in m){const M=m[b];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const M of s){if(this._validate(ja,"lights",M))return;switch(M.type){case"ambient":if(this.ambientLight){const A=this.ambientLight;A.set(M),A.updateTransitions(c)}else this.ambientLight=new Cn(M,Vn||(Vn=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const A=this.directionalLight;A.set(M),A.updateTransitions(c)}else this.directionalLight=new Cn(M,Un||(Un=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=Object.assign(c,{worldview:this.map.getWorldview()}),b=new r.ac(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(b),this.directionalLight&&this.directionalLight.recalculate(b),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const m=K=>.2126*(K[0]<=.03928?K[0]/12.92:Math.pow((K[0]+.055)/1.055,2.4))+.7152*(K[1]<=.03928?K[1]/12.92:Math.pow((K[1]+.055)/1.055,2.4))+.0722*(K[2]<=.03928?K[2]/12.92:Math.pow((K[2]+.055)/1.055,2.4)),b=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=s.properties.get("intensity"),A=s.properties.get("direction"),D=1-r.d4(A.x,A.y,A.z)[2]/90,O=m(b)*M*D,V=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),H=c.properties.get("intensity"),Q=m(V)*H;return Number(((O+Q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(r.dr(s)){const c=r.ds(s),m=this.fragments.find((({id:M})=>M===c));if(!m)return;const b=r.dq(s);return m.style.getFragmentStyle(b)}{const c=this.fragments.find((({id:m})=>m===s));return c?c.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const c={},m=(b,M="")=>`${b}::${M}`;this._featuresetSelectors={};for(const b in s){const M=this._featuresetSelectors[b]=[];for(const A of s[b].selectors){if(A.featureNamespace){const O=this.getOwnLayer(A.layer);if(!O){r.w(`Layer is undefined for selector: ${A.layer}`);continue}const V=m(O.source,O.sourceLayer);if(V in c&&c[V]!==A.featureNamespace){r.w(`"featureNamespace ${A.featureNamespace} of featureset ${b}'s selector is not associated to the same source, skip this selector`);continue}c[V]=A.featureNamespace}let D;if(A.properties)for(const O in A.properties){const V=r.U(A.properties[O]);V.result==="success"&&(D=D||{},D[O]=V.value)}M.push({layerId:A.layer,namespace:A.featureNamespace,properties:D,uniqueFeatureID:A._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const m=[];for(const b in c.stylesheet.featuresets)m.push({featuresetId:b,importId:c.scope?c.scope:void 0});return m}getFeaturesetLayers(s,c){const m=this.getFragmentStyle(c),b=m.stylesheet.featuresets;if(!b||!b[s])return this.fire(new r.y(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const M=[];for(const A of b[s].selectors){const D=m.getOwnLayer(A.layer);D&&M.push(D)}return M}getConfigProperty(s,c){const m=this.getFragmentStyle(s);if(!m)return null;const b=r.B(c,m.scope),M=m.options.get(b),A=M?M.value||M.default:null;return A?A.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(s,c){const m=r.B(s,c);return this._mergedIndoor[m]}setIndoorData(s,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(s,c,m){const b=this.getFragmentStyle(s);if(!b)return;const M=b.stylesheet.schema;if(!M||!M[c])return;const A=r.U(m);if(A.result!=="success")return void qu(this,A.value);const D=A.value.expression,O=r.B(c,b.scope),V=b.options.get(O);if(!V)return;let H;const{minValue:Q,maxValue:K,stepValue:ee,type:le,values:se}=M[c],pe=r.U(M[c].default);pe.result==="success"&&(H=pe.value.expression),H?(this.options.set(O,Object.assign({},V,{value:D,default:H,minValue:Q,maxValue:K,stepValue:ee,type:le,values:se})),this.updateConfigDependencies(c)):this.fire(new r.y(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const m=c.stylesheet.schema;if(!m)return null;const b={};for(const M in m){const A=r.B(M,c.scope),D=c.options.get(A),O=D?D.value||D.default:null;b[M]=O?O.serialize():null}return b}setConfig(s,c){const m=this.getFragmentStyle(s);m&&(m.updateConfig(c,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const m=this.getFragmentStyle(s);m&&(m.stylesheet.schema=c,m.updateConfig(m._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const m in c){let b,M;const A=r.U(c[m].default);if(A.result==="success"&&(b=A.value.expression),s&&s[m]!==void 0){const K=r.U(s[m]);K.result==="success"&&(M=K.value.expression)}const{minValue:D,maxValue:O,stepValue:V,type:H,values:Q}=c[m];if(b){const K=r.B(m,this.scope);this.options.set(K,{default:b,value:M,minValue:D,maxValue:O,stepValue:V,type:H,values:Q})}else this.fire(new r.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(s,c=(()=>!0)){for(const m of s){const b=this.getLayer(m);b&&c(b)&&(b.possiblyEvaluateVisibility(),this._updateLayer(b),this._changes.setDirty())}}updateConfigDependencies(s){this._updateLayers(this._configDependentLayers,(c=>!s||c.expressionDependencies.configDependencies.has(s))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((c=>{const m=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(m){const b=c._evaluateColorThemeData(m);(!c._styleColorTheme.lut&&b!==""||c._styleColorTheme.lut&&b!==c._styleColorTheme.lut.data)&&c.setColorTheme(m)}})),this._changes.setDirty()}addLayer(s,c,m={}){this._checkLoaded();const b=s.id;if(this._layers[b])return void this.fire(new r.y(new Error(`Layer with id "${b}" already exists on this map`)));let M;if(s.type==="custom"){if(qu(this,r.dt(s)))return;M=r.du(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(b,s.source),s=r.dp(s),s=Object.assign(s,{source:b})),this._validate(Bu,`layers.${b}`,s,{arrayIndex:-1},m))return;M=r.du(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:b}})}const A=r.B(M.source,M.scope);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(A),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(A);let D=this._order.length;if(c){const Q=this._order.indexOf(c);if(Q===-1)return void this.fire(new r.y(new Error(`Layer with id "${c}" does not exist on this map.`)));M.slot===this._layers[c].slot?D=Q:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(D,0,b),this._layerOrderChanged=!0,this._layers[b]=M;const O=this.getOwnLayerSourceCache(M),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&M.canCastShadows()&&V&&(O.castsShadows=!0);const H=this._changes.getRemovedLayer(M);if(H&&M.source&&O&&M.type!=="custom"){this._changes.discardLayerRemoval(M);const Q=r.B(M.source,M.scope);H.type!==M.type?this._changes.updateSourceCache(Q,"clear"):(this._changes.updateSourceCache(Q,"reload"),O.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const m=this._checkLayer(s);if(!m||s===c)return;const b=this._order.indexOf(s);this._order.splice(b,1);let M=this._order.length;if(c){const A=this._order.indexOf(c);if(A===-1)return void this.fire(new r.y(new Error(`Layer with id "${c}" does not exist on this map.`)));m.slot===this._layers[c].slot?M=A:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const b=this.getOwnLayerSourceCache(c);if(b&&b.castsShadows){let M=!1;for(const A in this._layers)if(this._layers[A].source===c.source&&this._layers[A].canCastShadows()){M=!0;break}b.castsShadows=M}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,m){this._checkLoaded();const b=this._checkLayer(s);b&&(b.minzoom===c&&b.maxzoom===m||(c!=null&&(b.minzoom=c),m!=null&&(b.maxzoom=m),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const m=this._checkLayer(s);m&&m.slot!==c&&(m.slot=c,this._updateLayer(m))}setFilter(s,c,m={}){this._checkLoaded();const b=this._checkLayer(s);if(b&&!r.by(b.filter,c))return c==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(Lo,`layers.${b.id}.filter`,c,{layerType:b.type},m)||(b.filter=r.dp(c),this._updateLayer(b)))}getFilter(s){const c=this._checkLayer(s);if(c)return r.dp(c.filter)}setLayoutProperty(s,c,m,b={}){this._checkLoaded();const M=this._checkLayer(s);if(M&&!r.by(M.getLayoutProperty(c),m)){if(m!=null&&(!b||b.validate!==!1)&&qu(M,ft.call(ls,{key:`layers.${s}.layout.${c}`,layerType:M.type,objectKey:c,value:m,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;M.setLayoutProperty(c,m),M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._updateLayer(M)}}setLayerProperty(s,c,m,b={}){this._checkLoaded();const M=this._checkLayer(s);M&&(c==="appearances"?(M.setAppearances(m),this._changes.setDirty()):M.isPaintProperty(c)?this.setPaintProperty(s,c,m,b):this.setLayoutProperty(s,c,m,b))}getLayoutProperty(s,c){const m=this._checkLayer(s);if(m)return m.getLayoutProperty(c)}setPaintProperty(s,c,m,b={}){this._checkLoaded();const M=this._checkLayer(s);if(!M||r.by(M.getPaintProperty(c),m)||m!=null&&(!b||b.validate!==!1)&&qu(M,jo.call(ls,{key:`layers.${s}.paint.${c}`,layerType:M.type,objectKey:c,value:m,styleSpec:r.a6})))return;const A=M.setPaintProperty(c,m);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),A&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(s,c){const m=this._checkLayer(s);if(m)return m.getPaintProperty(c)}setFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:V}=s.target,H=this.getFragmentStyle(V),Q=H.getFeaturesetLayers(O);for(const{source:K,sourceLayer:ee}of Q)H.setFeatureState({id:s.id,source:K,sourceLayer:ee},c)}else if("layerId"in s.target){const{layerId:O}=s.target,V=this.getLayer(O);this.setFeatureState({id:s.id,source:V.source,sourceLayer:V.sourceLayer},c)}return}const m=s.source,b=s.sourceLayer,M=this._checkSource(m);if(!M)return;const A=M.type;if(A==="geojson"&&b)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!b)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(m);for(const O of D)O.setFeatureState(b,s.id,c)}removeFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:V}=s.target,H=this.getFragmentStyle(V),Q=H.getFeaturesetLayers(O);for(const{source:K,sourceLayer:ee}of Q)H.removeFeatureState({id:s.id,source:K,sourceLayer:ee},c)}else if("layerId"in s.target){const{layerId:O}=s.target,V=this.getLayer(O);this.removeFeatureState({id:s.id,source:V.source,sourceLayer:V.sourceLayer},c)}return}const m=s.source,b=this._checkSource(m);if(!b)return;const M=b.type,A=M==="vector"?s.sourceLayer:void 0;if(M==="vector"&&!A)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(m);for(const O of D)O.removeFeatureState(A,s.id,c)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let M;if("featuresetId"in s.target){const{featuresetId:A,importId:D}=s.target,O=this.getFragmentStyle(D),V=O.getFeaturesetLayers(A);for(const{source:H,sourceLayer:Q}of V){const K=O.getFeatureState({id:s.id,source:H,sourceLayer:Q});if(K&&!M)M=K;else if(!r.by(M,K))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:A}=s.target,D=this.getLayer(A);M=this.getFeatureState({id:s.id,source:D.source,sourceLayer:D.sourceLayer})}return M}const c=s.source,m=s.sourceLayer,b=this._checkSource(c);if(b){if(b.type!=="vector"||m)return s.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(m,s.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return r.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(m=>m!==void 0))}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),m=r.B(s.source,s.scope),b=this._changes.getUpdatedSourceCaches();s.source&&!b[m]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=D=>this._mergedLayers[D].is3D(!!this.terrain),m=this.order,b={},M=[];for(let D=m.length-1;D>=0;D--){const O=m[D];if(c(O)){b[O]=D;for(const V of s){const H=V[O];if(H)for(const Q of H)M.push(Q)}}}M.sort(((D,O)=>O.intersectionZ-D.intersectionZ));const A=[];for(let D=m.length-1;D>=0;D--){const O=m[D];if(c(O))for(let V=M.length-1;V>=0;V--){const H=M[V].feature;if(H.layer&&b[H.layer.id]<D)break;A.push(H),M.pop()}else for(const V of s){const H=V[O];if(H)for(const Q of H)A.push(Q.feature)}}return A}queryRasterValue(s,c,m){const b=this.getOwnSource(s);return b?b.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):b.queryRasterArrayValue(c,m):(this.fire(new r.y(new Error(`Source with id "${s}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(s,c,m){let b;c&&!Array.isArray(c)&&c.filter&&(this._validate(Lo,"queryRenderedFeatures.filter",c.filter,null,c),b=r.b6(c.filter));const M={},A=H=>{if(hu.has(H.type))return;const Q=this.getOwnLayerSourceCache(H),K=M[Q.id]=M[Q.id]||{sourceCache:Q,layers:{},has3DLayers:!1};H.is3D(!!this.terrain)&&(K.has3DLayers=!0),K.layers[H.fqid]=K.layers[H.fqid]||{styleLayer:H,targets:[]},K.layers[H.fqid].targets.push({filter:b})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const H of c.layers){const Q=this._layers[H];if(!Q)return this.fire(new r.y(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];A(Q)}}else for(const H in this._layers)A(this._layers[H]);const D=this._queryRenderedFeatures(s,M,m),O=this._flattenAndSortRenderedFeatures(D),V=[];for(const H of O)r.dw(H.layer.id)===this.scope&&V.push(H);return V}queryRenderedFeatureset(s,c,m){let b;c&&!Array.isArray(c)&&c.filter&&(this._validate(Lo,"queryRenderedFeatures.filter",c.filter,null,c),b=r.b6(c.filter));const M="mock",A=[];if(c&&c.target)A.push(Object.assign({},c,{targetId:M,filter:b}));else{const H=this.getFeaturesetDescriptors();for(const Q of H)A.push({targetId:M,filter:b,target:Q});for(const{style:Q}of this.fragments){const K=Q.getFeaturesetDescriptors();for(const ee of K)A.push({targetId:M,filter:b,target:ee})}}const D=this.queryRenderedTargets(s,A,m),O=[],V=new Set;for(const H of D)for(const Q of H.variants[M])ma(Q,H,V)||O.push(new r.dx(H,Q));return O}queryRenderedTargets(s,c,m){const b={},M=(D,O,V,H)=>{const Q=b[O.id]=b[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(Q.layers[D.fqid]=Q.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D(!!this.terrain)&&(Q.has3DLayers=!0),!H)return V.uniqueFeatureID=!1,void Q.layers[D.fqid].targets.push(V);Q.layers[D.fqid].targets.push(Object.assign({},V,{namespace:H.namespace,properties:H.properties,uniqueFeatureID:H.uniqueFeatureID}))};for(const D of c)if("featuresetId"in D.target){const{featuresetId:O,importId:V}=D.target,H=this.getFragmentStyle(V);if(!H||!H._featuresetSelectors)continue;const Q=H._featuresetSelectors[O];if(!Q){this.fire(new r.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const K of Q){const ee=H.getOwnLayer(K.layerId);ee&&!hu.has(ee.type)&&M(ee,H.getOwnLayerSourceCache(ee),D,K)}}else if("layerId"in D.target){const{layerId:O}=D.target,V=this.getLayer(O);if(!V||hu.has(V.type))continue;M(V,this.getLayerSourceCache(V),D)}const A=this._queryRenderedFeatures(s,b,m);return this._flattenAndSortRenderedFeatures(A)}_queryRenderedFeatures(s,c,m){const b=[],M=!!this.map._showQueryGeometry,A=or.createFromScreenPoints(s,m);for(const D in c){const O=Ul(A,c[D],this._availableImages,m,M);Object.keys(O).length&&b.push(O)}if(this.placement)for(const D in c){if(!c[D].sourceCache._onlySymbols)continue;const O=wl(A.screenGeometry,c[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&b.push(O)}return b}querySourceFeatures(s,c){const m=c&&c.filter;m&&this._validate(Lo,"querySourceFeatures.filter",m,null,c);let b=[];const M=this.getOwnSourceCaches(s);for(const A of M)b=b.concat(tf(A,c));return b}addSourceType(s,c,m){return ho.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(ho.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,m={}){this._checkLoaded();const b=this.light.getLight();let M=!1;for(const D in s)if(!r.by(s[D],b[D])){M=!0;break}if(!M)return;const A=this._getTransitionParameters();this.light.setLight(s,c,m),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=s;const b=!("source"in s)||s.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in m&&typeof m.source=="object"){const D="terrain-dem-src";this.addSource(D,m.source),m=r.dp(m),m=Object.assign(m,{source:D})}const M=Object.assign({},m),A={};if(this.terrain&&b){M.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(A.style=D.serialize())}if(this._validate($f,"terrain",M,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c),this.fire(new r.z("data",{dataType:"style"}))}else{const M=this.terrain,A=M.get();for(const D of Object.keys(r.a6.terrain))!m.hasOwnProperty(D)&&r.a6.terrain[D].default&&(m[D]=r.a6.terrain[D].default);for(const D in s)if(!r.by(s[D],A[D])){M.set(s,this.options),this.stylesheet.terrain=s;const O=this._getTransitionParameters({duration:0});M.updateTransitions(O),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new bi(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_createSnow(s){const c=this.snow=new kn(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_createRain(s){const c=this.rain=new Wn(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const s of this.map._markers)s._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!r.by(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!r.by(c.get(),s)){c.set(s,this.options),this.stylesheet.snow=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!r.by(c.get(),s)){c.set(s,this.options),this.stylesheet.rain=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void s();const m=this._evaluateColorThemeData(c);this._loadColorTheme(m).then((()=>{this.fire(new r.z("colorthemeset")),s()})).catch((b=>{r.w(`Couldn't set color theme: ${b}`)}))}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,c){const m=this.getFragmentStyle(s);m&&(m._styleColorTheme.colorThemeOverride=c,m._reloadColorTheme())}_getTransitionParameters(s){return{now:r.o.now(),transition:Object.assign(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?s.push(m):c.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const m=this.terrain=new lt(s,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});m.updateTransitions(b)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,m,b,M={}){if(M&&M.validate===!1)return!1;const A=Object.assign({},this.serialize());return qu(this,s.call(ls,Object.assign({key:c,style:A,value:m,styleSpec:r.a6},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const m of c)m.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const c=this._mergedLayers[s];c._clear&&c._clear()}}reloadSource(s){const c=this.getSourceCaches(s);for(const m of c)m.resume(),m.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((s=>{s.modelManager.reloadModels(s.scope)}))}updateSources(s){let c;this.directionalLight&&(c=ju(this.directionalLight));const m=new Set,b=new Set;for(const M in this._mergedLayers){const A=this._mergedLayers[M];A.type==="building"&&m.add(A.source),A.hasElevation()&&!b.has(A.source)&&b.add(A.source)}for(const M in this._mergedSourceCaches){const A=this._mergedSourceCaches[M],D=b.has(A._source.id);m.has(A._source.id)&&(A._source.reparseOverscaled=!1),A.update(s,void 0,void 0,c,D)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,m,b,M,A,D=!1){let O=!1,V=!1;const H={},Q={};for(const se of this._mergedOrder){const pe=this._mergedLayers[se];if(pe.type!=="symbol")continue;const de=r.B(pe.source,pe.scope);let be=H[de];if(!be){const we=this.getLayerSourceCache(pe);if(!we)continue;const Ue=we.getRenderableIds(!0).map((Pe=>we.getTileByID(Pe)));Q[de]=Ue.slice(),be=H[de]=Ue.sort(((Pe,Ne)=>Ne.tileID.overscaledZ-Pe.tileID.overscaledZ||(Pe.tileID.isLessThan(Ne.tileID)?-1:1)))}const Me=this.crossTileSymbolIndex.addLayer(pe,be,c.center.lng,c.projection);O=O||Me}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new r.z("neworder"));const K=!!(this.placement&&!c.equals(this.placement.transform)),ee=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!A||this.placement.lastReplacementSourceUpdateTime!==A.updateTime)),le=(K||ee||O||this.placement&&this.placement.isStale())&&b===0;if((D||!this.pauseablePlacement||le||b!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),c.zoom))&&(this.pauseablePlacement=new Xs(c,this._mergedOrder,D||b===0,m,b,M,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,H,Q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),V=!0),O&&this.pauseablePlacement.placement.setStale()),V||O){this._buildingIndex.onNewFrame(c.zoom);for(let se=0;se<this._mergedOrder.length;se++){const pe=this._mergedLayers[this._mergedOrder[se]];if(pe.type!=="symbol"||pe.visibility==="none")continue;const de=this.isLayerClipped(pe);this.placement.updateLayerOpacities(pe,H[r.B(pe.source,pe.scope)],se,de?A:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex((({id:M})=>M===s.id))!==-1)return void this.fire(new r.y(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return m.push(s),this._loadImports([s],!0);const b=m.findIndex((({id:M})=>M===c));return b===-1&&this.fire(new r.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,b).concat(s).concat(m.slice(b)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],b=this.getImportIndex(s);return b===-1?this:typeof c=="string"?(this.setImportUrl(s,c),this):(c.url&&c.url!==m[b].url&&this.setImportUrl(s,c.url),r.by(c.config,m[b].config)||this.setImportConfig(s,c.config,c.data.schema),r.by(c.data,m[b].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let m=this.stylesheet.imports||[];const b=this.getImportIndex(s);if(b===-1)return this;const M=this.getImportIndex(c);if(M===-1)return this;const A=m[b],D=this.fragments[b];return m=m.filter((({id:O})=>O!==s)),this.fragments=this.fragments.filter((({id:O})=>O!==s)),this.stylesheet.imports=m.slice(0,M).concat(A).concat(m.slice(M)),this.fragments=this.fragments.slice(0,M).concat(D).concat(this.fragments.slice(M)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],b=this.getImportIndex(s);if(b===-1)return this;m[b].url=c;const M=this.fragments[b];return M.style=this._createFragmentStyle(m[b]),M.style.on("style.import.load",(()=>this.mergeAll())),M.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const m=this.getImportIndex(s),b=this.stylesheet.imports||[];return m===-1?this:c?(this.fragments[m].style.setState(c),this._reloadImports(),this):(delete b[m].data,this.setImportUrl(s,b[m].url))}setImportConfig(s,c,m){this._checkLoaded();const b=this.getImportIndex(s),M=this.stylesheet.imports||[];if(b===-1)return this;c?M[b].config=c:delete M[b].config;const A=this.fragments[b];m&&A.style.stylesheet&&(A.style.stylesheet.schema=m);const D=A.style.stylesheet&&A.style.stylesheet.schema;return A.config=c,A.style.updateConfig(c,D),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(s);m!==-1&&(c.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex((m=>m.id===s));return c===-1&&this.fire(new r.y(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[c];m&&s.push(m.getSource())}return s}getSource(s,c){const m=this.getSourceCache(s,c);return m&&m.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const m=r.B(s,c);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(s){const c=r.B(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const m=s[c];m==="reload"?this.reloadSource(c):m==="clear"&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const m of c){const b=this.getLayer(m);b&&b.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,c,m){this.imageManager.getImages(c.images,c.scope,m),this._updateTilesForChangedImages();const b=A=>{if(A){const D=c.images.map((O=>r.I.toString(O)));A.setDependencies(c.tileID.key,c.type,D)}},M=r.B(c.source,c.scope);b(this._mergedOtherSourceCaches[M]),b(this._mergedSymbolSourceCaches[M]),c.images.some((A=>A.iconsetId))&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(s,c,m){this.imageManager.rasterizeImages(c,m)}getGlyphs(s,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(s,c,m){return r.dz(c,m)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return c.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${s}'`))),!1):c.every((m=>m.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const m=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),b=s.type==="building";if(s.is3D(!!this.terrain)){if(m||b||c&&c.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((s=>{s.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ho.getSourceType=function(p){return la[p]},ho.setSourceType=function(p,s){la[p]=s},ho.registerForPluginStateChange=r.dA;class Fp extends r.E{constructor(s){super(),this._style=s,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(s){s===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=s,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(s){this._activeFloorsVisible=s,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(s){for(const[c,m]of Object.entries(s.buildings))if(this._buildings[c])for(const b of m.floorIds)this._buildings[c].floors[b]||(this._buildings[c].floors[b]=m.floors[b]);else this._buildings[c]=m;for(const c of s.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(s,c){const m=this._style.getIndoorSourceLayers(s,c);return m&&this._indoorState?{sourceLayers:m,indoorState:this._indoorState}:null}_updateUI(s,c,m){const b=(function(M,A,D,O){let V=null,H=Number.MAX_SAFE_INTEGER;if(O<16)return null;for(const[Q,K]of Object.entries(M)){const ee=K.center;if(ee){const le=A.distanceTo(r.aT.convert(ee));le<H&&D.contains(ee)&&(H=le,V=Q)}}return V})(this._buildings,c,m,s);b!==this._closestBuildingId&&(this._closestBuildingId=b,this._updateIndoorSelector())}_updateIndoorSelector(){const s=this._buildings,c=this._closestBuildingId,m=c&&s?s[c]:void 0;if(!m)return void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let b=null;for(const A of m.floorIds)if(this._activeFloors&&this._activeFloors.has(A)){b=A;break}const M=Array.from(m.floorIds).map((A=>({id:A,name:m.floors[A].name,zIndex:m.floors[A].zIndex}))).sort(((A,D)=>D.zIndex-A.zIndex));this.fire(new r.z("selector-update",{selectedFloorId:b,activeFloorsVisible:this._activeFloorsVisible,floors:M}))}_updateActiveFloors(){const s=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:s,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Ja=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,dc=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,fo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Wu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",al=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,fu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,gi=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,df=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,du=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,od=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,pf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Lc=/#include\s+"([^"]+)"/g,pu=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Wo=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Qa=new Set(["ifdef","ifndef","elif","if","defined"]),ol=new Set;eo(Ja,ol),eo(fo,ol),eo(dc,ol);const Ua={"_prelude_fog.vertex.glsl":fu,"_prelude_terrain.vertex.glsl":al,"_prelude_shadow.vertex.glsl":od,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":gi,"_prelude_shadow.fragment.glsl":pf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":df,"_prelude_raster_particle.glsl":du},mf={};ur("",al),ur(gi,fu),ur(pf,od),ur(df,""),ur(du,"");const Zu=ur(dc,fo),ld=Ja,s_=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",ld,Zu.fragmentSource].join(`
`),Pc=["precision highp float;",ld,Zu.vertexSource].join(`
`);var Up={background:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:ur(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ur("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ur(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ur("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ur("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ur(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ur(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ur(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ur(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ur(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ur("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ur("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ur(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ur(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ur("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ur(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wu),skyboxGradient:ur(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wu),skyboxCapture:ur(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ur(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ur(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ur("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ur("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ur("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ur("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function eo(p,s){const c=p.split(`
`);for(let m of c){if(m=m.trimStart(),m[0]!=="#"||!m.includes("if")||m.startsWith("#endif"))continue;const b=m.match(Wo);if(b)for(const M of b)Qa.has(M)||s.add(M)}}function ur(p,s){const c=new Set,m=[],b=[];p=p.replace(Lc,((A,D)=>(b.push(D),""))),s=s.replace(Lc,((A,D)=>(m.push(D),"")));let M=new Set(ol);eo(p,M),eo(s,M);for(const A of[...m,...b])mf[A]||(mf[A]=new Set,eo(Ua[A],mf[A])),M=new Set([...M,...mf[A]]);return{fragmentSource:p=p.replace(pu,((A,D,O,V,H)=>(c.add(H),D==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${O} ${V} ${H};
#else
uniform ${O} ${V} u_${H};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${O} ${V} ${H} = u_${H};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${O} ${V} ${H};
#endif
`:D==="initialize-attribute"?"":void 0))),vertexSource:s=s.replace(pu,((A,D,O,V,H)=>{const Q=`MATERIAL_ATTRIBUTE_OFFSET_${H}`,K=V==="float"?"vec2":V,ee=`GET_ATTRIBUTE_${K}(a_${H}, materialInfo, ${Q})`,le=H.match(/color/)?"color":K;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${O} ${V} a_${H};
#endif
`:c.has(H)?D==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
    #if !defined(${Q})
        in ${O} ${K} a_${H};
    #endif
out ${O} ${V} ${H};
#else
uniform ${O} ${V} u_${H};
#endif
`:D==="initialize"?le==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${O} ${V} ${H} = u_${H};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${H})
    #ifdef ${Q}
        ${H} = unpack_mix_${le}(${ee}, u_${H}_t);
    #else
        ${H} = unpack_mix_${le}(a_${H}, u_${H}_t);
    #endif
#else
    ${O} ${V} ${H} = u_${H};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${O} ${V} a_${H};
    out ${O} ${V} ${H};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
    #if !defined(${Q})
        in ${O} ${K} a_${H};
    #endif
#else
uniform ${O} ${V} u_${H};
#endif
`:D==="define-instanced"?le==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${O} ${V} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${K} a_${H};
#else
uniform ${O} ${V} u_${H};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${O} ${V} ${H} = a_${H};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    #ifdef ${Q}
        ${O} ${V} ${H} = ${ee};
    #else
        ${O} ${V} ${H} = a_${H};
    #endif
#else
    ${O} ${V} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    #ifdef ${Q}
        ${O} ${V} ${H} = unpack_mix_${le}(${ee}, u_${H}_t);
    #else
        ${O} ${V} ${H} = unpack_mix_${le}(a_${H}, u_${H}_t);
    #endif
#else
    ${O} ${V} ${H} = u_${H};
#endif
`})),usedDefines:M,vertexIncludes:m,fragmentIncludes:b}}class cd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,m,b,M,A,D,O){this.context=s;let V=this.boundPaintVertexBuffers.length!==b.length;for(let Q=0;!V&&Q<b.length;Q++)this.boundPaintVertexBuffers[Q]!==b[Q]&&(V=!0);let H=this.boundDynamicVertexBuffers.length!==D.length;for(let Q=0;!H&&Q<D.length;Q++)this.boundDynamicVertexBuffers[Q]!==D[Q]&&(H=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||V||H||this.boundIndexBuffer!==M||this.boundVertexOffset!==A)this.freshBind(c,m,b,M,A,D,O);else{s.bindVertexArrayOES.set(this.vao);for(const Q of D)Q&&(Q.bind(),O&&Q.instanceCount&&Q.setVertexAttribDivisor(s.gl,c,O));M&&M.dynamicDraw&&M.bind()}}freshBind(s,c,m,b,M,A,D){const O=this.context,V=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=b,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=A,c.enableAttributes(V,s),c.bind(),c.setVertexAttribPointers(V,s,M);for(const H of m)H.enableAttributes(V,s),H.bind(),H.setVertexAttribPointers(V,s,M);for(const H of A)H&&(H.enableAttributes(V,s),H.bind(),H.setVertexAttribPointers(V,s,M),D&&H.instanceCount&&H.setVertexAttribDivisor(V,s,D));b&&b.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function kp(p,s){const c=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new r.ae(0,m/c).toLngLat().lat,new r.ae(0,(m+1)/c).toLngLat().lat]}function Yd(p,s,c,m,b,M,A){const D=p.context,O=D.gl,V=c.hillshadeFBO;if(!V)return;p.prepareDrawTile();const H=p.isTileAffectedByFog(s),Q=[];p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&Q.push("USE_MRT1");const K=p.getOrCreateProgram("hillshade",{overrideFog:H,defines:Q});D.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,V.colorAttachment0.get());const ee=((de,be,Me,we)=>{const Ue=Me.paint.get("hillshade-shadow-color"),Pe=Me.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ne=Me.paint.get("hillshade-highlight-color"),Oe=Me.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Le=Me.paint.get("hillshade-accent-color"),Ye=Me.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ct=Me.paint.get("hillshade-emissive-strength");let rt=r.an(Me.paint.get("hillshade-illumination-direction"));if(Me.paint.get("hillshade-illumination-anchor")==="viewport")rt-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){const xt=de.style.directionalLight.properties.get("direction"),St=r.d4(xt.x,xt.y,xt.z);rt=r.an(St[1])}const _t=!de.options.moving;return{u_matrix:we||de.transform.calculateProjMatrix(be.tileID.toUnwrapped(),_t),u_image:0,u_latrange:kp(0,be.tileID),u_light:[Me.paint.get("hillshade-exaggeration"),rt],u_shadow:Ue.toPremultipliedRenderColor(Pe?null:Me.lut),u_highlight:Ne.toPremultipliedRenderColor(Oe?null:Me.lut),u_emissive_strength:ct,u_accent:Le.toPremultipliedRenderColor(Ye?null:Me.lut)}})(p,c,m,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(D,K,s.toUnwrapped());const{tileBoundsBuffer:le,tileBoundsIndexBuffer:se,tileBoundsSegments:pe}=p.getTileBoundsBuffers(c);K.draw(p,O.TRIANGLES,b,M,A,zn.disabled,ee,m.id,le,se,pe)}function Cl(p,s,c){if(!s.needsDEMTextureUpload)return;const m=p.context,b=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(c.stride);const M=c.getPixels();s.demTexture?s.demTexture.update(M,{premultiply:!1}):s.demTexture=new r.T(m,M,b.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Xl(p,s,c){const m=p.context,b=m.gl;if(!s.dem)return;const M=s.dem;if(m.activeTexture.set(b.TEXTURE1),Cl(p,s,M),!s.demTexture)return;s.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const A=M.dim;m.activeTexture.set(b.TEXTURE0);let D=s.hillshadeFBO;if(!D){const K=new r.T(m,{width:A,height:A,data:null},b.RGBA8);K.bind(b.LINEAR,b.CLAMP_TO_EDGE),D=s.hillshadeFBO=m.createFramebuffer(A,A,1,"renderbuffer"),D.colorAttachment0.set(K.texture)}m.bindFramebuffer.set(D.framebuffer),m.viewport.set([0,0,A,A]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:V,tileBoundsSegments:H}=p.getMercatorTileBoundsBuffers(),Q=[];p.linearFloatFilteringSupported()&&Q.push("TERRAIN_DEM_FLOAT_FORMAT"),p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&Q.push("USE_MRT1"),p.getOrCreateProgram("hillshadePrepare",{defines:Q}).draw(p,b.TRIANGLES,sn.disabled,fn.disabled,$n.unblended,zn.disabled,((K,ee)=>{const le=ee.stride,se=r.bC();return r.ce(se,0,r.al,-r.al,0,0,1),r.br(se,se,[0,-r.al,0]),{u_matrix:se,u_image:1,u_dimension:[le,le],u_zoom:K.overscaledZ}})(s.tileID,M),c.id,O,V,H),s.needsHillshadePrepare=!1}class ns{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yu extends ns{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class mu extends ns{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class gu extends ns{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Kd extends ns{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class $d extends ns{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Wl extends ns{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Ku extends ns{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Xa extends ns{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class ea extends ns{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class zs extends ns{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class _u extends ns{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class vo extends ns{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ch extends ns{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class ws extends ns{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ud extends ns{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Um extends ns{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class $u extends ns{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class yu extends ns{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class km extends ns{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Jd=class extends ns{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Vm extends ns{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Zl extends ns{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Zo extends ns{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Rh extends ns{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class zc extends ns{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ih extends ns{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Qd extends ns{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ju extends ns{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class gf extends ns{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Dh extends ns{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class bo extends ns{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class _f extends ns{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class ep extends _f{constructor(s,c,m=0){super(s,c),this.attachmentPoint=s.gl.COLOR_ATTACHMENT0+m}setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class hd extends _f{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class tp extends _f{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Gm extends hd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const nr=(p,s,c,m)=>({u_matrix:p,u_image0:0,u_image1:1,u_skirt_height:s,u_ground_shadow_factor:c,u_emissive_texture_available:m}),ip=(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:b,u_merc_center:M,u_image0:0,u_image1:1,u_frustum_tl:A,u_frustum_tr:D,u_frustum_br:O,u_frustum_bl:V,u_globe_pos:H,u_globe_radius:Q,u_viewport:K,u_grid_matrix:pe?Float32Array.from(pe):new Float32Array(9),u_skirt_height:ee,u_far_z_cutoff:le,u_emissive_texture_available:se});function to(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const Rl=new class{constructor(){this.operations={}}newMorphing(p,s,c,m,b){if(p in this.operations){const M=this.operations[p];M.to.tileID.key!==c.tileID.key&&(M.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:b,from:s,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const c=this.operations[s];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},np={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Oc(p,s,c){if(s===0)return 0;const m=s<1&&c===514?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*m}function pc(p,s){const c=1<<p.z;return!s&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}function xu(p,s){if(!p.style||!p.style.enable3dLights())return;const c=p.context,m=c.gl;c.activeTexture.set(m.TEXTURE1),s?s.bind(m.LINEAR,m.CLAMP_TO_EDGE):p.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}const fd=p=>({u_matrix:p});function dd(p,s,c,m,b){if(b>0){const M=r.o.now(),A=(M-p.timeAdded)/b,D=s?(M-s.timeAdded)/b:-1,O=c.getSource(),V=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),H=!s||Math.abs(s.tileID.overscaledZ-V)>Math.abs(p.tileID.overscaledZ-V),Q=H&&p.refreshedUponExpiration?1:r.aA(H?A:1-D,0,1);return s?{opacity:1,mix:1-Q,isFading:A<1}:{opacity:Q,mix:0,isFading:A<1}}return{opacity:1,mix:0,isFading:!1}}class Vp extends Na{constructor(s){const c=xs("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class Qu extends Na{constructor(s){const c=xs("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,m){if(s.freezeTileCoverage)return;this.transform=s;const b=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((M,A)=>{if(M[A.key]="",!this._tiles[A.key]){const D=new wh(A,this._source.tileSize*A.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);D.state="loaded",this._tiles[A.key]=D}return M}),{});for(const M in this._tiles)M in b||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach((s=>s.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bc extends r.aQ{constructor(s,c,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class yf extends r.bV{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,b,M]=(function(O){const V=new r.bd,H=new r.b0,Q=131;V.reserve(17161),H.reserve(33800);const K=r.al/128,ee=r.al+K/2,le=ee+K;for(let pe=-K;pe<le;pe+=K)for(let de=-K;de<le;de+=K){const be=de<0||de>ee||pe<0||pe>ee?24575:0,Me=r.aA(Math.round(de),0,r.al),we=r.aA(Math.round(pe),0,r.al);V.emplaceBack(Me+be,we)}const se=(pe,de)=>{const be=de*Q+pe;H.emplaceBack(be+1,be,be+Q),H.emplaceBack(be+Q,be+Q+1,be+1)};for(let pe=1;pe<129;pe++)for(let de=1;de<129;de++)se(de,pe);return[0,129].forEach((pe=>{for(let de=0;de<130;de++)se(de,pe),se(pe,de)})),[V,H,32768]})(),A=s.context;this.gridBuffer=A.createVertexBuffer(m,r.bf.members),this.gridIndexBuffer=A.createIndexBuffer(b),this.gridSegments=r.bg.simpleSegment(0,0,m.length,b.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,m.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qu(c.map),this.orthoMatrix=r.bC(),r.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const D=A.gl;this._overlapStencilMode=new fn({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vp(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(s,c,m){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const b=s.terrain.properties,M=s.terrain.drapeRenderMode===0,A=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const D=s.terrain&&s.terrain.scope,O=b.get("source"),V=M?this._mockSourceCache:s.getSourceCache(O,D);if(!V)return void r.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=V,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=A?this.calculateExaggeration(c):b.get("exaggeration"),!c.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const H=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Q=this.getScaledDemTileSize();this.sourceCache.update(c,Q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,H(),this._initializing=!0),H(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,m=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=m;const b=c!=null?m-c:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const M=s.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(M);let D=M-this._previousZoom;const O=this._previousUpdateTimestamp;let V=M;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(M-V)>.5&&(D=.5*(M-V+D)),D*b<0&&(V+=D)),this._evaluationZoom=V;const H=A.getExaggeration(V),Q=H===A.getExaggeration(Math.max(0,V-.1));if(Q&&Math.abs(H-this._exaggeration)<.01)return H;let K=Math.min(.1,.00375*(this._updateTimestamp-O));return(Q||H<.1||Math.abs(D)<1e-4)&&(K=Math.min(.2,4*K)),r.ak(this._exaggeration,H,K)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.dataType==="source"&&s.coord?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((s=>s.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=c.getIds().map((O=>{const V=c.getTileByID(O).tileID;return V.projMatrix=m.calculateProjMatrix(V.toUnwrapped()),V}));(function(O,V){const H=V.transform.pointCoordinate(V.transform.getCameraPoint()),Q=new r.P(H.x,H.y);O.sort(((K,ee)=>{if(ee.overscaledZ-K.overscaledZ)return ee.overscaledZ-K.overscaledZ;const le=new r.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),se=new r.P(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),pe=Q.mult(1<<K.canonical.z);return pe.x-=.5,pe.y-=.5,pe.distSqr(le)-pe.distSqr(se)}))})(b,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},b.forEach((O=>{this.proxyToSource[O.key]={}})),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const O in A){const V=A[O];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,s[O],M),V.usedForTerrain))continue;const H=s[O];V.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[c.id]=b.map((O=>new Bc(O,O.key,this.orthoMatrix))),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const V=this.terrainTileForTile[O.key];if(!V)continue;const H=V.tileID.key;H in D||(this._visibleDemTiles.push(V),D[H]=H)}}_assignTerrainTiles(s){this._initializing||s.forEach((c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)}))}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const m in this.terrainTileForTile){const b=this.terrainTileForTile[m],M=b.dem;!M||b.demTexture&&!b.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),Cl(this.painter,b,M))}}_prepareDemTileUniforms(s,c,m,b){if(!c||c.demTexture==null)return!1;const M=s.tileID.canonical,A=Math.pow(2,c.tileID.canonical.z-M.z),D=b||"";return m[`u_dem_tl${D}`]=[M.x*A%1,M.y*A%1],m[`u_dem_scale${D}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce(((m,b)=>{if(!b.dem)return m;const M=b.dem.tree.minimums[0];return M>0&&s++,m+M}),0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),b=new r.dL({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(b,{premultiply:!1}):M=this._emptyDEMTexture=new r.T(s,b,c.R32F,{premultiply:!1}),M}setupElevationDraw(s,c,m){const b=this.painter.context,M=b.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};A.u_exaggeration=this.exaggeration();let D=null,O=null,V=1;if(m&&m.morphing&&this._useVertexMorphing){const ee=m.morphing.srcDemTile,le=m.morphing.dstDemTile;V=m.morphing.phase,ee&&le&&(this._prepareDemTileUniforms(s,ee,A,"_prev")&&(O=ee),this._prepareDemTileUniforms(s,le,A)&&(D=le))}const H=ee=>ee&&ee.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST;let Q=null;var K;if(this.enabled?O&&D?(Q=D.demTexture,b.activeTexture.set(M.TEXTURE4),O.demTexture.bind(H(O),M.CLAMP_TO_EDGE),A.u_dem_lerp=V):(D=this.terrainTileForTile[s.tileID.key],Q=this._prepareDemTileUniforms(s,D,A)?D.demTexture:this.emptyDEMTexture):Q=this.emptyDEMTexture,b.activeTexture.set(M.TEXTURE2),Q&&(A.u_dem_size=(K=Q).size[0]===1?1:K.size[0]-2,Q.bind(H(D),M.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,c,A),m&&m.useMeterToDem&&D){const ee=(1<<D.tileID.canonical.z)*r.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=ee}if(m&&m.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(b,A),this.painter.transform.projection.name==="globe"){const ee=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(b,ee)}}globeUniformValues(s,c,m){const b=s.projection;return{u_tile_tl_up:b.upVector(c,0,0),u_tile_tr_up:b.upVector(c,r.al,0),u_tile_br_up:b.upVector(c,r.al,r.al),u_tile_bl_up:b.upVector(c,0,r.al),u_tile_up_scale:m?r.dM(1):b.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(b,M,A,D,O){if(b.transform.projection.name==="globe")(function(V,H,Q,K,ee){const le=V.context,se=le.gl;let pe,de;const be=V.transform,Me=r.dE(V,le,be),we=(_t,xt)=>{if(de===xt)return;const St=[np[xt],"PROJECTION_GLOBE_VIEW"];Me&&St.push("CUSTOM_ANTIALIASING");const Ft=V.isTileAffectedByFog(_t);pe=V.getOrCreateProgram("globeRaster",{defines:St,overrideFog:Ft}),de=xt},Ue=V.colorModeForRenderPass(),Pe=new sn(se.LEQUAL,sn.ReadWrite,V.depthRangeFor3D);Rl.update(ee);const Ne=r.dF(be),Oe=[r.aF(be.center.lng),r.aJ(be.center.lat)],Le=V.globeSharedBuffers,Ye=[be.width*r.o.devicePixelRatio,be.height*r.o.devicePixelRatio],ct=Float32Array.from(be.globeMatrix),rt={useDenormalizedUpVectorScale:!0};{const _t=V.transform,xt=Oc(_t.zoom,H.exaggeration(),H.sourceCache._source.tileSize);de=-1;const St=se.TRIANGLES;for(const Ft of K){const nt=Q.getTile(Ft),qe=fn.disabled,yt=H.prevTerrainTileForTile[Ft.key],pt=H.terrainTileForTile[Ft.key];to(yt,pt)&&Rl.newMorphing(Ft.key,yt,pt,ee,250),xu(V,nt.emissiveTexture),le.activeTexture.set(se.TEXTURE0),nt.texture&&nt.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Ut=Rl.getMorphValuesForProxy(Ft.key),ei=Ut?1:0;Ut&&Object.assign(rt,{morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:r.dD(Ut.phase)}});const vi=r.dG(Ft.canonical),ni=r.dH(vi.getCenter().lat),ti=r.dI(Ft.canonical,vi,ni,_t.worldSize/_t._pixelsPerMercatorPixel),Zi=r.bk(r.dJ(Ft.canonical)),Si=V.emissiveMode==="mrt-fallback"?1:0,Ai=ip(_t.expandedFarZProjMatrix,ct,Ne,Zi,r.aj(_t.zoom),Oe,_t.frustumCorners.TL,_t.frustumCorners.TR,_t.frustumCorners.BR,_t.frustumCorners.BL,_t.globeCenterInViewSpace,_t.globeRadius,Ye,xt,_t._farZ,Si,ti);if(we(Ft,ei),pe&&(H.setupElevationDraw(nt,pe,rt),V.uploadCommonUniforms(le,pe,Ft.toUnwrapped()),Le)){const[Oi,an,Mn]=Le.getGridBuffers(ni,xt!==0);pe.draw(V,St,Pe,qe,Ue,zn.backCCW,Ai,"globe_raster",Oi,an,Mn)}}}if(Le&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const _t=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Me&&_t.push("CUSTOM_ANTIALIASING"),pe=V.getOrCreateProgram("globeRaster",{defines:_t});for(const xt of K){const{x:St,y:Ft,z:nt}=xt.canonical,qe=Ft===0,yt=Ft===(1<<nt)-1,[pt,Ut,ei,vi]=Le.getPoleBuffers(nt,!1);if(vi&&(qe||yt)){const ni=Q.getTile(xt);xu(V,ni.emissiveTexture),le.activeTexture.set(se.TEXTURE0),ni.texture&&ni.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let ti=r.dK(nt,St,be);const Zi=r.bk(r.dJ(xt.canonical)),Si=V.emissiveMode==="mrt-fallback"?1:0,Ai=(Oi,an)=>Oi.draw(V,se.TRIANGLES,Pe,fn.disabled,Ue,zn.disabled,ip(be.expandedFarZProjMatrix,ti,ti,Zi,0,Oe,be.frustumCorners.TL,be.frustumCorners.TR,be.frustumCorners.BR,be.frustumCorners.BL,be.globeCenterInViewSpace,be.globeRadius,Ye,0,be._farZ,Si),"globe_pole_raster",an,ei,vi);H.setupElevationDraw(ni,pe,rt),V.uploadCommonUniforms(le,pe,xt.toUnwrapped()),qe&&V.renderDefaultNorthPole&&Ai(pe,pt),yt&&V.renderDefaultSouthPole&&(ti=r.cS(r.bC(),ti,[1,-1,1]),Ai(pe,Ut))}}}})(b,M,A,D,O);else{const V=b.context,H=V.gl;let Q,K;const ee=b.shadowRenderer,le=ou(b,b.longestCutoffRange),se=Ue=>{if(K===Ue)return;const Pe=[];Pe.push(np[Ue]),le.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF"),ee&&(Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ee.useNormalOffset&&Pe.push("NORMAL_OFFSET")),Q=b.getOrCreateProgram("terrainRaster",{defines:Pe}),K=Ue},pe=b.colorModeForRenderPass(),de=new sn(H.LEQUAL,sn.ReadWrite,b.depthRangeFor3D);Rl.update(O);const be=b.transform,Me=Oc(be.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let we=[0,0,0];if(ee){const Ue=b.style.directionalLight,Pe=b.style.ambientLight;Ue&&Pe&&(we=$a(b.style,Ue,Pe))}{K=-1;const Ue=H.TRIANGLES,[Pe,Ne]=[M.gridIndexBuffer,M.gridSegments];for(const Oe of D){const Le=A.getTile(Oe),Ye=fn.disabled,ct=M.prevTerrainTileForTile[Oe.key],rt=M.terrainTileForTile[Oe.key];to(ct,rt)&&Rl.newMorphing(Oe.key,ct,rt,O,250),xu(b,Le.emissiveTexture),V.activeTexture.set(H.TEXTURE0),Le.texture&&Le.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const _t=Rl.getMorphValuesForProxy(Oe.key),xt=_t?1:0;let St;_t&&(St={morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:r.dD(_t.phase)}});const Ft=b.emissiveMode==="mrt-fallback"?1:0,nt=nr(Oe.projMatrix,pc(Oe.canonical,be.renderWorldCopies)?Me/10:Me,we,Ft);if(se(xt),!Q)continue;M.setupElevationDraw(Le,Q,St);const qe=Oe.toUnwrapped();ee&&ee.setupShadows(qe,Q),b.uploadCommonUniforms(V,Q,qe,null,le),Q.draw(b,Ue,de,Ye,pe,zn.backCCW,nt,"terrain_raster",M.gridBuffer,Pe,Ne)}}}})(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,b=this.proxySourceCache,M=this.proxiedCoords[b.id],A=this._drapedRenderBatches.shift(),D=c.style.order,O=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let V=0;for(const H of M){const Q=b.getTileByID(H.proxyTileKey),K=b.proxyCachedFBO[H.key]?b.proxyCachedFBO[H.key][s]:void 0,ee=K!==void 0?b.renderCache[K]:this.pool[V++],le=K!==void 0;if(Q.texture=ee.tex,Q.emissiveTexture=ee.emissiveTex,le&&!ee.dirty){O.push(Q.tileID);continue}m.bindFramebuffer.set(ee.fb.framebuffer);const se=m.gl;let pe;se.drawBuffers(c.emissiveMode==="mrt-fallback"?[se.COLOR_ATTACHMENT0,se.COLOR_ATTACHMENT1]:[se.COLOR_ATTACHMENT0]),this.renderedToTile=!1,ee.dirty&&(m.clear({color:r.ao.transparent,stencil:0}),ee.dirty=!1);for(let de=A.start;de<=A.end;++de){const be=c.style._mergedLayers[D[de]];if(be.isHidden(c.transform.zoom))continue;const Me=c.style.getLayerSourceCache(be),we=Me?this.proxyToSource[H.key][Me.id]:[H];if(!we)continue;const Ue=we;m.viewport.set([0,0,ee.fb.width,ee.fb.height]),pe!==(Me?Me.id:null)&&(this._setupStencil(ee,we,be,Me),pe=Me?Me.id:null),c.renderLayer(c,Me,be,Ue)}if(se.drawBuffers([se.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const de of this._pendingGroundEffectLayers){const be=c.style._mergedLayers[D[de]];if(be.isHidden(c.transform.zoom))continue;const Me=c.style.getLayerSourceCache(be),we=Me?this.proxyToSource[H.key][Me.id]:[H];if(!we)continue;const Ue=we;m.viewport.set([0,0,ee.fb.width,ee.fb.height]),pe!==(Me?Me.id:null)&&(this._setupStencil(ee,we,be,Me),pe=Me?Me.id:null),c.renderLayer(c,Me,be,Ue)}this.renderedToTile?(ee.dirty=!0,O.push(Q.tileID)):le||--V,V===5&&(V=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),A.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let m=-1,b=c;for(let M=0;M<c;++M)this._style.isLayerDraped(s._mergedLayers[s.order[M]])?m=Math.max(m,M):b=Math.min(b,M);return b>m}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter((c=>c.dem)).forEach((c=>{s=Math.min(s,c.dem.tree.minimums[0])})),s===0?s:(s-30)*this._exaggeration}raycast(s,c,m){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter((M=>M.dem)).map((M=>{const A=M.tileID,D=1<<A.overscaledZ,{x:O,y:V}=A.canonical,H=O/D,Q=(O+1)/D,K=V/D,ee=(V+1)/D;return{minx:H,miny:K,maxx:Q,maxy:ee,t:M.dem.tree.raycastRoot(H,K,Q,ee,s,c,m),tile:M}}));b.sort(((M,A)=>(M.t!==null?M.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE)));for(const M of b){if(M.t==null)return null;const A=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,s,c,m);if(A!=null)return A}return null}_createFBO(){const s=this.painter.context,c=s.gl,m=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const b=new r.T(s,{width:m[0],height:m[1],data:null},c.RGBA8);b.bind(c.LINEAR,c.CLAMP_TO_EDGE);const M=s.createFramebuffer(m[0],m[1],1,null);let A;return M.colorAttachment0.set(b.texture),this._emissiveTexture&&(A=new r.T(s,{width:m[0],height:m[1],data:null},c.R8),A.bind(c.LINEAR,c.CLAMP_TO_EDGE),M.createColorAttachment(s,1),M.colorAttachment1.set(A.texture)),M.depthAttachment=new Gm(s,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:M,tex:b,emissiveTex:A,dirty:!1}}_updateFBOs(s){if(this._emissiveTexture!==s){for(const c of this.pool)this._updateFBO(c,s);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,s);this._emissiveTexture=s}}_updateFBO(s,c){const m=s.fb,b=this.painter.context,M=b.gl,A=this.drapeBufferSize;if(c){const D=new r.T(b,{width:A[0],height:A[1],data:null},M.R8);D.bind(M.LINEAR,M.CLAMP_TO_EDGE),s.emissiveTex=D,m.createColorAttachment(b,1),m.colorAttachment1.set(D.texture)}else s.emissiveTex=void 0,m.removeColorAttachment(b,1);s.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some((s=>{const c=this._style._mergedLayers[s],m=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()}))}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style.getSources())if(m instanceof bl){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const b=this._style._mergedLayers[this._style.order[m]],M=this._style.getLayerSourceCache(b);if(!M||c[M.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="line")continue;const A=b.widthExpression(),D=b.emissiveStrengthExpression();if(A instanceof r.ad||D instanceof r.ad){c[M.id]=!0;for(const O of this.proxyCoords){const V=this.proxyToSource[O.key][M.id];if(V)for(const H of V)this._clearRenderCacheForTile(M.id,H)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof Kr){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const b=this._style._mergedLayers[this._style.order[m]],M=this._style.getLayerSourceCache(b);if(!M||c[M.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const A=b.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const O=this.proxyToSource[D.key][M.id];if(O)for(const V of O){const H=dd(M.getTile(V),M.findLoadedParent(V,0),M,this.painter.transform,A);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(M.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,c=s.length;if(c===0)return;const m=[];this._pendingGroundEffectLayers=[];let b,M=0,A=this._style._mergedLayers[s[M]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++M<c;)A=this._style._mergedLayers[s[M]];for(;M<c;++M){const D=this._style._mergedLayers[s[M]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?b===void 0&&(b=M):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(M),b!==void 0&&(m.push({start:b,end:M-1}),b=void 0)))}if(b!==void 0&&m.push({start:b,end:M-1}),m.length!==0){const D=m[m.length-1];this._pendingGroundEffectLayers.every((O=>O>D.end))||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const A=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let D=0;D<A.length;++D){const O=Object.values(A[D]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,b=this._tilesDirty;for(let A=m.length-1;A>=0;A--){const D=m[A];if(c.getTileByID(D.key),c.proxyCachedFBO[D.key]!==void 0){const O=s[D.key],V=this.proxyToSource[D.key];let H=0;for(const Q in V){const K=V[Q],ee=O[Q];if(!ee||ee.length!==K.length||K.some(((le,se)=>le!==ee[se]||b[Q]&&b[Q].hasOwnProperty(le.key)))){H=-1;break}++H}for(const Q in c.proxyCachedFBO[D.key])c.renderCache[c.proxyCachedFBO[D.key][Q]].dirty=H<0||H!==Object.values(O).length}}const M=[...this._drapedRenderBatches];M.sort(((A,D)=>D.end-D.start-(A.end-A.start)));for(const A of M)for(const D of m){if(c.proxyCachedFBO[D.key])continue;let O=c.renderCachePool.pop();O===void 0&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),O!==void 0&&(c.proxyCachedFBO[D.key]={},c.proxyCachedFBO[D.key][A.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,m,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,A=M.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let D;if(m.isTileClipped())D=c.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):fn.disabled}_renderTileClippingMasks(s,c){const m=this.painter,b=this.painter.context,M=b.gl;m._tileClippingMaskIDs={},b.setColorMode($n.disabled),b.setDepthMode(sn.disabled);const A=m.getOrCreateProgram("clippingMask");for(const D of s){const O=m._tileClippingMaskIDs[D.key]=--c;A.draw(m,M.TRIANGLES,sn.disabled,new fn({func:M.ALWAYS,mask:0},O,255,M.KEEP,M.KEEP,M.REPLACE),$n.disabled,zn.disabled,fd(D.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const m=[s.x,s.y,1,1];r.aC(m,m,c.pixelMatrixInverse),r.cK(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const b=c._camera.position,M=r.cf(1,c.center.lat),A=[b[0],b[1],b[2]/M,0],D=r.da([],m.slice(0,3),A);r.aw(D,D);const O=this.raycast(A,D,this._exaggeration);return O!==null&&O?(r.bH(A,A,D,O),A[3]=A[2],A[2]*=M,A):null}_setupProxiedCoordsForOrtho(s,c,m){if(s.getSource()instanceof r.aU)return this._setupProxiedCoordsForImageSource(s,c,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const b=this.proxiedCoords[s.id]=[],M=this.proxyCoords;for(let O=0;O<M.length;O++){const V=M[O],H=this._findTileCoveringTileID(V,s);if(H){const Q=this._createProxiedId(V,H,m[V.key]&&m[V.key][s.id]);b.push(Q),this.proxyToSource[V.key][s.id]=[Q]}}let A=!1;const D=new Set;for(let O=0;O<c.length;O++){const V=s.getTile(c[O]);if(!V||!V.hasData())continue;const H=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==V.tileID.canonical.z){const Q=this.proxyToSource[H.tileID.key][s.id],K=this._createProxiedId(H.tileID,V,m[H.tileID.key]&&m[H.tileID.key][s.id]);Q?Q.splice(Q.length-1,0,K):this.proxyToSource[H.tileID.key][s.id]=[K];const ee=this.proxyToSource[H.tileID.key][s.id];D.has(ee)||D.add(ee),b.push(K),A=!0}}if(this._sourceTilesOverlap[s.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const O of D)O.sort(((V,H)=>H.overscaledZ-V.overscaledZ))}_setupProxiedCoordsForImageSource(s,c,m){if(!s.getSource().loaded())return;const b=this.proxiedCoords[s.id]=[],M=this.proxyCoords,A=s.getSource(),D=A.tileID;if(!D)return;const O=new r.P(D.x,D.y)._div(1<<D.z),V=A.coordinates.map(r.ae.fromLngLat).reduce(((Q,K)=>(Q.min.x=Math.min(Q.min.x,K.x-O.x),Q.min.y=Math.min(Q.min.y,K.y-O.y),Q.max.x=Math.max(Q.max.x,K.x-O.x),Q.max.y=Math.max(Q.max.y,K.y-O.y),Q)),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(Q,K)=>{const ee=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),le=Q.canonical.y/(1<<Q.canonical.z),se=r.al/(1<<Q.canonical.z),pe=K.wrap+K.canonical.x/(1<<K.canonical.z),de=K.canonical.y/(1<<K.canonical.z);return ee+se<pe+V.min.x||ee>pe+V.max.x||le+se<de+V.min.y||le>de+V.max.y};for(let Q=0;Q<M.length;Q++){const K=M[Q];for(let ee=0;ee<c.length;ee++){const le=s.getTile(c[ee]);if(!le||!le.hasData()||H(K,le.tileID))continue;const se=this._createProxiedId(K,le,m[K.key]&&m[K.key][s.id]),pe=this.proxyToSource[K.key][s.id];pe?pe.push(se):this.proxyToSource[K.key][s.id]=[se],b.push(se)}}}_createProxiedId(s,c,m){let b=this.orthoMatrix;if(m){const M=m.find((A=>A.key===c.tileID.key));if(M)return M}if(c.tileID.key!==s.key){const M=s.canonical.z-c.tileID.canonical.z;let A,D,O;b=r.bC();const V=c.tileID.wrap-s.wrap<<s.overscaledZ;M>0?(A=r.al>>M,D=A*((c.tileID.canonical.x<<M)-s.canonical.x+V),O=A*((c.tileID.canonical.y<<M)-s.canonical.y)):(A=r.al<<-M,D=r.al*(c.tileID.canonical.x-(s.canonical.x+V<<-M)),O=r.al*(c.tileID.canonical.y-(s.canonical.y<<-M))),r.ce(b,0,A,0,A,0,1),r.br(b,b,[D,O,0])}return new Bc(c.tileID,s.key,b)}_findTileCoveringTileID(s,c){let m=c.getTile(s);if(m&&m.hasData())return m;const b=this._findCoveringTileCache[c.id],M=b[s.key];if(m=M?c.getTileByID(M):null,m&&m.hasData()||M===null)return m;let A=m?m.tileID:s,D=A.overscaledZ;const O=c.getSource().minzoom,V=[];if(!M){const Q=c.getSource().maxzoom;if(s.canonical.z>=Q){const K=s.canonical.z-Q;c.getSource().reparseOverscaled?(D=Math.max(s.canonical.z+2,c.transform.tileZoom),A=new r.aQ(D,s.wrap,Q,s.canonical.x>>K,s.canonical.y>>K)):K!==0&&(D=Q,A=new r.aQ(D,s.wrap,Q,s.canonical.x>>K,s.canonical.y>>K))}A.key!==s.key&&(V.push(A.key),m=c.getTile(A))}const H=Q=>{V.forEach((K=>{b[K]=Q})),V.length=0};for(D-=1;D>=O&&(!m||!m.hasData());D--){m&&H(m.tileID.key);const Q=A.calculateScaledKey(D);if(m=c.getTileByID(Q),m&&m.hasData())break;const K=b[Q];if(K===null)break;K===void 0?V.push(Q):m=c.getTileByID(K)}return H(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[c.key]=!0}}function Lh(p,s,c){const m=(function(D,O,V){const H=r.bJ(O,D),Q=r.bJ(V,[.2126,.7152,.0722]),K=(le,se,pe)=>(1-pe)*le+pe*se,ee=K(1-.3*Math.min(Q,1),1,Math.min(H+1,1));return K(.92,1,Math.asin(r.aA(O[2],-1,1))/Math.PI+.5)*ee})(p,[0,0,1],s),b=[0,0,0];r.c5(b,c.slice(0,3),m);const M=[0,0,0];r.c5(M,s.slice(0,3),p[2]);const A=[0,0,0];return r.d8(A,b,M),r.db(A)}const xf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Gp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Nc{static cacheKey(s,c,m,b){const M=[c];b&&M.push(b.cacheKey);for(const A of m)s.usedDefines.has(A)&&M.push(A);return M.join("/")}constructor(s,c,m,b,M,A){const D=s.gl;this.program=D.createProgram(),this.configuration=b,this.name=c,this.fixedDefines=[...A];const O=`#version 300 es
${(b?b.defines():[]).concat(A.map((se=>`#define ${se}`))).join(`
`)}`,V=[O,s_];for(const se of m.fragmentIncludes)V.push(Ua[se]);V.push(m.fragmentSource);const H=V.join(`
`),Q=[O,Pc];for(const se of m.vertexIncludes)Q.push(Ua[se]);this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&m.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Q.push("uniform int u_instanceID;"),Q.push(m.vertexSource);let K=Q.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(K=K.replaceAll("gl_InstanceID","u_instanceID"));const ee=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(ee,H),D.compileShader(ee),D.attachShader(this.program,ee);const le=D.createShader(D.VERTEX_SHADER);D.isContextLost()?this.failedToCreate=!0:(D.shaderSource(le,K),D.compileShader(le),D.attachShader(this.program,le),this.attributes={},D.linkProgram(this.program),D.deleteShader(le),D.deleteShader(ee),this.fixedUniforms=M(s),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=b?b.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(se=>({u_instanceID:new r.ch(se)}))(s)),(A.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(se=>({u_dem:new r.ch(se),u_dem_prev:new r.ch(se),u_dem_tl:new r.ck(se),u_dem_scale:new r.cj(se),u_dem_tl_prev:new r.ck(se),u_dem_scale_prev:new r.cj(se),u_dem_size:new r.cj(se),u_dem_lerp:new r.cj(se),u_exaggeration:new r.cj(se),u_depth:new r.ch(se),u_depth_size_inv:new r.ck(se),u_depth_range_unpack:new r.ck(se),u_occluder_half_size:new r.cj(se),u_occlusion_depth_offset:new r.cj(se),u_meter_to_dem:new r.cj(se),u_label_plane_matrix_inv:new r.cl(se)}))(s)),A.includes("GLOBE")&&(this.globeUniforms=(se=>({u_tile_tl_up:new r.ci(se),u_tile_tr_up:new r.ci(se),u_tile_br_up:new r.ci(se),u_tile_bl_up:new r.ci(se),u_tile_up_scale:new r.cj(se)}))(s)),A.includes("FOG")&&(this.fogUniforms=(se=>({u_fog_matrix:new r.cl(se),u_fog_range:new r.ck(se),u_fog_color:new r.d3(se),u_fog_horizon_blend:new r.cj(se),u_fog_vertical_limit:new r.ck(se),u_fog_temporal_offset:new r.cj(se),u_frustum_tl:new r.ci(se),u_frustum_tr:new r.ci(se),u_frustum_br:new r.ci(se),u_frustum_bl:new r.ci(se),u_globe_pos:new r.ci(se),u_globe_radius:new r.cj(se),u_globe_transition:new r.cj(se),u_is_globe:new r.ch(se),u_viewport:new r.ck(se)}))(s)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(se=>({u_cutoff_params:new r.d3(se)}))(s)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(se=>({u_lighting_ambient_color:new r.ci(se),u_lighting_directional_dir:new r.ci(se),u_lighting_directional_color:new r.ci(se),u_ground_radiance:new r.ci(se)}))(s)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(se=>({u_light_matrix_0:new r.cl(se),u_light_matrix_1:new r.cl(se),u_fade_range:new r.ck(se),u_shadow_normal_offset:new r.ci(se),u_shadow_intensity:new r.cj(se),u_shadow_texel_size:new r.cj(se),u_shadow_map_resolution:new r.cj(se),u_shadow_direction:new r.ci(se),u_shadow_bias:new r.ci(se),u_shadowmap_0:new r.ch(se),u_shadowmap_1:new r.ch(se)}))(s)))}getAttributeLocation(s,c){let m=this.attributes[c];return m===void 0&&(m=this.attributes[c]=s.getAttribLocation(this.program,c)),m}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in c)m[b]&&m[b].set(this.program,b,c[b])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in c)m[b]&&m[b].set(this.program,b,c[b])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in c)m[b].set(this.program,b,c[b])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in c)m[b].set(this.program,b,c[b])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in c)m[b].set(this.program,b,c[b])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;s.program.set(this.program);for(const b in c)m[b].set(this.program,b,c[b])}_drawDebugWireframe(s,c,m,b,M,A,D,O,V,H){const Q=s.options.wireframe;if(Q.terrain===!1&&Q.layers2D===!1&&Q.layers3D===!1)return;const K=s.context;if(!(!(!Q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Q.layers2D||s._terrain&&s._terrain.renderingToTexture||!xf.includes(this.name))||!(!Q.layers3D||!Gp.includes(this.name))))return;const ee=K.gl,le=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,M,K);if(!le)return;const se=[...this.fixedDefines,"DEBUG_WIREFRAME"],pe=s.getOrCreateProgram(this.name,{config:this.configuration,defines:se});K.program.set(pe.program);const de=(we,Ue,Pe)=>{if(Ue[we]&&Pe[we])for(const Ne in Ue[we])Pe[we][Ne]&&Pe[we][Ne].set(Pe.program,Ne,Ue[we][Ne].current)};V&&V.setUniforms(pe.program,K,pe.binderUniforms,D,{zoom:O}),de("fixedUniforms",this,pe),de("terrainUniforms",this,pe),de("globeUniforms",this,pe),de("fogUniforms",this,pe),de("lightsUniforms",this,pe),de("shadowUniforms",this,pe),le.bind(),K.setColorMode(new $n([ee.ONE,ee.ONE_MINUS_SRC_ALPHA,ee.ZERO,ee.ONE],r.ao.transparent,[!0,!0,!0,!1])),K.setDepthMode(new sn(c.func===ee.LESS?ee.LEQUAL:c.func,sn.ReadOnly,c.range)),K.setStencilMode(fn.disabled);const be=3*A.primitiveLength*2,Me=3*A.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const we=H||1;for(let Ue=0;Ue<we;++Ue)pe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ue),ee.drawElements(ee.LINES,be,ee.UNSIGNED_SHORT,Me)}else H&&H>1?ee.drawElementsInstanced(ee.LINES,be,ee.UNSIGNED_SHORT,Me,H):ee.drawElements(ee.LINES,be,ee.UNSIGNED_SHORT,Me);M.bind(),K.program.set(this.program),K.setDepthMode(c),K.setStencilMode(m),K.setColorMode(b)}checkUniforms(s,c,m){if(this.fixedDefines.includes(c)){for(const b of Object.keys(m))if(!m[b].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${b} not set but required by ${c} being defined`)}}draw(s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe){const de=s.context,be=de.gl;if(this.failedToCreate)return;de.program.set(this.program),de.setDepthMode(m),de.setStencilMode(b),de.setColorMode(M),de.setCullFace(A);for(const[Oe,Le]of this.fixedUniformsEntries)Le.set(this.program,Oe,D[Oe]);le&&le.setUniforms(this.program,de,this.binderUniforms,K,{zoom:ee});const Me={[be.POINTS]:1,[be.LINES]:2,[be.TRIANGLES]:3,[be.LINE_STRIP]:1}[c];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const we=se||[],Ue=le?le.getPaintVertexBuffers():[],Pe=c===be.TRIANGLES&&H,Ne=pe&&pe>0?1:void 0;for(const Oe of Q.get()){const Le=Oe.vaos||(Oe.vaos={});if((Le[O]||(Le[O]=new cd)).bind(de,this,V,Ue,H,Oe.vertexOffset,we,Ne),this.forceManualRenderingForInstanceIDShaders){const Ye=pe||1;for(let ct=0;ct<Ye;++ct)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ct),H?be.drawElements(c,Oe.primitiveLength*Me,be.UNSIGNED_SHORT,Oe.primitiveOffset*Me*2):be.drawArrays(c,Oe.vertexOffset,Oe.vertexLength)}else pe&&pe>1?be.drawElementsInstanced(c,Oe.primitiveLength*Me,be.UNSIGNED_SHORT,Oe.primitiveOffset*Me*2,pe):H?be.drawElements(c,Oe.primitiveLength*Me,be.UNSIGNED_SHORT,Oe.primitiveOffset*Me*2):be.drawArrays(c,Oe.vertexOffset,Oe.vertexLength);Pe&&this._drawDebugWireframe(s,m,b,M,H,Oe,K,ee,le,pe)}}}function rp(p,s,c=0){const m=Math.pow(2,s.tileID.overscaledZ),b=s.tileSize*Math.pow(2,p.transform.tileZoom)/m,M=b*(s.tileID.canonical.x+s.tileID.wrap*m),A=b*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(s,1,p.transform.tileZoom),u_pixel_coord_upper:[M>>16,A>>16],u_pixel_coord_lower:[65535&M,65535&A],u_pattern_transition:c}}const Hp={terrain:0,flat:1},xg=r.bC(),eh=(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de)=>{const be=s.style.light,Me=be.properties.get("position"),we=[Me.x,Me.y,Me.z],Ue=r.dO();be.properties.get("anchor")==="viewport"&&(r.dP(Ue,-s.transform.angle),r.dQ(we,we,Ue));const Pe=be.properties.get("color").toPremultipliedRenderColor(null),Ne=s.transform,Oe={u_matrix:p,u_lightpos:we,u_lightintensity:be.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Hp[V],u_base_type:Hp[H],u_ao:b,u_edge_radius:M,u_width_scale:A,u_flood_light_color:le,u_vertical_scale:se,u_flood_light_intensity:pe,u_ground_shadow_factor:de};return Ne.projection.name==="globe"&&(Oe.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],Oe.u_zoom_transition=Q,Oe.u_inv_rot_matrix=ee,Oe.u_merc_center=K,Oe.u_up_dir=Ne.projection.upVector(new r.cD(0,0,0),K[0]*r.al,K[1]*r.al),Oe.u_height_lift=O),Oe},Vr=(p,s,c,m,b,M)=>({u_matrix:p,u_edge_radius:s,u_width_scale:c,u_vertical_scale:m,u_height_type:Hp[b],u_base_type:Hp[M]}),jp=(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de)=>{const be=eh(p,s,c,m,b,M,A,D,V,H,Q,K,ee,le,se,pe,1,[0,0,0]),Me={u_height_factor:-Math.pow(2,D.overscaledZ)/O.tileSize/8};return Object.assign(be,rp(s,O,de),Me)},vf=(p,s,c,m,b,M,A,D,O,V,H)=>({u_matrix:s,u_opacity:c,u_ao_pass:m?1:0,u_meter_to_tile:b,u_ao:M,u_flood_light_intensity:A,u_flood_light_color:D,u_attenuation:O,u_edge_radius:V,u_fb:0,u_fb_size:H,u_dynamic_offset:1}),th=(p,s,c)=>({u_matrix:p,u_emissive_strength:s,u_ground_shadow_factor:c}),ih=(p,s,c,m,b,M=0)=>Object.assign(th(p,s,b),rp(c,m,M)),qp=(p,s,c,m)=>({u_matrix:p,u_world:c,u_emissive_strength:s,u_ground_shadow_factor:m}),pd=(p,s,c,m,b,M,A=0)=>Object.assign(ih(p,s,c,m,M,A),{u_world:b}),Fc=(p,s)=>({u_matrix:p,u_ground_shadow_factor:s}),Uc=(p,s,c,m,b)=>({u_matrix:p,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:c,u_height_scale:m,u_reset_depth:b}),nh=(p,s,c,m,b,M,A,D,O)=>({u_matrix:p,u_normal_matrix:s,u_opacity:c,u_faux_facade_ao_intensity:m,u_camera_pos:b,u_tile_to_meter:M,u_facade_emissive_chance:A,u_flood_light_color:D,u_flood_light_intensity:O}),vg=p=>({u_matrix:p}),Il=p=>({u_matrix:p}),Xp=(p,s,c,m,b,M,A,D)=>{const O=r.al/M.tileSize;return{u_matrix:p,u_inv_rot_matrix:s,u_camera_to_center_distance:c.getCameraToCenterDistance(D),u_extrude_scale:[c.pixelsToGLUnits[0]/O,c.pixelsToGLUnits[1]/O],u_zoom_transition:m,u_tile_id:A,u_merc_center:b}},md=(p,s,c=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:c}),vu=r.bC(),rh=(p,s,c,m,b,M,A)=>{const D=p.transform,O=D.projection.name==="globe",V=O?r.dR(D.zoom,s.canonical)*D._pixelsPerMercatorPixel:r.ay(c,1,M),H={u_matrix:s.projMatrix,u_extrude_scale:V,u_intensity:A,u_inv_rot_matrix:vu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){H.u_inv_rot_matrix=m,H.u_merc_center=b,H.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],H.u_zoom_transition=r.aj(D.zoom);const Q=b[0]*r.al,K=b[1]*r.al;H.u_up_dir=D.projection.upVector(new r.cD(0,0,0),Q,K)}return H};function bu(p,[s,c,m,b],[M,A]){if(M===A)return[0,0,0,0];const D=255*(p-1)/(p*(A-M));return[s*D,c*D,m*D,b*D]}function gd(p,s,[c,m]){return c===m?0:.5/p+(s-c)*(p-1)/(p*(m-c))}const Hm=(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de,be,Me,we)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:b,u_tl_parent:M,u_scale_parent:V,u_fade_t:H.mix,u_opacity:H.opacity*Q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Q.paint.get("raster-brightness-min"),u_brightness_high:Q.paint.get("raster-brightness-max"),u_saturation_factor:r.dT(Q.paint.get("raster-saturation")),u_contrast_factor:r.dS(Q.paint.get("raster-contrast")),u_spin_weights:sp(Q.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:ee,u_zoom_transition:A,u_merc_center:D,u_cutoff_params:O,u_colorization_mix:bu(r.dU,se,de),u_colorization_offset:gd(r.dU,pe,de),u_color_ramp:le,u_texture_offset:[Me/(be+2*Me),be/(be+2*Me)],u_texture_res:[be+2*Me,be+2*Me],u_emissive_strength:we});function sp(p){p*=Math.PI/180;const s=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const ll=.05,sh=(p,s,c,m,b,M,A,D,O,V,H,Q)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:b,u_tl_parent:M,u_scale_parent:V,u_fade_t:H.mix,u_opacity:H.opacity,u_image0:0,u_image1:1,u_raster_elevation:Q,u_zoom_transition:A,u_merc_center:D,u_cutoff_params:O}),Yo=(p,s,c,m,b,M,A,D,O,V)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:m,u_color_ramp:M,u_velocity_res:b,u_max_speed:A,u_uv_offset:D,u_data_scale:[255*O[0],255*O[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[ll,ll]}),Yl=(p,s,c,m,b,M,A,D,O,V)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:m,u_max_speed:b,u_speed_factor:M,u_reset_rate:A,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*O[0],255*O[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[ll,ll]}),cl=r.bC(),ap=(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de,be,Me,we,Ue,Pe,Ne)=>{const Oe=b.transform,Le={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Oe.getCameraToCenterDistance(be),u_rotate_symbol:+c,u_aspect_ratio:Oe.width/Oe.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:A,u_coord_matrix:D,u_is_text:+V,u_elevation_from_sea:O?1:0,u_pitch_with_map:+m,u_texsize:H,u_texsize_icon:Q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:cl,u_up_vector:[0,-1,0],u_color_adj_mat:Ue,u_icon_transition:Pe||0,u_gamma_scale:m?b.transform.getCameraToCenterDistance(be)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ne||1,u_ground_shadow_factor:Me,u_inv_matrix:r.bl(r.bC(),A),u_normal_scale:we,u_lutTexture:ts.LUT};return be.name==="globe"&&(Le.u_tile_id=[ee.canonical.x,ee.canonical.y,1<<ee.canonical.z],Le.u_zoom_transition=le,Le.u_inv_rot_matrix=pe,Le.u_merc_center=se,Le.u_camera_forward=Oe._camera.forward(),Le.u_ecef_origin=r.dV(Oe.globeMatrix,ee.toUnwrapped()),Le.u_tile_matrix=Float32Array.from(Oe.globeMatrix),Le.u_up_vector=de),Le},_d=(p,s,c,m)=>({u_matrix:p,u_emissive_strength:s,u_opacity:c,u_color:m}),ka=(p,s,c,m,b,M,A,D,O)=>Object.assign((function(V,H,Q,K,ee,le){const{width:se,height:pe}=K.imageManager.getPixelSize(H),de=Math.pow(2,le.tileID.overscaledZ),be=le.tileSize*Math.pow(2,K.transform.tileZoom)/de,Me=be*(le.tileID.canonical.x+le.tileID.wrap*de),we=be*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[se,pe],u_pattern_size:Q.displaySize,u_pattern_units_to_pixels:ee?[K.transform.width,-1*K.transform.height]:[1/r.ay(le,1,K.transform.tileZoom),1/r.ay(le,1,K.transform.tileZoom)],u_pixel_coord_upper:[Me>>16,we>>16],u_pixel_coord_lower:[65535&Me,65535&we]}})(0,M,A,m,D,O),{u_matrix:p,u_emissive_strength:s,u_opacity:c}),La=new Float32Array(r.bA([])),Oo=(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee=[0,0,0],le,se,pe)=>{const de=b.style.light,be=de.properties.get("position"),Me=[-be.x,-be.y,be.z],we=r.dO();de.properties.get("anchor")==="viewport"&&(r.dP(we,-b.transform.angle),r.dQ(Me,Me,we));const Ue=H.alphaMode==="MASK",Pe=de.properties.get("color").toNonPremultipliedRenderColor(null),Ne=K.paint.get("model-ambient-occlusion-intensity"),Oe=K.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return Oe.a=K.paint.get("model-color-mix-intensity").constantOr(0),pe&&(Oe.r=pe[0],Oe.g=pe[1],Oe.b=pe[2],Oe.a=pe[3]),se&&(Oe.r=se.color.r,Oe.g=se.color.g,Oe.b=se.color.b,Oe.a=se.colorMix,Q=se.emissionStrength,M*=se.opacity),{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:m||La,u_lightpos:Me,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_camera_pos:ee,u_opacity:M,u_baseTextureIsAlpha:0,u_alphaMask:+Ue,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:D.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:V,u_baseColorTexture:ts.BaseColor,u_metallicRoughnessTexture:ts.MetallicRoughness,u_normalTexture:ts.Normal,u_occlusionTexture:ts.Occlusion,u_emissionTexture:ts.Emission,u_lutTexture:ts.LUT,u_color_mix:Oe.toArray01(),u_aoIntensity:Ne,u_emissive_strength:Q,u_occlusionTextureTransform:le||[0,0,0,0]}},ah=(p,s=La,c=La)=>({u_matrix:p,u_instance:s,u_node_matrix:c}),op={fillExtrusion:p=>({u_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_vertical_gradient:new r.cj(p),u_opacity:new r.cj(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_ao:new r.ck(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_up_dir:new r.ci(p),u_height_lift:new r.cj(p),u_flood_light_color:new r.ci(p),u_vertical_scale:new r.cj(p),u_flood_light_intensity:new r.cj(p),u_ground_shadow_factor:new r.ci(p)}),fillExtrusionDepth:p=>({u_matrix:new r.cl(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_vertical_scale:new r.cj(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p)}),fillExtrusionPattern:p=>({u_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_vertical_gradient:new r.cj(p),u_height_factor:new r.cj(p),u_edge_radius:new r.cj(p),u_width_scale:new r.cj(p),u_ao:new r.ck(p),u_height_type:new r.ch(p),u_base_type:new r.ch(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_up_dir:new r.ci(p),u_height_lift:new r.cj(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_opacity:new r.cj(p),u_pattern_transition:new r.cj(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.cl(p),u_opacity:new r.cj(p),u_ao_pass:new r.cj(p),u_meter_to_tile:new r.cj(p),u_ao:new r.ck(p),u_flood_light_intensity:new r.cj(p),u_flood_light_color:new r.ci(p),u_attenuation:new r.cj(p),u_edge_radius:new r.cj(p),u_fb:new r.ch(p),u_fb_size:new r.cj(p),u_dynamic_offset:new r.cj(p)}),fill:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_ground_shadow_factor:new r.ci(p)}),fillPattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_pattern_transition:new r.cj(p)}),fillOutline:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_world:new r.ck(p),u_ground_shadow_factor:new r.ci(p)}),fillOutlinePattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_world:new r.ck(p),u_image:new r.ch(p),u_texsize:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_tile_units_to_pixels:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_pattern_transition:new r.cj(p)}),building:p=>({u_matrix:new r.cl(p),u_normal_matrix:new r.cl(p),u_opacity:new r.cj(p),u_faux_facade_ao_intensity:new r.cj(p),u_camera_pos:new r.ci(p),u_tile_to_meter:new r.cj(p),u_facade_emissive_chance:new r.cj(p),u_flood_light_color:new r.ci(p),u_flood_light_intensity:new r.cj(p)}),buildingBloom:p=>({u_matrix:new r.cl(p)}),buildingDepth:p=>({u_matrix:new r.cl(p)}),elevatedStructuresDepth:p=>({u_matrix:new r.cl(p),u_depth_bias:new r.cj(p)}),elevatedStructures:p=>({u_matrix:new r.cl(p),u_ground_shadow_factor:new r.ci(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new r.cl(p),u_camera_pos:new r.ci(p),u_depth_bias:new r.cj(p),u_height_scale:new r.cj(p),u_reset_depth:new r.cj(p)}),circle:r.dY,collisionBox:p=>({u_matrix:new r.cl(p),u_inv_rot_matrix:new r.cl(p),u_camera_to_center_distance:new r.cj(p),u_extrude_scale:new r.ck(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_tile_id:new r.ci(p)}),collisionCircle:p=>({u_matrix:new r.cl(p),u_inv_matrix:new r.cl(p),u_camera_to_center_distance:new r.cj(p),u_viewport_size:new r.ck(p)}),debug:p=>({u_color:new r.dB(p),u_matrix:new r.cl(p),u_overlay:new r.ch(p),u_overlay_scale:new r.cj(p)}),clippingMask:p=>({u_matrix:new r.cl(p)}),heatmap:p=>({u_extrude_scale:new r.cj(p),u_intensity:new r.cj(p),u_matrix:new r.cl(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_up_dir:new r.ci(p)}),heatmapTexture:p=>({u_image:new r.ch(p),u_color_ramp:new r.ch(p),u_opacity:new r.cj(p)}),hillshade:p=>({u_matrix:new r.cl(p),u_image:new r.ch(p),u_latrange:new r.ck(p),u_light:new r.ck(p),u_shadow:new r.dB(p),u_highlight:new r.dB(p),u_emissive_strength:new r.cj(p),u_accent:new r.dB(p)}),hillshadePrepare:p=>({u_matrix:new r.cl(p),u_image:new r.ch(p),u_dimension:new r.ck(p),u_zoom:new r.cj(p)}),line:r.dX,linePattern:r.dW,raster:p=>({u_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_grid_matrix:new r.dC(p),u_tl_parent:new r.ck(p),u_scale_parent:new r.cj(p),u_fade_t:new r.cj(p),u_opacity:new r.cj(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_brightness_low:new r.cj(p),u_brightness_high:new r.cj(p),u_saturation_factor:new r.cj(p),u_contrast_factor:new r.cj(p),u_spin_weights:new r.ci(p),u_perspective_transform:new r.ck(p),u_raster_elevation:new r.cj(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_cutoff_params:new r.d3(p),u_colorization_mix:new r.d3(p),u_colorization_offset:new r.cj(p),u_color_ramp:new r.ch(p),u_texture_offset:new r.ck(p),u_texture_res:new r.ck(p),u_emissive_strength:new r.cj(p)}),rasterParticle:p=>({u_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_grid_matrix:new r.dC(p),u_tl_parent:new r.ck(p),u_scale_parent:new r.cj(p),u_fade_t:new r.cj(p),u_opacity:new r.cj(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_raster_elevation:new r.cj(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_cutoff_params:new r.d3(p)}),rasterParticleTexture:p=>({u_texture:new r.ch(p),u_opacity:new r.cj(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.ch(p),u_particle_texture_side_len:new r.cj(p),u_tile_offset:new r.ck(p),u_velocity:new r.ch(p),u_color_ramp:new r.ch(p),u_velocity_res:new r.ck(p),u_max_speed:new r.cj(p),u_uv_offset:new r.ck(p),u_data_scale:new r.ck(p),u_data_offset:new r.cj(p),u_particle_pos_scale:new r.cj(p),u_particle_pos_offset:new r.ck(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.ch(p),u_particle_texture_side_len:new r.cj(p),u_velocity:new r.ch(p),u_velocity_res:new r.ck(p),u_max_speed:new r.cj(p),u_speed_factor:new r.cj(p),u_reset_rate:new r.cj(p),u_rand_seed:new r.cj(p),u_uv_offset:new r.ck(p),u_data_scale:new r.ck(p),u_data_offset:new r.cj(p),u_particle_pos_scale:new r.cj(p),u_particle_pos_offset:new r.ck(p)}),symbol:p=>({u_is_size_zoom_constant:new r.ch(p),u_is_size_feature_constant:new r.ch(p),u_size_t:new r.cj(p),u_size:new r.cj(p),u_camera_to_center_distance:new r.cj(p),u_rotate_symbol:new r.ch(p),u_aspect_ratio:new r.cj(p),u_fade_change:new r.cj(p),u_matrix:new r.cl(p),u_label_plane_matrix:new r.cl(p),u_coord_matrix:new r.cl(p),u_is_text:new r.ch(p),u_elevation_from_sea:new r.ch(p),u_pitch_with_map:new r.ch(p),u_texsize:new r.ck(p),u_texsize_icon:new r.ck(p),u_texture:new r.ch(p),u_texture_icon:new r.ch(p),u_gamma_scale:new r.cj(p),u_device_pixel_ratio:new r.cj(p),u_tile_id:new r.ci(p),u_zoom_transition:new r.cj(p),u_inv_rot_matrix:new r.cl(p),u_merc_center:new r.ck(p),u_camera_forward:new r.ci(p),u_tile_matrix:new r.cl(p),u_up_vector:new r.ci(p),u_ecef_origin:new r.ci(p),u_is_halo:new r.ch(p),u_icon_transition:new r.cj(p),u_color_adj_mat:new r.cl(p),u_scale_factor:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_inv_matrix:new r.cl(p),u_normal_scale:new r.cj(p),u_lutTexture:new r.ch(p)}),background:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_opacity:new r.cj(p),u_color:new r.dB(p)}),backgroundPattern:p=>({u_matrix:new r.cl(p),u_emissive_strength:new r.cj(p),u_opacity:new r.cj(p),u_image:new r.ch(p),u_pattern_tl:new r.ck(p),u_pattern_br:new r.ck(p),u_texsize:new r.ck(p),u_pattern_size:new r.ck(p),u_pixel_coord_upper:new r.ck(p),u_pixel_coord_lower:new r.ck(p),u_pattern_units_to_pixels:new r.ck(p)}),terrainRaster:p=>({u_matrix:new r.cl(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_skirt_height:new r.cj(p),u_ground_shadow_factor:new r.ci(p),u_emissive_texture_available:new r.cj(p)}),skybox:p=>({u_matrix:new r.cl(p),u_sun_direction:new r.ci(p),u_cubemap:new r.ch(p),u_opacity:new r.cj(p),u_temporal_offset:new r.cj(p)}),skyboxGradient:p=>({u_matrix:new r.cl(p),u_color_ramp:new r.ch(p),u_center_direction:new r.ci(p),u_radius:new r.cj(p),u_opacity:new r.cj(p),u_temporal_offset:new r.cj(p)}),skyboxCapture:p=>({u_matrix_3f:new r.dC(p),u_sun_direction:new r.ci(p),u_sun_intensity:new r.cj(p),u_color_tint_r:new r.d3(p),u_color_tint_m:new r.d3(p),u_luminance:new r.cj(p)}),globeRaster:p=>({u_proj_matrix:new r.cl(p),u_globe_matrix:new r.cl(p),u_normalize_matrix:new r.cl(p),u_merc_matrix:new r.cl(p),u_zoom_transition:new r.cj(p),u_merc_center:new r.ck(p),u_image0:new r.ch(p),u_image1:new r.ch(p),u_grid_matrix:new r.dC(p),u_skirt_height:new r.cj(p),u_far_z_cutoff:new r.cj(p),u_frustum_tl:new r.ci(p),u_frustum_tr:new r.ci(p),u_frustum_br:new r.ci(p),u_frustum_bl:new r.ci(p),u_globe_pos:new r.ci(p),u_globe_radius:new r.cj(p),u_viewport:new r.ck(p),u_emissive_texture_available:new r.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.ci(p),u_frustum_tr:new r.ci(p),u_frustum_br:new r.ci(p),u_frustum_bl:new r.ci(p),u_horizon:new r.cj(p),u_transition:new r.cj(p),u_fadeout_range:new r.cj(p),u_atmosphere_fog_color:new r.d3(p),u_high_color:new r.d3(p),u_space_color:new r.d3(p),u_temporal_offset:new r.cj(p),u_horizon_angle:new r.cj(p)}),model:p=>({u_matrix:new r.cl(p),u_lighting_matrix:new r.cl(p),u_normal_matrix:new r.cl(p),u_node_matrix:new r.cl(p),u_lightpos:new r.ci(p),u_lightintensity:new r.cj(p),u_lightcolor:new r.ci(p),u_camera_pos:new r.ci(p),u_opacity:new r.cj(p),u_baseColorFactor:new r.d3(p),u_emissiveFactor:new r.d3(p),u_metallicFactor:new r.cj(p),u_roughnessFactor:new r.cj(p),u_baseTextureIsAlpha:new r.ch(p),u_alphaMask:new r.ch(p),u_alphaCutoff:new r.cj(p),u_baseColorTexture:new r.ch(p),u_metallicRoughnessTexture:new r.ch(p),u_normalTexture:new r.ch(p),u_occlusionTexture:new r.ch(p),u_emissionTexture:new r.ch(p),u_lutTexture:new r.ch(p),u_color_mix:new r.d3(p),u_aoIntensity:new r.cj(p),u_emissive_strength:new r.cj(p),u_occlusionTextureTransform:new r.d3(p)}),modelDepth:p=>({u_matrix:new r.cl(p),u_instance:new r.cl(p),u_node_matrix:new r.cl(p)}),groundShadow:p=>({u_matrix:new r.cl(p),u_ground_shadow_factor:new r.ci(p)}),stars:p=>({u_matrix:new r.cl(p),u_up:new r.ci(p),u_right:new r.ci(p),u_intensity_multiplier:new r.cj(p)}),snowParticle:p=>({u_modelview:new r.cl(p),u_projection:new r.cl(p),u_time:new r.cj(p),u_cam_pos:new r.ci(p),u_velocityConeAperture:new r.cj(p),u_velocity:new r.cj(p),u_horizontalOscillationRadius:new r.cj(p),u_horizontalOscillationRate:new r.cj(p),u_boxSize:new r.cj(p),u_billboardSize:new r.cj(p),u_simpleShapeParameters:new r.ck(p),u_screenSize:new r.ck(p),u_thinningCenterPos:new r.ck(p),u_thinningShape:new r.ci(p),u_thinningAffectedRatio:new r.cj(p),u_thinningParticleOffset:new r.cj(p),u_particleColor:new r.d3(p),u_direction:new r.ci(p)}),rainParticle:p=>({u_modelview:new r.cl(p),u_projection:new r.cl(p),u_time:new r.cj(p),u_cam_pos:new r.ci(p),u_texScreen:new r.ch(p),u_velocityConeAperture:new r.cj(p),u_velocity:new r.cj(p),u_boxSize:new r.cj(p),u_rainDropletSize:new r.ck(p),u_distortionStrength:new r.cj(p),u_rainDirection:new r.ci(p),u_color:new r.d3(p),u_screenSize:new r.ck(p),u_thinningCenterPos:new r.ck(p),u_thinningShape:new r.ci(p),u_thinningAffectedRatio:new r.cj(p),u_thinningParticleOffset:new r.cj(p),u_shapeDirectionalPower:new r.cj(p),u_shapeNormalPower:new r.cj(p),u_mode:new r.cj(p)}),vignette:p=>({u_vignetteShape:new r.ci(p),u_vignetteColor:new r.d3(p)}),occlusion:p=>({u_matrix:new r.cl(p),u_anchorPos:new r.ci(p),u_screenSizePx:new r.ck(p),u_occluderSizePx:new r.ck(p),u_color:new r.d3(p)})};class kc{constructor(s,c,m,b){this.id=kc.uniqueIdxCounter,kc.uniqueIdxCounter++,this.context=s;const M=s.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||b||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=kc.uniqueIdxCounter,kc.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}kc.uniqueIdxCounter=0;const wu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(s,c,m,b,M,A){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=b,this.instanceCount=A,this.context=s;const D=s.gl;this.buffer=D.createBuffer(),s.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||M||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let m=0;m<this.attributes.length;m++){const b=c.getAttributeLocation(s,this.attributes[m].name);b!==-1&&s.enableVertexAttribArray(b)}}setVertexAttribPointers(s,c,m){for(let b=0;b<this.attributes.length;b++){const M=this.attributes[b],A=c.getAttributeLocation(s,M.name);A!==-1&&s.vertexAttribPointer(A,M.components,s[wu[M.type]],!1,this.itemSize,M.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(s,c,m){for(let b=0;b<this.attributes.length;b++){const M=c.getAttributeLocation(s,this.attributes[b].name);M!==-1&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(M,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Va{constructor(s,c,m,b,M){this.context=s,this.width=c,this.height=m;const A=this.framebuffer=s.gl.createFramebuffer();b>0&&(this.colorAttachment0=new ep(s,A,0)),b>1&&(this.colorAttachment1=new ep(s,A,1)),M&&(this.depthAttachmentType=M,this.depthAttachment=M==="renderbuffer"?new hd(s,A):new tp(s,A))}createColorAttachment(s,c){c===0?this.colorAttachment0=new ep(s,this.framebuffer,0):c===1&&(this.colorAttachment1=new ep(s,this.framebuffer,1))}removeColorAttachment(s,c){const m=this.context.gl;let b;c===0?(b=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(b=this.colorAttachment1.get(),this.colorAttachment1=void 0),b&&m.deleteTexture(b)}destroy(){const s=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&s.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class Ph{constructor(s,c){this.gl=s,this.clearColor=new Yu(this),this.clearDepth=new mu(this),this.clearStencil=new gu(this),this.colorMask=new Kd(this),this.depthMask=new $d(this),this.stencilMask=new Wl(this),this.stencilFunc=new Ku(this),this.stencilOp=new Xa(this),this.stencilTest=new ea(this),this.depthRange=new zs(this),this.depthTest=new _u(this),this.depthFunc=new vo(this),this.blend=new Ch(this),this.blendFunc=new ws(this),this.blendColor=new ud(this),this.blendEquation=new Um(this),this.cullFace=new $u(this),this.cullFaceSide=new yu(this),this.frontFace=new km(this),this.program=new Jd(this),this.activeTexture=new Vm(this),this.viewport=new Zl(this),this.bindFramebuffer=new Zo(this),this.bindRenderbuffer=new Rh(this),this.bindTexture=new zc(this),this.bindVertexBuffer=new Ih(this),this.bindElementBuffer=new Qd(this),this.bindVertexArrayOES=new Ju(this),this.pixelStoreUnpack=new gf(this),this.pixelStoreUnpackPremultiplyAlpha=new Dh(this),this.pixelStoreUnpackFlipY=new bo(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=s.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,m){return new kc(this,s,c,m)}createVertexBuffer(s,c,m,b,M){return new Kl(this,s,c,m,b,M)}createRenderbuffer(s,c,m){const b=this.gl,M=b.createRenderbuffer();return this.bindRenderbuffer.set(M),b.renderbufferStorage(b.RENDERBUFFER,s,c,m),this.bindRenderbuffer.set(null),M}createFramebuffer(s,c,m,b){return new Va(this,s,c,m,b)}clear({color:s,depth:c,stencil:m,colorMask:b}){const M=this.gl;let A=0;s&&(A|=M.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(b||[!0,!0,!0,!0])),c!==void 0&&(A|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(A|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),M.clear(A)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){r.by(s.blendFunction,$n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let po;function oi(p,s,c,m,b,M,A){const D=p.context,O=D.gl,V=p.transform,H=[r.aF(V.center.lng),r.aJ(V.center.lat)],Q=c.layout.get("symbol-placement"),K=c.layout.get("text-variable-anchor"),ee=c.layout.get("icon-rotation-alignment")==="map",le=c.layout.get("text-rotation-alignment")==="map",se=Q!=="point",pe=[];let de=0,be=0;for(let Le=0;Le<m.length;Le++){const Ye=m[Le],ct=s.getTile(Ye),rt=ct.getBucket(c);if(!rt)continue;const _t=rt.getProjection().createInversionMatrix(V,Ye.canonical),xt=[],St=af(Ye,rt,V),Ft=!A&&ee&&se,nt=A&&le&&se,qe=K&&rt.hasTextData(),yt=rt.hasIconTextFit()&&qe&&rt.hasIconData(),pt=Ft||nt||A&&qe||yt,Ut=rt.projection.name==="globe",ei=Ut?r.aj(V.zoom):0;Ut&&(xt.push("PROJECTION_GLOBE_VIEW"),pt&&xt.push("PROJECTED_POS_ON_VIEWPORT"));const vi=p.getOrCreateProgram("collisionBox",{defines:xt});let ni=St;b[0]===0&&b[1]===0||(ni=p.translatePosMatrix(St,ct,b,M));const ti=A?rt.textCollisionBox:rt.iconCollisionBox,Zi=rt.collisionCircleArray;if(Zi.length>0){const Ai=r.bC(),Oi=ni;r.cP(Ai,rt.placementInvProjMatrix,V.glCoordMatrix),r.cP(Ai,Ai,rt.placementViewportMatrix),pe.push({circleArray:Zi,circleOffset:be,transform:Oi,invTransform:Ai,projection:rt.getProjection()}),de+=Zi.length/4,be=de}if(!ti)continue;p.terrain&&p.terrain.setupElevationDraw(ct,vi);const Si=Ut?[Ye.canonical.x,Ye.canonical.y,1<<Ye.canonical.z]:[0,0,0];vi.draw(p,O.LINES,sn.disabled,fn.disabled,p.colorModeForRenderPass(),zn.disabled,Xp(ni,_t,V,ei,H,ct,Si,rt.getProjection()),c.id,ti.layoutVertexBuffer,ti.indexBuffer,ti.segments,null,V.zoom,null,[ti.collisionVertexBuffer,ti.collisionVertexBufferExt])}if(!A||!pe.length)return;const Me=p.getOrCreateProgram("collisionCircle"),we=new r.dZ;we.resize(4*de),we._trim();let Ue=0;for(const Le of pe)for(let Ye=0;Ye<Le.circleArray.length/4;Ye++){const ct=4*Ye,rt=Le.circleArray[ct+0],_t=Le.circleArray[ct+1],xt=Le.circleArray[ct+2],St=Le.circleArray[ct+3];we.emplace(Ue++,rt,_t,xt,St,0),we.emplace(Ue++,rt,_t,xt,St,1),we.emplace(Ue++,rt,_t,xt,St,2),we.emplace(Ue++,rt,_t,xt,St,3)}(!po||po.length<2*de)&&(po=(function(Le){const Ye=2*Le,ct=new r.b0;ct.resize(Ye),ct._trim();for(let rt=0;rt<Ye;rt++){const _t=6*rt;ct.uint16[_t+0]=4*rt+0,ct.uint16[_t+1]=4*rt+1,ct.uint16[_t+2]=4*rt+2,ct.uint16[_t+3]=4*rt+2,ct.uint16[_t+4]=4*rt+3,ct.uint16[_t+5]=4*rt+0}return ct})(de));const Pe=D.createIndexBuffer(po,!0),Ne=D.createVertexBuffer(we,r.d_.members,!0);for(const Le of pe){const Ye={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(Oe=V).getCameraToCenterDistance(Le.projection),u_viewport_size:[Oe.width,Oe.height]};Me.draw(p,O.TRIANGLES,sn.disabled,fn.disabled,p.colorModeForRenderPass(),zn.disabled,Ye,c.id,Ne,Pe,r.bg.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,V.zoom)}var Oe;Ne.destroy(),Pe.destroy()}const Js=r.bC();function ha(p){const s=p._camera.getWorldToCamera(p.worldSize,1),c=r.aB([],s,p.globeMatrix);r.bl(c,c);const m=[0,0,0],b=[0,1,0,0];return r.aC(b,b,c),m[0]=b[0],m[1]=b[1],m[2]=b[2],r.aw(m,m),m}function Su({width:p,height:s,anchor:c,textOffset:m,textScale:b},M){const{horizontalAlign:A,verticalAlign:D}=r.c1(c),O=-(A-.5)*p,V=-(D-.5)*s,H=r.c2(c,m);return new r.P((O/b+H[0])*M,(V/b+H[1])*M)}function gn(p,s,c,m,b,M,A,D,O,V){const H=p.text.placedSymbolArray,Q=p.text.dynamicLayoutVertexArray,K=p.icon.dynamicLayoutVertexArray,ee={},le=p.getProjection(),se=Ml(A,le,b),pe=b.elevation,de=le.upVectorScale(A.canonical,b.center.lat,b.worldSize).metersToTile;Q.clear();for(let be=0;be<H.length;be++){const Me=H.get(be),{tileAnchorX:we,tileAnchorY:Ue,numGlyphs:Pe}=Me,Ne=Me.hidden||!Me.crossTileID||p.allowVerticalPlacement&&!Me.placedOrientation?null:m[Me.crossTileID];if(Ne){let Oe=0,Le=0,Ye=0;const ct=p.elevationType==="road";if(pe||ct){const pt=ct?p.getElevationFeatureForText(be):null,Ut=r.bV.getAtTileOffset(A,new r.P(we,Ue),pe,pt),[ei,vi,ni]=le.upVector(A.canonical,we,Ue);Oe=Ut*ei*de,Le=Ut*vi*de,Ye=Ut*ni*de}let[rt,_t,xt,St]=lc(Me.projectedAnchorX+Oe,Me.projectedAnchorY+Le,Me.projectedAnchorZ+Ye,c?se:M);const Ft=qr(b.getCameraToCenterDistance(le),St);let nt=r.bM(p.textSizeData,O,Me)*Ft/r.bY;c&&(nt*=p.tilePixelRatio/D);const qe=Su(Ne,nt);c?({x:rt,y:_t,z:xt}=le.projectTilePoint(we+qe.x,Ue+qe.y,A.canonical),[rt,_t,xt]=lc(rt+Oe,_t+Le,xt+Ye,M)):(s&&qe._rotate(-b.angle),rt+=qe.x,_t+=qe.y,xt=0);const yt=p.allowVerticalPlacement&&Me.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let pt=0;pt<Pe;pt++)r.bO(Q,rt,_t,xt,yt);V&&Me.associatedIconIndex>=0&&(ee[Me.associatedIconIndex]={x:rt,y:_t,z:xt,angle:yt})}else uc(Pe,Q)}if(V){K.clear();const be=p.icon.placedSymbolArray;for(let Me=0;Me<be.length;Me++){const we=be.get(Me),{numGlyphs:Ue}=we,Pe=ee[Me];if(we.hidden||!Pe)uc(Ue,K);else{const{x:Ne,y:Oe,z:Le,angle:Ye}=Pe;for(let ct=0;ct<Ue;ct++)r.bO(K,Ne,Oe,Le,Ye)}}p.icon.dynamicLayoutVertexBuffer.updateData(K)}p.text.dynamicLayoutVertexBuffer.updateData(Q)}function Tu(p,s,c,m,b,M,A={}){const D=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),V=c.paint.get("icon-translate-anchor"),H=c.paint.get("text-translate-anchor"),Q=c.layout.get("icon-rotation-alignment"),K=c.layout.get("text-rotation-alignment"),ee=c.layout.get("icon-pitch-alignment"),le=c.layout.get("text-pitch-alignment"),se=c.layout.get("icon-keep-upright"),pe=c.layout.get("text-keep-upright"),de=c.paint.get("icon-color-saturation"),be=c.paint.get("icon-color-contrast"),Me=c.paint.get("icon-color-brightness-min"),we=c.paint.get("icon-color-brightness-max"),Ue=c.layout.get("symbol-elevation-reference")==="sea",Pe=c.layout.get("icon-image-use-theme")==="none",Ne=p.context,Oe=Ne.gl,Le=p.transform,Ye=Q==="map",ct=K==="map",rt=ee==="map",_t=le==="map",xt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let St=!1;const Ft=p.depthModeForSublayer(0,sn.ReadOnly),nt=new sn(p.context.gl.LEQUAL,sn.ReadOnly,p.depthRangeFor3D),qe=[r.aF(Le.center.lng),r.aJ(Le.center.lat)],yt=c.layout.get("text-variable-anchor"),pt=Le.projection.name==="globe",Ut=[],ei=[0,-1,0];for(const vi of m){const ni=s.getTile(vi),ti=ni.getBucket(c);if(!ti||ti.projection.name==="mercator"&&pt||ti.fullyClipped)continue;const Zi=ti.projection.name==="globe",Si=Zi?r.aj(Le.zoom):0,Ai=Ml(vi,ti.getProjection(),Le),Oi=Le.calculatePixelsToTileUnitsMatrix(ni),an=yt&&ti.hasTextData(),Mn=ti.hasIconTextFit()&&an&&ti.hasIconData(),lr=ti.getProjection().createInversionMatrix(Le,vi.canonical),Lr=(1<<ni.tileID.canonical.z)*r.al/p.transform.worldSize,Yi=Nr=>{let rr=[0,0,0];if(Nr){const w=p.style.directionalLight,T=p.style.ambientLight;w&&T&&(rr=$a(p.style,w,T))}return rr},Ir=Nr=>{Le.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(Nr.push("DEPTH_D24"),Nr.push("DEPTH_OCCLUSION"))},Dn=Nr=>{c.lut&&!Pe&&(c.lut.texture||(c.lut.texture=new r.d$(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Ne.gl.RGBA8)),Ne.activeTexture.set(Ne.gl.TEXTURE0+ts.LUT),c.lut.texture&&c.lut.texture.bind(Ne.gl.LINEAR,Ne.gl.CLAMP_TO_EDGE),Nr.push("APPLY_LUT_ON_GPU"))},er=()=>{const Nr=Ye&&c.layout.get("symbol-placement")!=="point",rr=[];Ir(rr),Dn(rr);const w=Nr||Mn,T=ti.elevationType==="road",B=p.shadowRenderer,q=T&&rt&&!!B&&B.enabled,te=Yi(q),fe=T&&rt&&!p.terrain?nt:Ft,We=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&rt&&rr.push("PITCH_WITH_MAP_TERRAIN"),Zi&&(rr.push("PROJECTION_GLOBE_VIEW"),w&&rr.push("PROJECTED_POS_ON_VIEWPORT")),We>0&&ti.hasAnySecondaryIcon&&rr.push("ICON_TRANSITION"),!ti.icon.zOffsetVertexBuffer||T&&p.terrain||rr.push("Z_OFFSET"),de===0&&be===0&&Me===0&&we===1||rr.push("COLOR_ADJUSTMENT"),ti.sdfIcons&&rr.push("RENDER_SDF"),q&&rr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),T&&rt&&!p.terrain&&ti.icon.orientationVertexBuffer&&rr.push("ELEVATED_ROADS");const vt=ti.icon.programConfigurations.get(c.id),Ht=p.getOrCreateProgram("symbol",{config:vt,defines:rr}),Ri=ni.imageAtlasTexture?ni.imageAtlasTexture.size:[0,0],on=ti.iconSizeData,En=r.bK(on,Le.zoom),On=rt||!Le.isOrthographic,br=Po(Ai,ni.tileID.canonical,rt,Ye,Le,ti.getProjection(),Oi),is=Xd(Ai,ni.tileID.canonical,rt,Ye,Le,ti.getProjection(),Oi),$s=p.translatePosMatrix(is,ni,D,V,!0),Yr=p.translatePosMatrix(Ai,ni,D,V),Kt=w?Js:br,Pt=Ye&&!rt&&!Nr;let $t=ei;!pt&&!Le.mercatorFromTransition||Ye||($t=ha(Le));const ln=Zi?$t:ei,_r=c.getColorAdjustmentMatrix(de,be,Me,we),Bs=ap(on.kind,En,Pt,rt,p,Yr,Kt,$s,Ue,!1,Ri,[0,0],0,vi,Si,qe,lr,ln,ti.getProjection(),te,Lr,_r,We,null),Hr=ni.imageAtlasTexture?ni.imageAtlasTexture:null,As=c.layout.get("icon-size").constantOr(0)!==1||ti.iconsNeedLinear,fa=ti.sdfIcons||p.options.rotating||p.options.zooming||As||On?Oe.LINEAR:Oe.NEAREST,_s=ti.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,ic=p.terrain&&rt&&Nr?r.bl(r.bC(),br):Js;if(Nr&&ti.icon){const Lu=r.bV.getAtTileOffsetFunc(vi,Le.center.lat,Le.worldSize,ti.getProjection()),Of=td(Ai,ni.tileID.canonical,rt,Ye,Le,ti.getProjection(),Oi),uh=c.layout.get("icon-size-scale-range"),ks=r.aA(p.scaleFactor,uh[0],uh[1]);_g(ti,Ai,p,!1,Of,is,rt,se,Lu,vi,ks)}return{program:Ht,buffers:ti.icon,uniformValues:Bs,atlasTexture:Hr,atlasTextureIcon:null,atlasInterpolation:fa,atlasInterpolationIcon:null,isSDF:ti.sdfIcons,hasHalo:_s,depthMode:fe,tile:ni,renderWithShadows:q,labelPlaneMatrixInv:ic}},Pr=()=>{const Nr=ct&&c.layout.get("symbol-placement")!=="point",rr=[],w=Nr||yt||Mn,T=ti.elevationType==="road",B=p.shadowRenderer,q=T&&_t&&!!B&&B.enabled,te=Yi(q),fe=T&&_t&&!p.terrain?nt:Ft;p.terrainRenderModeElevated()&&_t&&rr.push("PITCH_WITH_MAP_TERRAIN"),Zi&&(rr.push("PROJECTION_GLOBE_VIEW"),w&&rr.push("PROJECTED_POS_ON_VIEWPORT")),!ti.text.zOffsetVertexBuffer||T&&p.terrain||rr.push("Z_OFFSET"),ti.iconsInText&&rr.push("RENDER_TEXT_AND_SYMBOL"),rr.push("RENDER_SDF"),q&&rr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),T&&_t&&!p.terrain&&ti.text.orientationVertexBuffer&&rr.push("ELEVATED_ROADS"),Ir(rr);const We=ti.text.programConfigurations.get(c.id),vt=p.getOrCreateProgram("symbol",{config:We,defines:rr});let Ht,Ri=[0,0],on=null;const En=ti.textSizeData;ti.iconsInText&&(Ri=ni.imageAtlasTexture?ni.imageAtlasTexture.size:[0,0],on=ni.imageAtlasTexture?ni.imageAtlasTexture:null,Ht=_t||!Le.isOrthographic||p.options.rotating||p.options.zooming||En.kind==="composite"||En.kind==="camera"?Oe.LINEAR:Oe.NEAREST);const On=ni.glyphAtlasTexture?ni.glyphAtlasTexture.size:[0,0],br=c.layout.get("text-size-scale-range"),is=r.aA(p.scaleFactor,br[0],br[1]),$s=r.bK(En,Le.zoom,is),Yr=Po(Ai,ni.tileID.canonical,_t,ct,Le,ti.getProjection(),Oi),Kt=Xd(Ai,ni.tileID.canonical,_t,ct,Le,ti.getProjection(),Oi),Pt=p.translatePosMatrix(Kt,ni,O,H,!0),$t=p.translatePosMatrix(Ai,ni,O,H),ln=w?Js:Yr,_r=ct&&!_t&&!Nr;let Bs=ei;!pt&&!Le.mercatorFromTransition||ct||(Bs=ha(Le));const Hr=ap(En.kind,$s,_r,_t,p,$t,ln,Pt,Ue,!0,On,Ri,0,vi,Si,qe,lr,Zi?Bs:ei,ti.getProjection(),te,Lr,null,null,is),As=ni.glyphAtlasTexture?ni.glyphAtlasTexture:null,fa=Oe.LINEAR,_s=c.paint.get("text-halo-width").constantOr(1)!==0,ic=p.terrain&&_t&&Nr?r.bl(r.bC(),Yr):Js;if(Nr&&ti.text){const Lu=r.bV.getAtTileOffsetFunc(vi,Le.center.lat,Le.worldSize,ti.getProjection()),Of=td(Ai,ni.tileID.canonical,_t,ct,Le,ti.getProjection(),Oi);_g(ti,Ai,p,!0,Of,Kt,_t,pe,Lu,vi,is)}return{program:vt,buffers:ti.text,uniformValues:Hr,atlasTexture:As,atlasTextureIcon:on,atlasInterpolation:fa,atlasInterpolationIcon:Ht,isSDF:!0,hasHalo:_s,depthMode:fe,tile:ni,renderWithShadows:q,labelPlaneMatrixInv:ic}},Sr=ti.icon.segments.get().length,pr=ti.text.segments.get().length,qn=Sr&&!A.onlyText?er():null,zr=pr&&!A.onlyIcons?Pr():null,Os=c.paint.get("icon-opacity").constantOr(1),us=c.paint.get("text-opacity").constantOr(1);if(xt&&ti.canOverlap){St=!0;const Nr=Os&&!A.onlyText?ti.icon.segments.get():[],rr=us&&!A.onlyIcons?ti.text.segments.get():[];for(const w of Nr)Ut.push({segments:new r.bg([w]),sortKey:w.sortKey,state:qn});for(const w of rr)Ut.push({segments:new r.bg([w]),sortKey:w.sortKey,state:zr})}else A.onlyText||Ut.push({segments:Os?ti.icon.segments:new r.bg([]),sortKey:0,state:qn}),A.onlyIcons||Ut.push({segments:us?ti.text.segments:new r.bg([]),sortKey:0,state:zr})}St&&Ut.sort(((vi,ni)=>vi.sortKey-ni.sortKey));for(const vi of Ut){const ni=vi.state;if(ni)if(p.terrain?p.terrain.setupElevationDraw(ni.tile,ni.program,{useDepthForOcclusion:Le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ni.labelPlaneMatrixInv}):p.setupDepthForOcclusion(Le.depthOcclusionForSymbolsAndCircles,ni.program),Ne.activeTexture.set(Oe.TEXTURE0),ni.atlasTexture&&ni.atlasTexture.bind(ni.atlasInterpolation,Oe.CLAMP_TO_EDGE,!0),ni.atlasTextureIcon&&(Ne.activeTexture.set(Oe.TEXTURE1),ni.atlasTextureIcon&&ni.atlasTextureIcon.bind(ni.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE,!0)),ni.renderWithShadows&&p.shadowRenderer.setupShadows(ni.tile.tileID.toUnwrapped(),ni.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,ni.program),ni.hasHalo){const ti=ni.uniformValues;ti.u_is_halo=1,lp(ni.buffers,vi.segments,c,p,ni.program,ni.depthMode,b,M,ti,2),ti.u_is_halo=0}else{if(ni.isSDF){const ti=ni.uniformValues;ni.hasHalo&&(ti.u_is_halo=1,lp(ni.buffers,vi.segments,c,p,ni.program,ni.depthMode,b,M,ti,1)),ti.u_is_halo=0}lp(ni.buffers,vi.segments,c,p,ni.program,ni.depthMode,b,M,ni.uniformValues,1)}}}function lp(p,s,c,m,b,M,A,D,O,V){const H=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];b.draw(m,m.context.gl.TRIANGLES,M,A,D,zn.disabled,O,c.id,p.layoutVertexBuffer,p.indexBuffer,s,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),H,V)}function cp(p,s){const c=1<<p.canonical.z,m=(s.x*c-p.canonical.x-p.wrap*c)*r.al,b=(s.y*c-p.canonical.y)*r.al,M=r.e8(s.z,s.y);return r.d5(m,b,M)}function mc(p,s,c,m,b){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const M=p.context.gl,A=new sn(p.context.gl.LEQUAL,sn.ReadWrite,p.depthRangeFor3D),D=new sn(p.context.gl.GREATER,sn.ReadWrite,p.depthRangeFor3D),O=(function(ee){let le=.01;return ee.isOrthographic&&(le=r.ak(1e-4,le,r.d0(ee.pitch>=fc?1:ee.pitch/fc))),2*le})(p.transform),V=p.transform.getFreeCameraOptions().position,H="elevatedStructuresDepthReconstruct",Q=p.getOrCreateProgram(H,{defines:["DEPTH_RECONSTRUCTION"]}),K=p.getOrCreateProgram(H);for(const ee of m){const le=s.getTile(ee),se=le.getBucket(c);if(!se)continue;const pe=se.elevatedStructures;if(!pe)continue;const de=se.elevationBufferData.heightRange,be=cp(ee.toUnwrapped(),V),Me=p.translatePosMatrix(ee.projMatrix,le,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let we,Ue,Pe,Ne;if(b==="initialize"){if(!de||de.min>=1||pe.depthSegments.segments[0].primitiveLength===0)continue;we=Uc(Me,be,O,1,0),Ue=A,Pe=pe.depthSegments,Ne=Q}else if(b==="reset"){if(!de||de.min>=0||pe.maskSegments.segments[0].primitiveLength===0)continue;we=Uc(Me,be,0,0,1),Ue=D,Pe=pe.maskSegments,Ne=Q}else if(b==="geometry"){if(pe.depthSegments.segments[0].primitiveLength===0)continue;we=Uc(Me,be,O,1,0),Ue=A,Pe=pe.depthSegments,Ne=K}Ne.draw(p,M.TRIANGLES,Ue,fn.disabled,$n.disabled,zn.disabled,we,c.id,pe.vertexBuffer,pe.indexBuffer,Pe,c.paint,p.transform.zoom)}}function jm(p,s,c,m){const{painter:b,sourceCache:M,layer:A,coords:D,colorMode:O,elevationType:V,terrainEnabled:H,pass:Q}=p,K=b.context.gl,ee=A.paint.get("fill-pattern"),le=A.paint.get("fill-pattern-cross-fade"),se=ee.constantOr(null);let pe=V;V!=="road"||s&&!H||(pe="none");const de=pe==="road",be=p.painter.shadowRenderer,Me=de&&!!be&&be.enabled,we=new sn(b.context.gl.LEQUAL,sn.ReadOnly,b.depthRangeFor3D);let Ue=[0,0,0];if(Me){const Le=b.style.directionalLight,Ye=b.style.ambientLight;Le&&Ye&&(Ue=$a(b.style,Le,Ye))}const Pe=ee&&ee.constantOr(1),Ne=b.terrain&&b.terrain.renderingToTexture,Oe=(Le,Ye)=>{let ct,rt,_t,xt,St;Ye?(ct=Pe&&!A.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_t=K.LINES):(ct=Pe?"fillPattern":"fill",_t=K.TRIANGLES);for(const Ft of D){const nt=M.getTile(Ft);if(Pe&&!nt.patternsLoaded())continue;const qe=nt.getBucket(A);if(!qe)continue;const yt=s?qe.elevationBufferData:qe.bufferData;if(yt.isEmpty())continue;b.prepareDrawTile();const pt=yt.programConfigurations.get(A.id),Ut=b.isTileAffectedByFog(Ft),ei=[],vi=[];de&&(ei.push("ELEVATED_ROADS"),vi.push(yt.elevatedLayoutVertexBuffer)),Me&&ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ne&&c&&ei.push("USE_MRT1"),Pe&&(b.context.activeTexture.set(K.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),pt.updatePaintBuffers());let ni=!1;if(se&&nt.imageAtlas){const Oi=nt.imageAtlas,an=r.e3.from(se),Mn=an.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),lr=an.getSecondary(),Lr=Oi.patternPositions.get(Mn),Yi=lr?Oi.patternPositions.get(lr.scaleSelf(r.o.devicePixelRatio).toString()):null;ni=!!Lr&&!!Yi,Lr&&pt.setConstantPatternPositions(Lr,Yi)}le>0&&(ni||pt.getPatternTransitionVertexBuffer("fill-pattern"))&&ei.push("FILL_PATTERN_TRANSITION");const ti=b.getOrCreateProgram(ct,{config:pt,overrideFog:Ut,defines:ei}),Zi=b.translatePosMatrix(Ft.projMatrix,nt,A.paint.get("fill-translate"),A.paint.get("fill-translate-anchor"));Me&&be.setupShadows(nt.tileID.toUnwrapped(),ti,"vector-tile");const Si=A.paint.get("fill-emissive-strength");if(Ye){xt=yt.lineIndexBuffer,St=yt.lineSegments;const Oi=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[K.drawingBufferWidth,K.drawingBufferHeight];rt=ct==="fillOutlinePattern"&&Pe?pd(Zi,Si,b,nt,Oi,Ue,le):qp(Zi,Si,Oi,Ue)}else xt=yt.indexBuffer,St=yt.triangleSegments,rt=Pe?ih(Zi,Si,b,nt,Ue,le):th(Zi,Si,Ue);b.uploadCommonUniforms(b.context,ti,Ft.toUnwrapped());let Ai=Le;(V==="road"&&!H||V==="offset")&&(Ai=we),ti.draw(b,_t,Ai,m||b.stencilModeForClipping(Ft),O,zn.disabled,rt,A.id,yt.layoutVertexBuffer,xt,St,A.paint,b.transform.zoom,pt,vi)}};b.renderPass===Q&&Oe(b.depthModeForSublayer(1,b.renderPass==="opaque"?sn.ReadWrite:sn.ReadOnly),!1),pe==="none"&&b.renderPass==="translucent"&&A.paint.get("fill-antialias")&&Oe(b.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,sn.ReadOnly),!0)}function Ea(p,s,c,m,b,M,A,D){c.resetLayerRenderingStats(p);const O=p.context,V=O.gl,H=p.transform,Q=c.paint.get("fill-extrusion-pattern"),K=c.paint.get("fill-extrusion-pattern-cross-fade"),ee=Q.constantOr(null),le=Q.constantOr(1),se=c.paint.get("fill-extrusion-opacity"),pe=p.style.enable3dLights(),de=c.paint.get(pe&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),be=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],Me=c.layout.get("fill-extrusion-edge-radius"),we=Me>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ue=we?0:Me,Pe=H.projection.name==="globe"?r.eb():0,Ne=H.projection.name==="globe",Oe=Ne?r.aj(H.zoom):0,Le=[r.aF(H.center.lng),r.aJ(H.center.lat)],Ye=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ct=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ye?null:c.lut).toArray01().slice(0,3),rt=c.paint.get("fill-extrusion-flood-light-intensity"),_t=c.paint.get("fill-extrusion-vertical-scale"),xt=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,St=c.paint.get("fill-extrusion-height-alignment"),Ft=c.paint.get("fill-extrusion-base-alignment"),nt=ou(p,c.paint.get("fill-extrusion-cutoff-fade-range")),qe=[];let yt;Ne&&qe.push("PROJECTION_GLOBE_VIEW"),be[0]>0&&qe.push("FAUX_AO"),we&&qe.push("ZERO_ROOF_RADIUS"),D&&qe.push("HAS_CENTROID"),rt>0&&qe.push("FLOOD_LIGHT"),nt.shouldRenderCutoff&&qe.push("RENDER_CUTOFF"),xt&&qe.push("RENDER_WALL_MODE");const pt=p.renderPass==="shadow",Ut=p.shadowRenderer,ei=pt&&!!Ut,vi=pt?zn.disabled:zn.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let ni=[0,0,0];if(Ut){const Si=p.style.directionalLight,Ai=p.style.ambientLight;Si&&Ai&&(ni=$a(p.style,Si,Ai)),pt||(qe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ut.useNormalOffset&&qe.push("NORMAL_OFFSET")),yt=qe.concat(["SHADOWS_SINGLE_CASCADE"])}const ti=ei?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",Zi=c.getLayerRenderingStats();for(const Si of m){const Ai=s.getTile(Si),Oi=Ai.getBucket(c);if(!Oi||Oi.projection.name!==H.projection.name)continue;let an=!1;Ut&&(an=Ut.getMaxCascadeForTile(Si.toUnwrapped())===0);const Mn=p.isTileAffectedByFog(Si),lr=Oi.programConfigurations.get(c.id);let Lr=!1;if(ee&&Ai.imageAtlas){const pr=Ai.imageAtlas,qn=r.e3.from(ee),zr=qn.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Os=qn.getSecondary(),us=pr.patternPositions.get(zr),Nr=Os?pr.patternPositions.get(Os.scaleSelf(r.o.devicePixelRatio).toString()):null;Lr=!!us&&!!Nr,us&&lr.setConstantPatternPositions(us,Nr)}K>0&&(Lr||lr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&qe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yi=p.getOrCreateProgram(ti,{config:lr,defines:an?yt:qe,overrideFog:Mn});if(p.terrain&&p.terrain.setupElevationDraw(Ai,Yi,{useMeterToDem:!0}),!Oi.centroidVertexBuffer){const pr=Yi.getAttributeLocation(V,"a_centroid_pos");pr!==-1&&V.vertexAttrib2f(pr,0,0)}!pt&&Ut&&Ut.setupShadows(Ai.tileID.toUnwrapped(),Yi,"vector-tile"),le&&(p.context.activeTexture.set(V.TEXTURE0),Ai.imageAtlasTexture&&Ai.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),lr.updatePaintBuffers());const Ir=c.paint.get("fill-extrusion-vertical-gradient"),Dn=1/Oi.tileToMeter;let er;if(pt&&Ut){if(Eu(Ai.tileID,Oi.maxHeight,p))continue;const pr=Ut.calculateShadowPassMatrixFromTile(Ai.tileID.toUnwrapped());er=Vr(pr,Ue,Dn,_t,St,Ft)}else{const pr=p.translatePosMatrix(Si.expandedProjMatrix,Ai,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),qn=H.projection.createInversionMatrix(H,Si.canonical);er=le?jp(pr,p,Ir,se,be,Ue,Dn,Si,Ai,Pe,St,Ft,Oe,Le,qn,ct,_t,K):eh(pr,p,Ir,se,be,Ue,Dn,Si,Pe,St,Ft,Oe,Le,qn,ct,_t,rt,ni)}p.uploadCommonUniforms(O,Yi,Si.toUnwrapped(),null,nt);let Pr=Oi.segments;if(H.projection.name==="mercator"&&!pt&&(Pr=Oi.getVisibleSegments(Ai.tileID,p.terrain,p.transform.getFrustum(0)),!Pr.get().length))continue;if(Zi)if(pt)for(const pr of Pr.get())Zi.numRenderedVerticesInShadowPass+=pr.primitiveLength;else for(const pr of Pr.get())Zi.numRenderedVerticesInTransparentPass+=pr.primitiveLength;const Sr=[];(p.terrain||D)&&Sr.push(Oi.centroidVertexBuffer),Ne&&Sr.push(Oi.layoutVertexExtBuffer),xt&&Sr.push(Oi.wallVertexBuffer),Yi.draw(p,O.gl.TRIANGLES,b,M,A,vi,er,c.id,Oi.layoutVertexBuffer,Oi.indexBuffer,Pr,c.paint,p.transform.zoom,lr,Sr)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class Wp{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Mu(p,s,c,m,b,M,A,D,O,V,H,Q,K,ee,le,se,pe,de,be,Me){const we=s.context,Ue=we.gl,Pe=s.transform,Ne=s.transform.zoom,Oe=[],Le=p.translate,Ye=p.translateAnchor,ct=p.edgeRadius,rt=ou(s,p.cutoffFadeRange);H==="clear"?(Oe.push("CLEAR_SUBPASS"),Me&&(Oe.push("CLEAR_FROM_TEXTURE"),we.activeTexture.set(Ue.TEXTURE0),Me.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE))):H==="sdf"?Oe.push("SDF_SUBPASS"):H==="emissive"&&(Oe.push("USE_MRT1"),we.activeTexture.set(Ue.TEXTURE0),Me.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)),de&&Oe.push("HAS_CENTROID"),rt.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF");const _t=(xt,St,Ft,nt,qe)=>{let yt=Oe;St.groundRadiusBuffer!=null&&(yt=Oe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const pt=St.programConfigurations.get(m.id),Ut=s.isTileAffectedByFog(xt),ei=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:pt,defines:yt,overrideFog:Ut}),vi=vf(s,nt,Q,V,qe,[K,ee*qe],le,se,pe,Ne>=17?0:ct*qe,Me?Me.size[0]:0),ni=[];de&&ni.push(St.hiddenByLandmarkVertexBuffer),St.groundRadiusBuffer!=null&&ni.push(St.groundRadiusBuffer),s.uploadCommonUniforms(we,ei,xt.toUnwrapped(),null,rt),ei.draw(s,we.gl.TRIANGLES,M,A,D,O,vi,m.id,St.vertexBuffer,St.indexBuffer,Ft,m.paint,Ne,pt,ni)};for(const xt of b){const St=c.getTile(xt),Ft=St.getBucket(m);if(!Ft||Ft.projection.name!==Pe.projection.name||!Ft.groundEffect||Ft.groundEffect&&!Ft.groundEffect.hasData())continue;const nt=Ft.groundEffect,qe=1/Ft.tileToMeter;{const yt=s.translatePosMatrix(xt.projMatrix,St,Le,Ye),pt=nt.getDefaultSegment();_t(xt,nt,pt,yt,qe)}if(be)for(let yt=0;yt<4;yt++){const pt=r.e9[yt](xt),Ut=c.getTile(pt);if(!Ut)continue;const ei=Ut.getBucket(m);if(!ei||ei.projection.name!==Pe.projection.name||!ei.groundEffect||ei.groundEffect&&!ei.groundEffect.hasData())continue;const vi=ei.groundEffect;let ni,ti;yt===0?(ni=[-r.al,0,0],ti=1):yt===1?(ni=[r.al,0,0],ti=0):yt===2?(ni=[0,-r.al,0],ti=3):(ni=[0,r.al,0],ti=2);const Zi=vi.regionSegments[ti];if(!Zi)continue;const Si=new Float32Array(16);r.br(Si,xt.projMatrix,ni),_t(xt,vi,Zi,s.translatePosMatrix(Si,St,Le,Ye),qe)}}}function a_(p,s,c,m,b,M,A){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const D=M?M.findDEMTileFor(c):null;if(!(D&&D.dem||A))return;M&&D&&D.dem&&m.selfDEMTileTimestamp!==D.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=D.dem._timestamp);const O=de=>new r.P(Math.ceil((de+r.ed)*r.ee),0),V=de=>{const be=s.getSource().minzoom,Me=Ue=>{const Pe=s.getTileByID(Ue);if(Pe&&Pe.hasData())return Pe.getBucket(b)},we=[0,-1,1];for(const Ue of we){if(de.overscaledZ+Ue<be)continue;const Pe=Me(de.calculateScaledKey(de.overscaledZ+Ue));if(Pe)return Pe}},H=[0,0,0],Q=(de,be)=>(H[0]=Math.min(de.min.y,be.min.y),H[1]=Math.max(de.max.y,be.max.y),H[2]=r.al-be.min.x>de.max.x?be.min.x-r.al:de.max.x,H),K=(de,be)=>(H[0]=Math.min(de.min.x,be.min.x),H[1]=Math.max(de.max.x,be.max.x),H[2]=r.al-be.min.y>de.max.y?be.min.y-r.al:de.max.y,H),ee=[(de,be)=>Q(de,be),(de,be)=>Q(be,de),(de,be)=>K(de,be),(de,be)=>K(be,de)],le=(de,be,Me,we,Ue,Pe,Ne)=>{if(!M)return 0;const Oe=[[Pe?Me:de,Pe?de:Me,0],[Pe?Me:be,Pe?be:Me,0]],Le=Ne<0?r.al+Ne:Ne,Ye=[Pe?Le:(de+be)/2,Pe?(de+be)/2:Le,0];return Me===0&&Ne<0||Me!==0&&Ne>0?M.getForTilePoints(Ue,[Ye],!0,we):Oe.push(Ye),M.getForTilePoints(c,Oe,!0,D),Math.max(Oe[0][2],Oe[1][2],Ye[2])/M.exaggeration()};for(let de=0;de<4;de++){const be=m.borderFeatureIndices[de];if(be.length===0)continue;const Me=r.e9[de](c),we=V(Me);if(!(we&&we instanceof r.ea))continue;const Ue=M?M.findDEMTileFor(Me):null;if(!(Ue&&Ue.dem||A)||(M&&Ue&&Ue.dem&&m.borderDEMTileTimestamp[de]!==Ue.dem._timestamp&&(m.borderDoneWithNeighborZ[de]=-1,m.borderDEMTileTimestamp[de]=Ue.dem._timestamp),m.borderDoneWithNeighborZ[de]===we.canonical.z))continue;we.centroidVertexArray.length===0&&we.createCentroidsBuffer();const Pe=(de<2?1:5)-de,Ne=we.borderDoneWithNeighborZ[Pe]!==m.canonical.z,Oe=we.borderFeatureIndices[Pe];let Le=0;if(m.canonical.z!==we.canonical.z){for(const Ye of be)m.showCentroid(m.featuresOnBorder[Ye]);if(Ne)for(const Ye of Oe)we.showCentroid(we.featuresOnBorder[Ye]);m.borderDoneWithNeighborZ[de]=we.canonical.z,we.borderDoneWithNeighborZ[Pe]=m.canonical.z}for(const Ye of be){const ct=m.featuresOnBorder[Ye],rt=m.centroidData[ct.centroidDataIndex],_t=ct.borders[de];let xt;for(;Le<Oe.length;){xt=we.featuresOnBorder[Oe[Le]];const St=xt.borders[Pe];if(St[1]>_t[0]+3||St[0]>_t[0]-3)break;we.showCentroid(xt),Le++}if(xt&&Le<Oe.length){const St=Le;let Ft=0;for(;!(xt.borders[Pe][0]>_t[1]-3)&&(Ft++,++Le!==Oe.length);)xt=we.featuresOnBorder[Oe[Le]];xt=we.featuresOnBorder[Oe[St]];let nt=!1;if(Ft>=1){const pt=xt.borders[Pe];Math.abs(_t[0]-pt[0])<3&&Math.abs(_t[1]-pt[1])<3&&(Ft=1,nt=!0,Le=St+1)}else if(Ft===0){m.showCentroid(ct);continue}const qe=we.centroidData[xt.centroidDataIndex];A&&nt&&(((se=rt).flags|(pe=qe).flags)&r.ec?(se.flags|=r.ec,pe.flags|=r.ec):(se.flags&=~r.ec,pe.flags&=~r.ec));const yt=ct.intersectsCount()>1||xt.intersectsCount()>1;if(Ft>1)Le=St,rt.centroidXY=qe.centroidXY=new r.P(0,0);else if(Ue&&Ue.dem&&!yt){const pt=ee[de](rt,qe),Ut=de%2?r.al-1:0,ei=le(pt[0],Math.min(r.al-1,pt[1]),Ut,Ue,Me,de<2,pt[2]);rt.centroidXY=qe.centroidXY=O(ei)}else yt?rt.centroidXY=qe.centroidXY=new r.P(0,0):(rt.centroidXY=m.encodeBorderCentroid(ct),qe.centroidXY=we.encodeBorderCentroid(xt));m.writeCentroidToBuffer(rt),we.writeCentroidToBuffer(qe)}else m.showCentroid(ct)}m.borderDoneWithNeighborZ[de]=we.canonical.z,we.borderDoneWithNeighborZ[Pe]=m.canonical.z}var se,pe;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const Dl=[1,0,0],bg=[0,1,0],Bo=[0,0,1];function Eu(p,s,c){const m=c.transform,b=c.shadowRenderer;if(!b)return!0;const M=p.toUnwrapped(),A=m.tileSize*b._cascades[c.currentShadowCascade].scale;let D=s;if(m.elevation){const se=m.elevation.getMinMaxForTile(p);se&&(D+=se.max)}const O=[...b.shadowDirection];O[2]=-O[2];const V=b.computeSimplifiedTileShadowVolume(M,D,A,O);if(!V)return!1;const H=[Dl,bg,Bo,O,[O[0],0,O[2]],[0,O[1],O[2]]],Q=m.projection.name==="globe",K=m.scaleZoom(A),ee=r.cB.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,K,!Q),le=b.getCurrentCascadeFrustum();return ee.intersectsPrecise(V.vertices,V.planes,H)===0||le.intersectsPrecise(V.vertices,V.planes,H)===0}function yd(p){const{painter:s,source:c,layer:m,coords:b}=p;let M=p.defines;const A=s.context,D=s.renderPass==="shadow",O=s.renderPass==="light-beam",V=s.shadowRenderer,H=r.ef(s.transform.center.lat,s.transform.zoom),Q=ou(s,m.paint.get("building-cutoff-fade-range"));Q.shouldRenderCutoff&&(M=M.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(M=M.concat("FLOOD_LIGHT"));for(const K of b){const ee=c.getTile(K),le=ee.getBucket(m);if(!le)continue;V&&V.getMaxCascadeForTile(K.toUnwrapped())===0&&(M=M.concat("SHADOWS_SINGLE_CASCADE"));const se=le.programConfigurations.get(m.id);let pe,de,be,Me=s.translatePosMatrix(K.expandedProjMatrix,ee,[0,0],"map");if(Me=r.cS(r.bC(),Me,[1,1,p.verticalScale]),D&&V){if(Eu(ee.tileID,le.maxHeight*H,s))continue;let Ue=V.calculateShadowPassMatrixFromTile(ee.tileID.toUnwrapped());Ue=r.cS(r.bC(),Ue,[1,1,p.verticalScale]),be=Il(Ue),pe=de=s.getOrCreateProgram("buildingDepth",{config:se,defines:M,overrideFog:!1})}else if(O)pe=de=s.getOrCreateProgram("buildingBloom",{config:se,defines:M,overrideFog:!1}),be=vg(Me);else{const Ue=s.transform.calculatePosMatrix(K.toUnwrapped(),s.transform.worldSize);r.cS(Ue,Ue,[1,1,p.verticalScale]);const Pe=r.bC();r.cS(Pe,Ue,[1,-1,1/H]),r.bl(Pe,Pe),r.eg(Pe,Pe);const Ne=s.transform.getFreeCameraOptions().position,Oe=1<<K.canonical.z;if(be=nh(Me,Pe,p.opacity,p.facadeAOIntensity,[((Ne.x-K.wrap)*Oe-K.canonical.x)*r.al,(Ne.y*Oe-K.canonical.y)*r.al,Ne.z*Oe*r.al],le.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),de=s.getOrCreateProgram("building",{config:se,defines:M,overrideFog:!1}),p.depthOnly===!0)pe=de;else{const Le=M.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);pe=s.getOrCreateProgram("building",{config:se,defines:Le,overrideFog:!1})}V&&(V.setupShadowsFromMatrix(Ue,de,!0),pe!==de&&V.setupShadowsFromMatrix(Ue,pe,!0))}const we=(Ue,Pe)=>{if(O){const Ne=Ue.entranceBloom;Pe.draw(s,A.gl.TRIANGLES,p.depthMode,fn.disabled,p.blendMode,zn.disabled,be,m.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segmentsBucket,m.paint,s.transform.zoom,se,[Ne.layoutAttenuationBuffer,Ne.layoutColorBuffer])}else{const Ne=Ue.segmentsBucket;let Oe=[Ue.layoutNormalBuffer,Ue.layoutCentroidBuffer,Ue.layoutColorBuffer,Ue.layoutFloodLightDataBuffer];Ue.layoutFacadePaintBuffer&&(Oe=Oe.concat([Ue.layoutFacadeDataBuffer,Ue.layoutFacadeVerticalRangeBuffer,Ue.layoutFacadePaintBuffer])),Pe.draw(s,A.gl.TRIANGLES,p.depthMode,fn.disabled,p.blendMode,D?zn.disabled:zn.backCW,be,m.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ne,m.paint,s.transform.zoom,se,Oe)}};s.uploadCommonUniforms(A,de,K.toUnwrapped(),null,Q),le.buildingWithoutFacade&&we(le.buildingWithoutFacade,de),le.buildingWithFacade&&(pe!==de&&s.uploadCommonUniforms(A,pe,K.toUnwrapped(),null,Q),we(le.buildingWithFacade,pe))}}function No(p,s,c,m,b,M,A,D,O,V,H,Q,K){const ee=p.context.gl,le=p.depthModeForSublayer(1,sn.ReadOnly,ee.LEQUAL,!0),se=.1*(1-(pe=H))+3*pe;var pe;const de=p._showOverdrawInspector,be=Q,Me=new Wp;de||Mu(Me,p,s,c,m,le,new fn({func:ee.ALWAYS,mask:255},255,255,ee.KEEP,ee.KEEP,ee.REPLACE),new $n([ee.ONE,ee.ONE,ee.ONE,ee.ONE],r.ao.transparent,[!1,!1,!1,!0],ee.MIN),zn.disabled,b,"sdf",M,A,D,O,V,se,be,!1);{const we=de?fn.disabled:new fn({func:ee.EQUAL,mask:255},255,255,ee.KEEP,ee.DECR,ee.DECR),Ue=de?p.colorModeForRenderPass():new $n([ee.ONE_MINUS_DST_ALPHA,ee.DST_ALPHA,ee.ONE,ee.ONE],r.ao.transparent,[!0,!0,!0,!0]);Mu(Me,p,s,c,m,le,we,Ue,zn.disabled,b,"color",M,A,D,O,V,se,be,!1)}}function Pa(p){return[p[0]*r.eh,p[1]*r.eh,p[2]*r.eh,0]}function zh(p,s,c,m,b,M,A,D,O){const V=m.getSource(),H=c.globeSharedBuffers;if(!H)return;let Q,K,ee;if(s&&(Q=m.getTile(s)),V instanceof r.aU?(K=V.texture,ee=r.dK(0,0,c.transform)):Q&&s&&(K=Q.texture,ee=r.dK(s.canonical.z,s.canonical.x,c.transform)),!K||!ee)return;p||(ee=r.cS(r.bC(),ee,[1,-1,1]));const le=c.context,se=le.gl,pe=b.paint.get("raster-resampling")==="nearest"?se.NEAREST:se.LINEAR,de=c.colorModeForDrapableLayerRenderPass(M),be=A.defines;be.push("GLOBE_POLES");const Me=new sn(se.LEQUAL,sn.ReadWrite,c.depthRangeFor3D),we=Float32Array.from(c.transform.expandedFarZProjMatrix),Ue=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),le.activeTexture.set(se.TEXTURE0),K.bind(pe,se.CLAMP_TO_EDGE),le.activeTexture.set(se.TEXTURE1),K.bind(pe,se.CLAMP_TO_EDGE),"useMipmap"in K&&le.extTextureFilterAnisotropic&&c.transform.pitch>20&&se.texParameterf(se.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[Pe,Ne,Oe,Le]=s?H.getPoleBuffers(s.canonical.z,!1):H.getPoleBuffers(0,!0),Ye=b.paint.get("raster-elevation");let ct;p?(ct=Pe,c.renderDefaultNorthPole=Ye!==0):(ct=Ne,c.renderDefaultSouthPole=Ye!==0);const rt=Pa(A.mix),_t=((St,Ft,nt,qe,yt,pt,Ut,ei,vi,ni,ti,Zi,Si)=>Hm(St,Ft,nt,new Float32Array(16),new Float32Array(9),[0,0],qe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},pt,[0,0],ei,2,ni,ti,Zi,1,0,Si))(we,Ue,ee,r.aj(c.transform.zoom),0,b,0,Ye,0,rt,A.offset,A.range,M),xt=c.getOrCreateProgram("raster",{defines:be});c.uploadCommonUniforms(le,xt,null),xt.draw(c,se.TRIANGLES,Me,O,de,D,_t,b.id,ct,Oe,Le)}function up(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,b=.2*p.height,M=s+b;return[s,c,(M-b-s)/m,(M-s)/m]}function Vc(p,s,c,m){if(p)return s instanceof as&&p instanceof Qf?s.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Pa(m.mix),offset:m.offset,buffer:0,tileSize:1}}var ms=r.ei([{name:"a_index",type:"Int16",components:1}]);class Gc{constructor(s,c,m,b){const M={width:m[0],height:m[1],data:null},A=s.gl;this.targetColorTexture=new r.T(s,M,A.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(s,M,A.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,b),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,b=c.width*c.height;this.particleTexture0=new r.T(this.context,c,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,c,m.RGBA8,{premultiply:!1,useMipmap:!1});const M=new r.ej;M.reserve(b);for(let A=0;A<b;A++)M.emplaceBack(A);this.particleIndexBuffer=this.context.createVertexBuffer(M,ms.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function hp(p,s,c){if(!p)return null;const m=s.getTextureDescriptor(p,c,!0);if(!m)return null;let{texture:b,mix:M,offset:A,tileSize:D,buffer:O,format:V}=m;if(!b||!V)return null;let H=!1;return V==="uint32"&&(H=!0,M[3]=0,M=bu(r.ek,M,[0,c.paint.get("raster-particle-max-speed")]),A=gd(r.ek,A,[0,c.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[O/(D+2*O),D/(D+2*O)],tileSize:D,scalarData:H,scale:M,offset:A,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function qm(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,b=.2*p.height,M=s+b;return[s,c,(M-b-s)/m,(M-s)/m]}const Zp=new r.ao(1,0,0,1),Xm=new r.ao(0,1,0,1),wg=new r.ao(0,0,1,1),Oh=new r.ao(1,0,1,1),Bh=new r.ao(0,1,1,1);function fi(p,s,c,m,b,M){for(let A=0;A<c.length;A++)if(b){const V=new r.ao(m.r*.8,m.g*.8,m.b*.8,1);Mi(p,s,c[A],m,-1,-1,M),Mi(p,s,c[A],m,-1,1,M),Mi(p,s,c[A],m,1,1,M),Mi(p,s,c[A],m,1,-1,M),Mi(p,s,c[A],V,0,0,M)}else Mi(p,s,c[A],m,0,0,M)}function Mi(p,s,c,m,b,M,A){const D=p.context,O=p.transform,V=D.gl,H=O.projection.name==="globe",Q=H?["PROJECTION_GLOBE_VIEW"]:[];let K=r.bz(c.projMatrix);if(H&&r.aj(O.zoom)>0){const rt=r.bj(c.canonical,O),_t=r.el(rt);K=r.aB(new Float32Array(16),O.globeMatrix,_t),r.aB(K,O.projMatrix,K)}const ee=r.bC();ee[12]+=2*b/(r.o.devicePixelRatio*O.width),ee[13]+=2*M/(r.o.devicePixelRatio*O.height),r.aB(K,ee,K);const le=p.getOrCreateProgram("debug",{defines:Q}),se=s.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(se,le);const pe=sn.disabled,de=fn.disabled,be=p.colorModeForRenderPass(),Me="$debug";D.activeTexture.set(V.TEXTURE0),p.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),H?se._makeGlobeTileDebugBuffers(p.context,O):se._makeDebugTileBoundsBuffers(p.context,O.projection);const we=se._tileDebugBuffer||p.debugBuffer,Ue=se._tileDebugIndexBuffer||p.debugIndexBuffer,Pe=se._tileDebugSegments||p.debugSegments;if(le.draw(p,V.LINE_STRIP,pe,de,be,zn.disabled,md(K,m.toPremultipliedRenderColor(null)),Me,we,Ue,Pe,null,null,null,[se._globeTileDebugBorderBuffer]),A){const rt=se.latestRawTileData,_t=Math.floor((rt&&rt.byteLength||0)/1024);let xt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(xt+=` => ${c.overscaledZ}`),xt+=` ${se.state}`,xt+=` ${_t}kb`,(function(St,Ft){St.initDebugOverlayCanvas();const nt=St.debugOverlayCanvas,qe=St.context.gl,yt=St.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,nt.width,nt.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(Ft,5,5),yt.strokeText(Ft,5,5),St.debugOverlayTexture.update(nt),St.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)})(p,xt)}const Ne=s.getTile(c).tileSize,Oe=512/Math.min(Ne,512)*(c.overscaledZ/O.zoom)*.5,Le=se._tileDebugTextBuffer||p.debugBuffer,Ye=se._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,ct=se._tileDebugTextSegments||p.debugSegments;le.draw(p,V.TRIANGLES,pe,de,$n.alphaBlended,zn.disabled,md(K,r.ao.transparent.toPremultipliedRenderColor(null),Oe),Me,Le,Ye,ct,null,null,null,[se._globeTileDebugTextBuffer])}function Au(p,s,c,m){dt(p,0,s+c/2,p.transform.width,c,m)}function Ys(p,s,c,m){dt(p,s-c/2,0,c,p.transform.height,m)}function dt(p,s,c,m,b,M){const A=p.context,D=A.gl;D.enable(D.SCISSOR_TEST),D.scissor(s*r.o.devicePixelRatio,c*r.o.devicePixelRatio,m*r.o.devicePixelRatio,b*r.o.devicePixelRatio),A.clear({color:M}),D.disable(D.SCISSOR_TEST)}const Sg=r.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Yp}=Sg;function Hc(p,s,c,m){p.emplaceBack(s,c,m)}class xd{constructor(s){this.vertexArray=new r.em,this.indices=new r.b0,Hc(this.vertexArray,-1,-1,1),Hc(this.vertexArray,1,-1,1),Hc(this.vertexArray,-1,1,1),Hc(this.vertexArray,1,1,1),Hc(this.vertexArray,-1,-1,-1),Hc(this.vertexArray,1,-1,-1),Hc(this.vertexArray,-1,1,-1),Hc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Yp),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function bf(p,s,c,m,b,M){const A=p.context.gl,D=s.paint.get("sky-atmosphere-color"),O=s.paint.get("sky-atmosphere-halo-color"),V=s.paint.get("sky-atmosphere-sun-intensity"),H=((Q,K,ee,le,se)=>({u_matrix_3f:Q,u_sun_direction:K,u_sun_intensity:ee,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[se.r,se.g,se.b,se.a],u_luminance:5e-5}))(r.eo(r.dO(),m),b,V,D.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+M,s.skyboxTexture,0),c.draw(p,A.TRIANGLES,sn.disabled,fn.disabled,$n.unblended,zn.frontCW,H,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Tg=r.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class vd{constructor(s){const c=new r.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new r.b0;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,Tg.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const o_=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class l_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class c_{constructor(s){this.colorModeAlphaBlendedWriteRGB=new $n([1,El,1,El],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new $n([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new l_,this.updateNeeded=!0}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new vd(c);const m=this.params.sizeRange,b=this.params.intensityRange,M=(function(H){const Q=r.eq(30),K=[];for(let ee=0;ee<H;++ee){const le=2*Math.PI*Q(),se=Math.acos(1-2*Q())-.5*Math.PI;K.push(r.d5(Math.cos(se)*Math.cos(le),Math.cos(se)*Math.sin(le),Math.sin(se)))}return K})(this.params.starsCount),A=r.eq(300),D=new r.er,O=new r.b0;let V=0;for(let H=0;H<M.length;++H){const Q=r.c5([],M[H],200),K=Math.max(0,1+.01*m*(1*A()-.5)),ee=Math.max(0,1+.01*b*(1*A()-.5));D.emplaceBack(Q[0],Q[1],Q[2],-1,-1,K,ee),D.emplaceBack(Q[0],Q[1],Q[2],1,-1,K,ee),D.emplaceBack(Q[0],Q[1],Q[2],1,1,K,ee),D.emplaceBack(Q[0],Q[1],Q[2],-1,1,K,ee),O.emplaceBack(V+0,V+1,V+2),O.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=c.createVertexBuffer(D,o_.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=r.bg.simpleSegment(0,0,D.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const m=s.context,b=m.gl,M=s.transform,A=new sn(b.LEQUAL,sn.ReadOnly,[0,1]),D=r.aj(M.zoom),O=s.style.getLut(c.scope),V=c.properties.get("color-use-theme")==="none",H=c.properties.get("color").toNonPremultipliedRenderColor(V?null:O),Q=c.properties.get("high-color-use-theme")==="none",K=c.properties.get("high-color").toNonPremultipliedRenderColor(Q?null:O),ee=c.properties.get("space-color-use-theme")==="none",le=c.properties.get("space-color").toNonPremultipliedRenderColor(ee?null:O),se=5e-4,pe=r.es(c.properties.get("horizon-blend"),0,1,se,.25),de=r.dE(s,m,M)&&pe===se?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,be=s.frameCounter/1e3%1,Me=r.ag(M.globeCenterInViewSpace),we=Math.sqrt(Math.pow(Me,2)-Math.pow(de,2)),Ue=Math.acos(we/Me),Pe=Ne=>{const Oe=M.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ne&&Oe.push("ALPHA_PASS");const Le=s.getOrCreateProgram("globeAtmosphere",{defines:Oe}),Ye=((rt,_t,xt,St,Ft,nt,qe,yt,pt,Ut,ei,vi)=>({u_frustum_tl:rt,u_frustum_tr:_t,u_frustum_br:xt,u_frustum_bl:St,u_horizon:Ft,u_transition:nt,u_fadeout_range:qe,u_atmosphere_fog_color:yt.toArray01(),u_high_color:pt.toArray01(),u_space_color:Ut.toArray01(),u_temporal_offset:ei,u_horizon_angle:vi}))(M.frustumCorners.TL,M.frustumCorners.TR,M.frustumCorners.BR,M.frustumCorners.BL,M.frustumCorners.horizon,D,pe,H,K,le,be,Ue);s.uploadCommonUniforms(m,Le);const ct=this.atmosphereBuffer;ct&&Le.draw(s,b.TRIANGLES,A,fn.disabled,Ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,zn.backCW,Ye,Ne?"atmosphere_glow_alpha":"atmosphere_glow",ct.vertexBuffer,ct.indexBuffer,ct.segments)};Pe(!1),Pe(!0)}drawStars(s,c){const m=r.aA(c.properties.get("star-intensity"),0,1);if(m===0)return;const b=s.context,M=b.gl,A=s.transform,D=s.getOrCreateProgram("stars"),O=r.c7([]);r.c9(O,O,-A._pitch),r.c8(O,O,-A.angle),r.c9(O,O,r.an(A._center.lat)),r.et(O,O,-r.an(A._center.lng));const V=r.cc(new Float32Array(16),O),H=r.aB([],A.starsProjMatrix,V),Q=r.eo([],V),K=r.eu([],Q),ee=[0,1,0];r.dQ(ee,ee,K),r.c5(ee,ee,this.params.sizeMultiplier);const le=[1,0,0];r.dQ(le,le,K),r.c5(le,le,this.params.sizeMultiplier);const se=(pe=ee,de=le,be=m,{u_matrix:Float32Array.from(H),u_up:pe,u_right:de,u_intensity_multiplier:be});var pe,de,be;s.uploadCommonUniforms(b,D),this.starsVx&&this.starsIdx&&D.draw(s,M.TRIANGLES,sn.disabled,fn.disabled,this.colorModeAlphaBlendedWriteRGB,zn.disabled,se,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Kp{constructor(){this.visibleTiles=[]}updateBorders(s,c){const m=[],b=[],M=s._getRenderableCoordinates(!1,!0);for(const O of M){const V=s.getTile(O);if(!V.hasData())continue;const H=V.getBucket(c);H&&(H.isEmpty()||(m.push(O.key),b.push({bucket:H,tileID:O.canonical})))}let A=m.length!==this.visibleTiles.length;if(!A){m.sort();for(let O=0;O<m.length;O++)if(m[O]!==this.visibleTiles[O]){A=!0;break}}if(!A)return;const D=new Set;this.visibleTiles=m,b.sort(((O,V)=>O.tileID.z-V.tileID.z||O.tileID.x-V.tileID.x||O.tileID.y-V.tileID.y));for(const O of b){const V=new Array,H=new Array,Q=O.bucket;for(const K of Q.featuresOnBorder)D.has(K.featureId)?H.push(K.footprintIndex):(D.add(K.featureId),V.push(K.footprintIndex));Q.updateFootprintHiddenFlags(V,r.ev,!1),Q.updateFootprintHiddenFlags(H,r.ev,!0)}}}function Nh(p,s){const c=[...p],m=s.cameraWorldSizeForFog/s.worldSize,b=r.bA([]);return r.cS(b,b,[m,m,1]),r.aB(c,b,c),r.aB(c,s.worldToFogMatrix,c),c}function $p(p,s,c,m,b){const M=c.material,A=m.context,{baseColorTexture:D,metallicRoughnessTexture:O}=M.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:H,emissionTexture:Q}=M;function K(le,se,pe){if(le&&(p.push(se),A.activeTexture.set(A.gl.TEXTURE0+pe),le.gfxTexture)){const{minFilter:de,magFilter:be,wrapS:Me,wrapT:we}=le.sampler;le.gfxTexture.bindExtraParam(de,be,Me,we)}}K(D,"HAS_TEXTURE_u_baseColorTexture",ts.BaseColor),K(O,"HAS_TEXTURE_u_metallicRoughnessTexture",ts.MetallicRoughness),K(V,"HAS_TEXTURE_u_normalTexture",ts.Normal),K(H,"HAS_TEXTURE_u_occlusionTexture",ts.Occlusion),K(Q,"HAS_TEXTURE_u_emissionTexture",ts.Emission),b&&(b.texture||(b.texture=new r.d$(m.context,b.image,[b.image.height,b.image.height,b.image.height],A.gl.RGBA8)),A.activeTexture.set(A.gl.TEXTURE0+ts.LUT),b.texture&&b.texture.bind(A.gl.LINEAR,A.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),M.alphaMode!=="OPAQUE"&&M.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),M.defined||p.push("DIFFUSE_SHADED");const ee=m.shadowRenderer;ee&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ee.useNormalOffset&&p.push("NORMAL_OFFSET"))}function bd(p,s,c,m,b,M){const A=p.modelOpacity,D=s.context,O=new sn(s.context.gl.LEQUAL,p.isLightMesh?sn.ReadOnly:sn.ReadWrite,s.depthRangeFor3D),V=s.transform,H=p.mesh,Q=H.material,K=Q.pbrMetallicRoughness,ee=s.style.fog;let le;le=s.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.aB([],m.zScaleMatrix,p.nodeModelMatrix),r.aB(le,m.negCameraPosMatrix,le);const se=r.bl([],le);r.eg(se,se);const pe=c.paint.get("model-color-use-theme").constantOr("default")==="none",de=c.paint.get("model-emissive-strength").constantOr(0),be=Oo(new Float32Array(p.worldViewProjection),new Float32Array(le),new Float32Array(se),null,s,A,K.baseColorFactor,Q.emissiveFactor,K.metallicFactor,K.roughnessFactor,Q,de,c,void 0,void 0,p.materialOverride,p.modelColor),Me={defines:[]},we=[],Ue=s.shadowRenderer;Ue&&(Ue.useNormalOffset=!1),$p(Me.defines,we,H,s,pe?null:c.lut);let Pe=null;if(ee){const Le=Nh(p.nodeModelMatrix,s.transform);if(Pe=new Float32Array(Le),V.projection.name!=="globe"){const Ye=H.aabb.min,ct=H.aabb.max,[rt,_t]=ee.getOpacityForBounds(Le,Ye[0],Ye[1],ct[0],ct[1]);Me.overrideFog=rt>=ye||_t>=ye}}const Ne=ou(s,c.paint.get("model-cutoff-fade-range"));Ne.shouldRenderCutoff&&Me.defines.push("RENDER_CUTOFF");const Oe=s.getOrCreateProgram("model",Me);s.uploadCommonUniforms(D,Oe,null,Pe,Ne),s.renderPass!=="shadow"&&Ue&&Ue.setupShadowsFromMatrix(p.nodeModelMatrix,Oe),Oe.draw(s,D.gl.TRIANGLES,O,b,M,H.material.doubleSided?zn.disabled:zn.backCCW,be,c.id,H.vertexBuffer,H.indexBuffer,H.segments,c.paint,s.transform.zoom,void 0,we)}function wf(p,s){return p.style._importedAsBasemap?"basemap":s.scope}function Sf(p,s,c,m,b,M,A,D,O,V){const H=p.transform,Q=!!s.isGeometryBloom&&s.isGeometryBloom;if(Q&&p.renderPass==="shadow")return;const K=H.projection.name==="globe"?r.eD(c,H):[...c];r.aB(K,K,s.globalMatrix);const ee=r.aB([],m,K);if(s.meshes)for(const le of s.meshes){const se=D.get(le.material.name);if(se&&se.opacity<=0)continue;if(le.material.alphaMode!=="BLEND"){A.push({mesh:le,depth:0,modelIndex:b,worldViewProjection:ee,nodeModelMatrix:K,isLightMesh:Q,materialOverride:se,modelOpacity:O,modelColor:V});continue}const pe=r.af([],le.centroid,ee);!H.isOrthographic&&pe[2]<=0||M.push({mesh:le,depth:pe[2],modelIndex:b,worldViewProjection:ee,nodeModelMatrix:K,isLightMesh:Q,materialOverride:se,modelOpacity:O,modelColor:V})}if(s.children)for(const le of s.children)Sf(p,le,c,m,b,M,A,D,O,V)}function gc(p,s,c,m){const b=c.shadowRenderer;if(!b)return;const M=b.getShadowPassDepthMode(),A=b.getShadowPassColorMode(),D=b.calculateShadowPassMatrixFromMatrix(s),O=ah(D);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,M,fn.disabled,A,zn.disabled,O,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,c.transform.zoom,void 0,void 0)}function Mg(p,s,c,m,b,M){for(const A of b){const D=Object.assign({},m);D.part=A;const O={type:"Unknown",id:s,properties:D},V={orientation:p.paint.get("model-rotation").evaluate(O,c)};M.set(A,V)}}function Eg(p,s,c,m,b,M){for(const A of b){const D=Object.assign({},m);D.part=A;const O={type:"Unknown",id:s,properties:D},V={color:p.paint.get("model-color").evaluate(O,c),colorMix:p.paint.get("model-color-mix-intensity").evaluate(O,c),opacity:p.paint.get("model-opacity").evaluate(O,c),emissionStrength:p.paint.get("model-emissive-strength").evaluate(O,c)};M.set(A,V)}}function Ag(p,s,c,m,b){let M=!1;for(const D of m)D.modelOpacity!==1&&(bd(D,p,s,b[D.modelIndex],fn.disabled,$n.disabled),M=!0);for(const D of m)bd(D,p,s,b[D.modelIndex],D.modelOpacity!==1?p.stencilModeFor3D():fn.disabled,p.colorModeForRenderPass());M&&p.resetStencilClippingMasks();const A=$n.additive;for(const D of c)bd(D,p,s,b[D.modelIndex],fn.disabled,D.isLightMesh?A:p.colorModeForRenderPass())}function $l(p,s,c){const m=s.updateZoomBasedPaintProperties(),b=(function(M,A,D){let O,V,H,Q=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&Q>0){const K=M.terrain,ee=K.findDEMTileFor(D);ee&&ee.dem?O=r.eF.create(K,D,ee):Q=0}if(Q===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),Q===A.validForExaggeration&&(Q===0||O&&O._demTile&&O._demTile.tileID===A.validForDEMTile.id&&O._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const K in A.instancesPerModel){const ee=A.instancesPerModel[K];for(let le=0;le<ee.instancedDataArray.length;++le){const se=(O?Q*O.getElevationAt(0|ee.instancedDataArray.float32[16*le],0|ee.instancedDataArray.float32[16*le+1],!0,!0):0)+ee.instancesEvaluatedElevation[le];ee.instancedDataArray.float32[16*le+6]=se,V=V?Math.min(A.terrainElevationMin,se):se,H=H?Math.max(A.terrainElevationMax,se):se}}return A.terrainElevationMin=V||0,A.terrainElevationMax=H||0,A.validForExaggeration=Q,A.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0})(p,s,c);(m||b)&&(s.uploaded=!1,s.upload(p.context))}const jc={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d9([0,0,0],[r.al,r.al,0])};function wo(p,s){const c=1<<p.canonical.z,m=s.getFreeCameraOptions().position,b=s.elevation,M=p.canonical.x/c,A=(p.canonical.x+1)/c,D=p.canonical.y/c,O=(p.canonical.y+1)/c;let V=s._centerAltitude;if(b){const ee=b.getMinMaxForTile(p);ee&&ee.max>V&&(V=ee.max)}const H=r.aA(m.x,M,A)-m.x,Q=r.aA(m.y,D,O)-m.y,K=r.cf(V,s.center.lat)-m.z;return s._zoomFromMercatorZ(Math.sqrt(H*H+Q*Q+K*K))}function Jp(p,s,c,m,b,M,A){const D=p.context,O=p.renderPass==="shadow",V=p.shadowRenderer,H=O&&V?V.getShadowPassDepthMode():new sn(D.gl.LEQUAL,sn.ReadWrite,p.depthRangeFor3D),Q=p.isTileAffectedByFog(M),K=p.transform.projection.name==="globe";if(c.meshes)for(const ee of c.meshes){const le=K?[]:["MODEL_POSITION_ON_GPU"],se=[];let pe,de,be;const Me=!K&&m.instancedDataArray.length>20;Me&&le.push("INSTANCED_ARRAYS");const we=ou(p,s.paint.get("model-cutoff-fade-range"));if(we.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),O&&V)pe=p.getOrCreateProgram("modelDepth",{defines:le}),de=ah(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(c.globalMatrix)),be=V.getShadowPassColorMode();else{$p(le,se,ee,p,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),pe=p.getOrCreateProgram("model",{defines:le,overrideFog:Q});const Pe=ee.material,Ne=Pe.pbrMetallicRoughness,Oe=s.paint.get("model-opacity").constantOr(1),Le=s.paint.get("model-emissive-strength").constantOr(0);de=Oo(M.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,p,Oe,Ne.baseColorFactor,Pe.emissiveFactor,Ne.metallicFactor,Ne.roughnessFactor,Pe,Le,s,b),V&&(A.shadowUniformsInitialized?pe.setShadowUniformValues(D,V.getShadowUniformValues()):(V.setupShadows(M.toUnwrapped(),pe,"model-tile"),A.shadowUniformsInitialized=!0)),be=we.shouldRenderCutoff||Oe<1||Pe.alphaMode!=="OPAQUE"?$n.alphaBlended:$n.unblended}p.uploadCommonUniforms(D,pe,M.toUnwrapped(),null,we);const Ue=ee.material.doubleSided?zn.disabled:zn.backCCW;if(Me)se.push(m.instancedDataBuffer),pe.draw(p,D.gl.TRIANGLES,H,fn.disabled,be,Ue,de,s.id,ee.vertexBuffer,ee.indexBuffer,ee.segments,s.paint,p.transform.zoom,void 0,se,m.instancedDataArray.length);else{const Pe=O?"u_instance":"u_normal_matrix";for(let Ne=0;Ne<m.instancedDataArray.length;++Ne)de[Pe]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Ne,16),pe.draw(p,D.gl.TRIANGLES,H,fn.disabled,be,Ue,de,s.id,ee.vertexBuffer,ee.indexBuffer,ee.segments,s.paint,p.transform.zoom,void 0,se)}}if(c.children)for(const ee of c.children)Jp(p,s,ee,m,b,M,A)}const wd=[1,-1,1];function Cg(p,s,c,m){if(!c.modelManager)return!0;const b=c.modelManager;if(!c.shadowRenderer)return!0;const M=c.shadowRenderer,A=s.aabb;let D=!0,O=p.maxHeight;if(O===0){let H=0;for(const Q in p.instancesPerModel){const K=b.getModel(Q,m);K?H=Math.max(H,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):D=!1}O=p.maxScale*H*1.41+p.maxVerticalOffset,D&&(p.maxHeight=O)}A.max[2]=O,A.min[2]+=p.terrainElevationMin,A.max[2]+=p.terrainElevationMax,r.af(A.min,A.min,s.tileMatrix),r.af(A.max,A.max,s.tileMatrix);const V=A.intersects(M.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=V===2),V===0}function Ms(p,s){const c=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],b=p.uniformValues.u_cutoff_params[2],M=p.uniformValues.u_cutoff_params[3];return m===c||M===b?1:r.aA(((s-c)/(m-c)-b)/(M-b),0,1)}function vr(p,s,c,m){if(s.pitch<20)return 1;const b=s.getWorldToCameraMatrix();r.aB(b,b,p);const M=r.bU(c.min[0],c.min[1],c.min[2],1);let A=r.aC(r.eG(),M,b),D=A,O=A;M[1]=c.max[1],A=r.aC(r.eG(),M,b),D=A[1]<D[1]?A:D,O=A[1]>O[1]?A:O,M[0]=c.max[0],A=r.aC(r.eG(),M,b),D=A[1]<D[1]?A:D,O=A[1]>O[1]?A:O,M[1]=c.min[1],A=r.aC(r.eG(),M,b),D=A[1]<D[1]?A:D,O=A[1]>O[1]?A:O;const V=r.aA(m[0],0,1),H=100*s.pixelsPerMeter*r.aA(m[1],0,1),Q=r.aA(m[2],0,1),K=r.eH(r.eG(),D,O,V),ee=Math.tan(.5*s.fovX),le=-K[2]*ee;if(H===0)return K[1]<-Math.abs(le)?Q:1;const se=(-Math.abs(le)-K[1])/H,pe=(be,Me,we)=>(1-we)*be+we*Me,de=r.aA(pe(1,Q,se),Q,1);return pe(1,de,r.aA((s.pitch-20)/20,0,1))}class Wm{}class Tf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,m){{const Q=this._storage.get(c.id);if(Q)return Q.lastUsedFrameIdx=s,Q.buf}const b=m.gl,M=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),A=new ArrayBuffer(M),D=new Int16Array(A);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const O=new r.eJ;for(let Q=0;Q<M/2;Q+=3){const K=D[Q],ee=D[Q+1],le=D[Q+2];O.emplaceBack(K,ee),O.emplaceBack(ee,le),O.emplaceBack(le,K)}const V=m.bindVertexArrayOES.current,H=new Wm;return H.buf=new kc(m,O),H.lastUsedFrameIdx=s,this._storage.set(c.id,H),m.bindVertexArrayOES.set(V),H.buf}update(s){for(const[c,m]of this._storage)s-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class Mf{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Sd=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Cu{constructor(s){this.revealStart=11,this.revealRange=2}}const Qp=r.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class So{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,c){const m=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const A=new r.eK,D=new r.b0;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(A,Qp.members),this.vignetteIdx=s.context.createIndexBuffer(D)}const b=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,m);const A={u_vignetteShape:(M={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:M.vignetteColor};m.draw(s,s.context.gl.TRIANGLES,sn.disabled,fn.disabled,$n.alphaBlended,zn.disabled,A,"vignette",this.vignetteVx,this.vignetteIdx,b)}var M}}class em{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,c){const m=s.getFreeCameraOptions().position,b=m.toAltitude(),M=m.toLngLat(),A=r.an(M.lng),D=r.an(M.lat),O=s.pixelsPerMeter/c,V=A*r.eM,H=r.eM*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Q=-this._offsetYPrev+H,K=-this._elevationPrev+b;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*O,this._accumulatedOffsetY+=Q*O,this._accumulatedElevation+=K*O,this._offsetXPrev=V,this._offsetYPrev=H,this._elevationPrev=b}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Zm(p,s){return[-(p[0]-Math.floor(p[0]/s)*s),-(p[1]-Math.floor(p[1]/s)*s),-(p[2]-Math.floor(p[2]/s)*s)]}function _c(p){const s=r.eq(1323123451230),c=[];for(let m=0;m<p;++m){const b=2*s()-1,M=2*s()-1,A=2*s()-1;c.push(r.d5(b,M,A))}return c}function ul(p,s,c,m,b){const M=r.aA((b-c)/(m-c),0,1);return(1-M)*p+M*s}class qc{constructor(s){this._movement=new em,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new So,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,c){const m=s.transform;this._movement.update(m,this._ppmScaleFactor);const b=m.starsProjMatrix,M=r.c7([]);r.c9(M,M,r.an(90)-m._pitch),r.c8(M,M,-m.angle);const A=r.cc(new Float32Array(16),M),D=r.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=r.eg([],D),V=r.aB([],O,A),H=Date.now()/1e3;return this._accumulatedTimeFromStart+=(H-this._prevTime)*c,this._prevTime=H,{projectionMatrix:b,modelviewMatrix:V}}}class Ef extends qc{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Cu("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const m=_c(this.particlesCount),b=new r.eN,M=new r.b0;let A=0;const D=r.eq(1323123451230);for(let O=0;O<m.length;++O){const V=m[O],H=[2*D()-1,D(),D(),D()];b.emplaceBack(V[0],V[1],V[2],-1,-1,...H),b.emplaceBack(V[0],V[1],V[2],1,-1,...H),b.emplaceBack(V[0],V[1],V[2],1,1,...H),b.emplaceBack(V[0],V[1],V[2],-1,1,...H),M.emplaceBack(A+0,A+1,A+2),M.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=c.createVertexBuffer(b,Sd.members),this.particlesIdx=c.createIndexBuffer(M)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=s.transform.zoom;if(c.revealStart>m)return;const b=ul(0,1,c.revealStart,c.revealStart+c.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const M=structuredClone(this._params);let A=[-M.direction.x,M.direction.y,-100];r.aw(A,A);const D=structuredClone(this._vignetteParams);D.strength*=b,M.overrideStyleParameters||(M.intensity=s.style.rain.state.density,M.timeFactor=s.style.rain.state.intensity,M.color=structuredClone(s.style.rain.state.color),A=structuredClone(s.style.rain.state.direction),M.screenThinning.intensity=s.style.rain.state.centerThinning,M.dropletSizeX=s.style.rain.state.dropletSize[0],M.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],M.distortionStrength=100*s.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(s.style.rain.state.vignetteColor));const O=this.updateOnRender(s,M.timeFactor),V=s.context,H=V.gl,Q=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new r.T(V,{width:s.width,height:s.height,data:null},H.RGBA8)),M.distortionStrength>0&&(V.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),H.copyTexSubImage2D(H.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const K=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(V,K),V.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ee=[M.color.r,M.color.g,M.color.b,M.color.a],le=(se,pe)=>{const de=Zm(this._movement.getPosition(),se),be=M.dropletSizeX,Me=M.dropletSizeX*M.dropletSizeYScale,we=s.width/2,Ue=s.height/2,Pe=ul(0,M.screenThinning.start,0,1,M.screenThinning.intensity),Ne=ul(.001,M.screenThinning.range,0,1,M.screenThinning.intensity),Oe=ul(0,M.screenThinning.particleOffset,0,1,M.screenThinning.intensity),Le=(Ye={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:M.velocityConeAperture,velocity:M.velocity,boxSize:se,rainDropletSize:[be,Me],distortionStrength:M.distortionStrength,rainDirection:A,color:ee,screenSize:[Q.width,Q.height],thinningCenterPos:[we,Ue],thinningShape:[Pe,Ne,Math.pow(10,M.screenThinning.fadePower)],thinningAffectedRatio:M.screenThinning.affectedRatio,thinningParticleOffset:Oe,shapeDirectionalPower:M.shapeDirPower,shapeNormalPower:M.shapeNormalPower,mode:pe?0:1},{u_modelview:Float32Array.from(Ye.modelview),u_projection:Float32Array.from(Ye.projection),u_time:Ye.time,u_cam_pos:Ye.camPos,u_texScreen:0,u_velocityConeAperture:Ye.velocityConeAperture,u_velocity:Ye.velocity,u_boxSize:Ye.boxSize,u_rainDropletSize:Ye.rainDropletSize,u_distortionStrength:Ye.distortionStrength,u_rainDirection:Ye.rainDirection,u_color:Ye.color,u_screenSize:Ye.screenSize,u_thinningCenterPos:Ye.thinningCenterPos,u_thinningShape:Ye.thinningShape,u_thinningAffectedRatio:Ye.thinningAffectedRatio,u_thinningParticleOffset:Ye.thinningParticleOffset,u_shapeDirectionalPower:Ye.shapeDirectionalPower,u_shapeNormalPower:Ye.shapeNormalPower,u_mode:Ye.mode});var Ye;const ct=Math.round(M.intensity*this.particlesCount),rt=r.bg.simpleSegment(0,0,4*ct,2*ct);K.draw(s,H.TRIANGLES,sn.disabled,fn.disabled,$n.alphaBlended,zn.disabled,Le,"rain_particles",this.particlesVx,this.particlesIdx,rt)};M.distortionStrength>0&&le(M.boxSize,!0),le(M.boxSize,!1),this._vignette.draw(s,D)}}const Ru=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Fh extends qc{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Cu("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const m=_c(this.particlesCount),b=new r.eO,M=new r.b0;let A=0;const D=r.eq(1323123451230);for(let O=0;O<m.length;++O){const V=m[O],H=D(),Q=D(),K=D(),ee=[O/m.length,H,Q,K],le=[D(),D()];b.emplaceBack(V[0],V[1],V[2],-1,-1,...ee,...le),b.emplaceBack(V[0],V[1],V[2],1,-1,...ee,...le),b.emplaceBack(V[0],V[1],V[2],1,1,...ee,...le),b.emplaceBack(V[0],V[1],V[2],-1,1,...ee,...le),M.emplaceBack(A+0,A+1,A+2),M.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=c.createVertexBuffer(b,Ru.members),this.particlesIdx=c.createIndexBuffer(M)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const c=structuredClone(this._params);let m=[-c.direction.x,c.direction.y,-100];r.aw(m,m);const b=structuredClone(this._vignetteParams),M=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},A=s.transform.zoom;if(M.revealStart>A)return;const D=ul(0,1,M.revealStart,M.revealStart+M.revealRange,A);b.strength*=D,c.overrideStyleParameters||(c.intensity=s.style.snow.state.density,c.timeFactor=s.style.snow.state.intensity,c.color=structuredClone(s.style.snow.state.color),m=structuredClone(s.style.snow.state.direction),c.screenThinning.intensity=s.style.snow.state.centerThinning,c.billboardSize=2.79*s.style.snow.state.flakeSize,b.strength=1,b.color=structuredClone(s.style.snow.state.vignetteColor));const O=this.updateOnRender(s,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=s.context,H=V.gl,Q=s.transform,K=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(V,K),((ee,le,se)=>{const pe=Zm(this._movement.getPosition(),ee),de=Q.width/2,be=Q.height/2,Me=ul(0,se.screenThinning.start,0,1,se.screenThinning.intensity),we=ul(.001,se.screenThinning.range,0,1,se.screenThinning.intensity),Ue=ul(0,se.screenThinning.particleOffset,0,1,se.screenThinning.intensity),Pe=(Ne={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:pe,velocityConeAperture:se.velocityConeAperture,velocity:se.velocity,horizontalOscillationRadius:se.horizontalOscillationRadius,horizontalOscillationRate:se.horizontalOscillationRate,boxSize:ee,billboardSize:1*se.billboardSize,simpleShapeParameters:[se.shapeFadeStart,se.shapeFadePower],screenSize:[Q.width,Q.height],thinningCenterPos:[de,be],thinningShape:[Me,we,Math.pow(10,se.screenThinning.fadePower)],thinningAffectedRatio:se.screenThinning.affectedRatio,thinningParticleOffset:Ue,color:[se.color.r,se.color.g,se.color.b,se.color.a],direction:m},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_horizontalOscillationRadius:Ne.horizontalOscillationRadius,u_horizontalOscillationRate:Ne.horizontalOscillationRate,u_boxSize:Ne.boxSize,u_billboardSize:Ne.billboardSize,u_simpleShapeParameters:Ne.simpleShapeParameters,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_particleColor:Ne.color,u_direction:Ne.direction});var Ne;const Oe=Math.round(se.intensity*this.particlesCount),Le=r.bg.simpleSegment(0,0,4*Oe,2*Oe);this.particlesVx&&this.particlesIdx&&K.draw(s,H.TRIANGLES,sn.disabled,fn.disabled,$n.alphaBlended,zn.disabled,Pe,"snow_particles",this.particlesVx,this.particlesIdx,Le)})(c.boxSize,0,c),this._vignette.draw(s,b)}}const io={symbol:function(p,s,c,m,b){if(p.renderPass!=="translucent")return;const M=fn.disabled,A=p.colorModeForRenderPass(),D=c.layout.get("text-variable-anchor"),O=c.layout.get("text-size-scale-range"),V=r.aA(p.scaleFactor,O[0],O[1]);D&&(function(K,ee,le,se,pe,de,be,Me){const we=ee.transform,Ue=pe==="map",Pe=de==="map";for(const Ne of K){const Oe=se.getTile(Ne),Le=Oe.getBucket(le);if(!Le||!Le.text||!Le.text.segments.get().length)continue;const Ye=r.bK(Le.textSizeData,we.zoom,Me),ct=Ml(Ne,Le.getProjection(),we),rt=we.calculatePixelsToTileUnitsMatrix(Oe),_t=Po(ct,Oe.tileID.canonical,Pe,Ue,we,Le.getProjection(),rt),xt=Le.hasIconTextFit()&&Le.hasIconData();Ye&&gn(Le,Ue,Pe,be,we,_t,Ne,Math.pow(2,we.zoom-Oe.tileID.overscaledZ),Ye,xt)}})(m,p,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b,V);const H=c.paint.get("icon-opacity").constantOr(1)!==0,Q=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(H||Q)?Tu(p,s,c,m,M,A):(H&&Tu(p,s,c,m,M,A,{onlyIcons:!0}),Q&&Tu(p,s,c,m,M,A,{onlyText:!0})),s.map.showCollisionBoxes&&(oi(p,s,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),oi(p,s,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,c,m){if(p.renderPass!=="translucent")return;const b=c.paint.get("circle-opacity"),M=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),D=c.layout.get("circle-sort-key").constantOr(1)!==void 0,O=c.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(M.constantOr(1)===0||A.constantOr(1)===0))return;const V=p.context,H=V.gl,Q=p.transform,K=!(!p.terrain||!p.terrain.enabled),ee=c.layout.get("circle-elevation-reference"),le=p.depthModeForSublayer(0,sn.ReadOnly),se=new sn(p.context.gl.LEQUAL,sn.ReadOnly,p.depthRangeFor3D),pe=ee==="none"||K?le:se,de=fn.disabled,be=p.colorModeForDrapableLayerRenderPass(O),Me=Q.projection.name==="globe",we=[r.aF(Q.center.lng),r.aJ(Q.center.lat)],Ue=[];for(let Ne=0;Ne<m.length;Ne++){const Oe=m[Ne],Le=s.getTile(Oe),Ye=Le.getBucket(c);if(!Ye||Ye.projection.name!==Q.projection.name)continue;const ct=Ye.programConfigurations.get(c.id),rt=Ye.layoutVertexBuffer,_t=Ye.globeExtVertexBuffer,xt=Ye.indexBuffer,St=r.e0(c),Ft=[_t],nt=p.isTileAffectedByFog(Oe);Me&&St.push("PROJECTION_GLOBE_VIEW"),St.push("DEPTH_D24"),p.terrain&&Q.depthOcclusionForSymbolsAndCircles&&St.push("DEPTH_OCCLUSION"),Ye.hasElevation&&!p.terrain&&(St.push("ELEVATED_ROADS"),Ft.push(Ye.elevatedLayoutVertexBuffer));const qe=p.getOrCreateProgram("circle",{config:ct,defines:St,overrideFog:nt}),yt=Q.projection.createInversionMatrix(Q,Oe.canonical),pt={programConfiguration:ct,program:qe,layoutVertexBuffer:rt,dynamicBuffers:Ft,indexBuffer:xt,uniformValues:r.e1(p,Oe,Le,yt,we,c),tile:Le};if(D){const Ut=Ye.segments.get();for(const ei of Ut)Ue.push({segments:new r.bg([ei]),sortKey:ei.sortKey,state:pt})}else Ue.push({segments:Ye.segments,sortKey:0,state:pt})}D&&Ue.sort(((Ne,Oe)=>Ne.sortKey-Oe.sortKey));const Pe={useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles};for(const Ne of Ue){const{programConfiguration:Oe,program:Le,layoutVertexBuffer:Ye,dynamicBuffers:ct,indexBuffer:rt,uniformValues:_t,tile:xt}=Ne.state,St=Ne.segments;p.terrain&&p.terrain.setupElevationDraw(xt,Le,Pe),p.uploadCommonUniforms(V,Le,xt.tileID.toUnwrapped()),Le.draw(p,H.TRIANGLES,pe,de,be,zn.disabled,_t,c.id,Ye,rt,St,c.paint,Q.zoom,Oe,ct)}},heatmap:function(p,s,c,m){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const b=p.context,M=b.gl,A=fn.disabled,D=new $n([M.ONE,M.ONE,M.ONE,M.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(ee,le,se,pe){const de=ee.gl,be=le.width*pe,Me=le.height*pe;ee.activeTexture.set(de.TEXTURE1),ee.viewport.set([0,0,be,Me]);let we=se.heatmapFbo;if(!we||we&&(we.width!==be||we.height!==Me)){we&&we.destroy();const Ue=de.createTexture();de.bindTexture(de.TEXTURE_2D,Ue),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),we=se.heatmapFbo=ee.createFramebuffer(be,Me,1,null),(function(Pe,Ne,Oe,Le,Ye,ct){const rt=Pe.gl;rt.texImage2D(rt.TEXTURE_2D,0,Pe.extRenderToTextureHalfFloat?rt.RGBA16F:rt.RGBA,Ye,ct,0,rt.RGBA,Pe.extRenderToTextureHalfFloat?rt.HALF_FLOAT:rt.UNSIGNED_BYTE,null),Le.colorAttachment0.set(Oe)})(ee,0,Ue,we,be,Me)}else de.bindTexture(de.TEXTURE_2D,we.colorAttachment0.get()),ee.bindFramebuffer.set(we.framebuffer)})(b,p,c,p.transform.projection.name==="globe"?.5:.25),b.clear({color:r.ao.transparent});const O=p.transform,V=O.projection.name==="globe",H=V?["PROJECTION_GLOBE_VIEW"]:[],Q=V?zn.frontCCW:zn.disabled,K=[r.aF(O.center.lng),r.aJ(O.center.lat)];for(let ee=0;ee<m.length;ee++){const le=m[ee];if(s.hasRenderableParent(le))continue;const se=s.getTile(le),pe=se.getBucket(c);if(!pe||pe.projection.name!==O.projection.name)continue;const de=p.isTileAffectedByFog(le),be=pe.programConfigurations.get(c.id),Me=p.getOrCreateProgram("heatmap",{config:be,defines:H,overrideFog:de}),{zoom:we}=p.transform;p.terrain&&p.terrain.setupElevationDraw(se,Me),p.uploadCommonUniforms(b,Me,le.toUnwrapped());const Ue=O.projection.createInversionMatrix(O,le.canonical);Me.draw(p,M.TRIANGLES,sn.disabled,A,D,Q,rh(p,le,se,Ue,K,we,c.paint.get("heatmap-intensity")),c.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,c.paint,p.transform.zoom,be,V?[pe.globeExtVertexBuffer]:null)}b.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(b,M){const A=b.context,D=A.gl,O=M.heatmapFbo;if(!O)return;A.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,O.colorAttachment0.get()),A.activeTexture.set(D.TEXTURE1);let V=M.colorRampTexture;V||(V=M.colorRampTexture=new r.T(A,M.colorRamp,D.RGBA8)),V.bind(D.LINEAR,D.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,D.TRIANGLES,sn.disabled,fn.disabled,b.colorModeForRenderPass(),zn.disabled,((H,Q,K,ee)=>({u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}))(0,M),M.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,M.paint,b.transform.zoom)})(p,c))},line:function(p,s,c,m){if(p.renderPass!=="translucent")return;const b=c.paint.get("line-opacity"),M=c.paint.get("line-width");if(b.constantOr(1)===0||M.constantOr(1)===0)return;const A=c.paint.get("line-emissive-strength").isConstant(),D=c.paint.get("line-emissive-strength").constantOr(0),O=c.paint.get("line-occlusion-opacity"),V=c.layout.get("line-elevation-reference"),H=c.layout.get("line-width-unit")==="meters",Q=V==="sea",K=!(!p.terrain||!p.terrain.enabled),ee=p.context,le=ee.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const se=c.layout.get("line-cross-slope"),pe=se!==void 0,de=se<1,be=p.colorModeForDrapableLayerRenderPass(A?D:null),Me=p.terrain&&p.terrain.renderingToTexture,we=Me?1:r.o.devicePixelRatio,Ue=c.paint.get("line-dasharray"),Pe=Ue.constantOr(1),Ne=c.layout.get("line-cap"),Oe=Ue.constantOr(null),Le=Ne.constantOr(null),Ye=c.paint.get("line-pattern"),ct=Ye.constantOr(1),rt=c.paint.get("line-pattern-cross-fade"),_t=Ye.constantOr(null),xt=c.paint.get("line-opacity").constantOr(1);let St=!ct&&xt!==1||p.depthOcclusion&&O>0&&O<1;const Ft=c.paint.get("line-gradient"),nt=ct?"linePattern":"line",qe=r.e2(c);let yt;if(Me&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(St=!1),O!==0&&p.depthOcclusion){const vi=c.paint._values["line-opacity"];vi&&vi.value&&vi.value.kind==="constant"?yt=vi.value:r.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}M.value.kind!=="constant"&&M.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH"),Me&&(p.emissiveMode!=="dual-source-blending"||A?p.emissiveMode==="mrt-fallback"&&qe.push("USE_MRT1"):qe.push("DUAL_SOURCE_BLENDING"));const pt=(vi,ni,ti,Zi,Si,Ai)=>{for(const Oi of vi){const an=s.getTile(Oi);if(ct&&!an.patternsLoaded())continue;const Mn=an.getBucket(c);if(!Mn||Mn.elevationType!=="none"&&!Si||Mn.elevationType==="none"&&Si)continue;p.prepareDrawTile();const lr=[...ni],Lr=p.shadowRenderer,Yi=Mn.elevationType==="road"&&!!Lr&&Lr.enabled;let Ir=[0,0,0];if(Yi){const w=p.style.directionalLight,T=p.style.ambientLight;w&&T&&(Ir=$a(p.style,w,T)),lr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Dn=Mn.programConfigurations.get(c.id);let er=!1;if(_t&&an.imageAtlas){const w=r.e3.from(_t),T=w.getPrimary().scaleSelf(we).toString(),B=an.imageAtlas.patternPositions.get(T),q=w.getSecondary(),te=q?an.imageAtlas.patternPositions.get(q.scaleSelf(we).toString()):null;er=!!B&&!!te,B&&Dn.setConstantPatternPositions(B,te)}rt>0&&(er||Dn.getPatternTransitionVertexBuffer("line-pattern"))&&lr.push("LINE_PATTERN_TRANSITION");const Pr=p.isTileAffectedByFog(Oi),Sr=p.getOrCreateProgram(nt,{config:Dn,defines:lr,overrideFog:Pr});if(!ct&&Oe&&Le&&an.lineAtlas){const w=an.lineAtlas.getDash(Oe,Le);w&&Dn.setConstantPatternPositions(w)}Yi&&Lr.setupShadows(an.tileID.toUnwrapped(),Sr,"vector-tile");let[pr,qn]=c.paint.get("line-trim-offset");(Le==="round"||Le==="square")&&pr!==qn&&(pr===0&&(pr-=1),qn===1&&(qn+=1));const zr=Me?Oi.projMatrix:null,Os=H?1/Mn.tileToMeter/r.ay(an,1,p.transform.zoom):1,us=H?1/Mn.tileToMeter/r.ay(an,1,Math.floor(p.transform.zoom)):1,Nr=ct?r.e4(p,an,c,zr,we,Os,us,[pr,qn],Ir,rt):r.e5(p,an,c,zr,Mn.lineClipsArray.length,we,Os,us,[pr,qn],Ir);if(Ft){const w=Mn.gradients[c.id];let T=w.texture;if(c.gradientVersion!==w.version){let B=256;if(c.stepInterpolant){const q=s.getSource().maxzoom,te=Oi.canonical.z===q?Math.ceil(1<<p.transform.maxZoom-Oi.canonical.z):1;B=r.aA(r.e6(Mn.maxLineLength/r.al*1024*te),256,ee.maxTextureSize)}w.gradient=r.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:B,image:w.gradient||void 0,clips:Mn.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new r.T(ee,w.gradient,le.RGBA8),w.version=c.gradientVersion,T=w.texture}ee.activeTexture.set(le.TEXTURE1),T.bind(c.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}Pe&&(ee.activeTexture.set(le.TEXTURE0),an.lineAtlasTexture&&an.lineAtlasTexture.bind(le.LINEAR,le.REPEAT),Dn.updatePaintBuffers()),ct&&(ee.activeTexture.set(le.TEXTURE0),an.imageAtlasTexture&&an.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Dn.updatePaintBuffers()),Si&&!Q&&p.terrain.setupElevationDraw(an,Sr),p.uploadCommonUniforms(ee,Sr,Oi.toUnwrapped());const rr=w=>{yt!=null&&(yt.value=xt*O),Sr.draw(p,le.TRIANGLES,ti,w,be,zn.disabled,Nr,c.id,Mn.layoutVertexBuffer,Mn.indexBuffer,Mn.segments,c.paint,p.transform.zoom,Dn,[Mn.layoutVertexBuffer2,Mn.patternVertexBuffer,Mn.zOffsetVertexBuffer]),yt!=null&&(yt.value=xt)};if(St&&!Si){const w=p.stencilModeForClipping(Oi).ref;w===0&&Me&&ee.clear({stencil:0});const T={func:le.EQUAL,mask:255};Nr.u_alpha_discard_threshold=.8,rr(new fn(T,w,255,le.KEEP,le.KEEP,le.INVERT)),Nr.u_alpha_discard_threshold=0,rr(new fn(T,w,255,le.KEEP,le.KEEP,le.KEEP))}else Nr.u_alpha_discard_threshold=St&&Si&&Ai?.8:0,rr(Si?Zi:p.stencilModeForClipping(Oi))}};let Ut=p.depthModeForSublayer(0,sn.ReadOnly);const ei=new sn(p.depthOcclusion?le.GREATER:le.LEQUAL,sn.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){const vi=!Me&&p.terrain;O!==0&&vi?r.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):vi?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):pt(m,qe,Ut,fn.disabled,!1,!0)}if(c.hasElevatedBuckets){V==="hd-road-markup"?K||(Ut=ei,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),Ut=ei,pe&&qe.push(de?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Q&&qe.push("ELEVATION_REFERENCE_SEA"));const vi=St?p.stencilModeFor3D():fn.disabled;p.forceTerrainMode=!0,pt(m,qe,Ut,vi,!0,!0),St&&pt(m,qe,Ut,vi,!0,!1),p.forceTerrainMode=!1}St&&(p.resetStencilClippingMasks(),Me&&ee.clear({stencil:0})),O===0||p.depthOcclusion||Me||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,s,c,m){const b=c.paint.get("fill-color"),M=c.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const A=c.paint.get("fill-emissive-strength"),D=p.colorModeForDrapableLayerRenderPass(A),O=c.paint.get("fill-pattern"),V=p.opaquePassEnabledForLayer()&&!O.constantOr(1)&&b.constantOr(r.ao.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";let H="none";c.layout.get("fill-elevation-reference")!=="none"?H="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(H="offset");const Q=!(!p.terrain||!p.terrain.enabled),K={painter:p,sourceCache:s,layer:c,coords:m,colorMode:D,elevationType:H,terrainEnabled:Q,pass:V};if(p.renderPass==="shadow")return void(p.shadowRenderer&&H==="road"&&!Q&&(function(le){const{painter:se,sourceCache:pe,layer:de,coords:be}=le,Me=se.context.gl,we=le.painter.shadowRenderer;for(const Ue of be){const Pe=pe.getTile(Ue),Ne=Pe.getBucket(de);if(!Ne)continue;const Oe=Ne.elevatedStructures;if(!Oe||!Oe.shadowCasterSegments||Oe.shadowCasterSegments.segments[0].primitiveLength===0)continue;se.prepareDrawTile();const Le=Ne.bufferData.programConfigurations.get(de.id),Ye=se.isTileAffectedByFog(Ue),ct=se.getOrCreateProgram("elevatedStructuresDepth",{config:Le,overrideFog:Ye}),rt=we.calculateShadowPassMatrixFromTile(Pe.tileID.toUnwrapped());se.uploadCommonUniforms(se.context,ct,Ue.toUnwrapped());const _t={u_matrix:rt,u_depth_bias:0};ct.draw(se,Me.TRIANGLES,we.getShadowPassDepthMode(),fn.disabled,we.getShadowPassColorMode(),zn.disabled,_t,de.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.shadowCasterSegments,de.paint,se.transform.zoom,Le)}})(K));const ee=p.emissiveMode==="mrt-fallback";if(H!=="offset"){if(jm(K,!1,ee),H==="road"){const le=!Q&&p.renderPass==="translucent";le&&mc(p,s,c,m,"geometry"),jm(K,!0,ee,fn.disabled),le&&(function(se){const{painter:pe,sourceCache:de,layer:be,coords:Me,colorMode:we}=se,Ue=pe.context.gl,Pe=se.painter.shadowRenderer,Ne=!!Pe&&Pe.enabled,Oe=new sn(pe.context.gl.LEQUAL,sn.ReadOnly,pe.depthRangeFor3D);let Le=[0,0,0];if(Ne){const ct=pe.style.directionalLight,rt=pe.style.ambientLight;ct&&rt&&(Le=$a(pe.style,ct,rt))}const Ye=ct=>{for(const rt of Me){const _t=de.getTile(rt),xt=_t.getBucket(be);if(!xt)continue;const St=xt.elevatedStructures;if(!St)continue;let Ft,nt;if(ct?(Ft=St.renderableBridgeSegments,nt=St.bridgeProgramConfigurations.get(be.id)):(Ft=St.renderableTunnelSegments,nt=St.tunnelProgramConfigurations.get(be.id)),!Ft||Ft.segments[0].primitiveLength===0)continue;nt.updatePaintBuffers(),pe.prepareDrawTile();const qe=pe.isTileAffectedByFog(rt),yt=[];Ne&&yt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const pt=pe.getOrCreateProgram("elevatedStructures",{config:nt,overrideFog:qe,defines:yt}),Ut=pe.translatePosMatrix(rt.projMatrix,_t,be.paint.get("fill-translate"),be.paint.get("fill-translate-anchor"));Ne&&Pe.setupShadows(_t.tileID.toUnwrapped(),pt,"vector-tile");const ei=Fc(Ut,Le);pe.uploadCommonUniforms(pe.context,pt,rt.toUnwrapped()),pt.draw(pe,Ue.TRIANGLES,Oe,fn.disabled,we,zn.backCCW,ei,be.id,St.vertexBuffer,St.indexBuffer,Ft,be.paint,pe.transform.zoom,nt,[St.vertexBufferNormal])}};Ye(!0),Ye(!1)})(K)}}else jm(K,!1,ee,p.stencilModeFor3D())},"fill-extrusion":function(p,s,c,m){const b=c.paint.get("fill-extrusion-opacity"),M=p.context,A=M.gl,D=p.terrain,O=D&&D.renderingToTexture;if(b===0)return;const V=p.emissiveMode==="mrt-fallback",H=p.conflationActive&&p.style.isLayerClipped(c,s.getSource()),Q=p.style.order.indexOf(c.fqid);if(H&&(function(K,ee,le,se,pe){for(const de of se){const be=ee.getTile(de).getBucket(le);be&&(be.updateReplacement(de,K.replacementSource,pe),be.uploadCentroid(K.context))}})(p,s,c,m,Q),D||H)for(const K of m){const ee=s.getTile(K).getBucket(c);ee&&a_(p.context,s,K,ee,c,D,H)}if(p.renderPass==="shadow"&&p.shadowRenderer){const K=p.shadowRenderer;if(D&&b<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const ee=K.getShadowPassDepthMode(),le=K.getShadowPassColorMode();Ea(p,s,c,m,ee,fn.disabled,le,H)}else if(p.renderPass==="translucent"){const K=!c.paint.get("fill-extrusion-pattern").constantOr(1),ee=c.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!O&&ee.a!==0){const le=new sn(p.context.gl.LEQUAL,sn.ReadWrite,p.depthRangeFor3D);b===1&&K?Ea(p,s,c,m,le,fn.disabled,$n.unblended,H):(Ea(p,s,c,m,le,fn.disabled,$n.disabled,H),Ea(p,s,c,m,le,p.stencilModeFor3D(),p.colorModeForRenderPass(),H),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&K&&(!D&&p.transform.projection.name!=="globe"||O)){const le=c.paint.get("fill-extrusion-opacity"),se=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),pe=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=c.paint.get("fill-extrusion-flood-light-intensity"),be=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(be?null:c.lut).toArray01().slice(0,3),we=se>0&&pe>0,Ue=de>0,Pe=(Le,Ye,ct)=>(1-ct)*Le+ct*Ye,Ne=new Wp;Ne.translate=c.paint.get("fill-extrusion-translate"),Ne.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Ne.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Ne.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Oe=Le=>{const Ye=p.depthModeForSublayer(1,sn.ReadOnly,A.LEQUAL,!0),ct=c.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),rt=Pe(.1,3,ct),_t=p._showOverdrawInspector;if(!_t){const xt=new fn({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),St=new $n([A.ONE,A.ONE,A.ONE,A.ONE],r.ao.transparent,[!1,!1,!1,!0],A.MIN);Mu(Ne,p,s,c,m,Ye,xt,St,zn.disabled,Le,"sdf",le,se,pe,de,Me,rt,H,!1)}{const xt=_t?fn.disabled:new fn({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),St=_t?p.colorModeForRenderPass():new $n([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],r.ao.transparent,[!0,!0,!0,!0]);Mu(Ne,p,s,c,m,Ye,xt,St,zn.disabled,Le,"color",le,se,pe,de,Me,rt,H,!1)}};if(O){const Le=()=>{const ct=D.drapeBufferSize[0],rt=D.drapeBufferSize[1];let _t=D.framebufferCopyTexture;return _t&&(!_t||_t.size[0]===ct&&_t.size[1]===rt)||(_t&&_t.destroy(),_t=D.framebufferCopyTexture=new r.T(M,new r.q({width:ct,height:rt}),A.RGBA8)),_t.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,ct,rt),_t},Ye=(ct,rt,_t)=>{const xt=p.depthModeForSublayer(1,sn.ReadOnly,A.LEQUAL,!1),St=c.paint.get(ct?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ft=Pe(.1,3,St);{const nt=new $n([A.ONE,A.ONE,A.ONE,A.ONE],r.ao.transparent,[!1,!1,!1,!0]);Mu(Ne,p,s,c,m,xt,fn.disabled,nt,zn.disabled,ct,"clear",le,se,pe,de,Me,Ft,H,rt)}{const nt=new fn({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),qe=new $n([A.ONE,A.ONE,A.ONE,A.ONE],r.ao.transparent,[!1,!1,!1,!0],A.MIN);Mu(Ne,p,s,c,m,xt,nt,qe,zn.disabled,ct,"sdf",le,se,pe,de,Me,Ft,H,rt)}V&&!ct&&(_t=Le());{const nt=ct?A.ZERO:A.ONE_MINUS_DST_ALPHA,qe=new fn({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),yt=new $n([nt,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],r.ao.transparent,[!0,!0,!0,!0]);Mu(Ne,p,s,c,m,xt,qe,yt,zn.disabled,ct,"color",le,se,pe,de,Me,Ft,H,rt)}if(!V||ct){const nt=new $n([A.ONE,A.ONE,A.ONE,ct?A.ZERO:A.ONE],r.ao.transparent,[!1,!1,!1,!0],ct?A.FUNC_ADD:A.MAX);Mu(Ne,p,s,c,m,xt,fn.disabled,nt,zn.disabled,ct,"clear",le,se,pe,de,Me,Ft,H,rt,_t)}else{A.drawBuffers([A.NONE,A.COLOR_ATTACHMENT1]);const nt=new fn({func:A.EQUAL,mask:255},254,255,A.KEEP,A.DECR,A.DECR),qe=new $n([A.ONE,A.ONE,A.ONE,A.ONE],r.ao.transparent,[!0,!1,!1,!1],A.MAX);Mu(Ne,p,s,c,m,xt,nt,qe,zn.disabled,ct,"emissive",le,se,pe,de,Me,Ft,H,rt,_t),A.drawBuffers([A.COLOR_ATTACHMENT0])}};if(we||Ue){let ct;p.prepareDrawTile(),V&&!we||(ct=Le()),we&&Ye(!0,!1,ct),Ue&&Ye(!1,!0,ct)}}else we&&Oe(!0),Ue&&Oe(!1),(we||Ue)&&p.resetStencilClippingMasks()}}},building:function(p,s,c,m){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const b=c.paint.get("building-ambient-occlusion-ground-intensity"),M=c.paint.get("building-ambient-occlusion-ground-radius"),A=c.paint.get("building-ambient-occlusion-ground-attenuation"),D=c.paint.get("building-opacity");if(D<=0)return;let O=b>0&&M>0,V=!0;const H=c.paint.get("building-vertical-scale");if(H<=0)return;p.shadowRenderer||(V=!1);const Q=p.conflationActive&&p.style.isLayerClipped(c,s.getSource()),K=p.style.order.indexOf(c.fqid);if((function(ee,le,se,pe,de,be){for(const Me of be){const we=le.getTile(Me).getBucket(se);we&&(de&&we.updateReplacement(Me,ee.replacementSource,pe),we.uploadUpdatedIndexBuffer(ee.context))}})(p,s,c,K,Q,m),(function(ee,le,se,pe){for(const de of pe){const be=le.getTile(de).getBucket(se);be&&be.needsEvaluation()&&be.uploadUpdatedColorBuffer(ee.context)}})(p,s,c,m),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const ee=p.shadowRenderer,le=[],se=ee.getShadowPassDepthMode();yd({painter:p,source:s,layer:c,coords:m,defines:le,blendMode:ee.getShadowPassColorMode(),depthMode:se,opacity:D,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let ee=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];V&&(ee=ee.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(ee=ee.concat("NORMAL_OFFSET"));const le=c.paint.get("building-facade-emissive-chance"),se=c.paint.get("building-ambient-occlusion-intensity"),pe=c.paint.get("building-flood-light-intensity"),de=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",be=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(de?null:c.lut).toArray01().slice(0,3),Me=c.paint.get("building-flood-light-ground-attenuation"),we=pe>0,Ue=new sn(p.context.gl.LEQUAL,sn.ReadWrite,p.depthRangeFor3D);D<1&&yd({painter:p,source:s,layer:c,coords:m,defines:ee,blendMode:$n.disabled,depthMode:Ue,opacity:D,verticalScale:H,facadeEmissiveChance:le,facadeAOIntensity:se,floodLightIntensity:pe,floodLightColor:be,depthOnly:!0});const Pe=p.colorModeForRenderPass();yd({painter:p,source:s,layer:c,coords:m,defines:ee,blendMode:Pe,depthMode:Ue,opacity:D,verticalScale:H,facadeEmissiveChance:le,facadeAOIntensity:se,floodLightIntensity:pe,floodLightColor:be}),O&&No(p,s,c,m,!0,D,b,M,pe,be,A,Q),we&&No(p,s,c,m,!1,D,b,M,pe,be,Me,Q)}else if(p.renderPass==="light-beam"){const ee=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new sn(p.context.gl.LEQUAL,sn.ReadOnly,p.depthRangeFor3D);yd({painter:p,source:s,layer:c,coords:m,defines:ee,blendMode:$n.alphaBlended,depthMode:le,opacity:D,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,s,c,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const b=p.context,M=p.terrain&&p.terrain.renderingToTexture,[A,D]=p.renderPass!=="translucent"||M?[{},m]:p.stencilConfigForOverlap(m);for(const O of D){const V=s.getTile(O);if(V.needsHillshadePrepare&&p.renderPass==="offscreen")Xl(p,V,c);else if(p.renderPass==="translucent"){const H=p.depthModeForSublayer(0,sn.ReadOnly),Q=c.paint.get("hillshade-emissive-strength"),K=p.colorModeForDrapableLayerRenderPass(Q),ee=M&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):A[O.overscaledZ];Yd(p,O,V,c,H,ee,K)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,c,m,b,M){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const A=p.transform.projection.name==="globe",D=c.paint.get("raster-elevation")!==0,O=D&&A;if(p.renderElevatedRasterBackface&&!O)return;const V=p.context,H=V.gl,Q=s.getSource(),K=(function(Pe,Ne,Oe,Le,Ye){const ct=Ne.paint.get("raster-color"),rt=Pe.type==="raster-array",_t=[],xt=Ne.paint.get("raster-resampling"),St=Ne.paint.get("raster-color-mix");let Ft=Ne.paint.get("raster-color-range");const nt=[St[0],St[1],St[2],0],qe=St[3];let yt=xt==="nearest"?Le.NEAREST:Le.LINEAR;if(rt&&(_t.push("RASTER_ARRAY"),ct||_t.push("RASTER_COLOR"),xt==="linear"&&_t.push("RASTER_ARRAY_LINEAR"),yt=Le.NEAREST,!Ft&&Pe.rasterLayers)){const pt=Pe.rasterLayers.find((({id:Ut})=>Ut===Ne.sourceLayer));pt&&pt.fields&&pt.fields.range&&(Ft=pt.fields.range)}if(Ft=Ft||[0,1],ct){_t.push("RASTER_COLOR"),Oe.activeTexture.set(Le.TEXTURE2),Ne.updateColorRamp(Ft);let pt=Ne.colorRampTexture;pt||(pt=Ne.colorRampTexture=new r.T(Oe,Ne.colorRamp,Le.RGBA8)),pt.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}return Ye&&_t.push("USE_MRT1"),{mix:nt,range:Ft,offset:qe,defines:_t,resampling:yt}})(Q,c,V,H,p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback");if(Q instanceof r.aU&&!m.length&&!A)return;const ee=c.paint.get("raster-emissive-strength"),le=p.colorModeForDrapableLayerRenderPass(ee),se=p.terrain&&p.terrain.renderingToTexture,pe=!p.options.moving,de=c.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;if(Q instanceof r.aU&&!m.length&&(Q.onNorthPole||Q.onSouthPole)){const Pe=D?p.stencilModeFor3D():fn.disabled;return void zh(!!Q.onNorthPole,null,p,s,c,ee,K,zn.disabled,Pe)}if(!m.length)return;const[be,Me]=Q instanceof r.aU||se?[{},m]:p.stencilConfigForOverlap(m),we=Me[Me.length-1].overscaledZ;O&&K.defines.push("PROJECTION_GLOBE_VIEW"),D&&K.defines.push("RENDER_CUTOFF");const Ue=(Pe,Ne,Oe)=>{for(const Le of Pe){const Ye=Le.toUnwrapped(),ct=s.getTile(Le);if(se&&(!ct||!ct.hasData()))continue;V.activeTexture.set(H.TEXTURE0);const rt=Vc(ct,Q,c,K);if(!rt||!rt.texture)continue;const{texture:_t,mix:xt,offset:St,tileSize:Ft,buffer:nt}=rt;let qe,yt;se?(qe=sn.disabled,yt=Le.projMatrix):D?(qe=new sn(H.LEQUAL,sn.ReadWrite,p.depthRangeFor3D),yt=A?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Ye,pe)):(qe=p.depthModeForSublayer(Le.overscaledZ-we,c.paint.get("raster-opacity")===1?sn.ReadWrite:sn.ReadOnly,H.LESS),yt=p.transform.calculateProjMatrix(Ye,pe));const pt=p.terrain&&se?p.terrain.stencilModeForRTTOverlap(Le):be[Le.overscaledZ],Ut=M?0:c.paint.get("raster-fade-duration");ct.registerFadeDuration(Ut);const ei=s.findLoadedParent(Le,0),vi=dd(ct,ei,s,p.transform,Ut);let ni,ti;!vi.isFading&&ct.refreshedUponExpiration&&(ct.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),V.activeTexture.set(H.TEXTURE0),_t.bind(de,H.CLAMP_TO_EDGE),V.activeTexture.set(H.TEXTURE1),ei?(ei.texture&&ei.texture.bind(de,H.CLAMP_TO_EDGE),ni=Math.pow(2,ei.tileID.overscaledZ-ct.tileID.overscaledZ),ti=[ct.tileID.canonical.x*ni%1,ct.tileID.canonical.y*ni%1]):_t.bind(de,H.CLAMP_TO_EDGE),"useMipmap"in _t&&V.extTextureFilterAnisotropic&&p.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const Zi=p.transform;let Si;const Ai=D?up(Zi):[0,0,0,0];let Oi,an,Mn,lr,Lr,Yi=0;if(O&&Q instanceof r.aU&&Q.coordinates.length>3)Oi=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0)))),an=Float32Array.from(Zi.globeMatrix),Mn=Float32Array.from(r.dF(Zi)),lr=[r.aF(Zi.center.lng),r.aJ(Zi.center.lat)],Si=Q.elevatedGlobePerspectiveTransform,Lr=Q.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Pr=r.dG(Le.canonical);Yi=r.dH(Pr.getCenter().lat),Oi=Float32Array.from(r.bk(r.dJ(Le.canonical))),an=Float32Array.from(Zi.globeMatrix),Mn=Float32Array.from(r.dF(Zi)),lr=[r.aF(Zi.center.lng),r.aJ(Zi.center.lat)],Si=[0,0],Lr=Float32Array.from(r.dI(Le.canonical,Pr,Yi,Zi.worldSize/Zi._pixelsPerMercatorPixel))}else Si=Q instanceof r.aU?Q.perspectiveTransform:[0,0],Oi=new Float32Array(16),an=new Float32Array(9),Mn=new Float32Array(16),lr=[0,0],Lr=new Float32Array(9);const Ir=Hm(yt,Oi,an,Mn,Lr,ti||[0,0],r.aj(p.transform.zoom),lr,Ai,ni||1,vi,c,Si,D?c.paint.get("raster-elevation"):0,2,xt,St,K.range,Ft,nt,ee),Dn=p.isTileAffectedByFog(Le),er=p.getOrCreateProgram("raster",{defines:K.defines,overrideFog:Dn});if(p.uploadCommonUniforms(V,er,Ye),Q instanceof r.aU){const Pr=Q.elevatedGlobeVertexBuffer,Sr=Q.elevatedGlobeIndexBuffer;if(se||!A)Q.boundsBuffer&&Q.boundsSegments&&er.draw(p,H.TRIANGLES,qe,fn.disabled,le,zn.disabled,Ir,c.id,Q.boundsBuffer,p.quadTriangleIndexBuffer,Q.boundsSegments);else if(Pr&&Sr){const pr=Zi.zoom<=r.c_?Q.elevatedGlobeSegments:Q.getSegmentsForLongitude(Zi.center.lng);pr&&er.draw(p,H.TRIANGLES,qe,fn.disabled,le,Ne,Ir,c.id,Pr,Sr,pr)}}else if(O){qe=new sn(H.LEQUAL,sn.ReadOnly,p.depthRangeFor3D);const Pr=p.globeSharedBuffers;if(Pr){const[Sr,pr,qn]=Pr.getGridBuffers(Yi,!1);er.draw(p,H.TRIANGLES,qe,Oe||pt,p.colorModeForRenderPass(),Ne,Ir,c.id,Sr,pr,qn)}}else{const{tileBoundsBuffer:Pr,tileBoundsIndexBuffer:Sr,tileBoundsSegments:pr}=p.getTileBoundsBuffers(ct);er.draw(p,H.TRIANGLES,qe,pt,le,zn.disabled,Ir,c.id,Pr,Sr,pr)}}if(!(Q instanceof r.aU)&&O)for(const Le of Pe){const Ye=Le.canonical.y===(1<<Le.canonical.z)-1;Le.canonical.y===0&&zh(!0,Le,p,s,c,ee,K,Ne,Oe||fn.disabled),Ye&&zh(!1,Le,p,s,c,ee,K,Ne===zn.frontCW?zn.backCW:zn.frontCW,Oe||fn.disabled)}};O?Ue(Me,p.renderElevatedRasterBackface?zn.backCW:zn.frontCW,p.stencilModeFor3D()):Ue(Me,zn.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,c,m,b,M){p.renderPass==="offscreen"&&(function(A,D,O,V){if(!V.length)return;const H=A.context,Q=H.gl,K=D.getSource();if(!(K instanceof as))return;const ee=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let le=O.particlePositionRGBAImage;if(!le||le.width!==ee){const Me=(function(we){const Ue=we*we,Pe=new Uint8Array(4*Ue),Ne=function(Le){return Le|=0,Le=Math.imul(2747636419^Le,2654435769),Le=Math.imul(Le^Le>>>16,2654435769),((Le=Math.imul(Le^Le>>>16,2654435769))>>>0)/4294967296},Oe=1/1.1;for(let Le=0;Le<Ue;Le++){const Ye=Oe*(Ne(2*Le+0)+ll),ct=Oe*(Ne(2*Le+1)+ll),rt=255*Ye%1,_t=255*ct%1,xt=rt,St=ct-_t/255,Ft=_t;Pe[4*Le+0]=255*(Ye-rt/255),Pe[4*Le+1]=255*xt,Pe[4*Le+2]=255*St,Pe[4*Le+3]=255*Ft}return Pe})(ee);le=O.particlePositionRGBAImage=new r.q({width:ee,height:ee},Me)}let se=O.particleFramebuffer;se?se.width!==ee&&(se.destroy(),se=O.particleFramebuffer=H.createFramebuffer(ee,ee,1,null)):se=O.particleFramebuffer=H.createFramebuffer(ee,ee,1,null);const pe=[];for(const Me of V){const we=D.getTile(Me);if(!(we instanceof Qf))continue;const Ue=hp(we,K,O);if(!Ue)continue;const Pe=[we.tileSize,we.tileSize];let Ne=O.tileFramebuffer;Ne||(Ne=O.tileFramebuffer=H.createFramebuffer(Pe[0],Pe[1],1,null));let Oe=we.rasterParticleState;Oe||(Oe=we.rasterParticleState=new Gc(H,Me,Pe,le));const Le=Oe.update(O.lastInvalidatedAt);Oe.particleTextureDimension!==ee&&Oe.updateParticleTexture(Me,le);const Ye=Oe.targetColorTexture;Oe.targetColorTexture=Oe.backgroundColorTexture,Oe.backgroundColorTexture=Ye;const ct=Oe.particleTexture0;Oe.particleTexture0=Oe.particleTexture1,Oe.particleTexture1=ct,pe.push([Me,Ue,Oe,Le])}if(pe.length===0)return;const de=r.o.now(),be=O.previousDrawTimestamp?.001*(de-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=de,O.hasColorMap()){H.activeTexture.set(Q.TEXTURE0+2);let Me=O.colorRampTexture;Me||(Me=O.colorRampTexture=new r.T(H,O.colorRamp,Q.RGBA8)),Me.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}H.bindFramebuffer.set(O.tileFramebuffer.framebuffer),(function(Me,we,Ue){const Pe=Me.context,Ne=Pe.gl,Oe=we.tileFramebuffer;Pe.activeTexture.set(Ne.TEXTURE0);const Le={u_texture:0,u_opacity:1.05*(ct=we.paint.get("raster-particle-fade-opacity-factor"))/(ct+.05)},Ye=Me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ct;for(const rt of Ue){const[,,_t,xt]=rt;Oe.colorAttachment0.set(_t.targetColorTexture.texture),Pe.viewport.set([0,0,Oe.width,Oe.height]),Pe.clear({color:r.ao.transparent}),xt&&(_t.backgroundColorTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE),Ye.draw(Me,Ne.TRIANGLES,sn.disabled,fn.disabled,$n.alphaBlended,zn.disabled,Le,we.id,Me.viewportBuffer,Me.quadTriangleIndexBuffer,Me.viewportSegments))}})(A,O,pe),(function(Me,we,Ue,Pe){const Ne=Me.context,Oe=Ne.gl,Le=Ue.tileFramebuffer,Ye=Me.transform.projection.name==="globe",ct=Ue.paint.get("raster-particle-max-speed");for(const rt of Pe){const[_t,xt,St]=rt;Ne.activeTexture.set(Oe.TEXTURE0+0),xt.texture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),Le.colorAttachment0.set(St.targetColorTexture.texture);const Ft=Me.getOrCreateProgram("rasterParticleDraw",{defines:xt.defines,overrideFog:!1});Ne.activeTexture.set(Oe.TEXTURE0+1);const nt=xt.scalarData?[]:[0,1,2,3].map((pt=>r.e9[pt](_t)));nt.push(_t);const qe=_t.canonical.x,yt=_t.canonical.y;for(const pt of nt){const Ut=we.getTile(Ye?pt.wrapped():pt);if(!Ut)continue;const ei=Ut.rasterParticleState;if(!ei)continue;const vi=pt.canonical.x+(1<<pt.canonical.z)*(pt.wrap-_t.wrap),ni=pt.canonical.y;ei.particleTexture0.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);const ti=Yo(1,ei.particleTexture0.size[0],[vi-qe,ni-yt],0,xt.texture.size,2,ct,xt.textureOffset,xt.scale,xt.offset);Ft.draw(Me,Oe.POINTS,sn.disabled,fn.disabled,$n.alphaBlended,zn.disabled,ti,Ue.id,ei.particleIndexBuffer,void 0,ei.particleSegment)}}})(A,D,O,pe),H.bindFramebuffer.set(O.particleFramebuffer.framebuffer),(function(Me,we,Ue,Pe){const Ne=Me.context,Oe=Ne.gl,Le=we.paint.get("raster-particle-max-speed"),Ye=Pe*we.paint.get("raster-particle-speed-factor")*.15,ct=(function(_t){return Math.pow(_t,6)})(.01+1*we.paint.get("raster-particle-reset-rate-factor")),rt=we.particleFramebuffer;Ne.viewport.set([0,0,rt.width,rt.height]);for(const _t of Ue){const[,xt,St]=_t;Ne.activeTexture.set(Oe.TEXTURE0+0),xt.texture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),Ne.activeTexture.set(Oe.TEXTURE0+1);const Ft=St.particleTexture0;Ft.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);const nt=Yl(1,Ft.size[0],0,xt.texture.size,Le,Ye,ct,xt.textureOffset,xt.scale,xt.offset);rt.colorAttachment0.set(St.particleTexture1.texture),Ne.clear({color:r.ao.transparent}),Me.getOrCreateProgram("rasterParticleUpdate",{defines:xt.defines}).draw(Me,Oe.TRIANGLES,sn.disabled,fn.disabled,$n.unblended,zn.disabled,nt,we.id,Me.viewportBuffer,Me.quadTriangleIndexBuffer,Me.viewportSegments)}})(A,O,pe,be)})(p,s,c,m),p.renderPass==="translucent"&&((function(A,D,O,V,H){const Q=A.context,K=Q.gl,ee=D.getSource().tileSize,le=5*(1-r.ah(r.cL,r.cL+1,A.transform.zoom))*ee+O.paint.get("raster-particle-elevation"),se=!A.options.moving,pe=A.transform.projection.name==="globe";if(!V.length)return;const[de,be]=A.stencilConfigForOverlap(V),Me=[];pe&&Me.push("PROJECTION_GLOBE_VIEW");const we=A.stencilModeFor3D();for(const Ue of be){const Pe=Ue.toUnwrapped(),Ne=D.getTile(Ue);if(!Ne.rasterParticleState)continue;const Oe=Ne.rasterParticleState,Le=100;Ne.registerFadeDuration(Le);const Ye=D.findLoadedParent(Ue,0),ct=dd(Ne,Ye,D,A.transform,Le);let rt,_t;A.terrain&&A.terrain.prepareDrawTile(),Q.activeTexture.set(K.TEXTURE0),Oe.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Q.activeTexture.set(K.TEXTURE1),Ye&&Ye.rasterParticleState?(Ye.rasterParticleState.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),rt=Math.pow(2,Ye.tileID.overscaledZ-Ne.tileID.overscaledZ),_t=[Ne.tileID.canonical.x*rt%1,Ne.tileID.canonical.y*rt%1]):Oe.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xt=pe?Float32Array.from(A.transform.expandedFarZProjMatrix):A.transform.calculateProjMatrix(Pe,se),St=A.transform,Ft=qm(St),nt=r.dG(Ue.canonical),qe=r.dH(nt.getCenter().lat);let yt,pt,Ut,ei,vi;pe?(yt=Float32Array.from(r.bk(r.dJ(Ue.canonical))),pt=Float32Array.from(St.globeMatrix),Ut=Float32Array.from(r.dF(St)),ei=[r.aF(St.center.lng),r.aJ(St.center.lat)],vi=Float32Array.from(r.dI(Ue.canonical,nt,qe,St.worldSize/St._pixelsPerMercatorPixel))):(yt=new Float32Array(16),pt=new Float32Array(9),Ut=new Float32Array(16),ei=[0,0],vi=new Float32Array(9));const ni=sh(xt,yt,pt,Ut,vi,_t||[0,0],r.aj(A.transform.zoom),ei,Ft,rt||1,ct,le),ti=A.isTileAffectedByFog(Ue),Zi=A.getOrCreateProgram("rasterParticle",{defines:Me,overrideFog:ti});if(A.uploadCommonUniforms(Q,Zi,Pe),pe){const Si=new sn(K.LEQUAL,sn.ReadOnly,A.depthRangeFor3D),Ai=0,Oi=A.globeSharedBuffers;if(Oi){const[an,Mn,lr]=Oi.getGridBuffers(qe,Ai!==0);Zi.draw(A,K.TRIANGLES,Si,we,$n.alphaBlended,A.renderElevatedRasterBackface?zn.frontCCW:zn.backCCW,ni,O.id,an,Mn,lr)}}else{const Si=A.depthModeForSublayer(0,sn.ReadOnly),Ai=de[Ue.overscaledZ],{tileBoundsBuffer:Oi,tileBoundsIndexBuffer:an,tileBoundsSegments:Mn}=A.getTileBoundsBuffers(Ne);Zi.draw(A,K.TRIANGLES,Si,Ai,$n.alphaBlended,zn.disabled,ni,O.id,Oi,an,Mn)}}A.resetStencilClippingMasks()})(p,s,c,m),p.style.map.triggerRepaint())},background:function(p,s,c,m){const b=c.paint.get("background-color"),M=c.paint.get("background-color-use-theme").constantOr("default")==="none",A=c.paint.get("background-opacity"),D=c.paint.get("background-emissive-strength"),O=c.paint.get("background-pitch-alignment")==="viewport";if(A===0)return;const V=p.context,H=V.gl,Q=p.transform,K=Q.tileSize,ee=c.paint.get("background-pattern");let le;if(ee!==void 0&&(ee===null||(le=p.imageManager.getPattern(r.I.from(ee.toString()),c.scope,p.style.getLut(c.scope)),!le)))return;const se=!ee&&b.a===1&&A===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==se)return;const pe=fn.disabled,de=p.depthModeForSublayer(0,se==="opaque"?sn.ReadWrite:sn.ReadOnly),be=p.colorModeForDrapableLayerRenderPass(D),Me=ee?"backgroundPattern":"background";let we,Ue=m;Ue||(we=p.getBackgroundTiles(),Ue=Object.values(we).map((Ne=>Ne.tileID))),ee&&(V.activeTexture.set(H.TEXTURE0),p.imageManager.bind(p.context,c.scope));const Pe=[];if(p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&Pe.push("USE_MRT1"),O){const Ne=p.getOrCreateProgram(Me,{overrideFog:!1,overrideRtt:!0,defines:Pe}),Oe=new Float32Array(r.bA([])),Le=new r.aQ(0,0,0,0,0),Ye=ee?ka(Oe,D,A,p,0,c.scope,le,O,{tileID:Le,tileSize:K}):_d(Oe,D,A,b.toPremultipliedRenderColor(M?null:c.lut));Ne.draw(p,H.TRIANGLES,de,pe,be,zn.disabled,Ye,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const Ne of Ue){const Oe=p.isTileAffectedByFog(Ne),Le=p.getOrCreateProgram(Me,{overrideFog:Oe,defines:Pe}),Ye=Ne.toUnwrapped(),ct=m?Ne.projMatrix:p.transform.calculateProjMatrix(Ye);p.prepareDrawTile();const rt=s?s.getTile(Ne):we?we[Ne.key]:new wh(Ne,K,Q.zoom,p),_t=ee?ka(ct,D,A,p,0,c.scope,le,O,{tileID:Ne,tileSize:K}):_d(ct,D,A,b.toPremultipliedRenderColor(M?null:c.lut));p.uploadCommonUniforms(V,Le,Ye);const{tileBoundsBuffer:xt,tileBoundsIndexBuffer:St,tileBoundsSegments:Ft}=p.getTileBoundsBuffers(rt);Le.draw(p,H.TRIANGLES,de,pe,be,zn.disabled,_t,c.id,xt,St,Ft)}},sky:function(p,s,c){const m=p._atmosphere?r.aj(p.transform.zoom):1,b=c.paint.get("sky-opacity")*m;if(b===0)return;const M=p.context,A=c.paint.get("sky-type"),D=new sn(M.gl.LEQUAL,sn.ReadOnly,[0,1]),O=p.frameCounter/1e3%1;A==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&((function(V,H,Q,K){const ee=V.context,le=ee.gl;let se=H.skyboxFbo;if(!se){se=H.skyboxFbo=ee.createFramebuffer(32,32,1,null),H.skyboxGeometry=new xd(ee),H.skyboxTexture=ee.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,H.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Me=0;Me<6;++Me)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(se.framebuffer),ee.viewport.set([0,0,32,32]);const pe=H.getCenter(V,!0),de=V.getOrCreateProgram("skyboxCapture"),be=new Float64Array(16);r.bA(be),r.en(be,be,.5*-Math.PI),bf(V,H,de,be,pe,0),r.bA(be),r.en(be,be,.5*Math.PI),bf(V,H,de,be,pe,1),r.bA(be),r.cU(be,be,.5*-Math.PI),bf(V,H,de,be,pe,2),r.bA(be),r.cU(be,be,.5*Math.PI),bf(V,H,de,be,pe,3),r.bA(be),bf(V,H,de,be,pe,4),r.bA(be),r.en(be,be,Math.PI),bf(V,H,de,be,pe,5),ee.viewport.set([0,0,V.width,V.height])})(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&(function(V,H,Q,K,ee){const le=V.context,se=le.gl,pe=V.transform,de=V.getOrCreateProgram("skybox");le.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,H.skyboxTexture);const be=((Me,we,Ue,Pe,Ne)=>({u_matrix:Me,u_sun_direction:we,u_cubemap:0,u_opacity:Pe,u_temporal_offset:Ne}))(pe.skyboxMatrix,H.getCenter(V,!1),0,K,ee);V.uploadCommonUniforms(le,de),de.draw(V,se.TRIANGLES,Q,fn.disabled,V.colorModeForRenderPass(),zn.backCW,be,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)})(p,c,D,b,O):A==="gradient"&&p.renderPass==="sky"&&(function(V,H,Q,K,ee){const le=V.context,se=le.gl,pe=V.transform,de=V.getOrCreateProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new xd(le)),le.activeTexture.set(se.TEXTURE0);let be=H.colorRampTexture;be||(be=H.colorRampTexture=new r.T(le,H.colorRamp,se.RGBA8)),be.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Me=((we,Ue,Pe,Ne,Oe)=>({u_matrix:we,u_color_ramp:0,u_center_direction:Ue,u_radius:r.an(Pe),u_opacity:Ne,u_temporal_offset:Oe}))(pe.skyboxMatrix,H.getCenter(V,!1),H.paint.get("sky-gradient-radius"),K,ee);V.uploadCommonUniforms(le,de),de.draw(V,se.TRIANGLES,Q,fn.disabled,V.colorModeForRenderPass(),zn.backCW,Me,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)})(p,c,D,b,O)},custom:function(p,s,c,m){const b=p.context,M=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(s)){if(p.renderPass==="offscreen"){const A=M.prerender;if(A){if(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const D=p.transform.pointMerc;A.call(M,b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.aj(p.transform.zoom),[D.x,D.y],p.transform.pixelsPerMeterRatio)}else A.call(M,b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const D=M.renderToTile;if(D){const O=m[0].canonical,V={x:O.x+m[0].wrap*(M.wrapTileId?0:1<<O.z),y:O.y,z:O.z};b.setDepthMode(sn.disabled),b.setStencilMode(fn.disabled),b.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),D.call(M,b.gl,V),b.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(fn.disabled);const A=M.renderingMode==="3d"?new sn(p.context.gl.LEQUAL,sn.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,sn.ReadOnly);if(b.setDepthMode(A),p.transform.projection.name==="globe"){const D=p.transform.pointMerc;M.render(b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.aj(p.transform.zoom),[D.x,D.y],p.transform.pixelsPerMeterRatio)}else M.render(b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,c,m){if(p.renderPass==="opaque")return;const b=c.paint.get("model-opacity").constantOr(1),M=c.paint.get("model-elevation-reference"),A=M==="ground",D=M==="ground";if(b===0)return;const O=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!O||p.terrain&&b<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const V=p.shadowRenderer,H=c.paint.get("model-receive-shadows");V&&(V.useNormalOffset=!0,H||(V.enabled=!1));const Q=()=>{V&&(V.useNormalOffset=!0,H||(V.enabled=!0))},K=s.getSource();if(p.renderPass==="light-beam"&&K.type!=="batched-model")return;if(K.type==="vector"||K.type==="geojson")return(function(we,Ue,Pe,Ne,Oe){const Le=we.transform,Ye=Le.projection.name==="globe",ct=Le.getFreeCameraOptions().position;if(!we.modelManager)return;const rt=we.modelManager;Pe.modelManager=rt;const _t=we.shadowRenderer;if(!Pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const xt=Pe._unevaluatedLayout._values["model-id"],St=Object.assign({},Pe.layout.get("model-id").parameters),Ft=we.style.order.indexOf(Pe.fqid),nt=Pe.paint.get("model-opacity").constantOr(1);for(const qe of Ne){const yt=Ue.getTile(qe).getBucket(Pe);if(!yt||yt.projection.name!==Le.projection.name)continue;const pt=yt.getModelUris();if(pt&&!yt.modelsRequested&&(rt.addModelsFromBucket(pt,Oe),yt.modelsRequested=!0),Ye)St.zoom=qe.overscaledZ;else{const Ai=wo(qe,Le);St.zoom=Ai}const Ut=xt.possiblyEvaluate(St);if($l(we,yt,qe),jc.shadowUniformsInitialized=!1,jc.useSingleShadowCascade=!!_t&&_t.getMaxCascadeForTile(qe.toUnwrapped())===0,we.renderPass==="shadow"&&_t){if(we.currentShadowCascade===1&&yt.isInsideFirstShadowMapFrustum)continue;const Ai=Le.calculatePosMatrix(qe.toUnwrapped(),Le.worldSize);if(jc.tileMatrix.set(Ai),jc.shadowTileMatrix=Float32Array.from(_t.calculateShadowPassMatrixFromMatrix(Ai)),jc.aabb.min=[0,0,0],jc.aabb.max[0]=jc.aabb.max[1]=r.al,jc.aabb.max[2]=0,Cg(yt,jc,we,Pe.scope))continue}const ei=1<<qe.canonical.z,vi=[((ct.x-qe.wrap)*ei-qe.canonical.x)*r.al,(ct.y*ei-qe.canonical.y)*r.al,ct.z*ei*r.al];we.conflationActive&&Object.keys(yt.instancesPerModel).length>0&&we.style.isLayerClipped(Pe,Ue.getSource())&&yt.updateReplacement(qe,we.replacementSource,Ft,Pe.scope)&&(yt.uploaded=!1,yt.upload(we.context));let ni=0;const ti=new Array,Zi=new Array,Si=new Array;for(let Ai in yt.instancesPerModel){const Oi=yt.instancesPerModel[Ai];Oi.features.length>0&&!Ye&&(Ai=Ut.evaluate(Oi.features[0].feature,{}));const an=rt.getModel(Ai,Oe);if(an||rt.hasURLBeenRequested(Ai)||yt.modelUris.includes(Ai)||(yt.modelUris.push(Ai),yt.modelsRequested=!1),an&&an.uploaded)if(Ye){const Mn=r.c5([],[ct.x,ct.y,ct.z],we.transform.worldSize);r.ew(Mn,Mn);for(let lr=0;lr<Oi.instancedDataArray.length;++lr){const Lr=[0,0,0],Yi=[1,1,1],Ir=r.ex(),Dn=Oi.tileCoordinatesForInstance(lr),er=Oi.transformForInstance(lr);r.ey(Yi,er),r.ez(Ir,er),r.eA(Lr,Ir);const Pr=Oi.translationForInstance(lr),Sr=new r.aT(0,0);r.eB(yt.canonical,Sr,Dn.x,Dn.y);const pr=r.bC();r.eC(pr,an,we.transform,Sr,Lr,Yi,Pr,!0,!1,!1);const qn=Oi.colorForInstance(lr),zr=r.bA([]),Os=r.ef(Sr.lat,we.transform.zoom),us=r.bq([],[1,1,1/Os]);r.br(zr,zr,Mn),Si.push({zScaleMatrix:us,negCameraPosMatrix:zr});for(const Nr of an.nodes)Sf(we,Nr,pr,we.transform.expandedFarZProjMatrix,ni,ti,Zi,an.materialOverrides,nt,qn);++ni}}else for(const Mn of an.nodes)Jp(we,Pe,Mn,Oi,vi,qe,jc)}if(Ye)if(we.renderPass==="shadow"){for(const Ai of Zi)gc(Ai.mesh,Ai.nodeModelMatrix,we,Pe);for(const Ai of ti)gc(Ai.mesh,Ai.nodeModelMatrix,we,Pe)}else Ag(we,Pe,ti,Zi,Si)}})(p,s,c,m,wf(p,c)),void Q();if(!K.loaded())return;if(K.type==="batched-model")return(function(we,Ue,Pe,Ne){Pe.resetLayerRenderingStats(we);const Oe=we.context,Le=we.transform,Ye=we.style.fog,ct=we.shadowRenderer;if(Le.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Le.projection.name} projection is not yet implemented`);const rt=we.transform.getFreeCameraOptions().position,_t=r.c5([],[rt.x,rt.y,rt.z],we.transform.worldSize),xt=r.ew([],_t),St=r.bA([]),Ft=r.ef(Le.center.lat,Le.zoom),nt=r.bq([],[1,1,1/Ft]);r.br(St,St,xt);const qe=Pe.paint.get("model-opacity").constantOr(1),yt=new sn(Oe.gl.LEQUAL,sn.ReadWrite,we.depthRangeFor3D),pt=new sn(Oe.gl.LEQUAL,sn.ReadOnly,we.depthRangeFor3D),Ut=new r.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ei=we.renderPass==="shadow",vi=ei&&ct?ct.getCurrentCascadeFrustum():Le.getFrustum(Le.scaleZoom(Le.worldSize)),ni=Pe.paint.get("model-front-cutoff"),ti=ni[2]<1,Zi=ou(we,Pe.paint.get("model-cutoff-fade-range")),Si=Pe.getLayerRenderingStats();(function(Ai,Oi,an,Mn){const lr=Ai.terrain?Ai.terrain.exaggeration():0,Lr=Ai.transform.zoom;for(const Yi of Mn){const Ir=Oi.getTile(Yi).getBucket(an);Ir&&(Ir.setFilter(an.filter),Ai.conflationActive&&Ir.updateReplacement(Yi,Ai.replacementSource),Ir.evaluateTransform(Ai,an),Ai.terrain&&lr>0&&Ir.elevationUpdate(Ai.terrain,lr,Yi,an.source),Ir.needsReEvaluation(Ai,Lr,an)&&Ir.evaluate(an))}})(we,Ue,Pe,Ne),(function(){let Ai,Oi,an;ti?(Ai=Ne.length-1,Oi=-1,an=-1):(Ai=0,Oi=Ne.length,an=1);const Mn=new Float64Array(16),lr=r.cA(),Lr=new r.P(0,0);for(let Yi=Ai;Yi!==Oi;Yi+=an){const Ir=Ne[Yi],Dn=Ue.getTile(Ir).getBucket(Pe);if(!Dn||!Dn.uploaded)continue;let er=!1;ct&&(er=ct.getMaxCascadeForTile(Ir.toUnwrapped())===0);const Pr=Le.calculatePosMatrix(Ir.toUnwrapped(),Le.worldSize),Sr=Dn.modelTraits;!ei&&ti&&(r.bl(Mn,Pr),r.af(lr,_t,Mn),Lr.x=lr[0],Lr.y=lr[1]);const pr=[];Dn.setFilter(Pe.filter);for(const qn of Dn.getNodesInfo()){if(qn.hiddenByReplacement||!qn.node.meshes)continue;const zr=qn.node;let Os=0;we.terrain&&zr.elevation&&(Os=zr.elevation*we.terrain.exaggeration());const us=(()=>{const Ht=qn.aabb;return Ut.min=[...Ht.min],Ut.max=[...Ht.max],Ut.min[2]+=Os,Ut.max[2]+=Os,r.af(Ut.min,Ut.min,Pr),r.af(Ut.max,Ut.max,Pr),Ut})(),Nr=qn.evaluatedScale;if(Nr[0]<=1&&Nr[1]<=1&&Nr[2]<=1&&us.intersects(vi)===0)continue;if(!ei&&ti){const Ht=.16666666666666666;qn.cameraCollisionOpacity=_t[0]>us.min[0]&&_t[0]<us.max[0]&&_t[1]>us.min[1]&&_t[1]<us.max[1]&&_t[2]*Ft<us.max[2]&&zr.footprint&&r.c0(Lr,zr.footprint)?Math.max(qn.cameraCollisionOpacity-Ht,0):Math.min(1,qn.cameraCollisionOpacity+Ht)}const rr=[...Pr],w=1/r.d7(Ir.canonical),T=zr.anchor?zr.anchor[0]:0,B=zr.anchor?zr.anchor[1]:0;r.br(rr,rr,[T*(Nr[0]-1)+qn.evaluatedTranslation[0]*w,B*(Nr[1]-1)+qn.evaluatedTranslation[1]*w,Os+qn.evaluatedTranslation[2]]),r.cq(Nr,r.eE)||r.cS(rr,rr,Nr);const q=r.aB([],rr,zr.globalMatrix),te=r.aB([],Le.expandedFarZProjMatrix,q),fe=r.aB([],Le.expandedFarZProjMatrix,rr),We=r.aC([],[T,B,Os,1],te)[2];zr.hidden=!1;let vt=qe;ei||(ti&&(vt*=qn.cameraCollisionOpacity,vt*=vr(rr,Le,qn.aabb,ni)),vt*=Ms(Zi,We)),vt!==0?pr.push({nodeInfo:qn,depth:We,opacity:vt,wvpForNode:te,wvpForTile:fe,nodeModelMatrix:q,tileModelMatrix:rr}):zr.hidden=!0}ei||pr.sort(((qn,zr)=>!ti||qn.opacity===1&&zr.opacity===1?qn.depth<zr.depth?-1:1:qn.opacity===1?-1:zr.opacity===1?1:qn.depth>zr.depth?-1:1));for(const qn of pr){const zr=qn.nodeInfo,Os=zr.node;let us=r.aB([],nt,qn.tileModelMatrix);r.aB(us,St,us);const Nr=r.bl([],us);r.eg(Nr,Nr),r.cS(Nr,Nr,wd),us=r.aB(us,us,Os.globalMatrix);const rr=we.renderPass==="light-beam",w=Pe.paint.get("model-color-use-theme").constantOr("default")==="none",T=Sr&r.eI.HasMapboxMeshFeatures,B=T?0:zr.evaluatedRMEA[0][2];for(let q=0;q<Os.meshes.length;++q){const te=Os.meshes[q],fe=q===Os.lightMeshIndex;let We=qn.wvpForNode;if(fe){if(!rr&&!we.terrain&&we.shadowRenderer){we.currentLayer<we.firstLightBeamLayer&&(we.firstLightBeamLayer=we.currentLayer);continue}We=qn.wvpForTile}else if(rr)continue;const vt={defines:[]},Ht=[];if(!ei&&ct&&(ct.useNormalOffset=!!te.normalBuffer),$p(vt.defines,Ht,te,we,w?null:Pe.lut),T||vt.defines.push("DIFFUSE_SHADED"),er&&vt.defines.push("SHADOWS_SINGLE_CASCADE"),Si&&(ei?Si.numRenderedVerticesInShadowPass+=te.vertexArray.length:Si.numRenderedVerticesInTransparentPass+=te.vertexArray.length),ei){gc(te,qn.nodeModelMatrix,we,Pe);continue}let Ri=null;if(Ye){const $s=Nh(qn.nodeModelMatrix,we.transform);if(Ri=new Float32Array($s),Le.projection.name!=="globe"){const Yr=te.aabb.min,Kt=te.aabb.max,[Pt,$t]=Ye.getOpacityForBounds($s,Yr[0],Yr[1],Kt[0],Kt[1]);vt.overrideFog=Pt>=ye||$t>=ye}}const on=te.material;let En;on.occlusionTexture&&on.occlusionTexture.offsetScale&&(En=on.occlusionTexture.offsetScale,vt.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const On=we.getOrCreateProgram("model",vt);!ei&&ct&&ct.setupShadowsFromMatrix(qn.tileModelMatrix,On,ct.useNormalOffset),we.uploadCommonUniforms(Oe,On,null,Ri);const br=on.pbrMetallicRoughness;br.metallicFactor=.9,br.roughnessFactor=.5;const is=Oo(new Float32Array(We),new Float32Array(us),new Float32Array(Nr),new Float32Array(Os.globalMatrix),we,qn.opacity,br.baseColorFactor,on.emissiveFactor,br.metallicFactor,br.roughnessFactor,on,B,Pe,[0,0,0],En);!fe&&(zr.hasTranslucentParts||qn.opacity<1)&&On.draw(we,Oe.gl.TRIANGLES,yt,fn.disabled,$n.disabled,zn.backCCW,is,Pe.id,te.vertexBuffer,te.indexBuffer,te.segments,Pe.paint,we.transform.zoom,void 0,Ht),On.draw(we,Oe.gl.TRIANGLES,fe?pt:yt,fn.disabled,fe||qn.opacity<1||zr.hasTranslucentParts?$n.alphaBlended:$n.unblended,zn.backCCW,is,Pe.id,te.vertexBuffer,te.indexBuffer,te.segments,Pe.paint,we.transform.zoom,void 0,Ht)}}}})()})(p,s,c,m),void Q();if(K.type!=="model")return;const ee=K.getModels(),le=[],se=p.transform.getFreeCameraOptions().position,pe=r.c5([],[se.x,se.y,se.z],p.transform.worldSize);r.ew(pe,pe);const de=[],be=[];let Me=0;for(const we of ee){const Ue=s.getFeatureState("",we.id),Pe={type:"Unknown",id:we.id,properties:we.featureProperties},Ne=c.paint.get("model-rotation").evaluate(Pe,Ue),Oe=c.paint.get("model-scale").evaluate(Pe,Ue),Le=c.paint.get("model-translation").evaluate(Pe,Ue),Ye=c.paint.get("model-opacity").evaluate(Pe,Ue);Mg(c,we.id,Ue,we.featureProperties,we.nodeOverrideNames,we.nodeOverrides),Eg(c,we.id,Ue,we.featureProperties,we.materialOverrideNames,we.materialOverrides),we.nodeOverrides.size>0&&we.computeBoundsAndApplyParent(),we.computeModelMatrix(p,Ne,Oe,Le,D,A,!1);const ct=r.bA([]),rt=r.ef(we.position.lat,p.transform.zoom),_t=r.bq([],[1,1,1/rt]);r.br(ct,ct,pe),le.push({zScaleMatrix:_t,negCameraPosMatrix:ct});for(const xt of we.nodes)Sf(p,xt,we.matrix,p.transform.expandedFarZProjMatrix,Me,de,be,we.materialOverrides,Ye);Me++}if(de.sort(((we,Ue)=>Ue.depth-we.depth)),p.renderPass!=="shadow")Ag(p,c,de,be,le),Q();else{for(const we of be)gc(we.mesh,we.nodeModelMatrix,p,c);for(const we of de)gc(we.mesh,we.nodeModelMatrix,p,c);Q()}}},Af={line:function(p,s,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const m=s.getVisibleCoordinates();for(const b of m){const M=s.getTile(b).getBucket(p);if(M&&(M.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,s,c){const m=s.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,wf(c,p)));if(m.type==="batched-model"||m.type!=="model")return;const b=m.getModels();for(const M of b)M.upload(c.context)},raster:function(p,s,c){const m=s.getSource();if(!(m instanceof as&&m.loaded()))return;const b=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!b)return;const M=p.paint.get("raster-array-band")||m.getInitialBand(b);if(M==null)return;const A=s.getIds().map((D=>s.getTileByID(D)));for(const D of A)D.updateNeeded(p.id,M)&&m.prepareTile(D,b,p.id,M)},"raster-particle":function(p,s,c){const m=s.getSource();if(!(m instanceof as&&m.loaded()))return;const b=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!b)return;const M=p.paint.get("raster-particle-array-band")||m.getInitialBand(b);if(M==null)return;const A=s.getIds().map((D=>s.getTileByID(D)));for(const D of A)D.updateNeeded(p.id,M)&&m.prepareTile(D,b,p.id,M)}},Jl={fill:mc},Uh={fill:function(p,s,c,m){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const b=p.context.gl,M=new sn(b.LEQUAL,sn.ReadOnly,p.depthRangeFor3D),A=new fn({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),D=p.transform.getFreeCameraOptions().position,O=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const V of m){const H=s.getTile(V),Q=H.getBucket(c);if(!Q)continue;const K=Q.elevatedStructures;if(!K||K.depthSegments.segments[0].primitiveLength===0)continue;const ee=cp(V.toUnwrapped(),D),le=p.translatePosMatrix(V.projMatrix,H,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),se=Uc(le,ee,0,1,0);O.draw(p,b.TRIANGLES,M,A,$n.disabled,zn.disabled,se,c.id,K.vertexBuffer,K.indexBuffer,K.depthSegments,c.paint,p.transform.zoom)}}};class Cf{constructor(s,c,m,b,M){this.context=new Ph(s,c),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of A)this._debugParams.enabledLayers[O]=!0;for(const O of A);this.occlusionParams=new Mf,this.setup(),this.numSublayers=Na.maxUnderzooming+Na.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new lu(this),this._wireframeDebugCache=new Tf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,D,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=b,this.worldview=M,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(s,c){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new yf(this,s));const b=this._terrain;this.transform.elevation=m?b:null,b.update(s,this.transform,c),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,b]=c.getFovAdjustedRange(this.transform._fov);if(m>b)return void(this.transform.fogCullDistSq=null);const M=m+.78*(b-m);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new yf(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*r.o.devicePixelRatio,this.height=c*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const s=this.context,c=new r.bd;c.emplaceBack(0,0),c.emplaceBack(r.al,0),c.emplaceBack(0,r.al),c.emplaceBack(r.al,r.al),this.tileExtentBuffer=s.createVertexBuffer(c,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);const m=new r.bd;m.emplaceBack(0,0),m.emplaceBack(r.al,0),m.emplaceBack(0,r.al),m.emplaceBack(r.al,r.al),this.debugBuffer=s.createVertexBuffer(m,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);const b=new r.bd;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);const M=new r.b1;M.emplaceBack(0,0,0,0),M.emplaceBack(r.al,0,r.al,0),M.emplaceBack(0,r.al,0,r.al),M.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=s.createVertexBuffer(M,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);const A=new r.b0;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A);const D=new r.be;for(const V of[0,1,3,2,0])D.emplaceBack(V);this.debugIndexBuffer=s.createIndexBuffer(D),this.emptyTexture=new r.T(s,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=r.bC();const O=this.context.gl;this.stencilClearMode=new fn({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,sn.disabled,this.stencilClearMode,$n.disabled,zn.disabled,fd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,m){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const O of m)if(this._tileClippingMaskIDs[O.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=c.id;const b=this.context,M=b.gl;this.nextStencilID+m.length>256&&this.clearStencil(),b.setColorMode($n.disabled),b.setDepthMode(sn.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of m){const O=c.getTile(D),V=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=this.getTileBoundsBuffers(O);A.draw(this,M.TRIANGLES,sn.disabled,new fn({func:M.ALWAYS,mask:0},V,255,M.KEEP,M.KEEP,M.REPLACE),$n.disabled,zn.disabled,fd(D.projMatrix),"$clipping",H,Q,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new fn({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new fn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,m=s.sort(((A,D)=>D.overscaledZ-A.overscaledZ)),b=m[m.length-1].overscaledZ,M=m[0].overscaledZ-b+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const A={};for(let D=0;D<M;D++)A[D+b]=new fn({func:c.GEQUAL,mask:255},D+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=M,[A,m]}return[{[b]:fn.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new $n([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$n.unblended:$n.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?s!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new $n([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,s??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new $n([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],r.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(s,c,m,b=!1){if(this.depthOcclusion)return new sn(this.context.gl.GREATER,sn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return sn.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new sn(m||this.context.gl.LEQUAL,c,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),m=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),M=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&m!==0&&(this.depthFBO=new Va(this.context,c,m,0,"texture"),this.depthTexture=new r.T(this.context,{width:c,height:m,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),s.bindTexture(s.TEXTURE_2D,M),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,m,0,0,c,m,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((s,c)=>s+c/this._fpsHistory.length),0))}render(s,c){const m=r.o.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const b=this.style._mergedLayers,M=!(!this.terrain||!this.terrain.enabled),A=()=>this.style._getOrder(M).filter((nt=>{const qe=b[nt];return!(qe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[qe.type]}));let D=A(),O=!1,V=!1,H=null,Q=0,K=!1;for(const nt of D){const qe=b[nt];qe.visibility!=="none"&&(qe.type==="circle"?O=!0:qe.type==="building"?(H=qe,++Q):qe.type==="symbol"&&(qe.hasOcclusionOpacityProperties?V=!0:O=!0))}this.updateEmissiveMode();let ee=D.map((nt=>b[nt]));const le=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();for(const nt in le){const qe=le[nt];qe.used&&(qe.prepare(this.context),qe.getSource().usedInConflation&&++Q)}let se=!1;for(const nt of ee)nt.isHidden(this.transform.zoom)||(nt.type==="clip"&&(se=!0),this.prepareLayer(nt));const pe={},de={},be={},Me={},we={};for(const nt in le){const qe=le[nt];pe[nt]=qe.getVisibleCoordinates(),de[nt]=pe[nt].slice().reverse(),be[nt]=qe.getVisibleCoordinates(!0).reverse(),Me[nt]=qe.getShadowCasterCoordinates(),we[nt]=qe.sortCoordinatesByDistance(pe[nt])}const Ue=nt=>{const qe=this.style.getLayerSourceCache(nt);return qe&&qe.used?qe.getSource():null};if(Q||se||this._clippingActiveLastFrame){const nt=[],qe=[];let yt=0;for(const pt of ee)this.isSourceForClippingOrConflation(pt,Ue(pt))&&(nt.push(pt),qe.push(yt)),yt++;if(nt&&(se||nt.length>1)||this._clippingActiveLastFrame){se=!1;const pt=[];for(let Ut=0;Ut<nt.length;Ut++){const ei=nt[Ut],vi=qe[Ut],ni=this.style.getLayerSourceCache(ei);if(!ni||!ni.used||!ni.getSource().usedInConflation&&ei.type!=="clip"&&ei.type!=="building")continue;let ti=r.eQ,Zi=r.b_.None;const Si=[];let Ai=!0;if(ei.type==="building")ti=r.eS;else if(ei.type==="clip"){ti=vi;for(const Oi of ei.layout.get("clip-layer-types"))Zi|=Oi==="model"?r.b_.Model:Oi==="symbol"?r.b_.Symbol:r.b_.FillExtrusion;for(const Oi of ei.layout.get("clip-layer-scope"))Si.push(Oi);ei.isHidden(this.transform.zoom)?Ai=!1:se=!0}Ai&&pt.push({layer:ei.fqid,cache:ni,order:ti,clipMask:Zi,clipScope:Si})}this.replacementSource.setSources(pt),K=!0}}this._clippingActiveLastFrame=se,K||this.replacementSource.clear(),this.conflationActive=K,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let nt=0;nt<ee.length;nt++){const qe=ee[nt];if(qe.visibility==="none")continue;const yt=qe.cutoffRange();if(this.longestCutoffRange=Math.max(yt,this.longestCutoffRange),yt>0){const pt=Ue(qe);pt&&(this.minCutoffZoom=Math.max(pt.minzoom,this.minCutoffZoom)),qe.minzoom&&(this.minCutoffZoom=Math.max(qe.minzoom,this.minCutoffZoom))}qe.is3D(M)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=nt),this._lastOcclusionLayer=nt)}const Pe=this.style&&this.style.fog;Pe?(this._fogVisible=Pe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Pe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(be),this.opaquePassCutoff=0,D=A(),ee=D.map((nt=>b[nt])));const Ne=this._shadowRenderer;if(Ne){Ne.updateShadowParameters(this.transform,this.style.directionalLight);for(const nt in le)for(const qe of pe[nt]){let yt={min:0,max:0};this.terrain&&(yt=this.terrain.getMinMaxForTile(qe)||yt),Ne.addShadowReceiver(qe.toUnwrapped(),yt.min,yt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new c_(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Oe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Oe&&!this._snow&&(this._snow=new Fh(this)),!Oe&&this._snow&&(this._snow.destroy(),delete this._snow),Le&&!this._rain&&(this._rain=new Ef(this)),!Le&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),H){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Kp);const nt=this.style.getLayerSourceCache(H);this.buildingTileBorderManager.updateBorders(nt,H)}if(!Xi.has(this.context.gl))return;this.renderPass="offscreen";for(const nt of ee){const qe=s.getLayerSourceCache(nt);if(!nt.hasOffscreenPass()||nt.isHidden(this.transform.zoom))continue;const yt=qe?de[qe.id]:void 0;(nt.type==="custom"||nt.type==="raster"||nt.type==="raster-particle"||nt.isSky()||yt&&yt.length)&&this.renderLayer(this,qe,nt,yt)}this.depthRangeFor3D=[0,1-(ee.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ye=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ct=(()=>{if(c.showOverdrawInspector)return r.ao.black;const nt=this.style.fog;if(nt&&this.transform.projection.supportsFog){const qe=this.style.getLut(nt.scope);if(!Ye){const yt=nt.properties.get("color-use-theme")==="none",pt=nt.properties.get("color").toNonPremultipliedRenderColor(yt?null:qe).toArray01();return new r.ao(...pt)}if(Ye){const yt=nt.properties.get("space-color-use-theme")==="none",pt=nt.properties.get("space-color").toNonPremultipliedRenderColor(yt?null:qe).toArray01();return new r.ao(...pt)}}return r.ao.transparent})();if(this.context.clear({color:ct,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ye&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const nt=ee[this.currentLayer],qe=s.getLayerSourceCache(nt);if(nt.isSky())continue;const yt=qe?(nt.is3D(M)?we:de)[qe.id]:void 0;this._renderTileClippingMasks(nt,qe,yt),this.renderLayer(this,qe,nt,yt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ye&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const nt=ee[this.currentLayer],qe=s.getLayerSourceCache(nt);nt.isSky()&&this.renderLayer(this,qe,nt,qe?de[qe.id]:void 0)}function rt(nt,qe){let yt;return qe&&(yt=(nt.type==="symbol"?be:nt.is3D(M)?we:de)[qe.id]),yt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<D.length;){const nt=ee[this.currentLayer];if(nt.type==="raster"||nt.type==="raster-particle"){const qe=s.getLayerSourceCache(nt);this.renderLayer(this,qe,nt,rt(nt,qe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let _t=0;Ne&&(_t=Ne.getShadowCastingLayerCount());let xt=!1,St=-1;for(let nt=0;nt<D.length;++nt){const qe=ee[nt];qe.isHidden(this.transform.zoom)||qe.is3D(M)&&(St=nt)}V&&St===-1&&(O=!0);let Ft=!1;for(;this.currentLayer<D.length;){const nt=ee[this.currentLayer],qe=s.getLayerSourceCache(nt);if(nt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(nt)){if(nt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ft&&nt.is3D(M)&&!M){const yt=this.currentLayer,pt=Ut=>{for(this.currentLayer=0;this.currentLayer<ee.length;this.currentLayer++){const ei=ee[this.currentLayer];if(Jl[ei.type]){const vi=this.style.getLayerSourceCache(ei);Jl[ei.type](this,vi,ei,rt(ei,vi),Ut)}}};pt("initialize"),pt("reset"),this.currentLayer=yt,Ft=!0}if(O&&!xt&&this.terrain&&!this.transform.isOrthographic&&(xt=!0,this.blitDepth()),V&&St!==-1&&this.currentLayer===St+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(nt,qe,qe?pe[qe.id]:void 0),this.renderLayer(this,qe,nt,rt(nt,qe)),!this.terrain&&Ne&&_t>0&&nt.hasShadowPass()&&--_t==0){{this.clearStencil(),this.resetStencilClippingMasks();const yt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<ee.length;this.currentLayer++){const pt=ee[this.currentLayer];if(Uh[pt.type]){const Ut=this.style.getLayerSourceCache(pt);Uh[pt.type](this,Ut,pt,rt(pt,Ut))}}this.currentLayer=yt}if(Ne.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const yt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=yt;this.currentLayer++){const pt=ee[this.currentLayer];if(!pt.hasLightBeamPass())continue;const Ut=s.getLayerSourceCache(pt);this.renderLayer(this,Ut,pt,Ut?de[Ut.id]:void 0)}this.currentLayer=yt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const yt=this.currentLayer;this.depthOcclusion=!0;for(const pt of this.layersWithOcclusionOpacity){this.currentLayer=pt;const Ut=ee[this.currentLayer],ei=s.getLayerSourceCache(Ut),vi=ei?de[ei.id]:void 0;this.terrain||this._renderTileClippingMasks(Ut,ei,ei?pe[ei.id]:void 0),this.renderLayer(this,ei,Ut,vi)}this.depthOcclusion=!1,this.currentLayer=yt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let nt=null;ee.forEach((qe=>{const yt=s.getLayerSourceCache(qe);yt&&!qe.isHidden(this.transform.zoom)&&yt.getVisibleCoordinates().length&&(!nt||nt.getSource().maxzoom<yt.getSource().maxzoom)&&(nt=yt)})),nt&&this.options.showTileBoundaries&&fi(this,nt,nt.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&fi(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(nt){const qe=nt.transform.padding;Au(nt,nt.transform.height-(qe.top||0),3,Zp),Au(nt,qe.bottom||0,3,Xm),Ys(nt,qe.left||0,3,wg),Ys(nt,nt.transform.width-(qe.right||0),3,Oh);const yt=nt.transform.centerPoint;(function(pt,Ut,ei,vi){dt(pt,Ut-1,ei-10,2,20,vi),dt(pt,Ut-10,ei-1,20,2,vi)})(nt,yt.x,nt.transform.height-yt.y,Bh)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),K||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,m=!c||!c.includes(s.type);if(Af[s.type]&&(m||this.terrain&&s.type==="custom")){const b=this.style.getLayerSourceCache(s);Af[s.type](s,b,this)}this.gpuTimingEnd()}renderLayer(s,c,m,b){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||b&&b.length)&&(this.id=m.id,this.gpuTimingStart(m),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(m.type)&&(!s.terrain||m.type!=="custom")||m.type==="clip"||io[m.type](s,c,m,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,m=this.context.gl;let b=this.gpuTimers[s.id];b||(b=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:m.createQuery()}),b.calls++,m.beginQuery(c.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,m=c.createQuery();this.deferredRenderGpuTimeQueries.push(m),c.beginQuery(s.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const m in s){const b=s[m],M=this.context.extTimerQuery,A=M.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(b.query),c[m]=A}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let m=0;for(const b of s)m+=c.getQueryParameter(b,c.QUERY_RESULT)/1e6,c.deleteQuery(b);return m}translatePosMatrix(s,c,m,b,M){if(!m[0]&&!m[1])return s;const A=M?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(A){const V=Math.sin(A),H=Math.cos(A);m=[m[0]*H-m[1]*V,m[0]*V+m[1]*H]}const D=[M?m[0]:r.ay(c,m[0],this.transform.zoom),M?m[1]:r.ay(c,m[1],this.transform.zoom),0],O=new Float32Array(16);return r.br(O,s,D),O}saveTileTexture(s){if(s.context!==this.context)return;const c=s.size[0],m=this._tileTextures[c];m?m.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,c,m){const b=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,M=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||M.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||M.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&M.push("GLOBE"),!this._fogVisible||b||c!==void 0&&!c||M.push("FOG","FOG_DITHERING"),b&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(s,c){this.cache=this.cache||{};const m=c&&c.defines||[],b=c&&c.config,M=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(m),A=Nc.cacheKey(Up[s],s,M,b);return this.cache[A]||(this.cache[A]=new Nc(this.context,s,Up[s],b,op[s],M)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const m=this.style.directionalLight,b=this.style.ambientLight;if(m&&b){const M=((A,D,O)=>{const V=A.properties.get("direction"),H=A.properties.get("color-use-theme")==="none",Q=A.properties.get("color").toNonPremultipliedRenderColor(H?null:O.getLut(A.scope)).toArray01(),K=A.properties.get("intensity"),ee=D.properties.get("color-use-theme")==="none",le=D.properties.get("color").toNonPremultipliedRenderColor(ee?null:O.getLut(D.scope)).toArray01(),se=D.properties.get("intensity"),pe=[V.x,V.y,V.z],de=r.dN(le,se),be=r.dN(Q,K);return{u_lighting_ambient_color:de,u_lighting_directional_dir:pe,u_lighting_directional_color:be,u_ground_radiance:Lh(pe,be,de)}})(m,b,this.style);c.setLightsUniformValues(s,M)}}}uploadCommonUniforms(s,c,m,b,M){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const D=A.getOpacity(this.transform.pitch),O=((V,H,Q,K,ee,le,se,pe,de,be,Me,we)=>{const Ue=V.transform,Pe=H.properties.get("color-use-theme")==="none",Ne=H.properties.get("color").toNonPremultipliedRenderColor(Pe?null:V.style.getLut(H.scope)).toArray01();Ne[3]=K;const Oe=V.frameCounter/1e3%1,[Le,Ye]=H.properties.get("vertical-range");return{u_fog_matrix:Q?Ue.calculateFogTileMatrix(Q):we||V.identityMat,u_fog_range:H.getFovAdjustedRange(Ue._fov),u_fog_color:Ne,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Le,Ye),Ye],u_fog_temporal_offset:Oe,u_frustum_tl:ee,u_frustum_tr:le,u_frustum_br:se,u_frustum_bl:pe,u_globe_pos:de,u_globe_radius:be,u_viewport:Me,u_globe_transition:r.aj(Ue.zoom),u_is_globe:+(Ue.projection.name==="globe")}})(this,A,m,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],b);c.setFogUniformValues(s,O)}M&&c.setCutoffUniformValues(s,M.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const b of m)c[b.key]=s[b.key]||new wh(b,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=ye||c[1]>=ye}setupDepthForOcclusion(s,c,m){const b=this.context,M=b.gl,A=!!m;var D;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(M.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),b.activeTexture.set(M.TEXTURE0),A||c.setTerrainUniformValues(b,m)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const s=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=s?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function kh(p,s){let c=!1,m=null;const b=()=>{m=null,c&&(p(),m=setTimeout(b,s),c=!1)};return()=>(c=!0,m||b(),m)}class Td{constructor(s){this._hashName=s&&encodeURIComponent(s),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kh(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=Aa(s);if(this._hashName){const m=this._hashName;let b=!1;const M=location.hash.slice(1).split("&").map((A=>{const D=A.split("=")[0];return D===m?(b=!0,`${D}=${c}`):A})).filter((A=>A));return b||M.push(`${m}=${c}`),`#${M.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map((m=>m.split("="))).forEach((m=>{m[0]===this._hashName&&(c=m)})),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some((m=>isNaN(Number(m))))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Aa(p,s){const c=p.getCenter(),m=Math.round(100*p.getZoom())/100,b=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,b),A=Math.round(c.lng*M)/M,D=Math.round(c.lat*M)/M,O=p.getBearing(),V=p.getPitch();let H=s?`/${A}/${D}/${m}`:`${m}/${D}/${A}`;return(O||V)&&(H+="/"+Math.round(10*O)/10),V&&(H+=`/${Math.round(V)}`),H}const Md={linearity:.3,easing:r.eT(0,0,.3,1)},To=Object.assign({deceleration:2500,maxSpeed:1400},Md),tm=Object.assign({deceleration:20,maxSpeed:1400},Md),Rf=Object.assign({deceleration:1e3,maxSpeed:360},Md),fp=Object.assign({deceleration:1e3,maxSpeed:90},Md);class dp{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=r.o.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)c.zoom+=M.zoomDelta||0,c.bearing+=M.bearingDelta||0,c.pitch+=M.pitchDelta||0,M.panDelta&&c.pan._add(M.panDelta),M.around&&(c.around=M.around),M.pinchAround&&(c.pinchAround=M.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(c.pan.mag()){const M=Xc(c.pan.mag(),m,Object.assign({},To,s||{}));b.offset=c.pan.mult(M.amount/c.pan.mag()),b.center=this._map.transform.center,Ed(b,M)}if(c.zoom){const M=Xc(c.zoom,m,tm);b.zoom=this._map.transform.zoom+M.amount,Ed(b,M)}if(c.bearing){const M=Xc(c.bearing,m,Rf);b.bearing=this._map.transform.bearing+r.aA(M.amount,-179,179),Ed(b,M)}if(c.pitch){const M=Xc(c.pitch,m,fp);b.pitch=this._map.transform.pitch+M.amount,Ed(b,M)}if(b.zoom||b.bearing){const M=c.pinchAround===void 0?c.around:c.pinchAround;b.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Ed(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function Xc(p,s,c){const{maxSpeed:m,linearity:b,deceleration:M}=c,A=r.aA(p*b/(s/1e3),-m,m),D=Math.abs(A)/(M*b);return{easing:c.easing,duration:1e3*D,amount:A*(D/2)}}class mo extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m,b={}){const M=je(c.getCanvasContainer(),m),A=c.unproject(M);super(s,Object.assign({point:M,lngLat:A,originalEvent:m},b)),this._defaultPrevented=!1,this.target=c}}class no extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){const b=s==="touchend"?m.changedTouches:m.touches,M=Ce(c.getCanvasContainer(),b),A=M.map((O=>c.unproject(O))),D=M.reduce(((O,V,H,Q)=>O.add(V.div(Q.length))),new r.P(0,0));super(s,{points:M,point:D,lngLats:A,lngLat:c.unproject(D),originalEvent:m}),this._defaultPrevented=!1}}class Ll extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Ad{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Ll(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new mo(s.type,this._map,s))}mouseup(s){this._map.fire(new mo(s.type,this._map,s))}preclick(s){const c=new MouseEvent("preclick",s);this._map.fire(new mo(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new mo(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new mo(s.type,this._map,s))}mouseover(s){this._map.fire(new mo(s.type,this._map,s))}mouseout(s){this._map.fire(new mo(s.type,this._map,s))}touchstart(s){return this._firePreventable(new no(s.type,this._map,s))}touchmove(s){this._map.fire(new no(s.type,this._map,s))}touchend(s){this._map.fire(new no(s.type,this._map,s))}touchcancel(s){this._map.fire(new no(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ga{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new mo(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new mo(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ca{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(me(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const m=c,b=this._startPos,M=this._lastPos;if(!b||!M||M.equals(m)||!this._box&&m.dist(b)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=re("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const A=Math.min(b.x,m.x),D=Math.max(b.x,m.x),O=Math.min(b.y,m.y),V=Math.max(b.y,m.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${A}px,${O}px)`,this._box.style.width=D-A+"px",this._box.style.height=V-O+"px")}))}mouseupWindow(s,c){if(!this._active)return;const m=this._startPos,b=c;if(m&&s.button===0){if(this.reset(),ze(),m.x!==b.x||m.y!==b.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:s})),{cameraAnimation:M=>M.fitScreenCoordinates(m,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new r.z(s,{originalEvent:c}))}}function If(p,s){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=s[m];return c}class pp{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=(function(b){const M=new r.P(0,0);for(const A of b)M._add(A);return M.div(b.length)})(c),this.touches=If(m,c)))}touchmove(s,c,m){if(this.aborted||!this.centroid)return;const b=If(m,c);for(const M in this.touches){const A=b[M];(!A||A.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(s,c,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class hl{constructor(s){this.singleTap=new pp(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,m){this.singleTap.touchstart(s,c,m)}touchmove(s,c,m){this.singleTap.touchmove(s,c,m)}touchend(s,c,m){const b=this.singleTap.touchend(s,c,m);if(b){const M=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(b)<30;if(M&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Ql{constructor(){this._zoomIn=new hl({numTouches:1,numTaps:2}),this._zoomOut=new hl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,m){this._zoomIn.touchstart(s,c,m),this._zoomOut.touchstart(s,c,m)}touchmove(s,c,m){this._zoomIn.touchmove(s,c,m),this._zoomOut.touchmove(s,c,m)}touchend(s,c,m){const b=this._zoomIn.touchend(s,c,m),M=this._zoomOut.touchend(s,c,m);return b?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(b)},{originalEvent:s})}):M?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(M)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Wc={0:1,2:2},Zc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Pl{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const m=Te(s);this._correctButton(s,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(s,c){const m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&(function(b,M){const A=Wc[M];return b.buttons===void 0||(b.buttons&A)!==A})(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(s){this._lastPoint&&Te(s)===this._eventButton&&(this._moved&&ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo extends Pl{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Cd extends Pl{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Zc[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const m=.8*(c.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class yc extends Pl{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Zc[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const m=-.5*(c.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class Rd{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(s,c,m){return this._calculateTransform(s,c,m)}touchmove(s,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!r.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,m)}}touchend(s,c,m){this._calculateTransform(s,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,m){m.length>0&&(this._active=!0);const b=If(m,c),M=new r.P(0,0),A=new r.P(0,0);let D=0;for(const V in b){const H=b[V],Q=this._touches[V];Q&&(M._add(H),A._add(H.sub(Q)),D++,b[V]=H)}if(this._touches=b,D<this._minTouches||!A.mag())return;const O=A.div(D);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(D),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=re("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Eo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,m){return{}}touchstart(s,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,m){const b=this._firstTwoTouches;if(!b)return;s.preventDefault();const[M,A]=b,D=ro(m,c,M),O=ro(m,c,A);if(!D||!O)return;const V=this._aroundCenter?null:D.add(O).div(2);return this._move([D,O],V,s)}touchend(s,c,m){if(!this._firstTwoTouches)return;const[b,M]=this._firstTwoTouches,A=ro(m,c,b),D=ro(m,c,M);A&&D||(this._active&&ze(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ro(p,s,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return s[m]}function Ws(p,s){return Math.log2(p/s)}class xc extends Eo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Ws(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ws(this._distance,m),pinchAround:c}}}function vc(p,s){return 180*p.angleWith(s)/Math.PI}class Es extends Eo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vc(this._vector,m),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const b=vc(s,m);return Math.abs(b)<c}}function fl(p){return Math.abs(p.y)>Math.abs(p.x)}class Df extends Eo{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,fl(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,m){const b=this._lastPoints;if(!b)return;const M=s[0].sub(b[0]),A=s[1].sub(b[1]);return this._map._cooperativeGestures&&!r.eU()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(M,A,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(M.y+A.y)/2*-.5})}gestureBeginsVertically(s,c,m){if(this._valid!==void 0)return this._valid;const b=s.mag()>=2,M=c.mag()>=2;if(!b&&!M)return;if(!b||!M)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const A=s.y>0==c.y>0;return fl(s)&&fl(c)&&A}}const mp={panStep:100,bearingStep:15,pitchStep:10};class gp{constructor(){const s=mp;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,m=0,b=0,M=0,A=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),M=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),M=1);break;case 38:s.shiftKey?b=1:(s.preventDefault(),A=-1);break;case 40:s.shiftKey?b=-1:(s.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(m=0,b=0),{cameraAnimation:D=>{const O=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Iu,zoom:c?Math.round(O)+c*(s.shiftKey?2:1):O,bearing:D.getBearing()+m*this._bearingStep,pitch:D.getPitch()+b*this._pitchStep,offset:[-M*this._panStep,-A*this._panStep],center:D.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Iu(p){return p*(2-p)}const Id=4.000244140625,Dd=1/450;class ec{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Dd,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||r.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=r.o.now(),b=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%Id==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(b*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=je(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>Id?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&H!==0&&(H=1/H);const Q=c(),K=Math.pow(2,Q),ee=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(ee*H))),this._type==="wheel"&&(this._startZoom=Q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:c(),b=this._startZoom,M=this._easing;let A,D=!1;if(this._type==="wheel"&&b&&M){const V=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),H=M(V);A=r.ak(b,m,H),V<1?this._frameId||(this._frameId=!0):D=!0}else A=m,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let O=A-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=r.eV;if(this._prevEase){const m=this._prevEase,b=(r.o.now()-m.start)/m.duration,M=m.easing(b+.01)-m.easing(b),A=.27/Math.sqrt(M*M+1e-4)*.01,D=Math.sqrt(.0729-A*A);c=r.eT(A,D,.25,1)}return this._prevEase={start:r.o.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=re("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class dl{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Lf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _a{constructor(){this._tap=new hl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,c,m))}touchmove(s,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const b=c[0],M=b.y-this._swipePoint.y;return this._swipePoint=b,s.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(s,c,m)}touchend(s,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,c,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ga{constructor(s,c,m){this._el=s,this._mousePan=c,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yc{constructor(s,c,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Kc{constructor(s,c,m,b){this._el=s,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const oh=p=>p.zoom||p.drag||p.pitch||p.rotate;class im extends r.z{}class Ks{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const m=r.av([],c,s);this.radius=r.ag(m[2]<0?r.eX([],m,this.constants):[m[0],m[1],0])}projectRay(s){r.eX(s,s,this.constants),r.aw(s,s),r.eY(s,s,this.constants);const c=r.c5([],s,this.radius);if(c[2]>0){const m=r.c5([],[0,0,1],r.bJ(c,[0,0,1])),b=r.c5([],r.aw([],[c[0],c[1],0]),this.radius),M=r.d8([],c,r.c5([],r.av([],r.d8([],b,m),c),2));c[0]=M[0],c[1]=M[1]}return c}}function _p(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ym{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dp(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ks,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.aY(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,M,A]of this._listeners){const D=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(M,D,A)}}destroy(){for(const[s,c,m]of this._listeners){const b=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,b,m)}}_addDefaultHandlers(s){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Ad(c,s));const b=c.boxZoom=new Ca(c,s);this._add("boxZoom",b);const M=new Ql,A=new Lf;c.doubleClickZoom=new dl(A,M),this._add("tapZoom",M),this._add("clickZoom",A);const D=new _a;this._add("tapDragZoom",D);const O=c.touchPitch=new Df(c);this._add("touchPitch",O);const V=new Cd(s),H=new yc(s);c.dragRotate=new Yc(s,V,H),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Q=new Mo(s),K=new Rd(c,s);c.dragPan=new Ga(m,Q,K),this._add("mousePan",Q),this._add("touchPan",K,["touchZoom","touchRotate"]);const ee=new Es,le=new xc;c.touchZoomRotate=new Kc(m,le,ee,D),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ga(c));const se=c.scrollZoom=new ec(c,this);this._add("scrollZoom",se,["mousePan"]);const pe=c.keyboard=new gp;this._add("keyboard",pe);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[de]&&c[de].enable(s[de])}_add(s,c,m){this._handlers.push({handlerName:s,handler:c,allowed:m}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,m){for(const b in s)if(b!==m&&(!c||c.indexOf(b)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const m of s)this._el.contains(m.target)&&c.push(m);return c}handleEvent(s,c){this._updatingCamera=!0;const m=s.type==="renderFrame",b=m?void 0:s,M={needsRenderFrame:!1},A={},D={},O=s.touches?this._getMapTouches(s.touches):void 0,V=O?Ce(this._el,O):m?void 0:je(this._el,s);for(const{handlerName:K,handler:ee,allowed:le}of this._handlers){if(!ee.isEnabled())continue;let se;this._blockedByActive(D,le,K)?ee.reset():ee[c||s.type]&&(se=ee[c||s.type](s,V,O),this.mergeHandlerResult(M,A,se,K,b),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||ee.isActive())&&(D[K]=ee)}const H={};for(const K in this._previousActiveHandlers)D[K]||(H[K]=b);this._previousActiveHandlers=D,(Object.keys(H).length||_p(M))&&(this._changes.push([M,A,H]),this._triggerRenderFrame()),(Object.keys(D).length||_p(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=M;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(s,c,m,b,M){if(!m)return;Object.assign(s,m);const A={handlerName:b,originalEvent:m.originalEvent||M};m.zoomDelta!==void 0&&(c.zoom=A),m.panDelta!==void 0&&(c.drag=A),m.pitchDelta!==void 0&&(c.pitch=A),m.bearingDelta!==void 0&&(c.rotate=A)}_applyChanges(){const s={},c={},m={};for(const[b,M,A]of this._changes)b.panDelta&&(s.panDelta=(s.panDelta||new r.P(0,0))._add(b.panDelta)),b.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(s.around=b.around),b.aroundCoord!==void 0&&(s.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(s.pinchAround=b.pinchAround),b.noInertia&&(s.noInertia=b.noInertia),Object.assign(c,M),Object.assign(m,A);this._updateMapTransform(s,c,m),this._changes=[]}_updateMapTransform(s,c,m){const b=this._map,M=b.transform,A=be=>[be.x,be.y,be.z];if((be=>{const Me=this._eventsInProgress.drag;return Me&&!this._handlersById[Me.handlerName].isActive()})()&&!_p(s)){const be=M.zoom;M.cameraElevationReference="sea",this._originalZoom!=null&&M._orthographicProjectionAtLowPitch&&M.projection.name!=="globe"&&M.pitch===0?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),be!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&b._stop(!0),!_p(s))return void this._fireEvents(c,m,!0);let{panDelta:D,zoomDelta:O,bearingDelta:V,pitchDelta:H,around:Q,aroundCoord:K,pinchAround:ee}=s;M._isCameraConstrained&&(O>0&&(O=0),M._isCameraConstrained=!1),ee!==void 0&&(Q=ee),(O||(be=>c[be]&&!this._eventsInProgress[be])("drag"))&&Q&&(this._dragOrigin=A(M.pointCoordinate3D(Q)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",b._stop(!0),Q=Q||b.transform.centerPoint,V&&(M.bearing+=V),H&&(M.pitch+=H),M._updateCameraState();const le=[0,0,0];if(D)if(M.projection.name==="mercator"){const be=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(Q).dir),Me=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(Q.sub(D)).dir);le[0]=Me[0]-be[0],le[1]=Me[1]-be[1]}else{const be=M.pointCoordinate(Q);if(M.projection.name==="globe"){D=D.rotate(-M.angle);const Me=M._pixelsPerMercatorPixel/M.worldSize;le[0]=-D.x*r.eW(r.a$(be.y))*Me,le[1]=-D.y*r.eW(M.center.lat)*Me}else{const Me=M.pointCoordinate(Q.sub(D));be&&Me&&(le[0]=Me.x-be.x,le[1]=Me.y-be.y)}}const se=M.zoom,pe=[0,0,0];if(O){const be=A(K||M.pointCoordinate3D(Q)),Me={dir:r.aw([],r.av([],be,M._camera.position))};if(Me.dir[2]<0){const we=M.zoomDeltaToMovement(be,O);r.c5(pe,Me.dir,we)}}const de=r.d8(le,le,pe);M._translateCameraConstrained(de),O&&Math.abs(M.zoom-se)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,m,!0)}_fireEvents(s,c,m){const b=oh(this._eventsInProgress),M=oh(s),A={};for(const H in s){const{originalEvent:Q}=s[H];this._eventsInProgress[H]||(A[`${H}start`]=Q),this._eventsInProgress[H]=s[H]}!b&&M&&this._fireEvent("movestart",M.originalEvent);for(const H in A)this._fireEvent(H,A[H]);M&&this._fireEvent("move",M.originalEvent);for(const H in s){const{originalEvent:Q}=s[H];this._fireEvent(H,Q)}const D={};let O;for(const H in this._eventsInProgress){const{handlerName:Q,originalEvent:K}=this._eventsInProgress[H];this._handlersById[Q].isActive()||(delete this._eventsInProgress[H],O=c[Q]||K,D[`${H}end`]=O)}for(const H in D)this._fireEvent(H,D[H]);const V=oh(this._eventsInProgress);if(m&&(b||M)&&!V){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;H?(Q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:O})):(this._map.fire(new r.z("moveend",{originalEvent:O})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new r.z(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((s=>{this._frameId=void 0,this.handleEvent(new im("renderFrame",{timeStamp:s})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const lh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $c extends r.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,m){return s=r.P.convert(s).mult(-1),this.panTo(this.transform.center,Object.assign({offset:s},c),m)}panTo(s,c,m){return this.easeTo(Object.assign({center:s},c),m)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,m){return this.easeTo(Object.assign({zoom:s},c),m)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,m){return this.easeTo(Object.assign({bearing:s},c),m)}resetNorth(s,c){return this.rotateTo(0,Object.assign({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=r.aI.convert(s);const m=c&&c.bearing||0,b=c&&c.pitch||0,M=s.getNorthWest(),A=s.getSouthEast();return this._cameraForBounds(this.transform,M,A,m,b,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return s==null?Object.assign({},c,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:Object.assign({},c,s)}_extendCameraOptions(s){return(s=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const m=c.max[0]-c.min[0],b=c.max[1]-c.min[1];return m/b>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):b/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,m,b,M,A){const D=s.clone(),O=this._extendCameraOptions(A);D.bearing=b,D.pitch=M;const V=r.aT.convert(c),H=r.aT.convert(m),Q=.5*(V.lat+H.lat),K=.5*(V.lng+H.lng),ee=r.eZ(Q,K),le=r.aw([],ee),se=r.aw([],r.bI([],le,[0,1,0])),pe=r.bI([],se,le),de=[se[0],se[1],se[2],0,pe[0],pe[1],pe[2],0,le[0],le[1],le[2],0,0,0,0,1],be=[ee,r.eZ(V.lat,V.lng),r.eZ(H.lat,V.lng),r.eZ(H.lat,H.lng),r.eZ(V.lat,H.lng),r.eZ(Q,V.lng),r.eZ(Q,H.lng),r.eZ(V.lat,K),r.eZ(H.lat,K)];let Me=r.d9.fromPoints(be.map((pt=>[r.bJ(se,pt),r.bJ(pe,pt),r.bJ(le,pt)])));const we=r.af([],Me.center,de);r.e_(we)===0&&r.e$(we,0,0,1),r.aw(we,we),r.c5(we,we,r.aD),D.center=r.f0(we);const Ue=D.getWorldToCameraMatrix(),Pe=r.bl(new Float64Array(16),Ue);Me=r.d9.applyTransform(Me,r.aB([],Ue,de));const Ne=this._extendAABB(Me,D,O,b);if(!Ne)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Me=Ne,r.af(we,we,Ue);const Oe=.5*(Me.max[2]-Me.min[2]),Le=this._minimumAABBFrustumDistance(D,Me),Ye=r.c5([],[0,0,1],Oe),ct=r.d8(Ye,we,Ye),rt=Le+(D.pitch===0?0:r.bG(we,ct)),_t=D.globeCenterInViewSpace,xt=r.av([],we,[_t[0],_t[1],_t[2]]);r.aw(xt,xt),r.c5(xt,xt,rt);const St=r.d8([],we,xt);r.af(St,St,Pe);const Ft=r.eM/r.aD,nt=r.ag(St),qe=r.cf(Math.max(nt*Ft-r.eM,Number.EPSILON),0),yt=Math.min(D.zoomFromMercatorZAdjusted(qe),O.maxZoom);return yt>.5*(r.c_+r.cL)?(D.setProjection({name:"mercator"}),D.zoom=yt,this._cameraForBounds(D,c,m,b,M,A)):{center:D.center,zoom:yt,bearing:b,pitch:M}}_extendAABB(s,c,m,b){const M=.5*((m.padding.left||0)+(m.padding.right||0)),A=.5*((m.padding.top||0)+(m.padding.bottom||0)),D=A,O=M,V=M,H=A,Q=c.width-(O+V),K=c.height-(D+H),ee=r.av([],s.max,s.min),le=Math.min(Q/ee[0],K/ee[1]),se=Math.min(c.scaleZoom(c.scale*le),m.maxZoom);if(isNaN(se))return null;const pe=c.scale/c.zoomScale(se),de=new r.d9([s.min[0]-O*pe,s.min[1]-H*pe,s.min[2]],[s.max[0]+V*pe,s.max[1]+D*pe,s.max[2]]),be=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new r.P(m.offset.x,m.offset.y):r.P.convert(m.offset)).rotate(-r.an(b));return de.center[0]-=be.x*pe,de.center[1]+=be.y*pe,de}queryTerrainElevation(s,c){const m=this.transform.elevation;return m?(c=Object.assign({},{exaggerated:!0},c),m.getAtPoint(r.ae.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,m,b,M,A){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,m,b,M,A);const D=s.clone(),O=this._extendCameraOptions(A);D.bearing=b,D.pitch=M;const V=r.aT.convert(c),H=r.aT.convert(m),Q=new r.aT(V.lng,H.lat),K=new r.aT(H.lng,V.lat),ee=D.project(V),le=D.project(H),se=this.queryTerrainElevation(V),pe=this.queryTerrainElevation(H),de=this.queryTerrainElevation(Q),be=this.queryTerrainElevation(K),Me=[[ee.x,ee.y,Math.min(se||0,pe||0,de||0,be||0)],[le.x,le.y,Math.max(se||0,pe||0,de||0,be||0)]];let we=r.d9.fromPoints(Me);const Ue=D.getWorldToCameraMatrix(),Pe=r.bl(new Float64Array(16),Ue);we=r.d9.applyTransform(we,Ue);const Ne=this._extendAABB(we,D,O,b);if(!Ne)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");we=Ne;const Oe=.5*r.av([],we.max,we.min)[2],Le=this._minimumAABBFrustumDistance(D,we),Ye=[0,0,1,0];r.aC(Ye,Ye,Ue),r.f1(Ye,Ye);const ct=r.c5([],Ye,Le+Oe),rt=r.d8([],we.center,ct);r.af(we.center,we.center,Pe),r.af(rt,rt,Pe);const _t=D.unproject(new r.P(we.center[0],we.center[1])),xt=r.f2(D.projection,_t),St=Math.pow(2,xt),Ft=Math.min(D._zoomFromMercatorZ(rt[2]*D.pixelsPerMeter*St/D.worldSize),O.maxZoom);return D.mercatorFromTransition&&Ft<.5*(r.c_+r.cL)?(D.setProjection({name:"globe"}),D.zoom=Ft,this._cameraForBounds(D,c,m,b,M,A)):{center:_t,zoom:Ft,bearing:b,pitch:M}}fitBounds(s,c,m){const b=this.cameraForBounds(s,c);return this._fitInternal(b,c,m)}fitScreenCoordinates(s,c,m,b,M){const A=r.P.convert(s),D=r.P.convert(c),O=new r.P(Math.min(A.x,D.x),Math.min(A.y,D.y)),V=new r.P(Math.max(A.x,D.x),Math.max(A.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,D))return this;const H=this.transform.pointLocation3D(O),Q=this.transform.pointLocation3D(V),K=this.transform.pointLocation3D(new r.P(O.x,V.y)),ee=this.transform.pointLocation3D(new r.P(V.x,O.y)),le=[Math.min(H.lng,Q.lng,K.lng,ee.lng),Math.min(H.lat,Q.lat,K.lat,ee.lat)],se=[Math.max(H.lng,Q.lng,K.lng,ee.lng),Math.max(H.lat,Q.lat,K.lat,ee.lat)],pe=b&&b.pitch?b.pitch:this.getPitch(),de=this._cameraForBounds(this.transform,le,se,m,pe,b);return this._fitInternal(de,b,M)}_fitInternal(s,c,m){return s?(c=Object.assign(s,c)).linear?this.easeTo(c,m):this.flyTo(c,m):this}jumpTo(s,c){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let b=!1,M=!1,A=!1;"zoom"in s&&m.zoom!==+s.zoom&&(b=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=r.aT.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(M=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(A=!0,m.pitch=+s.pitch);const D=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!m.isPaddingEqual(D))if(s.retainPadding===!1){const O=m.clone();O.padding=D,m.setLocationAtPoint(m.center,O.centerPoint)}else m.padding=D;return s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),b&&this.fire(new r.z("zoomstart",c)).fire(new r.z("zoom",c)).fire(new r.z("zoomend",c)),M&&this.fire(new r.z("rotatestart",c)).fire(new r.z("rotate",c)).fire(new r.z("rotateend",c)),A&&this.fire(new r.z("pitchstart",c)).fire(new r.z("pitch",c)).fire(new r.z("pitchend",c)),this.fire(new r.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(lh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return r.w(lh),this;this.stop();const b=m.zoom,M=m.pitch,A=m.bearing;m.setFreeCameraOptions(s);const D=b!==m.zoom,O=M!==m.pitch,V=A!==m.bearing;return this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),D&&this.fire(new r.z("zoomstart",c)).fire(new r.z("zoom",c)).fire(new r.z("zoomend",c)),V&&this.fire(new r.z("rotatestart",c)).fire(new r.z("rotate",c)).fire(new r.z("rotateend",c)),O&&this.fire(new r.z("pitchstart",c)).fire(new r.z("pitch",c)).fire(new r.z("pitchend",c)),this.fire(new r.z("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=Object.assign({offset:[0,0],duration:500,easing:r.eV},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,b=this.getZoom(),M=this.getBearing(),A=this.getPitch(),D=this.getPadding(),O="zoom"in s?+s.zoom:b,V="bearing"in s?this._normalizeBearing(s.bearing,M):M,H="pitch"in s?+s.pitch:A,Q=this._extendPadding(s.padding),K=r.P.convert(s.offset);let ee,le,se;if(m.projection.name==="globe"){const Ye=r.ae.fromLngLat(m.center),ct=K.rotate(-m.angle);Ye.x+=ct.x/m.worldSize,Ye.y+=ct.y/m.worldSize;const rt=Ye.toLngLat(),_t=r.aT.convert(s.center||rt);this._normalizeCenter(_t),ee=m.centerPoint.add(ct),le=new r.P(Ye.x,Ye.y).mult(m.worldSize),se=new r.P(r.aF(_t.lng),r.aJ(_t.lat)).mult(m.worldSize).sub(le)}else{ee=m.centerPoint.add(K);const Ye=m.pointLocation(ee),ct=r.aT.convert(s.center||Ye);this._normalizeCenter(ct),le=m.project(Ye),se=m.project(ct).sub(le)}const pe=m.zoomScale(O-b);let de,be;s.around&&(de=r.aT.convert(s.around),be=m.locationPoint(de));const Me=this._zooming||O!==b,we=this._rotating||M!==V,Ue=this._pitching||H!==A,Pe=!m.isPaddingEqual(Q),Ne=s.retainPadding===!1?m.clone():m,Oe=Ye=>ct=>{if(Me&&(Ye.zoom=r.ak(b,O,ct)),we&&(Ye.bearing=r.ak(M,V,ct)),Ue&&(Ye.pitch=r.ak(A,H,ct)),Pe&&(Ne.interpolatePadding(D,Q,ct),ee=Ne.centerPoint.add(K)),de)Ye.setLocationAtPoint(de,be);else{const rt=Ye.zoomScale(Ye.zoom-b),_t=O>b?Math.min(2,pe):Math.max(.5,pe),xt=Math.pow(_t,1-ct),St=Ye.unproject(le.add(se.mult(ct*xt)).mult(rt));Ye.setLocationAtPoint(Ye.renderWorldCopies?St.wrap():St,ee)}return s.preloadOnly||this._fireMoveEvents(c),Ye};if(s.preloadOnly){const Ye=this._emulate(Oe,s.duration,m);return this._preloadTiles(Ye),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Me,this._rotating=we,this._pitching=Ue,this._padding=Pe,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,Le),this._ease(Oe(m),(Ye=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(c,Ye)}),s),this}_prepareEase(s,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||m.moving||this.fire(new r.z("movestart",s)),this._zooming&&!m.zooming&&this.fire(new r.z("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new r.z("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new r.z("pitchstart",s))}_fireMoveEvents(s){this.fire(new r.z("move",s)),this._zooming&&this.fire(new r.z("zoom",s)),this._rotating&&this.fire(new r.z("rotate",s)),this._pitching&&this.fire(new r.z("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,b=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new r.z("zoomend",s)),b&&this.fire(new r.z("rotateend",s)),M&&this.fire(new r.z("pitchend",s)),this.fire(new r.z("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const pt=r.aH(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(pt,c)}this.stop(),s=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eV},s);const m=this.transform,b=this.getZoom(),M=this.getBearing(),A=this.getPitch(),D=this.getPadding(),O="zoom"in s?r.aA(+s.zoom,m.minZoom,m.maxZoom):b,V="bearing"in s?this._normalizeBearing(s.bearing,M):M,H="pitch"in s?+s.pitch:A,Q=this._extendPadding(s.padding),K=m.zoomScale(O-b),ee=r.P.convert(s.offset);let le=m.centerPoint.add(ee);const se=m.pointLocation(le),pe=r.aT.convert(s.center||se);this._normalizeCenter(pe);const de=m.project(se),be=m.project(pe).sub(de);let Me=s.curve;const we=Math.max(m.width,m.height),Ue=we/K,Pe=be.mag();if("minZoom"in s){const pt=r.aA(Math.min(s.minZoom,b,O),m.minZoom,m.maxZoom),Ut=we/m.zoomScale(pt-b);Me=Math.sqrt(Ut/Pe*2)}const Ne=Me*Me;function Oe(pt){const Ut=(Ue*Ue-we*we+(pt?-1:1)*Ne*Ne*Pe*Pe)/(2*(pt?Ue:we)*Ne*Pe);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function Le(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Ye(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const ct=Oe(0);let rt=function(pt){return Ye(ct)/Ye(ct+Me*pt)},_t=function(pt){return we*((Ye(ct)*(Le(Ut=ct+Me*pt)/Ye(Ut))-Le(ct))/Ne)/Pe;var Ut},xt=(Oe(1)-ct)/Me;if(Math.abs(Pe)<1e-6||!isFinite(xt)){if(Math.abs(we-Ue)<1e-6)return this.easeTo(s,c);const pt=Ue<we?-1:1;xt=Math.abs(Math.log(Ue/we))/Me,_t=function(){return 0},rt=function(Ut){return Math.exp(pt*Me*Ut)}}s.duration="duration"in s?+s.duration:1e3*xt/("screenSpeed"in s?+s.screenSpeed/Me:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const St=M!==V,Ft=H!==A,nt=!m.isPaddingEqual(Q),qe=s.retainPadding===!1?m.clone():m,yt=pt=>Ut=>{const ei=Ut*xt,vi=1/rt(ei);pt.zoom=Ut===1?O:b+pt.scaleZoom(vi),St&&(pt.bearing=r.ak(M,V,Ut)),Ft&&(pt.pitch=r.ak(A,H,Ut)),nt&&(qe.interpolatePadding(D,Q,Ut),le=qe.centerPoint.add(ee));const ni=Ut===1?pe:pt.unproject(de.add(be.mult(_t(ei))).mult(vi));return pt.setLocationAtPoint(pt.renderWorldCopies?ni.wrap():ni,le),pt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),pt};if(s.preloadOnly){const pt=this._emulate(yt,s.duration,m);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=St,this._pitching=Ft,this._padding=nt,this._prepareEase(c,!1),this._ease(yt(m),(()=>this._afterEase(c)),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,c,m){m.animate===!1||m.duration===0?(s(1),c()):(this._easeStart=r.o.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=r.bT(s,-180,180);const m=Math.abs(s-c);return Math.abs(s-360-c)<m&&(s-=360),Math.abs(s+360-c)<m&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const m=s.lng-c.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,m){const b=Math.ceil(15*c/1e3),M=[],A=s(m.clone());for(let D=0;D<=b;D++){const O=A(D/b);M.push(O.clone())}return M}_preloadTiles(s,c){}}class pl{constructor(s={}){this.options=s,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,m=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=re("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=re("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const b=re("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",m),this._innerContainer=re("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(s){const m=c.reduce(((b,M,A)=>(M.value&&(b+=`${M.key}=${M.value}${A<c.length-1?"&":""}`),b)),"?");s.href=`${r.e.FEEDBACK_URL}/${m}#${Aa(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||(s.dataType!=="source"||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility")&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const c=this._map.style._mergedSourceCaches;for(const b in c){const M=c[b];if(M.used){const A=M.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s.sort(((b,M)=>b.length-M.length)),s=s.filter(((b,M)=>{for(let A=M+1;A<s.length;A++)if(s[A].indexOf(b)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.map((b=>(function(M){const A=new DOMParser().parseFromString(M,"text/html");return Array.from(A.body.querySelectorAll("*")).forEach((D=>{const O=D.textContent||"";if(D.tagName!=="A")return void D.replaceWith(A.createTextNode(O));const V=D.getAttribute("href");if(!V||!/^(https?:|mailto:)/i.test(V))return void D.replaceWith(A.createTextNode(O));const H=A.createElement("a");H.href=V,H.textContent=O,H.rel="noopener nofollow";const Q=D.getAttribute("class");Q&&(H.className=Q),D.replaceWith(H)})),A.body.innerHTML})(b))).join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Jc{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=re("div","mapboxgl-ctrl");const c=re("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const m=s[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Pf{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(c=>this._onIndoorUpdate(c))),this._container}_createButton(s,c){const m=re("button",s,this._container);return m.type="button",m.addEventListener("click",c),m}_createSeparator(){return re("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(s,c){this._map&&(s.setAttribute("aria-label",c),s.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return this._model=s,void(this._container.style.display="none");const c=this._model;this._model=s,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach((m=>m.remove())),s.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(s.floors,s.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const s=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));re("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&s.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(s),this._createSeparator()}_updateBuildingsButtonState(){const s=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");s&&this._model&&(this._model.activeFloorsVisible?s.classList.remove("mapboxgl-ctrl-level-button-selected"):s.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(s,c){for(let m=0;m<s.length;m++){const b=s[m],M=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(b.id)}));this._setButtonTitle(M,b.zIndex.toString()),this._model&&b.id===this._model.selectedFloorId&&c&&M.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(M),m<s.length-1&&this._createSeparator()}}}class Fo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const b of m)if(b.id===s)return void(b.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class so{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=r.dD((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,m){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+m}}const ao={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ao extends r.z{constructor(s,c,m,b){const{point:M,lngLat:A,originalEvent:D,target:O}=s;super(s.type,{point:M,lngLat:A,originalEvent:D,target:O}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=m,this.feature=b}}class na{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const m=c.filter;let b=c.type;m&&this.filters.set(s,r.b6(m)),b==="mouseover"&&(b="mouseenter"),b==="mouseout"&&(b="mouseleave");const M=this.interactionsByType.get(b)||new Map;b==="mouseenter"||b==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,c)):M.size===0&&this.map.on(b,this.handleType),M.size===0&&this.interactionsByType.set(b,M),M.set(s,c),this.typeById.set(s,b)}get(s){const c=this.typeById.get(s);if(!c)return;const m=this.interactionsByType.get(c);return m?m.get(s):void 0}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const m=this.interactionsByType.get(c);m&&(m.delete(s),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(c,this.handleType))}queryTargets(s,c){const m=[];for(const[b,M]of c)M.target&&m.push({targetId:b,target:M.target,filter:this.filters.get(b)});return this.map.style.queryRenderedTargets(s,m,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());c.length&&(s.type="mouseenter",this.handleType(s,c));const m=new Map;for(const[b,{feature:M}]of this.prevHoveredFeatures)this.hoveredFeatures.has(b)||m.set(M.id,M);m.size&&(s.type="mouseleave",this.handleType(s,Array.from(m.values())))}handleOut(s){const c=Array.from(this.hoveredFeatures.values()).map((({feature:m})=>m));c.length&&(s.type="mouseleave",this.handleType(s,c)),this.hoveredFeatures.clear()}handleType(s,c){const m=s.type==="mouseenter";if(m&&!this.interactionsByType.has(s.type))return void r.w("mouseenter interaction required for mouseleave to work.");const b=Array.from(this.interactionsByType.get(s.type)).reverse(),M=!!c;c=c||this.queryTargets(s.point,b);let A=!1;const D=new Set;for(const O of c){for(const[V,H]of b){if(!H.target)continue;const Q=O.variants?O.variants[V]:null;if(Q){for(const K of Q){if(ma(K,O,D,V))continue;const ee=new r.dx(O,K),le=Ma(K,O,V);M&&ee.id!==void 0&&(ee.state=this.map.getFeatureState(ee));const se=m?this.prevHoveredFeatures.get(le):null,pe=new Ao(s,V,H,ee),de=se?se.stop:H.handler(pe);if(m&&this.hoveredFeatures.set(le,{feature:O,stop:de}),de!==!1){A=!0;break}}if(A)break}}if(A)break}if(!A)for(const[O,V]of b){const{handler:H,target:Q}=V;if(!Q&&H(new Ao(s,O,V,null))!==!1)break}}}function ch(p,s){if(Array.isArray(p)&&Array.isArray(s)){const c=new Set(p),m=new Set(s);return c.size===m.size&&p.every((b=>m.has(b)))}return r.by(p,s)}const gs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ta={showCompass:!0,showZoom:!0,visualizePitch:!1};class oo{constructor(s,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Cd({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new yc({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),me()}move(s,c){const m=this.map,b=this.mouseRotate.mousemoveWindow(s,c),M=b&&b.bearingDelta;if(M&&m.setBearing(m.getBearing()+M),this.mousePitch){const A=this.mousePitch.mousemoveWindow(s,c),D=A&&A.pitchDelta;D&&m.setPitch(m.getPitch()+D)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(Object.assign({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),je(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,je(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ce(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ce(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function tc(p,s,c){if(p=new r.aT(p.lng,p.lat),s){const m=new r.aT(p.lng-360,p.lat),b=new r.aT(p.lng+360,p.lat),M=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),A=c.locationPoint3D(p).distSqr(s),D=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint3D(m).distSqr(s)<A&&(D||Math.abs(m.lng-c.center.lng)<M)?p=m:c.locationPoint3D(b).distSqr(s)<A&&(D||Math.abs(b.lng-c.center.lng)<M)&&(p=b)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint3D(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const cs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},go={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class zf extends r.E{constructor(s,c){super(),(s instanceof HTMLElement||c)&&(s=Object.assign({element:s},c)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:b="#3FB1CE",scale:M=1,draggable:A=!1,clickTolerance:D=0,rotation:O=go.rotation,rotationAlignment:V=go.rotationAlignment,pitchAlignment:H=go.pitchAlignment,occludedOpacity:Q=go.occludedOpacity,altitude:K=go.altitude}=s||{};this._anchor=m,this._color=b,this._scale=M,this._draggable=A,this._clickTolerance=D,this._rotation=O,this._rotationAlignment=V,this._pitchAlignment=H,this._occludedOpacity=Q,this._altitude=K,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=r.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(se=>{se.preventDefault()})),this._element.addEventListener("mousedown",(se=>{se.preventDefault()}));const ee=this._element.classList;for(const se in cs)ee.remove(`mapboxgl-marker-anchor-${se}`);ee.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=s&&s.className?s.className.trim().split(/\s+/):[];ee.add(...le),this._popup=null}_createDefaultMarker(){const s=re("div"),c=ie("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const m=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},c));ie("stop",{offset:"10%","stop-opacity":.4},m),ie("stop",{offset:"100%","stop-opacity":.05},m),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=r.aT.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||go.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,m=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const m=s.unproject(c,this._altitude),b=s.getFreeCameraOptions();if(!b.position)return!1;const M=b.position.toLngLat();return M.distanceTo(m)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(c,this._altitude);let b;s._showingGlobe()&&r.f5(s.transform,this._lngLat)?b=0:(b=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${cs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!s||m!=="map")return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const b=r.cX(r.f6(c.transform,this._lngLat)),M=s.sub(r.f7(c.transform)),A=Math.abs(M.x)+Math.abs(M.y);if(A===0)return"";const D=b/A;return`rotateX(${-M.y*D}deg) rotateY(${M.x*D}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let m=0;const b=this.getRotationAlignment();if(b==="map")if(c._showingGlobe()){const M=c.project(new r.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),A=c.project(new r.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(M);m=r.cX(Math.atan2(A.y,A.x))-90}else m=-c.getBearing();else if(b==="horizon"){const M=r.ah(4,6,c.getZoom()),A=r.f7(c.transform);A.y+=M*c.transform.height;const D=s.sub(A),O=r.cX(Math.atan2(D.y,D.x));m=(O>90?O-270:O+90)*(1-M)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=tc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),c._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(s){return this._offset=r.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const m=this._pointerdownPos,b=this._positionDelta;if(m&&b){if(!this._isDragging){const M=this._clickTolerance||c._clickTolerance;if(s.point.dist(m)<M)return;this._isDragging=!0}this._pos=s.point.sub(b),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,m=this._pos;c&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||go.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||go.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||go.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||go.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Wa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Du={maxWidth:100,unit:"metric"},Km={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},rs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wa(p=new r.P(0,0),s="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new r.P(0,p);case"top-left":return new r.P(c,c);case"top-right":return new r.P(-c,c);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(c,-c);case"bottom-right":return new r.P(-c,-c);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[s]||[0,0])}return{version:C,supported:$.supported,setRTLTextPlugin:r.fb,getRTLTextPluginStatus:r.fa,Map:class extends $c{constructor(p){z.mark(I.create);const s=p;if((p=Object.assign({},gs,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.f3(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bp(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Fo,this._domRenderTaskQueue=new Fo,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},ao,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new so(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new Gt(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ym(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Td(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new pl({customAttribution:p.customAttribution})),this._logoControl=new Jc,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(c=>{this._update(c.dataType==="style"),this.fire(new r.z(`${c.dataType}data`,c))})),this.on("dataloading",(c=>{this.fire(new r.z(`${c.dataType}dataloading`,c))})),this._interactions=new na(this)}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new r.z("movestart",p)).fire(new r.z("move",p)),this.fire(new r.z("resize",p)),s&&this.fire(new r.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((s=>s.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map((s=>s==="auto"?navigator.language:s)):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,s=p.projection.name;let c;s==="globe"&&p.zoom>=r.cL?(p.setMercatorFromTransition(),c=!0):s==="mercator"&&p.zoom<r.cL&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;const c=this.transform.mercatorFromTransition;s=p.name==="globe"&&this.transform.zoom>=r.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();const m=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(s||m)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,s){return this.transform.locationPoint3D(r.aT.convert(p),s)}unproject(p,s){return this.transform.pointLocation3D(r.P.convert(p),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,c){const m=b=>{let M=[];if(Array.isArray(s)){const A=s.filter((D=>this.getLayer(D)));M=A.length?this.queryRenderedFeatures(b,{layers:A}):[]}else M=this.queryRenderedFeatures(b,{target:s});return M};if(p==="mouseenter"||p==="mouseover"){let b=!1;return{listener:c,targets:s,delegates:{mousemove:A=>{const D=m(A.point);D.length?b||(b=!0,c.call(this,new mo(p,this,A.originalEvent,{features:D}))):b=!1},mouseout:()=>{b=!1}}}}if(p==="mouseleave"||p==="mouseout"){let b=!1;return{listener:c,targets:s,delegates:{mousemove:D=>{m(D.point).length?b=!0:b&&(b=!1,c.call(this,new mo(p,this,D.originalEvent)))},mouseout:D=>{b&&(b=!1,c.call(this,new mo(p,this,D.originalEvent)))}}}}{const b=M=>{const A=m(M.point);A.length&&(M.features=A,c.call(this,M),delete M.features)};return{listener:c,targets:s,delegates:{[p]:b}}}}on(p,s,c){if(typeof s=="function"||c===void 0)return super.on(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._createDelegatedListener(p,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const b in m.delegates)this.on(b,m.delegates[b]);return this}once(p,s,c){if(typeof s=="function"||c===void 0)return super.once(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._createDelegatedListener(p,s,c);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(p,s,c){if(typeof s=="function"||c===void 0)return super.off(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._delegatedListeners?this._delegatedListeners[p]:void 0;return m&&(b=>{for(let M=0;M<b.length;M++){const A=b[M];if(A.listener===c&&ch(A.targets,s)){for(const D in A.delegates)this.off(D,A.delegates[D]);return b.splice(M,1),this}}})(m),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(p===void 0||p instanceof r.P||Array.isArray(p)||s!==void 0||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!s){const M=this.style.queryRenderedFeatures(p,void 0,this.transform),A=this.style.queryRenderedFeatureset(p,void 0,this.transform);return M.concat(A)}let c=!0;if(s.target&&(c=this._isTargetValid(s.target),c&&!s.layers))return this.style.queryRenderedFeatureset(p,s,this.transform);let m=!0;if(s.layers&&Array.isArray(s.layers)){for(const M of s.layers)if(!this._isValidId(M)){m=!1;break}if(m&&!s.target)return this.style.queryRenderedFeatures(p,s,this.transform)}let b=[];return m&&(b=b.concat(this.style.queryRenderedFeatures(p,s,this.transform))),c&&(b=b.concat(this.style.queryRenderedFeatureset(p,s,this.transform))),b}querySourceFeatures(p,s){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,s)}queryRasterValue(p,s,c){return this._isValidId(p)?this.style.queryRasterValue(p,s,c):Promise.resolve(null)}isPointOnSurface(p){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&r.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}addInteraction(p,s){return this._interactions.add(p,s),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,s){return s=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&p&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(p,((c,m)=>{if(c){const b=typeof c=="string"?c:c instanceof Error?c.message:c.error;r.w(`Unable to perform style diff: ${b}. Rebuilding the style from scratch.`),this._updateStyle(p,s)}else m&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const c=Object.assign({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new ho(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ho(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dr(p)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const s of p)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(p)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:c=1,sdf:m=!1,stretchX:b,stretchY:M,content:A}={}){this._lazyInitEmptyStyle();const D=r.I.from(p);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:O,height:V,data:H}=r.o.getImageData(s);this.style.addImage(D,{data:new r.q({width:O,height:V},H),pixelRatio:c,stretchX:b,stretchY:M,content:A,sdf:m,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:V}=s,H=s;this.style.addImage(D,{data:new r.q({width:O,height:V},new Uint8Array(H.data)),pixelRatio:c,stretchX:b,stretchY:M,content:A,sdf:m,usvg:!1,version:0,userImage:H}),H.onAdd&&H.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();const c=r.I.from(p),m=this.style.getImage(c);if(!m)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?r.o.getImageData(s):s,{width:M,height:A,data:D}=b;if(M===void 0||A===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||A!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${M}, ${A})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const O=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let V=!1;m.usvg?(m.data=new r.q({width:M,height:A},new Uint8Array(D)),m.usvg=!1,m.icon=void 0,V=!0):m.data.replace(D,O),this.style.updateImage(c,m,V)}hasImage(p){return p?!!this.style&&!!this.style.getImage(r.I.from(p)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(r.I.from(p))}loadImage(p,s){r.n(this._requestManager.transformRequest(p,r.R.Image),((c,m)=>{s(c,m instanceof HTMLImageElement?r.o.getImageData(m):m)}))}listImages(){return this.style.listImages().map((p=>p.name))}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){const s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s).catch((c=>this.fire(new r.y(new Error("Failed to add import",c))))),this}updateImport(p,s){return typeof s!="string"&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const s=this.style.getOwnLayer(p);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,s,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,c),this._update(!0)):this}setFilter(p,s,c={}){return this._isValidId(p)?(this.style.setFilter(p,s,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,c,m),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,c,m),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}setLayerProperty(p,s,c,m={}){return this._isValidId(p)?(s==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(p,s,c,m),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,s){return this.style.setSchema(p,s),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,s){return this.style.setConfig(p,s),this._update(!0)}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,c){return this.style.setConfigProperty(p,s,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,s),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aT.convert(p),this.transform):0}setFeatureState(p,s){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,s),this._update())}removeFeatureState(p,s){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,s),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Pf),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,m,b,M=this._container;for(;M&&(!m||!b);){const A=window.getComputedStyle(M).transform;A&&A!=="none"&&(c=A.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(b=c[3])),M=M.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=b?Math.abs(s/b):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Fp(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=re("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=re("div","mapboxgl-canvas-container",p);this._canvas=re("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=re("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((b=>{m[b]=re("div",`mapboxgl-ctrl-${b}`,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const c=r.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const p=Object.assign({},$.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(Ji(s,!0),this.painter=new Cf(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),r.k.testSupport(s)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new r.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,m=r.o.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=b.createQuery(),b.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,H=this.transform.pitch,Q=r.o.now(),K=new r.ac(V,{now:Q,fadeDuration:M,pitch:H,transition:this.style.transition,worldview:this._worldview});this.style.update(K)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(m);const D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),D&&(this._placementDirty=D.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,z.mark(I.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const V=r.o.now()-m;b.endQuery(c.TIME_ELAPSED_EXT),setTimeout((()=>{const H=b.getQueryParameter(s,b.QUERY_RESULT)/1e6;b.deleteQuery(s),this.fire(new r.z("gpu-timing-frame",{cpuTime:V,gpuTime:H}))}),50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout((()=>{const H=this.painter.queryGpuTimers(V);this.fire(new r.z("gpu-timing-layer",{layerTimes:H}))}),50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const H=this.painter.queryGpuTimeDeferredRender(V);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:H}))}),50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(O||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(A=this._updateAverageElevation(m,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,z.mark(I.fullLoad),this._performanceMetricsCollection&&xn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const c=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const b=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=p;const A=Math.abs(b-M);if(A>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(M),c(M);this._averageElevation.easeTo(M,p,300)}else if(A>1e-4)return this._averageElevation.jumpTo(M),c(M)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){st(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(p=>{if(p&&(p.message===mt||p.status===401)){const s=this.painter.context.gl;Ji(s,!1),this._logoControl instanceof Jc&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),ki(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&xi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Ui(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Fn(this._requestManager._customAccessToken)}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function b(M){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,M,0);const A=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,A),A}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(b(p),s.canvasCopies.map(b),s.timeStamps)}_canvasPixelComparison(p,s,c){let m=c[1]-c[0];const b=p.length/4;for(let M=0;M<s.length;M++){const A=s[M];let D=0;for(let O=0;O<A.length;O+=4)A[O]===p[O]&&A[O+1]===p[O+1]&&A[O+2]===p[O+2]&&A[O+3]===p[O+3]&&(D+=1);m+=(c[M+2]-c[M+1])*(1-D/b)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Xi.delete(this.painter.context.gl),Vi.remove(),ii.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.o.frame((s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)})))}_preloadTiles(p){const s=this.style?this.style.getSourceCaches():[];return r.bw(s,((c,m)=>c._preloadTiles(p,m)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this.style&&p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,s){r.f4(p,s)}get version(){return C}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},ta,p),this._container=re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(s=>{this._map&&this._map.zoomIn({},{originalEvent:s})})),re("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(s=>{this._map&&this._map.zoomOut({},{originalEvent:s})})),re("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))})),this._compassIcon=re("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),c=s===p.getMaxZoom(),m=s===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=s)}))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oo(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const c=re("button",p,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(p,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.E{constructor(p={}){super();const s=navigator.geolocation;this.options=Object.assign({geolocation:s},Wa,p),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((c=>s(c.state!=="denied"))).catch((()=>s())):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),c=p.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){const s=new r.aT(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),b=Object.assign({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),b,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new r.aT(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=r.cf(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this._geolocateButton=re("button","mapboxgl-ctrl-geolocate",this._container),re("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=re("div","mapboxgl-user-location"),this._dotElement.appendChild(re("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(re("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=re("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))}))}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((s=>{s==="granted"&&p()})).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pl,ScaleControl:class{constructor(p={}){this.options=Object.assign({},Du,p),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,m=s._containerWidth/2-p/2,b=s.unproject([m,c]),M=s.unproject([m+p,c]),A=b.distanceTo(M);if(this.options.unit==="imperial"){const D=3.2808*A;D>5280?this._setScale(p,D/5280,"mile"):this._setScale(p,D,"foot")}else this.options.unit==="nautical"?this._setScale(p,A/1852,"nautical-mile"):A>=1e3?this._setScale(p,A/1e3,"kilometer"):this._setScale(p,A,"meter")}_setScale(p,s,c){this._map._requestDomTask((()=>{const m=(function(M){const A=Math.pow(10,`${Math.floor(M)}`.length-1);let D=M/A;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:(function(O){const V=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*V)/V})(D),A*D})(s),b=m/s;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${Km[c]}`,this._container.style.width=p*b+"px"}))}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=re("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=re("button","mapboxgl-ctrl-fullscreen",this._controlContainer);re("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Pf,Popup:class extends r.E{constructor(p){super(),this.options=Object.assign(Object.create(zl),p),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.aT.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const s=document.createDocumentFragment(),c=document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=re("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const c=this._closeButton=re("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,m=this._pos;if(!s||!c||!m)return"bottom";const b=c.offsetWidth,M=c.offsetHeight,A=m.x<b/2,D=m.x>s.transform.width-b/2;if(m.y+p<M)return A?"top-left":D?"top-right":"top";if(m.y>s.transform.height-M){if(A)return"bottom-left";if(D)return"bottom-right"}return A?"left":D?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=re("div","mapboxgl-popup",s.getContainer()),this._tip=re("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tc(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p instanceof r.P?p:s.project(this._lngLat,this._altitude),M=wa(this.options.offset),A=this._anchor=this._getAnchor(M.y),D=wa(this.options.offset,A),O=b.add(D).round();s._requestDomTask((()=>{this._container&&A&&(this._container.style.transform=`${cs[A]} translate(${O.x}px,${O.y}px)`)}))}if(!this._marker&&s._showingGlobe()){const b=r.f5(s.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(rs);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:zf,Style:ho,LngLat:r.aT,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:Xo,Evented:r.E,config:r.e,prewarm:r.f9,clearPrewarmedResources:r.f8,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(p){r.e.ACCESS_TOKEN=p},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(p){r.e.API_URL=p},get workerCount(){return r.fi.workerCount},set workerCount(p){r.fi.workerCount=p},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.fh(p)},get workerUrl(){return r.fg.workerUrl},set workerUrl(p){r.fg.workerUrl=p},get workerClass(){return r.fg.workerClass},set workerClass(p){r.fg.workerClass=p},get workerParams(){return r.fg.workerParams},set workerParams(p){r.fg.workerParams=p},get dracoUrl(){return r.ff()},set dracoUrl(p){r.fe(p)},get meshoptUrl(){return r.fd()},set meshoptUrl(p){r.fc(p)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}}));var v=h;return v}))})(jT)),jT.exports}var Foe=Noe();const nC=yM(Foe),Uoe="/dsc-106-final-proj/",G1={dc_score:{label:"GridScore",description:"Composite score balancing sustainability and profitability (60/40 weighting)."},sustainability:{label:"Sustainability",description:"ESG tilt driven by renewables share, volatility, and cooling friendliness."},profitability:{label:"Profitability",description:"Operational efficiency from price stability, peak load, and volatility."},dc_score_temp:{label:"Cooling advantage",description:"Temperature-adjusted score that rewards cooler microclimates."},local_temp_c:{label:"Local temperature (C)",description:"Average local temperature per hex so cooler microclimates pop out."},elevation_m:{label:"Elevation (m)",description:"Elevation per hex for quick terrain context."}},H1="dc_score",dF=[{id:"pnw",label:"Cool, high-GridScore cluster (PNW)",colorClass:"bg-emerald-300",coords:[-122.7,45.6]},{id:"south",label:"Warmer, costlier cells across the South",colorClass:"bg-amber-300",coords:[-90,30]},{id:"carolinas",label:"Carolinas: top GridScore  sustainable and profitable",colorClass:"bg-emerald-200",coords:[-79.8,34.9]}];function koe(){const n=Ii.useRef(null),e=Ii.useRef(null),i=Ii.useRef(null),l=Ii.useRef(null),h=Ii.useRef(null),g=Ii.useRef(null),v=Ii.useRef(null),r=Ii.useRef(!1),C=Ii.useRef(!1),I=Ii.useRef(H1),z=Ii.useRef(H1),N=Ii.useRef([]),k=Ii.useRef({}),j=Ii.useRef({}),$=Ii.useRef(null),re=Ii.useRef(null),ie=Ii.useRef(null),Y=Ii.useRef({}),[ae,ue]=Ii.useState(H1),[me,Ae]=Ii.useState([0,1]),[Se,ze]=Ii.useState("loading"),[je,Ce]=Ii.useState(null),[Te,Ze]=Ii.useState([]),[Mt,mt]=Ii.useState(!1),Gt=Ii.useMemo(()=>G1[ae]?.description??"",[ae]);Ii.useEffect(()=>{if(i.current||!l.current)return;nC.accessToken="pk.eyJ1IjoibjNpbC1rYiIsImEiOiJjbWh6b3o0dnYwcWEyMnJxMWlwNXA1ZWk1In0.K-4taSD4zQDRO4Vsua0k2Q";const Ge=new nC.Map({container:l.current,style:"mapbox://styles/mapbox/light-v11",center:[-98.5,39],zoom:3.5,pitch:0,bearing:0,interactive:!0});Ge.addControl(new nC.NavigationControl,"top-left"),ie.current=()=>{re.current&&(re.current=null,C.current&&i.current&&g.current&&Re()),jt()},Ge.on("load",()=>{i.current=Ge,C.current=!0,mt(!0)}),Ge.on("movestart",()=>{r.current=!0,jt()});const Et=()=>{v.current||(v.current=requestAnimationFrame(()=>{v.current=null,Re()}))};return Ge.on("move",Et),Ge.on("moveend",()=>{r.current=!1,v.current&&(cancelAnimationFrame(v.current),v.current=null),Re()}),Ge.on("resize",()=>Re()),Ge.on("mousemove",Vt=>Qe(Vt)),Ge.on("mouseleave",()=>ie.current?.()),()=>{C.current=!1,v.current&&(cancelAnimationFrame(v.current),v.current=null),i.current&&(i.current.remove(),i.current=null)}},[]),Ii.useEffect(()=>{let Ge=!0;return(async()=>{try{ze("loading");const Vt=await fetch(`${Uoe}data/score_map_hex.json`);if(!Vt.ok)throw new Error(`HTTP ${Vt.status}`);const ii=await Vt.json();if(!Ge)return;const ki=(ii.features??[]).map(Fi=>{const Ui=_q(Fi),rn=hq(Fi);return{...Fi,_centroid:Ui,_bounds:rn}}),qt={};Object.keys(G1).forEach(Fi=>{const Ui=ki.map(Er=>IR(Er,Fi)).filter(Er=>Er!==null),[rn,Fn]=Ui.length?DR(Ui):[0,1];qt[Fi]=Number.isFinite(rn)&&Number.isFinite(Fn)&&rn!==Fn?[rn,Fn]:[0,1]});const xi={};Object.entries(qt).forEach(([Fi,Ui])=>{const rn=S4(Ui,Xz),Fn=Array.from({length:256},(Er,xn)=>{const Vi=xn/255,st=Ui[0]+Vi*(Ui[1]-Ui[0]);return rn(st)});xi[Fi]=Fn}),g.current={...ii,features:ki},k.current=qt,j.current=xi,Ze(ki),Ae(qt[H1]??[0,1]),ze("ready")}catch(Vt){if(!Ge)return;Ce(Vt.message||"Failed to load score map data."),ze("error")}})(),()=>{Ge=!1}},[]),Ii.useEffect(()=>{if(!Mt||!Te.length)return;I.current=ae,z.current=ae;const Ge=k.current[ae];Ge&&Ae(Ge),Re()},[ae,Te,Mt]);const kt=(Ge,Et)=>{if(!Et)return Ge;const Vt=Et.getBounds(),ii=Vt.getSouthWest(),ki=Vt.getNorthEast(),qt=.2,xi=ii.lng-qt,Fi=ki.lng+qt,Ui=ii.lat-qt,rn=ki.lat+qt;return Ge.filter(Fn=>{const Er=Fn._centroid;if(!Er)return!1;const[xn,Vi]=Er;return xn>=xi&&xn<=Fi&&Vi>=Ui&&Vi<=rn})},Re=()=>{const Ge=g.current?.features;if(!n.current||!Ge?.length)return;const Et=n.current,Vt=i.current;if(!Vt||!l.current)return;const ii=Vt.getCanvas();ii&&Et.style.transform!==ii.style.transform&&(Et.style.transform=ii.style.transform),Et.style.transformOrigin=ii?.style.transformOrigin||"0 0";const ki=l.current.clientWidth||960,qt=l.current.clientHeight||520,xi=window.devicePixelRatio||1;Et.width=ki*xi,Et.height=qt*xi,Et.style.width=`${ki}px`,Et.style.height=`${qt}px`;const Fi=Et.getContext("2d");Fi.setTransform(1,0,0,1,0,0),Fi.scale(xi,xi),Fi.clearRect(0,0,ki,qt);const Ui=(Di,tn)=>Vt.project([Di,tn]),Fn=Fq({stream:Di=>({point(tn,Sn){const _n=Ui(tn,Sn);Di.point(_n.x,_n.y)},lineStart(){Di.lineStart()},lineEnd(){Di.lineEnd()},polygonStart(){Di.polygonStart()},polygonEnd(){Di.polygonEnd()}})}).context(Fi),Er=kt(Ge,Vt);N.current=Er,$.current=$F().x(Di=>Di[0]).y(Di=>Di[1]).addAll(Er.map(Di=>{const tn=Di._centroid??[0,0];return[tn[0],tn[1],Di]}));const xn=z.current,Vi=k.current[xn]??[0,1],st=j.current[xn];Fi.globalAlpha=.7,Er.forEach(Di=>{Fi.beginPath(),Fn(Di),Fi.fillStyle=Voe(Di,xn,st,Vi),Fi.fill(),Fi.strokeStyle="rgba(255,255,255,0.15)",Fi.lineWidth=.35,Fi.stroke()});const Ji=re.current;if(Ji){const Di=CT(Ji),tn=Er.find(Sn=>CT(Sn)===Di);tn&&(Fi.save(),Fi.beginPath(),Fn(tn),Fi.globalAlpha=.95,Fi.strokeStyle="rgba(255,255,255,0.9)",Fi.lineWidth=1.2,Fi.shadowColor="rgba(0,255,128,0.45)",Fi.shadowBlur=8,Fi.stroke(),Fi.restore())}dF.forEach(Di=>{const tn=Y.current[Di.id];if(!tn)return;const Sn=Vt.project(Di.coords);tn.style.transform=`translate(${Sn.x}px, ${Sn.y}px)`})},Qe=Ge=>{if(r.current){jt();return}const Et=Ge.lngLat,Vt=$.current;let ii=null;const ki=Vt?.find(Et.lng,Et.lat,.8);if(ki?.[2]){const qt=ki[2];Nz(qt,[Et.lng,Et.lat])&&(ii=qt)}if(ii||(ii=N.current.find(qt=>{const xi=qt._bounds;if(xi){const[[Fi,Ui],[rn,Fn]]=xi;if(Et.lng<Fi||Et.lng>rn||Et.lat<Ui||Et.lat>Fn)return!1}return Nz(qt,[Et.lng,Et.lat])})),ii){CT(ii)!==CT(re.current)&&(re.current=ii,Re());const qt={clientX:Ge.point.x+(e.current?.getBoundingClientRect().left??0),clientY:Ge.point.y+(e.current?.getBoundingClientRect().top??0)};Lt(qt,ii,z.current)}else re.current&&(re.current=null,Re()),jt()},et=Ii.useMemo(()=>{const[Ge,Et]=me,Vt=j.current[ae]??null;return GG(0,1.01,.1).map(ii=>{if(Vt&&Et!==Ge){const qt=Math.max(0,Math.min(255,Math.floor(ii*255)));return{color:Vt[qt],offset:Math.round(ii*100)}}return{color:Xz(ii),offset:Math.round(ii*100)}})},[me,ae]);return Ii.useEffect(()=>{const Ge=e.current;if(!Ge)return;const Et=()=>ie.current?.();Ge.addEventListener("mouseleave",Et);const Vt=l.current;return Vt&&Vt.addEventListener("mouseleave",Et),()=>{Ge.removeEventListener("mouseleave",Et),Vt&&Vt.removeEventListener("mouseleave",Et)}},[]),hi.jsxs("div",{className:"relative min-h-screen w-full overflow-hidden bg-[#050910] text-white",children:[hi.jsxs("div",{className:"absolute inset-0 -z-10 opacity-70",children:[hi.jsx(cD,{className:"h-full w-full",waveColor:[.5,.7,.5],disableAnimation:!1,enableMouseInteraction:!1,mouseRadius:.3,colorNum:6.7,waveAmplitude:0,waveFrequency:0,waveSpeed:.01}),hi.jsx("div",{className:"absolute inset-x-0 bottom-0 h-60 bg-gradient-to-b from-transparent to-[#050910]"})]}),hi.jsx(AV,{}),hi.jsxs("main",{className:"mx-auto flex max-w-6xl flex-col gap-6 px-4 pb-16 pt-24",children:[hi.jsxs("div",{className:"space-y-3",children:[hi.jsx("h1",{className:"text-4xl font-bold tracking-tight text-white sm:text-5xl",children:"GridCast Score Map"}),hi.jsx("p",{className:"max-w-4xl text-lg text-white/70",children:"Interactive hex-grid visualization powered by D3 and Mapbox. Hover any cell to inspect profitability, sustainability, temperature, elevation, and cooling-friendly metrics driving the GridScore."})]}),hi.jsx("div",{className:"flex flex-col gap-4 rounded-2xl border border-white/5 bg-white/5 p-4 backdrop-blur-md sm:flex-row sm:items-center sm:justify-between",children:hi.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[hi.jsx("label",{className:"text-sm uppercase tracking-wide text-white/60",children:"Color by"}),hi.jsx("select",{className:"rounded-xl border border-white/10 bg-[#0c1421] px-4 py-3 text-base text-white shadow-[0_10px_30px_rgba(0,0,0,0.35)]",value:ae,onChange:Ge=>ue(Ge.target.value),children:Object.entries(G1).map(([Ge,Et])=>hi.jsx("option",{value:Ge,children:Et.label},Ge))}),hi.jsx("span",{className:"text-sm text-white/70",children:Gt})]})}),hi.jsxs("div",{ref:e,className:"relative overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br from-[#0a1320] via-[#08111d] to-[#0e1624] shadow-[0_30px_80px_rgba(0,0,0,0.35)] h-[70vh] min-h-[520px]",children:[hi.jsx("div",{ref:l,className:"absolute inset-0 h-full w-full"}),hi.jsx("canvas",{ref:n,className:"absolute inset-0 h-full w-full pointer-events-none"}),ae==="dc_score"&&hi.jsx("div",{className:"pointer-events-none absolute inset-0 z-10",children:dF.map(Ge=>hi.jsx("div",{ref:Et=>{Et&&(Y.current[Ge.id]=Et)},className:"absolute",style:{transform:"translate(-9999px, -9999px)"},children:hi.jsxs("div",{className:"group pointer-events-auto flex items-center gap-2",onMouseEnter:()=>jt(),children:[hi.jsx("span",{className:`h-3 w-3 rounded-full ${Ge.colorClass} shadow-lg shadow-black/40 ring-2 ring-black/60 group-hover:scale-110 transition`}),hi.jsx("span",{className:"pointer-events-none opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-200 ease-out rounded-full border border-white/10 bg-black/80 px-3 py-1 text-xs text-white/85 shadow-lg backdrop-blur whitespace-nowrap",children:Ge.label})]})},Ge.id))}),hi.jsx("div",{ref:h,className:"pointer-events-none absolute left-0 top-0 z-10 hidden min-w-[240px] rounded-2xl border border-white/10 bg-[#0c1622]/95 p-4 text-sm shadow-2xl backdrop-blur-md"}),Se==="loading"&&hi.jsx("div",{className:"pointer-events-none absolute inset-0 grid place-items-center bg-black/10 text-white/70",children:"Loading grid"}),Se==="error"&&hi.jsx("div",{className:"pointer-events-none absolute inset-0 grid place-items-center bg-black/20 text-rose-200",children:je})]}),hi.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/70",children:[hi.jsx("span",{className:"w-16 text-right font-mono text-xs text-white/60",children:Ep(me[0])}),hi.jsx("div",{className:"flex-1 rounded-full border border-white/10 p-[1px]",children:hi.jsx("div",{className:"h-3 w-full rounded-full",style:{background:Goe(et)}})}),hi.jsx("span",{className:"w-16 text-left font-mono text-xs text-white/60",children:Ep(me[1])})]})]})]});function Lt(Ge,Et,Vt){if(!h.current)return;const ii=WT(h.current),ki=Et?.properties??{},qt=G1[Vt]?Vt:H1,xi=ki.hex_id??ki.id??"",Fi=ki.region?`  ${ki.region}`:"",Ui=Number.isFinite(ki.lat)&&Number.isFinite(ki.lon)?`${Ep(ki.lat,2)}, ${Ep(ki.lon,2)}`:"",rn=`
      <div class="text-xs text-white/60 uppercase tracking-wide">Hexagon ${xi}${Fi}</div>
      <div class="text-xs text-white/50 mb-1">Lat/Lon: ${Ui}</div>
      <div class="flex items-center justify-between border-b border-white/10 pb-2 text-emerald-200">
        <span>${G1[qt].label}</span>
        <span class="font-mono text-base text-white">${Ep(IR(Et,qt))}</span>
      </div>
      <div class="mt-2 grid grid-cols-2 gap-y-1 text-white/70">
        <span>GridScore</span><span class="text-white text-right font-mono">${Ep(ki.dc_score)}</span>
        <span>Profitability</span><span class="text-white text-right font-mono">${Ep(ki.profitability)}</span>
        <span>Sustainability</span><span class="text-white text-right font-mono">${Ep(ki.sustainability)}</span>
        <span>Cooling boost</span><span class="text-white text-right font-mono">${Ep(ki.temp_cool_score)}</span>
        <span>Cooling advantage</span><span class="text-white text-right font-mono">${Ep(ki.dc_score_temp)}</span>
        <span>Local temp (C)</span><span class="text-white text-right font-mono">${Ep(ki.local_temp_c,1)}</span>
        <span>Elevation (m)</span><span class="text-white text-right font-mono">${Ep(ki.elevation_m,0)}</span>
        <span>Distance to region</span><span class="text-white text-right font-mono">${Number.isFinite(ki.dist_to_region)?`${Math.round(ki.dist_to_region/1e3)} km`:""}</span>
      </div>
    `;ii.html(rn).style("display","block").classed("hidden",!1);const Fn=16,Er=e.current?.getBoundingClientRect(),xn=Ge.clientX-(Er?.left??0)+Fn,Vi=Ge.clientY-(Er?.top??0)+Fn;ii.style("left",`${xn}px`).style("top",`${Vi}px`)}function jt(){if(!h.current)return;const Ge=WT(h.current);Ge.classed("hidden",!0),Ge.style("display","none")}}function IR(n,e){const i=n?.properties?.[e];if(i==null)return null;const l=Number(i);return Number.isFinite(l)?l:null}function CT(n){return n?.id??n?.properties?.hex_id??null}function Voe(n,e,i,l){const h=IR(n,e);if(h===null||!i||!l)return"rgba(255,255,255,0.06)";const[g,v]=l;if(v===g)return"rgba(255,255,255,0.06)";const r=(h-g)/(v-g),C=Math.max(0,Math.min(255,Math.floor(r*255)));return i[C]}function Ep(n,e){return Number.isFinite(n)?typeof e=="number"?nw(`.${e}f`)(n):n.toString():""}function Goe(n){return`linear-gradient(to right, ${n.map(e=>`${e.color} ${e.offset}%`).join(",")})`}function Hoe(){const n=Ii.useRef(null);return Ii.useEffect(()=>{const e=n.current;if(!e)return;const i=new URL("data:text/csv;base64,eWVhcixnbG9iYWxfaW50ZXJuZXRfdXNlcnNfbWlsbGlvbnMKMjAwNSwxMDI0CjIwMDYsMTE0NwoyMDA3LDEzNjYKMjAwOCwxNTU1CjIwMDksMTc1MAoyMDEwLDE5OTMKMjAxMSwyMTkyCjIwMTIsMjM5NwoyMDEzLDI1NzAKMjAxNCwyNzU5CjIwMTUsMjk3NQoyMDE2LDMyODkKMjAxNywzNTM5CjIwMTgsMzgxNwoyMDE5LDQyMDEKMjAyMCw0NzMzCjIwMjEsNTA2NwoyMDIyLDUzNjkKMjAyMyw1NTk0CjIwMjQsNTgwNQoyMDI1LDYwNDc=",import.meta.url).href;R7(i).then(l=>{if(!l||l.length===0)return;const h=l.map(me=>({year:+me.year,users:+me.global_internet_users_millions})),{width:g}=e.getBoundingClientRect(),v={top:32,right:24,bottom:50,left:70},r=Math.max(g,320)-v.left-v.right,C=240-v.top-v.bottom,I=WT(e).html("").append("svg").attr("viewBox",`0 0 ${r+v.left+v.right} ${C+v.top+v.bottom}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","100%"),z=I.append("g").attr("transform",`translate(${v.left},${v.top})`),N=r,k=C,j=Cb().domain(DR(h,me=>me.year)).range([0,N]),$=Cb().domain([0,_F(h,me=>me.users)]).nice().range([k,0]),re=xF(j).tickFormat(nw("d")).ticks(6),ie=vF($).ticks(6),Y=z.append("g").attr("transform",`translate(0,${k})`).call(re),ae=z.append("g").call(ie);Y.selectAll("path, line").attr("stroke","#e5e5e5"),ae.selectAll("path, line").attr("stroke","#e5e5e5"),Y.selectAll("text").attr("fill","#e5e5e5"),ae.selectAll("text").attr("fill","#e5e5e5"),I.append("text").attr("x",v.left+N/2).attr("y",v.top+k+40).attr("text-anchor","middle").attr("fill","#e5e5e5").attr("font-size",12).text("Year"),I.append("text").attr("transform",`translate(20, ${v.top+k/2}) rotate(-90)`).attr("text-anchor","middle").attr("fill","#e5e5e5").attr("font-size",12).text("Global Internet Users (millions)");const ue=M4().x(me=>j(me.year)).y(me=>$(me.users));z.append("path").datum(h).attr("fill","none").attr("stroke","#4ade80").attr("stroke-width",3).attr("d",ue),z.selectAll("circle").data(h).enter().append("circle").attr("cx",me=>j(me.year)).attr("cy",me=>$(me.users)).attr("r",4).attr("fill","#22c55e")})},[]),hi.jsxs("div",{className:"mt-8 w-full max-w-3xl mx-auto rounded-2xl bg-glass border border-white/10 p-4 sm:p-6 backdrop-blur-md",children:[hi.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Global Internet Users Over Time (Millions)"}),hi.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"As more people come online, the demand for cloud services and data centers grows, driving up the infrastructure needed to support the modern internet."}),hi.jsx("div",{ref:n,className:"w-full aspect-[16/9]"})]})}const joe="data:text/csv;base64,eWVhcixxdWFydGVyLFBVRQoyMDE1LFExLDEuMTEKMjAxNSxRMiwxLjEyCjIwMTUsUTMsMS4xNAoyMDE1LFE0LDEuMTEKMjAxNixRMSwxLjExCjIwMTYsUTIsMS4xMgoyMDE2LFEzLDEuMTQKMjAxNixRNCwxLjExCjIwMTcsUTEsMS4xMQoyMDE3LFEyLDEuMTEKMjAxNyxRMywxLjEzCjIwMTcsUTQsMS4xMAoyMDE4LFExLDEuMTAKMjAxOCxRMiwxLjEyCjIwMTgsUTMsMS4xMwoyMDE4LFE0LDEuMTAKMjAxOSxRMSwxLjA5CjIwMTksUTIsMS4xMQoyMDE5LFEzLDEuMTMKMjAxOSxRNCwxLjA5CjIwMjAsUTEsMS4wOQoyMDIwLFEyLDEuMTEKMjAyMCxRMywxLjEzCjIwMjAsUTQsMS4wOQoyMDIxLFExLDEuMDkKMjAyMSxRMiwxLjEwCjIwMjEsUTMsMS4xMgoyMDIxLFE0LDEuMDkKMjAyMixRMSwxLjA5CjIwMjIsUTIsMS4xMAoyMDIyLFEzLDEuMTIKMjAyMixRNCwxLjA4CjIwMjMsUTEsMS4wOAoyMDIzLFEyLDEuMTAKMjAyMyxRMywxLjEyCjIwMjMsUTQsMS4wOAoyMDI0LFExLDEuMDgKMjAyNCxRMiwxLjEwCjIwMjQsUTMsMS4xMQoyMDI0LFE0LDEuMDgKMjAyNSxRMSwxLjA4CjIwMjUsUTIsMS4xMAoyMDI1LFEzLDEuMTE=";function qoe(){const n=Ii.useRef(null);return Ii.useEffect(()=>{const e=n.current;if(!e)return;async function i(){const h=await(await fetch(joe)).text(),g=UR(h,$=>{const re=+$.year,ie=+$.quarter.replace("Q",""),Y=+$.PUE;return{year:re,quarter:$.quarter,PUE:Y,time:re+(ie-1)/4}}),{width:v}=e.getBoundingClientRect(),r={top:32,right:24,bottom:40,left:60},C=Math.max(v,320)-r.left-r.right,I=240-r.top-r.bottom,z=WT(e).html("").append("svg").attr("viewBox",`0 0 ${C+r.left+r.right} ${I+r.top+r.bottom}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","100%").append("g").attr("transform",`translate(${r.left},${r.top})`),N=Cb().domain(DR(g,$=>$.time)).range([0,C]),k=Cb().domain([VG(g,$=>$.PUE)-.02,_F(g,$=>$.PUE)+.02]).nice().range([I,0]);z.append("g").attr("transform",`translate(0, ${I})`).call(xF(N).tickFormat(nw("d"))),z.append("g").call(vF(k).ticks(5));const j=M4().x($=>N($.time)).y($=>k($.PUE));z.append("path").datum(g).attr("fill","none").attr("stroke","#4ade80").attr("stroke-width",2.5).attr("d",j),z.selectAll("circle").data(g).enter().append("circle").attr("cx",$=>N($.time)).attr("cy",$=>k($.PUE)).attr("r",3).attr("fill","#4ade80")}i()},[]),hi.jsxs("div",{className:"mt-8 w-full max-w-3xl mx-auto rounded-2xl bg-glass border border-white/10 p-4 sm:p-6 backdrop-blur-md",children:[hi.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Google Fleet-Wide Quarterly PUE"}),hi.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Each point shows Google's fleet PUE for a given quarter since 2015. Lower values mean more of the energy goes directly to computing instead of cooling and overhead."}),hi.jsx("div",{ref:n,className:"w-full aspect-[16/9]"})]})}const Xoe="/dsc-106-final-proj/assets/Book1-CKJrvzo2.csv",Woe=[{id:"datacenters",title:"What Are Data Centers?",text:`Every search, every AI query, every cloud upload  they all run through datacenters. These massive facilities house thousands of servers that process, store, and transmit data around the clock.
In essence, datacenters are the factories of the digital world  and in the age of AI they have become even more important.`,background:"/dsc-106-final-proj/images/datacenter-bg.jpg",showInternetChart:!0},{id:"us-types",title:"Top U.S. Data Center Types",text:`In the United States, not all data centers are built the same. Hyperscale sites power large cloud platforms, while colocation, enterprise, government, and edge facilities serve different industries and workloads.
To understand their reliability, we look at how each type is distributed across the Uptime Institute tier system (Tier IIV), where higher tiers correspond to more redundancy and higher expected uptime.`,background:"/dsc-106-final-proj/images/datacenter-bg.jpg",showUSTypeTierChart:!0},{id:"future",title:"Energy Concerns of Data Centers",text:`Artificial intelligence is revolutionizing every industry from healthcare to finance, and its growth shows no signs of slowing. 
    But behind every query and every AI model training session lies massive computational infrastructure. Data centers currently consume 1-2% of global electricity, and with AI's explosive growth, that number is skyrocketing.The energy used to power these data centers must be monitored and optimized to fit our needs as businesses and as people. As AI becomes more integrated into our daily lives, we're facing a critical question: how do we fuel this technological revolution without accelerating the climate crisis?
`,background:"/dsc-106-final-proj/images/coal-bg.jpg"},{id:"energy",title:"The Solution: Sustainable Data Centers",text:"Sustainable data centers are facilities designed to minimize environmental impact while maintaining high computing performance. These facilities achieve efficiency through renewable energy sources, optimized cooling systems with low PUE ratings, and water conservation techniques. The best sustainable data centers can operate on 100% renewable energy with PUE scores below 1.15, compared to the industry average of 1.58.",background:"/dsc-106-final-proj/images/sustainable_datacenter.jpg",showPUEChart:!0},{id:"score",title:"Introducing the Datacenter Score",text:`or GridScore.

To measure the concerns of this growing industry, we developed GridScore. A comprehensive dual-framework, it evaluates data centers on both ESG performance and profitability using a 60/40 weighting system. The ESG component (60%) measures environmental factors like energy efficiency and renewable usage. 
The profitability component (40%) assesses operational efficiency, and computation per energy used, ensuring that sustainable facilities are also financially viable.`,background:"/dsc-106-final-proj/images/scoring_breakdown.png"},{id:"gridcast",title:"What Is GridCast?",text:`Our mission is to use data to provide this information on how and where to build the perfect data center. We believe there is a smarter and better way to ride the wave of AI without harming the planet in the process.
    
    Welcome to GridCast.`,background:"/dsc-106-final-proj/images/hex-gr-bg.avif",showLaunchButton:!0}];function Zoe(){const n="/dsc-106-final-proj/",e=()=>{if(typeof window>"u")return"home";const h=window.location.pathname.toLowerCase(),g=window.location.hash.toLowerCase();return h.includes("dashboard")||g.includes("dashboard")?"dashboard":h.includes("contact")||g.includes("contact")?"contact":"home"},[i,l]=Ii.useState(e);return Ii.useEffect(()=>{const h=()=>l(e());return window.addEventListener("hashchange",h),window.addEventListener("popstate",h),()=>{window.removeEventListener("hashchange",h),window.removeEventListener("popstate",h)}},[]),i==="dashboard"?hi.jsx(koe,{}):i==="contact"?hi.jsx(Yoe,{}):hi.jsxs("main",{className:"relative flex min-h-screen w-full flex-col items-center justify-start overflow-x-hidden bg-dark-bg text-white",children:[hi.jsx(AV,{}),hi.jsxs("section",{className:"relative isolate z-10 flex min-h-[100vh] w-full flex-col items-center px-4 pb-32",children:[hi.jsxs("div",{className:"absolute top-0 left-0 right-0 -bottom-31 -z-10",children:[hi.jsx(cD,{className:"pointer-events-none h-full w-full",waveColor:[.5,.7,.5],disableAnimation:!1,enableMouseInteraction:!1,mouseRadius:.3,colorNum:6.7,waveAmplitude:0,waveFrequency:0,waveSpeed:.01}),hi.jsx("div",{className:"absolute inset-x-0 bottom-0 h-64 bg-gradient-to-b from-transparent to-dark-bg pointer-events-none"})]}),hi.jsxs("div",{className:"relative z-10 flex w-full max-w-5xl flex-1 flex-col items-center justify-center text-center",children:[hi.jsx("h1",{className:"text-5xl sm:text-8xl font-bold tracking-tighter text-white drop-shadow-[0_0_30px_rgba(0,255,128,0.3)] mt-36",children:"GridCast"}),hi.jsx("p",{className:"mt-4 max-w-2xl text-lg text-white/80 sm:text-xl",children:"Forecasting the energy of tomorrow, today."}),hi.jsxs("div",{className:"mt-10 flex flex-col items-center gap-4 sm:flex-row sm:gap-6",children:[hi.jsx("a",{href:`${n}dashboard`,className:"px-10 py-4 rounded-full bg-white text-black font-bold text-lg hover:bg-white hover:scale-105 transition-all shadow-[0_0_20px_rgba(0,255,128,0.4)]",children:"Launch Dashboard"}),hi.jsx("span",{className:"text-white/40 italic font-serif text-lg",children:"or"}),hi.jsx("a",{href:"https://www.youtube.com/watch?v=vOQEVUWjUXY",className:"px-10 py-4 rounded-full border border-white/20 bg-glass text-white font-medium hover:bg-white/10 hover:border-neon/50 transition-all backdrop-blur-sm cursor-pointer",children:"Watch the Video"})]})]}),hi.jsx("div",{className:"relative z-10 mt-12 w-full max-w-5xl text-center",children:hi.jsxs("div",{className:"grid w-full grid-cols-1 gap-6 sm:grid-cols-3",children:[hi.jsx(rC,{title:"A sustainable future",text:"The importance of sustainable data centers in the age of AI and cloud computing.",href:"#energy"}),hi.jsx(rC,{title:"Geographic Insights",text:"An interactive map that reveal how grid conditions vary across regions, making large-scale energy patterns easy to understand.",href:"#page-bottom"}),hi.jsx(rC,{title:"GridScore Explained",text:"Balance profitability and sustainability with our datacenter and ESG scoring models.",href:"#score"})]})})]}),hi.jsx("div",{className:"w-full flex flex-col gap-0",children:Woe.map((h,g)=>h.id==="gridcast"?hi.jsx(Joe,{...h,basePath:n},h.id):hi.jsx($oe,{...h,index:g,basePath:n},h.id))}),hi.jsx("div",{id:"page-bottom",className:"h-px w-full"})]})}function Yoe(){return hi.jsx("main",{className:"relative flex min-h-screen w-full flex-col items-center justify-start overflow-x-hidden bg-dark-bg text-white",children:hi.jsxs("section",{className:"relative isolate z-10 flex min-h-screen w-full items-center px-6 py-24",children:[hi.jsxs("div",{className:"absolute inset-0 -z-10",children:[hi.jsx(cD,{className:"pointer-events-none h-full w-full",waveColor:[.5,.7,.5],disableAnimation:!1,enableMouseInteraction:!1,mouseRadius:.3,colorNum:6.7,waveAmplitude:0,waveFrequency:0,waveSpeed:.01}),hi.jsx("div",{className:"absolute inset-x-0 bottom-0 h-64 bg-gradient-to-b from-transparent to-dark-bg pointer-events-none"})]}),hi.jsx("div",{className:"relative z-10 w-full max-w-7xl",children:hi.jsxs("div",{className:"grid gap-12 md:grid-cols-[2fr_0.8fr] md:items-center",children:[hi.jsxs("div",{className:"flex flex-col gap-4 items-center text-center",children:[hi.jsx("h1",{className:"text-5xl sm:text-8xl font-bold tracking-tighter text-white drop-shadow-[0_0_30px_rgba(0,255,128,0.3)]",children:"GridCast"}),hi.jsx("p",{className:"max-w-2xl text-lg text-white/80 sm:text-xl",children:"Forecasting the energy of tomorrow, today."})]}),hi.jsxs("div",{className:"flex flex-col items-center gap-4",children:[hi.jsx("div",{className:"flex h-56 w-56 items-center justify-center rounded-2xl border border-white/15 bg-white/5 text-white/60 backdrop-blur-sm",children:hi.jsx("img",{src:"/dsc-106-final-proj/images/qr.png",alt:"Contact QR Code",className:"h-full w-full object-contain p-2"})}),hi.jsx("a",{href:"#",className:"text-3xl text-neon hover:text-white transition-colors underline decoration-neon/50 decoration-2 underline-offset-4",children:"n3il-kb.github.io/dsc-106-final-proj/"})]})]})})]})})}function rC({title:n,text:e,href:i}){const l=hi.jsxs(hi.Fragment,{children:[hi.jsx("h3",{className:"text-2xl font-bold text-white mb-3 group-hover:text-neon transition-colors",children:n}),hi.jsx("p",{className:"text-white/60 leading-relaxed",children:e})]}),h="group block h-full rounded-2xl bg-glass border border-white/10 p-8 backdrop-blur-md text-center hover:border-neon/50 hover:shadow-[0_0_30px_rgba(0,255,128,0.1)] transition-all duration-500 cursor-pointer";return i?hi.jsx("a",{href:i,className:h,children:l}):hi.jsx("div",{className:h,children:l})}function pF(n){if(!n)return 0;const e=n.toString().replace(/[^0-9.]/g,"");return e?Number(e):0}function Koe(){const[n,e]=Ii.useState(null),[i,l]=Ii.useState("");if(Ii.useEffect(()=>{async function ue(){try{const Ae=await(await fetch(Xoe)).text(),ze=UR(Ae).find(jt=>jt.country==="United States");if(!ze){l("United States row not found in CSV.");return}const je=Number(ze.total_data_centers),Ce=pF(ze.hyperscale_data_centers),Te=pF(ze.colocation_data_centers),Ze=je-Ce-Te,Mt=Math.round(Ze*.4),mt=Math.round(Ze*.35),Gt=je-Ce-Te-Mt-mt,kt=ze.tier_distribution||"",Re={};kt.split(",").forEach(jt=>{const Ge=jt.trim().match(/([IVX]+)\s*:? *([\d.]+)%/);Ge&&(Re[Ge[1]]=Number(Ge[2]))});const Qe=[{name:"Hyperscale",count:Ce},{name:"Colocation",count:Te},{name:"Enterprise",count:Mt},{name:"Government",count:mt},{name:"Edge/Other",count:Gt}],et=["I","II","III","IV"],Lt=Math.max(...Qe.flatMap(jt=>et.map(Ge=>jt.count*(Re[Ge]??0)/100)));e({types:Qe,tiers:et,tierPercents:Re,maxCount:Lt})}catch(me){console.error(me),l("Failed to load CSV.")}}ue()},[]),i)return hi.jsx("p",{className:"mt-4 text-sm text-red-400",children:i});if(!n)return hi.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"Loading U.S. datacenter types"});const{types:h,tiers:g,tierPercents:v,maxCount:r}=n,C={I:"#38bdf8",II:"#34d399",III:"#facc15",IV:"#f87171"},I=420,z=260,N=50,k=20,j=20,$=40,re=I-N-k,ie=z-j-$,Y=re/h.length,ae=Y/(g.length+1);return hi.jsxs("div",{className:"mt-8 w-full max-w-3xl mx-auto rounded-2xl bg-glass border border-white/10 p-4 sm:p-6 backdrop-blur-md",children:[hi.jsx("h3",{className:"text-xl sm:text-2xl font-semibold text-white mb-2",children:"U.S. Data Center Types by Tier"}),hi.jsx("p",{className:"text-sm sm:text-base text-gray-400 mb-4",children:"For each major U.S. data center type, the grouped bars show the estimated number of facilities in Tier IIV. Higher tiers correspond to more redundancy and higher expected uptime."}),hi.jsxs("svg",{viewBox:`0 0 ${I} ${z}`,className:"w-full h-auto",children:[hi.jsx("line",{x1:N,y1:z-$,x2:I-k,y2:z-$,stroke:"#e5e5e5",strokeWidth:1}),h.map((ue,me)=>{const Ae=N+me*Y;return g.map((Se,ze)=>{const je=ue.count*(v[Se]??0)/100,Ce=r>0?je/r*ie:0,Te=Ae+ze*ae+ae*.1,Ze=z-$-Ce,Mt=ae*.8;return hi.jsx("rect",{x:Te,y:Ze,width:Mt,height:Ce,fill:C[Se],children:hi.jsx("title",{children:`${ue.name}  Tier ${Se}: ${je.toFixed(0)} data centers (approx.)`})},`${ue.name}-${Se}`)})}),h.map((ue,me)=>{const Ae=N+me*Y+Y/2,Se=z-$+20;return hi.jsx("text",{x:Ae,y:Se,textAnchor:"middle",fill:"#e5e5e5",fontSize:10,children:ue.name},ue.name)}),hi.jsx("line",{x1:N,y1:j,x2:N,y2:z-$,stroke:"#e5e5e5",strokeWidth:1})]}),hi.jsx("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs sm:text-sm text-gray-300",children:g.map(ue=>hi.jsxs("div",{className:"flex items-center gap-2",children:[hi.jsx("span",{className:"inline-block h-3 w-3 rounded-sm",style:{backgroundColor:C[ue]}}),hi.jsxs("span",{children:["Tier ",ue]})]},ue))})]})}function $oe({id:n,title:e,text:i,background:l,showLaunchButton:h,index:g,showInternetChart:v,showUSTypeTierChart:r,showPUEChart:C,basePath:I}){const z=g%2===0;return hi.jsx("section",{id:n,className:"relative z-20 flex min-h-[80vh] w-full items-center justify-center overflow-hidden px-6 py-24 md:px-24",children:hi.jsxs("div",{className:"container mx-auto grid grid-cols-1 gap-12 md:grid-cols-2 md:gap-24 items-center",children:[hi.jsxs(ub.div,{className:`flex flex-col justify-center ${z?"md:order-1":"md:order-2"}`,initial:{opacity:0,x:z?-50:50},whileInView:{opacity:1,x:0},transition:{duration:.8,ease:"easeOut"},viewport:{once:!0,margin:"-100px"},children:[hi.jsx("h2",{className:"mb-6 text-4xl font-bold text-white md:text-5xl leading-tight",children:e}),hi.jsx("p",{className:"whitespace-pre-line text-lg leading-relaxed text-gray-400 md:text-xl",children:i}),v&&hi.jsx("div",{className:"mt-8",children:hi.jsx(Hoe,{})}),r&&hi.jsx(Koe,{}),C&&hi.jsx(qoe,{}),h&&hi.jsx("div",{className:"mt-10",children:hi.jsx("a",{href:`${I}dashboard`,className:"inline-block px-8 py-3 rounded-full bg-white text-black font-bold text-lg hover:bg-white hover:scale-105 transition-all shadow-[0_0_20px_rgba(0,255,128,0.4)]",children:"Launch Dashboard"})})]}),hi.jsx(ub.div,{className:`relative ${z?"md:order-2":"md:order-1"}`,initial:{opacity:0,scale:.95},whileInView:{opacity:1,scale:1},transition:{duration:.8,delay:.2,ease:"easeOut"},viewport:{once:!0,margin:"-100px"},children:hi.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 shadow-2xl",children:[hi.jsx("div",{className:"aspect-[4/3] w-full overflow-hidden",children:hi.jsx("img",{src:l,alt:e,className:"h-full w-full object-cover transition-transform duration-700 hover:scale-105"})}),hi.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent pointer-events-none"})]})})]})})}function Joe({title:n,text:e,background:i,showLaunchButton:l,basePath:h}){return hi.jsxs("section",{className:"relative isolate flex h-screen items-center justify-center overflow-hidden px-6 text-center md:px-24",children:[i?hi.jsx(ub.div,{"aria-hidden":"true",className:"absolute inset-0 z-0 bg-cover bg-center",style:{backgroundImage:`url(${i})`},initial:{scale:1.05,opacity:.6},whileInView:{scale:1,opacity:.95},transition:{duration:1.2,ease:"easeOut"},viewport:{once:!0}}):hi.jsx("div",{className:"absolute inset-0 z-0 bg-black","aria-hidden":"true"}),hi.jsx(ub.div,{className:"absolute inset-0 z-20 bg-gradient-to-b from-black/15 via-black/45 to-black/85 backdrop-blur-[1px]",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:1},viewport:{once:!0}}),hi.jsxs(ub.div,{initial:{opacity:0,y:60},whileInView:{opacity:1,y:0},transition:{duration:1,delay:.2},viewport:{once:!0},className:"z-30 max-w-3xl",children:[hi.jsx("h2",{className:"mb-6 text-5xl font-bold text-white drop-shadow-[0_0_20px_rgba(0,255,128,0.25)] md:text-7xl tracking-tight",children:n}),hi.jsx("p",{className:"whitespace-pre-line text-lg leading-relaxed text-gray-200 md:text-xl",children:e}),l&&hi.jsx("div",{className:"mt-10 flex justify-center",children:hi.jsx("a",{href:`${h}dashboard`,className:"px-10 py-4 rounded-full bg-white text-black font-bold text-lg hover:bg-white hover:scale-105 transition-all shadow-[0_0_20px_rgba(0,255,128,0.4)]",children:"Launch Dashboard"})})]})]})}IG.createRoot(document.getElementById("root")).render(hi.jsx(Ii.StrictMode,{children:hi.jsx(Zoe,{})}));
